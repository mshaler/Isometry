import{j as e}from"./radix-D8HByQiv.js";import{g as t,a as r,R as n,C as s,F as a,T as i,S as o,X as l,A as c,b as u,c as h,d as g,e as f,f as p,D as m,L as b,h as x,B as y,i as v,j as w,k as T,l as S,P as E,m as N,n as C,o as j,p as D,q as I,I as k,s as O,t as P}from"./icons-CKx4ZIJr.js";import{r as R}from"./vendor-D44Kl-u3.js";import{s as M,t as A,m as L,a as _,b as $,o as F,T as U,z as H,c as X,d as z,e as V,l as W,p as B,f as q,h as G,i as K,g as Y,j as Q,k as Z,n as J,q as ee,r as te,u as re,v as ne,w as se,x as ae,y as ie,A as oe,B as le}from"./d3-BKRiOYvH.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const r of e)if("childList"===r.type)for(const e of r.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var ce,de={};const ue=t(function(){if(ce)return de;ce=1;var e=R();return de.createRoot=e.createRoot,de.hydrateRoot=e.hydrateRoot,de}());
/**
 * @remix-run/router v1.23.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function he(){return he=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},he.apply(this,arguments)}var ge;!function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"}(ge||(ge={}));const fe="popstate";function pe(e){return void 0===e&&(e={}),function(e,t,r,n){void 0===n&&(n={});let{window:s=document.defaultView,v5Compat:a=!1}=n,i=s.history,o=ge.Pop,l=null,c=d();null==c&&(c=0,i.replaceState(he({},i.state,{idx:c}),""));function d(){return(i.state||{idx:null}).idx}function u(){o=ge.Pop;let e=d(),t=null==e?null:e-c;c=e,l&&l({action:o,location:p.location,delta:t})}function h(e,t){o=ge.Push;let r=xe(p.location,e,t);c=d()+1;let n=be(r,c),u=p.createHref(r);try{i.pushState(n,"",u)}catch(h){if(h instanceof DOMException&&"DataCloneError"===h.name)throw h;s.location.assign(u)}a&&l&&l({action:o,location:p.location,delta:1})}function g(e,t){o=ge.Replace;let r=xe(p.location,e,t);c=d();let n=be(r,c),s=p.createHref(r);i.replaceState(n,"",s),a&&l&&l({action:o,location:p.location,delta:0})}function f(e){let t="null"!==s.location.origin?s.location.origin:s.location.href,r="string"==typeof e?e:ye(e);return r=r.replace(/ $/,"%20"),me(t,"No window.location.(origin|href) available to create URL for href: "+r),new URL(r,t)}let p={get action(){return o},get location(){return e(s,i)},listen(e){if(l)throw new Error("A history only accepts one active listener");return s.addEventListener(fe,u),l=e,()=>{s.removeEventListener(fe,u),l=null}},createHref:e=>t(s,e),createURL:f,encodeLocation(e){let t=f(e);return{pathname:t.pathname,search:t.search,hash:t.hash}},push:h,replace:g,go:e=>i.go(e)};return p}(function(e,t){let{pathname:r,search:n,hash:s}=e.location;return xe("",{pathname:r,search:n,hash:s},t.state&&t.state.usr||null,t.state&&t.state.key||"default")},function(e,t){return"string"==typeof t?t:ye(t)},0,e)}function me(e,t){if(!1===e||null==e)throw new Error(t)}function be(e,t){return{usr:e.state,key:e.key,idx:t}}function xe(e,t,r,n){return void 0===r&&(r=null),he({pathname:"string"==typeof e?e:e.pathname,search:"",hash:""},"string"==typeof t?ve(t):t,{state:r,key:t&&t.key||n||Math.random().toString(36).substr(2,8)})}function ye(e){let{pathname:t="/",search:r="",hash:n=""}=e;return r&&"?"!==r&&(t+="?"===r.charAt(0)?r:"?"+r),n&&"#"!==n&&(t+="#"===n.charAt(0)?n:"#"+n),t}function ve(e){let t={};if(e){let r=e.indexOf("#");r>=0&&(t.hash=e.substr(r),e=e.substr(0,r));let n=e.indexOf("?");n>=0&&(t.search=e.substr(n),e=e.substr(0,n)),e&&(t.pathname=e)}return t}var we;!function(e){e.data="data",e.deferred="deferred",e.redirect="redirect",e.error="error"}(we||(we={}));const Te=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i;function Se(e,t){void 0===t&&(t="/");let r,{pathname:n,search:s="",hash:a=""}="string"==typeof e?ve(e):e;if(n)if(i=n,Te.test(i))r=n;else{if(n.includes("//")){let e=n;n=n.replace(/\/\/+/g,"/"),function(e,t){"undefined"!=typeof console&&console.warn(t);try{throw new Error(t)}catch(r){}}(0,"Pathnames cannot have embedded double slashes - normalizing "+e+" -> "+n)}r=n.startsWith("/")?Ee(n.substring(1),"/"):Ee(n,t)}else r=t;var i;return{pathname:r,search:Ce(s),hash:je(a)}}function Ee(e,t){let r=t.replace(/\/+$/,"").split("/");return e.split("/").forEach(e=>{".."===e?r.length>1&&r.pop():"."!==e&&r.push(e)}),r.length>1?r.join("/"):"/"}function Ne(e,t,r,n){return"Cannot include a '"+e+"' character in a manually specified `to."+t+"` field ["+JSON.stringify(n)+"].  Please separate it out to the `to."+r+'` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.'}const Ce=e=>e&&"?"!==e?e.startsWith("?")?e:"?"+e:"",je=e=>e&&"#"!==e?e.startsWith("#")?e:"#"+e:"",De=["post","put","patch","delete"];new Set(De);const Ie=["get",...De];
/**
 * React Router v6.30.3
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */
function ke(){return ke=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},ke.apply(this,arguments)}new Set(Ie);const Oe=r.createContext(null),Pe=r.createContext(null),Re=r.createContext(null),Me=r.createContext({outlet:null,matches:[],isDataRoute:!1});function Ae(){return null!=r.useContext(Re)}function Le(){return Ae()||me(!1),r.useContext(Re).location}function _e(e){r.useContext(Pe).static||r.useLayoutEffect(e)}function $e(){let{isDataRoute:e}=r.useContext(Me);return e?function(){let{router:e}=function(){let e=r.useContext(Oe);return e||me(!1),e}(Fe.UseNavigateStable),t=function(){let e=function(){let e=r.useContext(Me);return e||me(!1),e}(),t=e.matches[e.matches.length-1];return t.route.id||me(!1),t.route.id}(Ue.UseNavigateStable),n=r.useRef(!1);return _e(()=>{n.current=!0}),r.useCallback(function(r,s){void 0===s&&(s={}),n.current&&("number"==typeof r?e.navigate(r):e.navigate(r,ke({fromRouteId:t},s)))},[e,t])}():function(){Ae()||me(!1);let e=r.useContext(Oe),{basename:t,future:n,navigator:s}=r.useContext(Pe),{matches:a}=r.useContext(Me),{pathname:i}=Le(),o=JSON.stringify(function(e,t){let r=function(e){return e.filter((e,t)=>0===t||e.route.path&&e.route.path.length>0)}(e);return t?r.map((e,t)=>t===r.length-1?e.pathname:e.pathnameBase):r.map(e=>e.pathnameBase)}(a,n.v7_relativeSplatPath)),l=r.useRef(!1);return _e(()=>{l.current=!0}),r.useCallback(function(r,n){if(void 0===n&&(n={}),!l.current)return;if("number"==typeof r)return void s.go(r);let a=function(e,t,r,n){let s;void 0===n&&(n=!1),"string"==typeof e?s=ve(e):(s=he({},e),me(!s.pathname||!s.pathname.includes("?"),Ne("?","pathname","search",s)),me(!s.pathname||!s.pathname.includes("#"),Ne("#","pathname","hash",s)),me(!s.search||!s.search.includes("#"),Ne("#","search","hash",s)));let a,i=""===e||""===s.pathname,o=i?"/":s.pathname;if(null==o)a=r;else{let e=t.length-1;if(!n&&o.startsWith("..")){let t=o.split("/");for(;".."===t[0];)t.shift(),e-=1;s.pathname=t.join("/")}a=e>=0?t[e]:"/"}let l=Se(s,a),c=o&&"/"!==o&&o.endsWith("/"),d=(i||"."===o)&&r.endsWith("/");return l.pathname.endsWith("/")||!c&&!d||(l.pathname+="/"),l}(r,JSON.parse(o),i,"path"===n.relative);null==e&&"/"!==t&&(a.pathname="/"===a.pathname?t:[t,a.pathname].join("/").replace(/\/\/+/g,"/")),(n.replace?s.replace:s.push)(a,n.state,n)},[t,s,o,i,e])}()}var Fe=function(e){return e.UseBlocker="useBlocker",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e}(Fe||{}),Ue=function(e){return e.UseBlocker="useBlocker",e.UseLoaderData="useLoaderData",e.UseActionData="useActionData",e.UseRouteError="useRouteError",e.UseNavigation="useNavigation",e.UseRouteLoaderData="useRouteLoaderData",e.UseMatches="useMatches",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e.UseRouteId="useRouteId",e}(Ue||{});function He(e){let{basename:t="/",children:n=null,location:s,navigationType:a=ge.Pop,navigator:i,static:o=!1,future:l}=e;Ae()&&me(!1);let c=t.replace(/^\/*/,"/"),d=r.useMemo(()=>({basename:c,navigator:i,static:o,future:ke({v7_relativeSplatPath:!1},l)}),[c,l,i,o]);"string"==typeof s&&(s=ve(s));let{pathname:u="/",search:h="",hash:g="",state:f=null,key:p="default"}=s,m=r.useMemo(()=>{let e=function(e,t){if("/"===t)return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let r=t.endsWith("/")?t.length-1:t.length,n=e.charAt(r);return n&&"/"!==n?null:e.slice(r)||"/"}(u,c);return null==e?null:{location:{pathname:e,search:h,hash:g,state:f,key:p},navigationType:a}},[c,u,h,g,f,p,a]);return null==m?null:r.createElement(Pe.Provider,{value:d},r.createElement(Re.Provider,{children:n,value:m}))}
/**
 * React Router DOM v6.30.3
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */
function Xe(e){return void 0===e&&(e=""),new URLSearchParams("string"==typeof e||Array.isArray(e)||e instanceof URLSearchParams?e:Object.keys(e).reduce((t,r)=>{let n=e[r];return t.concat(Array.isArray(n)?n.map(e=>[r,e]):[[r,n]])},[]))}new Promise(()=>{});try{window.__reactRouterVersion="6"}catch(Qa){}const ze=n.startTransition;function Ve(e){let{basename:t,children:n,future:s,window:a}=e,i=r.useRef();null==i.current&&(i.current=pe({window:a,v5Compat:!0}));let o=i.current,[l,c]=r.useState({action:o.action,location:o.location}),{v7_startTransition:d}=s||{},u=r.useCallback(e=>{d&&ze?ze(()=>c(e)):c(e)},[c,d]);return r.useLayoutEffect(()=>o.listen(u),[o,u]),r.useEffect(()=>{return null==(e=s)||e.v7_startTransition,void(null==e||e.v7_relativeSplatPath);var e},[s]),r.createElement(He,{basename:t,children:n,location:l.location,navigationType:l.action,navigator:o,future:s})}var We,Be,qe,Ge;function Ke(e){let t=r.useRef(Xe(e)),n=r.useRef(!1),s=Le(),a=r.useMemo(()=>function(e,t){let r=Xe(e);return t&&t.forEach((e,n)=>{r.has(n)||t.getAll(n).forEach(e=>{r.append(n,e)})}),r}(s.search,n.current?null:t.current),[s.search]),i=$e(),o=r.useCallback((e,t)=>{const r=Xe("function"==typeof e?e(a):e);n.current=!0,i("?"+r,t)},[i,a]);return[a,o]}(Be=We||(We={})).UseScrollRestoration="useScrollRestoration",Be.UseSubmit="useSubmit",Be.UseSubmitFetcher="useSubmitFetcher",Be.UseFetcher="useFetcher",Be.useViewTransitionState="useViewTransitionState",(Ge=qe||(qe={})).UseFetcher="useFetcher",Ge.UseFetchers="useFetchers",Ge.UseScrollRestoration="useScrollRestoration";const Ye=r.createContext(void 0);function Qe({children:t,defaultTheme:n="Modern"}){const[s,a]=r.useState(n);return e.jsx(Ye.Provider,{value:{theme:s,setTheme:a},children:t})}function Ze(){const e=r.useContext(Ye);if(void 0===e)throw new Error("useTheme must be used within a ThemeProvider");return e}function Je(e,t,n,s){const[a,i]=Ke(),o=a.get(e),[l,c]=r.useState(()=>{if(o)try{return s(o)}catch(r){return console.warn(`Failed to deserialize URL param "${e}":`,r),t}return t}),d=r.useCallback(r=>{c(r),i(s=>{const a=new URLSearchParams(s);try{const s=n(r);s===n(t)?a.delete(e):a.set(e,s)}catch(i){console.warn(`Failed to serialize value for "${e}":`,i),a.delete(e)}return a},{replace:!0})},[e,t,n,i]);return r.useEffect(()=>{const r=a.get(e);if(r)try{const e=s(r);c(e)}catch(n){console.warn(`Failed to deserialize URL param "${e}" on popstate:`,n),c(t)}else c(t)},[a,e,t,s]),[l,d]}const et=r.createContext(void 0);function tt({children:t}){const[r,n]=Je("app","Demo",e=>e,e=>e),[s,a]=Je("view","Grid",e=>e,e=>e),[i,o]=Je("dataset","Notes",e=>e,e=>e);return e.jsx(et.Provider,{value:{activeApp:r,activeView:s,activeDataset:i,setActiveApp:n,setActiveView:a,setActiveDataset:o},children:t})}function rt(){const e=r.useContext(et);if(void 0===e)throw new Error("useAppState must be used within an AppStateProvider");return e}const nt=[/(\b(ALTER|CREATE|DELETE|DROP|EXEC(UTE)?|INSERT( +INTO)?|MERGE|SELECT|UPDATE|UNION( +ALL)?)\b)/i,/(\b(AND|OR)\b.*(=|<|>|!=|<>|<=|>=).*(\b(SELECT|INSERT|UPDATE|DELETE)\b))/i,/(;|--|\/\*|\*\/)/,/(\b(SCRIPT|JAVASCRIPT|VBSCRIPT|ONLOAD|ONERROR)\b)/i,/'(\s*|\s*[\w\s]*\s*);?\s*(DROP|DELETE|INSERT|UPDATE|SELECT|UNION)/i],st=[/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,/<iframe\b[^<]*(?:(?!<\/iframe>)<[^<]*)*<\/iframe>/gi,/javascript:/gi,/vbscript:/gi,/on\w+\s*=/gi,/<img[^>]+src[\s]*=[\s]*["']javascript:/gi];function at(e,t={}){const r=[],n=[];let s=e;if(null==e)return{isValid:!1,errors:["Input cannot be null or undefined"],warnings:[]};if("string"!=typeof e&&(s=String(e),n.push("Input converted to string")),t.maxLength&&s.length>t.maxLength&&(r.push(`Input exceeds maximum length of ${t.maxLength}`),s=s.substring(0,t.maxLength),n.push(`Input truncated to ${t.maxLength} characters`)),t.allowedCharacters&&!t.allowedCharacters.test(s)&&r.push("Input contains invalid characters"),!1!==t.escapeSQL){nt.some(e=>e.test(s))&&r.push("Input contains potential SQL injection patterns"),s=s.replace(/'/g,"''").replace(/;/g,"\\;").replace(/--/g,"\\-\\-")}if(st.some(e=>e.test(s))&&r.push("Input contains potential XSS patterns"),t.stripHTML){const e=s.length;s=s.replace(/<[^>]*>/g,""),s.length<e&&n.push("HTML tags removed from input")}if(t.normalizeWhitespace){const e=s;s=s.replace(/\s+/g," ").trim(),e!==s&&n.push("Whitespace normalized")}return t.allowedValues&&!t.allowedValues.includes(s)&&r.push(`Value must be one of: ${t.allowedValues.join(", ")}`),{isValid:0===r.length,sanitizedValue:s,errors:r,warnings:n}}function it(e){if(null==e)return{isValid:!0,sanitizedValue:null,errors:[],warnings:[]};if("string"==typeof e)return at(e,{maxLength:1e3,stripHTML:!0,escapeSQL:!0,normalizeWhitespace:!0,allowedCharacters:/^[a-zA-Z0-9\s\-_.:@/]+$/});if("number"==typeof e)return function(e,t={}){const r=[],n=[];if(null==e)return{isValid:!1,errors:["Input cannot be null or undefined"],warnings:[]};let s;if("string"==typeof e){if(nt.some(t=>t.test(e)))return{isValid:!1,errors:["Numeric input contains invalid characters"],warnings:[]};s=Number(e),n.push("String input converted to number")}else{if("number"!=typeof e)return{isValid:!1,errors:["Input must be a number or numeric string"],warnings:[]};s=e}return isNaN(s)&&r.push("Input is not a valid number"),isFinite(s)||r.push("Input cannot be infinite"),t.integer&&!Number.isInteger(s)&&(r.push("Input must be an integer"),s=Math.round(s),n.push("Non-integer value rounded")),void 0!==t.min&&s<t.min&&r.push(`Input must be at least ${t.min}`),void 0!==t.max&&s>t.max&&r.push(`Input cannot exceed ${t.max}`),{isValid:0===r.length,sanitizedValue:s,errors:r,warnings:n}}(e,{min:-1e10,max:1e10});if("boolean"==typeof e)return{isValid:!0,sanitizedValue:e,errors:[],warnings:[]};if("object"==typeof e){const t=[],r=[];if(Array.isArray(e))t.push("Arrays not supported in DSL values");else{if("preset"in e&&"string"==typeof e.preset){const n=at(e.preset,{maxLength:50,allowedValues:["today","yesterday","last-week","last-7-days","last-month","last-30-days","this-year","next-week","overdue"]});return n.isValid||t.push(...n.errors),{isValid:0===t.length,sanitizedValue:{preset:n.sanitizedValue},errors:t,warnings:[...r,...n.warnings]}}t.push("Invalid object structure in DSL value")}return{isValid:!1,errors:t,warnings:r}}return{isValid:!1,errors:["Unsupported value type"],warnings:[]}}function ot(e){return at(e,{maxLength:100,allowedCharacters:/^[a-zA-Z][a-zA-Z0-9_]*$/,stripHTML:!0,normalizeWhitespace:!0})}function lt(e){return e.errors.some(e=>e.includes("SQL injection")||e.includes("XSS")||e.includes("invalid characters")||e.includes("security"))}function ct(e){if(!e)return{sql:"1=1",params:[]};const t=[];function r(e,t){const r=ot(e);if(!r.isValid||lt(r))throw new Error(`Invalid time field name: ${r.errors.join(", ")}`);const n=r.sanitizedValue;if(!["today","yesterday","last-week","last-7-days","last-month","last-30-days","this-year","next-week","overdue"].includes(t))throw new Error(`Invalid time preset: ${t}`);switch(t){case"today":return`date(${n}) = date('now')`;case"yesterday":return`date(${n}) = date('now', '-1 day')`;case"last-week":case"last-7-days":return`${n} >= date('now', '-7 days')`;case"last-month":case"last-30-days":return`${n} >= date('now', '-30 days')`;case"this-year":return`${n} >= date('now', 'start of year')`;case"next-week":return`${n} <= date('now', '+7 days')`;case"overdue":return`${n} < date('now')`;default:return"1=1"}}return{sql:function e(n){switch(n.type){case"filter":return function(e,n,s){const a=ot(e);if(!a.isValid||lt(a))throw new Error(`Invalid field name: ${a.errors.join(", ")}`);const i=a.sanitizedValue,o=function(e){return at(e,{maxLength:5,allowedValues:["=","!=","<",">","<=",">=","~"],stripHTML:!0,normalizeWhitespace:!0})}(n);if(!o.isValid)throw new Error(`Invalid operator: ${o.errors.join(", ")}`);const l=o.sanitizedValue,c=it(s);if(!c.isValid||lt(c))throw new Error(`Invalid filter value: ${c.errors.join(", ")}`);const d=c.sanitizedValue;if("object"==typeof d&&d&&"preset"in d)return r(i,d.preset);if("~"===l)return t.push(`%${d}%`),`${i} LIKE ?`;return t.push(d),`${i} ${l} ?`}(n.field,n.operator,n.value);case"axis":return function(e,n){if(!["time","category","hierarchy","alphabet","location"].includes(e))throw new Error(`Invalid axis: ${e}`);const s=it(n);if(!s.isValid||lt(s))throw new Error(`Invalid axis value: ${s.errors.join(", ")}`);const a=s.sanitizedValue;switch(e){case"time":return"object"==typeof a&&a&&"preset"in a?r("created",a.preset):(t.push(a),"created = ?");case"category":return t.push(a),"category = ?";case"hierarchy":return t.push(a),"priority <= ?";case"alphabet":if("string"==typeof a&&a.includes("-")){const e=a.split("-");if(2!==e.length)throw new Error("Invalid alphabet range format");const[r,n]=e;if(!/^[A-Z]$/.test(r)||!/^[A-Z]$/.test(n))throw new Error("Alphabet range must be single uppercase letters (A-Z)");return t.push(r),t.push(n),"SUBSTR(name, 1, 1) BETWEEN ? AND ?"}return t.push(`${a}%`),"name LIKE ?";case"location":return t.push(a),"location = ?";default:return"1=1"}}(n.axis,n.value);case"and":return`(${e(n.left)} AND ${e(n.right)})`;case"or":return`(${e(n.left)} OR ${e(n.right)})`;case"not":return`NOT (${e(n.operand)})`;case"group":return`(${e(n.expression)})`;default:return"1=1"}}(e),params:t}}const dt=r.createContext(void 0);function ut({children:t}){const[n,s]=r.useState([]),a=r.useCallback(e=>{s(t=>[...t,e])},[]),i=r.useCallback(e=>{s(t=>t.filter((t,r)=>r!==e))},[]),o=r.useCallback(()=>{s([])},[]),l=r.useMemo(()=>{const e=function(e){if(0===e.length)return null;const t=e.map(e=>({type:"filter",field:e.field,operator:e.operator,value:e.value}));if(1===t.length)return t[0];let r=t[0];for(let n=1;n<t.length;n++)r={type:"and",left:r,right:t[n]};return r}(n);return ct(e)},[n]);return e.jsx(dt.Provider,{value:{filters:n,addFilter:a,removeFilter:i,clearFilters:o,compiledQuery:l},children:t})}function ht(){const e=r.useContext(dt);if(void 0===e)throw new Error("useFilters must be used within a FilterProvider");return e}const gt=r.createContext(void 0),ft={available:[],rows:[{id:"folder",label:"Folder"},{id:"subfolder",label:"Sub-folder"},{id:"tags",label:"Tags"}],columns:[{id:"year",label:"Year"},{id:"month",label:"Month"}],zLayers:[{id:"auditview",label:"Audit View",hasCheckbox:!0,checked:!1}]};function pt({children:t}){const[n,s]=r.useState(ft),a=r.useCallback((e,t,r,n)=>{s(s=>{const a={available:[...s.available],rows:[...s.rows],columns:[...s.columns],zLayers:[...s.zLayers]},[i]=a[e].splice(t,1);return a[r].splice(n,0,i),a})},[]),i=r.useCallback((e,t)=>{s(t=>({...t,[e]:t[e].map(e=>e.id===chipId?{...e,checked:!e.checked}:e)}))},[]),o=r.useCallback(()=>{s(e=>({...e,rows:e.columns,columns:e.rows}))},[]);return e.jsx(gt.Provider,{value:{wells:n,moveChip:a,toggleCheckbox:i,transpose:o},children:t})}function mt(){const e=r.useContext(gt);if(void 0===e)throw new Error("usePAFV must be used within a PAFVProvider");return e}const bt=[{id:"1",name:"Project Alpha",content:"Initial project planning",folder:"Projects",status:"active",priority:"high",createdAt:"2024-01-15T10:00:00Z",modifiedAt:"2024-01-20T15:30:00Z",deletedAt:null},{id:"2",name:"Meeting Notes",content:"Weekly team sync",folder:"Meetings",status:"completed",priority:"medium",createdAt:"2024-01-10T09:00:00Z",modifiedAt:"2024-01-10T16:00:00Z",deletedAt:null},{id:"3",name:"Research Task",content:"Market analysis",folder:"Research",status:"pending",priority:"low",createdAt:"2024-01-08T14:00:00Z",modifiedAt:"2024-01-12T11:00:00Z",deletedAt:null},{id:"4",name:"Bug Fix #123",content:"Critical production issue",folder:"Development",status:"active",priority:"high",createdAt:"2024-01-22T08:00:00Z",modifiedAt:"2024-01-22T08:30:00Z",deletedAt:null},{id:"5",name:"Feature Spec",content:"New user dashboard",folder:"Projects",status:"draft",priority:"medium",createdAt:"2024-01-05T13:00:00Z",modifiedAt:"2024-01-18T10:00:00Z",deletedAt:null},{id:"6",name:"Documentation Update",content:"API reference docs",folder:"Documentation",status:"completed",priority:"low",createdAt:"2024-01-12T16:00:00Z",modifiedAt:"2024-01-19T14:00:00Z",deletedAt:null}];function xt(){const[e,t]=r.useState(!0);return r.useEffect(()=>{const e=setTimeout(()=>{t(!1)},500);return()=>clearTimeout(e)},[]),{data:e?null:bt,loading:e,error:null}}function yt(){return yt=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)({}).hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},yt.apply(null,arguments)}function vt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function wt(e,t){return wt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},wt(e,t)}var Tt=Number.isNaN||function(e){return"number"==typeof e&&e!=e};function St(e,t){return e===t||!(!Tt(e)||!Tt(t))}function Et(e,t){if(e.length!==t.length)return!1;for(var r=0;r<e.length;r++)if(!St(e[r],t[r]))return!1;return!0}function Nt(e,t){var r;void 0===t&&(t=Et);var n,s=[],a=!1;return function(){for(var i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];return a&&r===this&&t(i,s)||(n=e.apply(this,i),a=!0,r=this,s=i),n}}var Ct="object"==typeof performance&&"function"==typeof performance.now?function(){return performance.now()}:function(){return Date.now()};function jt(e){cancelAnimationFrame(e.id)}var Dt=-1;function It(e){if(void 0===e&&(e=!1),-1===Dt||e){var t=document.createElement("div"),r=t.style;r.width="50px",r.height="50px",r.overflow="scroll",document.body.appendChild(t),Dt=t.offsetWidth-t.clientWidth,document.body.removeChild(t)}return Dt}var kt=null;function Ot(e){if(void 0===e&&(e=!1),null===kt||e){var t=document.createElement("div"),r=t.style;r.width="50px",r.height="50px",r.overflow="scroll",r.direction="rtl";var n=document.createElement("div"),s=n.style;return s.width="100px",s.height="100px",t.appendChild(n),document.body.appendChild(t),t.scrollLeft>0?kt="positive-descending":(t.scrollLeft=1,kt=0===t.scrollLeft?"negative":"positive-ascending"),document.body.removeChild(t),kt}return kt}var Pt=function(e,t){return e};function Rt(e){var t,n=e.getItemOffset,s=e.getEstimatedTotalSize,a=e.getItemSize,i=e.getOffsetForIndexAndAlignment,o=e.getStartIndexForOffset,l=e.getStopIndexForStartIndex,c=e.initInstanceProps,d=e.shouldResetStyleCacheOnItemSizeChange,u=e.validateProps;return t=function(e){var t,h;function g(t){var r;return(r=e.call(this,t)||this)._instanceProps=c(r.props,vt(r)),r._outerRef=void 0,r._resetIsScrollingTimeoutId=null,r.state={instance:vt(r),isScrolling:!1,scrollDirection:"forward",scrollOffset:"number"==typeof r.props.initialScrollOffset?r.props.initialScrollOffset:0,scrollUpdateWasRequested:!1},r._callOnItemsRendered=void 0,r._callOnItemsRendered=Nt(function(e,t,n,s){return r.props.onItemsRendered({overscanStartIndex:e,overscanStopIndex:t,visibleStartIndex:n,visibleStopIndex:s})}),r._callOnScroll=void 0,r._callOnScroll=Nt(function(e,t,n){return r.props.onScroll({scrollDirection:e,scrollOffset:t,scrollUpdateWasRequested:n})}),r._getItemStyle=void 0,r._getItemStyle=function(e){var t,s=r.props,i=s.direction,o=s.itemSize,l=s.layout,c=r._getItemStyleCache(d&&o,d&&l,d&&i);if(c.hasOwnProperty(e))t=c[e];else{var u=n(r.props,e,r._instanceProps),h=a(r.props,e,r._instanceProps),g="horizontal"===i||"horizontal"===l,f="rtl"===i,p=g?u:0;c[e]=t={position:"absolute",left:f?void 0:p,right:f?p:void 0,top:g?0:u,height:g?"100%":h,width:g?h:"100%"}}return t},r._getItemStyleCache=void 0,r._getItemStyleCache=Nt(function(e,t,r){return{}}),r._onScrollHorizontal=function(e){var t=e.currentTarget,n=t.clientWidth,s=t.scrollLeft,a=t.scrollWidth;r.setState(function(e){if(e.scrollOffset===s)return null;var t=r.props.direction,i=s;if("rtl"===t)switch(Ot()){case"negative":i=-s;break;case"positive-descending":i=a-n-s}return i=Math.max(0,Math.min(i,a-n)),{isScrolling:!0,scrollDirection:e.scrollOffset<i?"forward":"backward",scrollOffset:i,scrollUpdateWasRequested:!1}},r._resetIsScrollingDebounced)},r._onScrollVertical=function(e){var t=e.currentTarget,n=t.clientHeight,s=t.scrollHeight,a=t.scrollTop;r.setState(function(e){if(e.scrollOffset===a)return null;var t=Math.max(0,Math.min(a,s-n));return{isScrolling:!0,scrollDirection:e.scrollOffset<t?"forward":"backward",scrollOffset:t,scrollUpdateWasRequested:!1}},r._resetIsScrollingDebounced)},r._outerRefSetter=function(e){var t=r.props.outerRef;r._outerRef=e,"function"==typeof t?t(e):null!=t&&"object"==typeof t&&t.hasOwnProperty("current")&&(t.current=e)},r._resetIsScrollingDebounced=function(){var e,t,n,s;null!==r._resetIsScrollingTimeoutId&&jt(r._resetIsScrollingTimeoutId),r._resetIsScrollingTimeoutId=(e=r._resetIsScrolling,t=150,n=Ct(),s={id:requestAnimationFrame(function r(){Ct()-n>=t?e.call(null):s.id=requestAnimationFrame(r)})})},r._resetIsScrolling=function(){r._resetIsScrollingTimeoutId=null,r.setState({isScrolling:!1},function(){r._getItemStyleCache(-1,null)})},r}h=e,(t=g).prototype=Object.create(h.prototype),t.prototype.constructor=t,wt(t,h),g.getDerivedStateFromProps=function(e,t){return Mt(e,t),u(e),null};var f=g.prototype;return f.scrollTo=function(e){e=Math.max(0,e),this.setState(function(t){return t.scrollOffset===e?null:{scrollDirection:t.scrollOffset<e?"forward":"backward",scrollOffset:e,scrollUpdateWasRequested:!0}},this._resetIsScrollingDebounced)},f.scrollToItem=function(e,t){void 0===t&&(t="auto");var r=this.props,n=r.itemCount,s=r.layout,a=this.state.scrollOffset;e=Math.max(0,Math.min(e,n-1));var o=0;if(this._outerRef){var l=this._outerRef;o="vertical"===s?l.scrollWidth>l.clientWidth?It():0:l.scrollHeight>l.clientHeight?It():0}this.scrollTo(i(this.props,e,t,a,this._instanceProps,o))},f.componentDidMount=function(){var e=this.props,t=e.direction,r=e.initialScrollOffset,n=e.layout;if("number"==typeof r&&null!=this._outerRef){var s=this._outerRef;"horizontal"===t||"horizontal"===n?s.scrollLeft=r:s.scrollTop=r}this._callPropsCallbacks()},f.componentDidUpdate=function(){var e=this.props,t=e.direction,r=e.layout,n=this.state,s=n.scrollOffset;if(n.scrollUpdateWasRequested&&null!=this._outerRef){var a=this._outerRef;if("horizontal"===t||"horizontal"===r)if("rtl"===t)switch(Ot()){case"negative":a.scrollLeft=-s;break;case"positive-ascending":a.scrollLeft=s;break;default:var i=a.clientWidth,o=a.scrollWidth;a.scrollLeft=o-i-s}else a.scrollLeft=s;else a.scrollTop=s}this._callPropsCallbacks()},f.componentWillUnmount=function(){null!==this._resetIsScrollingTimeoutId&&jt(this._resetIsScrollingTimeoutId)},f.render=function(){var e=this.props,t=e.children,n=e.className,a=e.direction,i=e.height,o=e.innerRef,l=e.innerElementType,c=e.innerTagName,d=e.itemCount,u=e.itemData,h=e.itemKey,g=void 0===h?Pt:h,f=e.layout,p=e.outerElementType,m=e.outerTagName,b=e.style,x=e.useIsScrolling,y=e.width,v=this.state.isScrolling,w="horizontal"===a||"horizontal"===f,T=w?this._onScrollHorizontal:this._onScrollVertical,S=this._getRangeToRender(),E=S[0],N=S[1],C=[];if(d>0)for(var j=E;j<=N;j++)C.push(r.createElement(t,{data:u,key:g(j,u),index:j,isScrolling:x?v:void 0,style:this._getItemStyle(j)}));var D=s(this.props,this._instanceProps);return r.createElement(p||m||"div",{className:n,onScroll:T,ref:this._outerRefSetter,style:yt({position:"relative",height:i,width:y,overflow:"auto",WebkitOverflowScrolling:"touch",willChange:"transform",direction:a},b)},r.createElement(l||c||"div",{children:C,ref:o,style:{height:w?"100%":D,pointerEvents:v?"none":void 0,width:w?D:"100%"}}))},f._callPropsCallbacks=function(){if("function"==typeof this.props.onItemsRendered&&this.props.itemCount>0){var e=this._getRangeToRender(),t=e[0],r=e[1],n=e[2],s=e[3];this._callOnItemsRendered(t,r,n,s)}if("function"==typeof this.props.onScroll){var a=this.state,i=a.scrollDirection,o=a.scrollOffset,l=a.scrollUpdateWasRequested;this._callOnScroll(i,o,l)}},f._getRangeToRender=function(){var e=this.props,t=e.itemCount,r=e.overscanCount,n=this.state,s=n.isScrolling,a=n.scrollDirection,i=n.scrollOffset;if(0===t)return[0,0,0,0];var c=o(this.props,i,this._instanceProps),d=l(this.props,c,i,this._instanceProps),u=s&&"backward"!==a?1:Math.max(1,r),h=s&&"forward"!==a?1:Math.max(1,r);return[Math.max(0,c-u),Math.max(0,Math.min(t-1,d+h)),c,d]},g}(r.PureComponent),t.defaultProps={direction:"ltr",itemData:void 0,layout:"vertical",overscanCount:2,useIsScrolling:!1},t}var Mt=function(e,t){e.children,e.direction,e.height,e.layout,e.innerTagName,e.outerTagName,e.width,t.instance},At=function(e,t,r){var n=e.itemSize,s=r.itemMetadataMap,a=r.lastMeasuredIndex;if(t>a){var i=0;if(a>=0){var o=s[a];i=o.offset+o.size}for(var l=a+1;l<=t;l++){var c=n(l);s[l]={offset:i,size:c},i+=c}r.lastMeasuredIndex=t}return s[t]},Lt=function(e,t,r,n,s){for(;n<=r;){var a=n+Math.floor((r-n)/2),i=At(e,a,t).offset;if(i===s)return a;i<s?n=a+1:i>s&&(r=a-1)}return n>0?n-1:0},_t=function(e,t,r,n){for(var s=e.itemCount,a=1;r<s&&At(e,r,t).offset<n;)r+=a,a*=2;return Lt(e,t,Math.min(r,s-1),Math.floor(r/2),n)},$t=function(e,t){var r=e.itemCount,n=t.itemMetadataMap,s=t.estimatedItemSize,a=t.lastMeasuredIndex,i=0;if(a>=r&&(a=r-1),a>=0){var o=n[a];i=o.offset+o.size}return i+(r-a-1)*s},Ft=Rt({getItemOffset:function(e,t,r){return At(e,t,r).offset},getItemSize:function(e,t,r){return r.itemMetadataMap[t].size},getEstimatedTotalSize:$t,getOffsetForIndexAndAlignment:function(e,t,r,n,s,a){var i=e.direction,o=e.height,l=e.layout,c=e.width,d="horizontal"===i||"horizontal"===l?c:o,u=At(e,t,s),h=$t(e,s),g=Math.max(0,Math.min(h-d,u.offset)),f=Math.max(0,u.offset-d+u.size+a);switch("smart"===r&&(r=n>=f-d&&n<=g+d?"auto":"center"),r){case"start":return g;case"end":return f;case"center":return Math.round(f+(g-f)/2);default:return n>=f&&n<=g?n:n<f?f:g}},getStartIndexForOffset:function(e,t,r){return function(e,t,r){var n=t.itemMetadataMap,s=t.lastMeasuredIndex;return(s>0?n[s].offset:0)>=r?Lt(e,t,s,0,r):_t(e,t,Math.max(0,s),r)}(e,r,t)},getStopIndexForStartIndex:function(e,t,r,n){for(var s=e.direction,a=e.height,i=e.itemCount,o=e.layout,l=e.width,c="horizontal"===s||"horizontal"===o?l:a,d=At(e,t,n),u=r+c,h=d.offset+d.size,g=t;g<i-1&&h<u;)g++,h+=At(e,g,n).size;return g},initInstanceProps:function(e,t){var r={itemMetadataMap:{},estimatedItemSize:e.estimatedItemSize||50,lastMeasuredIndex:-1};return t.resetAfterIndex=function(e,n){void 0===n&&(n=!0),r.lastMeasuredIndex=Math.min(r.lastMeasuredIndex,e-1),t._getItemStyleCache(-1),n&&t.forceUpdate()},r},shouldResetStyleCacheOnItemSizeChange:!1,validateProps:function(e){e.itemSize}});const Ut=r.createContext(null);const Ht=r.createContext(null);function Xt(){const e=r.useContext(Ht);if(!e)throw new Error("useNativeDatabase must be used within NativeDatabaseProvider");return e}const zt=[];for(let d=0;d<256;++d)zt.push((d+256).toString(16).slice(1));let Vt;const Wt=new Uint8Array(16);function Bt(){if(!Vt){if("undefined"==typeof crypto||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");Vt=crypto.getRandomValues.bind(crypto)}return Vt(Wt)}const qt={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function Gt(e,t,r){if(qt.randomUUID&&!e)return qt.randomUUID();const n=(e=e||{}).random||(e.rng||Bt)();return n[6]=15&n[6]|64,n[8]=63&n[8]|128,function(e,t=0){return(zt[e[t+0]]+zt[e[t+1]]+zt[e[t+2]]+zt[e[t+3]]+"-"+zt[e[t+4]]+zt[e[t+5]]+"-"+zt[e[t+6]]+zt[e[t+7]]+"-"+zt[e[t+8]]+zt[e[t+9]]+"-"+zt[e[t+10]]+zt[e[t+11]]+zt[e[t+12]]+zt[e[t+13]]+zt[e[t+14]]+zt[e[t+15]]).toLowerCase()}(n)}const Kt=new class{config;entries=[];constructor(e={}){this.config={level:this.getDefaultLevel(),enableConsole:!0,enablePersistence:!1,maxEntries:1e3,categories:[],...e}}getDefaultLevel(){return"undefined"!=typeof process?1:3}shouldLog(e,t){return!(e>this.config.level)&&!(this.config.categories.length>0&&!this.config.categories.includes(t))}createEntry(e,t,r,n,s){return{timestamp:(new Date).toISOString(),level:e,category:t,message:r,context:n,error:s}}logEntry(e){if(this.config.enablePersistence&&(this.entries.unshift(e),this.entries.length>this.config.maxEntries&&(this.entries=this.entries.slice(0,this.config.maxEntries))),this.config.enableConsole){const t=`[${e.category}]`,r=e.context?`${e.message} ${JSON.stringify(e.context)}`:e.message;switch(e.level){case 0:console.error(t,r,e.error);break;case 1:console.warn(t,r);break;case 2:console.info(t,r);break;case 3:case 4:console.log(t,r)}}}error(e,t,r,n){this.shouldLog(0,e)&&this.logEntry(this.createEntry(0,e,t,r,n))}warn(e,t,r){this.shouldLog(1,e)&&this.logEntry(this.createEntry(1,e,t,r))}info(e,t,r){this.shouldLog(2,e)&&this.logEntry(this.createEntry(2,e,t,r))}debug(e,t,r){this.shouldLog(3,e)&&this.logEntry(this.createEntry(3,e,t,r))}trace(e,t,r){this.shouldLog(4,e)&&this.logEntry(this.createEntry(4,e,t,r))}setLevel(e){this.config.level=e}setCategories(e){this.config.categories=e}enableConsole(e){this.config.enableConsole=e}getEntries(e){return e?this.entries.slice(0,e):[...this.entries]}clearEntries(){this.entries=[]}getConfig(){return{...this.config}}},Yt=(e,t,r)=>Kt.error("bridge",e,t,r),Qt=(e,t)=>Kt.warn("bridge",e,t),Zt=(e,t)=>Kt.info("bridge",e,t),Jt=(e,t)=>Kt.debug("bridge",e,t);const er=new class{pendingRequests=new Map;messageQueue=[];isConnected=!1;connectionCheckInterval=null;cleanupInterval=null;failureCount=0;lastConnectionTest=0;circuitBreakerOpen=!1;DEFAULT_TIMEOUT=1e4;MAX_RETRIES=3;RETRY_DELAY=1e3;CONNECTION_CHECK_INTERVAL=3e4;CIRCUIT_BREAKER_THRESHOLD=5;CIRCUIT_BREAKER_RESET_TIME=6e4;MESSAGE_QUEUE_MAX_SIZE=100;constructor(){if("undefined"!=typeof window&&(window.resolveWebViewRequest=this.handleResponse.bind(this)),this.isWebViewEnvironment()&&window._isometryBridge){const e=window._isometryBridge.handleResponse;window._isometryBridge.handleResponse=t=>{this.handleResponseInternal(t),e&&e(t)}}this.cleanupInterval=setInterval(()=>this.cleanupTimedOutRequests(),3e4),this.startConnectionMonitoring(),this.testConnection().then(e=>{this.isConnected=e,e&&this.processMessageQueue()})}generateRequestId(){return Gt()}registerCallback(e,t,r,n=this.DEFAULT_TIMEOUT){const s=setTimeout(()=>{this.pendingRequests.delete(e),r(new Error(`WebView request timeout after ${n}ms: ${e}`))},n);this.pendingRequests.set(e,{resolve:t,reject:r,timeout:s,timestamp:Date.now(),retryCount:0}),Jt("Request callback registered",{requestId:e})}async postMessage(e,t,r={},n=0){if(!this.isWebViewEnvironment())throw new Error("WebView bridge not available");if(this.circuitBreakerOpen){if(!(Date.now()-this.lastConnectionTest>this.CIRCUIT_BREAKER_RESET_TIME))throw new Error("WebView bridge circuit breaker is open - service temporarily unavailable");this.circuitBreakerOpen=!1,this.failureCount=0,Zt("Circuit breaker reset, attempting reconnection")}const s=this.generateRequestId(),a={id:s,handler:e,method:t,params:r,timestamp:Date.now()};return new Promise((i,o)=>{try{if(this.registerCallback(s,i,o),!this.isConnected)return this.queueMessage(a),void Jt("Message queued due to disconnected bridge",{requestId:s});this.sendMessageImmediate(a,n)}catch(l){this.pendingRequests.delete(s),this.handleSendFailure(l,e,t,r,n,i,o)}})}handleResponse(e,t,r){const n={id:e,result:t,error:r,success:!r,timestamp:Date.now()};this.handleResponseInternal(n)}handleResponseInternal(e){const t=this.pendingRequests.get(e.id);t&&(clearTimeout(t.timeout),this.pendingRequests.delete(e.id),e.success?(this.failureCount=0,this.isConnected=!0,t.resolve(e.result)):this.handleResponseError(e,t))}isRetriableError(e){if(!e||"object"!=typeof e)return!1;const t=e,r="string"==typeof t.message?t.message.toLowerCase():"";return r.includes("timeout")||r.includes("network")||r.includes("connection")}cleanupTimedOutRequests(){const e=Date.now(),t=2*this.DEFAULT_TIMEOUT;this.pendingRequests.forEach((r,n)=>{e-r.timestamp>t&&(clearTimeout(r.timeout),this.pendingRequests.delete(n),r.reject(new Error("Request expired during cleanup")))})}getHealthStatus(){return{isConnected:this.isWebViewEnvironment(),pendingRequests:this.pendingRequests.size,environment:this.getEnvironment()}}legacyCleanup(){this.pendingRequests.forEach(e=>{clearTimeout(e.timeout),e.reject(new Error("WebView bridge cleanup - request cancelled"))}),this.pendingRequests.clear()}isWebViewEnvironment(){return"undefined"!=typeof window&&void 0!==window.webkit&&void 0!==window.webkit.messageHandlers}isHandlerAvailable(e){return!!this.isWebViewEnvironment()&&(void 0!==window.webkit.messageHandlers[e]&&"function"==typeof window.webkit.messageHandlers[e].postMessage)}getEnvironment(){return this.isWebViewEnvironment()&&window._isometryBridge?window._isometryBridge.environment:{isNative:!1,platform:"browser",version:"1.0",transport:"http-api"}}async sendMessage(e,t,r={}){if(!this.isWebViewEnvironment())throw new Error("WebView bridge not available");if(!window._isometryBridge)throw new Error("Bridge not initialized");return window._isometryBridge.sendMessage(e,t,r)}database={execute:async(e,t)=>this.postMessage("database","execute",{sql:e,params:t}),getNodes:async(e={})=>this.postMessage("database","getNodes",e),createNode:async e=>this.postMessage("database","createNode",{node:e}),updateNode:async e=>this.postMessage("database","updateNode",{node:e}),deleteNode:async e=>(await this.postMessage("database","deleteNode",{id:e})).success,search:async(e,t={})=>this.postMessage("database","search",{query:e,...t}),getGraph:async(e={})=>this.postMessage("database","getGraph",e),reset:async()=>this.postMessage("database","reset",{})};filesystem={readFile:async e=>this.postMessage("filesystem","readFile",{path:e}),writeFile:async(e,t)=>(await this.postMessage("filesystem","writeFile",{path:e,content:t})).success,deleteFile:async e=>(await this.postMessage("filesystem","deleteFile",{path:e})).success,listFiles:async e=>this.postMessage("filesystem","listFiles",{path:e}),fileExists:async e=>(await this.postMessage("filesystem","fileExists",{path:e})).exists};async waitForReady(){return this.isWebViewEnvironment()?new Promise(e=>{if(window._isometryBridge)return void e();const t=()=>{window.removeEventListener("isometry-bridge-ready",t),e()};window.addEventListener("isometry-bridge-ready",t),setTimeout(()=>{window.removeEventListener("isometry-bridge-ready",t),e()},5e3)}):Promise.resolve()}startConnectionMonitoring(){this.connectionCheckInterval&&clearInterval(this.connectionCheckInterval),this.connectionCheckInterval=setInterval(async()=>{if(this.isWebViewEnvironment()){const e=await this.testConnection();!e&&this.isConnected?(this.isConnected=!1,this.failureCount++,Qt("Connection lost, switching to queue mode"),this.failureCount>=this.CIRCUIT_BREAKER_THRESHOLD&&(this.circuitBreakerOpen=!0,this.lastConnectionTest=Date.now(),Yt("Circuit breaker opened due to repeated failures",{failureCount:this.failureCount}))):e&&!this.isConnected&&(this.isConnected=!0,this.failureCount=0,this.circuitBreakerOpen=!1,console.log("[WebView Bridge] Connection restored - processing queued messages"),this.processMessageQueue())}},this.CONNECTION_CHECK_INTERVAL)}async testConnection(){if(!this.isWebViewEnvironment())return!1;try{const e={id:this.generateRequestId(),handler:"database",method:"ping",params:{},timestamp:Date.now()},t=2e3;return new Promise(r=>{const n=setTimeout(()=>{r(!1)},t);try{window.webkit?.messageHandlers?.database?(window.webkit.messageHandlers.database.postMessage(e),s=!0,clearTimeout(n),r(null!=s)):r(!1)}catch{r(!1)}var s})}catch{return!1}}queueMessage(e){if(this.messageQueue.length>=this.MESSAGE_QUEUE_MAX_SIZE){const e=this.messageQueue.shift();if(e){const t=this.pendingRequests.get(e.id);t&&(clearTimeout(t.timeout),this.pendingRequests.delete(e.id),t.reject(new Error("Message queue overflow - message dropped")))}}this.messageQueue.push(e)}processMessageQueue(){const e=[...this.messageQueue];this.messageQueue=[],console.log(`[WebView Bridge] Processing ${e.length} queued messages`);for(const r of e)try{this.sendMessageImmediate(r,0)}catch(t){console.error(`[WebView Bridge] Failed to send queued message ${r.id}:`,t);const e=this.pendingRequests.get(r.id);e&&(clearTimeout(e.timeout),this.pendingRequests.delete(r.id),e.reject(new Error(`Failed to send queued message: ${t}`)))}}sendMessageImmediate(e,t){const r=e.handler;if(!window.webkit?.messageHandlers?.[r])throw new Error(`WebView handler '${e.handler}' not available`);try{window.webkit.messageHandlers[r].postMessage(e)}catch(n){throw this.failureCount++,this.failureCount>=this.CIRCUIT_BREAKER_THRESHOLD&&(this.circuitBreakerOpen=!0,this.lastConnectionTest=Date.now()),n}}handleSendFailure(e,t,r,n,s,a,i){if(s<this.MAX_RETRIES&&this.isRetriableError(e)){const e=this.RETRY_DELAY*Math.pow(2,s),o=.1*Math.random()*e;return void setTimeout(()=>{this.postMessage(t,r,n,s+1).then(a).catch(i)},e+o)}i(e instanceof Error?e:new Error(`Failed to send message: ${e}`))}handleResponseError(e,t){const r=new Error(e.error||"Unknown bridge error");if(t.retryCount<this.MAX_RETRIES&&this.isRetriableError(r)){t.retryCount++,this.failureCount++;const r=this.generateRequestId();this.pendingRequests.set(r,{...t,timeout:setTimeout(()=>{this.pendingRequests.delete(r),t.reject(new Error(`WebView request timeout after retry: ${r}`))},this.DEFAULT_TIMEOUT)}),console.log(`[WebView Bridge] Retrying request ${e.id} as ${r} (attempt ${t.retryCount})`)}else t.reject(r)}cleanup(){this.connectionCheckInterval&&(clearInterval(this.connectionCheckInterval),this.connectionCheckInterval=null),this.cleanupInterval&&(clearInterval(this.cleanupInterval),this.cleanupInterval=null),this.messageQueue=[],this.pendingRequests.forEach(e=>{clearTimeout(e.timeout),e.reject(new Error("WebView bridge cleanup - request cancelled"))}),this.pendingRequests.clear(),this.isConnected=!1,this.circuitBreakerOpen=!1,this.failureCount=0}},tr={isWebView:()=>er.isWebViewEnvironment(),isBrowser:()=>!er.isWebViewEnvironment(),info:()=>er.getEnvironment(),getTransport:()=>er.isWebViewEnvironment()?"webview-bridge":"http-api"},rr=r.createContext(null);var nr={},sr=(e=>(e.HTTP_API="http-api",e.WEBVIEW_BRIDGE="webview-bridge",e.AUTO="auto",e))(sr||{});const ar=r.createContext(null);function ir({children:t,forcedMode:n,enableAutoDetection:s=!0}){const[a,i]=r.useState({mode:"http-api",capabilities:g("http-api"),platform:"browser",version:"1.0",isNative:!1,performanceProfile:"medium"}),[o,l]=r.useState(!0),[c,d]=r.useState(null),u=async()=>{if(!tr.isWebView())return!1;try{return null!==await tr.postMessage("database","ping",{})}catch(e){return console.warn("WebView bridge test failed:",e),!1}},h=async()=>{if(tr.isWebView())return!1;try{const e=nr.REACT_APP_API_URL||"http://localhost:8080";return(await fetch(`${e}/health`,{method:"GET",timeout:2e3})).ok}catch(e){return console.warn("HTTP API test failed:",e),!1}};function g(e){return"webview-bridge"===e?{canReadFiles:!0,canWriteFiles:!0,hasRealTimeSync:!0,supportsOffline:!0,hasNativeExport:!0,hasCloudSync:!0}:{canReadFiles:!1,canWriteFiles:!1,hasRealTimeSync:!1,supportsOffline:!1,hasNativeExport:!1,hasCloudSync:!0}}function f(e){return"webview-bridge"===e?"fast":"medium"}const p=e=>{const t=tr.info();return{mode:e,capabilities:g(e),platform:t.platform,version:t.version,isNative:t.isNative,performanceProfile:f(e)}},m=async()=>{if(s||n){l(!0),d(null);try{const e=await(async()=>{try{return n&&"auto"!==n?n:await u()?(console.log("Environment: WebView bridge detected"),"webview-bridge"):await h()?(console.log("Environment: HTTP API detected"),"http-api"):(console.log("Environment: Falling back to HTTP API"),"http-api")}catch(e){return console.warn("Environment detection failed:",e),"http-api"}})(),t=p(e);i(t),console.log(`Environment initialized: ${e}`,t)}catch(e){const t=e instanceof Error?e.message:"Environment detection failed";d(t),console.error("Environment initialization failed:",e),i(p("http-api"))}finally{l(!1)}}};r.useEffect(()=>{m()},[n,s]);const b={environment:a,isLoading:o,error:c,forceMode:e=>{"auto"===e?m():i(p(e))},refreshEnvironment:async()=>{await m()},testConnection:async()=>"webview-bridge"===a.mode?u():h()};return e.jsx(ar.Provider,{value:b,children:t})}function or(){const{environment:e}=function(){const e=r.useContext(ar);if(!e)throw new Error("useEnvironment must be used within EnvironmentProvider");return e}();switch(e.mode){case sr.WEBVIEW_BRIDGE:return function(){const e=r.useContext(rr);if(!e)throw new Error("useWebViewDatabase must be used within WebViewDatabaseProvider");return e}();case sr.HTTP_API:default:return Xt()}}function lr(e){return{id:e.id,nodeType:e.node_type,name:e.name,content:e.content,summary:e.summary,latitude:e.latitude,longitude:e.longitude,locationName:e.location_name,locationAddress:e.location_address,createdAt:e.created_at,modifiedAt:e.modified_at,dueAt:e.due_at,completedAt:e.completed_at,eventStart:e.event_start,eventEnd:e.event_end,folder:e.folder,tags:e.tags?JSON.parse(e.tags):[],status:e.status,priority:e.priority??0,importance:e.importance??0,sortOrder:e.sort_order??0,source:e.source,sourceId:e.source_id,sourceUrl:e.source_url,deletedAt:e.deleted_at,version:e.version??1}}class cr{patterns=new Map;performanceThresholds={maxSimpleRows:1e3,maxComplexityScore:10,minConfidence:.8};constructor(){this.initializePatterns()}initializePatterns(){this.patterns.set(/SELECT\s+\*\s+FROM\s+nodes\s+WHERE.*deleted_at\s+IS\s+NULL/i,"select_nodes"),this.patterns.set(/SELECT\s+\*\s+FROM\s+nodes\s+WHERE.*folder\s*=\s*\?/i,"select_nodes"),this.patterns.set(/SELECT\s+\*\s+FROM\s+notebook_cards.*ORDER\s+BY\s+modified_at/i,"select_notebook_cards"),this.patterns.set(/SELECT.*FROM.*MATCH\s*\(/i,"select_search"),this.patterns.set(/INSERT\s+INTO\s+nodes/i,"insert"),this.patterns.set(/UPDATE\s+nodes\s+SET.*WHERE\s+id\s*=\s*\?/i,"update"),this.patterns.set(/DELETE\s+FROM\s+nodes\s+WHERE\s+id\s*=\s*\?/i,"delete")}analyzeQuery(e,t=[]){const r=e.trim().replace(/\s+/g," "),n=[];let s="simple";for(const[u,h]of this.patterns)u.test(r)&&n.push({type:h,confidence:this.calculateConfidence(r,h),...this.extractPatternDetails(r,h,t)});const a=/\bJOIN\b/i.test(r),i=/\bMATCH\b/i.test(r),o=/\(\s*SELECT/i.test(r),l=/\bOVER\s*\(/i.test(r),c=/\bWITH\s+RECURSIVE/i.test(r);(a||o||l||c)&&(s="complex");const d=this.estimateResultSize(r,t);return{sql:r,params:t,patterns:n,complexity:s,canOptimize:this.shouldOptimize({sql:r,params:t,patterns:n,complexity:s,canOptimize:!1,estimatedRows:d,hasJoins:a,hasFTS:i}),estimatedRows:d,hasJoins:a,hasFTS:i}}shouldOptimize(e){if("complex"===e.complexity)return!1;const t=e.patterns.reduce((e,t)=>t.confidence>(e?.confidence||0)?t:e,null);return!(!t||t.confidence<this.performanceThresholds.minConfidence)&&(!(e.estimatedRows>this.performanceThresholds.maxSimpleRows)&&(!!e.hasFTS||["select_nodes","select_notebook_cards","insert","update","delete"].includes(t.type)))}translateToEndpoint(e){if(!e.canOptimize)return null;const t=e.patterns.reduce((e,t)=>t.confidence>(e?.confidence||0)?t:e,null);if(!t)return null;switch(t.type){case"select_nodes":return this.buildNodesEndpoint(e,t);case"select_notebook_cards":return this.buildNotebookCardsEndpoint(e,t);case"select_search":return this.buildSearchEndpoint(e,t);case"insert":return this.buildInsertEndpoint(e,t);case"update":return this.buildUpdateEndpoint(e,t);case"delete":return this.buildDeleteEndpoint(e,t);default:return null}}fallbackToSQL(e,t=[]){return{type:"sql",sql:e,params:t}}calculateConfidence(e,t){let r=.5;switch(t){case"select_nodes":e.includes("deleted_at IS NULL")&&(r+=.3),e.includes("ORDER BY modified_at")&&(r+=.2);break;case"select_notebook_cards":e.includes("notebook_cards")&&(r+=.4),e.includes("ORDER BY")&&(r+=.1);break;case"select_search":e.includes("MATCH(")&&(r+=.4),e.includes("fts_")&&(r+=.1);break;case"insert":case"update":case"delete":r+=.3}return Math.min(r,1)}extractPatternDetails(e,t,r){const n={type:t},s=e.match(/FROM\s+(\w+)/i);s&&(n.table=s[1]),e.includes("folder =")&&r.length>0&&(n.filters={folder:r[0]});const a=e.match(/ORDER\s+BY\s+([\w_]+)/i);a&&(n.orderBy=a[1]);const i=e.match(/LIMIT\s+(\d+)/i);return i&&(n.limit=parseInt(i[1],10)),n}calculateComplexityScore(e){let t=0;return/\bJOIN\b/i.test(e)&&(t+=3),/\bUNION\b/i.test(e)&&(t+=2),/\(\s*SELECT/i.test(e)&&(t+=3),/\bWITH\b/i.test(e)&&(t+=4),/\bOVER\s*\(/i.test(e)&&(t+=3),/\bCASE\s+WHEN/i.test(e)&&(t+=1),t}estimateResultSize(e,t){if(e.includes("LIMIT")){const t=e.match(/LIMIT\s+(\d+)/i);return t?parseInt(t[1],10):100}return e.includes("WHERE id =")?1:e.includes("WHERE folder =")?50:e.includes("MATCH(")?25:100}buildNodesEndpoint(e,t){const r=new URLSearchParams;t.filters?.folder&&r.set("folder",String(t.filters.folder)),t.orderBy&&r.set("sort",t.orderBy),t.limit&&r.set("limit",String(t.limit));return{type:"endpoint",method:"GET",url:"/api/nodes"+(r.toString()?"?"+r.toString():""),expectedFormat:"rows"}}buildNotebookCardsEndpoint(e,t){const r=new URLSearchParams;t.filters?.folder&&r.set("folder",String(t.filters.folder)),t.orderBy&&r.set("sort",t.orderBy),t.limit&&r.set("limit",String(t.limit));return{type:"endpoint",method:"GET",url:"/api/notebook-cards"+(r.toString()?"?"+r.toString():""),expectedFormat:"rows"}}buildSearchEndpoint(e,t){const r=e.sql.match(/MATCH\s*\(\s*(['"])(.*?)\1\s*\)/i),n=r?r[2]:e.params[0]?.toString()||"",s=new URLSearchParams;return s.set("q",n),t.limit&&s.set("limit",String(t.limit)),{type:"endpoint",method:"GET",url:`/api/search?${s.toString()}`,expectedFormat:"rows"}}buildInsertEndpoint(e,t){return{type:"endpoint",method:"POST",url:`/api/${t.table}`,body:this.extractInsertData(e),expectedFormat:"json"}}buildUpdateEndpoint(e,t){const r=this.extractIdFromParams(e.params);return{type:"endpoint",method:"PUT",url:`/api/${t.table}/${r}`,body:this.extractUpdateData(e),expectedFormat:"json"}}buildDeleteEndpoint(e,t){const r=this.extractIdFromParams(e.params);return{type:"endpoint",method:"DELETE",url:`/api/${t.table}/${r}`,expectedFormat:"json"}}extractInsertData(e){return Object.fromEntries(e.params.map((e,t)=>[`field_${t}`,e]))}extractUpdateData(e){const t=e.params.slice(0,-1);return Object.fromEntries(t.map((e,t)=>[`field_${t}`,e]))}extractIdFromParams(e){return String(e[e.length-1]||"")}}new cr;const dr=r.createContext(null);function ur(e,t){const{register:n}=function(){const e=r.useContext(dr);if(!e)throw new Error("useCacheInvalidation must be used within CacheInvalidationProvider");return e}(),s=r.useRef(refetch),a=r.useRef(null),i=r.useRef("");s.current=refetch;const o=r.useCallback(()=>{s.current()},[]),l=JSON.stringify(e.slice().sort());i.current!==l&&(a.current&&(a.current(),a.current=null),e.length>0&&(a.current=n(e,o)),i.current=l),r.useEffect(()=>()=>{a.current&&(a.current(),a.current=null)},[])}const hr=()=>["nodes"];function gr(e,t=[],n={}){const{execute:s,loading:a,error:i}=or(),{enabled:o=!0,transform:l,cacheTags:c}=n,[d,u]=r.useState(null),[h,g]=r.useState(!0),[f,p]=r.useState(null),[m,b]=r.useState(!1),[x,y]=r.useState(0),v=r.useRef(l);v.current=l;const w=r.useMemo(()=>JSON.stringify(t),[t]),T=r.useCallback(async()=>{if(!o||a)return;g(!0),p(null),b(!1),y(0);const r=performance.now();try{let n,a=!1;n=s(e,t);const i=performance.now()-r,o=v.current?v.current(n):n;u(o),b(a),y(i)}catch(n){p(n),u(null)}finally{g(!1)}},[s,e,w,o,a]);return ur(r.useMemo(()=>c||[],[c])),r.useEffect(()=>{T()},[T]),{data:d,loading:h||a,error:f||i,refetch:T,optimized:m,duration:x}}const fr=e=>e.map(lr);function pr(){const{filters:e}=ht(),{whereClause:t,params:n}=r.useMemo(()=>{if(0===e.length)return{whereClause:"1=1",params:[]};const t=[],r=[];return e.forEach(e=>{const n=e.field,s=e.operator,a=e.value;switch(s){case"=":default:t.push(`${n} = ?`),r.push(a);break;case"!=":t.push(`${n} != ?`),r.push(a);break;case">":t.push(`${n} > ?`),r.push(a);break;case"<":t.push(`${n} < ?`),r.push(a);break;case"contains":t.push(`${n} LIKE ?`),r.push(`%${a}%`)}}),{whereClause:t.join(" AND "),params:r}},[e]);return function(e="1=1",t=[],n={}){const s=r.useMemo(()=>`\n    SELECT * FROM nodes\n    WHERE ${e} AND deleted_at IS NULL\n    ORDER BY modified_at DESC\n  `,[e]),a=r.useMemo(()=>n.cacheTags||hr(),[n.cacheTags]);return gr(s,t,{...n,transform:fr,cacheTags:a})}(r.useMemo(()=>t.replace(/^deleted_at IS NULL\s*(AND\s*)?/i,"").replace(/\s*AND\s*deleted_at IS NULL$/i,"").trim()||"1=1",[t]),n)}function mr(e=!0){const{state:t}=function(){const e=r.useContext(Ut);if(!e)throw new Error("usePAFV must be used within PAFVProvider");return e}(),n=r.useMemo(()=>t.mappings.find(e=>"y"===e.plane),[t.mappings]),s=n?.axis??null,a=n?.facet??null,{data:i,loading:o,error:l}=pr(),c=r.useMemo(()=>{if(!i||!s||!a)return i??[];const e=[...i];switch(s){case"time":"year"===a?e.sort((e,t)=>{const r=new Date(e.createdAt).getFullYear();return new Date(t.createdAt).getFullYear()-r}):"month"===a?e.sort((e,t)=>{const r=new Date(e.createdAt);return new Date(t.createdAt).getTime()-r.getTime()}):e.sort((e,t)=>new Date(t.createdAt).getTime()-new Date(e.createdAt).getTime());break;case"category":"folder"===a?e.sort((e,t)=>(e.folder??"").localeCompare(t.folder??"")):"tag"===a?e.sort((e,t)=>{const r=e.tags[0]??"",n=t.tags[0]??"";return r.localeCompare(n)}):"status"===a&&e.sort((e,t)=>(e.status??"").localeCompare(t.status??""));break;case"alphabet":e.sort((e,t)=>e.name.localeCompare(t.name));break;case"hierarchy":"priority"===a?e.sort((e,t)=>e.priority-t.priority):"importance"===a&&e.sort((e,t)=>t.importance-e.importance);break;case"location":e.sort((e,t)=>(e.locationName??"").localeCompare(t.locationName??""));break;default:e.sort((e,t)=>new Date(t.modifiedAt).getTime()-new Date(e.modifiedAt).getTime())}return e},[i,s,a]),d=r.useMemo(()=>{if(!(e&&c.length&&s&&a))return null;const t=new Map;return c.forEach(e=>{let r="Uncategorized";switch(s){case"time":if("year"===a)r=new Date(e.createdAt).getFullYear().toString();else if("month"===a){const t=new Date(e.createdAt);r=`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}`}else r=new Date(e.createdAt).toISOString().split("T")[0];break;case"category":"folder"===a?r=e.folder??"Uncategorized":"tag"===a?r=e.tags[0]??"Untagged":"status"===a&&(r=e.status??"No Status");break;case"alphabet":r=e.name.charAt(0).toUpperCase();break;case"hierarchy":"priority"===a?r=`Priority ${e.priority}`:"importance"===a&&(r=`Importance ${e.importance}`);break;case"location":r=e.locationName??"No Location"}t.has(r)||t.set(r,[]),t.get(r).push(e)}),Array.from(t.entries()).map(([e,t])=>({key:e,label:e,nodes:t})).sort((e,t)=>"time"===s&&"year"===a?t.key.localeCompare(e.key):e.key.localeCompare(t.key))},[c,e,s,a]);return{groups:d,flatNodes:c,sortAxis:s,sortFacet:a,isGrouped:e&&null!==d,loading:o,error:l}}const br=r.createContext(null);const xr=r.memo(function({node:t,onClick:r,isSelected:n=!1}){const o=()=>{r?.(t)},l=t.content?t.content.substring(0,100)+(t.content.length>100?"...":""):t.summary?t.summary.substring(0,100)+(t.summary.length>100?"...":""):"",c=new Date(t.createdAt).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"});return e.jsxs("div",{onClick:o,className:`\n        list-item\n        px-4 py-3\n        border-b border-gray-200 dark:border-gray-700\n        hover:bg-gray-50 dark:hover:bg-gray-800\n        cursor-pointer\n        transition-colors\n        ${n?"bg-blue-50 dark:bg-blue-900/20 border-l-4 border-l-blue-500":""}\n      `,role:"button",tabIndex:0,"aria-label":`Open ${t.name}`,onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),o())},children:[e.jsxs("div",{className:"flex items-start justify-between gap-4 mb-1",children:[e.jsx("h3",{className:"font-medium text-sm text-gray-900 dark:text-gray-100 flex-1 truncate",children:t.name}),e.jsxs("div",{className:"flex items-center gap-1 text-xs text-gray-500 dark:text-gray-400 flex-shrink-0",children:[e.jsx(s,{size:12}),e.jsx("span",{children:c})]})]}),l&&e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 mb-2 line-clamp-2",children:l}),e.jsxs("div",{className:"flex items-center gap-3 text-xs text-gray-500 dark:text-gray-400",children:[t.folder&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(a,{size:12}),e.jsx("span",{children:t.folder})]}),t.tags.length>0&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(i,{size:12}),e.jsx("span",{children:t.tags.slice(0,3).join(", ")}),t.tags.length>3&&e.jsxs("span",{children:["+",t.tags.length-3]})]}),t.priority>0&&e.jsxs("div",{className:"px-1.5 py-0.5 bg-gray-200 dark:bg-gray-700 rounded text-xs font-medium",children:["P",t.priority]}),t.status&&e.jsx("div",{className:`\n              px-1.5 py-0.5 rounded text-xs font-medium\n              ${"completed"===t.status?"bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-300":"active"===t.status?"bg-blue-100 dark:bg-blue-900/30 text-blue-800 dark:text-blue-300":"bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-300"}\n            `,children:t.status})]})]})});function yr({data:t,onNodeClick:n}){const{selection:s,select:a}=function(){const e=r.useContext(br);if(!e)throw new Error("useSelection must be used within SelectionProvider");return e}(),i=r.useRef(null),[d,u]=r.useState(""),[h,g]=r.useState(!1),[f,p]=r.useState(!0),m=mr(f),b=t?{groups:null,flatNodes:t,sortAxis:null,sortFacet:null,isGrouped:!1,loading:!1,error:null}:m,x=r.useMemo(()=>{if(!d.trim())return b.flatNodes;const e=d.toLowerCase();return b.flatNodes.filter(t=>t.name.toLowerCase().includes(e)||t.content?.toLowerCase().includes(e)||t.summary?.toLowerCase().includes(e)||t.tags.some(t=>t.toLowerCase().includes(e)))},[b.flatNodes,d]),y=r.useMemo(()=>{const e=[...x];return h&&e.reverse(),e},[x,h]),v=r.useMemo(()=>{if(!b.isGrouped||!b.groups)return y.map(e=>({type:"node",node:e,groupKey:null}));const e=[];return b.groups.forEach(t=>{const r=t.nodes.filter(e=>x.includes(e));0!==r.length&&(e.push({type:"group",groupKey:t.key,label:t.label,count:r.length}),r.forEach(r=>{e.push({type:"node",node:r,groupKey:t.key})}))}),e},[b,y,x]),w=r.useCallback(e=>{a(e.id),n?.(e)},[a,n]);r.useEffect(()=>{i.current&&i.current.scrollToItem(0,"start")},[d]);return b.loading?e.jsx("div",{className:"list-view flex items-center justify-center h-full w-full bg-white dark:bg-gray-900",children:e.jsx("div",{className:"text-gray-500 dark:text-gray-400",children:"Loading filtered notes..."})}):b.error?e.jsx("div",{className:"list-view flex items-center justify-center h-full w-full bg-white dark:bg-gray-900",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-red-600 dark:text-red-400 font-medium mb-2",children:"Error loading notes"}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:b.error.message})]})}):e.jsxs("div",{className:"list-view flex flex-col h-full w-full bg-white dark:bg-gray-900",children:[e.jsxs("div",{className:"search-controls flex items-center gap-3 px-4 py-3 border-b border-gray-200 dark:border-gray-700",style:{height:60},children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(o,{size:16,className:"text-gray-400"})}),e.jsx("input",{type:"text",value:d,onChange:e=>u(e.target.value),placeholder:"Search by title, content, or tags...",className:"w-full pl-10 pr-10 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100"}),d&&e.jsx("button",{onClick:()=>{u("")},className:"absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-600 dark:hover:text-gray-200","aria-label":"Clear search",children:e.jsx(l,{size:16})})]}),e.jsxs("button",{onClick:()=>{g(!h)},className:"flex items-center gap-2 px-3 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-800 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-md transition-colors","aria-label":"Sort "+(h?"descending":"ascending"),children:[e.jsx(c,{size:16}),e.jsx("span",{children:h?"":""})]}),e.jsx("button",{onClick:()=>p(!f),className:"px-3 py-2 text-sm font-medium rounded-md transition-colors "+(f?"bg-blue-100 dark:bg-blue-900/30 text-blue-800 dark:text-blue-300":"bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700"),"aria-label":(f?"Disable":"Enable")+" grouping",children:f?"Grouped":"Flat"})]}),e.jsx("div",{className:"flex-1",children:0===v.length?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-gray-500 dark:text-gray-400",children:[e.jsx("p",{className:"text-lg font-medium mb-2",children:"No notes match these filters"}),e.jsx("p",{className:"text-sm",children:"Try adjusting your filter criteria or clearing all filters"})]}):e.jsx(Ft,{ref:i,height:window.innerHeight-60-100,itemCount:v.length,itemSize:e=>"group"===v[e].type?44:100,width:"100%",overscanCount:5,children:({index:t,style:r})=>{const n=v[t];return"group"===n.type?e.jsx("div",{style:r,children:e.jsx("div",{className:"px-4 py-3 bg-gray-100 dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"font-semibold text-sm text-gray-900 dark:text-gray-100",children:n.label}),e.jsx("span",{className:"px-2 py-0.5 text-xs font-medium text-gray-600 dark:text-gray-400 bg-gray-200 dark:bg-gray-700 rounded",children:n.count})]})})}):e.jsx("div",{style:r,children:e.jsx(xr,{node:n.node,onClick:w,isSelected:s.selectedIds.has(n.node.id)})})}})})]})}const vr={folder:"folder",subfolder:"status",tags:"folder",year:"createdAt",month:"createdAt",category:"folder",status:"status",priority:"priority"};function wr(e,t){const r=vr[t]||"folder",n=e[r];if("createdAt"===r&&n){if("year"===t)return new Date(n).getFullYear().toString();if("month"===t)return new Date(n).toLocaleString("default",{month:"short"})}return String(n??"Unknown")}function Tr(e,t){return t.map(t=>wr(e,t.id)).join("|")}function Sr(e,t){if(0===t.length)return{label:"",depth:0,span:1,children:[],path:[]};const r={label:"root",depth:-1,span:0,children:[],path:[]},n=new Map;return e.forEach(e=>{const r=t.map(t=>wr(e,t.id));n.set(r.join("|"),!0)}),Array.from(n.keys()).forEach(e=>{const t=e.split("|");let n=r;t.forEach((e,r)=>{const s=t.slice(0,r+1);let a=n.children.find(t=>t.label===e);a||(a={label:e,depth:r,span:0,children:[],path:s},n.children.push(a)),n=a})}),function e(t){return 0===t.children.length?t.span=1:t.span=t.children.reduce((t,r)=>t+e(r),0),t.span}(r),function e(t){t.children.sort((e,t)=>e.label.localeCompare(t.label)),t.children.forEach(e)}(r),r}function Er(e){const t=[];return function e(r,n){0===r.children.length&&"root"!==r.label?t.push(n):r.children.forEach(t=>e(t,[...n,t.label]))}(e,[]),t}function Nr(e,t){const r=[];for(let n=0;n<t;n++)r.push([]);return function e(n,s,a){s>=0&&s<t&&r[s].push({label:n.label,span:n.span,depth:s,startCol:a});let i=a;return n.children.forEach(t=>{i=e(t,s+1,i)}),s>=0?a+n.span:i}(e,-1,1),r}function Cr({data:t,onNodeClick:n}){const{theme:s}=Ze(),{wells:a}=mt(),i=a.columns.length>0?a.columns:[{id:"year",label:"Year",hasCheckbox:!1}],o=a.rows.length>0?a.rows:[{id:"folder",label:"Folder",hasCheckbox:!1}],{colLeafPaths:l,rowLeafPaths:c,grouped:d,colLevels:u,rowLevels:h}=r.useMemo(()=>{const e=Sr(t,i),r=Sr(t,o),n=Er(e),s=Er(r),a=Nr(e,i.length),l=Nr(r,o.length),c=new Map;return t.forEach(e=>{const t=`${Tr(e,i)}||${Tr(e,o)}`;c.has(t)||c.set(t,[]),c.get(t).push(e)}),{colLeafPaths:n,rowLeafPaths:s,grouped:c,colLevels:a,rowLevels:l}},[t,i,o]),g=o.length,f=i.length,p=l.length||1,m=c.length||1,b="NeXTSTEP"===s?"bg-[#e8e8e8]":"bg-gray-100",x="NeXTSTEP"===s?"border-[#a0a0a0]":"border-gray-300",y="NeXTSTEP"===s?"border-[#c0c0c0]":"border-gray-200",v=80*g;return e.jsx("div",{className:"w-full h-full overflow-auto",children:e.jsxs("div",{className:"grid",style:{gridTemplateColumns:`repeat(${g}, 80px) repeat(${p}, minmax(100px, 1fr))`,gridTemplateRows:`repeat(${f}, 28px) repeat(${m}, minmax(40px, 1fr))`,minWidth:v+100*p},children:[g>0&&f>0&&e.jsx("div",{className:`${b} border ${x}`,style:{gridColumn:`1 / ${g+1}`,gridRow:`1 / ${f+1}`}}),u.map((t,r)=>t.map((t,n)=>e.jsx("div",{className:`${b} border ${x} flex items-center justify-center text-sm font-medium px-2 truncate`,style:{gridColumn:`${g+t.startCol} / span ${t.span}`,gridRow:r+1},title:t.label,children:t.label},`col-${r}-${n}-${t.label}`))),h.map((t,r)=>t.map((t,n)=>e.jsx("div",{className:`${b} border ${x} flex items-center justify-center text-sm font-medium px-2 truncate`,style:{gridColumn:r+1,gridRow:`${f+t.startCol} / span ${t.span}`},title:t.label,children:t.label},`row-${r}-${n}-${t.label}`))),l.map((t,r)=>c.map((a,i)=>{const o=t.join("|"),l=a.join("|"),c=d.get(`${o}||${l}`)||[];return e.jsx("div",{className:`bg-white border ${y} p-1 overflow-hidden`,style:{gridColumn:g+r+1,gridRow:f+i+1},children:1===c.length?e.jsx("div",{className:"w-full h-full flex items-center justify-center cursor-pointer hover:bg-gray-50 text-sm "+("NeXTSTEP"===s?"hover:bg-[#f0f0f0]":""),onClick:()=>n?.(c[0]),title:c[0].name,children:e.jsx("span",{className:"truncate px-1",children:c[0].name})}):c.length>1?e.jsxs("div",{className:"w-full h-full flex flex-col gap-0.5 overflow-auto",children:[c.slice(0,3).map(t=>e.jsx("div",{className:"flex-shrink-0 px-2 py-1 text-xs cursor-pointer truncate rounded "+("NeXTSTEP"===s?"bg-[#e8e8e8] hover:bg-[#d8d8d8] border border-[#c0c0c0]":"bg-gray-50 hover:bg-gray-100 border border-gray-200"),onClick:()=>n?.(t),title:t.name,children:t.name},t.id)),c.length>3&&e.jsxs("div",{className:"text-xs text-gray-400 text-center",children:["+",c.length-3," more"]})]}):null},`cell-${r}-${i}`)}))]})})}const jr=["active","pending","completed","archived"];function Dr({data:t,groupBy:n="status",onNodeClick:s}){const a=r.useRef(null),{theme:i}=Ze(),{columns:o,grouped:l}=r.useMemo(()=>{const e=new Map;t.forEach(t=>{let r;r="status"===n?t.status||"Unknown":"folder"===n?t.folder||"Unknown":String(t.priority),e.has(r)||e.set(r,[]),e.get(r).push(t)});const r=Array.from(e.keys());return"status"===n?r.sort((e,t)=>{const r=jr.indexOf(e.toLowerCase()),n=jr.indexOf(t.toLowerCase());return(-1===r?999:r)-(-1===n?999:n)}):"priority"===n?r.sort((e,t)=>Number(e)-Number(t)):r.sort(),{columns:r,grouped:e}},[t,n]);return r.useEffect(()=>{if(!a.current)return;const e=M(a.current),t=Math.max(200,Math.min(280,a.current.clientWidth/o.length-16)),r=e.selectAll(".kanban-column").data(o,e=>e).join(e=>e.append("div").attr("class","kanban-column").style("opacity",0).call(e=>e.transition().duration(300).style("opacity",1)),e=>e,e=>e.transition().duration(200).style("opacity",0).remove());r.attr("class","kanban-column flex-shrink-0 "+("NeXTSTEP"===i?"bg-[#c0c0c0] border-2 border-[#808080]":"bg-gray-50 rounded-lg border border-gray-200")).style("width",`${t}px`).style("min-height","200px").style("display","flex").style("flex-direction","column"),r.each(function(e){const t=M(this),r=l.get(e)||[];t.selectAll("*").remove(),t.append("div").attr("class","px-3 py-2 font-medium text-sm "+("NeXTSTEP"===i?"bg-[#a8a8a8] border-b-2 border-[#707070]":"bg-gray-100 border-b border-gray-200 rounded-t-lg")).html(`\n          <div class="flex items-center justify-between">\n            <span>${e}</span>\n            <span class="text-xs ${"NeXTSTEP"===i?"text-[#505050]":"text-gray-400"}">${r.length}</span>\n          </div>\n        `);const a=t.append("div").attr("class","flex-1 p-2 space-y-2 overflow-y-auto").style("max-height","400px").selectAll(".kanban-node").data(r,e=>e.id).join(e=>e.append("div").attr("class","kanban-node").style("opacity",0).call(e=>e.transition().duration(200).style("opacity",1)),e=>e,e=>e.transition().duration(150).style("opacity",0).remove());a.attr("class","kanban-node cursor-pointer "+("NeXTSTEP"===i?"bg-[#d4d4d4] border-t-2 border-l-2 border-[#ffffff] border-b-2 border-r-2 border-b-[#707070] border-r-[#707070]":"bg-white rounded-lg shadow-sm border border-gray-200 hover:shadow-md transition-shadow")).style("padding","8px 10px").on("click",(e,t)=>s?.(t)),a.each(function(e){const t=M(this);t.selectAll("*").remove(),t.append("div").attr("class","font-medium text-sm mb-1 truncate").attr("title",e.name).text(e.name),e.content&&t.append("div").attr("class","text-xs mb-2 line-clamp-2 "+("NeXTSTEP"===i?"text-[#404040]":"text-gray-500")).text(e.content.slice(0,80)+(e.content.length>80?"...":""));const r=t.append("div").attr("class","flex items-center gap-2");"folder"!==n&&e.folder&&r.append("span").attr("class","px-1.5 py-0.5 text-xs rounded "+("NeXTSTEP"===i?"bg-[#a0a0a0]":"bg-blue-100 text-blue-700")).text(e.folder),r.append("span").attr("class","ml-auto text-xs "+("NeXTSTEP"===i?"text-[#505050]":"text-gray-400")).text(`P${e.priority}`)})})},[o,l,i,n,s]),e.jsx("div",{ref:a,className:"flex gap-4 p-4 overflow-x-auto h-full items-start"})}function Ir({data:t,dateField:n="createdAt",onNodeClick:s}){const a=r.useRef(null),i=r.useRef(null),{theme:o}=Ze(),l=r.useMemo(()=>t.map(e=>({...e,date:e[n]?new Date(e[n]):null})).filter(e=>e.date&&!isNaN(e.date.getTime())).sort((e,t)=>e.date.getTime()-t.date.getTime()),[t,n]);return r.useEffect(()=>{if(!a.current||!i.current||!l.length)return;const e=i.current,t=e.clientWidth,r=e.clientHeight,n=40,c=40,d=60,u=60,h=M(a.current);h.selectAll("*").remove();const g=l.map(e=>e.date),f=A().domain([L(g),_(g)]).range([u,t-c]).nice(),p=Array.from(new Set(l.map(e=>e.folder||"Uncategorized"))),m=$().domain(p).range([n,r-d]).padding(.2),b=F().domain(p).range("NeXTSTEP"===o?["#808080","#606060","#a0a0a0","#707070","#909090"]:U),x=h.attr("width",t).attr("height",r).append("g"),y=H().scaleExtent([.5,10]).on("zoom",e=>{const r=e.transform.rescaleX(f);v.call(X(r).tickFormat(z("%b %d"))),T.attr("transform",e=>`translate(${r(e.date)},${m(e.folder||"Uncategorized")+m.bandwidth()/2})`),x.selectAll(".timeline-line").attr("x1",u).attr("x2",t-c)});h.call(y);const v=x.append("g").attr("class","x-axis").attr("transform",`translate(0,${r-d})`).call(X(f).tickFormat(z("%b %d")));v.selectAll("text").attr("fill","NeXTSTEP"===o?"#404040":"#6b7280"),v.selectAll("line, path").attr("stroke","NeXTSTEP"===o?"#808080":"#d1d5db");const w=x.append("g").attr("class","y-axis").attr("transform",`translate(${u},0)`).call(V(m));w.selectAll("text").attr("fill","NeXTSTEP"===o?"#404040":"#6b7280"),w.selectAll("line, path").attr("stroke","NeXTSTEP"===o?"#808080":"#d1d5db"),x.append("g").attr("class","swim-lanes").selectAll("line").data(p).join("line").attr("class","timeline-line").attr("x1",u).attr("x2",t-c).attr("y1",e=>m(e)+m.bandwidth()/2).attr("y2",e=>m(e)+m.bandwidth()/2).attr("stroke","NeXTSTEP"===o?"#d0d0d0":"#e5e7eb").attr("stroke-width",1).attr("stroke-dasharray","4,4");const T=x.append("g").attr("class","nodes").selectAll("g").data(l,e=>e.id).join("g").attr("class","node").attr("transform",e=>`translate(${f(e.date)},${m(e.folder||"Uncategorized")+m.bandwidth()/2})`).style("cursor","pointer").on("click",(e,t)=>{e.stopPropagation(),s?.(t)});T.append("circle").attr("r",e=>6+1.5*(6-e.priority)).attr("fill",e=>b(e.folder||"Uncategorized")).attr("stroke","NeXTSTEP"===o?"#404040":"#6b7280").attr("stroke-width",1.5),T.append("text").attr("dy",-12).attr("text-anchor","middle").attr("class","text-xs font-medium").attr("fill","NeXTSTEP"===o?"#404040":"#374151").text(e=>e.name.length>15?e.name.slice(0,15)+"...":e.name),T.on("mouseenter",function(){M(this).select("circle").transition().duration(150).attr("stroke-width",3)}).on("mouseleave",function(){M(this).select("circle").transition().duration(150).attr("stroke-width",1.5)});const S=M(i.current).append("div").attr("class","absolute hidden px-2 py-1 text-xs rounded shadow-lg pointer-events-none "+("NeXTSTEP"===o?"bg-[#c0c0c0] border border-black":"bg-gray-800 text-white")).style("z-index","50");return T.on("mouseenter",function(e,t){M(this).select("circle").transition().duration(150).attr("stroke-width",3);const r=t.date.toLocaleDateString();S.html(`<strong>${t.name}</strong><br/>${r}`).style("left",`${e.offsetX+10}px`).style("top",e.offsetY-30+"px").classed("hidden",!1)}).on("mouseleave",function(){M(this).select("circle").transition().duration(150).attr("stroke-width",1.5),S.classed("hidden",!0)}),()=>{S.remove()}},[l,o,s]),e.jsxs("div",{ref:i,className:"w-full h-full relative",children:[e.jsx("svg",{ref:a,className:"w-full h-full"}),0===l.length&&t.length>0&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",children:e.jsxs("div",{className:"text-sm "+("NeXTSTEP"===o?"text-[#707070]":"text-gray-400"),children:["No valid dates found. Cards need ",n," dates for timeline view."]})})]})}function kr({data:t,dateField:n="createdAt",onNodeClick:s}){const a=r.useRef(null),i=r.useRef(null),{theme:o}=Ze(),[l,c]=r.useState(()=>{const e=new Date;return new Date(e.getFullYear(),e.getMonth(),1)}),d=r.useMemo(()=>{const e=new Map;return t.forEach(t=>{const r=t[n];if(r){const n=new Date(r);if(!isNaN(n.getTime())){const r=n.toISOString().split("T")[0];e.has(r)||e.set(r,[]),e.get(r).push(t)}}}),e},[t,n]),g=r.useMemo(()=>{const e=l.getFullYear(),t=l.getMonth(),r=new Date(e,t,1),n=new Date(e,t+1,0),s=r.getDay(),a=[];for(let o=0;o<s;o++){const r=new Date(e,t,-s+o+1);a.push({date:r,isCurrentMonth:!1})}for(let o=1;o<=n.getDate();o++)a.push({date:new Date(e,t,o),isCurrentMonth:!0});const i=42-a.length;for(let o=1;o<=i;o++)a.push({date:new Date(e,t+1,o),isCurrentMonth:!1});return a},[l]),f=r.useMemo(()=>{const e=Array.from(new Set(t.map(e=>e.folder).filter(Boolean)));return F().domain(e).range("NeXTSTEP"===o?["#808080","#606060","#a0a0a0","#707070","#909090"]:U)},[t,o]);r.useEffect(()=>{if(!a.current||!i.current)return;const e=i.current,t=e.clientWidth,r=e.clientHeight-50,n=(t-8)/7,l=(r-30)/6,c=M(a.current);c.selectAll("*").remove(),c.attr("width",t).attr("height",r);const u=c.append("g").attr("transform","translate(4, 0)");u.append("g").attr("class","day-headers").selectAll("text").data(["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]).join("text").attr("x",(e,t)=>t*n+n/2).attr("y",20).attr("text-anchor","middle").attr("class","text-xs font-medium").attr("fill","NeXTSTEP"===o?"#404040":"#6b7280").text(e=>e);const h=u.append("g").attr("class","cells").attr("transform","translate(0, 30)").selectAll("g").data(g).join("g").attr("class","cell").attr("transform",(e,t)=>{const r=t%7,s=Math.floor(t/7);return`translate(${r*n}, ${s*l})`});h.append("rect").attr("width",n-2).attr("height",l-2).attr("rx","NeXTSTEP"===o?0:4).attr("fill",e=>e.isCurrentMonth?"NeXTSTEP"===o?"#d4d4d4":"#ffffff":"NeXTSTEP"===o?"#e0e0e0":"#f9fafb").attr("stroke","NeXTSTEP"===o?"#a0a0a0":"#e5e7eb").attr("stroke-width",1),h.append("text").attr("x",6).attr("y",14).attr("class","text-xs").attr("fill",e=>e.isCurrentMonth?"NeXTSTEP"===o?"#404040":"#374151":"NeXTSTEP"===o?"#909090":"#9ca3af").text(e=>e.date?.getDate()??""),h.each(function(e){if(!e.date)return;const t=e.date.toISOString().split("T")[0],r=d.get(t)||[];if(0===r.length)return;const a=M(this),i=Math.floor((l-20)/14),c=r.slice(0,i),u=r.length-i;c.forEach((e,t)=>{a.append("rect").attr("x",4).attr("y",18+14*t).attr("width",n-12).attr("height",12).attr("rx",2).attr("fill",f(e.folder||"Uncategorized")).attr("opacity",.8).style("cursor","pointer").on("click",t=>{t.stopPropagation(),s?.(e)}).on("mouseenter",function(){M(this).attr("opacity",1)}).on("mouseleave",function(){M(this).attr("opacity",.8)}),a.append("text").attr("x",6).attr("y",18+14*t+9).attr("class","text-[9px]").attr("fill","#ffffff").style("pointer-events","none").text(e.name.length>12?e.name.slice(0,12)+"...":e.name)}),u>0&&a.append("text").attr("x",6).attr("y",l-6).attr("class","text-[9px]").attr("fill","NeXTSTEP"===o?"#606060":"#9ca3af").text(`+${u} more`)})},[g,d,o,f,s]);const p=l.toLocaleDateString("en-US",{month:"long",year:"numeric"});return e.jsxs("div",{ref:i,className:"w-full h-full flex flex-col",children:[e.jsxs("div",{className:"h-10 flex items-center justify-between px-4 "+("NeXTSTEP"===o?"bg-[#c0c0c0]":"bg-gray-50"),children:[e.jsx("button",{onClick:()=>{c(new Date(l.getFullYear(),l.getMonth()-1,1))},className:"p-1 "+("NeXTSTEP"===o?"bg-[#d4d4d4] border-t-2 border-l-2 border-[#ffffff] border-b-2 border-r-2 border-b-[#707070] border-r-[#707070] active:border-t-[#707070] active:border-l-[#707070] active:border-b-[#ffffff] active:border-r-[#ffffff]":"hover:bg-gray-200 rounded"),children:e.jsx(u,{className:"w-4 h-4"})}),e.jsx("span",{className:"font-medium "+("NeXTSTEP"===o?"text-[#404040]":"text-gray-700"),children:p}),e.jsx("button",{onClick:()=>{c(new Date(l.getFullYear(),l.getMonth()+1,1))},className:"p-1 "+("NeXTSTEP"===o?"bg-[#d4d4d4] border-t-2 border-l-2 border-[#ffffff] border-b-2 border-r-2 border-b-[#707070] border-r-[#707070] active:border-t-[#707070] active:border-l-[#707070] active:border-b-[#ffffff] active:border-r-[#ffffff]":"hover:bg-gray-200 rounded"),children:e.jsx(h,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"flex-1",children:e.jsx("svg",{ref:a,className:"w-full h-full"})})]})}const Or={NeXTSTEP:{bg:{primary:"#c0c0c0",secondary:"#d4d4d4",tertiary:"#b8b8b8",dark:"#a0a0a0",light:"#e0e0e0",raised:"#d4d4d4",sunken:"#b0b0b0"},border:{dark:"#505050",medium:"#707070",light:"#ffffff",outline:"#808080",separator:"#a0a0a0"},text:{primary:"#404040",secondary:"#606060",disabled:"#909090",inverse:"#ffffff"},chart:{palette:["#808080","#606060","#a0a0a0","#707070","#909090","#b0b0b0"],axis:"#808080",axisText:"#404040",grid:"#a0a0a0",stroke:"#404040"},radius:"0"},Modern:{bg:{primary:"white",secondary:"rgb(249, 250, 251)",tertiary:"rgb(243, 244, 246)",dark:"rgb(229, 231, 235)",light:"rgb(255, 255, 255)",raised:"white",sunken:"rgb(249, 250, 251)",blur:"rgba(255, 255, 255, 0.8)"},border:{dark:"rgb(209, 213, 219)",medium:"rgb(229, 231, 235)",light:"rgb(243, 244, 246)",outline:"rgb(209, 213, 219)",separator:"rgb(229, 231, 235)"},text:{primary:"rgb(55, 65, 81)",secondary:"rgb(107, 114, 128)",disabled:"rgb(156, 163, 175)",inverse:"white"},chart:{palette:null,axis:"#d1d5db",axisText:"#6b7280",grid:"#e5e7eb",stroke:"#6b7280"},radius:"0.5rem"}};function Pr(e){return Or[e]}function Rr(e,t){const r=Pr(t),n=F();return n.domain(e),r.chart.palette?n.range(r.chart.palette):n.range(U),n}function Mr(e,t,r={}){const n=Pr(t),{textRotation:s,textAnchor:a}=r;e.selectAll("text").attr("fill",n.chart.axisText),void 0!==s&&e.selectAll("text").attr("transform",`rotate(${s})`).attr("text-anchor",a||"end"),e.selectAll("line, path").attr("stroke",n.chart.axis)}function Ar(e,t={}){const{hoverOpacity:r=.8,normalOpacity:n=1,scale:s}=t;e.on("mouseenter",function(){const e=M(this);e.attr("opacity",r),s&&e.attr("transform",function(){return`${M(this).attr("transform")||""} scale(${s})`})}).on("mouseleave",function(){const e=M(this);e.attr("opacity",n),s&&e.attr("transform",function(){return(M(this).attr("transform")||"").replace(/\s*scale\([^)]+\)/,"")})})}function Lr({data:t,onNodeClick:n}){const s=r.useRef(null),a=r.useRef(null),{theme:i}=Ze(),o=function(){const{theme:e}=Ze();return r.useMemo(()=>({container:"NeXTSTEP"===e?"bg-[#c0c0c0] border-r-2 border-[#505050]":"bg-white/80 backdrop-blur-xl border-r border-gray-200",header:"NeXTSTEP"===e?"bg-[#a8a8a8] border-b-2 border-[#707070]":"bg-gray-100 border-b border-gray-200",section:"NeXTSTEP"===e?"bg-[#c0c0c0]":"bg-gray-50",divider:"NeXTSTEP"===e?"border-t border-[#a0a0a0]":"border-t border-gray-200"}),[e])}(),l=function(){const{theme:e}=Ze();return r.useMemo(()=>({base:"NeXTSTEP"===e?"bg-white border-t-2 border-l-2 border-[#707070] border-b-2 border-r-2 border-b-[#e8e8e8] border-r-[#e8e8e8]":"bg-white border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",select:"NeXTSTEP"===e?"bg-[#d4d4d4] border-2 border-[#707070]":"bg-white border border-gray-300 rounded",checkbox:"NeXTSTEP"===e?"bg-white border-2 border-[#707070]":"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),[e])}(),c=function(){const{theme:e}=Ze();return r.useMemo(()=>({primary:"NeXTSTEP"===e?"text-[#404040]":"text-gray-700",secondary:"NeXTSTEP"===e?"text-[#606060]":"text-gray-500",muted:"NeXTSTEP"===e?"text-[#909090]":"text-gray-400",inverse:"text-white",label:"NeXTSTEP"===e?"text-xs text-[#404040]":"text-xs text-gray-600"}),[e])}(),[d,u]=r.useState("bar"),[h,g]=r.useState("folder"),f=r.useMemo(()=>{const e=new Map;return t.forEach(t=>{let r;r="priority"===h?`Priority ${t.priority}`:t[h]||"Unknown",e.has(r)||e.set(r,[]),e.get(r).push(t)}),Array.from(e.entries()).map(([e,t])=>({name:e,count:t.length,nodes:t})).sort((e,t)=>t.count-e.count)},[t,h]),p=r.useMemo(()=>Rr(f.map(e=>e.name),i),[f,i]);return r.useEffect(()=>{if(!s.current||!a.current||!f.length)return;const e=a.current,t=e.clientWidth,r=e.clientHeight-50,o={top:40,right:40,bottom:60,left:60},l=Pr(i),c=M(s.current);c.selectAll("*").remove(),c.attr("width",t).attr("height",r),"bar"===d?function(e,t,r,n,s,a,i,o,l){const c=e.append("g").attr("transform",`translate(${s.left}, ${s.top})`),d=r-s.left-s.right,u=n-s.top-s.bottom,h=$().domain(t.map(e=>e.name)).range([0,d]).padding(.2),g=W().domain([0,_(t,e=>e.count)||0]).range([u,0]).nice();Mr(c.append("g").attr("transform",`translate(0, ${u})`).call(X(h)),i,{textRotation:-30,textAnchor:"end"});Mr(c.append("g").call(V(g).ticks(5)),i);const f=c.append("g").selectAll("rect").data(t).join("rect").attr("x",e=>h(e.name)).attr("y",e=>g(e.count)).attr("width",h.bandwidth()).attr("height",e=>u-g(e.count)).attr("fill",e=>a(e.name)).attr("rx","NeXTSTEP"===i?0:4).style("cursor","pointer").on("click",(e,t)=>{t.nodes.length>0&&l?.(t.nodes[0])});Ar(f),c.append("g").selectAll("text").data(t).join("text").attr("x",e=>h(e.name)+h.bandwidth()/2).attr("y",e=>g(e.count)-5).attr("text-anchor","middle").attr("class","text-xs font-medium").attr("fill",o.chart.axisText).text(e=>e.count)}(c,f,t,r,o,p,i,l,n):"pie"===d?function(e,t,r,n,s,a,i,o){const l=Math.min(r,n)/2-60,c=e.append("g").attr("transform",`translate(${r/2}, ${n/2})`),d=B().value(e=>e.count).sort(null),u=q().innerRadius(.4*l).outerRadius(l),h=q().innerRadius(1.1*l).outerRadius(1.1*l);c.append("g").selectAll("path").data(d(t)).join("path").attr("d",u).attr("fill",e=>s(e.data.name)).attr("stroke","NeXTSTEP"===a?i.border.dark:"#ffffff").attr("stroke-width",2).style("cursor","pointer").on("click",(e,t)=>{t.data.nodes.length>0&&o?.(t.data.nodes[0])}).on("mouseenter",function(e,t){M(this).transition().duration(100).attr("transform",()=>{const[e,r]=u.centroid(t),n=10,s=Math.atan2(r,e);return`translate(${Math.cos(s)*n}, ${Math.sin(s)*n})`})}).on("mouseleave",function(){M(this).transition().duration(100).attr("transform","translate(0, 0)")}),c.append("g").selectAll("text").data(d(t)).join("text").attr("transform",e=>`translate(${h.centroid(e)})`).attr("text-anchor",e=>e.startAngle+(e.endAngle-e.startAngle)/2<Math.PI?"start":"end").attr("class","text-xs").attr("fill",i.chart.axisText).text(e=>`${e.data.name} (${e.data.count})`);const g=t.reduce((e,t)=>e+t.count,0);c.append("text").attr("text-anchor","middle").attr("dy","-0.2em").attr("class","text-2xl font-bold").attr("fill",i.chart.axisText).text(g),c.append("text").attr("text-anchor","middle").attr("dy","1.2em").attr("class","text-xs").attr("fill",i.text.secondary).text("Total")}(c,f,t,r,p,i,l,n):"treemap"===d&&function(e,t,r,n,s,a,i,o){const l={top:20,right:20,bottom:20,left:20},c=r-l.left-l.right,d=n-l.top-l.bottom,u=e.append("g").attr("transform",`translate(${l.left}, ${l.top})`),h=G({children:t}).sum(e=>e.count||0).sort((e,t)=>(t.value||0)-(e.value||0));K().size([c,d]).padding(2).round(!0)(h);const g=u.selectAll("g").data(h.leaves()).join("g").attr("transform",e=>`translate(${e.x0},${e.y0})`),f=g.append("rect").attr("width",e=>e.x1-e.x0).attr("height",e=>e.y1-e.y0).attr("fill",e=>s(e.data.name)).attr("rx","NeXTSTEP"===a?0:4).attr("stroke","NeXTSTEP"===a?i.border.dark:"#ffffff").attr("stroke-width",1).style("cursor","pointer").on("click",(e,t)=>{const r=t.data.nodes;r&&r.length>0&&o?.(r[0])});Ar(f),g.append("text").attr("x",4).attr("y",14).attr("class","text-xs font-medium").attr("fill","#ffffff").text(e=>{const t=e.data.name,r=e.x1-e.x0;return r<40?"":r<80?t.slice(0,5)+"...":t}),g.append("text").attr("x",4).attr("y",28).attr("class","text-xs").attr("fill","NeXTSTEP"===a?"#e0e0e0":"#e5e7eb").text(e=>e.x1-e.x0<40?"":e.data.count)}(c,f,t,r,p,i,l,n)},[f,d,i,p,n]),e.jsxs("div",{ref:a,className:"w-full h-full flex flex-col",children:[e.jsxs("div",{className:`h-12 flex items-center gap-4 px-4 ${o.section}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:c.label,children:"Chart:"}),e.jsxs("select",{value:d,onChange:e=>u(e.target.value),className:`h-7 px-2 text-sm ${l.select}`,children:[e.jsx("option",{value:"bar",children:"Bar Chart"}),e.jsx("option",{value:"pie",children:"Pie Chart"}),e.jsx("option",{value:"treemap",children:"Treemap"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:c.label,children:"Group by:"}),e.jsxs("select",{value:h,onChange:e=>g(e.target.value),className:`h-7 px-2 text-sm ${l.select}`,children:[e.jsx("option",{value:"folder",children:"Folder"}),e.jsx("option",{value:"status",children:"Status"}),e.jsx("option",{value:"priority",children:"Priority"})]})]}),e.jsxs("div",{className:`ml-auto text-xs ${c.secondary}`,children:[t.length," notes in ",f.length," groups"]})]}),e.jsx("div",{className:"flex-1",children:e.jsx("svg",{ref:s,className:"w-full h-full"})})]})}function _r({data:t,onNodeClick:n}){const s=r.useRef(null),a=r.useRef(null),{theme:i}=Ze(),o=function(){const{theme:e}=Ze();return r.useMemo(()=>({container:"NeXTSTEP"===e?"bg-white border-t-2 border-l-2 border-[#707070] border-b-2 border-r-2 border-b-[#e8e8e8] border-r-[#e8e8e8]":"bg-white rounded-lg shadow-lg border border-gray-200",emptyState:"NeXTSTEP"===e?"text-[#707070]":"text-gray-400"}),[e])}(),[l,c]=r.useState(null),{data:u}=gr("SELECT * FROM edges");return r.useEffect(()=>{if(!s.current||!a.current||!t.length)return;const e=a.current,r=e.clientWidth,o=e.clientHeight,h=Pr(i),g=M(s.current);g.selectAll("*").remove(),g.attr("width",r).attr("height",o);const f=t.map(e=>({id:e.id,name:e.name,folder:e.folder,priority:e.priority})),p=new Map(f.map(e=>[e.id,e])),m=(u||[]).filter(e=>p.has(e.source_id)&&p.has(e.target_id)).map(e=>({id:e.id,source:e.source_id,target:e.target_id,type:e.type,weight:e.weight,label:e.label})),b=Rr(Array.from(new Set(f.map(e=>e.folder).filter(Boolean))),i),x=Y(f).force("link",Q(m).id(e=>e.id).distance(100).strength(.5)).force("charge",Z().strength(-200)).force("center",J(r/2,o/2)).force("collision",ee().radius(30)),y=g.append("g");!function(e,t,r={}){const{scaleExtent:n=[.2,4],translateExtent:s,onZoom:a}=r,i=H().scaleExtent(n).on("zoom",e=>{t.attr("transform",e.transform),a?.(e.transform)});s&&i.translateExtent(s),e.call(i)}(g,y,{scaleExtent:[.2,4]}),g.append("defs").append("marker").attr("id","arrow").attr("viewBox","0 -5 10 10").attr("refX",25).attr("refY",0).attr("markerWidth",6).attr("markerHeight",6).attr("orient","auto").append("path").attr("fill",h.chart.axis).attr("d","M0,-5L10,0L0,5");const v=y.append("g").attr("class","links").selectAll("line").data(m).join("line").attr("stroke",h.chart.grid).attr("stroke-width",e=>1.5*Math.sqrt(e.weight)).attr("stroke-opacity",.6).attr("marker-end","url(#arrow)"),w=y.append("g").attr("class","link-labels").selectAll("text").data(m.filter(e=>e.label)).join("text").attr("class","text-xs").attr("fill",h.text.secondary).attr("text-anchor","middle").text(e=>e.label||""),T=y.append("g").attr("class","nodes").selectAll("g").data(f).join("g").attr("class","node").style("cursor","pointer").call(te().on("start",(e,t)=>{e.active||x.alphaTarget(.3).restart(),d.fx=d.x,d.fy=d.y}).on("drag",(e,t)=>{d.fx=e.x,d.fy=e.y}).on("end",(e,t)=>{e.active||x.alphaTarget(0),d.fx=null,d.fy=null}));return T.append("circle").attr("r",e=>12+2*(6-e.priority)).attr("fill",e=>b(e.folder||"Unknown")).attr("stroke",e=>l===e.id?"NeXTSTEP"===i?"#000000":"#3b82f6":h.chart.stroke).attr("stroke-width",e=>l===e.id?3:1.5),T.append("text").attr("dy",30).attr("text-anchor","middle").attr("class","text-xs font-medium").attr("fill",h.chart.axisText).text(e=>e.name.length>12?e.name.slice(0,12)+"...":e.name),T.on("click",(e,r)=>{e.stopPropagation(),c(e=>e===d.id?null:d.id);const s=t.find(e=>e.id===d.id);s&&n?.(s)}),g.on("click",()=>c(null)),x.on("tick",()=>{v.attr("x1",e=>e.source.x).attr("y1",e=>e.source.y).attr("x2",e=>e.target.x).attr("y2",e=>e.target.y),w.attr("x",e=>(e.source.x+e.target.x)/2).attr("y",e=>(e.source.y+e.target.y)/2),T.attr("transform",e=>`translate(${e.x},${e.y})`)}),()=>{x.stop()}},[t,u,i,l,n]),e.jsxs("div",{ref:a,className:"w-full h-full relative",children:[e.jsx("svg",{ref:s,className:"w-full h-full"}),(!u||0===u.length)&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",children:e.jsx("div",{className:`text-sm ${o.emptyState}`,children:"No edges defined. Add relationships to see the network."})})]})}function $r({data:t,onNodeClick:n}){const s=r.useRef(null),a=r.useRef(null),{theme:i}=Ze(),o=r.useMemo(()=>function(e){const t=new Map,r=[];return e.forEach(e=>{t.set(e.id,{id:e.id,name:e.name,folder:e.folder,priority:e.priority,children:[],_node:e})}),e.forEach(e=>{const n=t.get(e.id);r.push(n)}),r}(t),[t]);return r.useEffect(()=>{if(!s.current||!a.current||!o.length)return;const e=a.current,r=e.clientWidth,l=e.clientHeight,c=40,u=120,h=40,g=120,f=M(s.current);f.selectAll("*").remove();const p=1===o.length?o[0]:{id:"__root__",name:"Root",folder:null,priority:0,children:o,_node:t[0]},m=G(p),b=re().size([l-c-h,r-g-u])(m),x=Array.from(new Set(t.map(e=>e.folder).filter(Boolean))),y=F().domain(x).range("NeXTSTEP"===i?["#808080","#606060","#a0a0a0","#707070","#909090"]:U),v=f.attr("width",r).attr("height",l).append("g").attr("transform",`translate(${g},${c})`),w=H().scaleExtent([.3,3]).on("zoom",e=>{v.attr("transform",e.transform)});f.call(w),f.call(w.transform,ne.translate(g,c)),v.append("g").attr("class","links").selectAll("path").data(b.links()).join("path").attr("fill","none").attr("stroke","NeXTSTEP"===i?"#808080":"#d1d5db").attr("stroke-width",1.5).attr("d",se().x(e=>e.y).y(e=>e.x));const T=v.append("g").attr("class","nodes").selectAll("g").data(b.descendants().filter(e=>"__root__"!==e.data.id)).join("g").attr("class","node").attr("transform",e=>`translate(${e.y},${e.x})`).style("cursor","pointer").on("click",(e,t)=>{e.stopPropagation(),n?.(d.data._node)});T.append("circle").attr("r",e=>8+1.5*(6-e.data.priority)).attr("fill",e=>e.data.folder?y(e.data.folder):"NeXTSTEP"===i?"#b0b0b0":"#e5e7eb").attr("stroke","NeXTSTEP"===i?"#404040":"#6b7280").attr("stroke-width",1.5),T.append("text").attr("dy","0.31em").attr("x",e=>e.children?-15:15).attr("text-anchor",e=>e.children?"end":"start").attr("class","text-xs font-medium").attr("fill","NeXTSTEP"===i?"#404040":"#374151").text(e=>e.data.name.length>20?e.data.name.slice(0,20)+"...":e.data.name),T.on("mouseenter",function(){M(this).select("circle").transition().duration(150).attr("stroke-width",3)}).on("mouseleave",function(){M(this).select("circle").transition().duration(150).attr("stroke-width",1.5)})},[o,t,i,n]),e.jsxs("div",{ref:a,className:"w-full h-full relative",children:[e.jsx("svg",{ref:s,className:"w-full h-full"}),t.length>0&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",children:e.jsx("div",{className:"text-sm "+("NeXTSTEP"===i?"text-[#707070]":"text-gray-400"),children:"No hierarchy defined. Add NEST edges to see the tree."})})]})}const Fr={folder:"folder",subfolder:"status",tags:"folder",year:"createdAt",month:"createdAt",category:"folder",status:"status",priority:"priority"},Ur=(e,t)=>{const r=Fr[t.id]||"folder",n=e[r];if("createdAt"===r&&n){const e=new Date(n);return"year"===t.id?e.getFullYear():"month"===t.id?e.getMonth():e}if("priority"===t.id&&"string"==typeof n){return{high:3,medium:2,low:1}[n.toLowerCase()]||1}return n??"Unknown"},Hr=(e,t)=>["year","month","date","time"].includes(e.id)||t.length>0&&t[0]instanceof Date?"temporal":t.length>0&&"number"==typeof t[0]?t.length>10||"priority"===e.id?"numerical":"ordinal":["priority","status","rating"].includes(e.id)?"ordinal":"categorical",Xr=(e,t)=>{const r=e.map(e=>Ur(e,t)),n=Array.from(new Set(r));switch(Hr(t,n)){case"temporal":return n.filter(e=>e instanceof Date||"number"==typeof e).sort();case"numerical":return n.filter(e=>"number"==typeof e).sort((e,t)=>e-t);case"ordinal":return"priority"===t.id?[1,2,3]:"status"===t.id?["draft","pending","active","completed"]:n.sort();default:return n.map(e=>String(e)).sort()}},zr=(e,t,r,n=.1)=>{const s=Hr(e,t),a={type:s,domain:t,range:r,padding:n};switch(s){case"temporal":{const e=t;return{scale:A().domain(ie(e)).range(r).nice(),type:s,config:a}}case"numerical":{const e=t;return{scale:W().domain(ie(e)).range(r).nice(),type:s,config:a}}case"ordinal":{const e=t.map(String);return{scale:F().domain(e).range(le(r[0],r[1],(r[1]-r[0])/e.length)),type:s,config:a}}default:{const e=t.map(String);return{scale:$().domain(e).range(r).padding(n),type:s,config:a}}}},Vr=(e,t,r,n)=>{if(0===e.length){return{levels:[],composite:$().domain([]).range(r),totalHeight:0,totalWidth:0}}if(1===e.length){const s=Xr(t,e[0]),a=zr(e[0],s,r);return{levels:[a],composite:a.scale,totalHeight:n.headerHeights.row,totalWidth:n.headerHeights.column}}const s=[],a=(r[1]-r[0])/e.length;e.forEach((e,n)=>{const i=[r[0]+n*a,r[0]+(n+1)*a],o=Xr(t,e),l=zr(e,o,i,.05);s.push(l)});const i=new Set;t.forEach(t=>{const r=e.map(e=>String(Ur(t,e))).join("|");i.add(r)});const o=$().domain(Array.from(i).sort()).range(r).padding(.1);return{levels:s,composite:o,totalHeight:n.headerHeights.row*e.length,totalWidth:n.headerHeights.column*e.length}},Wr=(e,t)=>t.map(t=>((e,t)=>{const r=Ur(e,t);return String(r)})(e,t)).join("|");let Br=class{startTimes=new Map;durations=new Map;start(e){this.startTimes.set(e,performance.now())}end(e){const t=this.startTimes.get(e);if(!t)return 0;const r=performance.now()-t;return this.durations.set(e,r),r}getDuration(e){return this.durations.get(e)||0}getMetrics(){return{dataTransform:this.getDuration("dataTransform"),scaleGeneration:this.getDuration("scaleGeneration"),layoutCalculation:this.getDuration("layoutCalculation"),renderPrep:this.getDuration("renderPrep"),totalPipeline:this.getDuration("totalPipeline")}}getMemoryUsage(){const e=performance.memory;return e?e.usedJSHeapSize/1024/1024:0}};const qr=(e,t,r,n,s)=>((e,t,r,n)=>{const s=n.width-n.padding.left-n.padding.right,a=n.height-n.padding.top-n.padding.bottom,i=Vr(t,r,[n.padding.left,n.padding.left+s],n),o=Vr(e,r,[n.padding.top,n.padding.top+a],n),l=Array.from(new Set(r.map(e=>e.folder))),c=F().domain(l).range(ae),d=ie(Array.from(oe(r,e=>`${Ur(e,t[0]||{id:"folder"})}`).values(),e=>e.length));return{x:i,y:o,color:c,size:W().domain(d).range([2,10]).clamp(!0)}})(r,n,s,{width:t.width,height:t.height,padding:{top:60,right:20,bottom:20,left:120},headerHeights:{column:30,row:100}});function Gr(e){const{data:t,loading:n,error:s}=xt(),{wells:a}=mt(),i=r.useRef(new Br),[o,l]=r.useState(()=>({rawData:[],groupedData:{cells:new Map,rowKeys:[],colKeys:[],rowDomains:new Map,colDomains:new Map},scaleSystem:{x:{levels:[],composite:$(),totalHeight:0,totalWidth:0},y:{levels:[],composite:$(),totalHeight:0,totalWidth:0},color:F(),size:W()},viewport:{x:0,y:0,width:800,height:600,scale:1},renderCommands:{cells:[],headers:[]},performance:{dataTransform:0,scaleGeneration:0,layoutCalculation:0,renderPrep:0,totalPipeline:0,memoryUsage:0,nodeCount:0,cellCount:0},error:null,loading:!1})),c=r.useRef({nodes:[],wells:a}),d=r.useCallback((e,t)=>{const r=c.current;return{data:r.nodes!==e,pafv:JSON.stringify(r.wells)!==JSON.stringify(t),viewport:!1}},[]),u=r.useCallback(e=>{l(t=>({...t,viewport:{...t.viewport,...e}}))},[]),h=r.useCallback((e,t,r)=>{const n=i.current;n.start("totalPipeline");try{n.start("dataTransform");const s=((e,t)=>{const r=t.rows.length>0?t.rows:[{id:"folder",label:"Folder",hasCheckbox:!1}],n=t.columns.length>0?t.columns:[{id:"year",label:"Year",hasCheckbox:!1}],s=new Map,a=new Set,i=new Set;e.forEach(e=>{const t=Wr(e,r),o=Wr(e,n),l=`${o}||${t}`;a.add(t),i.add(o),s.has(l)||s.set(l,{nodes:[],bounds:{x:0,y:0,width:0,height:0},rowKey:t,colKey:o,rowPath:t.split("|"),colPath:o.split("|"),isEmpty:!0});const c=s.get(l);c.nodes.push(e),c.isEmpty=!1});const o=new Map,l=new Map;return r.forEach((e,t)=>{const r=Array.from(a).map(e=>e.split("|")[t]);o.set(e.id,Array.from(new Set(r)).sort())}),n.forEach((e,t)=>{const r=Array.from(i).map(e=>e.split("|")[t]);l.set(e.id,Array.from(new Set(r)).sort())}),{cells:s,rowKeys:Array.from(a).sort(),colKeys:Array.from(i).sort(),rowDomains:o,colDomains:l}})(e,t);n.end("dataTransform"),n.start("scaleGeneration");const a=t.rows.length>0?t.rows:[{id:"folder",label:"Folder",hasCheckbox:!1}],i=t.columns.length>0?t.columns:[{id:"year",label:"Year",hasCheckbox:!1}],o=qr(0,r,a,i,e);n.end("scaleGeneration"),n.start("layoutCalculation");const l=((e,t)=>{const r=new Map(e.cells);return r.forEach(e=>{const r=t.x.composite(e.colKey)||0,n=t.y.composite(e.rowKey)||0,s=t.x.composite.bandwidth(),a=t.y.composite.bandwidth();e.bounds={x:r,y:n,width:s,height:a}}),{...e,cells:r}})(s,o);n.end("layoutCalculation"),n.start("renderPrep");const c=(e=>{const t=[];return e.cells.forEach(e=>{const r=e.nodes.length,n={fill:0===r?"#f9f9f9":"#e3f2fd",stroke:"#ccc",strokeWidth:1,opacity:0===r?.3:Math.min(1,.3+r/5)};t.push({type:"cell",bounds:e.bounds,nodes:e.nodes,rowKey:e.rowKey,colKey:e.colKey,style:n})}),{cells:t,headers:[]}})(l);n.end("renderPrep"),n.end("totalPipeline");return{rawData:e,groupedData:l,scaleSystem:o,viewport:r,renderCommands:c,performance:{...n.getMetrics(),memoryUsage:n.getMemoryUsage(),nodeCount:e.length,cellCount:l.cells.size,totalPipeline:n.getDuration("totalPipeline")},error:null,loading:!1}}catch(s){return console.error("D3 Canvas pipeline error:",s),n.end("totalPipeline"),{rawData:e,groupedData:{cells:new Map,rowKeys:[],colKeys:[],rowDomains:new Map,colDomains:new Map},scaleSystem:{x:{levels:[],composite:$(),totalHeight:0,totalWidth:0},y:{levels:[],composite:$(),totalHeight:0,totalWidth:0},color:F(),size:W()},viewport:r,renderCommands:{cells:[],headers:[]},performance:{...n.getMetrics(),memoryUsage:n.getMemoryUsage(),nodeCount:e.length,cellCount:0,totalPipeline:n.getDuration("totalPipeline")},error:s instanceof Error?s.message:"Unknown pipeline error",loading:!1}}},[]);return r.useEffect(()=>{if(n||!t)return void l(e=>({...e,loading:!0,error:null}));const e=d(t,a);if(e.data||e.pafv||0===o.rawData.length){const e=h(t,a,o.viewport);l(e),c.current={nodes:t,wells:a}}},[t,a,n,s,o.viewport,h,d,o.rawData.length]),r.useEffect(()=>{if(o.rawData.length>0){const e=h(o.rawData,a,o.viewport);l(e)}},[o.viewport.width,o.viewport.height]),r.useEffect(()=>{},[o.performance]),{canvasState:o,performance:o.performance,error:o.error||s?.message||null,updateViewport:u}}class Kr{type="rect";x=0;y=0;width;height;style={};text;constructor(e="rect"){this.type=e}reset(){this.x=0,this.y=0,this.width=void 0,this.height=void 0,this.style={},this.text=void 0}configure(e){return Object.assign(this,e),this}}class Yr{available=[];createFn;resetFn;constructor(e,t,r=10){this.createFn=e,this.resetFn=t;for(let n=0;n<r;n++)this.available.push(e())}acquire(){return 0===this.available.length?this.createFn():this.available.pop()}release(e){this.resetFn(e),this.available.push(e)}size(){return{available:this.available.length,total:this.available.length}}clear(){this.available=[]}}new Yr(()=>new Kr,e=>e.reset(),50),new Yr(()=>new Kr("rect"),e=>e.reset(),30),new Yr(()=>new Kr("text"),e=>e.reset(),20);const Qr=new class{items=[];dirty=!1;sorted=!1;insert(e){this.items.push(e),this.dirty=!0}remove(e){const t=this.items.findIndex(t=>t.id===e);return-1!==t&&(this.items.splice(t,1),this.dirty=!0,!0)}clear(){this.items=[],this.dirty=!1,this.sorted=!1}query(e,t,r=0,n=0){this.dirty&&this.rebuild();const s=e,a=t,i=e+r,o=t+n;return this.items.filter(e=>{const t=e.bounds.x,r=e.bounds.y,n=e.bounds.x+e.bounds.width,l=e.bounds.y+e.bounds.height;return!(i<t||s>n||o<r||a>l)})}findAtPoint(e,t){const r=this.query(e,t);return r.length>0?r[0]:null}rebuild(){this.items.sort((e,t)=>e.bounds.x-t.bounds.x),this.dirty=!1,this.sorted=!0}size(){return this.items.length}getStats(){return{items:this.items.length,dirty:this.dirty,sorted:this.sorted}}};const Zr=new class{activeTransitions=new Map;animationFrame=null;start(e,t,r,n){const s={id:e,startTime:performance.now(),config:n,startValues:{...t},endValues:{...r},currentValues:{...t}};this.activeTransitions.set(e,s),this.ensureAnimationLoop()}stop(e){return this.activeTransitions.delete(e)}isActive(e){return this.activeTransitions.has(e)}getCurrentValues(e){const t=this.activeTransitions.get(e);return t?{...t.currentValues}:null}ensureAnimationLoop(){null===this.animationFrame&&this.activeTransitions.size>0&&(this.animationFrame=requestAnimationFrame(()=>this.update()))}update(){const e=performance.now(),t=[];for(const[r,n]of this.activeTransitions){const s=e-n.startTime,a=Math.min(s/n.config.duration,1),i=n.config.easing(a);for(const e in n.startValues){const t=n.startValues[e],r=n.endValues[e];n.currentValues[e]=t+(r-t)*i}n.config.onUpdate?.(a),a>=1&&(t.push(r),n.config.onComplete?.())}for(const r of t)this.activeTransitions.delete(r);this.activeTransitions.size>0?this.animationFrame=requestAnimationFrame(()=>this.update()):this.animationFrame=null}getStats(){return{active:this.activeTransitions.size,hasAnimationFrame:null!==this.animationFrame}}clear(){this.activeTransitions.clear(),this.animationFrame&&(cancelAnimationFrame(this.animationFrame),this.animationFrame=null)}};const Jr=new class{metrics=new Map;frameTimeHistory=[];lastFrameTime=0;maxHistorySize=60;startMetric(e){this.metrics.set(e,{name:e,startTime:performance.now(),samples:[],lastUpdated:Date.now()})}endMetric(e){const t=this.metrics.get(e);if(!t)return 0;const r=performance.now()-t.startTime;return t.duration=r,t.samples.push(r),t.lastUpdated=Date.now(),t.samples.length>this.maxHistorySize&&t.samples.shift(),r}recordFrameTime(){const e=performance.now();if(this.lastFrameTime>0){const t=e-this.lastFrameTime;this.frameTimeHistory.push(t),this.frameTimeHistory.length>this.maxHistorySize&&this.frameTimeHistory.shift()}return this.lastFrameTime=e,this.getFPS()}getFPS(){if(0===this.frameTimeHistory.length)return 0;const e=this.frameTimeHistory.reduce((e,t)=>e+t,0)/this.frameTimeHistory.length;return 1e3/e}getMetricStats(e){const t=this.metrics.get(e);if(!t||0===t.samples.length)return null;const r=t.samples;return{average:r.reduce((e,t)=>e+t,0)/r.length,min:Math.min(...r),max:Math.max(...r),latest:r[r.length-1],samples:r.length}}getAllStats(){const e={fps:this.getFPS(),frameHistory:this.frameTimeHistory.length};for(const[t,r]of this.metrics)e[t]=this.getMetricStats(t);return e}clear(){this.metrics.clear(),this.frameTimeHistory=[],this.lastFrameTime=0}getMemoryUsage(){const e=performance.memory;return e?{used:e.usedJSHeapSize/1024/1024,total:e.totalJSHeapSize/1024/1024,percentage:e.usedJSHeapSize/e.totalJSHeapSize*100}:{used:0,total:0,percentage:0}}},en=({performance:t,frameRate:r,error:n})=>{if(!t||0===(t.totalPipeline??0))return null;const s=Jr.getMetricStats("canvas-render"),a=Qr.getStats(),i=Zr.getStats();return e.jsxs("div",{className:"absolute top-2 right-2 bg-black bg-opacity-85 text-white text-xs p-3 rounded font-mono max-w-xs",children:[e.jsx("div",{className:"mb-2 pb-2 border-b border-gray-600",children:e.jsx("div",{className:"text-yellow-300 font-bold mb-1",children:"Performance Monitor"})}),e.jsxs("div",{className:"grid grid-cols-2 gap-x-3 gap-y-1 mb-3",children:[e.jsx("span",{children:"FPS:"}),e.jsx("span",{className:r>=30?"text-green-400":"text-red-400",children:r.toFixed(1)}),e.jsx("span",{children:"Pipeline:"}),e.jsxs("span",{className:(t.totalPipeline??0)<=100?"text-green-400":"text-yellow-400",children:[(t.totalPipeline??0).toFixed(1),"ms"]}),e.jsx("span",{children:"Render:"}),e.jsxs("span",{children:[s?s.latest.toFixed(1):"0.0","ms"]}),e.jsx("span",{children:"Memory:"}),e.jsxs("span",{className:(t.memoryUsage??0)<=50?"text-green-400":"text-yellow-400",children:[(t.memoryUsage??0).toFixed(1),"MB"]}),e.jsx("span",{children:"Nodes:"}),e.jsx("span",{children:t.nodeCount??0}),e.jsx("span",{children:"Cells:"}),e.jsx("span",{children:t.cellCount??0})]}),e.jsxs("div",{className:"mb-3 pb-2 border-b border-gray-600",children:[e.jsx("div",{className:"text-blue-300 font-medium mb-1",children:"Optimizations"}),e.jsxs("div",{className:"grid grid-cols-2 gap-x-3 gap-y-1",children:[e.jsx("span",{children:"Spatial:"}),e.jsxs("span",{className:"text-cyan-300",children:[a.items," items"]}),e.jsx("span",{children:"Transitions:"}),e.jsxs("span",{className:"text-purple-300",children:[i.active," active"]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-x-3 gap-y-1 text-xs",children:[e.jsx("span",{children:"Transform:"}),e.jsxs("span",{children:[(t.dataTransform??0).toFixed(1),"ms"]}),e.jsx("span",{children:"Scales:"}),e.jsxs("span",{children:[(t.scaleGeneration??0).toFixed(1),"ms"]}),e.jsx("span",{children:"Layout:"}),e.jsxs("span",{children:[(t.layoutCalculation??0).toFixed(1),"ms"]}),e.jsx("span",{children:"Prep:"}),e.jsxs("span",{children:[(t.renderPrep??0).toFixed(1),"ms"]})]}),n&&e.jsxs("div",{className:"mt-3 pt-2 border-t border-red-400 text-red-300",children:[e.jsx("div",{className:"font-medium mb-1",children:"Error:"}),e.jsx("div",{className:"text-xs",children:n})]})]})};class tn{ctx;constructor(e){this.ctx=e}clear(e,t){this.ctx.clearRect(0,0,e,t)}drawCell(e,t,r,n,s,a){this.ctx.save(),this.ctx.globalAlpha=s.opacity,this.ctx.fillStyle=s.fill,this.ctx.fillRect(e,t,r,n),this.ctx.strokeStyle=s.stroke,this.ctx.lineWidth=s.strokeWidth,this.ctx.strokeRect(e,t,r,n),a>0&&(this.ctx.fillStyle="#333",this.ctx.font="12px sans-serif",this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.fillText(String(a),e+r/2,t+n/2)),this.ctx.restore()}drawText(e,t,r,n={}){this.ctx.save(),this.ctx.font=n.font||"12px sans-serif",this.ctx.fillStyle=n.fill||"#333",this.ctx.textAlign=n.align||"left",this.ctx.textBaseline=n.baseline||"top",n.maxWidth?this.ctx.fillText(e,t,r,n.maxWidth):this.ctx.fillText(e,t,r),this.ctx.restore()}}const rn=({className:t="",onCellClick:n,onError:s,showPerformanceOverlay:a=!1})=>{const i=r.useRef(null),o=r.useRef(null),l=r.useRef(null),c=r.useRef(null),{canvasState:d,performance:u,error:h,updateViewport:g}=Gr(),[f,p]=r.useState({hoveredCell:null,selectedCells:new Set,isDragging:!1,dragStart:null}),[m,b]=r.useState(0),[x,y]=r.useState({x:0,y:0,width:800,height:600,scale:1}),v=r.useCallback(e=>{const{width:t,height:r}=e.contentRect,n={...x,width:t,height:r};y(n),g(n),l.current&&(l.current.width=t,l.current.height=r),o.current&&(o.current.setAttribute("width",String(t)),o.current.setAttribute("height",String(r)))},[x,g]);var w,T;w=i,T=v,r.useEffect(()=>{if(!w.current)return;const e=new ResizeObserver(e=>{e[0]&&T(e[0])});return e.observe(w.current),()=>e.disconnect()},[w,T]);const S=r.useCallback(((e,t)=>{let r;return(...n)=>{clearTimeout(r),r=setTimeout(()=>e(...n),t)}})(async()=>{if(!l.current||!d.renderCommands.cells.length)return;const e=l.current,t=e.getContext("2d");t&&await(async(e,t)=>{Jr.startMetric(e);try{const r=await t();return Jr.endMetric(e),r}catch(h){throw Jr.endMetric(e),h}})("canvas-render",async()=>{const r=new tn(t);r.clear(e.width,e.height),Qr.clear(),d.renderCommands.cells.forEach(e=>{const{bounds:t,style:n,nodes:s,rowKey:a,colKey:i}=e;r.drawCell(t.x,t.y,t.width,t.height,n,s.length),Qr.insert({id:`${i}||${a}`,bounds:t,data:{nodes:s,rowKey:a,colKey:i}})});const n=Jr.recordFrameTime();b(n)})},16),[d.renderCommands,Qr]);r.useEffect(()=>{S()},[S]),r.useEffect(()=>{o.current&&!d.error&&((e,t)=>{const r=M(e);r.selectAll("*").remove();const{scaleSystem:n}=t,s=r.append("g").attr("class","column-headers").attr("transform","translate(0, 0)");n.x.composite.domain().forEach((e,t)=>{const r=n.x.composite(e)||0,a=n.x.composite.bandwidth(),i=s.append("g").attr("class","column-header").attr("transform",`translate(${r}, 0)`);i.append("rect").attr("width",a).attr("height",50).attr("fill","#f5f5f5").attr("stroke","#ccc").attr("stroke-width",1),i.append("text").attr("x",a/2).attr("y",25).attr("text-anchor","middle").attr("dominant-baseline","central").attr("font-size","11px").attr("font-weight","bold").text(e.split("|").join("  "))});const a=r.append("g").attr("class","row-headers").attr("transform","translate(0, 50)");n.y.composite.domain().forEach((e,t)=>{const r=n.y.composite(e)||0,s=n.y.composite.bandwidth(),i=a.append("g").attr("class","row-header").attr("transform",`translate(0, ${r})`);i.append("rect").attr("width",100).attr("height",s).attr("fill","#f5f5f5").attr("stroke","#ccc").attr("stroke-width",1),i.append("text").attr("x",50).attr("y",s/2).attr("text-anchor","middle").attr("dominant-baseline","central").attr("font-size","11px").attr("font-weight","bold").text(e.split("|").join("  "))})})(o.current,d)},[d,x]);const E=r.useCallback(e=>{if(!l.current)return;const t=l.current,r=t.getBoundingClientRect(),n=e.clientX-r.left,s=e.clientY-r.top,a=Qr.findAtPoint(n,s),i=a?.id||null;i!==f.hoveredCell&&(p(e=>({...e,hoveredCell:i})),t.style&&(t.style.cursor=i?"pointer":"default"))},[f.hoveredCell]),N=r.useCallback(e=>{if(!l.current)return;const t=l.current.getBoundingClientRect(),r=e.clientX-t.left,s=e.clientY-t.top,a=Qr.findAtPoint(r,s);if(a&&a.data){const e=a.data,{nodes:t,rowKey:r,colKey:s}=e;n?.({nodes:t,rowKey:r,colKey:s});const i=a.id;p(e=>{const t=new Set(e.selectedCells);return t.has(i)?t.delete(i):t.add(i),{...e,selectedCells:t}})}},[n]);return r.useEffect(()=>{h&&s&&s(h)},[h,s]),d.loading?e.jsx("div",{className:`flex items-center justify-center h-full ${t}`,children:e.jsx("div",{className:"text-gray-500",children:"Loading D3 Canvas..."})}):d.error?e.jsx("div",{className:`flex items-center justify-center h-full ${t}`,children:e.jsxs("div",{className:"text-red-500",children:["D3 Canvas Error: ",d.error]})}):e.jsxs("div",{ref:i,className:`relative w-full h-full overflow-hidden ${t}`,children:[e.jsx("svg",{ref:o,className:"absolute inset-0 pointer-events-none",style:{zIndex:2},width:x.width,height:x.height}),e.jsx("canvas",{ref:l,className:"absolute inset-0",style:{zIndex:1},width:x.width,height:x.height,onMouseMove:E,onClick:N}),e.jsx("div",{ref:c,className:"absolute inset-0 pointer-events-none",style:{zIndex:3},children:a&&e.jsx(en,{performance:u,frameRate:m,error:h})})]})};function nn({data:t,onNodeClick:n}){const{wells:s}=mt(),{theme:a}=Ze(),[i,o]=r.useState({visible:!1,nodes:[],position:{x:0,y:0},rowKey:"",colKey:""}),[l,c]=r.useState({hoveredCell:null,selectedCells:new Set,zoomTransform:null,isDragging:!1}),d=r.useRef(null),u=r.useCallback(e=>{const t=`${e.colKey}||${e.rowKey}`;c(e=>{const r=new Set(e.selectedCells);return r.has(t)?r.delete(t):r.add(t),{...e,selectedCells:r}}),e.nodes.length>1?o({visible:!0,nodes:e.nodes,position:{x:0,y:0},rowKey:e.rowKey,colKey:e.colKey}):1===e.nodes.length&&n&&n(e.nodes[0])},[n]),h=r.useCallback(e=>{console.error("D3GridView error:",e)},[]),g=r.useCallback(e=>{e.target===e.currentTarget&&o(e=>({...e,visible:!1}))},[]);r.useEffect(()=>{if(!d.current)return;const e=M(d.current),t=H().scaleExtent([.5,5]).on("zoom",e=>{c(t=>({...t,zoomTransform:e.transform}))});return e.call(t),()=>{e.on(".zoom",null)}},[]);const f=`${s.rows.map(e=>e.label).join("  ")} vs ${s.columns.map(e=>e.label).join("  ")}`;return e.jsxs("div",{className:"d3-grid-view w-full h-full relative",children:[e.jsxs("div",{className:"absolute top-2 left-2 z-10 px-2 py-1 text-xs rounded "+("NeXTSTEP"===a?"bg-[#e8e8e8] border border-[#c0c0c0] text-gray-700":"bg-white border border-gray-200 text-gray-600 shadow-sm"),children:[e.jsx("span",{className:"font-medium",children:"Grid:"})," ",f]}),e.jsx("div",{ref:d,className:"w-full h-full",children:e.jsx(rn,{className:"d3-grid-canvas",onCellClick:u,onError:h,showPerformanceOverlay:!1})}),e.jsxs("div",{className:`absolute bottom-2 right-2 z-10 flex flex-col gap-1 ${"NeXTSTEP"===a?"bg-[#e8e8e8]":"bg-white shadow-lg"} border border-gray-300 rounded p-1`,children:[e.jsx("button",{className:"px-2 py-1 text-xs "+("NeXTSTEP"===a?"bg-[#c0c0c0] hover:bg-[#b0b0b0] border border-[#808080]":"bg-gray-100 hover:bg-gray-200 border border-gray-300"),onClick:()=>{if(d.current){const e=H();M(d.current).transition().call(e.scaleBy,1.5)}},title:"Zoom In",children:"+"}),e.jsx("button",{className:"px-2 py-1 text-xs "+("NeXTSTEP"===a?"bg-[#c0c0c0] hover:bg-[#b0b0b0] border border-[#808080]":"bg-gray-100 hover:bg-gray-200 border border-gray-300"),onClick:()=>{if(d.current){const e=H();M(d.current).transition().call(e.scaleBy,.67)}},title:"Zoom Out",children:""}),e.jsx("button",{className:"px-2 py-1 text-xs "+("NeXTSTEP"===a?"bg-[#c0c0c0] hover:bg-[#b0b0b0] border border-[#808080]":"bg-gray-100 hover:bg-gray-200 border border-gray-300"),onClick:()=>{if(d.current){const e=H();M(d.current).transition().call(e.transform,ne)}},title:"Reset Zoom",children:""})]}),i.visible&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center",onClick:g,children:e.jsxs("div",{className:"max-w-md w-full mx-4 p-4 rounded-lg "+("NeXTSTEP"===a?"bg-white border-2 border-[#808080]":"bg-white shadow-xl border border-gray-200"),onClick:e=>e.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"font-semibold text-lg",children:"Cell Details"}),e.jsx("button",{onClick:()=>o(e=>({...e,visible:!1})),className:`px-2 py-1 text-sm ${"NeXTSTEP"===a?"bg-[#e8e8e8] hover:bg-[#d8d8d8]":"bg-gray-100 hover:bg-gray-200"} rounded`,children:""})]}),e.jsx("div",{className:"mb-4 p-3 bg-gray-50 rounded",children:e.jsxs("div",{className:"text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Row:"})," ",i.rowKey.split("|").join("  ")]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Column:"})," ",i.colKey.split("|").join("  ")]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Count:"})," ",i.nodes.length," items"]})]})}),e.jsx("div",{className:"space-y-2 max-h-60 overflow-y-auto",children:i.nodes.map(t=>e.jsxs("div",{className:"p-2 rounded border cursor-pointer transition-colors "+("NeXTSTEP"===a?"border-[#c0c0c0] hover:bg-[#f5f5f5]":"border-gray-200 hover:bg-gray-50"),onClick:()=>{n?.(t),o(e=>({...e,visible:!1}))},children:[e.jsx("div",{className:"font-medium text-sm",children:t.name}),t.content&&e.jsx("div",{className:"text-xs text-gray-600 truncate mt-1",children:t.content}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("span",{className:"px-1 py-0.5 text-xs rounded "+("high"===t.priority?"bg-red-100 text-red-700":"medium"===t.priority?"bg-yellow-100 text-yellow-700":"bg-green-100 text-green-700"),children:t.priority}),e.jsx("span",{className:"text-xs text-gray-500",children:t.status})]})]},t.id))})]})}),!1]})}function sn({data:t,onNodeClick:n}){const{wells:s}=mt(),{theme:a}=Ze(),i=r.useRef(null),d=r.useRef(null),[u,h]=r.useState({searchQuery:"",sortDirection:"desc",groupingEnabled:!0,collapsedGroups:new Set,selectedItems:new Set,hoveredItem:null}),[g,f]=r.useState(0),[p,m]=r.useState(400),[b,x]=r.useState(!1),y=r.useMemo(()=>{if(!u.groupingEnabled||0===s.rows.length)return[{key:"all",label:"All Items",nodes:t,collapsed:!1}];const e=new Map,r=s.rows[0];return t.forEach(t=>{const n=function(e,t){return String(e[{folder:"folder",status:"status",priority:"priority"}[t]||"folder"]??"Unknown")}(t,r.id),s=String(n);e.has(s)||e.set(s,[]),e.get(s).push(t)}),Array.from(e.entries()).map(([e,t])=>({key:e,label:e,nodes:t.sort((e,t)=>{const r=new Date(e.modifiedAt).getTime(),n=new Date(t.modifiedAt).getTime();return"desc"===u.sortDirection?n-r:r-n}),collapsed:u.collapsedGroups.has(e)}))},[t,s.rows,u.groupingEnabled,u.collapsedGroups,u.sortDirection]),v=r.useMemo(()=>{if(!u.searchQuery.trim())return y;const e=u.searchQuery.toLowerCase();return y.map(t=>({...t,nodes:t.nodes.filter(t=>t.name.toLowerCase().includes(e)||t.content?.toLowerCase().includes(e)||t.tags?.some?.(t=>t.toLowerCase().includes(e)))})).filter(e=>e.nodes.length>0)},[y,u.searchQuery]),w=r.useMemo(()=>{const e=[];let t=0;return v.forEach(r=>{u.groupingEnabled&&e.push({id:`group-${r.key}`,node:{},index:t++,groupKey:r.key,isGroupHeader:!0,groupLabel:r.label,groupCount:r.nodes.length,isVisible:!0}),r.collapsed||r.nodes.forEach(n=>{e.push({id:n.id,node:n,index:t++,groupKey:r.key,isGroupHeader:!1,isVisible:!0})})}),e},[v,u.groupingEnabled]),T=r.useMemo(()=>{const e=g,t=g+p;let r=0;const n=[];for(const s of w){const a=s.isGroupHeader?40:80;if(r+a>=e&&r<=t&&n.push({item:s,y:r-g,height:a}),r+=a,r>t)break}return n},[w,g,p]);const S=r.useCallback(e=>{h(t=>({...t,searchQuery:e}))},[]),E=r.useCallback(()=>{h(e=>({...e,searchQuery:""}))},[]),N=r.useCallback(()=>{x(!0),h(e=>({...e,sortDirection:"desc"===e.sortDirection?"asc":"desc"})),setTimeout(()=>x(!1),300)},[]),C=r.useCallback(()=>{h(e=>({...e,groupingEnabled:!e.groupingEnabled,collapsedGroups:new Set}))},[]),j=r.useCallback(e=>{h(t=>{const r=new Set(t.collapsedGroups);return r.has(e)?r.delete(e):r.add(e),{...t,collapsedGroups:r}})},[]),D=r.useCallback(e=>{e.isGroupHeader?j(e.groupKey):n?.(e.node)},[n,j]),I=r.useCallback(e=>{f(e.currentTarget.scrollTop)},[]),k=r.useCallback(()=>{d.current&&m(d.current.clientHeight-60)},[]);r.useEffect(()=>{k();const e=new ResizeObserver(k);return d.current&&e.observe(d.current),()=>e.disconnect()},[k]),r.useEffect(()=>{if(!i.current)return;const e=M(i.current);e.selectAll("*").remove();const t=e.append("g").attr("class","list-container").selectAll(".list-item").data(T,e=>e.item.id).enter().append("g").attr("class","list-item").attr("transform",e=>`translate(0, ${e.y})`).style("cursor","pointer").on("click",(e,t)=>D(t.item)),r=t.filter(e=>e.item.isGroupHeader);r.append("rect").attr("width","100%").attr("height",40).attr("fill","NeXTSTEP"===a?"#e8e8e8":"#f3f4f6").attr("stroke","NeXTSTEP"===a?"#c0c0c0":"#e5e7eb").attr("stroke-width",1),r.append("text").attr("x",12).attr("y",20).attr("dominant-baseline","central").attr("font-size","12px").attr("font-weight","bold").attr("fill","#374151").text(e=>e.item.groupLabel||""),r.append("text").attr("x",200).attr("y",20).attr("dominant-baseline","central").attr("font-size","10px").attr("fill","#6b7280").text(e=>`${e.item.groupCount} items`);const n=t.filter(e=>!e.item.isGroupHeader);n.append("rect").attr("width","100%").attr("height",80).attr("fill","white").attr("stroke","NeXTSTEP"===a?"#c0c0c0":"#e5e7eb").attr("stroke-width",.5).on("mouseenter",function(e,t){M(this).attr("fill","NeXTSTEP"===a?"#f5f5f5":"#f9fafb"),h(e=>({...e,hoveredItem:t.item.id}))}).on("mouseleave",function(e,t){M(this).attr("fill","white"),h(e=>({...e,hoveredItem:null}))}),n.append("text").attr("x",12).attr("y",20).attr("font-size","14px").attr("font-weight","500").attr("fill","#111827").text(e=>e.item.node.name||""),n.append("text").attr("x",12).attr("y",38).attr("font-size","12px").attr("fill","#6b7280").text(e=>{const t=e.item.node.content||"";return t.length>60?t.substring(0,60)+"...":t}),n.append("text").attr("x",12).attr("y",58).attr("font-size","10px").attr("fill","#9ca3af").text(e=>{const t=e.item.node;return`${t.folder}  ${t.status}  ${t.priority}`}),n.append("rect").attr("x","95%").attr("y",10).attr("width",4).attr("height",60).attr("fill",e=>{const t=e.item.node.priority;return"high"===t?"#ef4444":"medium"===t?"#f59e0b":"#10b981"}),u.searchQuery&&n.selectAll("text").each(function(e){const t=M(this),r=t.text(),n=u.searchQuery.toLowerCase();r.toLowerCase().includes(n)&&t.attr("fill","#1f2937")}),b&&t.style("opacity",0).transition().duration(300).style("opacity",1)},[T,a,u,b,D]);const O=w.reduce((e,t)=>e+(t.isGroupHeader?40:80),0);return e.jsxs("div",{ref:d,className:"d3-list-view w-full h-full flex flex-col bg-white",children:[e.jsxs("div",{className:"flex-shrink-0 flex items-center gap-3 px-4 py-3 border-b "+("NeXTSTEP"===a?"border-[#c0c0c0]":"border-gray-200"),style:{height:60},children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(o,{size:16,className:"text-gray-400"})}),e.jsx("input",{type:"text",value:u.searchQuery,onChange:e=>S(e.target.value),placeholder:"Search by title, content, or metadata...",className:"w-full pl-10 pr-10 py-2 text-sm border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 "+("NeXTSTEP"===a?"border-[#c0c0c0] bg-white":"border-gray-300 bg-white")}),u.searchQuery&&e.jsx("button",{onClick:E,className:"absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-600",children:e.jsx(l,{size:16})})]}),e.jsxs("button",{onClick:N,className:"flex items-center gap-2 px-3 py-2 text-sm font-medium rounded-md transition-colors "+("NeXTSTEP"===a?"bg-[#e8e8e8] text-gray-700 hover:bg-[#d8d8d8]":"bg-gray-100 text-gray-700 hover:bg-gray-200"),title:"Sort "+("asc"===u.sortDirection?"ascending":"descending"),children:[e.jsx(c,{size:16}),"asc"===u.sortDirection?"":""]}),e.jsx("button",{onClick:C,className:"px-3 py-2 text-sm font-medium rounded-md transition-colors "+(u.groupingEnabled?"NeXTSTEP"===a?"bg-[#0066cc] text-white":"bg-blue-600 text-white":"NeXTSTEP"===a?"bg-[#e8e8e8] text-gray-700 hover:bg-[#d8d8d8]":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:u.groupingEnabled?"Grouped":"Flat"})]}),e.jsx("div",{className:"flex-1 overflow-auto",onScroll:I,style:{height:p},children:e.jsx("div",{style:{height:O,position:"relative"},children:e.jsx("svg",{ref:i,className:"absolute inset-0 w-full",style:{height:p}})})}),e.jsx("div",{className:"flex-shrink-0 px-4 py-2 text-xs border-t "+("NeXTSTEP"===a?"border-[#c0c0c0] bg-[#f5f5f5] text-gray-600":"border-gray-200 bg-gray-50 text-gray-600"),children:u.searchQuery?e.jsxs("span",{children:[v.reduce((e,t)=>e+t.nodes.length,0)," of ",t.length,' items match "',u.searchQuery,'"']}):e.jsxs("span",{children:[t.length," items ",u.groupingEnabled?`in ${y.length} groups`:""]})})]})}const an=[{id:"folder",label:"Folder"},{id:"status",label:"Status"},{id:"priority",label:"Priority"},{id:"nodeType",label:"Type"},{id:"tags",label:"Tags"}],on=[{id:"=",label:"equals"},{id:"!=",label:"not equals"},{id:">",label:"greater than"},{id:"<",label:"less than"},{id:"contains",label:"contains"}];function ln(){const{filters:t,addFilter:n,removeFilter:s,clearFilters:a}=ht(),{theme:i}=Ze(),[o,l]=r.useState(!1),[c,d]=r.useState({field:"folder",operator:"=",value:""}),u="NeXTSTEP"===i?"inline-flex items-center gap-1 px-2 py-0.5 text-xs bg-white border border-[#808080]":"inline-flex items-center gap-1 px-2 py-0.5 text-xs bg-blue-100 text-blue-800 rounded-full",h="NeXTSTEP"===i?"px-2 py-1 text-xs bg-[#c0c0c0] border-t border-l border-[#e8e8e8] border-b border-r border-[#707070] hover:bg-[#d0d0d0]":"px-2 py-1 text-xs bg-gray-100 hover:bg-gray-200 rounded border border-gray-300",g="NeXTSTEP"===i?"px-2 py-1 text-xs bg-white border border-[#808080]":"px-2 py-1 text-xs bg-white border border-gray-300 rounded focus:ring-2 focus:ring-blue-500";return 0!==t.length||o?e.jsxs("div",{className:"flex flex-wrap items-center gap-2 px-3 py-2 "+("NeXTSTEP"===i?"bg-[#d4d4d4] border-b border-[#808080]":"bg-gray-50 border-b border-gray-200"),children:[t.map((t,r)=>e.jsxs("span",{className:u,children:[e.jsx("span",{className:"font-medium",children:t.field}),e.jsx("span",{className:"opacity-70",children:t.operator}),e.jsx("span",{children:String(t.value)}),e.jsx("button",{onClick:()=>s(r),className:"ml-1 hover:text-red-600",children:""})]},r)),o?e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("select",{value:c.field,onChange:e=>d(t=>({...t,field:e.target.value})),className:g,children:an.map(t=>e.jsx("option",{value:t.id,children:t.label},t.id))}),e.jsx("select",{value:c.operator,onChange:e=>d(t=>({...t,operator:e.target.value})),className:g,children:on.map(t=>e.jsx("option",{value:t.id,children:t.label},t.id))}),e.jsx("input",{type:"text",value:String(c.value??""),onChange:e=>d(t=>({...t,value:e.target.value})),placeholder:"Value...",className:g}),e.jsx("button",{onClick:()=>{c.field&&c.operator&&void 0!==c.value&&(n(c),d({field:"folder",operator:"=",value:""}),l(!1))},className:h,children:"Add"}),e.jsx("button",{onClick:()=>l(!1),className:h,children:"Cancel"})]}):e.jsx("button",{onClick:()=>l(!0),className:h,children:"+ Add Filter"}),t.length>0&&e.jsx("button",{onClick:a,className:`ml-auto ${h}`,children:"Clear All"})]}):e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 "+("NeXTSTEP"===i?"bg-[#d4d4d4] border-b border-[#808080]":"bg-gray-50 border-b border-gray-200"),children:[e.jsx("span",{className:"text-xs text-gray-500",children:"No filters active"}),e.jsx("button",{onClick:()=>l(!0),className:h,children:"+ Add Filter"})]})}function cn(){const[t,n]=r.useState(0),[s,a]=r.useState(null),[i,o]=r.useState(!1),{theme:l}=Ze(),{activeView:c}=rt(),{data:d,loading:u}=xt(),h=r.useCallback(e=>{a(e),console.log("Node clicked:",e)},[]);return e.jsxs("div",{className:"flex-1 flex flex-col m-3 overflow-hidden "+("NeXTSTEP"===l?"bg-white border-t-2 border-l-2 border-[#707070] border-b-2 border-r-2 border-b-[#e8e8e8] border-r-[#e8e8e8]":"bg-white rounded-lg shadow-lg border border-gray-200"),children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-1",children:e.jsx(ln,{})}),!1]}),e.jsx("div",{className:"flex-1 overflow-hidden",children:(()=>{if(u)return e.jsx("div",{className:"flex items-center justify-center h-full text-gray-500",children:"Loading notes..."});if(!d||0===d.length)return e.jsx("div",{className:"flex items-center justify-center h-full text-gray-400",children:"No notes found"});if(i)return"List"===c?e.jsx(sn,{data:d,onNodeClick:h}):e.jsx(nn,{data:d,onNodeClick:h});switch(c){case"List":return e.jsx(yr,{data:d,onNodeClick:h});case"Gallery":case"Grid":default:return e.jsx(Cr,{data:d,onNodeClick:h});case"Kanban":return e.jsx(Dr,{data:d,onNodeClick:h});case"Timeline":return e.jsx(Ir,{data:d,onNodeClick:h});case"Calendar":return e.jsx(kr,{data:d,onNodeClick:h});case"Charts":return e.jsx(Lr,{data:d,onNodeClick:h});case"Graphs":return e.jsx(_r,{data:d,onNodeClick:h});case"Tree":return e.jsx($r,{data:d,onNodeClick:h})}})()}),s&&e.jsxs("div",{className:"h-8 flex items-center px-3 text-xs "+("NeXTSTEP"===l?"bg-[#d4d4d4] border-t border-[#808080]":"bg-gray-50 border-t border-gray-200"),children:[e.jsx("span",{className:"font-medium mr-2",children:"Selected:"}),e.jsx("span",{className:"truncate",children:s.name}),e.jsx("button",{onClick:()=>a(null),className:"ml-auto px-2 "+("NeXTSTEP"===l?"hover:bg-[#c0c0c0]":"hover:bg-gray-200 rounded"),children:""})]}),e.jsx("div",{className:"NeXTSTEP"===l?"bg-[#c0c0c0] border-t-2 border-[#808080] flex items-end gap-0.5 px-2 pb-1 pt-2":"bg-gray-50 border-t border-gray-200 flex items-end gap-1 px-2 pb-1 pt-2",children:["Tab 1","Tab 2","Tab 3"].map((r,s)=>e.jsx("button",{onClick:()=>n(s),className:"NeXTSTEP"===l?"px-4 py-1.5 text-sm rounded-t "+(t===s?"bg-white border-t-2 border-l-2 border-r-2 border-[#808080]":"bg-[#b0b0b0] border-t-2 border-l-2 border-r-2 border-[#707070] hover:bg-[#b8b8b8]"):"px-4 py-1.5 text-sm rounded-t-lg "+(t===s?"bg-white text-gray-900 border-t border-l border-r border-gray-200":"bg-gray-100 text-gray-600 hover:bg-gray-200"),children:r},s))})]})}const dn={sm:"w-6 h-6",md:"w-7 h-7",lg:"w-9 h-9"},un={sm:"w-3 h-3",md:"w-4 h-4",lg:"w-5 h-5"},hn={default:"\n    bg-[#d4d4d4]\n    border-t-2 border-l-2 border-[#ffffff]\n    border-b-2 border-r-2 border-b-[#707070] border-r-[#707070]\n    active:border-t-[#707070] active:border-l-[#707070]\n    active:border-b-[#ffffff] active:border-r-[#ffffff]\n  ",ghost:"\n    bg-transparent\n    border-2 border-transparent\n    hover:bg-[#c8c8c8]\n  ",active:"\n    bg-[#b0b0b0]\n    border-t-2 border-l-2 border-[#707070]\n    border-b-2 border-r-2 border-b-[#ffffff] border-r-[#ffffff]\n  "},gn={default:"\n    bg-white\n    rounded-lg border border-gray-300\n    hover:bg-gray-50 active:bg-gray-100\n    shadow-sm\n  ",ghost:"\n    bg-transparent\n    rounded-lg border border-transparent\n    hover:bg-gray-100 active:bg-gray-200\n  ",active:"\n    bg-blue-100\n    rounded-lg border border-blue-300\n    text-blue-600\n  "},fn=r.forwardRef(({icon:t,variant:r="default",size:n="md",label:s,active:a=!1,className:i="",disabled:o,...l},c)=>{const{theme:d}=Ze(),u=a?"active":r,h="NeXTSTEP"===d?hn[u]:gn[u],g="NeXTSTEP"===d?"text-[#404040]":"active"===u?"text-blue-600":"text-gray-600";return e.jsx("button",{ref:c,disabled:o,"aria-label":s,title:s,className:`\n          inline-flex items-center justify-center\n          transition-colors duration-150\n          ${dn[n]}\n          ${h}\n          ${g}\n          ${o?"opacity-50 cursor-not-allowed":""}\n          ${i}\n        `,...l,children:e.jsx("span",{className:un[n],children:t})})});function pn(){const[t,n]=r.useState(null),{theme:s,setTheme:a}=Ze(),i=[{label:"Isometry",items:[{label:"About Isometry",_action:()=>console.log("About")},{separator:!0},{label:"Settings",submenu:[{label:"Theme",submenu:[{label:"NeXTSTEP",_action:()=>a("NeXTSTEP")},{label:"Modern",_action:()=>a("Modern")}]}]},{separator:!0},{label:"Quit Isometry",_action:()=>console.log("Quit")}]},{label:"File",items:[{label:"New",_action:()=>console.log("New")},{label:"Open",_action:()=>console.log("Open")},{separator:!0},{label:"Save As",_action:()=>console.log("Save As")}]},{label:"Edit",items:[{label:"Undo",_action:()=>console.log("Undo")},{label:"Redo",_action:()=>console.log("Redo")},{separator:!0},{label:"Cut",_action:()=>console.log("Cut")},{label:"Copy",_action:()=>console.log("Copy")},{label:"Paste",_action:()=>console.log("Paste")}]},{label:"View",items:[{label:"Workbench",_action:()=>console.log("Workbench")},{label:"Apps",_action:()=>console.log("Apps")},{label:"Datasets",_action:()=>console.log("Datasets")}]}],o=[{icon:g,_label:"New",action:()=>console.log("New")},{icon:f,_label:"Open",action:()=>console.log("Open")},{icon:p,_label:"Save",action:()=>console.log("Save")},{icon:m,_label:"Export",action:()=>console.log("Export")}],l=[{icon:b,_label:"Grid View",action:()=>console.log("Grid View")},{icon:x,_label:"Dimensions",action:()=>console.log("Dimensions")},{icon:y,_label:"Charts",action:()=>console.log("Charts")}];return e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"h-7 flex items-center px-1 "+("NeXTSTEP"===s?"bg-[#c0c0c0] border-b-2 border-[#505050]":"bg-white/80 backdrop-blur-xl border-b border-gray-200"),children:[e.jsx("div",{className:"flex items-center",children:i.map(r=>e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>n(t===r.label?null:r.label),className:"px-3 py-0.5 text-sm "+("NeXTSTEP"===s?t===r.label?"bg-black text-white":"hover:bg-[#a0a0a0]":t===r.label?"bg-blue-500 text-white rounded":"hover:bg-gray-100 rounded"),children:r.label}),t===r.label&&e.jsx("div",{className:"absolute top-full left-0 mt-0 min-w-[160px] z-50 "+("NeXTSTEP"===s?"bg-[#d4d4d4] border-2 border-black shadow-lg":"bg-white/95 backdrop-blur-xl rounded-lg border border-gray-200 shadow-2xl"),children:r.items.map((t,r)=>t.separator?e.jsx("div",{className:"my-1 "+("NeXTSTEP"===s?"border-t border-gray-500":"border-t border-gray-200")},r):e.jsx("button",{onClick:()=>{t.action?.(),n(null)},className:"w-full px-4 py-1.5 text-left text-sm "+("NeXTSTEP"===s?"hover:bg-black hover:text-white":"hover:bg-blue-500 hover:text-white rounded-md mx-1"),children:t.label},r))})]},r.label))}),e.jsx("div",{className:"flex-1"}),e.jsxs("div",{className:"flex items-center gap-1 mr-1",children:[e.jsx("button",{onClick:()=>a("NeXTSTEP"),className:"px-3 py-0.5 text-xs "+("NeXTSTEP"===s?"bg-black text-white":"bg-gray-100 hover:bg-gray-200 rounded"),children:"NeXTSTEP"}),e.jsx("button",{onClick:()=>a("Modern"),className:"px-3 py-0.5 text-xs "+("Modern"===s?"bg-blue-500 text-white rounded":"bg-gray-100 hover:bg-gray-200 rounded"),children:"Modern"})]})]}),e.jsxs("div",{className:"h-12 flex items-center px-2 gap-1 "+("NeXTSTEP"===s?"bg-[#c0c0c0] border-b-2 border-[#505050]":"bg-white/50 backdrop-blur-xl border-b border-gray-200"),children:[o.map((t,r)=>e.jsx(fn,{icon:e.jsx(t.icon,{className:"w-5 h-5"}),label:t.label,onClick:t.action,variant:"ghost",className:"w-10 h-10"},r)),e.jsx("div",{className:"NeXTSTEP"===s?"w-[3px] h-8 bg-[#808080] mx-1":"w-px h-8 bg-gray-300 mx-2"}),l.map((t,r)=>e.jsx(fn,{icon:e.jsx(t.icon,{className:"w-5 h-5"}),label:t.label,onClick:t.action,variant:"ghost",className:"w-10 h-10"},r)),e.jsx("div",{className:"flex-1"})]})]})}fn.displayName="IconButton";const mn=r.createContext({dragDropManager:void 0});function bn(e){return"Minified Redux error #"+e+"; visit https://redux.js.org/Errors?code="+e+" for the full message or use the non-minified dev environment for full errors. "}var xn="function"==typeof Symbol&&Symbol.observable||"@@observable",yn=function(){return Math.random().toString(36).substring(7).split("").join(".")},vn={INIT:"@@redux/INIT"+yn(),REPLACE:"@@redux/REPLACE"+yn()};function wn(e,t,r){var n;if("function"==typeof t&&"function"==typeof r||"function"==typeof r&&"function"==typeof arguments[3])throw new Error(bn(0));if("function"==typeof t&&void 0===r&&(r=t,t=void 0),void 0!==r){if("function"!=typeof r)throw new Error(bn(1));return r(wn)(e,t)}if("function"!=typeof e)throw new Error(bn(2));var s=e,a=t,i=[],o=i,l=!1;function c(){o===i&&(o=i.slice())}function d(){if(l)throw new Error(bn(3));return a}function u(e){if("function"!=typeof e)throw new Error(bn(4));if(l)throw new Error(bn(5));var t=!0;return c(),o.push(e),function(){if(t){if(l)throw new Error(bn(6));t=!1,c();var r=o.indexOf(e);o.splice(r,1),i=null}}}function h(e){if(!function(e){if("object"!=typeof e||null===e)return!1;for(var t=e;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}(e))throw new Error(bn(7));if(void 0===e.type)throw new Error(bn(8));if(l)throw new Error(bn(9));try{l=!0,a=s(a,e)}finally{l=!1}for(var t=i=o,r=0;r<t.length;r++){(0,t[r])()}return e}return h({type:vn.INIT}),(n={dispatch:h,subscribe:u,getState:d,replaceReducer:function(e){if("function"!=typeof e)throw new Error(bn(10));s=e,h({type:vn.REPLACE})}})[xn]=function(){var e,t=u;return(e={subscribe:function(e){if("object"!=typeof e||null===e)throw new Error(bn(11));function r(){e.next&&e.next(d())}return r(),{unsubscribe:t(r)}}})[xn]=function(){return this},e},n}function Tn(e,t,...r){if("undefined"!=typeof process&&void 0===t)throw new Error("invariant requires an error message argument");if(!e){let e;if(void 0===t)e=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{let n=0;e=new Error(t.replace(/%s/g,function(){return r[n++]})),e.name="Invariant Violation"}throw e.framesToPop=1,e}}function Sn(e){return"object"==typeof e}const En="dnd-core/INIT_COORDS",Nn="dnd-core/BEGIN_DRAG",Cn="dnd-core/PUBLISH_DRAG_SOURCE",jn="dnd-core/HOVER",Dn="dnd-core/DROP",In="dnd-core/END_DRAG";function kn(e,t){return{type:En,payload:{sourceClientOffset:t||null,clientOffset:e||null}}}const On={type:En,payload:{clientOffset:null,sourceClientOffset:null}};function Pn(e){return function(t=[],r={publishSource:!0}){const{publishSource:n=!0,clientOffset:s,getSourceClientOffset:a}=r,i=e.getMonitor(),o=e.getRegistry();e.dispatch(kn(s)),function(e,t,r){Tn(!t.isDragging(),"Cannot call beginDrag while dragging."),e.forEach(function(e){Tn(r.getSource(e),"Expected sourceIds to be registered.")})}(t,i,o);const l=function(e,t){let r=null;for(let n=e.length-1;n>=0;n--)if(t.canDragSource(e[n])){r=e[n];break}return r}(t,i);if(null==l)return void e.dispatch(On);let c=null;if(s){if(!a)throw new Error("getSourceClientOffset must be defined");!function(e){Tn("function"==typeof e,"When clientOffset is provided, getSourceClientOffset must be a function.")}(a),c=a(l)}e.dispatch(kn(s,c));const d=o.getSource(l).beginDrag(i,l);if(null==d)return;!function(e){Tn(Sn(e),"Item must be an object.")}(d),o.pinSource(l);const u=o.getSourceType(l);return{type:Nn,payload:{itemType:u,item:d,sourceId:l,clientOffset:s||null,sourceClientOffset:c||null,isSourcePublic:!!n}}}}function Rn(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Mn(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){Rn(e,t,r[t])})}return e}function An(e){return function(t={}){const r=e.getMonitor(),n=e.getRegistry();!function(e){Tn(e.isDragging(),"Cannot call drop while not dragging."),Tn(!e.didDrop(),"Cannot call drop twice during one drag operation.")}(r);const s=function(e){const t=e.getTargetIds().filter(e.canDropOnTarget,e);return t.reverse(),t}(r);s.forEach((s,a)=>{const i=function(e,t,r,n){const s=r.getTarget(e);let a=s?s.drop(n,e):void 0;(function(e){Tn(void 0===e||Sn(e),"Drop result must either be an object or undefined.")})(a),void 0===a&&(a=0===t?{}:n.getDropResult());return a}(s,a,n,r),o={type:Dn,payload:{dropResult:Mn({},t,i)}};e.dispatch(o)})}}function Ln(e){return function(){const t=e.getMonitor(),r=e.getRegistry();!function(e){Tn(e.isDragging(),"Cannot call endDrag while not dragging.")}(t);const n=t.getSourceId();if(null!=n){r.getSource(n,!0).endDrag(t,n),r.unpinSource()}return{type:In}}}function _n(e,t){return null===t?null===e:Array.isArray(e)?e.some(e=>e===t):e===t}function $n(e){return function(t,{clientOffset:r}={}){!function(e){Tn(Array.isArray(e),"Expected targetIds to be an array.")}(t);const n=t.slice(0),s=e.getMonitor(),a=e.getRegistry();return function(e,t,r){for(let n=e.length-1;n>=0;n--){const s=e[n];_n(t.getTargetType(s),r)||e.splice(n,1)}}(n,a,s.getItemType()),function(e,t,r){Tn(t.isDragging(),"Cannot call hover while not dragging."),Tn(!t.didDrop(),"Cannot call hover after drop.");for(let n=0;n<e.length;n++){const t=e[n];Tn(e.lastIndexOf(t)===n,"Expected targetIds to be unique in the passed array.");Tn(r.getTarget(t),"Expected targetIds to be registered.")}}(n,s,a),function(e,t,r){e.forEach(function(e){r.getTarget(e).hover(t,e)})}(n,s,a),{type:jn,payload:{targetIds:n,clientOffset:r||null}}}}function Fn(e){return function(){if(e.getMonitor().isDragging())return{type:Cn}}}class Un{receiveBackend(e){this.backend=e}getMonitor(){return this.monitor}getBackend(){return this.backend}getRegistry(){return this.monitor.registry}getActions(){const e=this,{dispatch:t}=this.store;const r=function(e){return{beginDrag:Pn(e),publishDragSource:Fn(e),hover:$n(e),drop:An(e),endDrag:Ln(e)}}(this);return Object.keys(r).reduce((n,s)=>{const a=r[s];var i;return n[s]=(i=a,(...r)=>{const n=i.apply(e,r);void 0!==n&&t(n)}),n},{})}dispatch(e){this.store.dispatch(e)}constructor(e,t){this.isSetUp=!1,this.handleRefCountChange=()=>{const e=this.store.getState().refCount>0;this.backend&&(e&&!this.isSetUp?(this.backend.setup(),this.isSetUp=!0):!e&&this.isSetUp&&(this.backend.teardown(),this.isSetUp=!1))},this.store=e,this.monitor=t,e.subscribe(this.handleRefCountChange)}}function Hn(e,t){return{x:e.x-t.x,y:e.y-t.y}}const Xn=[],zn=[];Xn.__IS_NONE__=!0,zn.__IS_ALL__=!0;class Vn{subscribeToStateChange(e,t={}){const{handlerIds:r}=t;Tn("function"==typeof e,"listener must be a function."),Tn(void 0===r||Array.isArray(r),"handlerIds, when specified, must be an array of strings.");let n=this.store.getState().stateId;return this.store.subscribe(()=>{const t=this.store.getState(),s=t.stateId;try{const a=s===n||s===n+1&&!function(e,t){return e!==Xn&&(e===zn||void 0===t||(r=e,t.filter(e=>r.indexOf(e)>-1)).length>0);var r}(t.dirtyHandlerIds,r);a||e()}finally{n=s}})}subscribeToOffsetChange(e){Tn("function"==typeof e,"listener must be a function.");let t=this.store.getState().dragOffset;return this.store.subscribe(()=>{const r=this.store.getState().dragOffset;r!==t&&(t=r,e())})}canDragSource(e){if(!e)return!1;const t=this.registry.getSource(e);return Tn(t,`Expected to find a valid source. sourceId=${e}`),!this.isDragging()&&t.canDrag(this,e)}canDropOnTarget(e){if(!e)return!1;const t=this.registry.getTarget(e);if(Tn(t,`Expected to find a valid target. targetId=${e}`),!this.isDragging()||this.didDrop())return!1;return _n(this.registry.getTargetType(e),this.getItemType())&&t.canDrop(this,e)}isDragging(){return Boolean(this.getItemType())}isDraggingSource(e){if(!e)return!1;const t=this.registry.getSource(e,!0);if(Tn(t,`Expected to find a valid source. sourceId=${e}`),!this.isDragging()||!this.isSourcePublic())return!1;return this.registry.getSourceType(e)===this.getItemType()&&t.isDragging(this,e)}isOverTarget(e,t={shallow:!1}){if(!e)return!1;const{shallow:r}=t;if(!this.isDragging())return!1;const n=this.registry.getTargetType(e),s=this.getItemType();if(s&&!_n(n,s))return!1;const a=this.getTargetIds();if(!a.length)return!1;const i=a.indexOf(e);return r?i===a.length-1:i>-1}getItemType(){return this.store.getState().dragOperation.itemType}getItem(){return this.store.getState().dragOperation.item}getSourceId(){return this.store.getState().dragOperation.sourceId}getTargetIds(){return this.store.getState().dragOperation.targetIds}getDropResult(){return this.store.getState().dragOperation.dropResult}didDrop(){return this.store.getState().dragOperation.didDrop}isSourcePublic(){return Boolean(this.store.getState().dragOperation.isSourcePublic)}getInitialClientOffset(){return this.store.getState().dragOffset.initialClientOffset}getInitialSourceClientOffset(){return this.store.getState().dragOffset.initialSourceClientOffset}getClientOffset(){return this.store.getState().dragOffset.clientOffset}getSourceClientOffset(){return function(e){const{clientOffset:t,initialClientOffset:r,initialSourceClientOffset:n}=e;return t&&r&&n?Hn((a=n,{x:(s=t).x+a.x,y:s.y+a.y}),r):null;var s,a}(this.store.getState().dragOffset)}getDifferenceFromInitialOffset(){return function(e){const{clientOffset:t,initialClientOffset:r}=e;return t&&r?Hn(t,r):null}(this.store.getState().dragOffset)}constructor(e,t){this.store=e,this.registry=t}}const Wn="undefined"!=typeof global?global:self,Bn=Wn.MutationObserver||Wn.WebKitMutationObserver;function qn(e){return function(){const t=setTimeout(n,0),r=setInterval(n,50);function n(){clearTimeout(t),clearInterval(r),e()}}}const Gn="function"==typeof Bn?function(e){let t=1;const r=new Bn(e),n=document.createTextNode("");return r.observe(n,{characterData:!0}),function(){t=-t,n.data=t}}:qn;class Kn{call(){try{this.task&&this.task()}catch(e){this.onError(e)}finally{this.task=null,this.release(this)}}constructor(e,t){this.onError=e,this.release=t,this.task=null}}const Yn=new class{enqueueTask(e){const{queue:t,requestFlush:r}=this;t.length||(r(),this.flushing=!0),t[t.length]=e}constructor(){this.queue=[],this.pendingErrors=[],this.flushing=!1,this.index=0,this.capacity=1024,this.flush=()=>{const{queue:e}=this;for(;this.index<e.length;){const t=this.index;if(this.index++,e[t].call(),this.index>this.capacity){for(let t=0,r=e.length-this.index;t<r;t++)e[t]=e[t+this.index];e.length-=this.index,this.index=0}}e.length=0,this.index=0,this.flushing=!1},this.registerPendingError=e=>{this.pendingErrors.push(e),this.requestErrorThrow()},this.requestFlush=Gn(this.flush),this.requestErrorThrow=qn(()=>{if(this.pendingErrors.length)throw this.pendingErrors.shift()})}},Qn=new class{create(e){const t=this.freeTasks,r=t.length?t.pop():new Kn(this.onError,e=>t[t.length]=e);return r.task=e,r}constructor(e){this.onError=e,this.freeTasks=[]}}(Yn.registerPendingError);const Zn="dnd-core/ADD_SOURCE",Jn="dnd-core/ADD_TARGET",es="dnd-core/REMOVE_SOURCE",ts="dnd-core/REMOVE_TARGET";function rs(e,t){t&&Array.isArray(e)?e.forEach(e=>rs(e,!1)):Tn("string"==typeof e||"symbol"==typeof e,t?"Type can only be a string, a symbol, or an array of either.":"Type can only be a string or a symbol.")}var ns;!function(e){e.SOURCE="SOURCE",e.TARGET="TARGET"}(ns||(ns={}));let ss=0;function as(e){const t=(ss++).toString();switch(e){case ns.SOURCE:return`S${t}`;case ns.TARGET:return`T${t}`;default:throw new Error(`Unknown Handler Role: ${e}`)}}function is(e){switch(e[0]){case"S":return ns.SOURCE;case"T":return ns.TARGET;default:throw new Error(`Cannot parse handler ID: ${e}`)}}function os(e,t){const r=e.entries();let n=!1;do{const{done:e,value:[,s]}=r.next();if(s===t)return!0;n=!!e}while(!n);return!1}class ls{addSource(e,t){rs(e),function(e){Tn("function"==typeof e.canDrag,"Expected canDrag to be a function."),Tn("function"==typeof e.beginDrag,"Expected beginDrag to be a function."),Tn("function"==typeof e.endDrag,"Expected endDrag to be a function.")}(t);const r=this.addHandler(ns.SOURCE,e,t);return this.store.dispatch(function(e){return{type:Zn,payload:{sourceId:e}}}(r)),r}addTarget(e,t){rs(e,!0),function(e){Tn("function"==typeof e.canDrop,"Expected canDrop to be a function."),Tn("function"==typeof e.hover,"Expected hover to be a function."),Tn("function"==typeof e.drop,"Expected beginDrag to be a function.")}(t);const r=this.addHandler(ns.TARGET,e,t);return this.store.dispatch(function(e){return{type:Jn,payload:{targetId:e}}}(r)),r}containsHandler(e){return os(this.dragSources,e)||os(this.dropTargets,e)}getSource(e,t=!1){Tn(this.isSourceId(e),"Expected a valid source ID.");return t&&e===this.pinnedSourceId?this.pinnedSource:this.dragSources.get(e)}getTarget(e){return Tn(this.isTargetId(e),"Expected a valid target ID."),this.dropTargets.get(e)}getSourceType(e){return Tn(this.isSourceId(e),"Expected a valid source ID."),this.types.get(e)}getTargetType(e){return Tn(this.isTargetId(e),"Expected a valid target ID."),this.types.get(e)}isSourceId(e){return is(e)===ns.SOURCE}isTargetId(e){return is(e)===ns.TARGET}removeSource(e){var t;Tn(this.getSource(e),"Expected an existing source."),this.store.dispatch(function(e){return{type:es,payload:{sourceId:e}}}(e)),t=()=>{this.dragSources.delete(e),this.types.delete(e)},Yn.enqueueTask(Qn.create(t))}removeTarget(e){Tn(this.getTarget(e),"Expected an existing target."),this.store.dispatch(function(e){return{type:ts,payload:{targetId:e}}}(e)),this.dropTargets.delete(e),this.types.delete(e)}pinSource(e){const t=this.getSource(e);Tn(t,"Expected an existing source."),this.pinnedSourceId=e,this.pinnedSource=t}unpinSource(){Tn(this.pinnedSource,"No source is pinned at the time."),this.pinnedSourceId=null,this.pinnedSource=null}addHandler(e,t,r){const n=as(e);return this.types.set(n,t),e===ns.SOURCE?this.dragSources.set(n,r):e===ns.TARGET&&this.dropTargets.set(n,r),n}constructor(e){this.types=new Map,this.dragSources=new Map,this.dropTargets=new Map,this.pinnedSourceId=null,this.pinnedSource=null,this.store=e}}const cs=(e,t)=>e===t;function ds(e=Xn,t){switch(t.type){case jn:break;case Zn:case Jn:case ts:case es:return Xn;default:return zn}const{targetIds:r=[],prevTargetIds:n=[]}=t.payload,s=function(e,t){const r=new Map,n=e=>{r.set(e,r.has(e)?r.get(e)+1:1)};e.forEach(n),t.forEach(n);const s=[];return r.forEach((e,t)=>{1===e&&s.push(t)}),s}(r,n),a=s.length>0||!function(e,t,r=cs){if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(!r(e[n],t[n]))return!1;return!0}(r,n);if(!a)return Xn;const i=n[n.length-1],o=r[r.length-1];return i!==o&&(i&&s.push(i),o&&s.push(o)),s}function us(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const hs={initialSourceClientOffset:null,initialClientOffset:null,clientOffset:null};function gs(e=hs,t){const{payload:r}=t;switch(t.type){case En:case Nn:return{initialSourceClientOffset:r.sourceClientOffset,initialClientOffset:r.clientOffset,clientOffset:r.clientOffset};case jn:return n=e.clientOffset,s=r.clientOffset,!n&&!s||n&&s&&n.x===s.x&&n.y===s.y?e:function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){us(e,t,r[t])})}return e}({},e,{clientOffset:r.clientOffset});case In:case Dn:return hs;default:return e}var n,s}function fs(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ps(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){fs(e,t,r[t])})}return e}const ms={itemType:null,item:null,sourceId:null,targetIds:[],dropResult:null,didDrop:!1,isSourcePublic:null};function bs(e=ms,t){const{payload:r}=t;switch(t.type){case Nn:return ps({},e,{itemType:r.itemType,item:r.item,sourceId:r.sourceId,isSourcePublic:r.isSourcePublic,dropResult:null,didDrop:!1});case Cn:return ps({},e,{isSourcePublic:!0});case jn:return ps({},e,{targetIds:r.targetIds});case ts:return-1===e.targetIds.indexOf(r.targetId)?e:ps({},e,{targetIds:(n=e.targetIds,s=r.targetId,n.filter(e=>e!==s))});case Dn:return ps({},e,{dropResult:r.dropResult,didDrop:!0,targetIds:[]});case In:return ps({},e,{itemType:null,item:null,sourceId:null,dropResult:null,didDrop:!1,isSourcePublic:null,targetIds:[]});default:return e}var n,s}function xs(e=0,t){switch(t.type){case Zn:case Jn:return e+1;case es:case ts:return e-1;default:return e}}function ys(e=0){return e+1}function vs(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ws(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){vs(e,t,r[t])})}return e}function Ts(e={},t){return{dirtyHandlerIds:ds(e.dirtyHandlerIds,{type:t.type,payload:ws({},t.payload,{prevTargetIds:(r=e,n="dragOperation.targetIds",s=[],n.split(".").reduce((e,t)=>e&&e[t]?e[t]:s||null,r))})}),dragOffset:gs(e.dragOffset,t),refCount:xs(e.refCount,t),dragOperation:bs(e.dragOperation,t),stateId:ys(e.stateId)};var r,n,s}function Ss(e,t=void 0,r={},n=!1){const s=function(e){const t="undefined"!=typeof window&&window.__REDUX_DEVTOOLS_EXTENSION__;return wn(Ts,e&&t&&t({name:"dnd-core",instanceId:"dnd-core"}))}(n),a=new Vn(s,new ls(s)),i=new Un(s,a),o=e(i,t,r);return i.receiveBackend(o),i}function Es(e,t){if(null==e)return{};var r,n,s=function(e,t){if(null==e)return{};var r,n,s={},a=Object.keys(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||(s[r]=e[r]);return s}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(s[r]=e[r])}return s}let Ns=0;const Cs=Symbol.for("__REACT_DND_CONTEXT_INSTANCE__");var js,Ds,Is=r.memo(function(t){var{children:n}=t,s=Es(t,["children"]);const[a,i]=function(e){if("manager"in e){return[{dragDropManager:e.manager},!1]}const t=function(e,t=ks(),r,n){const s=t;s[Cs]||(s[Cs]={dragDropManager:Ss(e,t,r,n)});return s[Cs]}(e.backend,e.context,e.options,e.debugMode),r=!e.context;return[t,r]}(s);return r.useEffect(()=>{if(i){const e=ks();return++Ns,()=>{0===--Ns&&(e[Cs]=null)}}},[]),e.jsx(mn.Provider,{value:a,children:n})});function ks(){return"undefined"!=typeof global?global:window}var Os=(Ds||(Ds=1,js=function e(t,r){if(t===r)return!0;if(t&&r&&"object"==typeof t&&"object"==typeof r){if(t.constructor!==r.constructor)return!1;var n,s,a;if(Array.isArray(t)){if((n=t.length)!=r.length)return!1;for(s=n;0!==s--;)if(!e(t[s],r[s]))return!1;return!0}if(t.constructor===RegExp)return t.source===r.source&&t.flags===r.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===r.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===r.toString();if((n=(a=Object.keys(t)).length)!==Object.keys(r).length)return!1;for(s=n;0!==s--;)if(!Object.prototype.hasOwnProperty.call(r,a[s]))return!1;for(s=n;0!==s--;){var i=a[s];if(!e(t[i],r[i]))return!1}return!0}return t!=t&&r!=r}),js);const Ps=t(Os),Rs="undefined"!=typeof window?r.useLayoutEffect:r.useEffect;function Ms(e,t,n){const[s,a]=function(e,t,n){const[s,a]=r.useState(()=>t(e)),i=r.useCallback(()=>{const r=t(e);Ps(s,r)||(a(r),n&&n())},[s,e,n]);return Rs(i),[s,i]}(e,t,n);return Rs(function(){const t=e.getHandlerId();if(null!=t)return e.subscribeToStateChange(a,{handlerIds:[t]})},[e,a]),s}function As(e,t,r){return Ms(t,e||(()=>({})),()=>r.reconnect())}function Ls(e,t){const n=[];return"function"!=typeof e&&n.push(e),r.useMemo(()=>"function"==typeof e?e():e,n)}function _s(e){return r.useMemo(()=>e.hooks.dragSource(),[e])}function $s(e){return r.useMemo(()=>e.hooks.dragPreview(),[e])}let Fs=!1,Us=!1;class Hs{receiveHandlerId(e){this.sourceId=e}getHandlerId(){return this.sourceId}canDrag(){Tn(!Fs,"You may not call monitor.canDrag() inside your canDrag() implementation. Read more: http://react-dnd.github.io/react-dnd/docs/api/drag-source-monitor");try{return Fs=!0,this.internalMonitor.canDragSource(this.sourceId)}finally{Fs=!1}}isDragging(){if(!this.sourceId)return!1;Tn(!Us,"You may not call monitor.isDragging() inside your isDragging() implementation. Read more: http://react-dnd.github.io/react-dnd/docs/api/drag-source-monitor");try{return Us=!0,this.internalMonitor.isDraggingSource(this.sourceId)}finally{Us=!1}}subscribeToStateChange(e,t){return this.internalMonitor.subscribeToStateChange(e,t)}isDraggingSource(e){return this.internalMonitor.isDraggingSource(e)}isOverTarget(e,t){return this.internalMonitor.isOverTarget(e,t)}getTargetIds(){return this.internalMonitor.getTargetIds()}isSourcePublic(){return this.internalMonitor.isSourcePublic()}getSourceId(){return this.internalMonitor.getSourceId()}subscribeToOffsetChange(e){return this.internalMonitor.subscribeToOffsetChange(e)}canDragSource(e){return this.internalMonitor.canDragSource(e)}canDropOnTarget(e){return this.internalMonitor.canDropOnTarget(e)}getItemType(){return this.internalMonitor.getItemType()}getItem(){return this.internalMonitor.getItem()}getDropResult(){return this.internalMonitor.getDropResult()}didDrop(){return this.internalMonitor.didDrop()}getInitialClientOffset(){return this.internalMonitor.getInitialClientOffset()}getInitialSourceClientOffset(){return this.internalMonitor.getInitialSourceClientOffset()}getSourceClientOffset(){return this.internalMonitor.getSourceClientOffset()}getClientOffset(){return this.internalMonitor.getClientOffset()}getDifferenceFromInitialOffset(){return this.internalMonitor.getDifferenceFromInitialOffset()}constructor(e){this.sourceId=null,this.internalMonitor=e.getMonitor()}}let Xs=!1;class zs{receiveHandlerId(e){this.targetId=e}getHandlerId(){return this.targetId}subscribeToStateChange(e,t){return this.internalMonitor.subscribeToStateChange(e,t)}canDrop(){if(!this.targetId)return!1;Tn(!Xs,"You may not call monitor.canDrop() inside your canDrop() implementation. Read more: http://react-dnd.github.io/react-dnd/docs/api/drop-target-monitor");try{return Xs=!0,this.internalMonitor.canDropOnTarget(this.targetId)}finally{Xs=!1}}isOver(e){return!!this.targetId&&this.internalMonitor.isOverTarget(this.targetId,e)}getItemType(){return this.internalMonitor.getItemType()}getItem(){return this.internalMonitor.getItem()}getDropResult(){return this.internalMonitor.getDropResult()}didDrop(){return this.internalMonitor.didDrop()}getInitialClientOffset(){return this.internalMonitor.getInitialClientOffset()}getInitialSourceClientOffset(){return this.internalMonitor.getInitialSourceClientOffset()}getSourceClientOffset(){return this.internalMonitor.getSourceClientOffset()}getClientOffset(){return this.internalMonitor.getClientOffset()}getDifferenceFromInitialOffset(){return this.internalMonitor.getDifferenceFromInitialOffset()}constructor(e){this.targetId=null,this.internalMonitor=e.getMonitor()}}function Vs(e,t,r,n){let s;if(void 0!==s)return!!s;if(e===t)return!0;if("object"!=typeof e||!e||"object"!=typeof t||!t)return!1;const a=Object.keys(e),i=Object.keys(t);if(a.length!==i.length)return!1;const o=Object.prototype.hasOwnProperty.bind(t);for(let l=0;l<a.length;l++){const r=a[l];if(!o(r))return!1;const n=e[r],i=t[r];if(s=void 0,!1===s||void 0===s&&n!==i)return!1}return!0}function Ws(e){return null!==e&&"object"==typeof e&&Object.prototype.hasOwnProperty.call(e,"current")}function Bs(e){return(t=null,n=null)=>{if(!r.isValidElement(t)){const r=t;return e(r,n),r}const s=t;!function(e){if("string"==typeof e.type)return;const t=e.type.displayName||e.type.name||"the component";throw new Error(`Only native element nodes can now be passed to React DnD connectors.You can either wrap ${t} into a <div>, or turn it into a drag source or a drop target itself.`)}(s);return function(e,t){const n=e.ref;return Tn("string"!=typeof n,"Cannot connect React DnD to an element with an existing string ref. Please convert it to use a callback ref instead, or wrap it into a <span> or <div>. Read more: https://reactjs.org/docs/refs-and-the-dom.html#callback-refs"),n?r.cloneElement(e,{ref:e=>{Gs(n,e),Gs(t,e)}}):r.cloneElement(e,{ref:t})}(s,n?t=>e(t,n):e)}}function qs(e){const t={};return Object.keys(e).forEach(r=>{const n=e[r];if(r.endsWith("Ref"))t[r]=e[r];else{const e=Bs(n);t[r]=()=>e}}),t}function Gs(e,t){"function"==typeof e?e(t):e.current=t}class Ks{receiveHandlerId(e){this.handlerId!==e&&(this.handlerId=e,this.reconnect())}get connectTarget(){return this.dragSource}get dragSourceOptions(){return this.dragSourceOptionsInternal}set dragSourceOptions(e){this.dragSourceOptionsInternal=e}get dragPreviewOptions(){return this.dragPreviewOptionsInternal}set dragPreviewOptions(e){this.dragPreviewOptionsInternal=e}reconnect(){const e=this.reconnectDragSource();this.reconnectDragPreview(e)}reconnectDragSource(){const e=this.dragSource,t=this.didHandlerIdChange()||this.didConnectedDragSourceChange()||this.didDragSourceOptionsChange();return t&&this.disconnectDragSource(),this.handlerId?e?(t&&(this.lastConnectedHandlerId=this.handlerId,this.lastConnectedDragSource=e,this.lastConnectedDragSourceOptions=this.dragSourceOptions,this.dragSourceUnsubscribe=this.backend.connectDragSource(this.handlerId,e,this.dragSourceOptions)),t):(this.lastConnectedDragSource=e,t):t}reconnectDragPreview(e=!1){const t=this.dragPreview,r=e||this.didHandlerIdChange()||this.didConnectedDragPreviewChange()||this.didDragPreviewOptionsChange();r&&this.disconnectDragPreview(),this.handlerId&&(t?r&&(this.lastConnectedHandlerId=this.handlerId,this.lastConnectedDragPreview=t,this.lastConnectedDragPreviewOptions=this.dragPreviewOptions,this.dragPreviewUnsubscribe=this.backend.connectDragPreview(this.handlerId,t,this.dragPreviewOptions)):this.lastConnectedDragPreview=t)}didHandlerIdChange(){return this.lastConnectedHandlerId!==this.handlerId}didConnectedDragSourceChange(){return this.lastConnectedDragSource!==this.dragSource}didConnectedDragPreviewChange(){return this.lastConnectedDragPreview!==this.dragPreview}didDragSourceOptionsChange(){return!Vs(this.lastConnectedDragSourceOptions,this.dragSourceOptions)}didDragPreviewOptionsChange(){return!Vs(this.lastConnectedDragPreviewOptions,this.dragPreviewOptions)}disconnectDragSource(){this.dragSourceUnsubscribe&&(this.dragSourceUnsubscribe(),this.dragSourceUnsubscribe=void 0)}disconnectDragPreview(){this.dragPreviewUnsubscribe&&(this.dragPreviewUnsubscribe(),this.dragPreviewUnsubscribe=void 0,this.dragPreviewNode=null,this.dragPreviewRef=null)}get dragSource(){return this.dragSourceNode||this.dragSourceRef&&this.dragSourceRef.current}get dragPreview(){return this.dragPreviewNode||this.dragPreviewRef&&this.dragPreviewRef.current}clearDragSource(){this.dragSourceNode=null,this.dragSourceRef=null}clearDragPreview(){this.dragPreviewNode=null,this.dragPreviewRef=null}constructor(e){this.hooks=qs({dragSource:(e,t)=>{this.clearDragSource(),this.dragSourceOptions=t||null,Ws(e)?this.dragSourceRef=e:this.dragSourceNode=e,this.reconnectDragSource()},dragPreview:(e,t)=>{this.clearDragPreview(),this.dragPreviewOptions=t||null,Ws(e)?this.dragPreviewRef=e:this.dragPreviewNode=e,this.reconnectDragPreview()}}),this.handlerId=null,this.dragSourceRef=null,this.dragSourceOptionsInternal=null,this.dragPreviewRef=null,this.dragPreviewOptionsInternal=null,this.lastConnectedHandlerId=null,this.lastConnectedDragSource=null,this.lastConnectedDragSourceOptions=null,this.lastConnectedDragPreview=null,this.lastConnectedDragPreviewOptions=null,this.backend=e}}class Ys{get connectTarget(){return this.dropTarget}reconnect(){const e=this.didHandlerIdChange()||this.didDropTargetChange()||this.didOptionsChange();e&&this.disconnectDropTarget();const t=this.dropTarget;this.handlerId&&(t?e&&(this.lastConnectedHandlerId=this.handlerId,this.lastConnectedDropTarget=t,this.lastConnectedDropTargetOptions=this.dropTargetOptions,this.unsubscribeDropTarget=this.backend.connectDropTarget(this.handlerId,t,this.dropTargetOptions)):this.lastConnectedDropTarget=t)}receiveHandlerId(e){e!==this.handlerId&&(this.handlerId=e,this.reconnect())}get dropTargetOptions(){return this.dropTargetOptionsInternal}set dropTargetOptions(e){this.dropTargetOptionsInternal=e}didHandlerIdChange(){return this.lastConnectedHandlerId!==this.handlerId}didDropTargetChange(){return this.lastConnectedDropTarget!==this.dropTarget}didOptionsChange(){return!Vs(this.lastConnectedDropTargetOptions,this.dropTargetOptions)}disconnectDropTarget(){this.unsubscribeDropTarget&&(this.unsubscribeDropTarget(),this.unsubscribeDropTarget=void 0)}get dropTarget(){return this.dropTargetNode||this.dropTargetRef&&this.dropTargetRef.current}clearDropTarget(){this.dropTargetRef=null,this.dropTargetNode=null}constructor(e){this.hooks=qs({dropTarget:(e,t)=>{this.clearDropTarget(),this.dropTargetOptions=t,Ws(e)?this.dropTargetRef=e:this.dropTargetNode=e,this.reconnect()}}),this.handlerId=null,this.dropTargetRef=null,this.dropTargetOptionsInternal=null,this.lastConnectedHandlerId=null,this.lastConnectedDropTarget=null,this.lastConnectedDropTargetOptions=null,this.backend=e}}function Qs(){const{dragDropManager:e}=r.useContext(mn);return Tn(null!=e,"Expected drag drop context"),e}class Zs{beginDrag(){const e=this.spec,t=this.monitor;let r=null;return r="object"==typeof e.item?e.item:"function"==typeof e.item?e.item(t):{},null!=r?r:null}canDrag(){const e=this.spec,t=this.monitor;return"boolean"==typeof e.canDrag?e.canDrag:"function"!=typeof e.canDrag||e.canDrag(t)}isDragging(e,t){const r=this.spec,n=this.monitor,{isDragging:s}=r;return s?s(n):t===e.getSourceId()}endDrag(){const e=this.spec,t=this.monitor,r=this.connector,{end:n}=e;n&&n(t.getItem(),t),r.reconnect()}constructor(e,t,r){this.spec=e,this.monitor=t,this.connector=r}}function Js(e,t,n){const s=Qs(),a=function(e,t,n){const s=r.useMemo(()=>new Zs(e,t,n),[t,n]);return r.useEffect(()=>{s.spec=e},[e]),s}(e,t,n),i=function(e){return r.useMemo(()=>{const t=e.type;return Tn(null!=t,"spec.type must be defined"),t},[e])}(e);Rs(function(){if(null!=i){const[e,r]=function(e,t,r){const n=r.getRegistry(),s=n.addSource(e,t);return[s,()=>n.removeSource(s)]}(i,a,s);return t.receiveHandlerId(e),n.receiveHandlerId(e),r}},[s,t,n,a,i])}function ea(e,t){const n=Ls(e);Tn(!n.begin,"useDrag::spec.begin was deprecated in v14. Replace spec.begin() with spec.item(). (see more here - https://react-dnd.github.io/react-dnd/docs/api/use-drag)");const s=function(){const e=Qs();return r.useMemo(()=>new Hs(e),[e])}(),a=function(e,t){const n=Qs(),s=r.useMemo(()=>new Ks(n.getBackend()),[n]);return Rs(()=>(s.dragSourceOptions=e||null,s.reconnect(),()=>s.disconnectDragSource()),[s,e]),Rs(()=>(s.dragPreviewOptions=t||null,s.reconnect(),()=>s.disconnectDragPreview()),[s,t]),s}(n.options,n.previewOptions);return Js(n,s,a),[As(n.collect,s,a),_s(a),$s(a)]}function ta(e){return r.useMemo(()=>e.hooks.dropTarget(),[e])}class ra{canDrop(){const e=this.spec,t=this.monitor;return!e.canDrop||e.canDrop(t.getItem(),t)}hover(){const e=this.spec,t=this.monitor;e.hover&&e.hover(t.getItem(),t)}drop(){const e=this.spec,t=this.monitor;if(e.drop)return e.drop(t.getItem(),t)}constructor(e,t){this.spec=e,this.monitor=t}}function na(e,t,n){const s=Qs(),a=function(e,t){const n=r.useMemo(()=>new ra(e,t),[t]);return r.useEffect(()=>{n.spec=e},[e]),n}(e,t),i=function(e){const{accept:t}=e;return r.useMemo(()=>(Tn(null!=e.accept,"accept must be defined"),Array.isArray(t)?t:[t]),[t])}(e);Rs(function(){const[e,r]=function(e,t,r){const n=r.getRegistry(),s=n.addTarget(e,t);return[s,()=>n.removeTarget(s)]}(i,a,s);return t.receiveHandlerId(e),n.receiveHandlerId(e),r},[s,t,a,n,i.map(e=>e.toString()).join("|")])}function sa(e,t){const n=Ls(e),s=function(){const e=Qs();return r.useMemo(()=>new zs(e),[e])}(),a=function(e){const t=Qs(),n=r.useMemo(()=>new Ys(t.getBackend()),[t]);return Rs(()=>(n.dropTargetOptions=e||null,n.reconnect(),()=>n.disconnectDropTarget()),[e]),n}(n.options);return na(n,s,a),[As(n.collect,s,a),ta(a)]}function aa(e){let t=null;return()=>(null==t&&(t=e()),t)}class ia{enter(e){const t=this.entered.length;return this.entered=function(e,t){const r=new Set,n=e=>r.add(e);e.forEach(n),t.forEach(n);const s=[];return r.forEach(e=>s.push(e)),s}(this.entered.filter(t=>this.isNodeInDocument(t)&&(!t.contains||t.contains(e))),[e]),0===t&&this.entered.length>0}leave(e){const t=this.entered.length;var r,n;return this.entered=(r=this.entered.filter(this.isNodeInDocument),n=e,r.filter(e=>e!==n)),t>0&&0===this.entered.length}reset(){this.entered=[]}constructor(e){this.entered=[],this.isNodeInDocument=e}}class oa{initializeExposedProperties(){Object.keys(this.config.exposeProperties).forEach(e=>{Object.defineProperty(this.item,e,{configurable:!0,enumerable:!0,get:()=>(console.warn(`Browser doesn't allow reading "${e}" until the drop event.`),null)})})}loadDataTransfer(e){if(e){const t={};Object.keys(this.config.exposeProperties).forEach(r=>{const n=this.config.exposeProperties[r];null!=n&&(t[r]={value:n(e,this.config.matchesTypes),configurable:!0,enumerable:!0})}),Object.defineProperties(this.item,t)}}canDrag(){return!0}beginDrag(){return this.item}isDragging(e,t){return t===e.getSourceId()}endDrag(){}constructor(e){this.config=e,this.item={},this.initializeExposedProperties()}}const la="__NATIVE_FILE__",ca="__NATIVE_URL__",da="__NATIVE_TEXT__",ua="__NATIVE_HTML__",ha=Object.freeze(Object.defineProperty({__proto__:null,FILE:la,HTML:ua,TEXT:da,URL:ca},Symbol.toStringTag,{value:"Module"}));function ga(e,t,r){const n=t.reduce((t,r)=>t||e.getData(r),"");return null!=n?n:r}const fa={[la]:{exposeProperties:{files:e=>Array.prototype.slice.call(e.files),items:e=>e.items,dataTransfer:e=>e},matchesTypes:["Files"]},[ua]:{exposeProperties:{html:(e,t)=>ga(e,t,""),dataTransfer:e=>e},matchesTypes:["Html","text/html"]},[ca]:{exposeProperties:{urls:(e,t)=>ga(e,t,"").split("\n"),dataTransfer:e=>e},matchesTypes:["Url","text/uri-list"]},[da]:{exposeProperties:{text:(e,t)=>ga(e,t,""),dataTransfer:e=>e},matchesTypes:["Text","text/plain"]}};function pa(e){if(!e)return null;const t=Array.prototype.slice.call(e.types||[]);return Object.keys(fa).filter(e=>{const r=fa[e];return!!(null==r?void 0:r.matchesTypes)&&r.matchesTypes.some(e=>t.indexOf(e)>-1)})[0]||null}const ma=aa(()=>/firefox/i.test(navigator.userAgent)),ba=aa(()=>Boolean(window.safari));class xa{interpolate(e){const{xs:t,ys:r,c1s:n,c2s:s,c3s:a}=this;let i=t.length-1;if(e===t[i])return r[i];let o,l=0,c=a.length-1;for(;l<=c;){o=Math.floor(.5*(l+c));const n=t[o];if(n<e)l=o+1;else{if(!(n>e))return r[o];c=o-1}}i=Math.max(0,c);const d=e-t[i],u=d*d;return r[i]+n[i]*d+s[i]*u+a[i]*d*u}constructor(e,t){const{length:r}=e,n=[];for(let h=0;h<r;h++)n.push(h);n.sort((t,r)=>e[t]<e[r]?-1:1);const s=[],a=[];let i,o;for(let h=0;h<r-1;h++)i=e[h+1]-e[h],o=t[h+1]-t[h],s.push(i),a.push(o/i);const l=[a[0]];for(let h=0;h<s.length-1;h++){const e=a[h],t=a[h+1];if(e*t<=0)l.push(0);else{i=s[h];const r=s[h+1],n=i+r;l.push(3*n/((n+r)/e+(n+i)/t))}}l.push(a[a.length-1]);const c=[],d=[];let u;for(let h=0;h<l.length-1;h++){u=a[h];const e=l[h],t=1/s[h],r=e+l[h+1]-u-u;c.push((u-e-r)*t),d.push(r*t*t)}this.xs=e,this.ys=t,this.c1s=l,this.c2s=c,this.c3s=d}}function ya(e){const t=1===e.nodeType?e:e.parentElement;if(!t)return null;const{top:r,left:n}=t.getBoundingClientRect();return{x:n,y:r}}function va(e){return{x:e.clientX,y:e.clientY}}function wa(e,t,r,n,s){const a="IMG"===(i=t).nodeName&&(ma()||!(null===(o=document.documentElement)||void 0===o?void 0:o.contains(i)));var i,o;const l=ya(a?e:t),c={x:r.x-l.x,y:r.y-l.y},{offsetWidth:d,offsetHeight:u}=e,{anchorX:h,anchorY:g}=n,{dragPreviewWidth:f,dragPreviewHeight:p}=function(e,t,r,n){let s=e?t.width:r,a=e?t.height:n;return ba()&&e&&(a/=window.devicePixelRatio,s/=window.devicePixelRatio),{dragPreviewWidth:s,dragPreviewHeight:a}}(a,t,d,u),{offsetX:m,offsetY:b}=s,x=0===b||b;return{x:0===m||m?m:new xa([0,.5,1],[c.x,c.x/d*f,c.x+f-d]).interpolate(h),y:x?b:(()=>{let e=new xa([0,.5,1],[c.y,c.y/u*p,c.y+p-u]).interpolate(g);return ba()&&a&&(e+=(window.devicePixelRatio-1)*p),e})()}}class Ta{get window(){return this.globalContext?this.globalContext:"undefined"!=typeof window?window:void 0}get document(){var e;return(null===(e=this.globalContext)||void 0===e?void 0:e.document)?this.globalContext.document:this.window?this.window.document:void 0}get rootElement(){var e;return(null===(e=this.optionsArgs)||void 0===e?void 0:e.rootElement)||this.window}constructor(e,t){this.ownerDocument=null,this.globalContext=e,this.optionsArgs=t}}function Sa(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Ea(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){Sa(e,t,r[t])})}return e}class Na{profile(){var e,t;return{sourcePreviewNodes:this.sourcePreviewNodes.size,sourcePreviewNodeOptions:this.sourcePreviewNodeOptions.size,sourceNodeOptions:this.sourceNodeOptions.size,sourceNodes:this.sourceNodes.size,dragStartSourceIds:(null===(e=this.dragStartSourceIds)||void 0===e?void 0:e.length)||0,dropTargetIds:this.dropTargetIds.length,dragEnterTargetIds:this.dragEnterTargetIds.length,dragOverTargetIds:(null===(t=this.dragOverTargetIds)||void 0===t?void 0:t.length)||0}}get window(){return this.options.window}get document(){return this.options.document}get rootElement(){return this.options.rootElement}setup(){const e=this.rootElement;if(void 0!==e){if(e.__isReactDndBackendSetUp)throw new Error("Cannot have two HTML5 backends at the same time.");e.__isReactDndBackendSetUp=!0,this.addEventListeners(e)}}teardown(){const e=this.rootElement;var t;void 0!==e&&(e.__isReactDndBackendSetUp=!1,this.removeEventListeners(this.rootElement),this.clearCurrentDragSourceNode(),this.asyncEndDragFrameId&&(null===(t=this.window)||void 0===t||t.cancelAnimationFrame(this.asyncEndDragFrameId)))}connectDragPreview(e,t,r){return this.sourcePreviewNodeOptions.set(e,r),this.sourcePreviewNodes.set(e,t),()=>{this.sourcePreviewNodes.delete(e),this.sourcePreviewNodeOptions.delete(e)}}connectDragSource(e,t,r){this.sourceNodes.set(e,t),this.sourceNodeOptions.set(e,r);const n=t=>this.handleDragStart(t,e),s=e=>this.handleSelectStart(e);return t.setAttribute("draggable","true"),t.addEventListener("dragstart",n),t.addEventListener("selectstart",s),()=>{this.sourceNodes.delete(e),this.sourceNodeOptions.delete(e),t.removeEventListener("dragstart",n),t.removeEventListener("selectstart",s),t.setAttribute("draggable","false")}}connectDropTarget(e,t){const r=t=>this.handleDragEnter(t,e),n=t=>this.handleDragOver(t,e),s=t=>this.handleDrop(t,e);return t.addEventListener("dragenter",r),t.addEventListener("dragover",n),t.addEventListener("drop",s),()=>{t.removeEventListener("dragenter",r),t.removeEventListener("dragover",n),t.removeEventListener("drop",s)}}addEventListeners(e){e.addEventListener&&(e.addEventListener("dragstart",this.handleTopDragStart),e.addEventListener("dragstart",this.handleTopDragStartCapture,!0),e.addEventListener("dragend",this.handleTopDragEndCapture,!0),e.addEventListener("dragenter",this.handleTopDragEnter),e.addEventListener("dragenter",this.handleTopDragEnterCapture,!0),e.addEventListener("dragleave",this.handleTopDragLeaveCapture,!0),e.addEventListener("dragover",this.handleTopDragOver),e.addEventListener("dragover",this.handleTopDragOverCapture,!0),e.addEventListener("drop",this.handleTopDrop),e.addEventListener("drop",this.handleTopDropCapture,!0))}removeEventListeners(e){e.removeEventListener&&(e.removeEventListener("dragstart",this.handleTopDragStart),e.removeEventListener("dragstart",this.handleTopDragStartCapture,!0),e.removeEventListener("dragend",this.handleTopDragEndCapture,!0),e.removeEventListener("dragenter",this.handleTopDragEnter),e.removeEventListener("dragenter",this.handleTopDragEnterCapture,!0),e.removeEventListener("dragleave",this.handleTopDragLeaveCapture,!0),e.removeEventListener("dragover",this.handleTopDragOver),e.removeEventListener("dragover",this.handleTopDragOverCapture,!0),e.removeEventListener("drop",this.handleTopDrop),e.removeEventListener("drop",this.handleTopDropCapture,!0))}getCurrentSourceNodeOptions(){const e=this.monitor.getSourceId(),t=this.sourceNodeOptions.get(e);return Ea({dropEffect:this.altKeyPressed?"copy":"move"},t||{})}getCurrentDropEffect(){return this.isDraggingNativeItem()?"copy":this.getCurrentSourceNodeOptions().dropEffect}getCurrentSourcePreviewNodeOptions(){const e=this.monitor.getSourceId();return Ea({anchorX:.5,anchorY:.5,captureDraggingState:!1},this.sourcePreviewNodeOptions.get(e)||{})}isDraggingNativeItem(){const e=this.monitor.getItemType();return Object.keys(ha).some(t=>ha[t]===e)}beginDragNativeItem(e,t){this.clearCurrentDragSourceNode(),this.currentNativeSource=function(e,t){const r=fa[e];if(!r)throw new Error(`native type ${e} has no configuration`);const n=new oa(r);return n.loadDataTransfer(t),n}(e,t),this.currentNativeHandle=this.registry.addSource(e,this.currentNativeSource),this.actions.beginDrag([this.currentNativeHandle])}setCurrentDragSourceNode(e){this.clearCurrentDragSourceNode(),this.currentDragSourceNode=e;this.mouseMoveTimeoutTimer=setTimeout(()=>{var e;return null===(e=this.rootElement)||void 0===e?void 0:e.addEventListener("mousemove",this.endDragIfSourceWasRemovedFromDOM,!0)},1e3)}clearCurrentDragSourceNode(){if(this.currentDragSourceNode){var e;if(this.currentDragSourceNode=null,this.rootElement)null===(e=this.window)||void 0===e||e.clearTimeout(this.mouseMoveTimeoutTimer||void 0),this.rootElement.removeEventListener("mousemove",this.endDragIfSourceWasRemovedFromDOM,!0);return this.mouseMoveTimeoutTimer=null,!0}return!1}handleDragStart(e,t){e.defaultPrevented||(this.dragStartSourceIds||(this.dragStartSourceIds=[]),this.dragStartSourceIds.unshift(t))}handleDragEnter(e,t){this.dragEnterTargetIds.unshift(t)}handleDragOver(e,t){null===this.dragOverTargetIds&&(this.dragOverTargetIds=[]),this.dragOverTargetIds.unshift(t)}handleDrop(e,t){this.dropTargetIds.unshift(t)}constructor(e,t,r){this.sourcePreviewNodes=new Map,this.sourcePreviewNodeOptions=new Map,this.sourceNodes=new Map,this.sourceNodeOptions=new Map,this.dragStartSourceIds=null,this.dropTargetIds=[],this.dragEnterTargetIds=[],this.currentNativeSource=null,this.currentNativeHandle=null,this.currentDragSourceNode=null,this.altKeyPressed=!1,this.mouseMoveTimeoutTimer=null,this.asyncEndDragFrameId=null,this.dragOverTargetIds=null,this.lastClientOffset=null,this.hoverRafId=null,this.getSourceClientOffset=e=>{const t=this.sourceNodes.get(e);return t&&ya(t)||null},this.endDragNativeItem=()=>{this.isDraggingNativeItem()&&(this.actions.endDrag(),this.currentNativeHandle&&this.registry.removeSource(this.currentNativeHandle),this.currentNativeHandle=null,this.currentNativeSource=null)},this.isNodeInDocument=e=>Boolean(e&&this.document&&this.document.body&&this.document.body.contains(e)),this.endDragIfSourceWasRemovedFromDOM=()=>{const e=this.currentDragSourceNode;null==e||this.isNodeInDocument(e)||(this.clearCurrentDragSourceNode()&&this.monitor.isDragging()&&this.actions.endDrag(),this.cancelHover())},this.scheduleHover=e=>{null===this.hoverRafId&&"undefined"!=typeof requestAnimationFrame&&(this.hoverRafId=requestAnimationFrame(()=>{this.monitor.isDragging()&&this.actions.hover(e||[],{clientOffset:this.lastClientOffset}),this.hoverRafId=null}))},this.cancelHover=()=>{null!==this.hoverRafId&&"undefined"!=typeof cancelAnimationFrame&&(cancelAnimationFrame(this.hoverRafId),this.hoverRafId=null)},this.handleTopDragStartCapture=()=>{this.clearCurrentDragSourceNode(),this.dragStartSourceIds=[]},this.handleTopDragStart=e=>{if(e.defaultPrevented)return;const{dragStartSourceIds:t}=this;this.dragStartSourceIds=null;const r=va(e);this.monitor.isDragging()&&(this.actions.endDrag(),this.cancelHover()),this.actions.beginDrag(t||[],{publishSource:!1,getSourceClientOffset:this.getSourceClientOffset,clientOffset:r});const{dataTransfer:n}=e,s=pa(n);if(this.monitor.isDragging()){if(n&&"function"==typeof n.setDragImage){const e=this.monitor.getSourceId(),t=this.sourceNodes.get(e),s=this.sourcePreviewNodes.get(e)||t;if(s){const{anchorX:e,anchorY:a,offsetX:i,offsetY:o}=this.getCurrentSourcePreviewNodeOptions(),l=wa(t,s,r,{anchorX:e,anchorY:a},{offsetX:i,offsetY:o});n.setDragImage(s,l.x,l.y)}}try{null==n||n.setData("application/json",{})}catch(a){}this.setCurrentDragSourceNode(e.target);const{captureDraggingState:t}=this.getCurrentSourcePreviewNodeOptions();t?this.actions.publishDragSource():setTimeout(()=>this.actions.publishDragSource(),0)}else if(s)this.beginDragNativeItem(s);else{if(n&&!n.types&&(e.target&&!e.target.hasAttribute||!e.target.hasAttribute("draggable")))return;e.preventDefault()}},this.handleTopDragEndCapture=()=>{this.clearCurrentDragSourceNode()&&this.monitor.isDragging()&&this.actions.endDrag(),this.cancelHover()},this.handleTopDragEnterCapture=e=>{var t;(this.dragEnterTargetIds=[],this.isDraggingNativeItem())&&(null===(t=this.currentNativeSource)||void 0===t||t.loadDataTransfer(e.dataTransfer));if(!this.enterLeaveCounter.enter(e.target)||this.monitor.isDragging())return;const{dataTransfer:r}=e,n=pa(r);n&&this.beginDragNativeItem(n,r)},this.handleTopDragEnter=e=>{const{dragEnterTargetIds:t}=this;if(this.dragEnterTargetIds=[],!this.monitor.isDragging())return;this.altKeyPressed=e.altKey,t.length>0&&this.actions.hover(t,{clientOffset:va(e)});t.some(e=>this.monitor.canDropOnTarget(e))&&(e.preventDefault(),e.dataTransfer&&(e.dataTransfer.dropEffect=this.getCurrentDropEffect()))},this.handleTopDragOverCapture=e=>{var t;(this.dragOverTargetIds=[],this.isDraggingNativeItem())&&(null===(t=this.currentNativeSource)||void 0===t||t.loadDataTransfer(e.dataTransfer))},this.handleTopDragOver=e=>{const{dragOverTargetIds:t}=this;if(this.dragOverTargetIds=[],!this.monitor.isDragging())return e.preventDefault(),void(e.dataTransfer&&(e.dataTransfer.dropEffect="none"));this.altKeyPressed=e.altKey,this.lastClientOffset=va(e),this.scheduleHover(t);(t||[]).some(e=>this.monitor.canDropOnTarget(e))?(e.preventDefault(),e.dataTransfer&&(e.dataTransfer.dropEffect=this.getCurrentDropEffect())):this.isDraggingNativeItem()?e.preventDefault():(e.preventDefault(),e.dataTransfer&&(e.dataTransfer.dropEffect="none"))},this.handleTopDragLeaveCapture=e=>{this.isDraggingNativeItem()&&e.preventDefault();this.enterLeaveCounter.leave(e.target)&&(this.isDraggingNativeItem()&&setTimeout(()=>this.endDragNativeItem(),0),this.cancelHover())},this.handleTopDropCapture=e=>{var t;(this.dropTargetIds=[],this.isDraggingNativeItem())?(e.preventDefault(),null===(t=this.currentNativeSource)||void 0===t||t.loadDataTransfer(e.dataTransfer)):pa(e.dataTransfer)&&e.preventDefault();this.enterLeaveCounter.reset()},this.handleTopDrop=e=>{const{dropTargetIds:t}=this;this.dropTargetIds=[],this.actions.hover(t,{clientOffset:va(e)}),this.actions.drop({dropEffect:this.getCurrentDropEffect()}),this.isDraggingNativeItem()?this.endDragNativeItem():this.monitor.isDragging()&&this.actions.endDrag(),this.cancelHover()},this.handleSelectStart=e=>{const t=e.target;"function"==typeof t.dragDrop&&("INPUT"===t.tagName||"SELECT"===t.tagName||"TEXTAREA"===t.tagName||t.isContentEditable||(e.preventDefault(),t.dragDrop()))},this.options=new Ta(t,r),this.actions=e.getActions(),this.monitor=e.getMonitor(),this.registry=e.getRegistry(),this.enterLeaveCounter=new ia(this.isNodeInDocument)}}const Ca=function(e,t,r){return new Na(e,t,r)},ja="CHIP";function Da({chip:t,well:r,index:n,moveChip:s,toggleCheckbox:a,theme:i}){const[{isDragging:o},l]=ea({type:ja,item:{well:r,index:n,chip:t},collect:e=>({isDragging:e.isDragging()})}),[,c]=sa({accept:ja,hover:e=>{e.well===r&&e.index===n||(s(e.well,e.index,r,n),e.well=r,e.index=n)}});return e.jsxs("div",{ref:e=>l(c(e)),className:`flex items-center gap-1.5 h-7 px-2.5 cursor-move text-xs w-full ${o?"opacity-50":"opacity-100"} ${"NeXTSTEP"===i?"bg-[#d4d4d4] border-t-2 border-l-2 border-[#ffffff] border-b-2 border-r-2 border-b-[#707070] border-r-[#707070]":"bg-white hover:bg-gray-50 rounded-md border border-gray-300"}`,children:[t.hasCheckbox&&e.jsx("input",{type:"checkbox",checked:t.checked||!1,onChange:()=>a(r,t.id),onClick:e=>e.stopPropagation(),className:"w-3 h-3 cursor-pointer"}),e.jsx("span",{children:t.label})]})}function Ia({title:t,well:r,chips:n,moveChip:s,toggleCheckbox:a,theme:i}){const[,o]=sa({accept:ja,drop:e=>{e.well!==r&&s(e.well,e.index,r,n.length)}});return e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-[10px] mb-1 px-1 "+("NeXTSTEP"===i?"text-[#404040]":"text-gray-600 font-medium"),children:t}),e.jsx("div",{ref:o,className:"min-h-[140px] p-2 flex flex-col gap-1.5 "+("NeXTSTEP"===i?"bg-[#a0a0a0] border-t-2 border-l-2 border-[#606060] border-b-2 border-r-2 border-r-[#d0d0d0] border-b-[#d0d0d0]":"bg-gray-50 border border-gray-300 rounded-lg"),children:n.map((t,n)=>e.jsx(Da,{chip:t,well:r,index:n,moveChip:s,toggleCheckbox:a,theme:i},t.id))})]})}function ka(){const{theme:t}=Ze(),{wells:r,moveChip:n,toggleCheckbox:s,transpose:a}=mt();return e.jsx("div",{className:"p-3 "+("NeXTSTEP"===t?"bg-[#b8b8b8] border-b-2 border-[#505050]":"bg-white/50 backdrop-blur-xl border-b border-gray-200"),children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx(Ia,{title:"Available",well:"available",chips:r.available,moveChip:n,toggleCheckbox:s,theme:t}),e.jsx(Ia,{title:"Rows",well:"rows",chips:r.rows,moveChip:n,toggleCheckbox:s,theme:t}),e.jsx("div",{className:"flex items-center",children:e.jsx("button",{onClick:a,className:"p-2 rounded transition-colors "+("NeXTSTEP"===t?"bg-[#d4d4d4] border-t-2 border-l-2 border-[#ffffff] border-b-2 border-r-2 border-b-[#707070] border-r-[#707070] hover:bg-[#c0c0c0] active:border-t-[#707070] active:border-l-[#707070] active:border-b-[#ffffff] active:border-r-[#ffffff]":"bg-gray-100 hover:bg-gray-200 border border-gray-300"),title:"Transpose rows and columns",children:e.jsx(v,{className:"w-4 h-4"})})}),e.jsx(Ia,{title:"Columns",well:"columns",chips:r.columns,moveChip:n,toggleCheckbox:s,theme:t}),e.jsx(Ia,{title:"Layers",well:"zLayers",chips:r.zLayers,moveChip:n,toggleCheckbox:s,theme:t})]})})}function Oa(){return e.jsx(Is,{backend:Ca,children:e.jsx(ka,{})})}function Pa({label:t,value:n,options:s,onSelect:a,placeholder:i="Select...",disabled:o=!1,fullWidth:l=!1,className:c=""}){const{theme:d}=Ze(),[u,h]=r.useState(!1),g=r.useRef(null);r.useEffect(()=>{const e=e=>{g.current&&!g.current.contains(e.target)&&h(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]),r.useEffect(()=>{const e=e=>{"Escape"===e.key&&h(!1)};if(u)return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[u]);const f=s.find(e=>e.value===n),p=f?.label||i,m="NeXTSTEP"===d?"\n        bg-[#d4d4d4] text-[#404040]\n        border-t-2 border-l-2 border-[#ffffff]\n        border-b-2 border-r-2 border-b-[#707070] border-r-[#707070]\n        active:border-t-[#707070] active:border-l-[#707070]\n        active:border-b-[#ffffff] active:border-r-[#ffffff]\n      ":"\n        bg-white text-gray-700\n        rounded-lg border border-gray-300\n        hover:bg-gray-50\n        shadow-sm\n      ",b="NeXTSTEP"===d?"\n        bg-[#d4d4d4]\n        border-2 border-[#707070]\n        shadow-[2px_2px_0_#505050]\n      ":"\n        bg-white\n        rounded-lg border border-gray-200\n        shadow-lg\n      ",x="NeXTSTEP"===d?"hover:bg-[#2850a0] hover:text-white":"hover:bg-gray-100 rounded",y="NeXTSTEP"===d?"text-xs text-[#404040]":"text-xs text-gray-600 font-medium";return e.jsxs("div",{ref:g,className:`relative ${l?"w-full":""} ${c}`,children:[e.jsxs("div",{className:"flex items-center gap-1",children:[t&&e.jsxs("span",{className:`${y} whitespace-nowrap`,children:[t,":"]}),e.jsxs("button",{type:"button",disabled:o,onClick:()=>!o&&h(!u),className:`\n            h-7 px-3 flex items-center gap-2 text-sm\n            ${l?"w-full":"min-w-[120px]"}\n            justify-between\n            ${m}\n            ${o?"opacity-50 cursor-not-allowed":"cursor-pointer"}\n            transition-colors duration-150\n          `,children:[e.jsxs("span",{className:"truncate",children:[f?.icon&&e.jsx("span",{className:"mr-2",children:f.icon}),p]}),e.jsx(w,{className:"w-3 h-3 flex-shrink-0 transition-transform duration-150 "+(u?"rotate-180":"")})]})]}),u&&e.jsx("div",{className:`\n            absolute z-50 top-full left-0 mt-1\n            min-w-full max-h-60 overflow-auto\n            ${b}\n          `,children:s.map(t=>e.jsxs("button",{type:"button",disabled:t.disabled,onClick:()=>{t.disabled||(a(t.value),h(!1))},className:`\n                w-full px-3 py-1.5 text-sm text-left\n                flex items-center gap-2\n                ${t.value===n?"font-medium":""}\n                ${t.disabled?"opacity-50 cursor-not-allowed":x}\n                ${"NeXTSTEP"===d?"text-[#404040]":"text-gray-700"}\n              `,children:[t.icon&&e.jsx("span",{className:"w-4 h-4",children:t.icon}),e.jsx("span",{className:"truncate",children:t.label})]},String(t.value)))})]})}function Ra(){const{activeApp:t,activeView:n,activeDataset:s,setActiveApp:a,setActiveView:i,setActiveDataset:o}=rt(),[l,c]=r.useState(!0),{theme:d}=Ze(),u=r.useMemo(()=>[{value:"Demo",label:"Demo"},{value:"Inbox",label:"Inbox"},{value:"Projects",label:"Projects"},{value:"LinkedIn",label:"LinkedIn"},{value:"MTGs",label:"MTGs"},{value:"ReadWatch",label:"ReadWatch"}],[]),h=r.useMemo(()=>[{value:"List",label:"List"},{value:"Gallery",label:"Gallery"},{value:"Timeline",label:"Timeline"},{value:"Calendar",label:"Calendar"},{value:"Tree",label:"Tree"},{value:"Kanban",label:"Kanban"},{value:"Grid",label:"Grid"},{value:"Charts",label:"Charts"},{value:"Graphs",label:"Graphs"}],[]),g=r.useMemo(()=>[{value:"ETL",label:"ETL"},{value:"CAS",label:"CAS"},{value:"Catalog",label:"Catalog"},{value:"Taxonomy",label:"Taxonomy"},{value:"Notes",label:"Notes"},{value:"Projects",label:"Projects"},{value:"Contacts",label:"Contacts"},{value:"Messages",label:"Messages"}],[]);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"relative z-20 h-12 flex items-center px-3 gap-4 "+("NeXTSTEP"===d?"bg-[#b8b8b8] border-b-2 border-[#505050]":"bg-white/50 backdrop-blur-xl border-b border-gray-200"),children:[e.jsx("button",{onClick:()=>c(!l),className:"h-7 w-7 flex items-center justify-center "+("NeXTSTEP"===d?"bg-[#d4d4d4] border-t-2 border-l-2 border-[#ffffff] border-b-2 border-r-2 border-b-[#707070] border-r-[#707070]":"bg-gray-100 hover:bg-gray-200 rounded-lg"),children:l?e.jsx(T,{className:"w-3 h-3"}):e.jsx(w,{className:"w-3 h-3"})}),e.jsx(Pa,{label:"Apps",value:t,options:u,onSelect:a}),e.jsx(Pa,{label:"Views",value:n,options:h,onSelect:i}),e.jsx(Pa,{label:"Datasets",value:s,options:g,onSelect:o})]}),l&&e.jsx("div",{className:"relative z-10",children:e.jsx(Oa,{})})]})}function Ma({tabs:t,defaultTab:n,activeTab:s,onTabChange:a,className:i=""}){const{theme:o}=Ze(),[l,c]=r.useState(n||t[0]?.id),d=s??l,u=t.find(e=>e.id===d)?.content,h="NeXTSTEP"===o?"\n        px-3 py-1.5 text-xs\n        border-t-2 border-l-2 border-r-2\n        border-b-0\n        -mb-[2px]\n      ":"\n        px-3 py-1.5 text-xs font-medium\n        rounded-t-lg\n        -mb-px\n      ",g="NeXTSTEP"===o?"\n        bg-[#d4d4d4] text-[#404040]\n        border-t-[#ffffff] border-l-[#ffffff] border-r-[#707070]\n        z-10\n      ":"\n        bg-white text-gray-900\n        border border-gray-200 border-b-white\n      ",f="NeXTSTEP"===o?"\n        bg-[#b0b0b0] text-[#606060]\n        border-t-[#d4d4d4] border-l-[#d4d4d4] border-r-[#707070]\n        hover:bg-[#c0c0c0]\n      ":"\n        bg-gray-100 text-gray-600\n        border border-transparent\n        hover:bg-gray-200 hover:text-gray-900\n      ",p="NeXTSTEP"===o?"\n        bg-[#d4d4d4]\n        border-2\n        border-t-[#ffffff] border-l-[#ffffff]\n        border-b-[#707070] border-r-[#707070]\n      ":"\n        bg-white\n        border border-gray-200\n        rounded-b-lg rounded-tr-lg\n      ";return e.jsxs("div",{className:`flex flex-col ${i}`,children:[e.jsx("div",{className:"flex",role:"tablist",children:t.map(t=>e.jsxs("button",{type:"button",role:"tab","aria-selected":d===t.id,"aria-controls":`panel-${t.id}`,disabled:t.disabled,onClick:()=>{return!t.disabled&&(e=t.id,s||c(e),void a?.(e));var e},className:`\n              ${h}\n              ${d===t.id?g:f}\n              ${t.disabled?"opacity-50 cursor-not-allowed":"cursor-pointer"}\n              flex items-center gap-1.5\n              transition-colors duration-150\n            `,children:[t.icon&&e.jsx("span",{className:"w-3.5 h-3.5",children:t.icon}),e.jsx("span",{children:t.label})]},t.id))}),e.jsx("div",{id:`panel-${d}`,role:"tabpanel","aria-labelledby":d,className:`${p} flex-1 overflow-auto`,children:u})]})}function Aa({title:t,icon:n,badge:s,children:a,defaultExpanded:i=!0,expanded:o,onToggle:l,className:c=""}){const{theme:d}=Ze(),[u,g]=r.useState(i),f=o??u,p="NeXTSTEP"===d?"\n        bg-[#c0c0c0]\n        border-b border-[#707070]\n        hover:bg-[#c8c8c8]\n      ":"\n        bg-gray-50\n        border-b border-gray-200\n        hover:bg-gray-100\n      ",m="NeXTSTEP"===d?"text-xs font-medium text-[#404040]":"text-xs font-semibold text-gray-700",b="NeXTSTEP"===d?"text-[#606060]":"text-gray-400",x="NeXTSTEP"===d?"bg-[#d4d4d4]":"bg-white";return e.jsxs("div",{className:`${c}`,children:[e.jsxs("button",{type:"button",onClick:()=>{const e=!f;void 0===o&&g(e),l?.(e)},className:`\n          w-full px-3 py-2\n          flex items-center gap-2\n          ${p}\n          cursor-pointer\n          transition-colors duration-150\n        `,"aria-expanded":f,children:[e.jsx(h,{className:`\n            w-3.5 h-3.5 flex-shrink-0\n            transition-transform duration-200\n            ${f?"rotate-90":""}\n            ${b}\n          `}),n&&e.jsx("span",{className:"w-4 h-4 "+("NeXTSTEP"===d?"text-[#606060]":"text-gray-500"),children:n}),e.jsx("span",{className:`flex-1 text-left ${m}`,children:t}),s&&e.jsx("span",{className:"flex-shrink-0",children:s})]}),e.jsx("div",{className:`\n          overflow-hidden\n          transition-all duration-200 ease-in-out\n          ${f?"max-h-[1000px] opacity-100":"max-h-0 opacity-0"}\n        `,children:e.jsx("div",{className:`${x} p-3`,children:a})})]})}function La(){const[t,n]=r.useState("filters"),[s,a]=r.useState(null),{theme:i}=Ze(),{filters:o,addFilter:c,removeFilter:d,clearFilters:u}=ht(),h=["Apps Builder","Views Builder","Buttons Builder","Charts Builder"],{data:f}=gr("PRAGMA table_info(cards)"),p=["Location","Alphabet","Time","Category","Hierarchy"],m=r.useMemo(()=>{if(!f)return new Set;const e=new Set(f.map(e=>e.name)),t=new Set;return(e.has("location")||e.has("lat")||e.has("lng"))&&t.add("Location"),(e.has("name")||e.has("title"))&&t.add("Alphabet"),(e.has("created")||e.has("due")||e.has("createdAt"))&&t.add("Time"),(e.has("category")||e.has("status")||e.has("priority")||e.has("tags")||e.has("folder"))&&t.add("Category"),(e.has("parent")||e.has("parent_id")||e.has("folder"))&&t.add("Hierarchy"),t},[f]),b=r.useMemo(()=>[{title:"Analytics",items:p.map(e=>({name:e,available:m.has(e)}))},{title:"Synthetics",items:["Links","Paths","Vectors","Centrality","Similarity","Community"].map(e=>({name:e,available:!1}))},{title:"Formulas",items:["Active Filters","Algorithms","Audit View","Versions"].map(e=>({name:e,available:!0}))}],[m]),x=m.has("Category"),y=m.has("Time"),{data:v}=gr(x?"SELECT folder as value, COUNT(*) as count FROM cards WHERE folder IS NOT NULL AND folder != '' GROUP BY folder ORDER BY count DESC":"SELECT NULL as value, 0 as count WHERE 0",[],{enabled:x}),{data:w}=gr(x?"SELECT status as value, COUNT(*) as count FROM cards WHERE status IS NOT NULL AND status != '' GROUP BY status ORDER BY count DESC":"SELECT NULL as value, 0 as count WHERE 0",[],{enabled:x}),{data:T}=gr(x?"SELECT CAST(priority as TEXT) as value, COUNT(*) as count FROM cards WHERE priority IS NOT NULL GROUP BY priority ORDER BY priority ASC":"SELECT NULL as value, 0 as count WHERE 0",[],{enabled:x}),{data:E}=gr(x?"SELECT tags as value, COUNT(*) as count FROM cards WHERE tags IS NOT NULL AND tags != '' GROUP BY tags ORDER BY count DESC":"SELECT NULL as value, 0 as count WHERE 0",[],{enabled:x}),{data:N}=gr(y?"SELECT\n          MIN(COALESCE(createdAt, created, due)) as min_date,\n          MAX(COALESCE(createdAt, created, due)) as max_date,\n          SUM(CASE WHEN createdAt IS NOT NULL OR created IS NOT NULL THEN 1 ELSE 0 END) as has_created,\n          SUM(CASE WHEN due IS NOT NULL THEN 1 ELSE 0 END) as has_due\n         FROM cards":"SELECT NULL as min_date, NULL as max_date, 0 as has_created, 0 as has_due WHERE 0",[],{enabled:y}),C=(t,r,n)=>t&&0!==t.length?e.jsx("div",{className:"space-y-1",children:t.filter(e=>e.value).map(t=>e.jsxs("button",{onClick:()=>(e=>{c({field:e,operator:"=",value:value}),a(null)})(r,t.value),className:"w-full h-7 px-2 flex items-center justify-between text-sm "+("NeXTSTEP"===i?"bg-[#d4d4d4] hover:bg-black hover:text-white":"bg-white hover:bg-blue-500 hover:text-white rounded"),children:[e.jsx("span",{children:t.value}),e.jsx("span",{className:"text-xs "+("NeXTSTEP"===i?"text-[#606060]":"text-gray-400"),children:t.count})]},t.value))}):e.jsx("div",{className:"text-xs text-gray-400 p-2",children:n}),j=()=>{if(!s)return null;return e.jsxs("div",{className:"mt-2 p-2 "+("NeXTSTEP"===i?"bg-[#b8b8b8] border-2 border-[#707070]":"bg-gray-50 rounded-lg border border-gray-200"),children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-xs font-medium",children:s}),e.jsx("button",{onClick:()=>a(null),className:"p-0.5 "+("NeXTSTEP"===i?"hover:bg-[#a0a0a0]":"hover:bg-gray-200 rounded"),children:e.jsx(l,{className:"w-3 h-3"})})]}),(()=>{switch(s){case"Category":return C(v,"category","No categories in data");case"Status":return C(w,"status","No statuses in data");case"Priority":return C(T,"priority","No priorities in data");case"Tags":return C(E,"tags","No tags in data");case"Time":{if(!N||0===N.length||!N[0]?.has_created&&!N[0]?.has_due)return e.jsx("div",{className:"text-xs text-gray-400 p-2",children:"No date fields in data"});const t=[],r=new Date,n=r.toISOString().split("T")[0],s=new Date(r.getTime()-6048e5).toISOString().split("T")[0],o=new Date(r.getFullYear(),r.getMonth()-1,r.getDate()).toISOString().split("T")[0],l=new Date(r.getFullYear()-1,r.getMonth(),r.getDate()).toISOString().split("T")[0];return t.push({label:"Today",start:n,end:n}),t.push({label:"This Week",start:s,end:n}),t.push({label:"This Month",start:o,end:n}),t.push({label:"This Year",start:l,end:n}),N[0]?.has_due&&t.push({label:"Overdue",start:"1900-01-01",end:n,field:"due"}),e.jsx("div",{className:"space-y-1",children:t.map(t=>e.jsx("button",{onClick:()=>{const e=t.field||(N[0]?.has_created?"created":"due");c({field:e,operator:"Overdue"===t.label?"<":">=",value:"Overdue"===t.label?n:t.start}),a(null)},className:"w-full h-7 px-2 text-left text-sm "+("NeXTSTEP"===i?"bg-[#d4d4d4] hover:bg-black hover:text-white":"bg-white hover:bg-blue-500 hover:text-white rounded"),children:t.label},t.label))})}default:return null}})()]})},D=t=>e.jsx("button",{onClick:()=>(e=>{isAvailable&&a(s===e?null:e)})(t.name,t.available),disabled:!t.available,className:"w-full h-7 px-3 text-left text-sm transition-opacity "+(t.available?s===t.name?"NeXTSTEP"===i?"bg-black text-white":"bg-blue-500 text-white rounded-md":"NeXTSTEP"===i?"bg-[#d4d4d4] border border-[#a0a0a0] hover:bg-black hover:text-white":"bg-white hover:bg-blue-500 hover:text-white rounded-md border border-gray-200":"NeXTSTEP"===i?"bg-[#d4d4d4] border border-[#a0a0a0] opacity-40 cursor-not-allowed text-[#808080]":"bg-gray-100 border border-gray-200 opacity-40 cursor-not-allowed text-gray-400 rounded-md"),children:t.name},t.name),I=[{id:"filters",label:"Filters",icon:e.jsx(S,{className:"w-4 h-4"}),content:e.jsxs("div",{className:"p-2",children:[0===o.length?null:e.jsxs("div",{className:"p-2 border-b "+("NeXTSTEP"===i?"border-[#808080] bg-[#b8b8b8]":"border-gray-200 bg-blue-50"),children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-xs font-medium",children:"Active Filters"}),e.jsx("button",{onClick:u,className:"text-xs "+("NeXTSTEP"===i?"text-[#404040] hover:underline":"text-blue-500 hover:underline"),children:"Clear All"})]}),e.jsx("div",{className:"flex flex-wrap gap-1",children:o.map((t,r)=>e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 text-xs "+("NeXTSTEP"===i?"bg-[#d4d4d4] border border-[#808080]":"bg-blue-100 text-blue-700 rounded-full"),children:[t.field," ",t.operator," ",String(t.value),e.jsx("button",{onClick:()=>d(r),className:"hover:text-red-500",children:e.jsx(l,{className:"w-3 h-3"})})]},r))})]}),b.map(t=>e.jsx(Aa,{title:t.title,defaultExpanded:"Analytics"===t.title,className:"mb-1",children:e.jsx("div",{className:"mt-1 ml-2 space-y-0.5",children:t.items.map(D)})},t.title)),j()]})},{id:"templates",label:"Templates",icon:e.jsx(g,{className:"w-4 h-4"}),content:e.jsx("div",{className:"p-2",children:h.map(t=>e.jsx("button",{className:"w-full h-8 px-2 mb-2 flex items-center text-sm "+("NeXTSTEP"===i?"bg-[#a8a8a8] border-t-2 border-l-2 border-[#c8c8c8] border-b-2 border-r-2 border-b-[#505050] border-r-[#505050]":"bg-gray-100 hover:bg-gray-200 rounded-lg"),children:t},t))})}];return e.jsx("div",{className:"w-64 h-full flex flex-col "+("NeXTSTEP"===i?"bg-[#c0c0c0] border-r-2 border-[#505050]":"bg-white/80 backdrop-blur-xl border-r border-gray-200"),children:e.jsx(Ma,{tabs:I,activeTab:t,onTabChange:e=>n(e),className:"flex-1 flex flex-col"})})}function _a(){const{theme:t}=Ze(),r="NeXTSTEP"===t?"w-full h-7 px-2 bg-white border-t-2 border-l-2 border-[#707070] border-b-2 border-r-2 border-b-[#e8e8e8] border-r-[#e8e8e8] text-sm":"w-full h-7 px-2 bg-white border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500";return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs block mb-1",children:"Font Family"}),e.jsxs("select",{className:r,children:[e.jsx("option",{children:"Helvetica"}),e.jsx("option",{children:"Times"}),e.jsx("option",{children:"Courier"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-xs block mb-1",children:"Size"}),e.jsx("input",{type:"number",defaultValue:"12",className:r})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-xs block mb-1",children:"Color"}),e.jsx("input",{type:"color",defaultValue:"#000000",className:r})]})]})]})}function $a(){return e.jsx("p",{className:"text-xs text-center text-gray-500",children:"Coming soon..."})}function Fa(){const[t,n]=r.useState("formats"),[s,a]=r.useState(new Set(["View","Cell","Text"])),{theme:i}=Ze(),o=(t,r)=>isFormats&&"Text"===t?e.jsx(_a,{}):e.jsx($a,{}),l=(t,r)=>e.jsx(e.Fragment,{children:t.map(t=>e.jsx(Aa,{title:t,expanded:s.has(t),onToggle:()=>(e=>{const t=new Set(s);t.has(e)?t.delete(e):t.add(e),a(t)})(t),className:"mb-2",children:o(t,isFormats)},t))}),c=[{id:"formats",label:"Formats",icon:e.jsx(E,{className:"w-4 h-4"}),content:e.jsx("div",{className:"p-2",children:l(["View","Cell","Text","Arrange","Conditional Formatting"])})},{id:"settings",label:"Settings",icon:e.jsx(N,{className:"w-4 h-4"}),content:e.jsx("div",{className:"p-2",children:l(["General","ETL Datasets","Toolbars","Formats","Views","Security"])})}];return e.jsx("div",{className:"w-64 h-full flex flex-col "+("NeXTSTEP"===i?"bg-[#c0c0c0] border-l-2 border-[#e8e8e8]":"bg-white/80 backdrop-blur-xl border-l border-gray-200"),children:e.jsx(Ma,{tabs:c,activeTab:t,onTabChange:e=>n(e),className:"flex-1 flex flex-col"})})}function Ua(){const[t,n]=r.useState("map"),[s,a]=r.useState(!0),{theme:i}=Ze();return e.jsxs("div",{className:"NeXTSTEP"===i?"bg-[#b8b8b8] border-t-2 border-[#808080]":"bg-white/80 backdrop-blur-xl border-t border-gray-200",children:[e.jsxs("div",{className:"NeXTSTEP"===i?"flex border-b-2 border-[#808080]":"flex border-b border-gray-200",children:[e.jsx("button",{onClick:()=>a(!s),className:"w-8 h-8 flex items-center justify-center "+("NeXTSTEP"===i?"bg-[#d4d4d4] border-r border-[#808080]":"bg-gray-100 border-r border-gray-200 rounded-tl-lg"),children:s?e.jsx(w,{className:"w-3 h-3"}):e.jsx(T,{className:"w-3 h-3"})}),e.jsx("button",{onClick:()=>n("map"),className:"px-4 h-8 text-sm "+("NeXTSTEP"===i?"map"===t?"bg-[#b8b8b8]":"bg-[#a0a0a0] hover:bg-[#b0b0b0]":"map"===t?"bg-white text-blue-500 border-b-2 border-blue-500":"bg-gray-50 text-gray-600 hover:bg-gray-100"),children:"Location Map"}),e.jsx("button",{onClick:()=>n("slider"),className:"px-4 h-8 text-sm "+("NeXTSTEP"===i?"slider"===t?"bg-[#b8b8b8]":"bg-[#a0a0a0] hover:bg-[#b0b0b0]":"slider"===t?"bg-white text-blue-500 border-b-2 border-blue-500":"bg-gray-50 text-gray-600 hover:bg-gray-100"),children:"Time Slider"})]}),s&&e.jsxs("div",{className:"p-4",children:["map"===t&&e.jsx("div",{className:"h-48 overflow-hidden "+("NeXTSTEP"===i?"border-2 border-[#606060]":"border border-gray-300 rounded-lg"),children:e.jsx("iframe",{width:"100%",height:"100%",frameBorder:"0",scrolling:"no",src:"https://www.openstreetmap.org/export/embed.html?bbox=-105.3205,39.965,-105.2205,40.065&layer=mapnik&marker=40.015,-105.2705",title:"Location Map"})}),"slider"===t&&e.jsxs("div",{className:"h-48 p-4 flex flex-col justify-center gap-4 "+("NeXTSTEP"===i?"bg-[#a0a0a0] border-2 border-[#606060]":"bg-gray-50 border border-gray-300 rounded-lg"),children:[e.jsx("div",{className:"text-sm text-center text-gray-600",children:"Time series data controls"}),e.jsx("input",{type:"range",className:"w-full",min:"0",max:"100",defaultValue:"50"}),e.jsxs("div",{className:"flex justify-between text-xs text-gray-600",children:[e.jsx("span",{children:"Start Date"}),e.jsx("span",{children:"End Date"})]})]})]})]})}const Ha=require("./grammar/parser.cjs");function Xa(){const[t,n]=r.useState(""),[s,a]=r.useState(null),{theme:i}=Ze(),{addFilter:o,clearFilters:l}=ht();return e.jsxs("div",{className:"h-10 flex items-center px-3 gap-3 "+("NeXTSTEP"===i?"bg-[#c0c0c0] border-t-2 border-[#e8e8e8]":"bg-white/50 backdrop-blur-xl border-t border-gray-200"),children:[e.jsx("button",{onClick:l,className:"w-8 h-8 rounded-full flex items-center justify-center "+("NeXTSTEP"===i?"bg-[#d4d4d4] border-t-2 border-l-2 border-[#ffffff] border-b-2 border-r-2 border-b-[#707070] border-r-[#707070]":"bg-gray-100 hover:bg-gray-200"),title:"Clear filters",children:e.jsx("span",{className:"text-lg leading-none",children:""})}),e.jsxs("form",{onSubmit:e=>{e.preventDefault(),a(null);const r=t.trim();if(r){if("clear"===r||"reset"===r)return l(),void n("");try{const e=function(e){const t=e.trim();if(!t)return null;try{return Ha.parse(t)}catch(s){if(s&&"object"==typeof s&&"location"in s){const t=s;throw{message:t.message,position:t.location?.start?.column||0,line:t.location?.start?.line||1,column:t.location?.start?.column||1,expected:t.expected?.map(e=>e.description)||[],found:t.found||""}}throw{message:s instanceof Error?s.message:"Parse error",position:0,line:1,column:1,expected:[],found:t}}}(r);if(e&&"filter"===e.type){const t=e;o({field:t.field,operator:t.operator,value:t.value}),n("")}}catch(i){a(i instanceof Error?i.message:"Invalid command")}}},className:"flex-1 relative",children:[e.jsx("input",{type:"text",value:t,onChange:e=>{n(e.target.value),a(null)},placeholder:"Enter filter (e.g. status:active, category:extract)...",className:"w-full h-7 px-3 focus:outline-none "+(s?"border-red-500 bg-red-50":"NeXTSTEP"===i?"bg-white border-t-2 border-l-2 border-[#707070] border-b-2 border-r-2 border-b-[#e8e8e8] border-r-[#e8e8e8]":"bg-white/80 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500")}),s&&e.jsx("div",{className:"absolute top-full left-0 mt-1 text-xs text-red-500",children:s})]})]})}class za extends r.Component{constructor(e){super(e),this.state={hasError:!1,error:null,errorInfo:null,showDetails:!1,retryCount:0}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){this.setState({errorInfo:t}),console.error(`Error Boundary (${this.props.level||"unknown"} level):`,{name:this.props.name,error:e.message,stack:e.stack,componentStack:t.componentStack,retryCount:this.state.retryCount}),this.props.onError&&this.props.onError(e,t),"undefined"!=typeof window&&window.errorReporting&&window.errorReporting.reportError({error:e,errorInfo:t,level:this.props.level,name:this.props.name,retryCount:this.state.retryCount})}handleRetry=()=>{this.setState(e=>({hasError:!1,error:null,errorInfo:null,showDetails:!1,retryCount:e.retryCount+1}))};handleShowDetails=()=>{this.setState(e=>({showDetails:!e.showDetails}))};getErrorSeverity=()=>{const{level:e}=this.props,{retryCount:t}=this.state;return"app"===e||t>2?"high":"feature"===e||t>0?"medium":"low"};getErrorMessage=()=>{const{error:e}=this.state,t=this.getErrorSeverity();return"high"===t?"A critical error occurred. Please refresh the page or contact support if the issue persists.":"medium"===t?`An error occurred in ${name||"this section"}. You can try again or continue using other parts of the app.`:e?.message||"Something went wrong. Please try again."};getActionableSteps=()=>{const e=this.getErrorSeverity(),t=[];return"low"===e?(t.push("Try the action again"),t.push("Refresh this section")):"medium"===e?(t.push("Try again in a few moments"),t.push("Check your internet connection"),t.push("Use other features while we investigate")):(t.push("Refresh the entire page"),t.push("Clear browser cache and try again"),t.push("Contact support if the problem persists")),t};render(){if(this.state.hasError){if(this.props.fallback)return this.props.fallback;const t=this.getErrorSeverity(),r=this.getErrorMessage(),n=this.getActionableSteps(),s="p-6 m-4 rounded-lg border-2 "+("high"===t?"border-red-500 bg-red-50":"medium"===t?"border-orange-500 bg-orange-50":"border-yellow-500 bg-yellow-50"),a="high"===t?"text-red-600":"medium"===t?"text-orange-600":"text-yellow-600";return e.jsx("div",{className:s,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(C,{className:`w-6 h-6 mt-0.5 flex-shrink-0 ${a}`}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:`font-semibold text-lg ${a}`,children:"high"===t?"Critical Error":"medium"===t?"Error Occurred":"Something Went Wrong"}),e.jsx("p",{className:"mt-2 text-gray-700",children:r})]})}),e.jsxs("div",{className:"mt-4",children:[e.jsx("p",{className:"font-medium text-gray-800 mb-2",children:"What you can do:"}),e.jsx("ul",{className:"list-disc list-inside space-y-1 text-sm text-gray-600",children:n.map((t,r)=>e.jsx("li",{children:t},r))})]}),e.jsxs("div",{className:"flex items-center gap-3 mt-4",children:[e.jsxs("button",{onClick:this.handleRetry,className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors",children:[e.jsx(j,{className:"w-4 h-4"}),"Try Again"]}),e.jsxs("button",{onClick:this.handleShowDetails,className:"flex items-center gap-2 px-4 py-2 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300 transition-colors",children:[e.jsx(D,{className:"w-4 h-4"}),this.state.showDetails?"Hide":"Show"," Details",this.state.showDetails?e.jsx(T,{className:"w-4 h-4"}):e.jsx(w,{className:"w-4 h-4"})]})]}),this.state.showDetails&&this.state.error&&e.jsxs("div",{className:"mt-4 p-4 bg-gray-100 rounded-md",children:[e.jsx("h4",{className:"font-medium text-gray-800 mb-2",children:"Technical Details:"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-700",children:"Error:"}),e.jsx("code",{className:"block text-xs bg-white p-2 rounded mt-1 text-red-600",children:this.state.error.message})]}),this.state.error.stack&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-700",children:"Stack Trace:"}),e.jsx("pre",{className:"block text-xs bg-white p-2 rounded mt-1 overflow-x-auto max-h-32 text-gray-600",children:this.state.error.stack})]}),this.state.errorInfo?.componentStack&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-700",children:"Component Stack:"}),e.jsx("pre",{className:"block text-xs bg-white p-2 rounded mt-1 overflow-x-auto max-h-32 text-gray-600",children:this.state.errorInfo.componentStack})]}),e.jsxs("div",{className:"text-xs text-gray-500 pt-2 border-t",children:["Retry count: ",this.state.retryCount," | Level: ",this.props.level||"unknown"," | Component: ",this.props.name||"unnamed"]})]})]})]})]})})}return this.props.children}}const Va=new class{reports=[];notifications=[];listeners=[];sessionId;maxReports=100;errorHandler;unhandledRejectionHandler;constructor(){this.sessionId=this.generateSessionId(),this.setupGlobalErrorHandlers()}generateSessionId(){return`session_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}setupGlobalErrorHandlers(){this.errorHandler=e=>{this.reportError({error:e.error||new Error(e.message),level:"high",additionalContext:{filename:e.filename,lineno:e.lineno,colno:e.colno,type:"javascript"}})},this.unhandledRejectionHandler=e=>{this.reportError({error:e.reason instanceof Error?e.reason:new Error(String(e.reason)),level:"medium",additionalContext:{type:"promise_rejection",reason:e.reason}})},window.addEventListener("error",this.errorHandler),window.addEventListener("unhandledrejection",this.unhandledRejectionHandler),window.errorReporting=this}reportError(e){const t=`error_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,r=this.determineSeverity(e.error,e.level,e.retryCount),n={id:t,timestamp:(new Date).toISOString(),level:r,message:e.error.message,stack:e.error.stack,componentStack:e.errorInfo?.componentStack,errorBoundary:e.level?{name:e.name,level:e.level,retryCount:e.retryCount||0}:void 0,userAgent:navigator.userAgent,url:window.location.href,sessionId:this.sessionId,additionalContext:e.additionalContext};return this.reports.unshift(n),this.reports.length>this.maxReports&&(this.reports=this.reports.slice(0,this.maxReports)),console.error("Error reported:",n),this.createErrorNotification(n),t}determineSeverity(e,t,r=0){return"app"===t||r>2||"ChunkLoadError"===e.name||e.message.includes("out of memory")?"high":"feature"===t||r>0||"NetworkError"===e.name||"TypeError"===e.name&&e.message.includes("fetch")?"medium":"low"}createErrorNotification(e){if(this.notifications.filter(e=>"error"===e.type).length>=3)return;const t={id:`notif_${e.id}`,type:"error",title:this.getNotificationTitle(e.level),message:this.getNotificationMessage(e),actions:this.getNotificationActions(e),autoHide:"low"===e.level,duration:"low"===e.level?5e3:void 0};this.addNotification(t)}getNotificationTitle(e){switch(e){case"high":return"Critical Error";case"medium":return"Error Occurred";case"low":return"Something Went Wrong"}}getNotificationMessage(e){return"high"===e.level?"A critical error has occurred. Please refresh the page.":"medium"===e.level?"An error occurred. Some features may not work properly.":"A minor error occurred. You can continue using the app normally."}getNotificationActions(e){const t=[];return"high"===e.level?t.push({label:"Refresh Page",action:()=>window.location.reload()}):t.push({label:"Retry",action:()=>{this.removeNotification(e.id)}}),t.push({label:"Dismiss",action:()=>this.removeNotification(`notif_${e.id}`)}),t}addNotification(e){this.notifications.unshift(e),this.notifyListeners(),e.autoHide&&e.duration&&setTimeout(()=>{this.removeNotification(e.id)},e.duration)}removeNotification(e){this.notifications=this.notifications.filter(t=>t.id!==e),this.notifyListeners()}getNotifications(){return[...this.notifications]}onNotificationsChange(e){return this.listeners.push(e),()=>{this.listeners=this.listeners.filter(t=>t!==e)}}notifyListeners(){const e=[...this.notifications];this.listeners.forEach(t=>t(e))}getReports(e){return e?this.reports.slice(0,e):[...this.reports]}clearReports(){this.reports=[]}getSessionInfo(){return{sessionId:this.sessionId,reportCount:this.reports.length,highSeverityCount:this.reports.filter(e=>"high"===e.level).length}}destroy(){this.errorHandler&&window.removeEventListener("error",this.errorHandler),this.unhandledRejectionHandler&&window.removeEventListener("unhandledrejection",this.unhandledRejectionHandler),this.reports=[],this.notifications=[],this.listeners=[],delete window.errorReporting}reportUserError(e,t,r){const n={id:`user_${Date.now()}`,type:"error",title:e,message:message,actions:r||[{label:"OK",action:()=>this.removeNotification(`user_${Date.now()}`)}]};this.addNotification(n)}reportUserWarning(e,t){const r={id:`warning_${Date.now()}`,type:"warning",title:e,message:t,autoHide:!0,duration:4e3};this.addNotification(r)}reportUserInfo(e,t){const r={id:`info_${Date.now()}`,type:"info",title:e,message:t,autoHide:!0,duration:3e3};this.addNotification(r)}};function Wa(){return Va}function Ba({notification:t,onRemove:r}){return e.jsx("div",{className:`${(()=>{switch(t.type){case"error":return"bg-red-50 border-red-200";case"warning":return"bg-orange-50 border-orange-200";case"info":return"bg-blue-50 border-blue-200";default:return"bg-green-50 border-green-200"}})()} border rounded-lg p-4 shadow-md max-w-md animate-slide-in`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex-shrink-0",children:(()=>{switch(t.type){case"error":return e.jsx(C,{className:"w-5 h-5 text-red-600"});case"warning":return e.jsx(O,{className:"w-5 h-5 text-orange-600"});case"info":return e.jsx(k,{className:"w-5 h-5 text-blue-600"});default:return e.jsx(I,{className:"w-5 h-5 text-green-600"})}})()}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-medium text-gray-900 text-sm",children:t.title}),e.jsx("p",{className:"mt-1 text-sm text-gray-600",children:t.message}),t.actions&&t.actions.length>0&&e.jsx("div",{className:"mt-3 flex gap-2",children:t.actions.map((t,r)=>e.jsx("button",{onClick:t.action,className:"px-3 py-1 text-xs font-medium rounded transition-colors "+(0===r?"bg-gray-700 text-white hover:bg-gray-800":"bg-gray-200 text-gray-700 hover:bg-gray-300"),children:t.label},r))})]}),e.jsx("button",{onClick:()=>r(t.id),className:"flex-shrink-0 p-1 text-gray-400 hover:text-gray-600 transition-colors","aria-label":"Dismiss notification",children:e.jsx(l,{className:"w-4 h-4"})})]})})}function qa(){const t=Wa(),[n,s]=r.useState([]);r.useEffect(()=>{const e=t.onNotificationsChange(s);return s(t.getNotifications()),e},[t]);const a=e=>{t.removeNotification(e)};return 0===n.length?null:e.jsx("div",{className:"fixed top-4 right-4 z-50 space-y-2",children:n.map(t=>e.jsx(Ba,{notification:t,onRemove:a},t.id))})}function Ga(){return e.jsx(Ve,{children:e.jsx(Qe,{children:e.jsx(ir,{children:e.jsx(tt,{children:e.jsx(ut,{children:e.jsxs(pt,{children:[e.jsxs("div",{className:"h-screen flex flex-col bg-gray-50",children:[e.jsx(za,{level:"component",name:"Toolbar",children:e.jsx(pn,{})}),e.jsx(za,{level:"component",name:"Navigator",children:e.jsx(Ra,{})}),e.jsx(za,{level:"component",name:"PAFVNavigator",children:e.jsx(Oa,{})}),e.jsxs("div",{className:"flex-1 flex min-h-0",children:[e.jsx(za,{level:"feature",name:"Sidebar",children:e.jsx(La,{})}),e.jsx("div",{className:"flex-1 flex flex-col",children:e.jsx(za,{level:"feature",name:"Canvas",children:e.jsx(cn,{})})}),e.jsx(za,{level:"feature",name:"RightSidebar",children:e.jsx(Fa,{})})]}),e.jsx(za,{level:"component",name:"NavigatorFooter",children:e.jsx(Ua,{})}),e.jsx(za,{level:"feature",name:"CommandBar",children:e.jsx(Xa,{})})]}),e.jsx(qa,{})]})})})})})})}function Ka(){const[t,n]=r.useState(!1);return t?e.jsxs(za,{level:"app",name:"UnifiedApp",children:[e.jsx(Ga,{}),e.jsx(qa,{})]}):e.jsx(za,{level:"app",name:"MVPDemo",children:e.jsx(Ve,{children:e.jsx(Qe,{children:e.jsx(tt,{children:e.jsx(ut,{children:e.jsxs(pt,{children:[e.jsxs("div",{className:"h-screen bg-gray-50",children:[e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold mb-2",children:"Isometry MVP Demo"}),e.jsx("p",{className:"text-gray-600",children:"Canvas with mock data - no database dependencies"})]}),e.jsx("button",{onClick:()=>n(!0),className:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 transition-colors",children:"Test Unified UI"})]})}),e.jsx(za,{level:"feature",name:"Canvas",children:e.jsx("div",{className:"h-[calc(100vh-120px)]",children:e.jsx(cn,{})})})]}),e.jsx(qa,{})]})})})})})})}function Ya(){return e.jsx(Ka,{})}ue.createRoot(document.getElementById("root")).render(e.jsx(P.StrictMode,{children:e.jsx(Ya,{})}));
//# sourceMappingURL=index-kDNBRokS.js.map
