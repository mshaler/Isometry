{"version":3,"file":"index-kDNBRokS.js","sources":["../../node_modules/react-dom/client.js","../../node_modules/@remix-run/router/dist/router.js","../../node_modules/react-router/dist/index.js","../../node_modules/react-router-dom/dist/index.js","../../src/contexts/ThemeContext.tsx","../../src/hooks/useURLState.ts","../../src/contexts/AppStateContext.tsx","../../src/utils/input-sanitization.ts","../../src/dsl/compiler.ts","../../src/contexts/FilterContext.tsx","../../src/contexts/PAFVContext.tsx","../../src/hooks/useMockData.ts","../../node_modules/@babel/runtime/helpers/esm/extends.js","../../node_modules/@babel/runtime/helpers/esm/assertThisInitialized.js","../../node_modules/@babel/runtime/helpers/esm/setPrototypeOf.js","../../node_modules/memoize-one/dist/memoize-one.esm.js","../../node_modules/react-window/dist/index.esm.js","../../node_modules/@babel/runtime/helpers/esm/inheritsLoose.js","../../src/hooks/usePAFV.ts","../../src/db/NativeDatabaseContext.tsx","../../../../../node_modules/uuid/dist/esm-browser/stringify.js","../../../../../node_modules/uuid/dist/esm-browser/rng.js","../../../../../node_modules/uuid/dist/esm-browser/native.js","../../../../../node_modules/uuid/dist/esm-browser/v4.js","../../src/utils/logger.ts","../../src/utils/webview-bridge.ts","../../src/db/WebViewDatabaseContext.tsx","../../src/contexts/EnvironmentContext.tsx","../../src/db/DatabaseContext.tsx","../../src/types/node.ts","../../src/db/QueryTranslation.ts","../../src/hooks/useCacheInvalidation.tsx","../../src/hooks/useSQLiteQuery.ts","../../src/hooks/useFilteredNodes.ts","../../src/hooks/useListData.ts","../../src/state/SelectionContext.tsx","../../src/components/ListItem.tsx","../../src/components/views/ListView.tsx","../../src/components/views/GridView.tsx","../../src/components/views/KanbanView.tsx","../../src/components/views/TimelineView.tsx","../../src/components/views/CalendarView.tsx","../../src/styles/themes.ts","../../src/d3/hooks.ts","../../src/components/views/ChartsView.tsx","../../src/hooks/useComponentTheme.ts","../../src/components/views/NetworkView.tsx","../../src/components/views/TreeView.tsx","../../src/utils/d3Scales.ts","../../src/hooks/useD3Canvas.ts","../../src/utils/d3Performance.ts","../../src/components/D3Canvas.tsx","../../src/hooks/useD3.ts","../../src/components/views/D3GridView.tsx","../../src/components/views/D3ListView.tsx","../../src/components/FilterBar.tsx","../../src/components/Canvas.tsx","../../src/components/ui/buttons/IconButton.tsx","../../src/components/Toolbar.tsx","../../node_modules/react-dnd/dist/core/DndContext.js","../../node_modules/redux/es/redux.js","../../node_modules/@react-dnd/invariant/dist/index.js","../../node_modules/dnd-core/dist/utils/js_utils.js","../../node_modules/dnd-core/dist/actions/dragDrop/types.js","../../node_modules/dnd-core/dist/actions/dragDrop/local/setClientOffset.js","../../node_modules/dnd-core/dist/actions/dragDrop/beginDrag.js","../../node_modules/dnd-core/dist/actions/dragDrop/drop.js","../../node_modules/dnd-core/dist/actions/dragDrop/endDrag.js","../../node_modules/dnd-core/dist/utils/matchesType.js","../../node_modules/dnd-core/dist/actions/dragDrop/hover.js","../../node_modules/dnd-core/dist/actions/dragDrop/publishDragSource.js","../../node_modules/dnd-core/dist/classes/DragDropManagerImpl.js","../../node_modules/dnd-core/dist/actions/dragDrop/index.js","../../node_modules/dnd-core/dist/utils/coords.js","../../node_modules/dnd-core/dist/utils/dirtiness.js","../../node_modules/dnd-core/dist/classes/DragDropMonitorImpl.js","../../node_modules/@react-dnd/asap/dist/makeRequestCall.js","../../node_modules/@react-dnd/asap/dist/RawTask.js","../../node_modules/@react-dnd/asap/dist/asap.js","../../node_modules/@react-dnd/asap/dist/AsapQueue.js","../../node_modules/@react-dnd/asap/dist/TaskFactory.js","../../node_modules/dnd-core/dist/actions/registry.js","../../node_modules/dnd-core/dist/contracts.js","../../node_modules/dnd-core/dist/interfaces.js","../../node_modules/dnd-core/dist/utils/getNextUniqueId.js","../../node_modules/dnd-core/dist/classes/HandlerRegistryImpl.js","../../node_modules/dnd-core/dist/utils/equality.js","../../node_modules/dnd-core/dist/reducers/dirtyHandlerIds.js","../../node_modules/dnd-core/dist/reducers/dragOffset.js","../../node_modules/dnd-core/dist/reducers/dragOperation.js","../../node_modules/dnd-core/dist/reducers/refCount.js","../../node_modules/dnd-core/dist/reducers/stateId.js","../../node_modules/dnd-core/dist/reducers/index.js","../../node_modules/dnd-core/dist/createDragDropManager.js","../../node_modules/react-dnd/dist/core/DndProvider.js","../../node_modules/fast-deep-equal/index.js","../../node_modules/react-dnd/dist/hooks/useIsomorphicLayoutEffect.js","../../node_modules/react-dnd/dist/hooks/useMonitorOutput.js","../../node_modules/react-dnd/dist/hooks/useCollector.js","../../node_modules/react-dnd/dist/hooks/useCollectedProps.js","../../node_modules/react-dnd/dist/hooks/useOptionalFactory.js","../../node_modules/react-dnd/dist/hooks/useDrag/connectors.js","../../node_modules/react-dnd/dist/internals/DragSourceMonitorImpl.js","../../node_modules/react-dnd/dist/internals/DropTargetMonitorImpl.js","../../node_modules/@react-dnd/shallowequal/dist/index.js","../../node_modules/react-dnd/dist/internals/isRef.js","../../node_modules/react-dnd/dist/internals/wrapConnectorHooks.js","../../node_modules/react-dnd/dist/internals/SourceConnector.js","../../node_modules/react-dnd/dist/internals/TargetConnector.js","../../node_modules/react-dnd/dist/hooks/useDragDropManager.js","../../node_modules/react-dnd/dist/hooks/useDrag/DragSourceImpl.js","../../node_modules/react-dnd/dist/hooks/useDrag/useRegisteredDragSource.js","../../node_modules/react-dnd/dist/hooks/useDrag/useDragSource.js","../../node_modules/react-dnd/dist/hooks/useDrag/useDragType.js","../../node_modules/react-dnd/dist/internals/registration.js","../../node_modules/react-dnd/dist/hooks/useDrag/useDrag.js","../../node_modules/react-dnd/dist/hooks/useDrag/useDragSourceMonitor.js","../../node_modules/react-dnd/dist/hooks/useDrag/useDragSourceConnector.js","../../node_modules/react-dnd/dist/hooks/useDrop/connectors.js","../../node_modules/react-dnd/dist/hooks/useDrop/DropTargetImpl.js","../../node_modules/react-dnd/dist/hooks/useDrop/useRegisteredDropTarget.js","../../node_modules/react-dnd/dist/hooks/useDrop/useDropTarget.js","../../node_modules/react-dnd/dist/hooks/useDrop/useAccept.js","../../node_modules/react-dnd/dist/hooks/useDrop/useDrop.js","../../node_modules/react-dnd/dist/hooks/useDrop/useDropTargetMonitor.js","../../node_modules/react-dnd/dist/hooks/useDrop/useDropTargetConnector.js","../../node_modules/react-dnd-html5-backend/dist/utils/js_utils.js","../../node_modules/react-dnd-html5-backend/dist/EnterLeaveCounter.js","../../node_modules/react-dnd-html5-backend/dist/NativeDragSources/NativeDragSource.js","../../node_modules/react-dnd-html5-backend/dist/NativeTypes.js","../../node_modules/react-dnd-html5-backend/dist/NativeDragSources/getDataFromDataTransfer.js","../../node_modules/react-dnd-html5-backend/dist/NativeDragSources/nativeTypesConfig.js","../../node_modules/react-dnd-html5-backend/dist/NativeDragSources/index.js","../../node_modules/react-dnd-html5-backend/dist/BrowserDetector.js","../../node_modules/react-dnd-html5-backend/dist/MonotonicInterpolant.js","../../node_modules/react-dnd-html5-backend/dist/OffsetUtils.js","../../node_modules/react-dnd-html5-backend/dist/OptionsReader.js","../../node_modules/react-dnd-html5-backend/dist/HTML5BackendImpl.js","../../node_modules/react-dnd-html5-backend/dist/index.js","../../src/components/PAFVNavigator.tsx","../../src/components/ui/Dropdown.tsx","../../src/components/Navigator.tsx","../../src/components/ui/TabPanel.tsx","../../src/components/ui/AccordionSection.tsx","../../src/components/Sidebar.tsx","../../src/components/RightSidebar.tsx","../../src/components/NavigatorFooter.tsx","../../src/dsl/parser.ts","../../src/components/CommandBar.tsx","../../src/components/ui/ErrorBoundary.tsx","../../src/services/ErrorReportingService.ts","../../src/components/ui/NotificationSystem.tsx","../../src/components/UnifiedApp.tsx","../../src/MVPDemo.tsx","../../src/App.tsx","../../src/main.tsx"],"sourcesContent":["'use strict';\n\nvar m = require('react-dom');\nif (process.env.NODE_ENV === 'production') {\n  exports.createRoot = m.createRoot;\n  exports.hydrateRoot = m.hydrateRoot;\n} else {\n  var i = m.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;\n  exports.createRoot = function(c, o) {\n    i.usingClientEntryPoint = true;\n    try {\n      return m.createRoot(c, o);\n    } finally {\n      i.usingClientEntryPoint = false;\n    }\n  };\n  exports.hydrateRoot = function(c, h, o) {\n    i.usingClientEntryPoint = true;\n    try {\n      return m.hydrateRoot(c, h, o);\n    } finally {\n      i.usingClientEntryPoint = false;\n    }\n  };\n}\n","/**\n * @remix-run/router v1.23.2\n *\n * Copyright (c) Remix Software Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE.md file in the root directory of this source tree.\n *\n * @license MIT\n */\nfunction _extends() {\n  _extends = Object.assign ? Object.assign.bind() : function (target) {\n    for (var i = 1; i < arguments.length; i++) {\n      var source = arguments[i];\n      for (var key in source) {\n        if (Object.prototype.hasOwnProperty.call(source, key)) {\n          target[key] = source[key];\n        }\n      }\n    }\n    return target;\n  };\n  return _extends.apply(this, arguments);\n}\n\n////////////////////////////////////////////////////////////////////////////////\n//#region Types and Constants\n////////////////////////////////////////////////////////////////////////////////\n/**\n * Actions represent the type of change to a location value.\n */\nvar Action;\n(function (Action) {\n  /**\n   * A POP indicates a change to an arbitrary index in the history stack, such\n   * as a back or forward navigation. It does not describe the direction of the\n   * navigation, only that the current index changed.\n   *\n   * Note: This is the default action for newly created history objects.\n   */\n  Action[\"Pop\"] = \"POP\";\n  /**\n   * A PUSH indicates a new entry being added to the history stack, such as when\n   * a link is clicked and a new page loads. When this happens, all subsequent\n   * entries in the stack are lost.\n   */\n  Action[\"Push\"] = \"PUSH\";\n  /**\n   * A REPLACE indicates the entry at the current index in the history stack\n   * being replaced by a new one.\n   */\n  Action[\"Replace\"] = \"REPLACE\";\n})(Action || (Action = {}));\nconst PopStateEventType = \"popstate\";\n/**\n * Memory history stores the current location in memory. It is designed for use\n * in stateful non-browser environments like tests and React Native.\n */\nfunction createMemoryHistory(options) {\n  if (options === void 0) {\n    options = {};\n  }\n  let {\n    initialEntries = [\"/\"],\n    initialIndex,\n    v5Compat = false\n  } = options;\n  let entries; // Declare so we can access from createMemoryLocation\n  entries = initialEntries.map((entry, index) => createMemoryLocation(entry, typeof entry === \"string\" ? null : entry.state, index === 0 ? \"default\" : undefined));\n  let index = clampIndex(initialIndex == null ? entries.length - 1 : initialIndex);\n  let action = Action.Pop;\n  let listener = null;\n  function clampIndex(n) {\n    return Math.min(Math.max(n, 0), entries.length - 1);\n  }\n  function getCurrentLocation() {\n    return entries[index];\n  }\n  function createMemoryLocation(to, state, key) {\n    if (state === void 0) {\n      state = null;\n    }\n    let location = createLocation(entries ? getCurrentLocation().pathname : \"/\", to, state, key);\n    warning(location.pathname.charAt(0) === \"/\", \"relative pathnames are not supported in memory history: \" + JSON.stringify(to));\n    return location;\n  }\n  function createHref(to) {\n    return typeof to === \"string\" ? to : createPath(to);\n  }\n  let history = {\n    get index() {\n      return index;\n    },\n    get action() {\n      return action;\n    },\n    get location() {\n      return getCurrentLocation();\n    },\n    createHref,\n    createURL(to) {\n      return new URL(createHref(to), \"http://localhost\");\n    },\n    encodeLocation(to) {\n      let path = typeof to === \"string\" ? parsePath(to) : to;\n      return {\n        pathname: path.pathname || \"\",\n        search: path.search || \"\",\n        hash: path.hash || \"\"\n      };\n    },\n    push(to, state) {\n      action = Action.Push;\n      let nextLocation = createMemoryLocation(to, state);\n      index += 1;\n      entries.splice(index, entries.length, nextLocation);\n      if (v5Compat && listener) {\n        listener({\n          action,\n          location: nextLocation,\n          delta: 1\n        });\n      }\n    },\n    replace(to, state) {\n      action = Action.Replace;\n      let nextLocation = createMemoryLocation(to, state);\n      entries[index] = nextLocation;\n      if (v5Compat && listener) {\n        listener({\n          action,\n          location: nextLocation,\n          delta: 0\n        });\n      }\n    },\n    go(delta) {\n      action = Action.Pop;\n      let nextIndex = clampIndex(index + delta);\n      let nextLocation = entries[nextIndex];\n      index = nextIndex;\n      if (listener) {\n        listener({\n          action,\n          location: nextLocation,\n          delta\n        });\n      }\n    },\n    listen(fn) {\n      listener = fn;\n      return () => {\n        listener = null;\n      };\n    }\n  };\n  return history;\n}\n/**\n * Browser history stores the location in regular URLs. This is the standard for\n * most web apps, but it requires some configuration on the server to ensure you\n * serve the same app at multiple URLs.\n *\n * @see https://github.com/remix-run/history/tree/main/docs/api-reference.md#createbrowserhistory\n */\nfunction createBrowserHistory(options) {\n  if (options === void 0) {\n    options = {};\n  }\n  function createBrowserLocation(window, globalHistory) {\n    let {\n      pathname,\n      search,\n      hash\n    } = window.location;\n    return createLocation(\"\", {\n      pathname,\n      search,\n      hash\n    },\n    // state defaults to `null` because `window.history.state` does\n    globalHistory.state && globalHistory.state.usr || null, globalHistory.state && globalHistory.state.key || \"default\");\n  }\n  function createBrowserHref(window, to) {\n    return typeof to === \"string\" ? to : createPath(to);\n  }\n  return getUrlBasedHistory(createBrowserLocation, createBrowserHref, null, options);\n}\n/**\n * Hash history stores the location in window.location.hash. This makes it ideal\n * for situations where you don't want to send the location to the server for\n * some reason, either because you do cannot configure it or the URL space is\n * reserved for something else.\n *\n * @see https://github.com/remix-run/history/tree/main/docs/api-reference.md#createhashhistory\n */\nfunction createHashHistory(options) {\n  if (options === void 0) {\n    options = {};\n  }\n  function createHashLocation(window, globalHistory) {\n    let {\n      pathname = \"/\",\n      search = \"\",\n      hash = \"\"\n    } = parsePath(window.location.hash.substr(1));\n    // Hash URL should always have a leading / just like window.location.pathname\n    // does, so if an app ends up at a route like /#something then we add a\n    // leading slash so all of our path-matching behaves the same as if it would\n    // in a browser router.  This is particularly important when there exists a\n    // root splat route (<Route path=\"*\">) since that matches internally against\n    // \"/*\" and we'd expect /#something to 404 in a hash router app.\n    if (!pathname.startsWith(\"/\") && !pathname.startsWith(\".\")) {\n      pathname = \"/\" + pathname;\n    }\n    return createLocation(\"\", {\n      pathname,\n      search,\n      hash\n    },\n    // state defaults to `null` because `window.history.state` does\n    globalHistory.state && globalHistory.state.usr || null, globalHistory.state && globalHistory.state.key || \"default\");\n  }\n  function createHashHref(window, to) {\n    let base = window.document.querySelector(\"base\");\n    let href = \"\";\n    if (base && base.getAttribute(\"href\")) {\n      let url = window.location.href;\n      let hashIndex = url.indexOf(\"#\");\n      href = hashIndex === -1 ? url : url.slice(0, hashIndex);\n    }\n    return href + \"#\" + (typeof to === \"string\" ? to : createPath(to));\n  }\n  function validateHashLocation(location, to) {\n    warning(location.pathname.charAt(0) === \"/\", \"relative pathnames are not supported in hash history.push(\" + JSON.stringify(to) + \")\");\n  }\n  return getUrlBasedHistory(createHashLocation, createHashHref, validateHashLocation, options);\n}\nfunction invariant(value, message) {\n  if (value === false || value === null || typeof value === \"undefined\") {\n    throw new Error(message);\n  }\n}\nfunction warning(cond, message) {\n  if (!cond) {\n    // eslint-disable-next-line no-console\n    if (typeof console !== \"undefined\") console.warn(message);\n    try {\n      // Welcome to debugging history!\n      //\n      // This error is thrown as a convenience, so you can more easily\n      // find the source for a warning that appears in the console by\n      // enabling \"pause on exceptions\" in your JavaScript debugger.\n      throw new Error(message);\n      // eslint-disable-next-line no-empty\n    } catch (e) {}\n  }\n}\nfunction createKey() {\n  return Math.random().toString(36).substr(2, 8);\n}\n/**\n * For browser-based histories, we combine the state and key into an object\n */\nfunction getHistoryState(location, index) {\n  return {\n    usr: location.state,\n    key: location.key,\n    idx: index\n  };\n}\n/**\n * Creates a Location object with a unique key from the given Path\n */\nfunction createLocation(current, to, state, key) {\n  if (state === void 0) {\n    state = null;\n  }\n  let location = _extends({\n    pathname: typeof current === \"string\" ? current : current.pathname,\n    search: \"\",\n    hash: \"\"\n  }, typeof to === \"string\" ? parsePath(to) : to, {\n    state,\n    // TODO: This could be cleaned up.  push/replace should probably just take\n    // full Locations now and avoid the need to run through this flow at all\n    // But that's a pretty big refactor to the current test suite so going to\n    // keep as is for the time being and just let any incoming keys take precedence\n    key: to && to.key || key || createKey()\n  });\n  return location;\n}\n/**\n * Creates a string URL path from the given pathname, search, and hash components.\n */\nfunction createPath(_ref) {\n  let {\n    pathname = \"/\",\n    search = \"\",\n    hash = \"\"\n  } = _ref;\n  if (search && search !== \"?\") pathname += search.charAt(0) === \"?\" ? search : \"?\" + search;\n  if (hash && hash !== \"#\") pathname += hash.charAt(0) === \"#\" ? hash : \"#\" + hash;\n  return pathname;\n}\n/**\n * Parses a string URL path into its separate pathname, search, and hash components.\n */\nfunction parsePath(path) {\n  let parsedPath = {};\n  if (path) {\n    let hashIndex = path.indexOf(\"#\");\n    if (hashIndex >= 0) {\n      parsedPath.hash = path.substr(hashIndex);\n      path = path.substr(0, hashIndex);\n    }\n    let searchIndex = path.indexOf(\"?\");\n    if (searchIndex >= 0) {\n      parsedPath.search = path.substr(searchIndex);\n      path = path.substr(0, searchIndex);\n    }\n    if (path) {\n      parsedPath.pathname = path;\n    }\n  }\n  return parsedPath;\n}\nfunction getUrlBasedHistory(getLocation, createHref, validateLocation, options) {\n  if (options === void 0) {\n    options = {};\n  }\n  let {\n    window = document.defaultView,\n    v5Compat = false\n  } = options;\n  let globalHistory = window.history;\n  let action = Action.Pop;\n  let listener = null;\n  let index = getIndex();\n  // Index should only be null when we initialize. If not, it's because the\n  // user called history.pushState or history.replaceState directly, in which\n  // case we should log a warning as it will result in bugs.\n  if (index == null) {\n    index = 0;\n    globalHistory.replaceState(_extends({}, globalHistory.state, {\n      idx: index\n    }), \"\");\n  }\n  function getIndex() {\n    let state = globalHistory.state || {\n      idx: null\n    };\n    return state.idx;\n  }\n  function handlePop() {\n    action = Action.Pop;\n    let nextIndex = getIndex();\n    let delta = nextIndex == null ? null : nextIndex - index;\n    index = nextIndex;\n    if (listener) {\n      listener({\n        action,\n        location: history.location,\n        delta\n      });\n    }\n  }\n  function push(to, state) {\n    action = Action.Push;\n    let location = createLocation(history.location, to, state);\n    if (validateLocation) validateLocation(location, to);\n    index = getIndex() + 1;\n    let historyState = getHistoryState(location, index);\n    let url = history.createHref(location);\n    // try...catch because iOS limits us to 100 pushState calls :/\n    try {\n      globalHistory.pushState(historyState, \"\", url);\n    } catch (error) {\n      // If the exception is because `state` can't be serialized, let that throw\n      // outwards just like a replace call would so the dev knows the cause\n      // https://html.spec.whatwg.org/multipage/nav-history-apis.html#shared-history-push/replace-state-steps\n      // https://html.spec.whatwg.org/multipage/structured-data.html#structuredserializeinternal\n      if (error instanceof DOMException && error.name === \"DataCloneError\") {\n        throw error;\n      }\n      // They are going to lose state here, but there is no real\n      // way to warn them about it since the page will refresh...\n      window.location.assign(url);\n    }\n    if (v5Compat && listener) {\n      listener({\n        action,\n        location: history.location,\n        delta: 1\n      });\n    }\n  }\n  function replace(to, state) {\n    action = Action.Replace;\n    let location = createLocation(history.location, to, state);\n    if (validateLocation) validateLocation(location, to);\n    index = getIndex();\n    let historyState = getHistoryState(location, index);\n    let url = history.createHref(location);\n    globalHistory.replaceState(historyState, \"\", url);\n    if (v5Compat && listener) {\n      listener({\n        action,\n        location: history.location,\n        delta: 0\n      });\n    }\n  }\n  function createURL(to) {\n    // window.location.origin is \"null\" (the literal string value) in Firefox\n    // under certain conditions, notably when serving from a local HTML file\n    // See https://bugzilla.mozilla.org/show_bug.cgi?id=878297\n    let base = window.location.origin !== \"null\" ? window.location.origin : window.location.href;\n    let href = typeof to === \"string\" ? to : createPath(to);\n    // Treating this as a full URL will strip any trailing spaces so we need to\n    // pre-encode them since they might be part of a matching splat param from\n    // an ancestor route\n    href = href.replace(/ $/, \"%20\");\n    invariant(base, \"No window.location.(origin|href) available to create URL for href: \" + href);\n    return new URL(href, base);\n  }\n  let history = {\n    get action() {\n      return action;\n    },\n    get location() {\n      return getLocation(window, globalHistory);\n    },\n    listen(fn) {\n      if (listener) {\n        throw new Error(\"A history only accepts one active listener\");\n      }\n      window.addEventListener(PopStateEventType, handlePop);\n      listener = fn;\n      return () => {\n        window.removeEventListener(PopStateEventType, handlePop);\n        listener = null;\n      };\n    },\n    createHref(to) {\n      return createHref(window, to);\n    },\n    createURL,\n    encodeLocation(to) {\n      // Encode a Location the same way window.location would\n      let url = createURL(to);\n      return {\n        pathname: url.pathname,\n        search: url.search,\n        hash: url.hash\n      };\n    },\n    push,\n    replace,\n    go(n) {\n      return globalHistory.go(n);\n    }\n  };\n  return history;\n}\n//#endregion\n\nvar ResultType;\n(function (ResultType) {\n  ResultType[\"data\"] = \"data\";\n  ResultType[\"deferred\"] = \"deferred\";\n  ResultType[\"redirect\"] = \"redirect\";\n  ResultType[\"error\"] = \"error\";\n})(ResultType || (ResultType = {}));\nconst immutableRouteKeys = new Set([\"lazy\", \"caseSensitive\", \"path\", \"id\", \"index\", \"children\"]);\nfunction isIndexRoute(route) {\n  return route.index === true;\n}\n// Walk the route tree generating unique IDs where necessary, so we are working\n// solely with AgnosticDataRouteObject's within the Router\nfunction convertRoutesToDataRoutes(routes, mapRouteProperties, parentPath, manifest) {\n  if (parentPath === void 0) {\n    parentPath = [];\n  }\n  if (manifest === void 0) {\n    manifest = {};\n  }\n  return routes.map((route, index) => {\n    let treePath = [...parentPath, String(index)];\n    let id = typeof route.id === \"string\" ? route.id : treePath.join(\"-\");\n    invariant(route.index !== true || !route.children, \"Cannot specify children on an index route\");\n    invariant(!manifest[id], \"Found a route id collision on id \\\"\" + id + \"\\\".  Route \" + \"id's must be globally unique within Data Router usages\");\n    if (isIndexRoute(route)) {\n      let indexRoute = _extends({}, route, mapRouteProperties(route), {\n        id\n      });\n      manifest[id] = indexRoute;\n      return indexRoute;\n    } else {\n      let pathOrLayoutRoute = _extends({}, route, mapRouteProperties(route), {\n        id,\n        children: undefined\n      });\n      manifest[id] = pathOrLayoutRoute;\n      if (route.children) {\n        pathOrLayoutRoute.children = convertRoutesToDataRoutes(route.children, mapRouteProperties, treePath, manifest);\n      }\n      return pathOrLayoutRoute;\n    }\n  });\n}\n/**\n * Matches the given routes to a location and returns the match data.\n *\n * @see https://reactrouter.com/v6/utils/match-routes\n */\nfunction matchRoutes(routes, locationArg, basename) {\n  if (basename === void 0) {\n    basename = \"/\";\n  }\n  return matchRoutesImpl(routes, locationArg, basename, false);\n}\nfunction matchRoutesImpl(routes, locationArg, basename, allowPartial) {\n  let location = typeof locationArg === \"string\" ? parsePath(locationArg) : locationArg;\n  let pathname = stripBasename(location.pathname || \"/\", basename);\n  if (pathname == null) {\n    return null;\n  }\n  let branches = flattenRoutes(routes);\n  rankRouteBranches(branches);\n  let matches = null;\n  for (let i = 0; matches == null && i < branches.length; ++i) {\n    // Incoming pathnames are generally encoded from either window.location\n    // or from router.navigate, but we want to match against the unencoded\n    // paths in the route definitions.  Memory router locations won't be\n    // encoded here but there also shouldn't be anything to decode so this\n    // should be a safe operation.  This avoids needing matchRoutes to be\n    // history-aware.\n    let decoded = decodePath(pathname);\n    matches = matchRouteBranch(branches[i], decoded, allowPartial);\n  }\n  return matches;\n}\nfunction convertRouteMatchToUiMatch(match, loaderData) {\n  let {\n    route,\n    pathname,\n    params\n  } = match;\n  return {\n    id: route.id,\n    pathname,\n    params,\n    data: loaderData[route.id],\n    handle: route.handle\n  };\n}\nfunction flattenRoutes(routes, branches, parentsMeta, parentPath) {\n  if (branches === void 0) {\n    branches = [];\n  }\n  if (parentsMeta === void 0) {\n    parentsMeta = [];\n  }\n  if (parentPath === void 0) {\n    parentPath = \"\";\n  }\n  let flattenRoute = (route, index, relativePath) => {\n    let meta = {\n      relativePath: relativePath === undefined ? route.path || \"\" : relativePath,\n      caseSensitive: route.caseSensitive === true,\n      childrenIndex: index,\n      route\n    };\n    if (meta.relativePath.startsWith(\"/\")) {\n      invariant(meta.relativePath.startsWith(parentPath), \"Absolute route path \\\"\" + meta.relativePath + \"\\\" nested under path \" + (\"\\\"\" + parentPath + \"\\\" is not valid. An absolute child route path \") + \"must start with the combined path of all its parent routes.\");\n      meta.relativePath = meta.relativePath.slice(parentPath.length);\n    }\n    let path = joinPaths([parentPath, meta.relativePath]);\n    let routesMeta = parentsMeta.concat(meta);\n    // Add the children before adding this route to the array, so we traverse the\n    // route tree depth-first and child routes appear before their parents in\n    // the \"flattened\" version.\n    if (route.children && route.children.length > 0) {\n      invariant(\n      // Our types know better, but runtime JS may not!\n      // @ts-expect-error\n      route.index !== true, \"Index routes must not have child routes. Please remove \" + (\"all child routes from route path \\\"\" + path + \"\\\".\"));\n      flattenRoutes(route.children, branches, routesMeta, path);\n    }\n    // Routes without a path shouldn't ever match by themselves unless they are\n    // index routes, so don't add them to the list of possible branches.\n    if (route.path == null && !route.index) {\n      return;\n    }\n    branches.push({\n      path,\n      score: computeScore(path, route.index),\n      routesMeta\n    });\n  };\n  routes.forEach((route, index) => {\n    var _route$path;\n    // coarse-grain check for optional params\n    if (route.path === \"\" || !((_route$path = route.path) != null && _route$path.includes(\"?\"))) {\n      flattenRoute(route, index);\n    } else {\n      for (let exploded of explodeOptionalSegments(route.path)) {\n        flattenRoute(route, index, exploded);\n      }\n    }\n  });\n  return branches;\n}\n/**\n * Computes all combinations of optional path segments for a given path,\n * excluding combinations that are ambiguous and of lower priority.\n *\n * For example, `/one/:two?/three/:four?/:five?` explodes to:\n * - `/one/three`\n * - `/one/:two/three`\n * - `/one/three/:four`\n * - `/one/three/:five`\n * - `/one/:two/three/:four`\n * - `/one/:two/three/:five`\n * - `/one/three/:four/:five`\n * - `/one/:two/three/:four/:five`\n */\nfunction explodeOptionalSegments(path) {\n  let segments = path.split(\"/\");\n  if (segments.length === 0) return [];\n  let [first, ...rest] = segments;\n  // Optional path segments are denoted by a trailing `?`\n  let isOptional = first.endsWith(\"?\");\n  // Compute the corresponding required segment: `foo?` -> `foo`\n  let required = first.replace(/\\?$/, \"\");\n  if (rest.length === 0) {\n    // Intepret empty string as omitting an optional segment\n    // `[\"one\", \"\", \"three\"]` corresponds to omitting `:two` from `/one/:two?/three` -> `/one/three`\n    return isOptional ? [required, \"\"] : [required];\n  }\n  let restExploded = explodeOptionalSegments(rest.join(\"/\"));\n  let result = [];\n  // All child paths with the prefix.  Do this for all children before the\n  // optional version for all children, so we get consistent ordering where the\n  // parent optional aspect is preferred as required.  Otherwise, we can get\n  // child sections interspersed where deeper optional segments are higher than\n  // parent optional segments, where for example, /:two would explode _earlier_\n  // then /:one.  By always including the parent as required _for all children_\n  // first, we avoid this issue\n  result.push(...restExploded.map(subpath => subpath === \"\" ? required : [required, subpath].join(\"/\")));\n  // Then, if this is an optional value, add all child versions without\n  if (isOptional) {\n    result.push(...restExploded);\n  }\n  // for absolute paths, ensure `/` instead of empty segment\n  return result.map(exploded => path.startsWith(\"/\") && exploded === \"\" ? \"/\" : exploded);\n}\nfunction rankRouteBranches(branches) {\n  branches.sort((a, b) => a.score !== b.score ? b.score - a.score // Higher score first\n  : compareIndexes(a.routesMeta.map(meta => meta.childrenIndex), b.routesMeta.map(meta => meta.childrenIndex)));\n}\nconst paramRe = /^:[\\w-]+$/;\nconst dynamicSegmentValue = 3;\nconst indexRouteValue = 2;\nconst emptySegmentValue = 1;\nconst staticSegmentValue = 10;\nconst splatPenalty = -2;\nconst isSplat = s => s === \"*\";\nfunction computeScore(path, index) {\n  let segments = path.split(\"/\");\n  let initialScore = segments.length;\n  if (segments.some(isSplat)) {\n    initialScore += splatPenalty;\n  }\n  if (index) {\n    initialScore += indexRouteValue;\n  }\n  return segments.filter(s => !isSplat(s)).reduce((score, segment) => score + (paramRe.test(segment) ? dynamicSegmentValue : segment === \"\" ? emptySegmentValue : staticSegmentValue), initialScore);\n}\nfunction compareIndexes(a, b) {\n  let siblings = a.length === b.length && a.slice(0, -1).every((n, i) => n === b[i]);\n  return siblings ?\n  // If two routes are siblings, we should try to match the earlier sibling\n  // first. This allows people to have fine-grained control over the matching\n  // behavior by simply putting routes with identical paths in the order they\n  // want them tried.\n  a[a.length - 1] - b[b.length - 1] :\n  // Otherwise, it doesn't really make sense to rank non-siblings by index,\n  // so they sort equally.\n  0;\n}\nfunction matchRouteBranch(branch, pathname, allowPartial) {\n  if (allowPartial === void 0) {\n    allowPartial = false;\n  }\n  let {\n    routesMeta\n  } = branch;\n  let matchedParams = {};\n  let matchedPathname = \"/\";\n  let matches = [];\n  for (let i = 0; i < routesMeta.length; ++i) {\n    let meta = routesMeta[i];\n    let end = i === routesMeta.length - 1;\n    let remainingPathname = matchedPathname === \"/\" ? pathname : pathname.slice(matchedPathname.length) || \"/\";\n    let match = matchPath({\n      path: meta.relativePath,\n      caseSensitive: meta.caseSensitive,\n      end\n    }, remainingPathname);\n    let route = meta.route;\n    if (!match && end && allowPartial && !routesMeta[routesMeta.length - 1].route.index) {\n      match = matchPath({\n        path: meta.relativePath,\n        caseSensitive: meta.caseSensitive,\n        end: false\n      }, remainingPathname);\n    }\n    if (!match) {\n      return null;\n    }\n    Object.assign(matchedParams, match.params);\n    matches.push({\n      // TODO: Can this as be avoided?\n      params: matchedParams,\n      pathname: joinPaths([matchedPathname, match.pathname]),\n      pathnameBase: normalizePathname(joinPaths([matchedPathname, match.pathnameBase])),\n      route\n    });\n    if (match.pathnameBase !== \"/\") {\n      matchedPathname = joinPaths([matchedPathname, match.pathnameBase]);\n    }\n  }\n  return matches;\n}\n/**\n * Returns a path with params interpolated.\n *\n * @see https://reactrouter.com/v6/utils/generate-path\n */\nfunction generatePath(originalPath, params) {\n  if (params === void 0) {\n    params = {};\n  }\n  let path = originalPath;\n  if (path.endsWith(\"*\") && path !== \"*\" && !path.endsWith(\"/*\")) {\n    warning(false, \"Route path \\\"\" + path + \"\\\" will be treated as if it were \" + (\"\\\"\" + path.replace(/\\*$/, \"/*\") + \"\\\" because the `*` character must \") + \"always follow a `/` in the pattern. To get rid of this warning, \" + (\"please change the route path to \\\"\" + path.replace(/\\*$/, \"/*\") + \"\\\".\"));\n    path = path.replace(/\\*$/, \"/*\");\n  }\n  // ensure `/` is added at the beginning if the path is absolute\n  const prefix = path.startsWith(\"/\") ? \"/\" : \"\";\n  const stringify = p => p == null ? \"\" : typeof p === \"string\" ? p : String(p);\n  const segments = path.split(/\\/+/).map((segment, index, array) => {\n    const isLastSegment = index === array.length - 1;\n    // only apply the splat if it's the last segment\n    if (isLastSegment && segment === \"*\") {\n      const star = \"*\";\n      // Apply the splat\n      return stringify(params[star]);\n    }\n    const keyMatch = segment.match(/^:([\\w-]+)(\\??)$/);\n    if (keyMatch) {\n      const [, key, optional] = keyMatch;\n      let param = params[key];\n      invariant(optional === \"?\" || param != null, \"Missing \\\":\" + key + \"\\\" param\");\n      return stringify(param);\n    }\n    // Remove any optional markers from optional static segments\n    return segment.replace(/\\?$/g, \"\");\n  })\n  // Remove empty segments\n  .filter(segment => !!segment);\n  return prefix + segments.join(\"/\");\n}\n/**\n * Performs pattern matching on a URL pathname and returns information about\n * the match.\n *\n * @see https://reactrouter.com/v6/utils/match-path\n */\nfunction matchPath(pattern, pathname) {\n  if (typeof pattern === \"string\") {\n    pattern = {\n      path: pattern,\n      caseSensitive: false,\n      end: true\n    };\n  }\n  let [matcher, compiledParams] = compilePath(pattern.path, pattern.caseSensitive, pattern.end);\n  let match = pathname.match(matcher);\n  if (!match) return null;\n  let matchedPathname = match[0];\n  let pathnameBase = matchedPathname.replace(/(.)\\/+$/, \"$1\");\n  let captureGroups = match.slice(1);\n  let params = compiledParams.reduce((memo, _ref, index) => {\n    let {\n      paramName,\n      isOptional\n    } = _ref;\n    // We need to compute the pathnameBase here using the raw splat value\n    // instead of using params[\"*\"] later because it will be decoded then\n    if (paramName === \"*\") {\n      let splatValue = captureGroups[index] || \"\";\n      pathnameBase = matchedPathname.slice(0, matchedPathname.length - splatValue.length).replace(/(.)\\/+$/, \"$1\");\n    }\n    const value = captureGroups[index];\n    if (isOptional && !value) {\n      memo[paramName] = undefined;\n    } else {\n      memo[paramName] = (value || \"\").replace(/%2F/g, \"/\");\n    }\n    return memo;\n  }, {});\n  return {\n    params,\n    pathname: matchedPathname,\n    pathnameBase,\n    pattern\n  };\n}\nfunction compilePath(path, caseSensitive, end) {\n  if (caseSensitive === void 0) {\n    caseSensitive = false;\n  }\n  if (end === void 0) {\n    end = true;\n  }\n  warning(path === \"*\" || !path.endsWith(\"*\") || path.endsWith(\"/*\"), \"Route path \\\"\" + path + \"\\\" will be treated as if it were \" + (\"\\\"\" + path.replace(/\\*$/, \"/*\") + \"\\\" because the `*` character must \") + \"always follow a `/` in the pattern. To get rid of this warning, \" + (\"please change the route path to \\\"\" + path.replace(/\\*$/, \"/*\") + \"\\\".\"));\n  let params = [];\n  let regexpSource = \"^\" + path.replace(/\\/*\\*?$/, \"\") // Ignore trailing / and /*, we'll handle it below\n  .replace(/^\\/*/, \"/\") // Make sure it has a leading /\n  .replace(/[\\\\.*+^${}|()[\\]]/g, \"\\\\$&\") // Escape special regex chars\n  .replace(/\\/:([\\w-]+)(\\?)?/g, (_, paramName, isOptional) => {\n    params.push({\n      paramName,\n      isOptional: isOptional != null\n    });\n    return isOptional ? \"/?([^\\\\/]+)?\" : \"/([^\\\\/]+)\";\n  });\n  if (path.endsWith(\"*\")) {\n    params.push({\n      paramName: \"*\"\n    });\n    regexpSource += path === \"*\" || path === \"/*\" ? \"(.*)$\" // Already matched the initial /, just match the rest\n    : \"(?:\\\\/(.+)|\\\\/*)$\"; // Don't include the / in params[\"*\"]\n  } else if (end) {\n    // When matching to the end, ignore trailing slashes\n    regexpSource += \"\\\\/*$\";\n  } else if (path !== \"\" && path !== \"/\") {\n    // If our path is non-empty and contains anything beyond an initial slash,\n    // then we have _some_ form of path in our regex, so we should expect to\n    // match only if we find the end of this path segment.  Look for an optional\n    // non-captured trailing slash (to match a portion of the URL) or the end\n    // of the path (if we've matched to the end).  We used to do this with a\n    // word boundary but that gives false positives on routes like\n    // /user-preferences since `-` counts as a word boundary.\n    regexpSource += \"(?:(?=\\\\/|$))\";\n  } else ;\n  let matcher = new RegExp(regexpSource, caseSensitive ? undefined : \"i\");\n  return [matcher, params];\n}\nfunction decodePath(value) {\n  try {\n    return value.split(\"/\").map(v => decodeURIComponent(v).replace(/\\//g, \"%2F\")).join(\"/\");\n  } catch (error) {\n    warning(false, \"The URL path \\\"\" + value + \"\\\" could not be decoded because it is is a \" + \"malformed URL segment. This is probably due to a bad percent \" + (\"encoding (\" + error + \").\"));\n    return value;\n  }\n}\n/**\n * @private\n */\nfunction stripBasename(pathname, basename) {\n  if (basename === \"/\") return pathname;\n  if (!pathname.toLowerCase().startsWith(basename.toLowerCase())) {\n    return null;\n  }\n  // We want to leave trailing slash behavior in the user's control, so if they\n  // specify a basename with a trailing slash, we should support it\n  let startIndex = basename.endsWith(\"/\") ? basename.length - 1 : basename.length;\n  let nextChar = pathname.charAt(startIndex);\n  if (nextChar && nextChar !== \"/\") {\n    // pathname does not start with basename/\n    return null;\n  }\n  return pathname.slice(startIndex) || \"/\";\n}\nconst ABSOLUTE_URL_REGEX$1 = /^(?:[a-z][a-z0-9+.-]*:|\\/\\/)/i;\nconst isAbsoluteUrl = url => ABSOLUTE_URL_REGEX$1.test(url);\n/**\n * Returns a resolved path object relative to the given pathname.\n *\n * @see https://reactrouter.com/v6/utils/resolve-path\n */\nfunction resolvePath(to, fromPathname) {\n  if (fromPathname === void 0) {\n    fromPathname = \"/\";\n  }\n  let {\n    pathname: toPathname,\n    search = \"\",\n    hash = \"\"\n  } = typeof to === \"string\" ? parsePath(to) : to;\n  let pathname;\n  if (toPathname) {\n    if (isAbsoluteUrl(toPathname)) {\n      pathname = toPathname;\n    } else {\n      if (toPathname.includes(\"//\")) {\n        let oldPathname = toPathname;\n        toPathname = toPathname.replace(/\\/\\/+/g, \"/\");\n        warning(false, \"Pathnames cannot have embedded double slashes - normalizing \" + (oldPathname + \" -> \" + toPathname));\n      }\n      if (toPathname.startsWith(\"/\")) {\n        pathname = resolvePathname(toPathname.substring(1), \"/\");\n      } else {\n        pathname = resolvePathname(toPathname, fromPathname);\n      }\n    }\n  } else {\n    pathname = fromPathname;\n  }\n  return {\n    pathname,\n    search: normalizeSearch(search),\n    hash: normalizeHash(hash)\n  };\n}\nfunction resolvePathname(relativePath, fromPathname) {\n  let segments = fromPathname.replace(/\\/+$/, \"\").split(\"/\");\n  let relativeSegments = relativePath.split(\"/\");\n  relativeSegments.forEach(segment => {\n    if (segment === \"..\") {\n      // Keep the root \"\" segment so the pathname starts at /\n      if (segments.length > 1) segments.pop();\n    } else if (segment !== \".\") {\n      segments.push(segment);\n    }\n  });\n  return segments.length > 1 ? segments.join(\"/\") : \"/\";\n}\nfunction getInvalidPathError(char, field, dest, path) {\n  return \"Cannot include a '\" + char + \"' character in a manually specified \" + (\"`to.\" + field + \"` field [\" + JSON.stringify(path) + \"].  Please separate it out to the \") + (\"`to.\" + dest + \"` field. Alternatively you may provide the full path as \") + \"a string in <Link to=\\\"...\\\"> and the router will parse it for you.\";\n}\n/**\n * @private\n *\n * When processing relative navigation we want to ignore ancestor routes that\n * do not contribute to the path, such that index/pathless layout routes don't\n * interfere.\n *\n * For example, when moving a route element into an index route and/or a\n * pathless layout route, relative link behavior contained within should stay\n * the same.  Both of the following examples should link back to the root:\n *\n *   <Route path=\"/\">\n *     <Route path=\"accounts\" element={<Link to=\"..\"}>\n *   </Route>\n *\n *   <Route path=\"/\">\n *     <Route path=\"accounts\">\n *       <Route element={<AccountsLayout />}>       // <-- Does not contribute\n *         <Route index element={<Link to=\"..\"} />  // <-- Does not contribute\n *       </Route\n *     </Route>\n *   </Route>\n */\nfunction getPathContributingMatches(matches) {\n  return matches.filter((match, index) => index === 0 || match.route.path && match.route.path.length > 0);\n}\n// Return the array of pathnames for the current route matches - used to\n// generate the routePathnames input for resolveTo()\nfunction getResolveToMatches(matches, v7_relativeSplatPath) {\n  let pathMatches = getPathContributingMatches(matches);\n  // When v7_relativeSplatPath is enabled, use the full pathname for the leaf\n  // match so we include splat values for \".\" links.  See:\n  // https://github.com/remix-run/react-router/issues/11052#issuecomment-1836589329\n  if (v7_relativeSplatPath) {\n    return pathMatches.map((match, idx) => idx === pathMatches.length - 1 ? match.pathname : match.pathnameBase);\n  }\n  return pathMatches.map(match => match.pathnameBase);\n}\n/**\n * @private\n */\nfunction resolveTo(toArg, routePathnames, locationPathname, isPathRelative) {\n  if (isPathRelative === void 0) {\n    isPathRelative = false;\n  }\n  let to;\n  if (typeof toArg === \"string\") {\n    to = parsePath(toArg);\n  } else {\n    to = _extends({}, toArg);\n    invariant(!to.pathname || !to.pathname.includes(\"?\"), getInvalidPathError(\"?\", \"pathname\", \"search\", to));\n    invariant(!to.pathname || !to.pathname.includes(\"#\"), getInvalidPathError(\"#\", \"pathname\", \"hash\", to));\n    invariant(!to.search || !to.search.includes(\"#\"), getInvalidPathError(\"#\", \"search\", \"hash\", to));\n  }\n  let isEmptyPath = toArg === \"\" || to.pathname === \"\";\n  let toPathname = isEmptyPath ? \"/\" : to.pathname;\n  let from;\n  // Routing is relative to the current pathname if explicitly requested.\n  //\n  // If a pathname is explicitly provided in `to`, it should be relative to the\n  // route context. This is explained in `Note on `<Link to>` values` in our\n  // migration guide from v5 as a means of disambiguation between `to` values\n  // that begin with `/` and those that do not. However, this is problematic for\n  // `to` values that do not provide a pathname. `to` can simply be a search or\n  // hash string, in which case we should assume that the navigation is relative\n  // to the current location's pathname and *not* the route pathname.\n  if (toPathname == null) {\n    from = locationPathname;\n  } else {\n    let routePathnameIndex = routePathnames.length - 1;\n    // With relative=\"route\" (the default), each leading .. segment means\n    // \"go up one route\" instead of \"go up one URL segment\".  This is a key\n    // difference from how <a href> works and a major reason we call this a\n    // \"to\" value instead of a \"href\".\n    if (!isPathRelative && toPathname.startsWith(\"..\")) {\n      let toSegments = toPathname.split(\"/\");\n      while (toSegments[0] === \"..\") {\n        toSegments.shift();\n        routePathnameIndex -= 1;\n      }\n      to.pathname = toSegments.join(\"/\");\n    }\n    from = routePathnameIndex >= 0 ? routePathnames[routePathnameIndex] : \"/\";\n  }\n  let path = resolvePath(to, from);\n  // Ensure the pathname has a trailing slash if the original \"to\" had one\n  let hasExplicitTrailingSlash = toPathname && toPathname !== \"/\" && toPathname.endsWith(\"/\");\n  // Or if this was a link to the current path which has a trailing slash\n  let hasCurrentTrailingSlash = (isEmptyPath || toPathname === \".\") && locationPathname.endsWith(\"/\");\n  if (!path.pathname.endsWith(\"/\") && (hasExplicitTrailingSlash || hasCurrentTrailingSlash)) {\n    path.pathname += \"/\";\n  }\n  return path;\n}\n/**\n * @private\n */\nfunction getToPathname(to) {\n  // Empty strings should be treated the same as / paths\n  return to === \"\" || to.pathname === \"\" ? \"/\" : typeof to === \"string\" ? parsePath(to).pathname : to.pathname;\n}\n/**\n * @private\n */\nconst joinPaths = paths => paths.join(\"/\").replace(/\\/\\/+/g, \"/\");\n/**\n * @private\n */\nconst normalizePathname = pathname => pathname.replace(/\\/+$/, \"\").replace(/^\\/*/, \"/\");\n/**\n * @private\n */\nconst normalizeSearch = search => !search || search === \"?\" ? \"\" : search.startsWith(\"?\") ? search : \"?\" + search;\n/**\n * @private\n */\nconst normalizeHash = hash => !hash || hash === \"#\" ? \"\" : hash.startsWith(\"#\") ? hash : \"#\" + hash;\n/**\n * This is a shortcut for creating `application/json` responses. Converts `data`\n * to JSON and sets the `Content-Type` header.\n *\n * @deprecated The `json` method is deprecated in favor of returning raw objects.\n * This method will be removed in v7.\n */\nconst json = function json(data, init) {\n  if (init === void 0) {\n    init = {};\n  }\n  let responseInit = typeof init === \"number\" ? {\n    status: init\n  } : init;\n  let headers = new Headers(responseInit.headers);\n  if (!headers.has(\"Content-Type\")) {\n    headers.set(\"Content-Type\", \"application/json; charset=utf-8\");\n  }\n  return new Response(JSON.stringify(data), _extends({}, responseInit, {\n    headers\n  }));\n};\nclass DataWithResponseInit {\n  constructor(data, init) {\n    this.type = \"DataWithResponseInit\";\n    this.data = data;\n    this.init = init || null;\n  }\n}\n/**\n * Create \"responses\" that contain `status`/`headers` without forcing\n * serialization into an actual `Response` - used by Remix single fetch\n */\nfunction data(data, init) {\n  return new DataWithResponseInit(data, typeof init === \"number\" ? {\n    status: init\n  } : init);\n}\nclass AbortedDeferredError extends Error {}\nclass DeferredData {\n  constructor(data, responseInit) {\n    this.pendingKeysSet = new Set();\n    this.subscribers = new Set();\n    this.deferredKeys = [];\n    invariant(data && typeof data === \"object\" && !Array.isArray(data), \"defer() only accepts plain objects\");\n    // Set up an AbortController + Promise we can race against to exit early\n    // cancellation\n    let reject;\n    this.abortPromise = new Promise((_, r) => reject = r);\n    this.controller = new AbortController();\n    let onAbort = () => reject(new AbortedDeferredError(\"Deferred data aborted\"));\n    this.unlistenAbortSignal = () => this.controller.signal.removeEventListener(\"abort\", onAbort);\n    this.controller.signal.addEventListener(\"abort\", onAbort);\n    this.data = Object.entries(data).reduce((acc, _ref2) => {\n      let [key, value] = _ref2;\n      return Object.assign(acc, {\n        [key]: this.trackPromise(key, value)\n      });\n    }, {});\n    if (this.done) {\n      // All incoming values were resolved\n      this.unlistenAbortSignal();\n    }\n    this.init = responseInit;\n  }\n  trackPromise(key, value) {\n    if (!(value instanceof Promise)) {\n      return value;\n    }\n    this.deferredKeys.push(key);\n    this.pendingKeysSet.add(key);\n    // We store a little wrapper promise that will be extended with\n    // _data/_error props upon resolve/reject\n    let promise = Promise.race([value, this.abortPromise]).then(data => this.onSettle(promise, key, undefined, data), error => this.onSettle(promise, key, error));\n    // Register rejection listeners to avoid uncaught promise rejections on\n    // errors or aborted deferred values\n    promise.catch(() => {});\n    Object.defineProperty(promise, \"_tracked\", {\n      get: () => true\n    });\n    return promise;\n  }\n  onSettle(promise, key, error, data) {\n    if (this.controller.signal.aborted && error instanceof AbortedDeferredError) {\n      this.unlistenAbortSignal();\n      Object.defineProperty(promise, \"_error\", {\n        get: () => error\n      });\n      return Promise.reject(error);\n    }\n    this.pendingKeysSet.delete(key);\n    if (this.done) {\n      // Nothing left to abort!\n      this.unlistenAbortSignal();\n    }\n    // If the promise was resolved/rejected with undefined, we'll throw an error as you\n    // should always resolve with a value or null\n    if (error === undefined && data === undefined) {\n      let undefinedError = new Error(\"Deferred data for key \\\"\" + key + \"\\\" resolved/rejected with `undefined`, \" + \"you must resolve/reject with a value or `null`.\");\n      Object.defineProperty(promise, \"_error\", {\n        get: () => undefinedError\n      });\n      this.emit(false, key);\n      return Promise.reject(undefinedError);\n    }\n    if (data === undefined) {\n      Object.defineProperty(promise, \"_error\", {\n        get: () => error\n      });\n      this.emit(false, key);\n      return Promise.reject(error);\n    }\n    Object.defineProperty(promise, \"_data\", {\n      get: () => data\n    });\n    this.emit(false, key);\n    return data;\n  }\n  emit(aborted, settledKey) {\n    this.subscribers.forEach(subscriber => subscriber(aborted, settledKey));\n  }\n  subscribe(fn) {\n    this.subscribers.add(fn);\n    return () => this.subscribers.delete(fn);\n  }\n  cancel() {\n    this.controller.abort();\n    this.pendingKeysSet.forEach((v, k) => this.pendingKeysSet.delete(k));\n    this.emit(true);\n  }\n  async resolveData(signal) {\n    let aborted = false;\n    if (!this.done) {\n      let onAbort = () => this.cancel();\n      signal.addEventListener(\"abort\", onAbort);\n      aborted = await new Promise(resolve => {\n        this.subscribe(aborted => {\n          signal.removeEventListener(\"abort\", onAbort);\n          if (aborted || this.done) {\n            resolve(aborted);\n          }\n        });\n      });\n    }\n    return aborted;\n  }\n  get done() {\n    return this.pendingKeysSet.size === 0;\n  }\n  get unwrappedData() {\n    invariant(this.data !== null && this.done, \"Can only unwrap data on initialized and settled deferreds\");\n    return Object.entries(this.data).reduce((acc, _ref3) => {\n      let [key, value] = _ref3;\n      return Object.assign(acc, {\n        [key]: unwrapTrackedPromise(value)\n      });\n    }, {});\n  }\n  get pendingKeys() {\n    return Array.from(this.pendingKeysSet);\n  }\n}\nfunction isTrackedPromise(value) {\n  return value instanceof Promise && value._tracked === true;\n}\nfunction unwrapTrackedPromise(value) {\n  if (!isTrackedPromise(value)) {\n    return value;\n  }\n  if (value._error) {\n    throw value._error;\n  }\n  return value._data;\n}\n/**\n * @deprecated The `defer` method is deprecated in favor of returning raw\n * objects. This method will be removed in v7.\n */\nconst defer = function defer(data, init) {\n  if (init === void 0) {\n    init = {};\n  }\n  let responseInit = typeof init === \"number\" ? {\n    status: init\n  } : init;\n  return new DeferredData(data, responseInit);\n};\n/**\n * A redirect response. Sets the status code and the `Location` header.\n * Defaults to \"302 Found\".\n */\nconst redirect = function redirect(url, init) {\n  if (init === void 0) {\n    init = 302;\n  }\n  let responseInit = init;\n  if (typeof responseInit === \"number\") {\n    responseInit = {\n      status: responseInit\n    };\n  } else if (typeof responseInit.status === \"undefined\") {\n    responseInit.status = 302;\n  }\n  let headers = new Headers(responseInit.headers);\n  headers.set(\"Location\", url);\n  return new Response(null, _extends({}, responseInit, {\n    headers\n  }));\n};\n/**\n * A redirect response that will force a document reload to the new location.\n * Sets the status code and the `Location` header.\n * Defaults to \"302 Found\".\n */\nconst redirectDocument = (url, init) => {\n  let response = redirect(url, init);\n  response.headers.set(\"X-Remix-Reload-Document\", \"true\");\n  return response;\n};\n/**\n * A redirect response that will perform a `history.replaceState` instead of a\n * `history.pushState` for client-side navigation redirects.\n * Sets the status code and the `Location` header.\n * Defaults to \"302 Found\".\n */\nconst replace = (url, init) => {\n  let response = redirect(url, init);\n  response.headers.set(\"X-Remix-Replace\", \"true\");\n  return response;\n};\n/**\n * @private\n * Utility class we use to hold auto-unwrapped 4xx/5xx Response bodies\n *\n * We don't export the class for public use since it's an implementation\n * detail, but we export the interface above so folks can build their own\n * abstractions around instances via isRouteErrorResponse()\n */\nclass ErrorResponseImpl {\n  constructor(status, statusText, data, internal) {\n    if (internal === void 0) {\n      internal = false;\n    }\n    this.status = status;\n    this.statusText = statusText || \"\";\n    this.internal = internal;\n    if (data instanceof Error) {\n      this.data = data.toString();\n      this.error = data;\n    } else {\n      this.data = data;\n    }\n  }\n}\n/**\n * Check if the given error is an ErrorResponse generated from a 4xx/5xx\n * Response thrown from an action/loader\n */\nfunction isRouteErrorResponse(error) {\n  return error != null && typeof error.status === \"number\" && typeof error.statusText === \"string\" && typeof error.internal === \"boolean\" && \"data\" in error;\n}\n\nconst validMutationMethodsArr = [\"post\", \"put\", \"patch\", \"delete\"];\nconst validMutationMethods = new Set(validMutationMethodsArr);\nconst validRequestMethodsArr = [\"get\", ...validMutationMethodsArr];\nconst validRequestMethods = new Set(validRequestMethodsArr);\nconst redirectStatusCodes = new Set([301, 302, 303, 307, 308]);\nconst redirectPreserveMethodStatusCodes = new Set([307, 308]);\nconst IDLE_NAVIGATION = {\n  state: \"idle\",\n  location: undefined,\n  formMethod: undefined,\n  formAction: undefined,\n  formEncType: undefined,\n  formData: undefined,\n  json: undefined,\n  text: undefined\n};\nconst IDLE_FETCHER = {\n  state: \"idle\",\n  data: undefined,\n  formMethod: undefined,\n  formAction: undefined,\n  formEncType: undefined,\n  formData: undefined,\n  json: undefined,\n  text: undefined\n};\nconst IDLE_BLOCKER = {\n  state: \"unblocked\",\n  proceed: undefined,\n  reset: undefined,\n  location: undefined\n};\nconst ABSOLUTE_URL_REGEX = /^(?:[a-z][a-z0-9+.-]*:|\\/\\/)/i;\nconst defaultMapRouteProperties = route => ({\n  hasErrorBoundary: Boolean(route.hasErrorBoundary)\n});\nconst TRANSITIONS_STORAGE_KEY = \"remix-router-transitions\";\n//#endregion\n////////////////////////////////////////////////////////////////////////////////\n//#region createRouter\n////////////////////////////////////////////////////////////////////////////////\n/**\n * Create a router and listen to history POP navigations\n */\nfunction createRouter(init) {\n  const routerWindow = init.window ? init.window : typeof window !== \"undefined\" ? window : undefined;\n  const isBrowser = typeof routerWindow !== \"undefined\" && typeof routerWindow.document !== \"undefined\" && typeof routerWindow.document.createElement !== \"undefined\";\n  const isServer = !isBrowser;\n  invariant(init.routes.length > 0, \"You must provide a non-empty routes array to createRouter\");\n  let mapRouteProperties;\n  if (init.mapRouteProperties) {\n    mapRouteProperties = init.mapRouteProperties;\n  } else if (init.detectErrorBoundary) {\n    // If they are still using the deprecated version, wrap it with the new API\n    let detectErrorBoundary = init.detectErrorBoundary;\n    mapRouteProperties = route => ({\n      hasErrorBoundary: detectErrorBoundary(route)\n    });\n  } else {\n    mapRouteProperties = defaultMapRouteProperties;\n  }\n  // Routes keyed by ID\n  let manifest = {};\n  // Routes in tree format for matching\n  let dataRoutes = convertRoutesToDataRoutes(init.routes, mapRouteProperties, undefined, manifest);\n  let inFlightDataRoutes;\n  let basename = init.basename || \"/\";\n  let dataStrategyImpl = init.dataStrategy || defaultDataStrategy;\n  let patchRoutesOnNavigationImpl = init.patchRoutesOnNavigation;\n  // Config driven behavior flags\n  let future = _extends({\n    v7_fetcherPersist: false,\n    v7_normalizeFormMethod: false,\n    v7_partialHydration: false,\n    v7_prependBasename: false,\n    v7_relativeSplatPath: false,\n    v7_skipActionErrorRevalidation: false\n  }, init.future);\n  // Cleanup function for history\n  let unlistenHistory = null;\n  // Externally-provided functions to call on all state changes\n  let subscribers = new Set();\n  // Externally-provided object to hold scroll restoration locations during routing\n  let savedScrollPositions = null;\n  // Externally-provided function to get scroll restoration keys\n  let getScrollRestorationKey = null;\n  // Externally-provided function to get current scroll position\n  let getScrollPosition = null;\n  // One-time flag to control the initial hydration scroll restoration.  Because\n  // we don't get the saved positions from <ScrollRestoration /> until _after_\n  // the initial render, we need to manually trigger a separate updateState to\n  // send along the restoreScrollPosition\n  // Set to true if we have `hydrationData` since we assume we were SSR'd and that\n  // SSR did the initial scroll restoration.\n  let initialScrollRestored = init.hydrationData != null;\n  let initialMatches = matchRoutes(dataRoutes, init.history.location, basename);\n  let initialMatchesIsFOW = false;\n  let initialErrors = null;\n  if (initialMatches == null && !patchRoutesOnNavigationImpl) {\n    // If we do not match a user-provided-route, fall back to the root\n    // to allow the error boundary to take over\n    let error = getInternalRouterError(404, {\n      pathname: init.history.location.pathname\n    });\n    let {\n      matches,\n      route\n    } = getShortCircuitMatches(dataRoutes);\n    initialMatches = matches;\n    initialErrors = {\n      [route.id]: error\n    };\n  }\n  // In SPA apps, if the user provided a patchRoutesOnNavigation implementation and\n  // our initial match is a splat route, clear them out so we run through lazy\n  // discovery on hydration in case there's a more accurate lazy route match.\n  // In SSR apps (with `hydrationData`), we expect that the server will send\n  // up the proper matched routes so we don't want to run lazy discovery on\n  // initial hydration and want to hydrate into the splat route.\n  if (initialMatches && !init.hydrationData) {\n    let fogOfWar = checkFogOfWar(initialMatches, dataRoutes, init.history.location.pathname);\n    if (fogOfWar.active) {\n      initialMatches = null;\n    }\n  }\n  let initialized;\n  if (!initialMatches) {\n    initialized = false;\n    initialMatches = [];\n    // If partial hydration and fog of war is enabled, we will be running\n    // `patchRoutesOnNavigation` during hydration so include any partial matches as\n    // the initial matches so we can properly render `HydrateFallback`'s\n    if (future.v7_partialHydration) {\n      let fogOfWar = checkFogOfWar(null, dataRoutes, init.history.location.pathname);\n      if (fogOfWar.active && fogOfWar.matches) {\n        initialMatchesIsFOW = true;\n        initialMatches = fogOfWar.matches;\n      }\n    }\n  } else if (initialMatches.some(m => m.route.lazy)) {\n    // All initialMatches need to be loaded before we're ready.  If we have lazy\n    // functions around still then we'll need to run them in initialize()\n    initialized = false;\n  } else if (!initialMatches.some(m => m.route.loader)) {\n    // If we've got no loaders to run, then we're good to go\n    initialized = true;\n  } else if (future.v7_partialHydration) {\n    // If partial hydration is enabled, we're initialized so long as we were\n    // provided with hydrationData for every route with a loader, and no loaders\n    // were marked for explicit hydration\n    let loaderData = init.hydrationData ? init.hydrationData.loaderData : null;\n    let errors = init.hydrationData ? init.hydrationData.errors : null;\n    // If errors exist, don't consider routes below the boundary\n    if (errors) {\n      let idx = initialMatches.findIndex(m => errors[m.route.id] !== undefined);\n      initialized = initialMatches.slice(0, idx + 1).every(m => !shouldLoadRouteOnHydration(m.route, loaderData, errors));\n    } else {\n      initialized = initialMatches.every(m => !shouldLoadRouteOnHydration(m.route, loaderData, errors));\n    }\n  } else {\n    // Without partial hydration - we're initialized if we were provided any\n    // hydrationData - which is expected to be complete\n    initialized = init.hydrationData != null;\n  }\n  let router;\n  let state = {\n    historyAction: init.history.action,\n    location: init.history.location,\n    matches: initialMatches,\n    initialized,\n    navigation: IDLE_NAVIGATION,\n    // Don't restore on initial updateState() if we were SSR'd\n    restoreScrollPosition: init.hydrationData != null ? false : null,\n    preventScrollReset: false,\n    revalidation: \"idle\",\n    loaderData: init.hydrationData && init.hydrationData.loaderData || {},\n    actionData: init.hydrationData && init.hydrationData.actionData || null,\n    errors: init.hydrationData && init.hydrationData.errors || initialErrors,\n    fetchers: new Map(),\n    blockers: new Map()\n  };\n  // -- Stateful internal variables to manage navigations --\n  // Current navigation in progress (to be committed in completeNavigation)\n  let pendingAction = Action.Pop;\n  // Should the current navigation prevent the scroll reset if scroll cannot\n  // be restored?\n  let pendingPreventScrollReset = false;\n  // AbortController for the active navigation\n  let pendingNavigationController;\n  // Should the current navigation enable document.startViewTransition?\n  let pendingViewTransitionEnabled = false;\n  // Store applied view transitions so we can apply them on POP\n  let appliedViewTransitions = new Map();\n  // Cleanup function for persisting applied transitions to sessionStorage\n  let removePageHideEventListener = null;\n  // We use this to avoid touching history in completeNavigation if a\n  // revalidation is entirely uninterrupted\n  let isUninterruptedRevalidation = false;\n  // Use this internal flag to force revalidation of all loaders:\n  //  - submissions (completed or interrupted)\n  //  - useRevalidator()\n  //  - X-Remix-Revalidate (from redirect)\n  let isRevalidationRequired = false;\n  // Use this internal array to capture routes that require revalidation due\n  // to a cancelled deferred on action submission\n  let cancelledDeferredRoutes = [];\n  // Use this internal array to capture fetcher loads that were cancelled by an\n  // action navigation and require revalidation\n  let cancelledFetcherLoads = new Set();\n  // AbortControllers for any in-flight fetchers\n  let fetchControllers = new Map();\n  // Track loads based on the order in which they started\n  let incrementingLoadId = 0;\n  // Track the outstanding pending navigation data load to be compared against\n  // the globally incrementing load when a fetcher load lands after a completed\n  // navigation\n  let pendingNavigationLoadId = -1;\n  // Fetchers that triggered data reloads as a result of their actions\n  let fetchReloadIds = new Map();\n  // Fetchers that triggered redirect navigations\n  let fetchRedirectIds = new Set();\n  // Most recent href/match for fetcher.load calls for fetchers\n  let fetchLoadMatches = new Map();\n  // Ref-count mounted fetchers so we know when it's ok to clean them up\n  let activeFetchers = new Map();\n  // Fetchers that have requested a delete when using v7_fetcherPersist,\n  // they'll be officially removed after they return to idle\n  let deletedFetchers = new Set();\n  // Store DeferredData instances for active route matches.  When a\n  // route loader returns defer() we stick one in here.  Then, when a nested\n  // promise resolves we update loaderData.  If a new navigation starts we\n  // cancel active deferreds for eliminated routes.\n  let activeDeferreds = new Map();\n  // Store blocker functions in a separate Map outside of router state since\n  // we don't need to update UI state if they change\n  let blockerFunctions = new Map();\n  // Flag to ignore the next history update, so we can revert the URL change on\n  // a POP navigation that was blocked by the user without touching router state\n  let unblockBlockerHistoryUpdate = undefined;\n  // Initialize the router, all side effects should be kicked off from here.\n  // Implemented as a Fluent API for ease of:\n  //   let router = createRouter(init).initialize();\n  function initialize() {\n    // If history informs us of a POP navigation, start the navigation but do not update\n    // state.  We'll update our own state once the navigation completes\n    unlistenHistory = init.history.listen(_ref => {\n      let {\n        action: historyAction,\n        location,\n        delta\n      } = _ref;\n      // Ignore this event if it was just us resetting the URL from a\n      // blocked POP navigation\n      if (unblockBlockerHistoryUpdate) {\n        unblockBlockerHistoryUpdate();\n        unblockBlockerHistoryUpdate = undefined;\n        return;\n      }\n      warning(blockerFunctions.size === 0 || delta != null, \"You are trying to use a blocker on a POP navigation to a location \" + \"that was not created by @remix-run/router. This will fail silently in \" + \"production. This can happen if you are navigating outside the router \" + \"via `window.history.pushState`/`window.location.hash` instead of using \" + \"router navigation APIs.  This can also happen if you are using \" + \"createHashRouter and the user manually changes the URL.\");\n      let blockerKey = shouldBlockNavigation({\n        currentLocation: state.location,\n        nextLocation: location,\n        historyAction\n      });\n      if (blockerKey && delta != null) {\n        // Restore the URL to match the current UI, but don't update router state\n        let nextHistoryUpdatePromise = new Promise(resolve => {\n          unblockBlockerHistoryUpdate = resolve;\n        });\n        init.history.go(delta * -1);\n        // Put the blocker into a blocked state\n        updateBlocker(blockerKey, {\n          state: \"blocked\",\n          location,\n          proceed() {\n            updateBlocker(blockerKey, {\n              state: \"proceeding\",\n              proceed: undefined,\n              reset: undefined,\n              location\n            });\n            // Re-do the same POP navigation we just blocked, after the url\n            // restoration is also complete.  See:\n            // https://github.com/remix-run/react-router/issues/11613\n            nextHistoryUpdatePromise.then(() => init.history.go(delta));\n          },\n          reset() {\n            let blockers = new Map(state.blockers);\n            blockers.set(blockerKey, IDLE_BLOCKER);\n            updateState({\n              blockers\n            });\n          }\n        });\n        return;\n      }\n      return startNavigation(historyAction, location);\n    });\n    if (isBrowser) {\n      // FIXME: This feels gross.  How can we cleanup the lines between\n      // scrollRestoration/appliedTransitions persistance?\n      restoreAppliedTransitions(routerWindow, appliedViewTransitions);\n      let _saveAppliedTransitions = () => persistAppliedTransitions(routerWindow, appliedViewTransitions);\n      routerWindow.addEventListener(\"pagehide\", _saveAppliedTransitions);\n      removePageHideEventListener = () => routerWindow.removeEventListener(\"pagehide\", _saveAppliedTransitions);\n    }\n    // Kick off initial data load if needed.  Use Pop to avoid modifying history\n    // Note we don't do any handling of lazy here.  For SPA's it'll get handled\n    // in the normal navigation flow.  For SSR it's expected that lazy modules are\n    // resolved prior to router creation since we can't go into a fallbackElement\n    // UI for SSR'd apps\n    if (!state.initialized) {\n      startNavigation(Action.Pop, state.location, {\n        initialHydration: true\n      });\n    }\n    return router;\n  }\n  // Clean up a router and it's side effects\n  function dispose() {\n    if (unlistenHistory) {\n      unlistenHistory();\n    }\n    if (removePageHideEventListener) {\n      removePageHideEventListener();\n    }\n    subscribers.clear();\n    pendingNavigationController && pendingNavigationController.abort();\n    state.fetchers.forEach((_, key) => deleteFetcher(key));\n    state.blockers.forEach((_, key) => deleteBlocker(key));\n  }\n  // Subscribe to state updates for the router\n  function subscribe(fn) {\n    subscribers.add(fn);\n    return () => subscribers.delete(fn);\n  }\n  // Update our state and notify the calling context of the change\n  function updateState(newState, opts) {\n    if (opts === void 0) {\n      opts = {};\n    }\n    state = _extends({}, state, newState);\n    // Prep fetcher cleanup so we can tell the UI which fetcher data entries\n    // can be removed\n    let completedFetchers = [];\n    let deletedFetchersKeys = [];\n    if (future.v7_fetcherPersist) {\n      state.fetchers.forEach((fetcher, key) => {\n        if (fetcher.state === \"idle\") {\n          if (deletedFetchers.has(key)) {\n            // Unmounted from the UI and can be totally removed\n            deletedFetchersKeys.push(key);\n          } else {\n            // Returned to idle but still mounted in the UI, so semi-remains for\n            // revalidations and such\n            completedFetchers.push(key);\n          }\n        }\n      });\n    }\n    // Remove any lingering deleted fetchers that have already been removed\n    // from state.fetchers\n    deletedFetchers.forEach(key => {\n      if (!state.fetchers.has(key) && !fetchControllers.has(key)) {\n        deletedFetchersKeys.push(key);\n      }\n    });\n    // Iterate over a local copy so that if flushSync is used and we end up\n    // removing and adding a new subscriber due to the useCallback dependencies,\n    // we don't get ourselves into a loop calling the new subscriber immediately\n    [...subscribers].forEach(subscriber => subscriber(state, {\n      deletedFetchers: deletedFetchersKeys,\n      viewTransitionOpts: opts.viewTransitionOpts,\n      flushSync: opts.flushSync === true\n    }));\n    // Remove idle fetchers from state since we only care about in-flight fetchers.\n    if (future.v7_fetcherPersist) {\n      completedFetchers.forEach(key => state.fetchers.delete(key));\n      deletedFetchersKeys.forEach(key => deleteFetcher(key));\n    } else {\n      // We already called deleteFetcher() on these, can remove them from this\n      // Set now that we've handed the keys off to the data layer\n      deletedFetchersKeys.forEach(key => deletedFetchers.delete(key));\n    }\n  }\n  // Complete a navigation returning the state.navigation back to the IDLE_NAVIGATION\n  // and setting state.[historyAction/location/matches] to the new route.\n  // - Location is a required param\n  // - Navigation will always be set to IDLE_NAVIGATION\n  // - Can pass any other state in newState\n  function completeNavigation(location, newState, _temp) {\n    var _location$state, _location$state2;\n    let {\n      flushSync\n    } = _temp === void 0 ? {} : _temp;\n    // Deduce if we're in a loading/actionReload state:\n    // - We have committed actionData in the store\n    // - The current navigation was a mutation submission\n    // - We're past the submitting state and into the loading state\n    // - The location being loaded is not the result of a redirect\n    let isActionReload = state.actionData != null && state.navigation.formMethod != null && isMutationMethod(state.navigation.formMethod) && state.navigation.state === \"loading\" && ((_location$state = location.state) == null ? void 0 : _location$state._isRedirect) !== true;\n    let actionData;\n    if (newState.actionData) {\n      if (Object.keys(newState.actionData).length > 0) {\n        actionData = newState.actionData;\n      } else {\n        // Empty actionData -> clear prior actionData due to an action error\n        actionData = null;\n      }\n    } else if (isActionReload) {\n      // Keep the current data if we're wrapping up the action reload\n      actionData = state.actionData;\n    } else {\n      // Clear actionData on any other completed navigations\n      actionData = null;\n    }\n    // Always preserve any existing loaderData from re-used routes\n    let loaderData = newState.loaderData ? mergeLoaderData(state.loaderData, newState.loaderData, newState.matches || [], newState.errors) : state.loaderData;\n    // On a successful navigation we can assume we got through all blockers\n    // so we can start fresh\n    let blockers = state.blockers;\n    if (blockers.size > 0) {\n      blockers = new Map(blockers);\n      blockers.forEach((_, k) => blockers.set(k, IDLE_BLOCKER));\n    }\n    // Always respect the user flag.  Otherwise don't reset on mutation\n    // submission navigations unless they redirect\n    let preventScrollReset = pendingPreventScrollReset === true || state.navigation.formMethod != null && isMutationMethod(state.navigation.formMethod) && ((_location$state2 = location.state) == null ? void 0 : _location$state2._isRedirect) !== true;\n    // Commit any in-flight routes at the end of the HMR revalidation \"navigation\"\n    if (inFlightDataRoutes) {\n      dataRoutes = inFlightDataRoutes;\n      inFlightDataRoutes = undefined;\n    }\n    if (isUninterruptedRevalidation) ; else if (pendingAction === Action.Pop) ; else if (pendingAction === Action.Push) {\n      init.history.push(location, location.state);\n    } else if (pendingAction === Action.Replace) {\n      init.history.replace(location, location.state);\n    }\n    let viewTransitionOpts;\n    // On POP, enable transitions if they were enabled on the original navigation\n    if (pendingAction === Action.Pop) {\n      // Forward takes precedence so they behave like the original navigation\n      let priorPaths = appliedViewTransitions.get(state.location.pathname);\n      if (priorPaths && priorPaths.has(location.pathname)) {\n        viewTransitionOpts = {\n          currentLocation: state.location,\n          nextLocation: location\n        };\n      } else if (appliedViewTransitions.has(location.pathname)) {\n        // If we don't have a previous forward nav, assume we're popping back to\n        // the new location and enable if that location previously enabled\n        viewTransitionOpts = {\n          currentLocation: location,\n          nextLocation: state.location\n        };\n      }\n    } else if (pendingViewTransitionEnabled) {\n      // Store the applied transition on PUSH/REPLACE\n      let toPaths = appliedViewTransitions.get(state.location.pathname);\n      if (toPaths) {\n        toPaths.add(location.pathname);\n      } else {\n        toPaths = new Set([location.pathname]);\n        appliedViewTransitions.set(state.location.pathname, toPaths);\n      }\n      viewTransitionOpts = {\n        currentLocation: state.location,\n        nextLocation: location\n      };\n    }\n    updateState(_extends({}, newState, {\n      actionData,\n      loaderData,\n      historyAction: pendingAction,\n      location,\n      initialized: true,\n      navigation: IDLE_NAVIGATION,\n      revalidation: \"idle\",\n      restoreScrollPosition: getSavedScrollPosition(location, newState.matches || state.matches),\n      preventScrollReset,\n      blockers\n    }), {\n      viewTransitionOpts,\n      flushSync: flushSync === true\n    });\n    // Reset stateful navigation vars\n    pendingAction = Action.Pop;\n    pendingPreventScrollReset = false;\n    pendingViewTransitionEnabled = false;\n    isUninterruptedRevalidation = false;\n    isRevalidationRequired = false;\n    cancelledDeferredRoutes = [];\n  }\n  // Trigger a navigation event, which can either be a numerical POP or a PUSH\n  // replace with an optional submission\n  async function navigate(to, opts) {\n    if (typeof to === \"number\") {\n      init.history.go(to);\n      return;\n    }\n    let normalizedPath = normalizeTo(state.location, state.matches, basename, future.v7_prependBasename, to, future.v7_relativeSplatPath, opts == null ? void 0 : opts.fromRouteId, opts == null ? void 0 : opts.relative);\n    let {\n      path,\n      submission,\n      error\n    } = normalizeNavigateOptions(future.v7_normalizeFormMethod, false, normalizedPath, opts);\n    let currentLocation = state.location;\n    let nextLocation = createLocation(state.location, path, opts && opts.state);\n    // When using navigate as a PUSH/REPLACE we aren't reading an already-encoded\n    // URL from window.location, so we need to encode it here so the behavior\n    // remains the same as POP and non-data-router usages.  new URL() does all\n    // the same encoding we'd get from a history.pushState/window.location read\n    // without having to touch history\n    nextLocation = _extends({}, nextLocation, init.history.encodeLocation(nextLocation));\n    let userReplace = opts && opts.replace != null ? opts.replace : undefined;\n    let historyAction = Action.Push;\n    if (userReplace === true) {\n      historyAction = Action.Replace;\n    } else if (userReplace === false) ; else if (submission != null && isMutationMethod(submission.formMethod) && submission.formAction === state.location.pathname + state.location.search) {\n      // By default on submissions to the current location we REPLACE so that\n      // users don't have to double-click the back button to get to the prior\n      // location.  If the user redirects to a different location from the\n      // action/loader this will be ignored and the redirect will be a PUSH\n      historyAction = Action.Replace;\n    }\n    let preventScrollReset = opts && \"preventScrollReset\" in opts ? opts.preventScrollReset === true : undefined;\n    let flushSync = (opts && opts.flushSync) === true;\n    let blockerKey = shouldBlockNavigation({\n      currentLocation,\n      nextLocation,\n      historyAction\n    });\n    if (blockerKey) {\n      // Put the blocker into a blocked state\n      updateBlocker(blockerKey, {\n        state: \"blocked\",\n        location: nextLocation,\n        proceed() {\n          updateBlocker(blockerKey, {\n            state: \"proceeding\",\n            proceed: undefined,\n            reset: undefined,\n            location: nextLocation\n          });\n          // Send the same navigation through\n          navigate(to, opts);\n        },\n        reset() {\n          let blockers = new Map(state.blockers);\n          blockers.set(blockerKey, IDLE_BLOCKER);\n          updateState({\n            blockers\n          });\n        }\n      });\n      return;\n    }\n    return await startNavigation(historyAction, nextLocation, {\n      submission,\n      // Send through the formData serialization error if we have one so we can\n      // render at the right error boundary after we match routes\n      pendingError: error,\n      preventScrollReset,\n      replace: opts && opts.replace,\n      enableViewTransition: opts && opts.viewTransition,\n      flushSync\n    });\n  }\n  // Revalidate all current loaders.  If a navigation is in progress or if this\n  // is interrupted by a navigation, allow this to \"succeed\" by calling all\n  // loaders during the next loader round\n  function revalidate() {\n    interruptActiveLoads();\n    updateState({\n      revalidation: \"loading\"\n    });\n    // If we're currently submitting an action, we don't need to start a new\n    // navigation, we'll just let the follow up loader execution call all loaders\n    if (state.navigation.state === \"submitting\") {\n      return;\n    }\n    // If we're currently in an idle state, start a new navigation for the current\n    // action/location and mark it as uninterrupted, which will skip the history\n    // update in completeNavigation\n    if (state.navigation.state === \"idle\") {\n      startNavigation(state.historyAction, state.location, {\n        startUninterruptedRevalidation: true\n      });\n      return;\n    }\n    // Otherwise, if we're currently in a loading state, just start a new\n    // navigation to the navigation.location but do not trigger an uninterrupted\n    // revalidation so that history correctly updates once the navigation completes\n    startNavigation(pendingAction || state.historyAction, state.navigation.location, {\n      overrideNavigation: state.navigation,\n      // Proxy through any rending view transition\n      enableViewTransition: pendingViewTransitionEnabled === true\n    });\n  }\n  // Start a navigation to the given action/location.  Can optionally provide a\n  // overrideNavigation which will override the normalLoad in the case of a redirect\n  // navigation\n  async function startNavigation(historyAction, location, opts) {\n    // Abort any in-progress navigations and start a new one. Unset any ongoing\n    // uninterrupted revalidations unless told otherwise, since we want this\n    // new navigation to update history normally\n    pendingNavigationController && pendingNavigationController.abort();\n    pendingNavigationController = null;\n    pendingAction = historyAction;\n    isUninterruptedRevalidation = (opts && opts.startUninterruptedRevalidation) === true;\n    // Save the current scroll position every time we start a new navigation,\n    // and track whether we should reset scroll on completion\n    saveScrollPosition(state.location, state.matches);\n    pendingPreventScrollReset = (opts && opts.preventScrollReset) === true;\n    pendingViewTransitionEnabled = (opts && opts.enableViewTransition) === true;\n    let routesToUse = inFlightDataRoutes || dataRoutes;\n    let loadingNavigation = opts && opts.overrideNavigation;\n    let matches = opts != null && opts.initialHydration && state.matches && state.matches.length > 0 && !initialMatchesIsFOW ?\n    // `matchRoutes()` has already been called if we're in here via `router.initialize()`\n    state.matches : matchRoutes(routesToUse, location, basename);\n    let flushSync = (opts && opts.flushSync) === true;\n    // Short circuit if it's only a hash change and not a revalidation or\n    // mutation submission.\n    //\n    // Ignore on initial page loads because since the initial hydration will always\n    // be \"same hash\".  For example, on /page#hash and submit a <Form method=\"post\">\n    // which will default to a navigation to /page\n    if (matches && state.initialized && !isRevalidationRequired && isHashChangeOnly(state.location, location) && !(opts && opts.submission && isMutationMethod(opts.submission.formMethod))) {\n      completeNavigation(location, {\n        matches\n      }, {\n        flushSync\n      });\n      return;\n    }\n    let fogOfWar = checkFogOfWar(matches, routesToUse, location.pathname);\n    if (fogOfWar.active && fogOfWar.matches) {\n      matches = fogOfWar.matches;\n    }\n    // Short circuit with a 404 on the root error boundary if we match nothing\n    if (!matches) {\n      let {\n        error,\n        notFoundMatches,\n        route\n      } = handleNavigational404(location.pathname);\n      completeNavigation(location, {\n        matches: notFoundMatches,\n        loaderData: {},\n        errors: {\n          [route.id]: error\n        }\n      }, {\n        flushSync\n      });\n      return;\n    }\n    // Create a controller/Request for this navigation\n    pendingNavigationController = new AbortController();\n    let request = createClientSideRequest(init.history, location, pendingNavigationController.signal, opts && opts.submission);\n    let pendingActionResult;\n    if (opts && opts.pendingError) {\n      // If we have a pendingError, it means the user attempted a GET submission\n      // with binary FormData so assign here and skip to handleLoaders.  That\n      // way we handle calling loaders above the boundary etc.  It's not really\n      // different from an actionError in that sense.\n      pendingActionResult = [findNearestBoundary(matches).route.id, {\n        type: ResultType.error,\n        error: opts.pendingError\n      }];\n    } else if (opts && opts.submission && isMutationMethod(opts.submission.formMethod)) {\n      // Call action if we received an action submission\n      let actionResult = await handleAction(request, location, opts.submission, matches, fogOfWar.active, {\n        replace: opts.replace,\n        flushSync\n      });\n      if (actionResult.shortCircuited) {\n        return;\n      }\n      // If we received a 404 from handleAction, it's because we couldn't lazily\n      // discover the destination route so we don't want to call loaders\n      if (actionResult.pendingActionResult) {\n        let [routeId, result] = actionResult.pendingActionResult;\n        if (isErrorResult(result) && isRouteErrorResponse(result.error) && result.error.status === 404) {\n          pendingNavigationController = null;\n          completeNavigation(location, {\n            matches: actionResult.matches,\n            loaderData: {},\n            errors: {\n              [routeId]: result.error\n            }\n          });\n          return;\n        }\n      }\n      matches = actionResult.matches || matches;\n      pendingActionResult = actionResult.pendingActionResult;\n      loadingNavigation = getLoadingNavigation(location, opts.submission);\n      flushSync = false;\n      // No need to do fog of war matching again on loader execution\n      fogOfWar.active = false;\n      // Create a GET request for the loaders\n      request = createClientSideRequest(init.history, request.url, request.signal);\n    }\n    // Call loaders\n    let {\n      shortCircuited,\n      matches: updatedMatches,\n      loaderData,\n      errors\n    } = await handleLoaders(request, location, matches, fogOfWar.active, loadingNavigation, opts && opts.submission, opts && opts.fetcherSubmission, opts && opts.replace, opts && opts.initialHydration === true, flushSync, pendingActionResult);\n    if (shortCircuited) {\n      return;\n    }\n    // Clean up now that the action/loaders have completed.  Don't clean up if\n    // we short circuited because pendingNavigationController will have already\n    // been assigned to a new controller for the next navigation\n    pendingNavigationController = null;\n    completeNavigation(location, _extends({\n      matches: updatedMatches || matches\n    }, getActionDataForCommit(pendingActionResult), {\n      loaderData,\n      errors\n    }));\n  }\n  // Call the action matched by the leaf route for this navigation and handle\n  // redirects/errors\n  async function handleAction(request, location, submission, matches, isFogOfWar, opts) {\n    if (opts === void 0) {\n      opts = {};\n    }\n    interruptActiveLoads();\n    // Put us in a submitting state\n    let navigation = getSubmittingNavigation(location, submission);\n    updateState({\n      navigation\n    }, {\n      flushSync: opts.flushSync === true\n    });\n    if (isFogOfWar) {\n      let discoverResult = await discoverRoutes(matches, location.pathname, request.signal);\n      if (discoverResult.type === \"aborted\") {\n        return {\n          shortCircuited: true\n        };\n      } else if (discoverResult.type === \"error\") {\n        let boundaryId = findNearestBoundary(discoverResult.partialMatches).route.id;\n        return {\n          matches: discoverResult.partialMatches,\n          pendingActionResult: [boundaryId, {\n            type: ResultType.error,\n            error: discoverResult.error\n          }]\n        };\n      } else if (!discoverResult.matches) {\n        let {\n          notFoundMatches,\n          error,\n          route\n        } = handleNavigational404(location.pathname);\n        return {\n          matches: notFoundMatches,\n          pendingActionResult: [route.id, {\n            type: ResultType.error,\n            error\n          }]\n        };\n      } else {\n        matches = discoverResult.matches;\n      }\n    }\n    // Call our action and get the result\n    let result;\n    let actionMatch = getTargetMatch(matches, location);\n    if (!actionMatch.route.action && !actionMatch.route.lazy) {\n      result = {\n        type: ResultType.error,\n        error: getInternalRouterError(405, {\n          method: request.method,\n          pathname: location.pathname,\n          routeId: actionMatch.route.id\n        })\n      };\n    } else {\n      let results = await callDataStrategy(\"action\", state, request, [actionMatch], matches, null);\n      result = results[actionMatch.route.id];\n      if (request.signal.aborted) {\n        return {\n          shortCircuited: true\n        };\n      }\n    }\n    if (isRedirectResult(result)) {\n      let replace;\n      if (opts && opts.replace != null) {\n        replace = opts.replace;\n      } else {\n        // If the user didn't explicity indicate replace behavior, replace if\n        // we redirected to the exact same location we're currently at to avoid\n        // double back-buttons\n        let location = normalizeRedirectLocation(result.response.headers.get(\"Location\"), new URL(request.url), basename, init.history);\n        replace = location === state.location.pathname + state.location.search;\n      }\n      await startRedirectNavigation(request, result, true, {\n        submission,\n        replace\n      });\n      return {\n        shortCircuited: true\n      };\n    }\n    if (isDeferredResult(result)) {\n      throw getInternalRouterError(400, {\n        type: \"defer-action\"\n      });\n    }\n    if (isErrorResult(result)) {\n      // Store off the pending error - we use it to determine which loaders\n      // to call and will commit it when we complete the navigation\n      let boundaryMatch = findNearestBoundary(matches, actionMatch.route.id);\n      // By default, all submissions to the current location are REPLACE\n      // navigations, but if the action threw an error that'll be rendered in\n      // an errorElement, we fall back to PUSH so that the user can use the\n      // back button to get back to the pre-submission form location to try\n      // again\n      if ((opts && opts.replace) !== true) {\n        pendingAction = Action.Push;\n      }\n      return {\n        matches,\n        pendingActionResult: [boundaryMatch.route.id, result]\n      };\n    }\n    return {\n      matches,\n      pendingActionResult: [actionMatch.route.id, result]\n    };\n  }\n  // Call all applicable loaders for the given matches, handling redirects,\n  // errors, etc.\n  async function handleLoaders(request, location, matches, isFogOfWar, overrideNavigation, submission, fetcherSubmission, replace, initialHydration, flushSync, pendingActionResult) {\n    // Figure out the right navigation we want to use for data loading\n    let loadingNavigation = overrideNavigation || getLoadingNavigation(location, submission);\n    // If this was a redirect from an action we don't have a \"submission\" but\n    // we have it on the loading navigation so use that if available\n    let activeSubmission = submission || fetcherSubmission || getSubmissionFromNavigation(loadingNavigation);\n    // If this is an uninterrupted revalidation, we remain in our current idle\n    // state.  If not, we need to switch to our loading state and load data,\n    // preserving any new action data or existing action data (in the case of\n    // a revalidation interrupting an actionReload)\n    // If we have partialHydration enabled, then don't update the state for the\n    // initial data load since it's not a \"navigation\"\n    let shouldUpdateNavigationState = !isUninterruptedRevalidation && (!future.v7_partialHydration || !initialHydration);\n    // When fog of war is enabled, we enter our `loading` state earlier so we\n    // can discover new routes during the `loading` state.  We skip this if\n    // we've already run actions since we would have done our matching already.\n    // If the children() function threw then, we want to proceed with the\n    // partial matches it discovered.\n    if (isFogOfWar) {\n      if (shouldUpdateNavigationState) {\n        let actionData = getUpdatedActionData(pendingActionResult);\n        updateState(_extends({\n          navigation: loadingNavigation\n        }, actionData !== undefined ? {\n          actionData\n        } : {}), {\n          flushSync\n        });\n      }\n      let discoverResult = await discoverRoutes(matches, location.pathname, request.signal);\n      if (discoverResult.type === \"aborted\") {\n        return {\n          shortCircuited: true\n        };\n      } else if (discoverResult.type === \"error\") {\n        let boundaryId = findNearestBoundary(discoverResult.partialMatches).route.id;\n        return {\n          matches: discoverResult.partialMatches,\n          loaderData: {},\n          errors: {\n            [boundaryId]: discoverResult.error\n          }\n        };\n      } else if (!discoverResult.matches) {\n        let {\n          error,\n          notFoundMatches,\n          route\n        } = handleNavigational404(location.pathname);\n        return {\n          matches: notFoundMatches,\n          loaderData: {},\n          errors: {\n            [route.id]: error\n          }\n        };\n      } else {\n        matches = discoverResult.matches;\n      }\n    }\n    let routesToUse = inFlightDataRoutes || dataRoutes;\n    let [matchesToLoad, revalidatingFetchers] = getMatchesToLoad(init.history, state, matches, activeSubmission, location, future.v7_partialHydration && initialHydration === true, future.v7_skipActionErrorRevalidation, isRevalidationRequired, cancelledDeferredRoutes, cancelledFetcherLoads, deletedFetchers, fetchLoadMatches, fetchRedirectIds, routesToUse, basename, pendingActionResult);\n    // Cancel pending deferreds for no-longer-matched routes or routes we're\n    // about to reload.  Note that if this is an action reload we would have\n    // already cancelled all pending deferreds so this would be a no-op\n    cancelActiveDeferreds(routeId => !(matches && matches.some(m => m.route.id === routeId)) || matchesToLoad && matchesToLoad.some(m => m.route.id === routeId));\n    pendingNavigationLoadId = ++incrementingLoadId;\n    // Short circuit if we have no loaders to run\n    if (matchesToLoad.length === 0 && revalidatingFetchers.length === 0) {\n      let updatedFetchers = markFetchRedirectsDone();\n      completeNavigation(location, _extends({\n        matches,\n        loaderData: {},\n        // Commit pending error if we're short circuiting\n        errors: pendingActionResult && isErrorResult(pendingActionResult[1]) ? {\n          [pendingActionResult[0]]: pendingActionResult[1].error\n        } : null\n      }, getActionDataForCommit(pendingActionResult), updatedFetchers ? {\n        fetchers: new Map(state.fetchers)\n      } : {}), {\n        flushSync\n      });\n      return {\n        shortCircuited: true\n      };\n    }\n    if (shouldUpdateNavigationState) {\n      let updates = {};\n      if (!isFogOfWar) {\n        // Only update navigation/actionNData if we didn't already do it above\n        updates.navigation = loadingNavigation;\n        let actionData = getUpdatedActionData(pendingActionResult);\n        if (actionData !== undefined) {\n          updates.actionData = actionData;\n        }\n      }\n      if (revalidatingFetchers.length > 0) {\n        updates.fetchers = getUpdatedRevalidatingFetchers(revalidatingFetchers);\n      }\n      updateState(updates, {\n        flushSync\n      });\n    }\n    revalidatingFetchers.forEach(rf => {\n      abortFetcher(rf.key);\n      if (rf.controller) {\n        // Fetchers use an independent AbortController so that aborting a fetcher\n        // (via deleteFetcher) does not abort the triggering navigation that\n        // triggered the revalidation\n        fetchControllers.set(rf.key, rf.controller);\n      }\n    });\n    // Proxy navigation abort through to revalidation fetchers\n    let abortPendingFetchRevalidations = () => revalidatingFetchers.forEach(f => abortFetcher(f.key));\n    if (pendingNavigationController) {\n      pendingNavigationController.signal.addEventListener(\"abort\", abortPendingFetchRevalidations);\n    }\n    let {\n      loaderResults,\n      fetcherResults\n    } = await callLoadersAndMaybeResolveData(state, matches, matchesToLoad, revalidatingFetchers, request);\n    if (request.signal.aborted) {\n      return {\n        shortCircuited: true\n      };\n    }\n    // Clean up _after_ loaders have completed.  Don't clean up if we short\n    // circuited because fetchControllers would have been aborted and\n    // reassigned to new controllers for the next navigation\n    if (pendingNavigationController) {\n      pendingNavigationController.signal.removeEventListener(\"abort\", abortPendingFetchRevalidations);\n    }\n    revalidatingFetchers.forEach(rf => fetchControllers.delete(rf.key));\n    // If any loaders returned a redirect Response, start a new REPLACE navigation\n    let redirect = findRedirect(loaderResults);\n    if (redirect) {\n      await startRedirectNavigation(request, redirect.result, true, {\n        replace\n      });\n      return {\n        shortCircuited: true\n      };\n    }\n    redirect = findRedirect(fetcherResults);\n    if (redirect) {\n      // If this redirect came from a fetcher make sure we mark it in\n      // fetchRedirectIds so it doesn't get revalidated on the next set of\n      // loader executions\n      fetchRedirectIds.add(redirect.key);\n      await startRedirectNavigation(request, redirect.result, true, {\n        replace\n      });\n      return {\n        shortCircuited: true\n      };\n    }\n    // Process and commit output from loaders\n    let {\n      loaderData,\n      errors\n    } = processLoaderData(state, matches, loaderResults, pendingActionResult, revalidatingFetchers, fetcherResults, activeDeferreds);\n    // Wire up subscribers to update loaderData as promises settle\n    activeDeferreds.forEach((deferredData, routeId) => {\n      deferredData.subscribe(aborted => {\n        // Note: No need to updateState here since the TrackedPromise on\n        // loaderData is stable across resolve/reject\n        // Remove this instance if we were aborted or if promises have settled\n        if (aborted || deferredData.done) {\n          activeDeferreds.delete(routeId);\n        }\n      });\n    });\n    // Preserve SSR errors during partial hydration\n    if (future.v7_partialHydration && initialHydration && state.errors) {\n      errors = _extends({}, state.errors, errors);\n    }\n    let updatedFetchers = markFetchRedirectsDone();\n    let didAbortFetchLoads = abortStaleFetchLoads(pendingNavigationLoadId);\n    let shouldUpdateFetchers = updatedFetchers || didAbortFetchLoads || revalidatingFetchers.length > 0;\n    return _extends({\n      matches,\n      loaderData,\n      errors\n    }, shouldUpdateFetchers ? {\n      fetchers: new Map(state.fetchers)\n    } : {});\n  }\n  function getUpdatedActionData(pendingActionResult) {\n    if (pendingActionResult && !isErrorResult(pendingActionResult[1])) {\n      // This is cast to `any` currently because `RouteData`uses any and it\n      // would be a breaking change to use any.\n      // TODO: v7 - change `RouteData` to use `unknown` instead of `any`\n      return {\n        [pendingActionResult[0]]: pendingActionResult[1].data\n      };\n    } else if (state.actionData) {\n      if (Object.keys(state.actionData).length === 0) {\n        return null;\n      } else {\n        return state.actionData;\n      }\n    }\n  }\n  function getUpdatedRevalidatingFetchers(revalidatingFetchers) {\n    revalidatingFetchers.forEach(rf => {\n      let fetcher = state.fetchers.get(rf.key);\n      let revalidatingFetcher = getLoadingFetcher(undefined, fetcher ? fetcher.data : undefined);\n      state.fetchers.set(rf.key, revalidatingFetcher);\n    });\n    return new Map(state.fetchers);\n  }\n  // Trigger a fetcher load/submit for the given fetcher key\n  function fetch(key, routeId, href, opts) {\n    if (isServer) {\n      throw new Error(\"router.fetch() was called during the server render, but it shouldn't be. \" + \"You are likely calling a useFetcher() method in the body of your component. \" + \"Try moving it to a useEffect or a callback.\");\n    }\n    abortFetcher(key);\n    let flushSync = (opts && opts.flushSync) === true;\n    let routesToUse = inFlightDataRoutes || dataRoutes;\n    let normalizedPath = normalizeTo(state.location, state.matches, basename, future.v7_prependBasename, href, future.v7_relativeSplatPath, routeId, opts == null ? void 0 : opts.relative);\n    let matches = matchRoutes(routesToUse, normalizedPath, basename);\n    let fogOfWar = checkFogOfWar(matches, routesToUse, normalizedPath);\n    if (fogOfWar.active && fogOfWar.matches) {\n      matches = fogOfWar.matches;\n    }\n    if (!matches) {\n      setFetcherError(key, routeId, getInternalRouterError(404, {\n        pathname: normalizedPath\n      }), {\n        flushSync\n      });\n      return;\n    }\n    let {\n      path,\n      submission,\n      error\n    } = normalizeNavigateOptions(future.v7_normalizeFormMethod, true, normalizedPath, opts);\n    if (error) {\n      setFetcherError(key, routeId, error, {\n        flushSync\n      });\n      return;\n    }\n    let match = getTargetMatch(matches, path);\n    let preventScrollReset = (opts && opts.preventScrollReset) === true;\n    if (submission && isMutationMethod(submission.formMethod)) {\n      handleFetcherAction(key, routeId, path, match, matches, fogOfWar.active, flushSync, preventScrollReset, submission);\n      return;\n    }\n    // Store off the match so we can call it's shouldRevalidate on subsequent\n    // revalidations\n    fetchLoadMatches.set(key, {\n      routeId,\n      path\n    });\n    handleFetcherLoader(key, routeId, path, match, matches, fogOfWar.active, flushSync, preventScrollReset, submission);\n  }\n  // Call the action for the matched fetcher.submit(), and then handle redirects,\n  // errors, and revalidation\n  async function handleFetcherAction(key, routeId, path, match, requestMatches, isFogOfWar, flushSync, preventScrollReset, submission) {\n    interruptActiveLoads();\n    fetchLoadMatches.delete(key);\n    function detectAndHandle405Error(m) {\n      if (!m.route.action && !m.route.lazy) {\n        let error = getInternalRouterError(405, {\n          method: submission.formMethod,\n          pathname: path,\n          routeId: routeId\n        });\n        setFetcherError(key, routeId, error, {\n          flushSync\n        });\n        return true;\n      }\n      return false;\n    }\n    if (!isFogOfWar && detectAndHandle405Error(match)) {\n      return;\n    }\n    // Put this fetcher into it's submitting state\n    let existingFetcher = state.fetchers.get(key);\n    updateFetcherState(key, getSubmittingFetcher(submission, existingFetcher), {\n      flushSync\n    });\n    let abortController = new AbortController();\n    let fetchRequest = createClientSideRequest(init.history, path, abortController.signal, submission);\n    if (isFogOfWar) {\n      let discoverResult = await discoverRoutes(requestMatches, new URL(fetchRequest.url).pathname, fetchRequest.signal, key);\n      if (discoverResult.type === \"aborted\") {\n        return;\n      } else if (discoverResult.type === \"error\") {\n        setFetcherError(key, routeId, discoverResult.error, {\n          flushSync\n        });\n        return;\n      } else if (!discoverResult.matches) {\n        setFetcherError(key, routeId, getInternalRouterError(404, {\n          pathname: path\n        }), {\n          flushSync\n        });\n        return;\n      } else {\n        requestMatches = discoverResult.matches;\n        match = getTargetMatch(requestMatches, path);\n        if (detectAndHandle405Error(match)) {\n          return;\n        }\n      }\n    }\n    // Call the action for the fetcher\n    fetchControllers.set(key, abortController);\n    let originatingLoadId = incrementingLoadId;\n    let actionResults = await callDataStrategy(\"action\", state, fetchRequest, [match], requestMatches, key);\n    let actionResult = actionResults[match.route.id];\n    if (fetchRequest.signal.aborted) {\n      // We can delete this so long as we weren't aborted by our own fetcher\n      // re-submit which would have put _new_ controller is in fetchControllers\n      if (fetchControllers.get(key) === abortController) {\n        fetchControllers.delete(key);\n      }\n      return;\n    }\n    // When using v7_fetcherPersist, we don't want errors bubbling up to the UI\n    // or redirects processed for unmounted fetchers so we just revert them to\n    // idle\n    if (future.v7_fetcherPersist && deletedFetchers.has(key)) {\n      if (isRedirectResult(actionResult) || isErrorResult(actionResult)) {\n        updateFetcherState(key, getDoneFetcher(undefined));\n        return;\n      }\n      // Let SuccessResult's fall through for revalidation\n    } else {\n      if (isRedirectResult(actionResult)) {\n        fetchControllers.delete(key);\n        if (pendingNavigationLoadId > originatingLoadId) {\n          // A new navigation was kicked off after our action started, so that\n          // should take precedence over this redirect navigation.  We already\n          // set isRevalidationRequired so all loaders for the new route should\n          // fire unless opted out via shouldRevalidate\n          updateFetcherState(key, getDoneFetcher(undefined));\n          return;\n        } else {\n          fetchRedirectIds.add(key);\n          updateFetcherState(key, getLoadingFetcher(submission));\n          return startRedirectNavigation(fetchRequest, actionResult, false, {\n            fetcherSubmission: submission,\n            preventScrollReset\n          });\n        }\n      }\n      // Process any non-redirect errors thrown\n      if (isErrorResult(actionResult)) {\n        setFetcherError(key, routeId, actionResult.error);\n        return;\n      }\n    }\n    if (isDeferredResult(actionResult)) {\n      throw getInternalRouterError(400, {\n        type: \"defer-action\"\n      });\n    }\n    // Start the data load for current matches, or the next location if we're\n    // in the middle of a navigation\n    let nextLocation = state.navigation.location || state.location;\n    let revalidationRequest = createClientSideRequest(init.history, nextLocation, abortController.signal);\n    let routesToUse = inFlightDataRoutes || dataRoutes;\n    let matches = state.navigation.state !== \"idle\" ? matchRoutes(routesToUse, state.navigation.location, basename) : state.matches;\n    invariant(matches, \"Didn't find any matches after fetcher action\");\n    let loadId = ++incrementingLoadId;\n    fetchReloadIds.set(key, loadId);\n    let loadFetcher = getLoadingFetcher(submission, actionResult.data);\n    state.fetchers.set(key, loadFetcher);\n    let [matchesToLoad, revalidatingFetchers] = getMatchesToLoad(init.history, state, matches, submission, nextLocation, false, future.v7_skipActionErrorRevalidation, isRevalidationRequired, cancelledDeferredRoutes, cancelledFetcherLoads, deletedFetchers, fetchLoadMatches, fetchRedirectIds, routesToUse, basename, [match.route.id, actionResult]);\n    // Put all revalidating fetchers into the loading state, except for the\n    // current fetcher which we want to keep in it's current loading state which\n    // contains it's action submission info + action data\n    revalidatingFetchers.filter(rf => rf.key !== key).forEach(rf => {\n      let staleKey = rf.key;\n      let existingFetcher = state.fetchers.get(staleKey);\n      let revalidatingFetcher = getLoadingFetcher(undefined, existingFetcher ? existingFetcher.data : undefined);\n      state.fetchers.set(staleKey, revalidatingFetcher);\n      abortFetcher(staleKey);\n      if (rf.controller) {\n        fetchControllers.set(staleKey, rf.controller);\n      }\n    });\n    updateState({\n      fetchers: new Map(state.fetchers)\n    });\n    let abortPendingFetchRevalidations = () => revalidatingFetchers.forEach(rf => abortFetcher(rf.key));\n    abortController.signal.addEventListener(\"abort\", abortPendingFetchRevalidations);\n    let {\n      loaderResults,\n      fetcherResults\n    } = await callLoadersAndMaybeResolveData(state, matches, matchesToLoad, revalidatingFetchers, revalidationRequest);\n    if (abortController.signal.aborted) {\n      return;\n    }\n    abortController.signal.removeEventListener(\"abort\", abortPendingFetchRevalidations);\n    fetchReloadIds.delete(key);\n    fetchControllers.delete(key);\n    revalidatingFetchers.forEach(r => fetchControllers.delete(r.key));\n    let redirect = findRedirect(loaderResults);\n    if (redirect) {\n      return startRedirectNavigation(revalidationRequest, redirect.result, false, {\n        preventScrollReset\n      });\n    }\n    redirect = findRedirect(fetcherResults);\n    if (redirect) {\n      // If this redirect came from a fetcher make sure we mark it in\n      // fetchRedirectIds so it doesn't get revalidated on the next set of\n      // loader executions\n      fetchRedirectIds.add(redirect.key);\n      return startRedirectNavigation(revalidationRequest, redirect.result, false, {\n        preventScrollReset\n      });\n    }\n    // Process and commit output from loaders\n    let {\n      loaderData,\n      errors\n    } = processLoaderData(state, matches, loaderResults, undefined, revalidatingFetchers, fetcherResults, activeDeferreds);\n    // Since we let revalidations complete even if the submitting fetcher was\n    // deleted, only put it back to idle if it hasn't been deleted\n    if (state.fetchers.has(key)) {\n      let doneFetcher = getDoneFetcher(actionResult.data);\n      state.fetchers.set(key, doneFetcher);\n    }\n    abortStaleFetchLoads(loadId);\n    // If we are currently in a navigation loading state and this fetcher is\n    // more recent than the navigation, we want the newer data so abort the\n    // navigation and complete it with the fetcher data\n    if (state.navigation.state === \"loading\" && loadId > pendingNavigationLoadId) {\n      invariant(pendingAction, \"Expected pending action\");\n      pendingNavigationController && pendingNavigationController.abort();\n      completeNavigation(state.navigation.location, {\n        matches,\n        loaderData,\n        errors,\n        fetchers: new Map(state.fetchers)\n      });\n    } else {\n      // otherwise just update with the fetcher data, preserving any existing\n      // loaderData for loaders that did not need to reload.  We have to\n      // manually merge here since we aren't going through completeNavigation\n      updateState({\n        errors,\n        loaderData: mergeLoaderData(state.loaderData, loaderData, matches, errors),\n        fetchers: new Map(state.fetchers)\n      });\n      isRevalidationRequired = false;\n    }\n  }\n  // Call the matched loader for fetcher.load(), handling redirects, errors, etc.\n  async function handleFetcherLoader(key, routeId, path, match, matches, isFogOfWar, flushSync, preventScrollReset, submission) {\n    let existingFetcher = state.fetchers.get(key);\n    updateFetcherState(key, getLoadingFetcher(submission, existingFetcher ? existingFetcher.data : undefined), {\n      flushSync\n    });\n    let abortController = new AbortController();\n    let fetchRequest = createClientSideRequest(init.history, path, abortController.signal);\n    if (isFogOfWar) {\n      let discoverResult = await discoverRoutes(matches, new URL(fetchRequest.url).pathname, fetchRequest.signal, key);\n      if (discoverResult.type === \"aborted\") {\n        return;\n      } else if (discoverResult.type === \"error\") {\n        setFetcherError(key, routeId, discoverResult.error, {\n          flushSync\n        });\n        return;\n      } else if (!discoverResult.matches) {\n        setFetcherError(key, routeId, getInternalRouterError(404, {\n          pathname: path\n        }), {\n          flushSync\n        });\n        return;\n      } else {\n        matches = discoverResult.matches;\n        match = getTargetMatch(matches, path);\n      }\n    }\n    // Call the loader for this fetcher route match\n    fetchControllers.set(key, abortController);\n    let originatingLoadId = incrementingLoadId;\n    let results = await callDataStrategy(\"loader\", state, fetchRequest, [match], matches, key);\n    let result = results[match.route.id];\n    // Deferred isn't supported for fetcher loads, await everything and treat it\n    // as a normal load.  resolveDeferredData will return undefined if this\n    // fetcher gets aborted, so we just leave result untouched and short circuit\n    // below if that happens\n    if (isDeferredResult(result)) {\n      result = (await resolveDeferredData(result, fetchRequest.signal, true)) || result;\n    }\n    // We can delete this so long as we weren't aborted by our our own fetcher\n    // re-load which would have put _new_ controller is in fetchControllers\n    if (fetchControllers.get(key) === abortController) {\n      fetchControllers.delete(key);\n    }\n    if (fetchRequest.signal.aborted) {\n      return;\n    }\n    // We don't want errors bubbling up or redirects followed for unmounted\n    // fetchers, so short circuit here if it was removed from the UI\n    if (deletedFetchers.has(key)) {\n      updateFetcherState(key, getDoneFetcher(undefined));\n      return;\n    }\n    // If the loader threw a redirect Response, start a new REPLACE navigation\n    if (isRedirectResult(result)) {\n      if (pendingNavigationLoadId > originatingLoadId) {\n        // A new navigation was kicked off after our loader started, so that\n        // should take precedence over this redirect navigation\n        updateFetcherState(key, getDoneFetcher(undefined));\n        return;\n      } else {\n        fetchRedirectIds.add(key);\n        await startRedirectNavigation(fetchRequest, result, false, {\n          preventScrollReset\n        });\n        return;\n      }\n    }\n    // Process any non-redirect errors thrown\n    if (isErrorResult(result)) {\n      setFetcherError(key, routeId, result.error);\n      return;\n    }\n    invariant(!isDeferredResult(result), \"Unhandled fetcher deferred data\");\n    // Put the fetcher back into an idle state\n    updateFetcherState(key, getDoneFetcher(result.data));\n  }\n  /**\n   * Utility function to handle redirects returned from an action or loader.\n   * Normally, a redirect \"replaces\" the navigation that triggered it.  So, for\n   * example:\n   *\n   *  - user is on /a\n   *  - user clicks a link to /b\n   *  - loader for /b redirects to /c\n   *\n   * In a non-JS app the browser would track the in-flight navigation to /b and\n   * then replace it with /c when it encountered the redirect response.  In\n   * the end it would only ever update the URL bar with /c.\n   *\n   * In client-side routing using pushState/replaceState, we aim to emulate\n   * this behavior and we also do not update history until the end of the\n   * navigation (including processed redirects).  This means that we never\n   * actually touch history until we've processed redirects, so we just use\n   * the history action from the original navigation (PUSH or REPLACE).\n   */\n  async function startRedirectNavigation(request, redirect, isNavigation, _temp2) {\n    let {\n      submission,\n      fetcherSubmission,\n      preventScrollReset,\n      replace\n    } = _temp2 === void 0 ? {} : _temp2;\n    if (redirect.response.headers.has(\"X-Remix-Revalidate\")) {\n      isRevalidationRequired = true;\n    }\n    let location = redirect.response.headers.get(\"Location\");\n    invariant(location, \"Expected a Location header on the redirect Response\");\n    location = normalizeRedirectLocation(location, new URL(request.url), basename, init.history);\n    let redirectLocation = createLocation(state.location, location, {\n      _isRedirect: true\n    });\n    if (isBrowser) {\n      let isDocumentReload = false;\n      if (redirect.response.headers.has(\"X-Remix-Reload-Document\")) {\n        // Hard reload if the response contained X-Remix-Reload-Document\n        isDocumentReload = true;\n      } else if (ABSOLUTE_URL_REGEX.test(location)) {\n        const url = init.history.createURL(location);\n        isDocumentReload =\n        // Hard reload if it's an absolute URL to a new origin\n        url.origin !== routerWindow.location.origin ||\n        // Hard reload if it's an absolute URL that does not match our basename\n        stripBasename(url.pathname, basename) == null;\n      }\n      if (isDocumentReload) {\n        if (replace) {\n          routerWindow.location.replace(location);\n        } else {\n          routerWindow.location.assign(location);\n        }\n        return;\n      }\n    }\n    // There's no need to abort on redirects, since we don't detect the\n    // redirect until the action/loaders have settled\n    pendingNavigationController = null;\n    let redirectHistoryAction = replace === true || redirect.response.headers.has(\"X-Remix-Replace\") ? Action.Replace : Action.Push;\n    // Use the incoming submission if provided, fallback on the active one in\n    // state.navigation\n    let {\n      formMethod,\n      formAction,\n      formEncType\n    } = state.navigation;\n    if (!submission && !fetcherSubmission && formMethod && formAction && formEncType) {\n      submission = getSubmissionFromNavigation(state.navigation);\n    }\n    // If this was a 307/308 submission we want to preserve the HTTP method and\n    // re-submit the GET/POST/PUT/PATCH/DELETE as a submission navigation to the\n    // redirected location\n    let activeSubmission = submission || fetcherSubmission;\n    if (redirectPreserveMethodStatusCodes.has(redirect.response.status) && activeSubmission && isMutationMethod(activeSubmission.formMethod)) {\n      await startNavigation(redirectHistoryAction, redirectLocation, {\n        submission: _extends({}, activeSubmission, {\n          formAction: location\n        }),\n        // Preserve these flags across redirects\n        preventScrollReset: preventScrollReset || pendingPreventScrollReset,\n        enableViewTransition: isNavigation ? pendingViewTransitionEnabled : undefined\n      });\n    } else {\n      // If we have a navigation submission, we will preserve it through the\n      // redirect navigation\n      let overrideNavigation = getLoadingNavigation(redirectLocation, submission);\n      await startNavigation(redirectHistoryAction, redirectLocation, {\n        overrideNavigation,\n        // Send fetcher submissions through for shouldRevalidate\n        fetcherSubmission,\n        // Preserve these flags across redirects\n        preventScrollReset: preventScrollReset || pendingPreventScrollReset,\n        enableViewTransition: isNavigation ? pendingViewTransitionEnabled : undefined\n      });\n    }\n  }\n  // Utility wrapper for calling dataStrategy client-side without having to\n  // pass around the manifest, mapRouteProperties, etc.\n  async function callDataStrategy(type, state, request, matchesToLoad, matches, fetcherKey) {\n    let results;\n    let dataResults = {};\n    try {\n      results = await callDataStrategyImpl(dataStrategyImpl, type, state, request, matchesToLoad, matches, fetcherKey, manifest, mapRouteProperties);\n    } catch (e) {\n      // If the outer dataStrategy method throws, just return the error for all\n      // matches - and it'll naturally bubble to the root\n      matchesToLoad.forEach(m => {\n        dataResults[m.route.id] = {\n          type: ResultType.error,\n          error: e\n        };\n      });\n      return dataResults;\n    }\n    for (let [routeId, result] of Object.entries(results)) {\n      if (isRedirectDataStrategyResultResult(result)) {\n        let response = result.result;\n        dataResults[routeId] = {\n          type: ResultType.redirect,\n          response: normalizeRelativeRoutingRedirectResponse(response, request, routeId, matches, basename, future.v7_relativeSplatPath)\n        };\n      } else {\n        dataResults[routeId] = await convertDataStrategyResultToDataResult(result);\n      }\n    }\n    return dataResults;\n  }\n  async function callLoadersAndMaybeResolveData(state, matches, matchesToLoad, fetchersToLoad, request) {\n    let currentMatches = state.matches;\n    // Kick off loaders and fetchers in parallel\n    let loaderResultsPromise = callDataStrategy(\"loader\", state, request, matchesToLoad, matches, null);\n    let fetcherResultsPromise = Promise.all(fetchersToLoad.map(async f => {\n      if (f.matches && f.match && f.controller) {\n        let results = await callDataStrategy(\"loader\", state, createClientSideRequest(init.history, f.path, f.controller.signal), [f.match], f.matches, f.key);\n        let result = results[f.match.route.id];\n        // Fetcher results are keyed by fetcher key from here on out, not routeId\n        return {\n          [f.key]: result\n        };\n      } else {\n        return Promise.resolve({\n          [f.key]: {\n            type: ResultType.error,\n            error: getInternalRouterError(404, {\n              pathname: f.path\n            })\n          }\n        });\n      }\n    }));\n    let loaderResults = await loaderResultsPromise;\n    let fetcherResults = (await fetcherResultsPromise).reduce((acc, r) => Object.assign(acc, r), {});\n    await Promise.all([resolveNavigationDeferredResults(matches, loaderResults, request.signal, currentMatches, state.loaderData), resolveFetcherDeferredResults(matches, fetcherResults, fetchersToLoad)]);\n    return {\n      loaderResults,\n      fetcherResults\n    };\n  }\n  function interruptActiveLoads() {\n    // Every interruption triggers a revalidation\n    isRevalidationRequired = true;\n    // Cancel pending route-level deferreds and mark cancelled routes for\n    // revalidation\n    cancelledDeferredRoutes.push(...cancelActiveDeferreds());\n    // Abort in-flight fetcher loads\n    fetchLoadMatches.forEach((_, key) => {\n      if (fetchControllers.has(key)) {\n        cancelledFetcherLoads.add(key);\n      }\n      abortFetcher(key);\n    });\n  }\n  function updateFetcherState(key, fetcher, opts) {\n    if (opts === void 0) {\n      opts = {};\n    }\n    state.fetchers.set(key, fetcher);\n    updateState({\n      fetchers: new Map(state.fetchers)\n    }, {\n      flushSync: (opts && opts.flushSync) === true\n    });\n  }\n  function setFetcherError(key, routeId, error, opts) {\n    if (opts === void 0) {\n      opts = {};\n    }\n    let boundaryMatch = findNearestBoundary(state.matches, routeId);\n    deleteFetcher(key);\n    updateState({\n      errors: {\n        [boundaryMatch.route.id]: error\n      },\n      fetchers: new Map(state.fetchers)\n    }, {\n      flushSync: (opts && opts.flushSync) === true\n    });\n  }\n  function getFetcher(key) {\n    activeFetchers.set(key, (activeFetchers.get(key) || 0) + 1);\n    // If this fetcher was previously marked for deletion, unmark it since we\n    // have a new instance\n    if (deletedFetchers.has(key)) {\n      deletedFetchers.delete(key);\n    }\n    return state.fetchers.get(key) || IDLE_FETCHER;\n  }\n  function deleteFetcher(key) {\n    let fetcher = state.fetchers.get(key);\n    // Don't abort the controller if this is a deletion of a fetcher.submit()\n    // in it's loading phase since - we don't want to abort the corresponding\n    // revalidation and want them to complete and land\n    if (fetchControllers.has(key) && !(fetcher && fetcher.state === \"loading\" && fetchReloadIds.has(key))) {\n      abortFetcher(key);\n    }\n    fetchLoadMatches.delete(key);\n    fetchReloadIds.delete(key);\n    fetchRedirectIds.delete(key);\n    // If we opted into the flag we can clear this now since we're calling\n    // deleteFetcher() at the end of updateState() and we've already handed the\n    // deleted fetcher keys off to the data layer.\n    // If not, we're eagerly calling deleteFetcher() and we need to keep this\n    // Set populated until the next updateState call, and we'll clear\n    // `deletedFetchers` then\n    if (future.v7_fetcherPersist) {\n      deletedFetchers.delete(key);\n    }\n    cancelledFetcherLoads.delete(key);\n    state.fetchers.delete(key);\n  }\n  function deleteFetcherAndUpdateState(key) {\n    let count = (activeFetchers.get(key) || 0) - 1;\n    if (count <= 0) {\n      activeFetchers.delete(key);\n      deletedFetchers.add(key);\n      if (!future.v7_fetcherPersist) {\n        deleteFetcher(key);\n      }\n    } else {\n      activeFetchers.set(key, count);\n    }\n    updateState({\n      fetchers: new Map(state.fetchers)\n    });\n  }\n  function abortFetcher(key) {\n    let controller = fetchControllers.get(key);\n    if (controller) {\n      controller.abort();\n      fetchControllers.delete(key);\n    }\n  }\n  function markFetchersDone(keys) {\n    for (let key of keys) {\n      let fetcher = getFetcher(key);\n      let doneFetcher = getDoneFetcher(fetcher.data);\n      state.fetchers.set(key, doneFetcher);\n    }\n  }\n  function markFetchRedirectsDone() {\n    let doneKeys = [];\n    let updatedFetchers = false;\n    for (let key of fetchRedirectIds) {\n      let fetcher = state.fetchers.get(key);\n      invariant(fetcher, \"Expected fetcher: \" + key);\n      if (fetcher.state === \"loading\") {\n        fetchRedirectIds.delete(key);\n        doneKeys.push(key);\n        updatedFetchers = true;\n      }\n    }\n    markFetchersDone(doneKeys);\n    return updatedFetchers;\n  }\n  function abortStaleFetchLoads(landedId) {\n    let yeetedKeys = [];\n    for (let [key, id] of fetchReloadIds) {\n      if (id < landedId) {\n        let fetcher = state.fetchers.get(key);\n        invariant(fetcher, \"Expected fetcher: \" + key);\n        if (fetcher.state === \"loading\") {\n          abortFetcher(key);\n          fetchReloadIds.delete(key);\n          yeetedKeys.push(key);\n        }\n      }\n    }\n    markFetchersDone(yeetedKeys);\n    return yeetedKeys.length > 0;\n  }\n  function getBlocker(key, fn) {\n    let blocker = state.blockers.get(key) || IDLE_BLOCKER;\n    if (blockerFunctions.get(key) !== fn) {\n      blockerFunctions.set(key, fn);\n    }\n    return blocker;\n  }\n  function deleteBlocker(key) {\n    state.blockers.delete(key);\n    blockerFunctions.delete(key);\n  }\n  // Utility function to update blockers, ensuring valid state transitions\n  function updateBlocker(key, newBlocker) {\n    let blocker = state.blockers.get(key) || IDLE_BLOCKER;\n    // Poor mans state machine :)\n    // https://mermaid.live/edit#pako:eNqVkc9OwzAMxl8l8nnjAYrEtDIOHEBIgwvKJTReGy3_lDpIqO27k6awMG0XcrLlnz87nwdonESogKXXBuE79rq75XZO3-yHds0RJVuv70YrPlUrCEe2HfrORS3rubqZfuhtpg5C9wk5tZ4VKcRUq88q9Z8RS0-48cE1iHJkL0ugbHuFLus9L6spZy8nX9MP2CNdomVaposqu3fGayT8T8-jJQwhepo_UtpgBQaDEUom04dZhAN1aJBDlUKJBxE1ceB2Smj0Mln-IBW5AFU2dwUiktt_2Qaq2dBfaKdEup85UV7Yd-dKjlnkabl2Pvr0DTkTreM\n    invariant(blocker.state === \"unblocked\" && newBlocker.state === \"blocked\" || blocker.state === \"blocked\" && newBlocker.state === \"blocked\" || blocker.state === \"blocked\" && newBlocker.state === \"proceeding\" || blocker.state === \"blocked\" && newBlocker.state === \"unblocked\" || blocker.state === \"proceeding\" && newBlocker.state === \"unblocked\", \"Invalid blocker state transition: \" + blocker.state + \" -> \" + newBlocker.state);\n    let blockers = new Map(state.blockers);\n    blockers.set(key, newBlocker);\n    updateState({\n      blockers\n    });\n  }\n  function shouldBlockNavigation(_ref2) {\n    let {\n      currentLocation,\n      nextLocation,\n      historyAction\n    } = _ref2;\n    if (blockerFunctions.size === 0) {\n      return;\n    }\n    // We ony support a single active blocker at the moment since we don't have\n    // any compelling use cases for multi-blocker yet\n    if (blockerFunctions.size > 1) {\n      warning(false, \"A router only supports one blocker at a time\");\n    }\n    let entries = Array.from(blockerFunctions.entries());\n    let [blockerKey, blockerFunction] = entries[entries.length - 1];\n    let blocker = state.blockers.get(blockerKey);\n    if (blocker && blocker.state === \"proceeding\") {\n      // If the blocker is currently proceeding, we don't need to re-check\n      // it and can let this navigation continue\n      return;\n    }\n    // At this point, we know we're unblocked/blocked so we need to check the\n    // user-provided blocker function\n    if (blockerFunction({\n      currentLocation,\n      nextLocation,\n      historyAction\n    })) {\n      return blockerKey;\n    }\n  }\n  function handleNavigational404(pathname) {\n    let error = getInternalRouterError(404, {\n      pathname\n    });\n    let routesToUse = inFlightDataRoutes || dataRoutes;\n    let {\n      matches,\n      route\n    } = getShortCircuitMatches(routesToUse);\n    // Cancel all pending deferred on 404s since we don't keep any routes\n    cancelActiveDeferreds();\n    return {\n      notFoundMatches: matches,\n      route,\n      error\n    };\n  }\n  function cancelActiveDeferreds(predicate) {\n    let cancelledRouteIds = [];\n    activeDeferreds.forEach((dfd, routeId) => {\n      if (!predicate || predicate(routeId)) {\n        // Cancel the deferred - but do not remove from activeDeferreds here -\n        // we rely on the subscribers to do that so our tests can assert proper\n        // cleanup via _internalActiveDeferreds\n        dfd.cancel();\n        cancelledRouteIds.push(routeId);\n        activeDeferreds.delete(routeId);\n      }\n    });\n    return cancelledRouteIds;\n  }\n  // Opt in to capturing and reporting scroll positions during navigations,\n  // used by the <ScrollRestoration> component\n  function enableScrollRestoration(positions, getPosition, getKey) {\n    savedScrollPositions = positions;\n    getScrollPosition = getPosition;\n    getScrollRestorationKey = getKey || null;\n    // Perform initial hydration scroll restoration, since we miss the boat on\n    // the initial updateState() because we've not yet rendered <ScrollRestoration/>\n    // and therefore have no savedScrollPositions available\n    if (!initialScrollRestored && state.navigation === IDLE_NAVIGATION) {\n      initialScrollRestored = true;\n      let y = getSavedScrollPosition(state.location, state.matches);\n      if (y != null) {\n        updateState({\n          restoreScrollPosition: y\n        });\n      }\n    }\n    return () => {\n      savedScrollPositions = null;\n      getScrollPosition = null;\n      getScrollRestorationKey = null;\n    };\n  }\n  function getScrollKey(location, matches) {\n    if (getScrollRestorationKey) {\n      let key = getScrollRestorationKey(location, matches.map(m => convertRouteMatchToUiMatch(m, state.loaderData)));\n      return key || location.key;\n    }\n    return location.key;\n  }\n  function saveScrollPosition(location, matches) {\n    if (savedScrollPositions && getScrollPosition) {\n      let key = getScrollKey(location, matches);\n      savedScrollPositions[key] = getScrollPosition();\n    }\n  }\n  function getSavedScrollPosition(location, matches) {\n    if (savedScrollPositions) {\n      let key = getScrollKey(location, matches);\n      let y = savedScrollPositions[key];\n      if (typeof y === \"number\") {\n        return y;\n      }\n    }\n    return null;\n  }\n  function checkFogOfWar(matches, routesToUse, pathname) {\n    if (patchRoutesOnNavigationImpl) {\n      if (!matches) {\n        let fogMatches = matchRoutesImpl(routesToUse, pathname, basename, true);\n        return {\n          active: true,\n          matches: fogMatches || []\n        };\n      } else {\n        if (Object.keys(matches[0].params).length > 0) {\n          // If we matched a dynamic param or a splat, it might only be because\n          // we haven't yet discovered other routes that would match with a\n          // higher score.  Call patchRoutesOnNavigation just to be sure\n          let partialMatches = matchRoutesImpl(routesToUse, pathname, basename, true);\n          return {\n            active: true,\n            matches: partialMatches\n          };\n        }\n      }\n    }\n    return {\n      active: false,\n      matches: null\n    };\n  }\n  async function discoverRoutes(matches, pathname, signal, fetcherKey) {\n    if (!patchRoutesOnNavigationImpl) {\n      return {\n        type: \"success\",\n        matches\n      };\n    }\n    let partialMatches = matches;\n    while (true) {\n      let isNonHMR = inFlightDataRoutes == null;\n      let routesToUse = inFlightDataRoutes || dataRoutes;\n      let localManifest = manifest;\n      try {\n        await patchRoutesOnNavigationImpl({\n          signal,\n          path: pathname,\n          matches: partialMatches,\n          fetcherKey,\n          patch: (routeId, children) => {\n            if (signal.aborted) return;\n            patchRoutesImpl(routeId, children, routesToUse, localManifest, mapRouteProperties);\n          }\n        });\n      } catch (e) {\n        return {\n          type: \"error\",\n          error: e,\n          partialMatches\n        };\n      } finally {\n        // If we are not in the middle of an HMR revalidation and we changed the\n        // routes, provide a new identity so when we `updateState` at the end of\n        // this navigation/fetch `router.routes` will be a new identity and\n        // trigger a re-run of memoized `router.routes` dependencies.\n        // HMR will already update the identity and reflow when it lands\n        // `inFlightDataRoutes` in `completeNavigation`\n        if (isNonHMR && !signal.aborted) {\n          dataRoutes = [...dataRoutes];\n        }\n      }\n      if (signal.aborted) {\n        return {\n          type: \"aborted\"\n        };\n      }\n      let newMatches = matchRoutes(routesToUse, pathname, basename);\n      if (newMatches) {\n        return {\n          type: \"success\",\n          matches: newMatches\n        };\n      }\n      let newPartialMatches = matchRoutesImpl(routesToUse, pathname, basename, true);\n      // Avoid loops if the second pass results in the same partial matches\n      if (!newPartialMatches || partialMatches.length === newPartialMatches.length && partialMatches.every((m, i) => m.route.id === newPartialMatches[i].route.id)) {\n        return {\n          type: \"success\",\n          matches: null\n        };\n      }\n      partialMatches = newPartialMatches;\n    }\n  }\n  function _internalSetRoutes(newRoutes) {\n    manifest = {};\n    inFlightDataRoutes = convertRoutesToDataRoutes(newRoutes, mapRouteProperties, undefined, manifest);\n  }\n  function patchRoutes(routeId, children) {\n    let isNonHMR = inFlightDataRoutes == null;\n    let routesToUse = inFlightDataRoutes || dataRoutes;\n    patchRoutesImpl(routeId, children, routesToUse, manifest, mapRouteProperties);\n    // If we are not in the middle of an HMR revalidation and we changed the\n    // routes, provide a new identity and trigger a reflow via `updateState`\n    // to re-run memoized `router.routes` dependencies.\n    // HMR will already update the identity and reflow when it lands\n    // `inFlightDataRoutes` in `completeNavigation`\n    if (isNonHMR) {\n      dataRoutes = [...dataRoutes];\n      updateState({});\n    }\n  }\n  router = {\n    get basename() {\n      return basename;\n    },\n    get future() {\n      return future;\n    },\n    get state() {\n      return state;\n    },\n    get routes() {\n      return dataRoutes;\n    },\n    get window() {\n      return routerWindow;\n    },\n    initialize,\n    subscribe,\n    enableScrollRestoration,\n    navigate,\n    fetch,\n    revalidate,\n    // Passthrough to history-aware createHref used by useHref so we get proper\n    // hash-aware URLs in DOM paths\n    createHref: to => init.history.createHref(to),\n    encodeLocation: to => init.history.encodeLocation(to),\n    getFetcher,\n    deleteFetcher: deleteFetcherAndUpdateState,\n    dispose,\n    getBlocker,\n    deleteBlocker,\n    patchRoutes,\n    _internalFetchControllers: fetchControllers,\n    _internalActiveDeferreds: activeDeferreds,\n    // TODO: Remove setRoutes, it's temporary to avoid dealing with\n    // updating the tree while validating the update algorithm.\n    _internalSetRoutes\n  };\n  return router;\n}\n//#endregion\n////////////////////////////////////////////////////////////////////////////////\n//#region createStaticHandler\n////////////////////////////////////////////////////////////////////////////////\nconst UNSAFE_DEFERRED_SYMBOL = Symbol(\"deferred\");\nfunction createStaticHandler(routes, opts) {\n  invariant(routes.length > 0, \"You must provide a non-empty routes array to createStaticHandler\");\n  let manifest = {};\n  let basename = (opts ? opts.basename : null) || \"/\";\n  let mapRouteProperties;\n  if (opts != null && opts.mapRouteProperties) {\n    mapRouteProperties = opts.mapRouteProperties;\n  } else if (opts != null && opts.detectErrorBoundary) {\n    // If they are still using the deprecated version, wrap it with the new API\n    let detectErrorBoundary = opts.detectErrorBoundary;\n    mapRouteProperties = route => ({\n      hasErrorBoundary: detectErrorBoundary(route)\n    });\n  } else {\n    mapRouteProperties = defaultMapRouteProperties;\n  }\n  // Config driven behavior flags\n  let future = _extends({\n    v7_relativeSplatPath: false,\n    v7_throwAbortReason: false\n  }, opts ? opts.future : null);\n  let dataRoutes = convertRoutesToDataRoutes(routes, mapRouteProperties, undefined, manifest);\n  /**\n   * The query() method is intended for document requests, in which we want to\n   * call an optional action and potentially multiple loaders for all nested\n   * routes.  It returns a StaticHandlerContext object, which is very similar\n   * to the router state (location, loaderData, actionData, errors, etc.) and\n   * also adds SSR-specific information such as the statusCode and headers\n   * from action/loaders Responses.\n   *\n   * It _should_ never throw and should report all errors through the\n   * returned context.errors object, properly associating errors to their error\n   * boundary.  Additionally, it tracks _deepestRenderedBoundaryId which can be\n   * used to emulate React error boundaries during SSr by performing a second\n   * pass only down to the boundaryId.\n   *\n   * The one exception where we do not return a StaticHandlerContext is when a\n   * redirect response is returned or thrown from any action/loader.  We\n   * propagate that out and return the raw Response so the HTTP server can\n   * return it directly.\n   *\n   * - `opts.requestContext` is an optional server context that will be passed\n   *   to actions/loaders in the `context` parameter\n   * - `opts.skipLoaderErrorBubbling` is an optional parameter that will prevent\n   *   the bubbling of errors which allows single-fetch-type implementations\n   *   where the client will handle the bubbling and we may need to return data\n   *   for the handling route\n   */\n  async function query(request, _temp3) {\n    let {\n      requestContext,\n      skipLoaderErrorBubbling,\n      dataStrategy\n    } = _temp3 === void 0 ? {} : _temp3;\n    let url = new URL(request.url);\n    let method = request.method;\n    let location = createLocation(\"\", createPath(url), null, \"default\");\n    let matches = matchRoutes(dataRoutes, location, basename);\n    // SSR supports HEAD requests while SPA doesn't\n    if (!isValidMethod(method) && method !== \"HEAD\") {\n      let error = getInternalRouterError(405, {\n        method\n      });\n      let {\n        matches: methodNotAllowedMatches,\n        route\n      } = getShortCircuitMatches(dataRoutes);\n      return {\n        basename,\n        location,\n        matches: methodNotAllowedMatches,\n        loaderData: {},\n        actionData: null,\n        errors: {\n          [route.id]: error\n        },\n        statusCode: error.status,\n        loaderHeaders: {},\n        actionHeaders: {},\n        activeDeferreds: null\n      };\n    } else if (!matches) {\n      let error = getInternalRouterError(404, {\n        pathname: location.pathname\n      });\n      let {\n        matches: notFoundMatches,\n        route\n      } = getShortCircuitMatches(dataRoutes);\n      return {\n        basename,\n        location,\n        matches: notFoundMatches,\n        loaderData: {},\n        actionData: null,\n        errors: {\n          [route.id]: error\n        },\n        statusCode: error.status,\n        loaderHeaders: {},\n        actionHeaders: {},\n        activeDeferreds: null\n      };\n    }\n    let result = await queryImpl(request, location, matches, requestContext, dataStrategy || null, skipLoaderErrorBubbling === true, null);\n    if (isResponse(result)) {\n      return result;\n    }\n    // When returning StaticHandlerContext, we patch back in the location here\n    // since we need it for React Context.  But this helps keep our submit and\n    // loadRouteData operating on a Request instead of a Location\n    return _extends({\n      location,\n      basename\n    }, result);\n  }\n  /**\n   * The queryRoute() method is intended for targeted route requests, either\n   * for fetch ?_data requests or resource route requests.  In this case, we\n   * are only ever calling a single action or loader, and we are returning the\n   * returned value directly.  In most cases, this will be a Response returned\n   * from the action/loader, but it may be a primitive or other value as well -\n   * and in such cases the calling context should handle that accordingly.\n   *\n   * We do respect the throw/return differentiation, so if an action/loader\n   * throws, then this method will throw the value.  This is important so we\n   * can do proper boundary identification in Remix where a thrown Response\n   * must go to the Catch Boundary but a returned Response is happy-path.\n   *\n   * One thing to note is that any Router-initiated Errors that make sense\n   * to associate with a status code will be thrown as an ErrorResponse\n   * instance which include the raw Error, such that the calling context can\n   * serialize the error as they see fit while including the proper response\n   * code.  Examples here are 404 and 405 errors that occur prior to reaching\n   * any user-defined loaders.\n   *\n   * - `opts.routeId` allows you to specify the specific route handler to call.\n   *   If not provided the handler will determine the proper route by matching\n   *   against `request.url`\n   * - `opts.requestContext` is an optional server context that will be passed\n   *    to actions/loaders in the `context` parameter\n   */\n  async function queryRoute(request, _temp4) {\n    let {\n      routeId,\n      requestContext,\n      dataStrategy\n    } = _temp4 === void 0 ? {} : _temp4;\n    let url = new URL(request.url);\n    let method = request.method;\n    let location = createLocation(\"\", createPath(url), null, \"default\");\n    let matches = matchRoutes(dataRoutes, location, basename);\n    // SSR supports HEAD requests while SPA doesn't\n    if (!isValidMethod(method) && method !== \"HEAD\" && method !== \"OPTIONS\") {\n      throw getInternalRouterError(405, {\n        method\n      });\n    } else if (!matches) {\n      throw getInternalRouterError(404, {\n        pathname: location.pathname\n      });\n    }\n    let match = routeId ? matches.find(m => m.route.id === routeId) : getTargetMatch(matches, location);\n    if (routeId && !match) {\n      throw getInternalRouterError(403, {\n        pathname: location.pathname,\n        routeId\n      });\n    } else if (!match) {\n      // This should never hit I don't think?\n      throw getInternalRouterError(404, {\n        pathname: location.pathname\n      });\n    }\n    let result = await queryImpl(request, location, matches, requestContext, dataStrategy || null, false, match);\n    if (isResponse(result)) {\n      return result;\n    }\n    let error = result.errors ? Object.values(result.errors)[0] : undefined;\n    if (error !== undefined) {\n      // If we got back result.errors, that means the loader/action threw\n      // _something_ that wasn't a Response, but it's not guaranteed/required\n      // to be an `instanceof Error` either, so we have to use throw here to\n      // preserve the \"error\" state outside of queryImpl.\n      throw error;\n    }\n    // Pick off the right state value to return\n    if (result.actionData) {\n      return Object.values(result.actionData)[0];\n    }\n    if (result.loaderData) {\n      var _result$activeDeferre;\n      let data = Object.values(result.loaderData)[0];\n      if ((_result$activeDeferre = result.activeDeferreds) != null && _result$activeDeferre[match.route.id]) {\n        data[UNSAFE_DEFERRED_SYMBOL] = result.activeDeferreds[match.route.id];\n      }\n      return data;\n    }\n    return undefined;\n  }\n  async function queryImpl(request, location, matches, requestContext, dataStrategy, skipLoaderErrorBubbling, routeMatch) {\n    invariant(request.signal, \"query()/queryRoute() requests must contain an AbortController signal\");\n    try {\n      if (isMutationMethod(request.method.toLowerCase())) {\n        let result = await submit(request, matches, routeMatch || getTargetMatch(matches, location), requestContext, dataStrategy, skipLoaderErrorBubbling, routeMatch != null);\n        return result;\n      }\n      let result = await loadRouteData(request, matches, requestContext, dataStrategy, skipLoaderErrorBubbling, routeMatch);\n      return isResponse(result) ? result : _extends({}, result, {\n        actionData: null,\n        actionHeaders: {}\n      });\n    } catch (e) {\n      // If the user threw/returned a Response in callLoaderOrAction for a\n      // `queryRoute` call, we throw the `DataStrategyResult` to bail out early\n      // and then return or throw the raw Response here accordingly\n      if (isDataStrategyResult(e) && isResponse(e.result)) {\n        if (e.type === ResultType.error) {\n          throw e.result;\n        }\n        return e.result;\n      }\n      // Redirects are always returned since they don't propagate to catch\n      // boundaries\n      if (isRedirectResponse(e)) {\n        return e;\n      }\n      throw e;\n    }\n  }\n  async function submit(request, matches, actionMatch, requestContext, dataStrategy, skipLoaderErrorBubbling, isRouteRequest) {\n    let result;\n    if (!actionMatch.route.action && !actionMatch.route.lazy) {\n      let error = getInternalRouterError(405, {\n        method: request.method,\n        pathname: new URL(request.url).pathname,\n        routeId: actionMatch.route.id\n      });\n      if (isRouteRequest) {\n        throw error;\n      }\n      result = {\n        type: ResultType.error,\n        error\n      };\n    } else {\n      let results = await callDataStrategy(\"action\", request, [actionMatch], matches, isRouteRequest, requestContext, dataStrategy);\n      result = results[actionMatch.route.id];\n      if (request.signal.aborted) {\n        throwStaticHandlerAbortedError(request, isRouteRequest, future);\n      }\n    }\n    if (isRedirectResult(result)) {\n      // Uhhhh - this should never happen, we should always throw these from\n      // callLoaderOrAction, but the type narrowing here keeps TS happy and we\n      // can get back on the \"throw all redirect responses\" train here should\n      // this ever happen :/\n      throw new Response(null, {\n        status: result.response.status,\n        headers: {\n          Location: result.response.headers.get(\"Location\")\n        }\n      });\n    }\n    if (isDeferredResult(result)) {\n      let error = getInternalRouterError(400, {\n        type: \"defer-action\"\n      });\n      if (isRouteRequest) {\n        throw error;\n      }\n      result = {\n        type: ResultType.error,\n        error\n      };\n    }\n    if (isRouteRequest) {\n      // Note: This should only be non-Response values if we get here, since\n      // isRouteRequest should throw any Response received in callLoaderOrAction\n      if (isErrorResult(result)) {\n        throw result.error;\n      }\n      return {\n        matches: [actionMatch],\n        loaderData: {},\n        actionData: {\n          [actionMatch.route.id]: result.data\n        },\n        errors: null,\n        // Note: statusCode + headers are unused here since queryRoute will\n        // return the raw Response or value\n        statusCode: 200,\n        loaderHeaders: {},\n        actionHeaders: {},\n        activeDeferreds: null\n      };\n    }\n    // Create a GET request for the loaders\n    let loaderRequest = new Request(request.url, {\n      headers: request.headers,\n      redirect: request.redirect,\n      signal: request.signal\n    });\n    if (isErrorResult(result)) {\n      // Store off the pending error - we use it to determine which loaders\n      // to call and will commit it when we complete the navigation\n      let boundaryMatch = skipLoaderErrorBubbling ? actionMatch : findNearestBoundary(matches, actionMatch.route.id);\n      let context = await loadRouteData(loaderRequest, matches, requestContext, dataStrategy, skipLoaderErrorBubbling, null, [boundaryMatch.route.id, result]);\n      // action status codes take precedence over loader status codes\n      return _extends({}, context, {\n        statusCode: isRouteErrorResponse(result.error) ? result.error.status : result.statusCode != null ? result.statusCode : 500,\n        actionData: null,\n        actionHeaders: _extends({}, result.headers ? {\n          [actionMatch.route.id]: result.headers\n        } : {})\n      });\n    }\n    let context = await loadRouteData(loaderRequest, matches, requestContext, dataStrategy, skipLoaderErrorBubbling, null);\n    return _extends({}, context, {\n      actionData: {\n        [actionMatch.route.id]: result.data\n      }\n    }, result.statusCode ? {\n      statusCode: result.statusCode\n    } : {}, {\n      actionHeaders: result.headers ? {\n        [actionMatch.route.id]: result.headers\n      } : {}\n    });\n  }\n  async function loadRouteData(request, matches, requestContext, dataStrategy, skipLoaderErrorBubbling, routeMatch, pendingActionResult) {\n    let isRouteRequest = routeMatch != null;\n    // Short circuit if we have no loaders to run (queryRoute())\n    if (isRouteRequest && !(routeMatch != null && routeMatch.route.loader) && !(routeMatch != null && routeMatch.route.lazy)) {\n      throw getInternalRouterError(400, {\n        method: request.method,\n        pathname: new URL(request.url).pathname,\n        routeId: routeMatch == null ? void 0 : routeMatch.route.id\n      });\n    }\n    let requestMatches = routeMatch ? [routeMatch] : pendingActionResult && isErrorResult(pendingActionResult[1]) ? getLoaderMatchesUntilBoundary(matches, pendingActionResult[0]) : matches;\n    let matchesToLoad = requestMatches.filter(m => m.route.loader || m.route.lazy);\n    // Short circuit if we have no loaders to run (query())\n    if (matchesToLoad.length === 0) {\n      return {\n        matches,\n        // Add a null for all matched routes for proper revalidation on the client\n        loaderData: matches.reduce((acc, m) => Object.assign(acc, {\n          [m.route.id]: null\n        }), {}),\n        errors: pendingActionResult && isErrorResult(pendingActionResult[1]) ? {\n          [pendingActionResult[0]]: pendingActionResult[1].error\n        } : null,\n        statusCode: 200,\n        loaderHeaders: {},\n        activeDeferreds: null\n      };\n    }\n    let results = await callDataStrategy(\"loader\", request, matchesToLoad, matches, isRouteRequest, requestContext, dataStrategy);\n    if (request.signal.aborted) {\n      throwStaticHandlerAbortedError(request, isRouteRequest, future);\n    }\n    // Process and commit output from loaders\n    let activeDeferreds = new Map();\n    let context = processRouteLoaderData(matches, results, pendingActionResult, activeDeferreds, skipLoaderErrorBubbling);\n    // Add a null for any non-loader matches for proper revalidation on the client\n    let executedLoaders = new Set(matchesToLoad.map(match => match.route.id));\n    matches.forEach(match => {\n      if (!executedLoaders.has(match.route.id)) {\n        context.loaderData[match.route.id] = null;\n      }\n    });\n    return _extends({}, context, {\n      matches,\n      activeDeferreds: activeDeferreds.size > 0 ? Object.fromEntries(activeDeferreds.entries()) : null\n    });\n  }\n  // Utility wrapper for calling dataStrategy server-side without having to\n  // pass around the manifest, mapRouteProperties, etc.\n  async function callDataStrategy(type, request, matchesToLoad, matches, isRouteRequest, requestContext, dataStrategy) {\n    let results = await callDataStrategyImpl(dataStrategy || defaultDataStrategy, type, null, request, matchesToLoad, matches, null, manifest, mapRouteProperties, requestContext);\n    let dataResults = {};\n    await Promise.all(matches.map(async match => {\n      if (!(match.route.id in results)) {\n        return;\n      }\n      let result = results[match.route.id];\n      if (isRedirectDataStrategyResultResult(result)) {\n        let response = result.result;\n        // Throw redirects and let the server handle them with an HTTP redirect\n        throw normalizeRelativeRoutingRedirectResponse(response, request, match.route.id, matches, basename, future.v7_relativeSplatPath);\n      }\n      if (isResponse(result.result) && isRouteRequest) {\n        // For SSR single-route requests, we want to hand Responses back\n        // directly without unwrapping\n        throw result;\n      }\n      dataResults[match.route.id] = await convertDataStrategyResultToDataResult(result);\n    }));\n    return dataResults;\n  }\n  return {\n    dataRoutes,\n    query,\n    queryRoute\n  };\n}\n//#endregion\n////////////////////////////////////////////////////////////////////////////////\n//#region Helpers\n////////////////////////////////////////////////////////////////////////////////\n/**\n * Given an existing StaticHandlerContext and an error thrown at render time,\n * provide an updated StaticHandlerContext suitable for a second SSR render\n */\nfunction getStaticContextFromError(routes, context, error) {\n  let newContext = _extends({}, context, {\n    statusCode: isRouteErrorResponse(error) ? error.status : 500,\n    errors: {\n      [context._deepestRenderedBoundaryId || routes[0].id]: error\n    }\n  });\n  return newContext;\n}\nfunction throwStaticHandlerAbortedError(request, isRouteRequest, future) {\n  if (future.v7_throwAbortReason && request.signal.reason !== undefined) {\n    throw request.signal.reason;\n  }\n  let method = isRouteRequest ? \"queryRoute\" : \"query\";\n  throw new Error(method + \"() call aborted: \" + request.method + \" \" + request.url);\n}\nfunction isSubmissionNavigation(opts) {\n  return opts != null && (\"formData\" in opts && opts.formData != null || \"body\" in opts && opts.body !== undefined);\n}\nfunction normalizeTo(location, matches, basename, prependBasename, to, v7_relativeSplatPath, fromRouteId, relative) {\n  let contextualMatches;\n  let activeRouteMatch;\n  if (fromRouteId) {\n    // Grab matches up to the calling route so our route-relative logic is\n    // relative to the correct source route\n    contextualMatches = [];\n    for (let match of matches) {\n      contextualMatches.push(match);\n      if (match.route.id === fromRouteId) {\n        activeRouteMatch = match;\n        break;\n      }\n    }\n  } else {\n    contextualMatches = matches;\n    activeRouteMatch = matches[matches.length - 1];\n  }\n  // Resolve the relative path\n  let path = resolveTo(to ? to : \".\", getResolveToMatches(contextualMatches, v7_relativeSplatPath), stripBasename(location.pathname, basename) || location.pathname, relative === \"path\");\n  // When `to` is not specified we inherit search/hash from the current\n  // location, unlike when to=\".\" and we just inherit the path.\n  // See https://github.com/remix-run/remix/issues/927\n  if (to == null) {\n    path.search = location.search;\n    path.hash = location.hash;\n  }\n  // Account for `?index` params when routing to the current location\n  if ((to == null || to === \"\" || to === \".\") && activeRouteMatch) {\n    let nakedIndex = hasNakedIndexQuery(path.search);\n    if (activeRouteMatch.route.index && !nakedIndex) {\n      // Add one when we're targeting an index route\n      path.search = path.search ? path.search.replace(/^\\?/, \"?index&\") : \"?index\";\n    } else if (!activeRouteMatch.route.index && nakedIndex) {\n      // Remove existing ones when we're not\n      let params = new URLSearchParams(path.search);\n      let indexValues = params.getAll(\"index\");\n      params.delete(\"index\");\n      indexValues.filter(v => v).forEach(v => params.append(\"index\", v));\n      let qs = params.toString();\n      path.search = qs ? \"?\" + qs : \"\";\n    }\n  }\n  // If we're operating within a basename, prepend it to the pathname.  If\n  // this is a root navigation, then just use the raw basename which allows\n  // the basename to have full control over the presence of a trailing slash\n  // on root actions\n  if (prependBasename && basename !== \"/\") {\n    path.pathname = path.pathname === \"/\" ? basename : joinPaths([basename, path.pathname]);\n  }\n  return createPath(path);\n}\n// Normalize navigation options by converting formMethod=GET formData objects to\n// URLSearchParams so they behave identically to links with query params\nfunction normalizeNavigateOptions(normalizeFormMethod, isFetcher, path, opts) {\n  // Return location verbatim on non-submission navigations\n  if (!opts || !isSubmissionNavigation(opts)) {\n    return {\n      path\n    };\n  }\n  if (opts.formMethod && !isValidMethod(opts.formMethod)) {\n    return {\n      path,\n      error: getInternalRouterError(405, {\n        method: opts.formMethod\n      })\n    };\n  }\n  let getInvalidBodyError = () => ({\n    path,\n    error: getInternalRouterError(400, {\n      type: \"invalid-body\"\n    })\n  });\n  // Create a Submission on non-GET navigations\n  let rawFormMethod = opts.formMethod || \"get\";\n  let formMethod = normalizeFormMethod ? rawFormMethod.toUpperCase() : rawFormMethod.toLowerCase();\n  let formAction = stripHashFromPath(path);\n  if (opts.body !== undefined) {\n    if (opts.formEncType === \"text/plain\") {\n      // text only support POST/PUT/PATCH/DELETE submissions\n      if (!isMutationMethod(formMethod)) {\n        return getInvalidBodyError();\n      }\n      let text = typeof opts.body === \"string\" ? opts.body : opts.body instanceof FormData || opts.body instanceof URLSearchParams ?\n      // https://html.spec.whatwg.org/multipage/form-control-infrastructure.html#plain-text-form-data\n      Array.from(opts.body.entries()).reduce((acc, _ref3) => {\n        let [name, value] = _ref3;\n        return \"\" + acc + name + \"=\" + value + \"\\n\";\n      }, \"\") : String(opts.body);\n      return {\n        path,\n        submission: {\n          formMethod,\n          formAction,\n          formEncType: opts.formEncType,\n          formData: undefined,\n          json: undefined,\n          text\n        }\n      };\n    } else if (opts.formEncType === \"application/json\") {\n      // json only supports POST/PUT/PATCH/DELETE submissions\n      if (!isMutationMethod(formMethod)) {\n        return getInvalidBodyError();\n      }\n      try {\n        let json = typeof opts.body === \"string\" ? JSON.parse(opts.body) : opts.body;\n        return {\n          path,\n          submission: {\n            formMethod,\n            formAction,\n            formEncType: opts.formEncType,\n            formData: undefined,\n            json,\n            text: undefined\n          }\n        };\n      } catch (e) {\n        return getInvalidBodyError();\n      }\n    }\n  }\n  invariant(typeof FormData === \"function\", \"FormData is not available in this environment\");\n  let searchParams;\n  let formData;\n  if (opts.formData) {\n    searchParams = convertFormDataToSearchParams(opts.formData);\n    formData = opts.formData;\n  } else if (opts.body instanceof FormData) {\n    searchParams = convertFormDataToSearchParams(opts.body);\n    formData = opts.body;\n  } else if (opts.body instanceof URLSearchParams) {\n    searchParams = opts.body;\n    formData = convertSearchParamsToFormData(searchParams);\n  } else if (opts.body == null) {\n    searchParams = new URLSearchParams();\n    formData = new FormData();\n  } else {\n    try {\n      searchParams = new URLSearchParams(opts.body);\n      formData = convertSearchParamsToFormData(searchParams);\n    } catch (e) {\n      return getInvalidBodyError();\n    }\n  }\n  let submission = {\n    formMethod,\n    formAction,\n    formEncType: opts && opts.formEncType || \"application/x-www-form-urlencoded\",\n    formData,\n    json: undefined,\n    text: undefined\n  };\n  if (isMutationMethod(submission.formMethod)) {\n    return {\n      path,\n      submission\n    };\n  }\n  // Flatten submission onto URLSearchParams for GET submissions\n  let parsedPath = parsePath(path);\n  // On GET navigation submissions we can drop the ?index param from the\n  // resulting location since all loaders will run.  But fetcher GET submissions\n  // only run a single loader so we need to preserve any incoming ?index params\n  if (isFetcher && parsedPath.search && hasNakedIndexQuery(parsedPath.search)) {\n    searchParams.append(\"index\", \"\");\n  }\n  parsedPath.search = \"?\" + searchParams;\n  return {\n    path: createPath(parsedPath),\n    submission\n  };\n}\n// Filter out all routes at/below any caught error as they aren't going to\n// render so we don't need to load them\nfunction getLoaderMatchesUntilBoundary(matches, boundaryId, includeBoundary) {\n  if (includeBoundary === void 0) {\n    includeBoundary = false;\n  }\n  let index = matches.findIndex(m => m.route.id === boundaryId);\n  if (index >= 0) {\n    return matches.slice(0, includeBoundary ? index + 1 : index);\n  }\n  return matches;\n}\nfunction getMatchesToLoad(history, state, matches, submission, location, initialHydration, skipActionErrorRevalidation, isRevalidationRequired, cancelledDeferredRoutes, cancelledFetcherLoads, deletedFetchers, fetchLoadMatches, fetchRedirectIds, routesToUse, basename, pendingActionResult) {\n  let actionResult = pendingActionResult ? isErrorResult(pendingActionResult[1]) ? pendingActionResult[1].error : pendingActionResult[1].data : undefined;\n  let currentUrl = history.createURL(state.location);\n  let nextUrl = history.createURL(location);\n  // Pick navigation matches that are net-new or qualify for revalidation\n  let boundaryMatches = matches;\n  if (initialHydration && state.errors) {\n    // On initial hydration, only consider matches up to _and including_ the boundary.\n    // This is inclusive to handle cases where a server loader ran successfully,\n    // a child server loader bubbled up to this route, but this route has\n    // `clientLoader.hydrate` so we want to still run the `clientLoader` so that\n    // we have a complete version of `loaderData`\n    boundaryMatches = getLoaderMatchesUntilBoundary(matches, Object.keys(state.errors)[0], true);\n  } else if (pendingActionResult && isErrorResult(pendingActionResult[1])) {\n    // If an action threw an error, we call loaders up to, but not including the\n    // boundary\n    boundaryMatches = getLoaderMatchesUntilBoundary(matches, pendingActionResult[0]);\n  }\n  // Don't revalidate loaders by default after action 4xx/5xx responses\n  // when the flag is enabled.  They can still opt-into revalidation via\n  // `shouldRevalidate` via `actionResult`\n  let actionStatus = pendingActionResult ? pendingActionResult[1].statusCode : undefined;\n  let shouldSkipRevalidation = skipActionErrorRevalidation && actionStatus && actionStatus >= 400;\n  let navigationMatches = boundaryMatches.filter((match, index) => {\n    let {\n      route\n    } = match;\n    if (route.lazy) {\n      // We haven't loaded this route yet so we don't know if it's got a loader!\n      return true;\n    }\n    if (route.loader == null) {\n      return false;\n    }\n    if (initialHydration) {\n      return shouldLoadRouteOnHydration(route, state.loaderData, state.errors);\n    }\n    // Always call the loader on new route instances and pending defer cancellations\n    if (isNewLoader(state.loaderData, state.matches[index], match) || cancelledDeferredRoutes.some(id => id === match.route.id)) {\n      return true;\n    }\n    // This is the default implementation for when we revalidate.  If the route\n    // provides it's own implementation, then we give them full control but\n    // provide this value so they can leverage it if needed after they check\n    // their own specific use cases\n    let currentRouteMatch = state.matches[index];\n    let nextRouteMatch = match;\n    return shouldRevalidateLoader(match, _extends({\n      currentUrl,\n      currentParams: currentRouteMatch.params,\n      nextUrl,\n      nextParams: nextRouteMatch.params\n    }, submission, {\n      actionResult,\n      actionStatus,\n      defaultShouldRevalidate: shouldSkipRevalidation ? false :\n      // Forced revalidation due to submission, useRevalidator, or X-Remix-Revalidate\n      isRevalidationRequired || currentUrl.pathname + currentUrl.search === nextUrl.pathname + nextUrl.search ||\n      // Search params affect all loaders\n      currentUrl.search !== nextUrl.search || isNewRouteInstance(currentRouteMatch, nextRouteMatch)\n    }));\n  });\n  // Pick fetcher.loads that need to be revalidated\n  let revalidatingFetchers = [];\n  fetchLoadMatches.forEach((f, key) => {\n    // Don't revalidate:\n    //  - on initial hydration (shouldn't be any fetchers then anyway)\n    //  - if fetcher won't be present in the subsequent render\n    //    - no longer matches the URL (v7_fetcherPersist=false)\n    //    - was unmounted but persisted due to v7_fetcherPersist=true\n    if (initialHydration || !matches.some(m => m.route.id === f.routeId) || deletedFetchers.has(key)) {\n      return;\n    }\n    let fetcherMatches = matchRoutes(routesToUse, f.path, basename);\n    // If the fetcher path no longer matches, push it in with null matches so\n    // we can trigger a 404 in callLoadersAndMaybeResolveData.  Note this is\n    // currently only a use-case for Remix HMR where the route tree can change\n    // at runtime and remove a route previously loaded via a fetcher\n    if (!fetcherMatches) {\n      revalidatingFetchers.push({\n        key,\n        routeId: f.routeId,\n        path: f.path,\n        matches: null,\n        match: null,\n        controller: null\n      });\n      return;\n    }\n    // Revalidating fetchers are decoupled from the route matches since they\n    // load from a static href.  They revalidate based on explicit revalidation\n    // (submission, useRevalidator, or X-Remix-Revalidate)\n    let fetcher = state.fetchers.get(key);\n    let fetcherMatch = getTargetMatch(fetcherMatches, f.path);\n    let shouldRevalidate = false;\n    if (fetchRedirectIds.has(key)) {\n      // Never trigger a revalidation of an actively redirecting fetcher\n      shouldRevalidate = false;\n    } else if (cancelledFetcherLoads.has(key)) {\n      // Always mark for revalidation if the fetcher was cancelled\n      cancelledFetcherLoads.delete(key);\n      shouldRevalidate = true;\n    } else if (fetcher && fetcher.state !== \"idle\" && fetcher.data === undefined) {\n      // If the fetcher hasn't ever completed loading yet, then this isn't a\n      // revalidation, it would just be a brand new load if an explicit\n      // revalidation is required\n      shouldRevalidate = isRevalidationRequired;\n    } else {\n      // Otherwise fall back on any user-defined shouldRevalidate, defaulting\n      // to explicit revalidations only\n      shouldRevalidate = shouldRevalidateLoader(fetcherMatch, _extends({\n        currentUrl,\n        currentParams: state.matches[state.matches.length - 1].params,\n        nextUrl,\n        nextParams: matches[matches.length - 1].params\n      }, submission, {\n        actionResult,\n        actionStatus,\n        defaultShouldRevalidate: shouldSkipRevalidation ? false : isRevalidationRequired\n      }));\n    }\n    if (shouldRevalidate) {\n      revalidatingFetchers.push({\n        key,\n        routeId: f.routeId,\n        path: f.path,\n        matches: fetcherMatches,\n        match: fetcherMatch,\n        controller: new AbortController()\n      });\n    }\n  });\n  return [navigationMatches, revalidatingFetchers];\n}\nfunction shouldLoadRouteOnHydration(route, loaderData, errors) {\n  // We dunno if we have a loader - gotta find out!\n  if (route.lazy) {\n    return true;\n  }\n  // No loader, nothing to initialize\n  if (!route.loader) {\n    return false;\n  }\n  let hasData = loaderData != null && loaderData[route.id] !== undefined;\n  let hasError = errors != null && errors[route.id] !== undefined;\n  // Don't run if we error'd during SSR\n  if (!hasData && hasError) {\n    return false;\n  }\n  // Explicitly opting-in to running on hydration\n  if (typeof route.loader === \"function\" && route.loader.hydrate === true) {\n    return true;\n  }\n  // Otherwise, run if we're not yet initialized with anything\n  return !hasData && !hasError;\n}\nfunction isNewLoader(currentLoaderData, currentMatch, match) {\n  let isNew =\n  // [a] -> [a, b]\n  !currentMatch ||\n  // [a, b] -> [a, c]\n  match.route.id !== currentMatch.route.id;\n  // Handle the case that we don't have data for a re-used route, potentially\n  // from a prior error or from a cancelled pending deferred\n  let isMissingData = currentLoaderData[match.route.id] === undefined;\n  // Always load if this is a net-new route or we don't yet have data\n  return isNew || isMissingData;\n}\nfunction isNewRouteInstance(currentMatch, match) {\n  let currentPath = currentMatch.route.path;\n  return (\n    // param change for this match, /users/123 -> /users/456\n    currentMatch.pathname !== match.pathname ||\n    // splat param changed, which is not present in match.path\n    // e.g. /files/images/avatar.jpg -> files/finances.xls\n    currentPath != null && currentPath.endsWith(\"*\") && currentMatch.params[\"*\"] !== match.params[\"*\"]\n  );\n}\nfunction shouldRevalidateLoader(loaderMatch, arg) {\n  if (loaderMatch.route.shouldRevalidate) {\n    let routeChoice = loaderMatch.route.shouldRevalidate(arg);\n    if (typeof routeChoice === \"boolean\") {\n      return routeChoice;\n    }\n  }\n  return arg.defaultShouldRevalidate;\n}\nfunction patchRoutesImpl(routeId, children, routesToUse, manifest, mapRouteProperties) {\n  var _childrenToPatch;\n  let childrenToPatch;\n  if (routeId) {\n    let route = manifest[routeId];\n    invariant(route, \"No route found to patch children into: routeId = \" + routeId);\n    if (!route.children) {\n      route.children = [];\n    }\n    childrenToPatch = route.children;\n  } else {\n    childrenToPatch = routesToUse;\n  }\n  // Don't patch in routes we already know about so that `patch` is idempotent\n  // to simplify user-land code. This is useful because we re-call the\n  // `patchRoutesOnNavigation` function for matched routes with params.\n  let uniqueChildren = children.filter(newRoute => !childrenToPatch.some(existingRoute => isSameRoute(newRoute, existingRoute)));\n  let newRoutes = convertRoutesToDataRoutes(uniqueChildren, mapRouteProperties, [routeId || \"_\", \"patch\", String(((_childrenToPatch = childrenToPatch) == null ? void 0 : _childrenToPatch.length) || \"0\")], manifest);\n  childrenToPatch.push(...newRoutes);\n}\nfunction isSameRoute(newRoute, existingRoute) {\n  // Most optimal check is by id\n  if (\"id\" in newRoute && \"id\" in existingRoute && newRoute.id === existingRoute.id) {\n    return true;\n  }\n  // Second is by pathing differences\n  if (!(newRoute.index === existingRoute.index && newRoute.path === existingRoute.path && newRoute.caseSensitive === existingRoute.caseSensitive)) {\n    return false;\n  }\n  // Pathless layout routes are trickier since we need to check children.\n  // If they have no children then they're the same as far as we can tell\n  if ((!newRoute.children || newRoute.children.length === 0) && (!existingRoute.children || existingRoute.children.length === 0)) {\n    return true;\n  }\n  // Otherwise, we look to see if every child in the new route is already\n  // represented in the existing route's children\n  return newRoute.children.every((aChild, i) => {\n    var _existingRoute$childr;\n    return (_existingRoute$childr = existingRoute.children) == null ? void 0 : _existingRoute$childr.some(bChild => isSameRoute(aChild, bChild));\n  });\n}\n/**\n * Execute route.lazy() methods to lazily load route modules (loader, action,\n * shouldRevalidate) and update the routeManifest in place which shares objects\n * with dataRoutes so those get updated as well.\n */\nasync function loadLazyRouteModule(route, mapRouteProperties, manifest) {\n  if (!route.lazy) {\n    return;\n  }\n  let lazyRoute = await route.lazy();\n  // If the lazy route function was executed and removed by another parallel\n  // call then we can return - first lazy() to finish wins because the return\n  // value of lazy is expected to be static\n  if (!route.lazy) {\n    return;\n  }\n  let routeToUpdate = manifest[route.id];\n  invariant(routeToUpdate, \"No route found in manifest\");\n  // Update the route in place.  This should be safe because there's no way\n  // we could yet be sitting on this route as we can't get there without\n  // resolving lazy() first.\n  //\n  // This is different than the HMR \"update\" use-case where we may actively be\n  // on the route being updated.  The main concern boils down to \"does this\n  // mutation affect any ongoing navigations or any current state.matches\n  // values?\".  If not, it should be safe to update in place.\n  let routeUpdates = {};\n  for (let lazyRouteProperty in lazyRoute) {\n    let staticRouteValue = routeToUpdate[lazyRouteProperty];\n    let isPropertyStaticallyDefined = staticRouteValue !== undefined &&\n    // This property isn't static since it should always be updated based\n    // on the route updates\n    lazyRouteProperty !== \"hasErrorBoundary\";\n    warning(!isPropertyStaticallyDefined, \"Route \\\"\" + routeToUpdate.id + \"\\\" has a static property \\\"\" + lazyRouteProperty + \"\\\" \" + \"defined but its lazy function is also returning a value for this property. \" + (\"The lazy route property \\\"\" + lazyRouteProperty + \"\\\" will be ignored.\"));\n    if (!isPropertyStaticallyDefined && !immutableRouteKeys.has(lazyRouteProperty)) {\n      routeUpdates[lazyRouteProperty] = lazyRoute[lazyRouteProperty];\n    }\n  }\n  // Mutate the route with the provided updates.  Do this first so we pass\n  // the updated version to mapRouteProperties\n  Object.assign(routeToUpdate, routeUpdates);\n  // Mutate the `hasErrorBoundary` property on the route based on the route\n  // updates and remove the `lazy` function so we don't resolve the lazy\n  // route again.\n  Object.assign(routeToUpdate, _extends({}, mapRouteProperties(routeToUpdate), {\n    lazy: undefined\n  }));\n}\n// Default implementation of `dataStrategy` which fetches all loaders in parallel\nasync function defaultDataStrategy(_ref4) {\n  let {\n    matches\n  } = _ref4;\n  let matchesToLoad = matches.filter(m => m.shouldLoad);\n  let results = await Promise.all(matchesToLoad.map(m => m.resolve()));\n  return results.reduce((acc, result, i) => Object.assign(acc, {\n    [matchesToLoad[i].route.id]: result\n  }), {});\n}\nasync function callDataStrategyImpl(dataStrategyImpl, type, state, request, matchesToLoad, matches, fetcherKey, manifest, mapRouteProperties, requestContext) {\n  let loadRouteDefinitionsPromises = matches.map(m => m.route.lazy ? loadLazyRouteModule(m.route, mapRouteProperties, manifest) : undefined);\n  let dsMatches = matches.map((match, i) => {\n    let loadRoutePromise = loadRouteDefinitionsPromises[i];\n    let shouldLoad = matchesToLoad.some(m => m.route.id === match.route.id);\n    // `resolve` encapsulates route.lazy(), executing the loader/action,\n    // and mapping return values/thrown errors to a `DataStrategyResult`.  Users\n    // can pass a callback to take fine-grained control over the execution\n    // of the loader/action\n    let resolve = async handlerOverride => {\n      if (handlerOverride && request.method === \"GET\" && (match.route.lazy || match.route.loader)) {\n        shouldLoad = true;\n      }\n      return shouldLoad ? callLoaderOrAction(type, request, match, loadRoutePromise, handlerOverride, requestContext) : Promise.resolve({\n        type: ResultType.data,\n        result: undefined\n      });\n    };\n    return _extends({}, match, {\n      shouldLoad,\n      resolve\n    });\n  });\n  // Send all matches here to allow for a middleware-type implementation.\n  // handler will be a no-op for unneeded routes and we filter those results\n  // back out below.\n  let results = await dataStrategyImpl({\n    matches: dsMatches,\n    request,\n    params: matches[0].params,\n    fetcherKey,\n    context: requestContext\n  });\n  // Wait for all routes to load here but 'swallow the error since we want\n  // it to bubble up from the `await loadRoutePromise` in `callLoaderOrAction` -\n  // called from `match.resolve()`\n  try {\n    await Promise.all(loadRouteDefinitionsPromises);\n  } catch (e) {\n    // No-op\n  }\n  return results;\n}\n// Default logic for calling a loader/action is the user has no specified a dataStrategy\nasync function callLoaderOrAction(type, request, match, loadRoutePromise, handlerOverride, staticContext) {\n  let result;\n  let onReject;\n  let runHandler = handler => {\n    // Setup a promise we can race against so that abort signals short circuit\n    let reject;\n    // This will never resolve so safe to type it as Promise<DataStrategyResult> to\n    // satisfy the function return value\n    let abortPromise = new Promise((_, r) => reject = r);\n    onReject = () => reject();\n    request.signal.addEventListener(\"abort\", onReject);\n    let actualHandler = ctx => {\n      if (typeof handler !== \"function\") {\n        return Promise.reject(new Error(\"You cannot call the handler for a route which defines a boolean \" + (\"\\\"\" + type + \"\\\" [routeId: \" + match.route.id + \"]\")));\n      }\n      return handler({\n        request,\n        params: match.params,\n        context: staticContext\n      }, ...(ctx !== undefined ? [ctx] : []));\n    };\n    let handlerPromise = (async () => {\n      try {\n        let val = await (handlerOverride ? handlerOverride(ctx => actualHandler(ctx)) : actualHandler());\n        return {\n          type: \"data\",\n          result: val\n        };\n      } catch (e) {\n        return {\n          type: \"error\",\n          result: e\n        };\n      }\n    })();\n    return Promise.race([handlerPromise, abortPromise]);\n  };\n  try {\n    let handler = match.route[type];\n    // If we have a route.lazy promise, await that first\n    if (loadRoutePromise) {\n      if (handler) {\n        // Run statically defined handler in parallel with lazy()\n        let handlerError;\n        let [value] = await Promise.all([\n        // If the handler throws, don't let it immediately bubble out,\n        // since we need to let the lazy() execution finish so we know if this\n        // route has a boundary that can handle the error\n        runHandler(handler).catch(e => {\n          handlerError = e;\n        }), loadRoutePromise]);\n        if (handlerError !== undefined) {\n          throw handlerError;\n        }\n        result = value;\n      } else {\n        // Load lazy route module, then run any returned handler\n        await loadRoutePromise;\n        handler = match.route[type];\n        if (handler) {\n          // Handler still runs even if we got interrupted to maintain consistency\n          // with un-abortable behavior of handler execution on non-lazy or\n          // previously-lazy-loaded routes\n          result = await runHandler(handler);\n        } else if (type === \"action\") {\n          let url = new URL(request.url);\n          let pathname = url.pathname + url.search;\n          throw getInternalRouterError(405, {\n            method: request.method,\n            pathname,\n            routeId: match.route.id\n          });\n        } else {\n          // lazy() route has no loader to run.  Short circuit here so we don't\n          // hit the invariant below that errors on returning undefined.\n          return {\n            type: ResultType.data,\n            result: undefined\n          };\n        }\n      }\n    } else if (!handler) {\n      let url = new URL(request.url);\n      let pathname = url.pathname + url.search;\n      throw getInternalRouterError(404, {\n        pathname\n      });\n    } else {\n      result = await runHandler(handler);\n    }\n    invariant(result.result !== undefined, \"You defined \" + (type === \"action\" ? \"an action\" : \"a loader\") + \" for route \" + (\"\\\"\" + match.route.id + \"\\\" but didn't return anything from your `\" + type + \"` \") + \"function. Please return a value or `null`.\");\n  } catch (e) {\n    // We should already be catching and converting normal handler executions to\n    // DataStrategyResults and returning them, so anything that throws here is an\n    // unexpected error we still need to wrap\n    return {\n      type: ResultType.error,\n      result: e\n    };\n  } finally {\n    if (onReject) {\n      request.signal.removeEventListener(\"abort\", onReject);\n    }\n  }\n  return result;\n}\nasync function convertDataStrategyResultToDataResult(dataStrategyResult) {\n  let {\n    result,\n    type\n  } = dataStrategyResult;\n  if (isResponse(result)) {\n    let data;\n    try {\n      let contentType = result.headers.get(\"Content-Type\");\n      // Check between word boundaries instead of startsWith() due to the last\n      // paragraph of https://httpwg.org/specs/rfc9110.html#field.content-type\n      if (contentType && /\\bapplication\\/json\\b/.test(contentType)) {\n        if (result.body == null) {\n          data = null;\n        } else {\n          data = await result.json();\n        }\n      } else {\n        data = await result.text();\n      }\n    } catch (e) {\n      return {\n        type: ResultType.error,\n        error: e\n      };\n    }\n    if (type === ResultType.error) {\n      return {\n        type: ResultType.error,\n        error: new ErrorResponseImpl(result.status, result.statusText, data),\n        statusCode: result.status,\n        headers: result.headers\n      };\n    }\n    return {\n      type: ResultType.data,\n      data,\n      statusCode: result.status,\n      headers: result.headers\n    };\n  }\n  if (type === ResultType.error) {\n    if (isDataWithResponseInit(result)) {\n      var _result$init3, _result$init4;\n      if (result.data instanceof Error) {\n        var _result$init, _result$init2;\n        return {\n          type: ResultType.error,\n          error: result.data,\n          statusCode: (_result$init = result.init) == null ? void 0 : _result$init.status,\n          headers: (_result$init2 = result.init) != null && _result$init2.headers ? new Headers(result.init.headers) : undefined\n        };\n      }\n      // Convert thrown data() to ErrorResponse instances\n      return {\n        type: ResultType.error,\n        error: new ErrorResponseImpl(((_result$init3 = result.init) == null ? void 0 : _result$init3.status) || 500, undefined, result.data),\n        statusCode: isRouteErrorResponse(result) ? result.status : undefined,\n        headers: (_result$init4 = result.init) != null && _result$init4.headers ? new Headers(result.init.headers) : undefined\n      };\n    }\n    return {\n      type: ResultType.error,\n      error: result,\n      statusCode: isRouteErrorResponse(result) ? result.status : undefined\n    };\n  }\n  if (isDeferredData(result)) {\n    var _result$init5, _result$init6;\n    return {\n      type: ResultType.deferred,\n      deferredData: result,\n      statusCode: (_result$init5 = result.init) == null ? void 0 : _result$init5.status,\n      headers: ((_result$init6 = result.init) == null ? void 0 : _result$init6.headers) && new Headers(result.init.headers)\n    };\n  }\n  if (isDataWithResponseInit(result)) {\n    var _result$init7, _result$init8;\n    return {\n      type: ResultType.data,\n      data: result.data,\n      statusCode: (_result$init7 = result.init) == null ? void 0 : _result$init7.status,\n      headers: (_result$init8 = result.init) != null && _result$init8.headers ? new Headers(result.init.headers) : undefined\n    };\n  }\n  return {\n    type: ResultType.data,\n    data: result\n  };\n}\n// Support relative routing in internal redirects\nfunction normalizeRelativeRoutingRedirectResponse(response, request, routeId, matches, basename, v7_relativeSplatPath) {\n  let location = response.headers.get(\"Location\");\n  invariant(location, \"Redirects returned/thrown from loaders/actions must have a Location header\");\n  if (!ABSOLUTE_URL_REGEX.test(location)) {\n    let trimmedMatches = matches.slice(0, matches.findIndex(m => m.route.id === routeId) + 1);\n    location = normalizeTo(new URL(request.url), trimmedMatches, basename, true, location, v7_relativeSplatPath);\n    response.headers.set(\"Location\", location);\n  }\n  return response;\n}\nfunction normalizeRedirectLocation(location, currentUrl, basename, historyInstance) {\n  // Match Chrome's behavior:\n  // https://github.com/chromium/chromium/blob/216dbeb61db0c667e62082e5f5400a32d6983df3/content/public/common/url_utils.cc#L82\n  let invalidProtocols = [\"about:\", \"blob:\", \"chrome:\", \"chrome-untrusted:\", \"content:\", \"data:\", \"devtools:\", \"file:\", \"filesystem:\",\n  // eslint-disable-next-line no-script-url\n  \"javascript:\"];\n  if (ABSOLUTE_URL_REGEX.test(location)) {\n    // Strip off the protocol+origin for same-origin + same-basename absolute redirects\n    let normalizedLocation = location;\n    let url = normalizedLocation.startsWith(\"//\") ? new URL(currentUrl.protocol + normalizedLocation) : new URL(normalizedLocation);\n    if (invalidProtocols.includes(url.protocol)) {\n      throw new Error(\"Invalid redirect location\");\n    }\n    let isSameBasename = stripBasename(url.pathname, basename) != null;\n    if (url.origin === currentUrl.origin && isSameBasename) {\n      return url.pathname + url.search + url.hash;\n    }\n  }\n  try {\n    let url = historyInstance.createURL(location);\n    if (invalidProtocols.includes(url.protocol)) {\n      throw new Error(\"Invalid redirect location\");\n    }\n  } catch (e) {}\n  return location;\n}\n// Utility method for creating the Request instances for loaders/actions during\n// client-side navigations and fetches.  During SSR we will always have a\n// Request instance from the static handler (query/queryRoute)\nfunction createClientSideRequest(history, location, signal, submission) {\n  let url = history.createURL(stripHashFromPath(location)).toString();\n  let init = {\n    signal\n  };\n  if (submission && isMutationMethod(submission.formMethod)) {\n    let {\n      formMethod,\n      formEncType\n    } = submission;\n    // Didn't think we needed this but it turns out unlike other methods, patch\n    // won't be properly normalized to uppercase and results in a 405 error.\n    // See: https://fetch.spec.whatwg.org/#concept-method\n    init.method = formMethod.toUpperCase();\n    if (formEncType === \"application/json\") {\n      init.headers = new Headers({\n        \"Content-Type\": formEncType\n      });\n      init.body = JSON.stringify(submission.json);\n    } else if (formEncType === \"text/plain\") {\n      // Content-Type is inferred (https://fetch.spec.whatwg.org/#dom-request)\n      init.body = submission.text;\n    } else if (formEncType === \"application/x-www-form-urlencoded\" && submission.formData) {\n      // Content-Type is inferred (https://fetch.spec.whatwg.org/#dom-request)\n      init.body = convertFormDataToSearchParams(submission.formData);\n    } else {\n      // Content-Type is inferred (https://fetch.spec.whatwg.org/#dom-request)\n      init.body = submission.formData;\n    }\n  }\n  return new Request(url, init);\n}\nfunction convertFormDataToSearchParams(formData) {\n  let searchParams = new URLSearchParams();\n  for (let [key, value] of formData.entries()) {\n    // https://html.spec.whatwg.org/multipage/form-control-infrastructure.html#converting-an-entry-list-to-a-list-of-name-value-pairs\n    searchParams.append(key, typeof value === \"string\" ? value : value.name);\n  }\n  return searchParams;\n}\nfunction convertSearchParamsToFormData(searchParams) {\n  let formData = new FormData();\n  for (let [key, value] of searchParams.entries()) {\n    formData.append(key, value);\n  }\n  return formData;\n}\nfunction processRouteLoaderData(matches, results, pendingActionResult, activeDeferreds, skipLoaderErrorBubbling) {\n  // Fill in loaderData/errors from our loaders\n  let loaderData = {};\n  let errors = null;\n  let statusCode;\n  let foundError = false;\n  let loaderHeaders = {};\n  let pendingError = pendingActionResult && isErrorResult(pendingActionResult[1]) ? pendingActionResult[1].error : undefined;\n  // Process loader results into state.loaderData/state.errors\n  matches.forEach(match => {\n    if (!(match.route.id in results)) {\n      return;\n    }\n    let id = match.route.id;\n    let result = results[id];\n    invariant(!isRedirectResult(result), \"Cannot handle redirect results in processLoaderData\");\n    if (isErrorResult(result)) {\n      let error = result.error;\n      // If we have a pending action error, we report it at the highest-route\n      // that throws a loader error, and then clear it out to indicate that\n      // it was consumed\n      if (pendingError !== undefined) {\n        error = pendingError;\n        pendingError = undefined;\n      }\n      errors = errors || {};\n      if (skipLoaderErrorBubbling) {\n        errors[id] = error;\n      } else {\n        // Look upwards from the matched route for the closest ancestor error\n        // boundary, defaulting to the root match.  Prefer higher error values\n        // if lower errors bubble to the same boundary\n        let boundaryMatch = findNearestBoundary(matches, id);\n        if (errors[boundaryMatch.route.id] == null) {\n          errors[boundaryMatch.route.id] = error;\n        }\n      }\n      // Clear our any prior loaderData for the throwing route\n      loaderData[id] = undefined;\n      // Once we find our first (highest) error, we set the status code and\n      // prevent deeper status codes from overriding\n      if (!foundError) {\n        foundError = true;\n        statusCode = isRouteErrorResponse(result.error) ? result.error.status : 500;\n      }\n      if (result.headers) {\n        loaderHeaders[id] = result.headers;\n      }\n    } else {\n      if (isDeferredResult(result)) {\n        activeDeferreds.set(id, result.deferredData);\n        loaderData[id] = result.deferredData.data;\n        // Error status codes always override success status codes, but if all\n        // loaders are successful we take the deepest status code.\n        if (result.statusCode != null && result.statusCode !== 200 && !foundError) {\n          statusCode = result.statusCode;\n        }\n        if (result.headers) {\n          loaderHeaders[id] = result.headers;\n        }\n      } else {\n        loaderData[id] = result.data;\n        // Error status codes always override success status codes, but if all\n        // loaders are successful we take the deepest status code.\n        if (result.statusCode && result.statusCode !== 200 && !foundError) {\n          statusCode = result.statusCode;\n        }\n        if (result.headers) {\n          loaderHeaders[id] = result.headers;\n        }\n      }\n    }\n  });\n  // If we didn't consume the pending action error (i.e., all loaders\n  // resolved), then consume it here.  Also clear out any loaderData for the\n  // throwing route\n  if (pendingError !== undefined && pendingActionResult) {\n    errors = {\n      [pendingActionResult[0]]: pendingError\n    };\n    loaderData[pendingActionResult[0]] = undefined;\n  }\n  return {\n    loaderData,\n    errors,\n    statusCode: statusCode || 200,\n    loaderHeaders\n  };\n}\nfunction processLoaderData(state, matches, results, pendingActionResult, revalidatingFetchers, fetcherResults, activeDeferreds) {\n  let {\n    loaderData,\n    errors\n  } = processRouteLoaderData(matches, results, pendingActionResult, activeDeferreds, false // This method is only called client side so we always want to bubble\n  );\n  // Process results from our revalidating fetchers\n  revalidatingFetchers.forEach(rf => {\n    let {\n      key,\n      match,\n      controller\n    } = rf;\n    let result = fetcherResults[key];\n    invariant(result, \"Did not find corresponding fetcher result\");\n    // Process fetcher non-redirect errors\n    if (controller && controller.signal.aborted) {\n      // Nothing to do for aborted fetchers\n      return;\n    } else if (isErrorResult(result)) {\n      let boundaryMatch = findNearestBoundary(state.matches, match == null ? void 0 : match.route.id);\n      if (!(errors && errors[boundaryMatch.route.id])) {\n        errors = _extends({}, errors, {\n          [boundaryMatch.route.id]: result.error\n        });\n      }\n      state.fetchers.delete(key);\n    } else if (isRedirectResult(result)) {\n      // Should never get here, redirects should get processed above, but we\n      // keep this to type narrow to a success result in the else\n      invariant(false, \"Unhandled fetcher revalidation redirect\");\n    } else if (isDeferredResult(result)) {\n      // Should never get here, deferred data should be awaited for fetchers\n      // in resolveDeferredResults\n      invariant(false, \"Unhandled fetcher deferred data\");\n    } else {\n      let doneFetcher = getDoneFetcher(result.data);\n      state.fetchers.set(key, doneFetcher);\n    }\n  });\n  return {\n    loaderData,\n    errors\n  };\n}\nfunction mergeLoaderData(loaderData, newLoaderData, matches, errors) {\n  let mergedLoaderData = _extends({}, newLoaderData);\n  for (let match of matches) {\n    let id = match.route.id;\n    if (newLoaderData.hasOwnProperty(id)) {\n      if (newLoaderData[id] !== undefined) {\n        mergedLoaderData[id] = newLoaderData[id];\n      }\n    } else if (loaderData[id] !== undefined && match.route.loader) {\n      // Preserve existing keys not included in newLoaderData and where a loader\n      // wasn't removed by HMR\n      mergedLoaderData[id] = loaderData[id];\n    }\n    if (errors && errors.hasOwnProperty(id)) {\n      // Don't keep any loader data below the boundary\n      break;\n    }\n  }\n  return mergedLoaderData;\n}\nfunction getActionDataForCommit(pendingActionResult) {\n  if (!pendingActionResult) {\n    return {};\n  }\n  return isErrorResult(pendingActionResult[1]) ? {\n    // Clear out prior actionData on errors\n    actionData: {}\n  } : {\n    actionData: {\n      [pendingActionResult[0]]: pendingActionResult[1].data\n    }\n  };\n}\n// Find the nearest error boundary, looking upwards from the leaf route (or the\n// route specified by routeId) for the closest ancestor error boundary,\n// defaulting to the root match\nfunction findNearestBoundary(matches, routeId) {\n  let eligibleMatches = routeId ? matches.slice(0, matches.findIndex(m => m.route.id === routeId) + 1) : [...matches];\n  return eligibleMatches.reverse().find(m => m.route.hasErrorBoundary === true) || matches[0];\n}\nfunction getShortCircuitMatches(routes) {\n  // Prefer a root layout route if present, otherwise shim in a route object\n  let route = routes.length === 1 ? routes[0] : routes.find(r => r.index || !r.path || r.path === \"/\") || {\n    id: \"__shim-error-route__\"\n  };\n  return {\n    matches: [{\n      params: {},\n      pathname: \"\",\n      pathnameBase: \"\",\n      route\n    }],\n    route\n  };\n}\nfunction getInternalRouterError(status, _temp5) {\n  let {\n    pathname,\n    routeId,\n    method,\n    type,\n    message\n  } = _temp5 === void 0 ? {} : _temp5;\n  let statusText = \"Unknown Server Error\";\n  let errorMessage = \"Unknown @remix-run/router error\";\n  if (status === 400) {\n    statusText = \"Bad Request\";\n    if (method && pathname && routeId) {\n      errorMessage = \"You made a \" + method + \" request to \\\"\" + pathname + \"\\\" but \" + (\"did not provide a `loader` for route \\\"\" + routeId + \"\\\", \") + \"so there is no way to handle the request.\";\n    } else if (type === \"defer-action\") {\n      errorMessage = \"defer() is not supported in actions\";\n    } else if (type === \"invalid-body\") {\n      errorMessage = \"Unable to encode submission body\";\n    }\n  } else if (status === 403) {\n    statusText = \"Forbidden\";\n    errorMessage = \"Route \\\"\" + routeId + \"\\\" does not match URL \\\"\" + pathname + \"\\\"\";\n  } else if (status === 404) {\n    statusText = \"Not Found\";\n    errorMessage = \"No route matches URL \\\"\" + pathname + \"\\\"\";\n  } else if (status === 405) {\n    statusText = \"Method Not Allowed\";\n    if (method && pathname && routeId) {\n      errorMessage = \"You made a \" + method.toUpperCase() + \" request to \\\"\" + pathname + \"\\\" but \" + (\"did not provide an `action` for route \\\"\" + routeId + \"\\\", \") + \"so there is no way to handle the request.\";\n    } else if (method) {\n      errorMessage = \"Invalid request method \\\"\" + method.toUpperCase() + \"\\\"\";\n    }\n  }\n  return new ErrorResponseImpl(status || 500, statusText, new Error(errorMessage), true);\n}\n// Find any returned redirect errors, starting from the lowest match\nfunction findRedirect(results) {\n  let entries = Object.entries(results);\n  for (let i = entries.length - 1; i >= 0; i--) {\n    let [key, result] = entries[i];\n    if (isRedirectResult(result)) {\n      return {\n        key,\n        result\n      };\n    }\n  }\n}\nfunction stripHashFromPath(path) {\n  let parsedPath = typeof path === \"string\" ? parsePath(path) : path;\n  return createPath(_extends({}, parsedPath, {\n    hash: \"\"\n  }));\n}\nfunction isHashChangeOnly(a, b) {\n  if (a.pathname !== b.pathname || a.search !== b.search) {\n    return false;\n  }\n  if (a.hash === \"\") {\n    // /page -> /page#hash\n    return b.hash !== \"\";\n  } else if (a.hash === b.hash) {\n    // /page#hash -> /page#hash\n    return true;\n  } else if (b.hash !== \"\") {\n    // /page#hash -> /page#other\n    return true;\n  }\n  // If the hash is removed the browser will re-perform a request to the server\n  // /page#hash -> /page\n  return false;\n}\nfunction isDataStrategyResult(result) {\n  return result != null && typeof result === \"object\" && \"type\" in result && \"result\" in result && (result.type === ResultType.data || result.type === ResultType.error);\n}\nfunction isRedirectDataStrategyResultResult(result) {\n  return isResponse(result.result) && redirectStatusCodes.has(result.result.status);\n}\nfunction isDeferredResult(result) {\n  return result.type === ResultType.deferred;\n}\nfunction isErrorResult(result) {\n  return result.type === ResultType.error;\n}\nfunction isRedirectResult(result) {\n  return (result && result.type) === ResultType.redirect;\n}\nfunction isDataWithResponseInit(value) {\n  return typeof value === \"object\" && value != null && \"type\" in value && \"data\" in value && \"init\" in value && value.type === \"DataWithResponseInit\";\n}\nfunction isDeferredData(value) {\n  let deferred = value;\n  return deferred && typeof deferred === \"object\" && typeof deferred.data === \"object\" && typeof deferred.subscribe === \"function\" && typeof deferred.cancel === \"function\" && typeof deferred.resolveData === \"function\";\n}\nfunction isResponse(value) {\n  return value != null && typeof value.status === \"number\" && typeof value.statusText === \"string\" && typeof value.headers === \"object\" && typeof value.body !== \"undefined\";\n}\nfunction isRedirectResponse(result) {\n  if (!isResponse(result)) {\n    return false;\n  }\n  let status = result.status;\n  let location = result.headers.get(\"Location\");\n  return status >= 300 && status <= 399 && location != null;\n}\nfunction isValidMethod(method) {\n  return validRequestMethods.has(method.toLowerCase());\n}\nfunction isMutationMethod(method) {\n  return validMutationMethods.has(method.toLowerCase());\n}\nasync function resolveNavigationDeferredResults(matches, results, signal, currentMatches, currentLoaderData) {\n  let entries = Object.entries(results);\n  for (let index = 0; index < entries.length; index++) {\n    let [routeId, result] = entries[index];\n    let match = matches.find(m => (m == null ? void 0 : m.route.id) === routeId);\n    // If we don't have a match, then we can have a deferred result to do\n    // anything with.  This is for revalidating fetchers where the route was\n    // removed during HMR\n    if (!match) {\n      continue;\n    }\n    let currentMatch = currentMatches.find(m => m.route.id === match.route.id);\n    let isRevalidatingLoader = currentMatch != null && !isNewRouteInstance(currentMatch, match) && (currentLoaderData && currentLoaderData[match.route.id]) !== undefined;\n    if (isDeferredResult(result) && isRevalidatingLoader) {\n      // Note: we do not have to touch activeDeferreds here since we race them\n      // against the signal in resolveDeferredData and they'll get aborted\n      // there if needed\n      await resolveDeferredData(result, signal, false).then(result => {\n        if (result) {\n          results[routeId] = result;\n        }\n      });\n    }\n  }\n}\nasync function resolveFetcherDeferredResults(matches, results, revalidatingFetchers) {\n  for (let index = 0; index < revalidatingFetchers.length; index++) {\n    let {\n      key,\n      routeId,\n      controller\n    } = revalidatingFetchers[index];\n    let result = results[key];\n    let match = matches.find(m => (m == null ? void 0 : m.route.id) === routeId);\n    // If we don't have a match, then we can have a deferred result to do\n    // anything with.  This is for revalidating fetchers where the route was\n    // removed during HMR\n    if (!match) {\n      continue;\n    }\n    if (isDeferredResult(result)) {\n      // Note: we do not have to touch activeDeferreds here since we race them\n      // against the signal in resolveDeferredData and they'll get aborted\n      // there if needed\n      invariant(controller, \"Expected an AbortController for revalidating fetcher deferred result\");\n      await resolveDeferredData(result, controller.signal, true).then(result => {\n        if (result) {\n          results[key] = result;\n        }\n      });\n    }\n  }\n}\nasync function resolveDeferredData(result, signal, unwrap) {\n  if (unwrap === void 0) {\n    unwrap = false;\n  }\n  let aborted = await result.deferredData.resolveData(signal);\n  if (aborted) {\n    return;\n  }\n  if (unwrap) {\n    try {\n      return {\n        type: ResultType.data,\n        data: result.deferredData.unwrappedData\n      };\n    } catch (e) {\n      // Handle any TrackedPromise._error values encountered while unwrapping\n      return {\n        type: ResultType.error,\n        error: e\n      };\n    }\n  }\n  return {\n    type: ResultType.data,\n    data: result.deferredData.data\n  };\n}\nfunction hasNakedIndexQuery(search) {\n  return new URLSearchParams(search).getAll(\"index\").some(v => v === \"\");\n}\nfunction getTargetMatch(matches, location) {\n  let search = typeof location === \"string\" ? parsePath(location).search : location.search;\n  if (matches[matches.length - 1].route.index && hasNakedIndexQuery(search || \"\")) {\n    // Return the leaf index route when index is present\n    return matches[matches.length - 1];\n  }\n  // Otherwise grab the deepest \"path contributing\" match (ignoring index and\n  // pathless layout routes)\n  let pathMatches = getPathContributingMatches(matches);\n  return pathMatches[pathMatches.length - 1];\n}\nfunction getSubmissionFromNavigation(navigation) {\n  let {\n    formMethod,\n    formAction,\n    formEncType,\n    text,\n    formData,\n    json\n  } = navigation;\n  if (!formMethod || !formAction || !formEncType) {\n    return;\n  }\n  if (text != null) {\n    return {\n      formMethod,\n      formAction,\n      formEncType,\n      formData: undefined,\n      json: undefined,\n      text\n    };\n  } else if (formData != null) {\n    return {\n      formMethod,\n      formAction,\n      formEncType,\n      formData,\n      json: undefined,\n      text: undefined\n    };\n  } else if (json !== undefined) {\n    return {\n      formMethod,\n      formAction,\n      formEncType,\n      formData: undefined,\n      json,\n      text: undefined\n    };\n  }\n}\nfunction getLoadingNavigation(location, submission) {\n  if (submission) {\n    let navigation = {\n      state: \"loading\",\n      location,\n      formMethod: submission.formMethod,\n      formAction: submission.formAction,\n      formEncType: submission.formEncType,\n      formData: submission.formData,\n      json: submission.json,\n      text: submission.text\n    };\n    return navigation;\n  } else {\n    let navigation = {\n      state: \"loading\",\n      location,\n      formMethod: undefined,\n      formAction: undefined,\n      formEncType: undefined,\n      formData: undefined,\n      json: undefined,\n      text: undefined\n    };\n    return navigation;\n  }\n}\nfunction getSubmittingNavigation(location, submission) {\n  let navigation = {\n    state: \"submitting\",\n    location,\n    formMethod: submission.formMethod,\n    formAction: submission.formAction,\n    formEncType: submission.formEncType,\n    formData: submission.formData,\n    json: submission.json,\n    text: submission.text\n  };\n  return navigation;\n}\nfunction getLoadingFetcher(submission, data) {\n  if (submission) {\n    let fetcher = {\n      state: \"loading\",\n      formMethod: submission.formMethod,\n      formAction: submission.formAction,\n      formEncType: submission.formEncType,\n      formData: submission.formData,\n      json: submission.json,\n      text: submission.text,\n      data\n    };\n    return fetcher;\n  } else {\n    let fetcher = {\n      state: \"loading\",\n      formMethod: undefined,\n      formAction: undefined,\n      formEncType: undefined,\n      formData: undefined,\n      json: undefined,\n      text: undefined,\n      data\n    };\n    return fetcher;\n  }\n}\nfunction getSubmittingFetcher(submission, existingFetcher) {\n  let fetcher = {\n    state: \"submitting\",\n    formMethod: submission.formMethod,\n    formAction: submission.formAction,\n    formEncType: submission.formEncType,\n    formData: submission.formData,\n    json: submission.json,\n    text: submission.text,\n    data: existingFetcher ? existingFetcher.data : undefined\n  };\n  return fetcher;\n}\nfunction getDoneFetcher(data) {\n  let fetcher = {\n    state: \"idle\",\n    formMethod: undefined,\n    formAction: undefined,\n    formEncType: undefined,\n    formData: undefined,\n    json: undefined,\n    text: undefined,\n    data\n  };\n  return fetcher;\n}\nfunction restoreAppliedTransitions(_window, transitions) {\n  try {\n    let sessionPositions = _window.sessionStorage.getItem(TRANSITIONS_STORAGE_KEY);\n    if (sessionPositions) {\n      let json = JSON.parse(sessionPositions);\n      for (let [k, v] of Object.entries(json || {})) {\n        if (v && Array.isArray(v)) {\n          transitions.set(k, new Set(v || []));\n        }\n      }\n    }\n  } catch (e) {\n    // no-op, use default empty object\n  }\n}\nfunction persistAppliedTransitions(_window, transitions) {\n  if (transitions.size > 0) {\n    let json = {};\n    for (let [k, v] of transitions) {\n      json[k] = [...v];\n    }\n    try {\n      _window.sessionStorage.setItem(TRANSITIONS_STORAGE_KEY, JSON.stringify(json));\n    } catch (error) {\n      warning(false, \"Failed to save applied view transitions in sessionStorage (\" + error + \").\");\n    }\n  }\n}\n//#endregion\n\nexport { AbortedDeferredError, Action, IDLE_BLOCKER, IDLE_FETCHER, IDLE_NAVIGATION, UNSAFE_DEFERRED_SYMBOL, DeferredData as UNSAFE_DeferredData, ErrorResponseImpl as UNSAFE_ErrorResponseImpl, convertRouteMatchToUiMatch as UNSAFE_convertRouteMatchToUiMatch, convertRoutesToDataRoutes as UNSAFE_convertRoutesToDataRoutes, decodePath as UNSAFE_decodePath, getResolveToMatches as UNSAFE_getResolveToMatches, invariant as UNSAFE_invariant, warning as UNSAFE_warning, createBrowserHistory, createHashHistory, createMemoryHistory, createPath, createRouter, createStaticHandler, data, defer, generatePath, getStaticContextFromError, getToPathname, isDataWithResponseInit, isDeferredData, isRouteErrorResponse, joinPaths, json, matchPath, matchRoutes, normalizePathname, parsePath, redirect, redirectDocument, replace, resolvePath, resolveTo, stripBasename };\n//# sourceMappingURL=router.js.map\n","/**\n * React Router v6.30.3\n *\n * Copyright (c) Remix Software Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE.md file in the root directory of this source tree.\n *\n * @license MIT\n */\nimport * as React from 'react';\nimport { UNSAFE_invariant, joinPaths, matchPath, UNSAFE_decodePath, UNSAFE_getResolveToMatches, UNSAFE_warning, resolveTo, parsePath, matchRoutes, Action, UNSAFE_convertRouteMatchToUiMatch, stripBasename, IDLE_BLOCKER, isRouteErrorResponse, createMemoryHistory, AbortedDeferredError, createRouter } from '@remix-run/router';\nexport { AbortedDeferredError, Action as NavigationType, createPath, defer, generatePath, isRouteErrorResponse, json, matchPath, matchRoutes, parsePath, redirect, redirectDocument, replace, resolvePath } from '@remix-run/router';\n\nfunction _extends() {\n  _extends = Object.assign ? Object.assign.bind() : function (target) {\n    for (var i = 1; i < arguments.length; i++) {\n      var source = arguments[i];\n      for (var key in source) {\n        if (Object.prototype.hasOwnProperty.call(source, key)) {\n          target[key] = source[key];\n        }\n      }\n    }\n    return target;\n  };\n  return _extends.apply(this, arguments);\n}\n\n// Create react-specific types from the agnostic types in @remix-run/router to\n// export from react-router\nconst DataRouterContext = /*#__PURE__*/React.createContext(null);\nif (process.env.NODE_ENV !== \"production\") {\n  DataRouterContext.displayName = \"DataRouter\";\n}\nconst DataRouterStateContext = /*#__PURE__*/React.createContext(null);\nif (process.env.NODE_ENV !== \"production\") {\n  DataRouterStateContext.displayName = \"DataRouterState\";\n}\nconst AwaitContext = /*#__PURE__*/React.createContext(null);\nif (process.env.NODE_ENV !== \"production\") {\n  AwaitContext.displayName = \"Await\";\n}\n\n/**\n * A Navigator is a \"location changer\"; it's how you get to different locations.\n *\n * Every history instance conforms to the Navigator interface, but the\n * distinction is useful primarily when it comes to the low-level `<Router>` API\n * where both the location and a navigator must be provided separately in order\n * to avoid \"tearing\" that may occur in a suspense-enabled app if the action\n * and/or location were to be read directly from the history instance.\n */\n\nconst NavigationContext = /*#__PURE__*/React.createContext(null);\nif (process.env.NODE_ENV !== \"production\") {\n  NavigationContext.displayName = \"Navigation\";\n}\nconst LocationContext = /*#__PURE__*/React.createContext(null);\nif (process.env.NODE_ENV !== \"production\") {\n  LocationContext.displayName = \"Location\";\n}\nconst RouteContext = /*#__PURE__*/React.createContext({\n  outlet: null,\n  matches: [],\n  isDataRoute: false\n});\nif (process.env.NODE_ENV !== \"production\") {\n  RouteContext.displayName = \"Route\";\n}\nconst RouteErrorContext = /*#__PURE__*/React.createContext(null);\nif (process.env.NODE_ENV !== \"production\") {\n  RouteErrorContext.displayName = \"RouteError\";\n}\n\n/**\n * Returns the full href for the given \"to\" value. This is useful for building\n * custom links that are also accessible and preserve right-click behavior.\n *\n * @see https://reactrouter.com/v6/hooks/use-href\n */\nfunction useHref(to, _temp) {\n  let {\n    relative\n  } = _temp === void 0 ? {} : _temp;\n  !useInRouterContext() ? process.env.NODE_ENV !== \"production\" ? UNSAFE_invariant(false, // TODO: This error is probably because they somehow have 2 versions of the\n  // router loaded. We can help them understand how to avoid that.\n  \"useHref() may be used only in the context of a <Router> component.\") : UNSAFE_invariant(false) : void 0;\n  let {\n    basename,\n    navigator\n  } = React.useContext(NavigationContext);\n  let {\n    hash,\n    pathname,\n    search\n  } = useResolvedPath(to, {\n    relative\n  });\n  let joinedPathname = pathname;\n\n  // If we're operating within a basename, prepend it to the pathname prior\n  // to creating the href.  If this is a root navigation, then just use the raw\n  // basename which allows the basename to have full control over the presence\n  // of a trailing slash on root links\n  if (basename !== \"/\") {\n    joinedPathname = pathname === \"/\" ? basename : joinPaths([basename, pathname]);\n  }\n  return navigator.createHref({\n    pathname: joinedPathname,\n    search,\n    hash\n  });\n}\n\n/**\n * Returns true if this component is a descendant of a `<Router>`.\n *\n * @see https://reactrouter.com/v6/hooks/use-in-router-context\n */\nfunction useInRouterContext() {\n  return React.useContext(LocationContext) != null;\n}\n\n/**\n * Returns the current location object, which represents the current URL in web\n * browsers.\n *\n * Note: If you're using this it may mean you're doing some of your own\n * \"routing\" in your app, and we'd like to know what your use case is. We may\n * be able to provide something higher-level to better suit your needs.\n *\n * @see https://reactrouter.com/v6/hooks/use-location\n */\nfunction useLocation() {\n  !useInRouterContext() ? process.env.NODE_ENV !== \"production\" ? UNSAFE_invariant(false, // TODO: This error is probably because they somehow have 2 versions of the\n  // router loaded. We can help them understand how to avoid that.\n  \"useLocation() may be used only in the context of a <Router> component.\") : UNSAFE_invariant(false) : void 0;\n  return React.useContext(LocationContext).location;\n}\n\n/**\n * Returns the current navigation action which describes how the router came to\n * the current location, either by a pop, push, or replace on the history stack.\n *\n * @see https://reactrouter.com/v6/hooks/use-navigation-type\n */\nfunction useNavigationType() {\n  return React.useContext(LocationContext).navigationType;\n}\n\n/**\n * Returns a PathMatch object if the given pattern matches the current URL.\n * This is useful for components that need to know \"active\" state, e.g.\n * `<NavLink>`.\n *\n * @see https://reactrouter.com/v6/hooks/use-match\n */\nfunction useMatch(pattern) {\n  !useInRouterContext() ? process.env.NODE_ENV !== \"production\" ? UNSAFE_invariant(false, // TODO: This error is probably because they somehow have 2 versions of the\n  // router loaded. We can help them understand how to avoid that.\n  \"useMatch() may be used only in the context of a <Router> component.\") : UNSAFE_invariant(false) : void 0;\n  let {\n    pathname\n  } = useLocation();\n  return React.useMemo(() => matchPath(pattern, UNSAFE_decodePath(pathname)), [pathname, pattern]);\n}\n\n/**\n * The interface for the navigate() function returned from useNavigate().\n */\n\nconst navigateEffectWarning = \"You should call navigate() in a React.useEffect(), not when \" + \"your component is first rendered.\";\n\n// Mute warnings for calls to useNavigate in SSR environments\nfunction useIsomorphicLayoutEffect(cb) {\n  let isStatic = React.useContext(NavigationContext).static;\n  if (!isStatic) {\n    // We should be able to get rid of this once react 18.3 is released\n    // See: https://github.com/facebook/react/pull/26395\n    // eslint-disable-next-line react-hooks/rules-of-hooks\n    React.useLayoutEffect(cb);\n  }\n}\n\n/**\n * Returns an imperative method for changing the location. Used by `<Link>`s, but\n * may also be used by other elements to change the location.\n *\n * @see https://reactrouter.com/v6/hooks/use-navigate\n */\nfunction useNavigate() {\n  let {\n    isDataRoute\n  } = React.useContext(RouteContext);\n  // Conditional usage is OK here because the usage of a data router is static\n  // eslint-disable-next-line react-hooks/rules-of-hooks\n  return isDataRoute ? useNavigateStable() : useNavigateUnstable();\n}\nfunction useNavigateUnstable() {\n  !useInRouterContext() ? process.env.NODE_ENV !== \"production\" ? UNSAFE_invariant(false, // TODO: This error is probably because they somehow have 2 versions of the\n  // router loaded. We can help them understand how to avoid that.\n  \"useNavigate() may be used only in the context of a <Router> component.\") : UNSAFE_invariant(false) : void 0;\n  let dataRouterContext = React.useContext(DataRouterContext);\n  let {\n    basename,\n    future,\n    navigator\n  } = React.useContext(NavigationContext);\n  let {\n    matches\n  } = React.useContext(RouteContext);\n  let {\n    pathname: locationPathname\n  } = useLocation();\n  let routePathnamesJson = JSON.stringify(UNSAFE_getResolveToMatches(matches, future.v7_relativeSplatPath));\n  let activeRef = React.useRef(false);\n  useIsomorphicLayoutEffect(() => {\n    activeRef.current = true;\n  });\n  let navigate = React.useCallback(function (to, options) {\n    if (options === void 0) {\n      options = {};\n    }\n    process.env.NODE_ENV !== \"production\" ? UNSAFE_warning(activeRef.current, navigateEffectWarning) : void 0;\n\n    // Short circuit here since if this happens on first render the navigate\n    // is useless because we haven't wired up our history listener yet\n    if (!activeRef.current) return;\n    if (typeof to === \"number\") {\n      navigator.go(to);\n      return;\n    }\n    let path = resolveTo(to, JSON.parse(routePathnamesJson), locationPathname, options.relative === \"path\");\n\n    // If we're operating within a basename, prepend it to the pathname prior\n    // to handing off to history (but only if we're not in a data router,\n    // otherwise it'll prepend the basename inside of the router).\n    // If this is a root navigation, then we navigate to the raw basename\n    // which allows the basename to have full control over the presence of a\n    // trailing slash on root links\n    if (dataRouterContext == null && basename !== \"/\") {\n      path.pathname = path.pathname === \"/\" ? basename : joinPaths([basename, path.pathname]);\n    }\n    (!!options.replace ? navigator.replace : navigator.push)(path, options.state, options);\n  }, [basename, navigator, routePathnamesJson, locationPathname, dataRouterContext]);\n  return navigate;\n}\nconst OutletContext = /*#__PURE__*/React.createContext(null);\n\n/**\n * Returns the context (if provided) for the child route at this level of the route\n * hierarchy.\n * @see https://reactrouter.com/v6/hooks/use-outlet-context\n */\nfunction useOutletContext() {\n  return React.useContext(OutletContext);\n}\n\n/**\n * Returns the element for the child route at this level of the route\n * hierarchy. Used internally by `<Outlet>` to render child routes.\n *\n * @see https://reactrouter.com/v6/hooks/use-outlet\n */\nfunction useOutlet(context) {\n  let outlet = React.useContext(RouteContext).outlet;\n  if (outlet) {\n    return /*#__PURE__*/React.createElement(OutletContext.Provider, {\n      value: context\n    }, outlet);\n  }\n  return outlet;\n}\n\n/**\n * Returns an object of key/value pairs of the dynamic params from the current\n * URL that were matched by the route path.\n *\n * @see https://reactrouter.com/v6/hooks/use-params\n */\nfunction useParams() {\n  let {\n    matches\n  } = React.useContext(RouteContext);\n  let routeMatch = matches[matches.length - 1];\n  return routeMatch ? routeMatch.params : {};\n}\n\n/**\n * Resolves the pathname of the given `to` value against the current location.\n *\n * @see https://reactrouter.com/v6/hooks/use-resolved-path\n */\nfunction useResolvedPath(to, _temp2) {\n  let {\n    relative\n  } = _temp2 === void 0 ? {} : _temp2;\n  let {\n    future\n  } = React.useContext(NavigationContext);\n  let {\n    matches\n  } = React.useContext(RouteContext);\n  let {\n    pathname: locationPathname\n  } = useLocation();\n  let routePathnamesJson = JSON.stringify(UNSAFE_getResolveToMatches(matches, future.v7_relativeSplatPath));\n  return React.useMemo(() => resolveTo(to, JSON.parse(routePathnamesJson), locationPathname, relative === \"path\"), [to, routePathnamesJson, locationPathname, relative]);\n}\n\n/**\n * Returns the element of the route that matched the current location, prepared\n * with the correct context to render the remainder of the route tree. Route\n * elements in the tree must render an `<Outlet>` to render their child route's\n * element.\n *\n * @see https://reactrouter.com/v6/hooks/use-routes\n */\nfunction useRoutes(routes, locationArg) {\n  return useRoutesImpl(routes, locationArg);\n}\n\n// Internal implementation with accept optional param for RouterProvider usage\nfunction useRoutesImpl(routes, locationArg, dataRouterState, future) {\n  !useInRouterContext() ? process.env.NODE_ENV !== \"production\" ? UNSAFE_invariant(false, // TODO: This error is probably because they somehow have 2 versions of the\n  // router loaded. We can help them understand how to avoid that.\n  \"useRoutes() may be used only in the context of a <Router> component.\") : UNSAFE_invariant(false) : void 0;\n  let {\n    navigator\n  } = React.useContext(NavigationContext);\n  let {\n    matches: parentMatches\n  } = React.useContext(RouteContext);\n  let routeMatch = parentMatches[parentMatches.length - 1];\n  let parentParams = routeMatch ? routeMatch.params : {};\n  let parentPathname = routeMatch ? routeMatch.pathname : \"/\";\n  let parentPathnameBase = routeMatch ? routeMatch.pathnameBase : \"/\";\n  let parentRoute = routeMatch && routeMatch.route;\n  if (process.env.NODE_ENV !== \"production\") {\n    // You won't get a warning about 2 different <Routes> under a <Route>\n    // without a trailing *, but this is a best-effort warning anyway since we\n    // cannot even give the warning unless they land at the parent route.\n    //\n    // Example:\n    //\n    // <Routes>\n    //   {/* This route path MUST end with /* because otherwise\n    //       it will never match /blog/post/123 */}\n    //   <Route path=\"blog\" element={<Blog />} />\n    //   <Route path=\"blog/feed\" element={<BlogFeed />} />\n    // </Routes>\n    //\n    // function Blog() {\n    //   return (\n    //     <Routes>\n    //       <Route path=\"post/:id\" element={<Post />} />\n    //     </Routes>\n    //   );\n    // }\n    let parentPath = parentRoute && parentRoute.path || \"\";\n    warningOnce(parentPathname, !parentRoute || parentPath.endsWith(\"*\"), \"You rendered descendant <Routes> (or called `useRoutes()`) at \" + (\"\\\"\" + parentPathname + \"\\\" (under <Route path=\\\"\" + parentPath + \"\\\">) but the \") + \"parent route path has no trailing \\\"*\\\". This means if you navigate \" + \"deeper, the parent won't match anymore and therefore the child \" + \"routes will never render.\\n\\n\" + (\"Please change the parent <Route path=\\\"\" + parentPath + \"\\\"> to <Route \") + (\"path=\\\"\" + (parentPath === \"/\" ? \"*\" : parentPath + \"/*\") + \"\\\">.\"));\n  }\n  let locationFromContext = useLocation();\n  let location;\n  if (locationArg) {\n    var _parsedLocationArg$pa;\n    let parsedLocationArg = typeof locationArg === \"string\" ? parsePath(locationArg) : locationArg;\n    !(parentPathnameBase === \"/\" || ((_parsedLocationArg$pa = parsedLocationArg.pathname) == null ? void 0 : _parsedLocationArg$pa.startsWith(parentPathnameBase))) ? process.env.NODE_ENV !== \"production\" ? UNSAFE_invariant(false, \"When overriding the location using `<Routes location>` or `useRoutes(routes, location)`, \" + \"the location pathname must begin with the portion of the URL pathname that was \" + (\"matched by all parent routes. The current pathname base is \\\"\" + parentPathnameBase + \"\\\" \") + (\"but pathname \\\"\" + parsedLocationArg.pathname + \"\\\" was given in the `location` prop.\")) : UNSAFE_invariant(false) : void 0;\n    location = parsedLocationArg;\n  } else {\n    location = locationFromContext;\n  }\n  let pathname = location.pathname || \"/\";\n  let remainingPathname = pathname;\n  if (parentPathnameBase !== \"/\") {\n    // Determine the remaining pathname by removing the # of URL segments the\n    // parentPathnameBase has, instead of removing based on character count.\n    // This is because we can't guarantee that incoming/outgoing encodings/\n    // decodings will match exactly.\n    // We decode paths before matching on a per-segment basis with\n    // decodeURIComponent(), but we re-encode pathnames via `new URL()` so they\n    // match what `window.location.pathname` would reflect.  Those don't 100%\n    // align when it comes to encoded URI characters such as % and &.\n    //\n    // So we may end up with:\n    //   pathname:           \"/descendant/a%25b/match\"\n    //   parentPathnameBase: \"/descendant/a%b\"\n    //\n    // And the direct substring removal approach won't work :/\n    let parentSegments = parentPathnameBase.replace(/^\\//, \"\").split(\"/\");\n    let segments = pathname.replace(/^\\//, \"\").split(\"/\");\n    remainingPathname = \"/\" + segments.slice(parentSegments.length).join(\"/\");\n  }\n  let matches = matchRoutes(routes, {\n    pathname: remainingPathname\n  });\n  if (process.env.NODE_ENV !== \"production\") {\n    process.env.NODE_ENV !== \"production\" ? UNSAFE_warning(parentRoute || matches != null, \"No routes matched location \\\"\" + location.pathname + location.search + location.hash + \"\\\" \") : void 0;\n    process.env.NODE_ENV !== \"production\" ? UNSAFE_warning(matches == null || matches[matches.length - 1].route.element !== undefined || matches[matches.length - 1].route.Component !== undefined || matches[matches.length - 1].route.lazy !== undefined, \"Matched leaf route at location \\\"\" + location.pathname + location.search + location.hash + \"\\\" \" + \"does not have an element or Component. This means it will render an <Outlet /> with a \" + \"null value by default resulting in an \\\"empty\\\" page.\") : void 0;\n  }\n  let renderedMatches = _renderMatches(matches && matches.map(match => Object.assign({}, match, {\n    params: Object.assign({}, parentParams, match.params),\n    pathname: joinPaths([parentPathnameBase,\n    // Re-encode pathnames that were decoded inside matchRoutes\n    navigator.encodeLocation ? navigator.encodeLocation(match.pathname).pathname : match.pathname]),\n    pathnameBase: match.pathnameBase === \"/\" ? parentPathnameBase : joinPaths([parentPathnameBase,\n    // Re-encode pathnames that were decoded inside matchRoutes\n    navigator.encodeLocation ? navigator.encodeLocation(match.pathnameBase).pathname : match.pathnameBase])\n  })), parentMatches, dataRouterState, future);\n\n  // When a user passes in a `locationArg`, the associated routes need to\n  // be wrapped in a new `LocationContext.Provider` in order for `useLocation`\n  // to use the scoped location instead of the global location.\n  if (locationArg && renderedMatches) {\n    return /*#__PURE__*/React.createElement(LocationContext.Provider, {\n      value: {\n        location: _extends({\n          pathname: \"/\",\n          search: \"\",\n          hash: \"\",\n          state: null,\n          key: \"default\"\n        }, location),\n        navigationType: Action.Pop\n      }\n    }, renderedMatches);\n  }\n  return renderedMatches;\n}\nfunction DefaultErrorComponent() {\n  let error = useRouteError();\n  let message = isRouteErrorResponse(error) ? error.status + \" \" + error.statusText : error instanceof Error ? error.message : JSON.stringify(error);\n  let stack = error instanceof Error ? error.stack : null;\n  let lightgrey = \"rgba(200,200,200, 0.5)\";\n  let preStyles = {\n    padding: \"0.5rem\",\n    backgroundColor: lightgrey\n  };\n  let codeStyles = {\n    padding: \"2px 4px\",\n    backgroundColor: lightgrey\n  };\n  let devInfo = null;\n  if (process.env.NODE_ENV !== \"production\") {\n    console.error(\"Error handled by React Router default ErrorBoundary:\", error);\n    devInfo = /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(\"p\", null, \"\\uD83D\\uDCBF Hey developer \\uD83D\\uDC4B\"), /*#__PURE__*/React.createElement(\"p\", null, \"You can provide a way better UX than this when your app throws errors by providing your own \", /*#__PURE__*/React.createElement(\"code\", {\n      style: codeStyles\n    }, \"ErrorBoundary\"), \" or\", \" \", /*#__PURE__*/React.createElement(\"code\", {\n      style: codeStyles\n    }, \"errorElement\"), \" prop on your route.\"));\n  }\n  return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(\"h2\", null, \"Unexpected Application Error!\"), /*#__PURE__*/React.createElement(\"h3\", {\n    style: {\n      fontStyle: \"italic\"\n    }\n  }, message), stack ? /*#__PURE__*/React.createElement(\"pre\", {\n    style: preStyles\n  }, stack) : null, devInfo);\n}\nconst defaultErrorElement = /*#__PURE__*/React.createElement(DefaultErrorComponent, null);\nclass RenderErrorBoundary extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      location: props.location,\n      revalidation: props.revalidation,\n      error: props.error\n    };\n  }\n  static getDerivedStateFromError(error) {\n    return {\n      error: error\n    };\n  }\n  static getDerivedStateFromProps(props, state) {\n    // When we get into an error state, the user will likely click \"back\" to the\n    // previous page that didn't have an error. Because this wraps the entire\n    // application, that will have no effect--the error page continues to display.\n    // This gives us a mechanism to recover from the error when the location changes.\n    //\n    // Whether we're in an error state or not, we update the location in state\n    // so that when we are in an error state, it gets reset when a new location\n    // comes in and the user recovers from the error.\n    if (state.location !== props.location || state.revalidation !== \"idle\" && props.revalidation === \"idle\") {\n      return {\n        error: props.error,\n        location: props.location,\n        revalidation: props.revalidation\n      };\n    }\n\n    // If we're not changing locations, preserve the location but still surface\n    // any new errors that may come through. We retain the existing error, we do\n    // this because the error provided from the app state may be cleared without\n    // the location changing.\n    return {\n      error: props.error !== undefined ? props.error : state.error,\n      location: state.location,\n      revalidation: props.revalidation || state.revalidation\n    };\n  }\n  componentDidCatch(error, errorInfo) {\n    console.error(\"React Router caught the following error during render\", error, errorInfo);\n  }\n  render() {\n    return this.state.error !== undefined ? /*#__PURE__*/React.createElement(RouteContext.Provider, {\n      value: this.props.routeContext\n    }, /*#__PURE__*/React.createElement(RouteErrorContext.Provider, {\n      value: this.state.error,\n      children: this.props.component\n    })) : this.props.children;\n  }\n}\nfunction RenderedRoute(_ref) {\n  let {\n    routeContext,\n    match,\n    children\n  } = _ref;\n  let dataRouterContext = React.useContext(DataRouterContext);\n\n  // Track how deep we got in our render pass to emulate SSR componentDidCatch\n  // in a DataStaticRouter\n  if (dataRouterContext && dataRouterContext.static && dataRouterContext.staticContext && (match.route.errorElement || match.route.ErrorBoundary)) {\n    dataRouterContext.staticContext._deepestRenderedBoundaryId = match.route.id;\n  }\n  return /*#__PURE__*/React.createElement(RouteContext.Provider, {\n    value: routeContext\n  }, children);\n}\nfunction _renderMatches(matches, parentMatches, dataRouterState, future) {\n  var _dataRouterState;\n  if (parentMatches === void 0) {\n    parentMatches = [];\n  }\n  if (dataRouterState === void 0) {\n    dataRouterState = null;\n  }\n  if (future === void 0) {\n    future = null;\n  }\n  if (matches == null) {\n    var _future;\n    if (!dataRouterState) {\n      return null;\n    }\n    if (dataRouterState.errors) {\n      // Don't bail if we have data router errors so we can render them in the\n      // boundary.  Use the pre-matched (or shimmed) matches\n      matches = dataRouterState.matches;\n    } else if ((_future = future) != null && _future.v7_partialHydration && parentMatches.length === 0 && !dataRouterState.initialized && dataRouterState.matches.length > 0) {\n      // Don't bail if we're initializing with partial hydration and we have\n      // router matches.  That means we're actively running `patchRoutesOnNavigation`\n      // so we should render down the partial matches to the appropriate\n      // `HydrateFallback`.  We only do this if `parentMatches` is empty so it\n      // only impacts the root matches for `RouterProvider` and no descendant\n      // `<Routes>`\n      matches = dataRouterState.matches;\n    } else {\n      return null;\n    }\n  }\n  let renderedMatches = matches;\n\n  // If we have data errors, trim matches to the highest error boundary\n  let errors = (_dataRouterState = dataRouterState) == null ? void 0 : _dataRouterState.errors;\n  if (errors != null) {\n    let errorIndex = renderedMatches.findIndex(m => m.route.id && (errors == null ? void 0 : errors[m.route.id]) !== undefined);\n    !(errorIndex >= 0) ? process.env.NODE_ENV !== \"production\" ? UNSAFE_invariant(false, \"Could not find a matching route for errors on route IDs: \" + Object.keys(errors).join(\",\")) : UNSAFE_invariant(false) : void 0;\n    renderedMatches = renderedMatches.slice(0, Math.min(renderedMatches.length, errorIndex + 1));\n  }\n\n  // If we're in a partial hydration mode, detect if we need to render down to\n  // a given HydrateFallback while we load the rest of the hydration data\n  let renderFallback = false;\n  let fallbackIndex = -1;\n  if (dataRouterState && future && future.v7_partialHydration) {\n    for (let i = 0; i < renderedMatches.length; i++) {\n      let match = renderedMatches[i];\n      // Track the deepest fallback up until the first route without data\n      if (match.route.HydrateFallback || match.route.hydrateFallbackElement) {\n        fallbackIndex = i;\n      }\n      if (match.route.id) {\n        let {\n          loaderData,\n          errors\n        } = dataRouterState;\n        let needsToRunLoader = match.route.loader && loaderData[match.route.id] === undefined && (!errors || errors[match.route.id] === undefined);\n        if (match.route.lazy || needsToRunLoader) {\n          // We found the first route that's not ready to render (waiting on\n          // lazy, or has a loader that hasn't run yet).  Flag that we need to\n          // render a fallback and render up until the appropriate fallback\n          renderFallback = true;\n          if (fallbackIndex >= 0) {\n            renderedMatches = renderedMatches.slice(0, fallbackIndex + 1);\n          } else {\n            renderedMatches = [renderedMatches[0]];\n          }\n          break;\n        }\n      }\n    }\n  }\n  return renderedMatches.reduceRight((outlet, match, index) => {\n    // Only data routers handle errors/fallbacks\n    let error;\n    let shouldRenderHydrateFallback = false;\n    let errorElement = null;\n    let hydrateFallbackElement = null;\n    if (dataRouterState) {\n      error = errors && match.route.id ? errors[match.route.id] : undefined;\n      errorElement = match.route.errorElement || defaultErrorElement;\n      if (renderFallback) {\n        if (fallbackIndex < 0 && index === 0) {\n          warningOnce(\"route-fallback\", false, \"No `HydrateFallback` element provided to render during initial hydration\");\n          shouldRenderHydrateFallback = true;\n          hydrateFallbackElement = null;\n        } else if (fallbackIndex === index) {\n          shouldRenderHydrateFallback = true;\n          hydrateFallbackElement = match.route.hydrateFallbackElement || null;\n        }\n      }\n    }\n    let matches = parentMatches.concat(renderedMatches.slice(0, index + 1));\n    let getChildren = () => {\n      let children;\n      if (error) {\n        children = errorElement;\n      } else if (shouldRenderHydrateFallback) {\n        children = hydrateFallbackElement;\n      } else if (match.route.Component) {\n        // Note: This is a de-optimized path since React won't re-use the\n        // ReactElement since it's identity changes with each new\n        // React.createElement call.  We keep this so folks can use\n        // `<Route Component={...}>` in `<Routes>` but generally `Component`\n        // usage is only advised in `RouterProvider` when we can convert it to\n        // `element` ahead of time.\n        children = /*#__PURE__*/React.createElement(match.route.Component, null);\n      } else if (match.route.element) {\n        children = match.route.element;\n      } else {\n        children = outlet;\n      }\n      return /*#__PURE__*/React.createElement(RenderedRoute, {\n        match: match,\n        routeContext: {\n          outlet,\n          matches,\n          isDataRoute: dataRouterState != null\n        },\n        children: children\n      });\n    };\n    // Only wrap in an error boundary within data router usages when we have an\n    // ErrorBoundary/errorElement on this route.  Otherwise let it bubble up to\n    // an ancestor ErrorBoundary/errorElement\n    return dataRouterState && (match.route.ErrorBoundary || match.route.errorElement || index === 0) ? /*#__PURE__*/React.createElement(RenderErrorBoundary, {\n      location: dataRouterState.location,\n      revalidation: dataRouterState.revalidation,\n      component: errorElement,\n      error: error,\n      children: getChildren(),\n      routeContext: {\n        outlet: null,\n        matches,\n        isDataRoute: true\n      }\n    }) : getChildren();\n  }, null);\n}\nvar DataRouterHook = /*#__PURE__*/function (DataRouterHook) {\n  DataRouterHook[\"UseBlocker\"] = \"useBlocker\";\n  DataRouterHook[\"UseRevalidator\"] = \"useRevalidator\";\n  DataRouterHook[\"UseNavigateStable\"] = \"useNavigate\";\n  return DataRouterHook;\n}(DataRouterHook || {});\nvar DataRouterStateHook = /*#__PURE__*/function (DataRouterStateHook) {\n  DataRouterStateHook[\"UseBlocker\"] = \"useBlocker\";\n  DataRouterStateHook[\"UseLoaderData\"] = \"useLoaderData\";\n  DataRouterStateHook[\"UseActionData\"] = \"useActionData\";\n  DataRouterStateHook[\"UseRouteError\"] = \"useRouteError\";\n  DataRouterStateHook[\"UseNavigation\"] = \"useNavigation\";\n  DataRouterStateHook[\"UseRouteLoaderData\"] = \"useRouteLoaderData\";\n  DataRouterStateHook[\"UseMatches\"] = \"useMatches\";\n  DataRouterStateHook[\"UseRevalidator\"] = \"useRevalidator\";\n  DataRouterStateHook[\"UseNavigateStable\"] = \"useNavigate\";\n  DataRouterStateHook[\"UseRouteId\"] = \"useRouteId\";\n  return DataRouterStateHook;\n}(DataRouterStateHook || {});\nfunction getDataRouterConsoleError(hookName) {\n  return hookName + \" must be used within a data router.  See https://reactrouter.com/v6/routers/picking-a-router.\";\n}\nfunction useDataRouterContext(hookName) {\n  let ctx = React.useContext(DataRouterContext);\n  !ctx ? process.env.NODE_ENV !== \"production\" ? UNSAFE_invariant(false, getDataRouterConsoleError(hookName)) : UNSAFE_invariant(false) : void 0;\n  return ctx;\n}\nfunction useDataRouterState(hookName) {\n  let state = React.useContext(DataRouterStateContext);\n  !state ? process.env.NODE_ENV !== \"production\" ? UNSAFE_invariant(false, getDataRouterConsoleError(hookName)) : UNSAFE_invariant(false) : void 0;\n  return state;\n}\nfunction useRouteContext(hookName) {\n  let route = React.useContext(RouteContext);\n  !route ? process.env.NODE_ENV !== \"production\" ? UNSAFE_invariant(false, getDataRouterConsoleError(hookName)) : UNSAFE_invariant(false) : void 0;\n  return route;\n}\n\n// Internal version with hookName-aware debugging\nfunction useCurrentRouteId(hookName) {\n  let route = useRouteContext(hookName);\n  let thisRoute = route.matches[route.matches.length - 1];\n  !thisRoute.route.id ? process.env.NODE_ENV !== \"production\" ? UNSAFE_invariant(false, hookName + \" can only be used on routes that contain a unique \\\"id\\\"\") : UNSAFE_invariant(false) : void 0;\n  return thisRoute.route.id;\n}\n\n/**\n * Returns the ID for the nearest contextual route\n */\nfunction useRouteId() {\n  return useCurrentRouteId(DataRouterStateHook.UseRouteId);\n}\n\n/**\n * Returns the current navigation, defaulting to an \"idle\" navigation when\n * no navigation is in progress\n */\nfunction useNavigation() {\n  let state = useDataRouterState(DataRouterStateHook.UseNavigation);\n  return state.navigation;\n}\n\n/**\n * Returns a revalidate function for manually triggering revalidation, as well\n * as the current state of any manual revalidations\n */\nfunction useRevalidator() {\n  let dataRouterContext = useDataRouterContext(DataRouterHook.UseRevalidator);\n  let state = useDataRouterState(DataRouterStateHook.UseRevalidator);\n  return React.useMemo(() => ({\n    revalidate: dataRouterContext.router.revalidate,\n    state: state.revalidation\n  }), [dataRouterContext.router.revalidate, state.revalidation]);\n}\n\n/**\n * Returns the active route matches, useful for accessing loaderData for\n * parent/child routes or the route \"handle\" property\n */\nfunction useMatches() {\n  let {\n    matches,\n    loaderData\n  } = useDataRouterState(DataRouterStateHook.UseMatches);\n  return React.useMemo(() => matches.map(m => UNSAFE_convertRouteMatchToUiMatch(m, loaderData)), [matches, loaderData]);\n}\n\n/**\n * Returns the loader data for the nearest ancestor Route loader\n */\nfunction useLoaderData() {\n  let state = useDataRouterState(DataRouterStateHook.UseLoaderData);\n  let routeId = useCurrentRouteId(DataRouterStateHook.UseLoaderData);\n  if (state.errors && state.errors[routeId] != null) {\n    console.error(\"You cannot `useLoaderData` in an errorElement (routeId: \" + routeId + \")\");\n    return undefined;\n  }\n  return state.loaderData[routeId];\n}\n\n/**\n * Returns the loaderData for the given routeId\n */\nfunction useRouteLoaderData(routeId) {\n  let state = useDataRouterState(DataRouterStateHook.UseRouteLoaderData);\n  return state.loaderData[routeId];\n}\n\n/**\n * Returns the action data for the nearest ancestor Route action\n */\nfunction useActionData() {\n  let state = useDataRouterState(DataRouterStateHook.UseActionData);\n  let routeId = useCurrentRouteId(DataRouterStateHook.UseLoaderData);\n  return state.actionData ? state.actionData[routeId] : undefined;\n}\n\n/**\n * Returns the nearest ancestor Route error, which could be a loader/action\n * error or a render error.  This is intended to be called from your\n * ErrorBoundary/errorElement to display a proper error message.\n */\nfunction useRouteError() {\n  var _state$errors;\n  let error = React.useContext(RouteErrorContext);\n  let state = useDataRouterState(DataRouterStateHook.UseRouteError);\n  let routeId = useCurrentRouteId(DataRouterStateHook.UseRouteError);\n\n  // If this was a render error, we put it in a RouteError context inside\n  // of RenderErrorBoundary\n  if (error !== undefined) {\n    return error;\n  }\n\n  // Otherwise look for errors from our data router state\n  return (_state$errors = state.errors) == null ? void 0 : _state$errors[routeId];\n}\n\n/**\n * Returns the happy-path data from the nearest ancestor `<Await />` value\n */\nfunction useAsyncValue() {\n  let value = React.useContext(AwaitContext);\n  return value == null ? void 0 : value._data;\n}\n\n/**\n * Returns the error from the nearest ancestor `<Await />` value\n */\nfunction useAsyncError() {\n  let value = React.useContext(AwaitContext);\n  return value == null ? void 0 : value._error;\n}\nlet blockerId = 0;\n\n/**\n * Allow the application to block navigations within the SPA and present the\n * user a confirmation dialog to confirm the navigation.  Mostly used to avoid\n * using half-filled form data.  This does not handle hard-reloads or\n * cross-origin navigations.\n */\nfunction useBlocker(shouldBlock) {\n  let {\n    router,\n    basename\n  } = useDataRouterContext(DataRouterHook.UseBlocker);\n  let state = useDataRouterState(DataRouterStateHook.UseBlocker);\n  let [blockerKey, setBlockerKey] = React.useState(\"\");\n  let blockerFunction = React.useCallback(arg => {\n    if (typeof shouldBlock !== \"function\") {\n      return !!shouldBlock;\n    }\n    if (basename === \"/\") {\n      return shouldBlock(arg);\n    }\n\n    // If they provided us a function and we've got an active basename, strip\n    // it from the locations we expose to the user to match the behavior of\n    // useLocation\n    let {\n      currentLocation,\n      nextLocation,\n      historyAction\n    } = arg;\n    return shouldBlock({\n      currentLocation: _extends({}, currentLocation, {\n        pathname: stripBasename(currentLocation.pathname, basename) || currentLocation.pathname\n      }),\n      nextLocation: _extends({}, nextLocation, {\n        pathname: stripBasename(nextLocation.pathname, basename) || nextLocation.pathname\n      }),\n      historyAction\n    });\n  }, [basename, shouldBlock]);\n\n  // This effect is in charge of blocker key assignment and deletion (which is\n  // tightly coupled to the key)\n  React.useEffect(() => {\n    let key = String(++blockerId);\n    setBlockerKey(key);\n    return () => router.deleteBlocker(key);\n  }, [router]);\n\n  // This effect handles assigning the blockerFunction.  This is to handle\n  // unstable blocker function identities, and happens only after the prior\n  // effect so we don't get an orphaned blockerFunction in the router with a\n  // key of \"\".  Until then we just have the IDLE_BLOCKER.\n  React.useEffect(() => {\n    if (blockerKey !== \"\") {\n      router.getBlocker(blockerKey, blockerFunction);\n    }\n  }, [router, blockerKey, blockerFunction]);\n\n  // Prefer the blocker from `state` not `router.state` since DataRouterContext\n  // is memoized so this ensures we update on blocker state updates\n  return blockerKey && state.blockers.has(blockerKey) ? state.blockers.get(blockerKey) : IDLE_BLOCKER;\n}\n\n/**\n * Stable version of useNavigate that is used when we are in the context of\n * a RouterProvider.\n */\nfunction useNavigateStable() {\n  let {\n    router\n  } = useDataRouterContext(DataRouterHook.UseNavigateStable);\n  let id = useCurrentRouteId(DataRouterStateHook.UseNavigateStable);\n  let activeRef = React.useRef(false);\n  useIsomorphicLayoutEffect(() => {\n    activeRef.current = true;\n  });\n  let navigate = React.useCallback(function (to, options) {\n    if (options === void 0) {\n      options = {};\n    }\n    process.env.NODE_ENV !== \"production\" ? UNSAFE_warning(activeRef.current, navigateEffectWarning) : void 0;\n\n    // Short circuit here since if this happens on first render the navigate\n    // is useless because we haven't wired up our router subscriber yet\n    if (!activeRef.current) return;\n    if (typeof to === \"number\") {\n      router.navigate(to);\n    } else {\n      router.navigate(to, _extends({\n        fromRouteId: id\n      }, options));\n    }\n  }, [router, id]);\n  return navigate;\n}\nconst alreadyWarned$1 = {};\nfunction warningOnce(key, cond, message) {\n  if (!cond && !alreadyWarned$1[key]) {\n    alreadyWarned$1[key] = true;\n    process.env.NODE_ENV !== \"production\" ? UNSAFE_warning(false, message) : void 0;\n  }\n}\n\nconst alreadyWarned = {};\nfunction warnOnce(key, message) {\n  if (process.env.NODE_ENV !== \"production\" && !alreadyWarned[message]) {\n    alreadyWarned[message] = true;\n    console.warn(message);\n  }\n}\nconst logDeprecation = (flag, msg, link) => warnOnce(flag, \"\\u26A0\\uFE0F React Router Future Flag Warning: \" + msg + \". \" + (\"You can use the `\" + flag + \"` future flag to opt-in early. \") + (\"For more information, see \" + link + \".\"));\nfunction logV6DeprecationWarnings(renderFuture, routerFuture) {\n  if ((renderFuture == null ? void 0 : renderFuture.v7_startTransition) === undefined) {\n    logDeprecation(\"v7_startTransition\", \"React Router will begin wrapping state updates in `React.startTransition` in v7\", \"https://reactrouter.com/v6/upgrading/future#v7_starttransition\");\n  }\n  if ((renderFuture == null ? void 0 : renderFuture.v7_relativeSplatPath) === undefined && (!routerFuture || routerFuture.v7_relativeSplatPath === undefined)) {\n    logDeprecation(\"v7_relativeSplatPath\", \"Relative route resolution within Splat routes is changing in v7\", \"https://reactrouter.com/v6/upgrading/future#v7_relativesplatpath\");\n  }\n  if (routerFuture) {\n    if (routerFuture.v7_fetcherPersist === undefined) {\n      logDeprecation(\"v7_fetcherPersist\", \"The persistence behavior of fetchers is changing in v7\", \"https://reactrouter.com/v6/upgrading/future#v7_fetcherpersist\");\n    }\n    if (routerFuture.v7_normalizeFormMethod === undefined) {\n      logDeprecation(\"v7_normalizeFormMethod\", \"Casing of `formMethod` fields is being normalized to uppercase in v7\", \"https://reactrouter.com/v6/upgrading/future#v7_normalizeformmethod\");\n    }\n    if (routerFuture.v7_partialHydration === undefined) {\n      logDeprecation(\"v7_partialHydration\", \"`RouterProvider` hydration behavior is changing in v7\", \"https://reactrouter.com/v6/upgrading/future#v7_partialhydration\");\n    }\n    if (routerFuture.v7_skipActionErrorRevalidation === undefined) {\n      logDeprecation(\"v7_skipActionErrorRevalidation\", \"The revalidation behavior after 4xx/5xx `action` responses is changing in v7\", \"https://reactrouter.com/v6/upgrading/future#v7_skipactionerrorrevalidation\");\n    }\n  }\n}\n\n/**\n  Webpack + React 17 fails to compile on any of the following because webpack\n  complains that `startTransition` doesn't exist in `React`:\n  * import { startTransition } from \"react\"\n  * import * as React from from \"react\";\n    \"startTransition\" in React ? React.startTransition(() => setState()) : setState()\n  * import * as React from from \"react\";\n    \"startTransition\" in React ? React[\"startTransition\"](() => setState()) : setState()\n\n  Moving it to a constant such as the following solves the Webpack/React 17 issue:\n  * import * as React from from \"react\";\n    const START_TRANSITION = \"startTransition\";\n    START_TRANSITION in React ? React[START_TRANSITION](() => setState()) : setState()\n\n  However, that introduces webpack/terser minification issues in production builds\n  in React 18 where minification/obfuscation ends up removing the call of\n  React.startTransition entirely from the first half of the ternary.  Grabbing\n  this exported reference once up front resolves that issue.\n\n  See https://github.com/remix-run/react-router/issues/10579\n*/\nconst START_TRANSITION = \"startTransition\";\nconst startTransitionImpl = React[START_TRANSITION];\n\n/**\n * Given a Remix Router instance, render the appropriate UI\n */\nfunction RouterProvider(_ref) {\n  let {\n    fallbackElement,\n    router,\n    future\n  } = _ref;\n  let [state, setStateImpl] = React.useState(router.state);\n  let {\n    v7_startTransition\n  } = future || {};\n  let setState = React.useCallback(newState => {\n    if (v7_startTransition && startTransitionImpl) {\n      startTransitionImpl(() => setStateImpl(newState));\n    } else {\n      setStateImpl(newState);\n    }\n  }, [setStateImpl, v7_startTransition]);\n\n  // Need to use a layout effect here so we are subscribed early enough to\n  // pick up on any render-driven redirects/navigations (useEffect/<Navigate>)\n  React.useLayoutEffect(() => router.subscribe(setState), [router, setState]);\n  React.useEffect(() => {\n    process.env.NODE_ENV !== \"production\" ? UNSAFE_warning(fallbackElement == null || !router.future.v7_partialHydration, \"`<RouterProvider fallbackElement>` is deprecated when using \" + \"`v7_partialHydration`, use a `HydrateFallback` component instead\") : void 0;\n    // Only log this once on initial mount\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n  let navigator = React.useMemo(() => {\n    return {\n      createHref: router.createHref,\n      encodeLocation: router.encodeLocation,\n      go: n => router.navigate(n),\n      push: (to, state, opts) => router.navigate(to, {\n        state,\n        preventScrollReset: opts == null ? void 0 : opts.preventScrollReset\n      }),\n      replace: (to, state, opts) => router.navigate(to, {\n        replace: true,\n        state,\n        preventScrollReset: opts == null ? void 0 : opts.preventScrollReset\n      })\n    };\n  }, [router]);\n  let basename = router.basename || \"/\";\n  let dataRouterContext = React.useMemo(() => ({\n    router,\n    navigator,\n    static: false,\n    basename\n  }), [router, navigator, basename]);\n  React.useEffect(() => logV6DeprecationWarnings(future, router.future), [router, future]);\n\n  // The fragment and {null} here are important!  We need them to keep React 18's\n  // useId happy when we are server-rendering since we may have a <script> here\n  // containing the hydrated server-side staticContext (from StaticRouterProvider).\n  // useId relies on the component tree structure to generate deterministic id's\n  // so we need to ensure it remains the same on the client even though\n  // we don't need the <script> tag\n  return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(DataRouterContext.Provider, {\n    value: dataRouterContext\n  }, /*#__PURE__*/React.createElement(DataRouterStateContext.Provider, {\n    value: state\n  }, /*#__PURE__*/React.createElement(Router, {\n    basename: basename,\n    location: state.location,\n    navigationType: state.historyAction,\n    navigator: navigator,\n    future: {\n      v7_relativeSplatPath: router.future.v7_relativeSplatPath\n    }\n  }, state.initialized || router.future.v7_partialHydration ? /*#__PURE__*/React.createElement(DataRoutes, {\n    routes: router.routes,\n    future: router.future,\n    state: state\n  }) : fallbackElement))), null);\n}\nfunction DataRoutes(_ref2) {\n  let {\n    routes,\n    future,\n    state\n  } = _ref2;\n  return useRoutesImpl(routes, undefined, state, future);\n}\n/**\n * A `<Router>` that stores all entries in memory.\n *\n * @see https://reactrouter.com/v6/router-components/memory-router\n */\nfunction MemoryRouter(_ref3) {\n  let {\n    basename,\n    children,\n    initialEntries,\n    initialIndex,\n    future\n  } = _ref3;\n  let historyRef = React.useRef();\n  if (historyRef.current == null) {\n    historyRef.current = createMemoryHistory({\n      initialEntries,\n      initialIndex,\n      v5Compat: true\n    });\n  }\n  let history = historyRef.current;\n  let [state, setStateImpl] = React.useState({\n    action: history.action,\n    location: history.location\n  });\n  let {\n    v7_startTransition\n  } = future || {};\n  let setState = React.useCallback(newState => {\n    v7_startTransition && startTransitionImpl ? startTransitionImpl(() => setStateImpl(newState)) : setStateImpl(newState);\n  }, [setStateImpl, v7_startTransition]);\n  React.useLayoutEffect(() => history.listen(setState), [history, setState]);\n  React.useEffect(() => logV6DeprecationWarnings(future), [future]);\n  return /*#__PURE__*/React.createElement(Router, {\n    basename: basename,\n    children: children,\n    location: state.location,\n    navigationType: state.action,\n    navigator: history,\n    future: future\n  });\n}\n/**\n * Changes the current location.\n *\n * Note: This API is mostly useful in React.Component subclasses that are not\n * able to use hooks. In functional components, we recommend you use the\n * `useNavigate` hook instead.\n *\n * @see https://reactrouter.com/v6/components/navigate\n */\nfunction Navigate(_ref4) {\n  let {\n    to,\n    replace,\n    state,\n    relative\n  } = _ref4;\n  !useInRouterContext() ? process.env.NODE_ENV !== \"production\" ? UNSAFE_invariant(false, // TODO: This error is probably because they somehow have 2 versions of\n  // the router loaded. We can help them understand how to avoid that.\n  \"<Navigate> may be used only in the context of a <Router> component.\") : UNSAFE_invariant(false) : void 0;\n  let {\n    future,\n    static: isStatic\n  } = React.useContext(NavigationContext);\n  process.env.NODE_ENV !== \"production\" ? UNSAFE_warning(!isStatic, \"<Navigate> must not be used on the initial render in a <StaticRouter>. \" + \"This is a no-op, but you should modify your code so the <Navigate> is \" + \"only ever rendered in response to some user interaction or state change.\") : void 0;\n  let {\n    matches\n  } = React.useContext(RouteContext);\n  let {\n    pathname: locationPathname\n  } = useLocation();\n  let navigate = useNavigate();\n\n  // Resolve the path outside of the effect so that when effects run twice in\n  // StrictMode they navigate to the same place\n  let path = resolveTo(to, UNSAFE_getResolveToMatches(matches, future.v7_relativeSplatPath), locationPathname, relative === \"path\");\n  let jsonPath = JSON.stringify(path);\n  React.useEffect(() => navigate(JSON.parse(jsonPath), {\n    replace,\n    state,\n    relative\n  }), [navigate, jsonPath, relative, replace, state]);\n  return null;\n}\n/**\n * Renders the child route's element, if there is one.\n *\n * @see https://reactrouter.com/v6/components/outlet\n */\nfunction Outlet(props) {\n  return useOutlet(props.context);\n}\n/**\n * Declares an element that should be rendered at a certain URL path.\n *\n * @see https://reactrouter.com/v6/components/route\n */\nfunction Route(_props) {\n  process.env.NODE_ENV !== \"production\" ? UNSAFE_invariant(false, \"A <Route> is only ever to be used as the child of <Routes> element, \" + \"never rendered directly. Please wrap your <Route> in a <Routes>.\") : UNSAFE_invariant(false) ;\n}\n/**\n * Provides location context for the rest of the app.\n *\n * Note: You usually won't render a `<Router>` directly. Instead, you'll render a\n * router that is more specific to your environment such as a `<BrowserRouter>`\n * in web browsers or a `<StaticRouter>` for server rendering.\n *\n * @see https://reactrouter.com/v6/router-components/router\n */\nfunction Router(_ref5) {\n  let {\n    basename: basenameProp = \"/\",\n    children = null,\n    location: locationProp,\n    navigationType = Action.Pop,\n    navigator,\n    static: staticProp = false,\n    future\n  } = _ref5;\n  !!useInRouterContext() ? process.env.NODE_ENV !== \"production\" ? UNSAFE_invariant(false, \"You cannot render a <Router> inside another <Router>.\" + \" You should never have more than one in your app.\") : UNSAFE_invariant(false) : void 0;\n\n  // Preserve trailing slashes on basename, so we can let the user control\n  // the enforcement of trailing slashes throughout the app\n  let basename = basenameProp.replace(/^\\/*/, \"/\");\n  let navigationContext = React.useMemo(() => ({\n    basename,\n    navigator,\n    static: staticProp,\n    future: _extends({\n      v7_relativeSplatPath: false\n    }, future)\n  }), [basename, future, navigator, staticProp]);\n  if (typeof locationProp === \"string\") {\n    locationProp = parsePath(locationProp);\n  }\n  let {\n    pathname = \"/\",\n    search = \"\",\n    hash = \"\",\n    state = null,\n    key = \"default\"\n  } = locationProp;\n  let locationContext = React.useMemo(() => {\n    let trailingPathname = stripBasename(pathname, basename);\n    if (trailingPathname == null) {\n      return null;\n    }\n    return {\n      location: {\n        pathname: trailingPathname,\n        search,\n        hash,\n        state,\n        key\n      },\n      navigationType\n    };\n  }, [basename, pathname, search, hash, state, key, navigationType]);\n  process.env.NODE_ENV !== \"production\" ? UNSAFE_warning(locationContext != null, \"<Router basename=\\\"\" + basename + \"\\\"> is not able to match the URL \" + (\"\\\"\" + pathname + search + hash + \"\\\" because it does not start with the \") + \"basename, so the <Router> won't render anything.\") : void 0;\n  if (locationContext == null) {\n    return null;\n  }\n  return /*#__PURE__*/React.createElement(NavigationContext.Provider, {\n    value: navigationContext\n  }, /*#__PURE__*/React.createElement(LocationContext.Provider, {\n    children: children,\n    value: locationContext\n  }));\n}\n/**\n * A container for a nested tree of `<Route>` elements that renders the branch\n * that best matches the current location.\n *\n * @see https://reactrouter.com/v6/components/routes\n */\nfunction Routes(_ref6) {\n  let {\n    children,\n    location\n  } = _ref6;\n  return useRoutes(createRoutesFromChildren(children), location);\n}\n/**\n * Component to use for rendering lazily loaded data from returning defer()\n * in a loader function\n */\nfunction Await(_ref7) {\n  let {\n    children,\n    errorElement,\n    resolve\n  } = _ref7;\n  return /*#__PURE__*/React.createElement(AwaitErrorBoundary, {\n    resolve: resolve,\n    errorElement: errorElement\n  }, /*#__PURE__*/React.createElement(ResolveAwait, null, children));\n}\nvar AwaitRenderStatus = /*#__PURE__*/function (AwaitRenderStatus) {\n  AwaitRenderStatus[AwaitRenderStatus[\"pending\"] = 0] = \"pending\";\n  AwaitRenderStatus[AwaitRenderStatus[\"success\"] = 1] = \"success\";\n  AwaitRenderStatus[AwaitRenderStatus[\"error\"] = 2] = \"error\";\n  return AwaitRenderStatus;\n}(AwaitRenderStatus || {});\nconst neverSettledPromise = new Promise(() => {});\nclass AwaitErrorBoundary extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      error: null\n    };\n  }\n  static getDerivedStateFromError(error) {\n    return {\n      error\n    };\n  }\n  componentDidCatch(error, errorInfo) {\n    console.error(\"<Await> caught the following error during render\", error, errorInfo);\n  }\n  render() {\n    let {\n      children,\n      errorElement,\n      resolve\n    } = this.props;\n    let promise = null;\n    let status = AwaitRenderStatus.pending;\n    if (!(resolve instanceof Promise)) {\n      // Didn't get a promise - provide as a resolved promise\n      status = AwaitRenderStatus.success;\n      promise = Promise.resolve();\n      Object.defineProperty(promise, \"_tracked\", {\n        get: () => true\n      });\n      Object.defineProperty(promise, \"_data\", {\n        get: () => resolve\n      });\n    } else if (this.state.error) {\n      // Caught a render error, provide it as a rejected promise\n      status = AwaitRenderStatus.error;\n      let renderError = this.state.error;\n      promise = Promise.reject().catch(() => {}); // Avoid unhandled rejection warnings\n      Object.defineProperty(promise, \"_tracked\", {\n        get: () => true\n      });\n      Object.defineProperty(promise, \"_error\", {\n        get: () => renderError\n      });\n    } else if (resolve._tracked) {\n      // Already tracked promise - check contents\n      promise = resolve;\n      status = \"_error\" in promise ? AwaitRenderStatus.error : \"_data\" in promise ? AwaitRenderStatus.success : AwaitRenderStatus.pending;\n    } else {\n      // Raw (untracked) promise - track it\n      status = AwaitRenderStatus.pending;\n      Object.defineProperty(resolve, \"_tracked\", {\n        get: () => true\n      });\n      promise = resolve.then(data => Object.defineProperty(resolve, \"_data\", {\n        get: () => data\n      }), error => Object.defineProperty(resolve, \"_error\", {\n        get: () => error\n      }));\n    }\n    if (status === AwaitRenderStatus.error && promise._error instanceof AbortedDeferredError) {\n      // Freeze the UI by throwing a never resolved promise\n      throw neverSettledPromise;\n    }\n    if (status === AwaitRenderStatus.error && !errorElement) {\n      // No errorElement, throw to the nearest route-level error boundary\n      throw promise._error;\n    }\n    if (status === AwaitRenderStatus.error) {\n      // Render via our errorElement\n      return /*#__PURE__*/React.createElement(AwaitContext.Provider, {\n        value: promise,\n        children: errorElement\n      });\n    }\n    if (status === AwaitRenderStatus.success) {\n      // Render children with resolved value\n      return /*#__PURE__*/React.createElement(AwaitContext.Provider, {\n        value: promise,\n        children: children\n      });\n    }\n\n    // Throw to the suspense boundary\n    throw promise;\n  }\n}\n\n/**\n * @private\n * Indirection to leverage useAsyncValue for a render-prop API on `<Await>`\n */\nfunction ResolveAwait(_ref8) {\n  let {\n    children\n  } = _ref8;\n  let data = useAsyncValue();\n  let toRender = typeof children === \"function\" ? children(data) : children;\n  return /*#__PURE__*/React.createElement(React.Fragment, null, toRender);\n}\n\n///////////////////////////////////////////////////////////////////////////////\n// UTILS\n///////////////////////////////////////////////////////////////////////////////\n\n/**\n * Creates a route config from a React \"children\" object, which is usually\n * either a `<Route>` element or an array of them. Used internally by\n * `<Routes>` to create a route config from its children.\n *\n * @see https://reactrouter.com/v6/utils/create-routes-from-children\n */\nfunction createRoutesFromChildren(children, parentPath) {\n  if (parentPath === void 0) {\n    parentPath = [];\n  }\n  let routes = [];\n  React.Children.forEach(children, (element, index) => {\n    if (! /*#__PURE__*/React.isValidElement(element)) {\n      // Ignore non-elements. This allows people to more easily inline\n      // conditionals in their route config.\n      return;\n    }\n    let treePath = [...parentPath, index];\n    if (element.type === React.Fragment) {\n      // Transparently support React.Fragment and its children.\n      routes.push.apply(routes, createRoutesFromChildren(element.props.children, treePath));\n      return;\n    }\n    !(element.type === Route) ? process.env.NODE_ENV !== \"production\" ? UNSAFE_invariant(false, \"[\" + (typeof element.type === \"string\" ? element.type : element.type.name) + \"] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>\") : UNSAFE_invariant(false) : void 0;\n    !(!element.props.index || !element.props.children) ? process.env.NODE_ENV !== \"production\" ? UNSAFE_invariant(false, \"An index route cannot have child routes.\") : UNSAFE_invariant(false) : void 0;\n    let route = {\n      id: element.props.id || treePath.join(\"-\"),\n      caseSensitive: element.props.caseSensitive,\n      element: element.props.element,\n      Component: element.props.Component,\n      index: element.props.index,\n      path: element.props.path,\n      loader: element.props.loader,\n      action: element.props.action,\n      errorElement: element.props.errorElement,\n      ErrorBoundary: element.props.ErrorBoundary,\n      hasErrorBoundary: element.props.ErrorBoundary != null || element.props.errorElement != null,\n      shouldRevalidate: element.props.shouldRevalidate,\n      handle: element.props.handle,\n      lazy: element.props.lazy\n    };\n    if (element.props.children) {\n      route.children = createRoutesFromChildren(element.props.children, treePath);\n    }\n    routes.push(route);\n  });\n  return routes;\n}\n\n/**\n * Renders the result of `matchRoutes()` into a React element.\n */\nfunction renderMatches(matches) {\n  return _renderMatches(matches);\n}\n\nfunction mapRouteProperties(route) {\n  let updates = {\n    // Note: this check also occurs in createRoutesFromChildren so update\n    // there if you change this -- please and thank you!\n    hasErrorBoundary: route.ErrorBoundary != null || route.errorElement != null\n  };\n  if (route.Component) {\n    if (process.env.NODE_ENV !== \"production\") {\n      if (route.element) {\n        process.env.NODE_ENV !== \"production\" ? UNSAFE_warning(false, \"You should not include both `Component` and `element` on your route - \" + \"`Component` will be used.\") : void 0;\n      }\n    }\n    Object.assign(updates, {\n      element: /*#__PURE__*/React.createElement(route.Component),\n      Component: undefined\n    });\n  }\n  if (route.HydrateFallback) {\n    if (process.env.NODE_ENV !== \"production\") {\n      if (route.hydrateFallbackElement) {\n        process.env.NODE_ENV !== \"production\" ? UNSAFE_warning(false, \"You should not include both `HydrateFallback` and `hydrateFallbackElement` on your route - \" + \"`HydrateFallback` will be used.\") : void 0;\n      }\n    }\n    Object.assign(updates, {\n      hydrateFallbackElement: /*#__PURE__*/React.createElement(route.HydrateFallback),\n      HydrateFallback: undefined\n    });\n  }\n  if (route.ErrorBoundary) {\n    if (process.env.NODE_ENV !== \"production\") {\n      if (route.errorElement) {\n        process.env.NODE_ENV !== \"production\" ? UNSAFE_warning(false, \"You should not include both `ErrorBoundary` and `errorElement` on your route - \" + \"`ErrorBoundary` will be used.\") : void 0;\n      }\n    }\n    Object.assign(updates, {\n      errorElement: /*#__PURE__*/React.createElement(route.ErrorBoundary),\n      ErrorBoundary: undefined\n    });\n  }\n  return updates;\n}\nfunction createMemoryRouter(routes, opts) {\n  return createRouter({\n    basename: opts == null ? void 0 : opts.basename,\n    future: _extends({}, opts == null ? void 0 : opts.future, {\n      v7_prependBasename: true\n    }),\n    history: createMemoryHistory({\n      initialEntries: opts == null ? void 0 : opts.initialEntries,\n      initialIndex: opts == null ? void 0 : opts.initialIndex\n    }),\n    hydrationData: opts == null ? void 0 : opts.hydrationData,\n    routes,\n    mapRouteProperties,\n    dataStrategy: opts == null ? void 0 : opts.dataStrategy,\n    patchRoutesOnNavigation: opts == null ? void 0 : opts.patchRoutesOnNavigation\n  }).initialize();\n}\n\nexport { Await, MemoryRouter, Navigate, Outlet, Route, Router, RouterProvider, Routes, DataRouterContext as UNSAFE_DataRouterContext, DataRouterStateContext as UNSAFE_DataRouterStateContext, LocationContext as UNSAFE_LocationContext, NavigationContext as UNSAFE_NavigationContext, RouteContext as UNSAFE_RouteContext, logV6DeprecationWarnings as UNSAFE_logV6DeprecationWarnings, mapRouteProperties as UNSAFE_mapRouteProperties, useRouteId as UNSAFE_useRouteId, useRoutesImpl as UNSAFE_useRoutesImpl, createMemoryRouter, createRoutesFromChildren, createRoutesFromChildren as createRoutesFromElements, renderMatches, useActionData, useAsyncError, useAsyncValue, useBlocker, useHref, useInRouterContext, useLoaderData, useLocation, useMatch, useMatches, useNavigate, useNavigation, useNavigationType, useOutlet, useOutletContext, useParams, useResolvedPath, useRevalidator, useRouteError, useRouteLoaderData, useRoutes };\n//# sourceMappingURL=index.js.map\n","/**\n * React Router DOM v6.30.3\n *\n * Copyright (c) Remix Software Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE.md file in the root directory of this source tree.\n *\n * @license MIT\n */\nimport * as React from 'react';\nimport * as ReactDOM from 'react-dom';\nimport { UNSAFE_mapRouteProperties, UNSAFE_logV6DeprecationWarnings, UNSAFE_DataRouterContext, UNSAFE_DataRouterStateContext, Router, UNSAFE_useRoutesImpl, UNSAFE_NavigationContext, useHref, useResolvedPath, useLocation, useNavigate, createPath, UNSAFE_useRouteId, UNSAFE_RouteContext, useMatches, useNavigation, useBlocker } from 'react-router';\nexport { AbortedDeferredError, Await, MemoryRouter, Navigate, NavigationType, Outlet, Route, Router, Routes, UNSAFE_DataRouterContext, UNSAFE_DataRouterStateContext, UNSAFE_LocationContext, UNSAFE_NavigationContext, UNSAFE_RouteContext, UNSAFE_useRouteId, createMemoryRouter, createPath, createRoutesFromChildren, createRoutesFromElements, defer, generatePath, isRouteErrorResponse, json, matchPath, matchRoutes, parsePath, redirect, redirectDocument, renderMatches, replace, resolvePath, useActionData, useAsyncError, useAsyncValue, useBlocker, useHref, useInRouterContext, useLoaderData, useLocation, useMatch, useMatches, useNavigate, useNavigation, useNavigationType, useOutlet, useOutletContext, useParams, useResolvedPath, useRevalidator, useRouteError, useRouteLoaderData, useRoutes } from 'react-router';\nimport { stripBasename, UNSAFE_warning, createRouter, createBrowserHistory, createHashHistory, UNSAFE_ErrorResponseImpl, UNSAFE_invariant, joinPaths, IDLE_FETCHER, matchPath } from '@remix-run/router';\nexport { UNSAFE_ErrorResponseImpl } from '@remix-run/router';\n\nfunction _extends() {\n  _extends = Object.assign ? Object.assign.bind() : function (target) {\n    for (var i = 1; i < arguments.length; i++) {\n      var source = arguments[i];\n      for (var key in source) {\n        if (Object.prototype.hasOwnProperty.call(source, key)) {\n          target[key] = source[key];\n        }\n      }\n    }\n    return target;\n  };\n  return _extends.apply(this, arguments);\n}\nfunction _objectWithoutPropertiesLoose(source, excluded) {\n  if (source == null) return {};\n  var target = {};\n  var sourceKeys = Object.keys(source);\n  var key, i;\n  for (i = 0; i < sourceKeys.length; i++) {\n    key = sourceKeys[i];\n    if (excluded.indexOf(key) >= 0) continue;\n    target[key] = source[key];\n  }\n  return target;\n}\n\nconst defaultMethod = \"get\";\nconst defaultEncType = \"application/x-www-form-urlencoded\";\nfunction isHtmlElement(object) {\n  return object != null && typeof object.tagName === \"string\";\n}\nfunction isButtonElement(object) {\n  return isHtmlElement(object) && object.tagName.toLowerCase() === \"button\";\n}\nfunction isFormElement(object) {\n  return isHtmlElement(object) && object.tagName.toLowerCase() === \"form\";\n}\nfunction isInputElement(object) {\n  return isHtmlElement(object) && object.tagName.toLowerCase() === \"input\";\n}\nfunction isModifiedEvent(event) {\n  return !!(event.metaKey || event.altKey || event.ctrlKey || event.shiftKey);\n}\nfunction shouldProcessLinkClick(event, target) {\n  return event.button === 0 && (\n  // Ignore everything but left clicks\n  !target || target === \"_self\") &&\n  // Let browser handle \"target=_blank\" etc.\n  !isModifiedEvent(event) // Ignore clicks with modifier keys\n  ;\n}\n/**\n * Creates a URLSearchParams object using the given initializer.\n *\n * This is identical to `new URLSearchParams(init)` except it also\n * supports arrays as values in the object form of the initializer\n * instead of just strings. This is convenient when you need multiple\n * values for a given key, but don't want to use an array initializer.\n *\n * For example, instead of:\n *\n *   let searchParams = new URLSearchParams([\n *     ['sort', 'name'],\n *     ['sort', 'price']\n *   ]);\n *\n * you can do:\n *\n *   let searchParams = createSearchParams({\n *     sort: ['name', 'price']\n *   });\n */\nfunction createSearchParams(init) {\n  if (init === void 0) {\n    init = \"\";\n  }\n  return new URLSearchParams(typeof init === \"string\" || Array.isArray(init) || init instanceof URLSearchParams ? init : Object.keys(init).reduce((memo, key) => {\n    let value = init[key];\n    return memo.concat(Array.isArray(value) ? value.map(v => [key, v]) : [[key, value]]);\n  }, []));\n}\nfunction getSearchParamsForLocation(locationSearch, defaultSearchParams) {\n  let searchParams = createSearchParams(locationSearch);\n  if (defaultSearchParams) {\n    // Use `defaultSearchParams.forEach(...)` here instead of iterating of\n    // `defaultSearchParams.keys()` to work-around a bug in Firefox related to\n    // web extensions. Relevant Bugzilla tickets:\n    // https://bugzilla.mozilla.org/show_bug.cgi?id=1414602\n    // https://bugzilla.mozilla.org/show_bug.cgi?id=1023984\n    defaultSearchParams.forEach((_, key) => {\n      if (!searchParams.has(key)) {\n        defaultSearchParams.getAll(key).forEach(value => {\n          searchParams.append(key, value);\n        });\n      }\n    });\n  }\n  return searchParams;\n}\n// One-time check for submitter support\nlet _formDataSupportsSubmitter = null;\nfunction isFormDataSubmitterSupported() {\n  if (_formDataSupportsSubmitter === null) {\n    try {\n      new FormData(document.createElement(\"form\"),\n      // @ts-expect-error if FormData supports the submitter parameter, this will throw\n      0);\n      _formDataSupportsSubmitter = false;\n    } catch (e) {\n      _formDataSupportsSubmitter = true;\n    }\n  }\n  return _formDataSupportsSubmitter;\n}\nconst supportedFormEncTypes = new Set([\"application/x-www-form-urlencoded\", \"multipart/form-data\", \"text/plain\"]);\nfunction getFormEncType(encType) {\n  if (encType != null && !supportedFormEncTypes.has(encType)) {\n    process.env.NODE_ENV !== \"production\" ? UNSAFE_warning(false, \"\\\"\" + encType + \"\\\" is not a valid `encType` for `<Form>`/`<fetcher.Form>` \" + (\"and will default to \\\"\" + defaultEncType + \"\\\"\")) : void 0;\n    return null;\n  }\n  return encType;\n}\nfunction getFormSubmissionInfo(target, basename) {\n  let method;\n  let action;\n  let encType;\n  let formData;\n  let body;\n  if (isFormElement(target)) {\n    // When grabbing the action from the element, it will have had the basename\n    // prefixed to ensure non-JS scenarios work, so strip it since we'll\n    // re-prefix in the router\n    let attr = target.getAttribute(\"action\");\n    action = attr ? stripBasename(attr, basename) : null;\n    method = target.getAttribute(\"method\") || defaultMethod;\n    encType = getFormEncType(target.getAttribute(\"enctype\")) || defaultEncType;\n    formData = new FormData(target);\n  } else if (isButtonElement(target) || isInputElement(target) && (target.type === \"submit\" || target.type === \"image\")) {\n    let form = target.form;\n    if (form == null) {\n      throw new Error(\"Cannot submit a <button> or <input type=\\\"submit\\\"> without a <form>\");\n    }\n    // <button>/<input type=\"submit\"> may override attributes of <form>\n    // When grabbing the action from the element, it will have had the basename\n    // prefixed to ensure non-JS scenarios work, so strip it since we'll\n    // re-prefix in the router\n    let attr = target.getAttribute(\"formaction\") || form.getAttribute(\"action\");\n    action = attr ? stripBasename(attr, basename) : null;\n    method = target.getAttribute(\"formmethod\") || form.getAttribute(\"method\") || defaultMethod;\n    encType = getFormEncType(target.getAttribute(\"formenctype\")) || getFormEncType(form.getAttribute(\"enctype\")) || defaultEncType;\n    // Build a FormData object populated from a form and submitter\n    formData = new FormData(form, target);\n    // If this browser doesn't support the `FormData(el, submitter)` format,\n    // then tack on the submitter value at the end.  This is a lightweight\n    // solution that is not 100% spec compliant.  For complete support in older\n    // browsers, consider using the `formdata-submitter-polyfill` package\n    if (!isFormDataSubmitterSupported()) {\n      let {\n        name,\n        type,\n        value\n      } = target;\n      if (type === \"image\") {\n        let prefix = name ? name + \".\" : \"\";\n        formData.append(prefix + \"x\", \"0\");\n        formData.append(prefix + \"y\", \"0\");\n      } else if (name) {\n        formData.append(name, value);\n      }\n    }\n  } else if (isHtmlElement(target)) {\n    throw new Error(\"Cannot submit element that is not <form>, <button>, or \" + \"<input type=\\\"submit|image\\\">\");\n  } else {\n    method = defaultMethod;\n    action = null;\n    encType = defaultEncType;\n    body = target;\n  }\n  // Send body for <Form encType=\"text/plain\" so we encode it into text\n  if (formData && encType === \"text/plain\") {\n    body = formData;\n    formData = undefined;\n  }\n  return {\n    action,\n    method: method.toLowerCase(),\n    encType,\n    formData,\n    body\n  };\n}\n\nconst _excluded = [\"onClick\", \"relative\", \"reloadDocument\", \"replace\", \"state\", \"target\", \"to\", \"preventScrollReset\", \"viewTransition\"],\n  _excluded2 = [\"aria-current\", \"caseSensitive\", \"className\", \"end\", \"style\", \"to\", \"viewTransition\", \"children\"],\n  _excluded3 = [\"fetcherKey\", \"navigate\", \"reloadDocument\", \"replace\", \"state\", \"method\", \"action\", \"onSubmit\", \"relative\", \"preventScrollReset\", \"viewTransition\"];\n// HEY YOU! DON'T TOUCH THIS VARIABLE!\n//\n// It is replaced with the proper version at build time via a babel plugin in\n// the rollup config.\n//\n// Export a global property onto the window for React Router detection by the\n// Core Web Vitals Technology Report.  This way they can configure the `wappalyzer`\n// to detect and properly classify live websites as being built with React Router:\n// https://github.com/HTTPArchive/wappalyzer/blob/main/src/technologies/r.json\nconst REACT_ROUTER_VERSION = \"6\";\ntry {\n  window.__reactRouterVersion = REACT_ROUTER_VERSION;\n} catch (e) {\n  // no-op\n}\nfunction createBrowserRouter(routes, opts) {\n  return createRouter({\n    basename: opts == null ? void 0 : opts.basename,\n    future: _extends({}, opts == null ? void 0 : opts.future, {\n      v7_prependBasename: true\n    }),\n    history: createBrowserHistory({\n      window: opts == null ? void 0 : opts.window\n    }),\n    hydrationData: (opts == null ? void 0 : opts.hydrationData) || parseHydrationData(),\n    routes,\n    mapRouteProperties: UNSAFE_mapRouteProperties,\n    dataStrategy: opts == null ? void 0 : opts.dataStrategy,\n    patchRoutesOnNavigation: opts == null ? void 0 : opts.patchRoutesOnNavigation,\n    window: opts == null ? void 0 : opts.window\n  }).initialize();\n}\nfunction createHashRouter(routes, opts) {\n  return createRouter({\n    basename: opts == null ? void 0 : opts.basename,\n    future: _extends({}, opts == null ? void 0 : opts.future, {\n      v7_prependBasename: true\n    }),\n    history: createHashHistory({\n      window: opts == null ? void 0 : opts.window\n    }),\n    hydrationData: (opts == null ? void 0 : opts.hydrationData) || parseHydrationData(),\n    routes,\n    mapRouteProperties: UNSAFE_mapRouteProperties,\n    dataStrategy: opts == null ? void 0 : opts.dataStrategy,\n    patchRoutesOnNavigation: opts == null ? void 0 : opts.patchRoutesOnNavigation,\n    window: opts == null ? void 0 : opts.window\n  }).initialize();\n}\nfunction parseHydrationData() {\n  var _window;\n  let state = (_window = window) == null ? void 0 : _window.__staticRouterHydrationData;\n  if (state && state.errors) {\n    state = _extends({}, state, {\n      errors: deserializeErrors(state.errors)\n    });\n  }\n  return state;\n}\nfunction deserializeErrors(errors) {\n  if (!errors) return null;\n  let entries = Object.entries(errors);\n  let serialized = {};\n  for (let [key, val] of entries) {\n    // Hey you!  If you change this, please change the corresponding logic in\n    // serializeErrors in react-router-dom/server.tsx :)\n    if (val && val.__type === \"RouteErrorResponse\") {\n      serialized[key] = new UNSAFE_ErrorResponseImpl(val.status, val.statusText, val.data, val.internal === true);\n    } else if (val && val.__type === \"Error\") {\n      // Attempt to reconstruct the right type of Error (i.e., ReferenceError)\n      if (val.__subType) {\n        let ErrorConstructor = window[val.__subType];\n        if (typeof ErrorConstructor === \"function\") {\n          try {\n            // @ts-expect-error\n            let error = new ErrorConstructor(val.message);\n            // Wipe away the client-side stack trace.  Nothing to fill it in with\n            // because we don't serialize SSR stack traces for security reasons\n            error.stack = \"\";\n            serialized[key] = error;\n          } catch (e) {\n            // no-op - fall through and create a normal Error\n          }\n        }\n      }\n      if (serialized[key] == null) {\n        let error = new Error(val.message);\n        // Wipe away the client-side stack trace.  Nothing to fill it in with\n        // because we don't serialize SSR stack traces for security reasons\n        error.stack = \"\";\n        serialized[key] = error;\n      }\n    } else {\n      serialized[key] = val;\n    }\n  }\n  return serialized;\n}\nconst ViewTransitionContext = /*#__PURE__*/React.createContext({\n  isTransitioning: false\n});\nif (process.env.NODE_ENV !== \"production\") {\n  ViewTransitionContext.displayName = \"ViewTransition\";\n}\nconst FetchersContext = /*#__PURE__*/React.createContext(new Map());\nif (process.env.NODE_ENV !== \"production\") {\n  FetchersContext.displayName = \"Fetchers\";\n}\n//#endregion\n////////////////////////////////////////////////////////////////////////////////\n//#region Components\n////////////////////////////////////////////////////////////////////////////////\n/**\n  Webpack + React 17 fails to compile on any of the following because webpack\n  complains that `startTransition` doesn't exist in `React`:\n  * import { startTransition } from \"react\"\n  * import * as React from from \"react\";\n    \"startTransition\" in React ? React.startTransition(() => setState()) : setState()\n  * import * as React from from \"react\";\n    \"startTransition\" in React ? React[\"startTransition\"](() => setState()) : setState()\n\n  Moving it to a constant such as the following solves the Webpack/React 17 issue:\n  * import * as React from from \"react\";\n    const START_TRANSITION = \"startTransition\";\n    START_TRANSITION in React ? React[START_TRANSITION](() => setState()) : setState()\n\n  However, that introduces webpack/terser minification issues in production builds\n  in React 18 where minification/obfuscation ends up removing the call of\n  React.startTransition entirely from the first half of the ternary.  Grabbing\n  this exported reference once up front resolves that issue.\n\n  See https://github.com/remix-run/react-router/issues/10579\n*/\nconst START_TRANSITION = \"startTransition\";\nconst startTransitionImpl = React[START_TRANSITION];\nconst FLUSH_SYNC = \"flushSync\";\nconst flushSyncImpl = ReactDOM[FLUSH_SYNC];\nconst USE_ID = \"useId\";\nconst useIdImpl = React[USE_ID];\nfunction startTransitionSafe(cb) {\n  if (startTransitionImpl) {\n    startTransitionImpl(cb);\n  } else {\n    cb();\n  }\n}\nfunction flushSyncSafe(cb) {\n  if (flushSyncImpl) {\n    flushSyncImpl(cb);\n  } else {\n    cb();\n  }\n}\nclass Deferred {\n  constructor() {\n    this.status = \"pending\";\n    this.promise = new Promise((resolve, reject) => {\n      this.resolve = value => {\n        if (this.status === \"pending\") {\n          this.status = \"resolved\";\n          resolve(value);\n        }\n      };\n      this.reject = reason => {\n        if (this.status === \"pending\") {\n          this.status = \"rejected\";\n          reject(reason);\n        }\n      };\n    });\n  }\n}\n/**\n * Given a Remix Router instance, render the appropriate UI\n */\nfunction RouterProvider(_ref) {\n  let {\n    fallbackElement,\n    router,\n    future\n  } = _ref;\n  let [state, setStateImpl] = React.useState(router.state);\n  let [pendingState, setPendingState] = React.useState();\n  let [vtContext, setVtContext] = React.useState({\n    isTransitioning: false\n  });\n  let [renderDfd, setRenderDfd] = React.useState();\n  let [transition, setTransition] = React.useState();\n  let [interruption, setInterruption] = React.useState();\n  let fetcherData = React.useRef(new Map());\n  let {\n    v7_startTransition\n  } = future || {};\n  let optInStartTransition = React.useCallback(cb => {\n    if (v7_startTransition) {\n      startTransitionSafe(cb);\n    } else {\n      cb();\n    }\n  }, [v7_startTransition]);\n  let setState = React.useCallback((newState, _ref2) => {\n    let {\n      deletedFetchers,\n      flushSync: flushSync,\n      viewTransitionOpts: viewTransitionOpts\n    } = _ref2;\n    newState.fetchers.forEach((fetcher, key) => {\n      if (fetcher.data !== undefined) {\n        fetcherData.current.set(key, fetcher.data);\n      }\n    });\n    deletedFetchers.forEach(key => fetcherData.current.delete(key));\n    let isViewTransitionUnavailable = router.window == null || router.window.document == null || typeof router.window.document.startViewTransition !== \"function\";\n    // If this isn't a view transition or it's not available in this browser,\n    // just update and be done with it\n    if (!viewTransitionOpts || isViewTransitionUnavailable) {\n      if (flushSync) {\n        flushSyncSafe(() => setStateImpl(newState));\n      } else {\n        optInStartTransition(() => setStateImpl(newState));\n      }\n      return;\n    }\n    // flushSync + startViewTransition\n    if (flushSync) {\n      // Flush through the context to mark DOM elements as transition=ing\n      flushSyncSafe(() => {\n        // Cancel any pending transitions\n        if (transition) {\n          renderDfd && renderDfd.resolve();\n          transition.skipTransition();\n        }\n        setVtContext({\n          isTransitioning: true,\n          flushSync: true,\n          currentLocation: viewTransitionOpts.currentLocation,\n          nextLocation: viewTransitionOpts.nextLocation\n        });\n      });\n      // Update the DOM\n      let t = router.window.document.startViewTransition(() => {\n        flushSyncSafe(() => setStateImpl(newState));\n      });\n      // Clean up after the animation completes\n      t.finished.finally(() => {\n        flushSyncSafe(() => {\n          setRenderDfd(undefined);\n          setTransition(undefined);\n          setPendingState(undefined);\n          setVtContext({\n            isTransitioning: false\n          });\n        });\n      });\n      flushSyncSafe(() => setTransition(t));\n      return;\n    }\n    // startTransition + startViewTransition\n    if (transition) {\n      // Interrupting an in-progress transition, cancel and let everything flush\n      // out, and then kick off a new transition from the interruption state\n      renderDfd && renderDfd.resolve();\n      transition.skipTransition();\n      setInterruption({\n        state: newState,\n        currentLocation: viewTransitionOpts.currentLocation,\n        nextLocation: viewTransitionOpts.nextLocation\n      });\n    } else {\n      // Completed navigation update with opted-in view transitions, let 'er rip\n      setPendingState(newState);\n      setVtContext({\n        isTransitioning: true,\n        flushSync: false,\n        currentLocation: viewTransitionOpts.currentLocation,\n        nextLocation: viewTransitionOpts.nextLocation\n      });\n    }\n  }, [router.window, transition, renderDfd, fetcherData, optInStartTransition]);\n  // Need to use a layout effect here so we are subscribed early enough to\n  // pick up on any render-driven redirects/navigations (useEffect/<Navigate>)\n  React.useLayoutEffect(() => router.subscribe(setState), [router, setState]);\n  // When we start a view transition, create a Deferred we can use for the\n  // eventual \"completed\" render\n  React.useEffect(() => {\n    if (vtContext.isTransitioning && !vtContext.flushSync) {\n      setRenderDfd(new Deferred());\n    }\n  }, [vtContext]);\n  // Once the deferred is created, kick off startViewTransition() to update the\n  // DOM and then wait on the Deferred to resolve (indicating the DOM update has\n  // happened)\n  React.useEffect(() => {\n    if (renderDfd && pendingState && router.window) {\n      let newState = pendingState;\n      let renderPromise = renderDfd.promise;\n      let transition = router.window.document.startViewTransition(async () => {\n        optInStartTransition(() => setStateImpl(newState));\n        await renderPromise;\n      });\n      transition.finished.finally(() => {\n        setRenderDfd(undefined);\n        setTransition(undefined);\n        setPendingState(undefined);\n        setVtContext({\n          isTransitioning: false\n        });\n      });\n      setTransition(transition);\n    }\n  }, [optInStartTransition, pendingState, renderDfd, router.window]);\n  // When the new location finally renders and is committed to the DOM, this\n  // effect will run to resolve the transition\n  React.useEffect(() => {\n    if (renderDfd && pendingState && state.location.key === pendingState.location.key) {\n      renderDfd.resolve();\n    }\n  }, [renderDfd, transition, state.location, pendingState]);\n  // If we get interrupted with a new navigation during a transition, we skip\n  // the active transition, let it cleanup, then kick it off again here\n  React.useEffect(() => {\n    if (!vtContext.isTransitioning && interruption) {\n      setPendingState(interruption.state);\n      setVtContext({\n        isTransitioning: true,\n        flushSync: false,\n        currentLocation: interruption.currentLocation,\n        nextLocation: interruption.nextLocation\n      });\n      setInterruption(undefined);\n    }\n  }, [vtContext.isTransitioning, interruption]);\n  React.useEffect(() => {\n    process.env.NODE_ENV !== \"production\" ? UNSAFE_warning(fallbackElement == null || !router.future.v7_partialHydration, \"`<RouterProvider fallbackElement>` is deprecated when using \" + \"`v7_partialHydration`, use a `HydrateFallback` component instead\") : void 0;\n    // Only log this once on initial mount\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n  let navigator = React.useMemo(() => {\n    return {\n      createHref: router.createHref,\n      encodeLocation: router.encodeLocation,\n      go: n => router.navigate(n),\n      push: (to, state, opts) => router.navigate(to, {\n        state,\n        preventScrollReset: opts == null ? void 0 : opts.preventScrollReset\n      }),\n      replace: (to, state, opts) => router.navigate(to, {\n        replace: true,\n        state,\n        preventScrollReset: opts == null ? void 0 : opts.preventScrollReset\n      })\n    };\n  }, [router]);\n  let basename = router.basename || \"/\";\n  let dataRouterContext = React.useMemo(() => ({\n    router,\n    navigator,\n    static: false,\n    basename\n  }), [router, navigator, basename]);\n  let routerFuture = React.useMemo(() => ({\n    v7_relativeSplatPath: router.future.v7_relativeSplatPath\n  }), [router.future.v7_relativeSplatPath]);\n  React.useEffect(() => UNSAFE_logV6DeprecationWarnings(future, router.future), [future, router.future]);\n  // The fragment and {null} here are important!  We need them to keep React 18's\n  // useId happy when we are server-rendering since we may have a <script> here\n  // containing the hydrated server-side staticContext (from StaticRouterProvider).\n  // useId relies on the component tree structure to generate deterministic id's\n  // so we need to ensure it remains the same on the client even though\n  // we don't need the <script> tag\n  return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(UNSAFE_DataRouterContext.Provider, {\n    value: dataRouterContext\n  }, /*#__PURE__*/React.createElement(UNSAFE_DataRouterStateContext.Provider, {\n    value: state\n  }, /*#__PURE__*/React.createElement(FetchersContext.Provider, {\n    value: fetcherData.current\n  }, /*#__PURE__*/React.createElement(ViewTransitionContext.Provider, {\n    value: vtContext\n  }, /*#__PURE__*/React.createElement(Router, {\n    basename: basename,\n    location: state.location,\n    navigationType: state.historyAction,\n    navigator: navigator,\n    future: routerFuture\n  }, state.initialized || router.future.v7_partialHydration ? /*#__PURE__*/React.createElement(MemoizedDataRoutes, {\n    routes: router.routes,\n    future: router.future,\n    state: state\n  }) : fallbackElement))))), null);\n}\n// Memoize to avoid re-renders when updating `ViewTransitionContext`\nconst MemoizedDataRoutes = /*#__PURE__*/React.memo(DataRoutes);\nfunction DataRoutes(_ref3) {\n  let {\n    routes,\n    future,\n    state\n  } = _ref3;\n  return UNSAFE_useRoutesImpl(routes, undefined, state, future);\n}\n/**\n * A `<Router>` for use in web browsers. Provides the cleanest URLs.\n */\nfunction BrowserRouter(_ref4) {\n  let {\n    basename,\n    children,\n    future,\n    window\n  } = _ref4;\n  let historyRef = React.useRef();\n  if (historyRef.current == null) {\n    historyRef.current = createBrowserHistory({\n      window,\n      v5Compat: true\n    });\n  }\n  let history = historyRef.current;\n  let [state, setStateImpl] = React.useState({\n    action: history.action,\n    location: history.location\n  });\n  let {\n    v7_startTransition\n  } = future || {};\n  let setState = React.useCallback(newState => {\n    v7_startTransition && startTransitionImpl ? startTransitionImpl(() => setStateImpl(newState)) : setStateImpl(newState);\n  }, [setStateImpl, v7_startTransition]);\n  React.useLayoutEffect(() => history.listen(setState), [history, setState]);\n  React.useEffect(() => UNSAFE_logV6DeprecationWarnings(future), [future]);\n  return /*#__PURE__*/React.createElement(Router, {\n    basename: basename,\n    children: children,\n    location: state.location,\n    navigationType: state.action,\n    navigator: history,\n    future: future\n  });\n}\n/**\n * A `<Router>` for use in web browsers. Stores the location in the hash\n * portion of the URL so it is not sent to the server.\n */\nfunction HashRouter(_ref5) {\n  let {\n    basename,\n    children,\n    future,\n    window\n  } = _ref5;\n  let historyRef = React.useRef();\n  if (historyRef.current == null) {\n    historyRef.current = createHashHistory({\n      window,\n      v5Compat: true\n    });\n  }\n  let history = historyRef.current;\n  let [state, setStateImpl] = React.useState({\n    action: history.action,\n    location: history.location\n  });\n  let {\n    v7_startTransition\n  } = future || {};\n  let setState = React.useCallback(newState => {\n    v7_startTransition && startTransitionImpl ? startTransitionImpl(() => setStateImpl(newState)) : setStateImpl(newState);\n  }, [setStateImpl, v7_startTransition]);\n  React.useLayoutEffect(() => history.listen(setState), [history, setState]);\n  React.useEffect(() => UNSAFE_logV6DeprecationWarnings(future), [future]);\n  return /*#__PURE__*/React.createElement(Router, {\n    basename: basename,\n    children: children,\n    location: state.location,\n    navigationType: state.action,\n    navigator: history,\n    future: future\n  });\n}\n/**\n * A `<Router>` that accepts a pre-instantiated history object. It's important\n * to note that using your own history object is highly discouraged and may add\n * two versions of the history library to your bundles unless you use the same\n * version of the history library that React Router uses internally.\n */\nfunction HistoryRouter(_ref6) {\n  let {\n    basename,\n    children,\n    future,\n    history\n  } = _ref6;\n  let [state, setStateImpl] = React.useState({\n    action: history.action,\n    location: history.location\n  });\n  let {\n    v7_startTransition\n  } = future || {};\n  let setState = React.useCallback(newState => {\n    v7_startTransition && startTransitionImpl ? startTransitionImpl(() => setStateImpl(newState)) : setStateImpl(newState);\n  }, [setStateImpl, v7_startTransition]);\n  React.useLayoutEffect(() => history.listen(setState), [history, setState]);\n  React.useEffect(() => UNSAFE_logV6DeprecationWarnings(future), [future]);\n  return /*#__PURE__*/React.createElement(Router, {\n    basename: basename,\n    children: children,\n    location: state.location,\n    navigationType: state.action,\n    navigator: history,\n    future: future\n  });\n}\nif (process.env.NODE_ENV !== \"production\") {\n  HistoryRouter.displayName = \"unstable_HistoryRouter\";\n}\nconst isBrowser = typeof window !== \"undefined\" && typeof window.document !== \"undefined\" && typeof window.document.createElement !== \"undefined\";\nconst ABSOLUTE_URL_REGEX = /^(?:[a-z][a-z0-9+.-]*:|\\/\\/)/i;\n/**\n * The public API for rendering a history-aware `<a>`.\n */\nconst Link = /*#__PURE__*/React.forwardRef(function LinkWithRef(_ref7, ref) {\n  let {\n      onClick,\n      relative,\n      reloadDocument,\n      replace,\n      state,\n      target,\n      to,\n      preventScrollReset,\n      viewTransition\n    } = _ref7,\n    rest = _objectWithoutPropertiesLoose(_ref7, _excluded);\n  let {\n    basename\n  } = React.useContext(UNSAFE_NavigationContext);\n  // Rendered into <a href> for absolute URLs\n  let absoluteHref;\n  let isExternal = false;\n  if (typeof to === \"string\" && ABSOLUTE_URL_REGEX.test(to)) {\n    // Render the absolute href server- and client-side\n    absoluteHref = to;\n    // Only check for external origins client-side\n    if (isBrowser) {\n      try {\n        let currentUrl = new URL(window.location.href);\n        let targetUrl = to.startsWith(\"//\") ? new URL(currentUrl.protocol + to) : new URL(to);\n        let path = stripBasename(targetUrl.pathname, basename);\n        if (targetUrl.origin === currentUrl.origin && path != null) {\n          // Strip the protocol/origin/basename for same-origin absolute URLs\n          to = path + targetUrl.search + targetUrl.hash;\n        } else {\n          isExternal = true;\n        }\n      } catch (e) {\n        // We can't do external URL detection without a valid URL\n        process.env.NODE_ENV !== \"production\" ? UNSAFE_warning(false, \"<Link to=\\\"\" + to + \"\\\"> contains an invalid URL which will probably break \" + \"when clicked - please update to a valid URL path.\") : void 0;\n      }\n    }\n  }\n  // Rendered into <a href> for relative URLs\n  let href = useHref(to, {\n    relative\n  });\n  let internalOnClick = useLinkClickHandler(to, {\n    replace,\n    state,\n    target,\n    preventScrollReset,\n    relative,\n    viewTransition\n  });\n  function handleClick(event) {\n    if (onClick) onClick(event);\n    if (!event.defaultPrevented) {\n      internalOnClick(event);\n    }\n  }\n  return (\n    /*#__PURE__*/\n    // eslint-disable-next-line jsx-a11y/anchor-has-content\n    React.createElement(\"a\", _extends({}, rest, {\n      href: absoluteHref || href,\n      onClick: isExternal || reloadDocument ? onClick : handleClick,\n      ref: ref,\n      target: target\n    }))\n  );\n});\nif (process.env.NODE_ENV !== \"production\") {\n  Link.displayName = \"Link\";\n}\n/**\n * A `<Link>` wrapper that knows if it's \"active\" or not.\n */\nconst NavLink = /*#__PURE__*/React.forwardRef(function NavLinkWithRef(_ref8, ref) {\n  let {\n      \"aria-current\": ariaCurrentProp = \"page\",\n      caseSensitive = false,\n      className: classNameProp = \"\",\n      end = false,\n      style: styleProp,\n      to,\n      viewTransition,\n      children\n    } = _ref8,\n    rest = _objectWithoutPropertiesLoose(_ref8, _excluded2);\n  let path = useResolvedPath(to, {\n    relative: rest.relative\n  });\n  let location = useLocation();\n  let routerState = React.useContext(UNSAFE_DataRouterStateContext);\n  let {\n    navigator,\n    basename\n  } = React.useContext(UNSAFE_NavigationContext);\n  let isTransitioning = routerState != null &&\n  // Conditional usage is OK here because the usage of a data router is static\n  // eslint-disable-next-line react-hooks/rules-of-hooks\n  useViewTransitionState(path) && viewTransition === true;\n  let toPathname = navigator.encodeLocation ? navigator.encodeLocation(path).pathname : path.pathname;\n  let locationPathname = location.pathname;\n  let nextLocationPathname = routerState && routerState.navigation && routerState.navigation.location ? routerState.navigation.location.pathname : null;\n  if (!caseSensitive) {\n    locationPathname = locationPathname.toLowerCase();\n    nextLocationPathname = nextLocationPathname ? nextLocationPathname.toLowerCase() : null;\n    toPathname = toPathname.toLowerCase();\n  }\n  if (nextLocationPathname && basename) {\n    nextLocationPathname = stripBasename(nextLocationPathname, basename) || nextLocationPathname;\n  }\n  // If the `to` has a trailing slash, look at that exact spot.  Otherwise,\n  // we're looking for a slash _after_ what's in `to`.  For example:\n  //\n  // <NavLink to=\"/users\"> and <NavLink to=\"/users/\">\n  // both want to look for a / at index 6 to match URL `/users/matt`\n  const endSlashPosition = toPathname !== \"/\" && toPathname.endsWith(\"/\") ? toPathname.length - 1 : toPathname.length;\n  let isActive = locationPathname === toPathname || !end && locationPathname.startsWith(toPathname) && locationPathname.charAt(endSlashPosition) === \"/\";\n  let isPending = nextLocationPathname != null && (nextLocationPathname === toPathname || !end && nextLocationPathname.startsWith(toPathname) && nextLocationPathname.charAt(toPathname.length) === \"/\");\n  let renderProps = {\n    isActive,\n    isPending,\n    isTransitioning\n  };\n  let ariaCurrent = isActive ? ariaCurrentProp : undefined;\n  let className;\n  if (typeof classNameProp === \"function\") {\n    className = classNameProp(renderProps);\n  } else {\n    // If the className prop is not a function, we use a default `active`\n    // class for <NavLink />s that are active. In v5 `active` was the default\n    // value for `activeClassName`, but we are removing that API and can still\n    // use the old default behavior for a cleaner upgrade path and keep the\n    // simple styling rules working as they currently do.\n    className = [classNameProp, isActive ? \"active\" : null, isPending ? \"pending\" : null, isTransitioning ? \"transitioning\" : null].filter(Boolean).join(\" \");\n  }\n  let style = typeof styleProp === \"function\" ? styleProp(renderProps) : styleProp;\n  return /*#__PURE__*/React.createElement(Link, _extends({}, rest, {\n    \"aria-current\": ariaCurrent,\n    className: className,\n    ref: ref,\n    style: style,\n    to: to,\n    viewTransition: viewTransition\n  }), typeof children === \"function\" ? children(renderProps) : children);\n});\nif (process.env.NODE_ENV !== \"production\") {\n  NavLink.displayName = \"NavLink\";\n}\n/**\n * A `@remix-run/router`-aware `<form>`. It behaves like a normal form except\n * that the interaction with the server is with `fetch` instead of new document\n * requests, allowing components to add nicer UX to the page as the form is\n * submitted and returns with data.\n */\nconst Form = /*#__PURE__*/React.forwardRef((_ref9, forwardedRef) => {\n  let {\n      fetcherKey,\n      navigate,\n      reloadDocument,\n      replace,\n      state,\n      method = defaultMethod,\n      action,\n      onSubmit,\n      relative,\n      preventScrollReset,\n      viewTransition\n    } = _ref9,\n    props = _objectWithoutPropertiesLoose(_ref9, _excluded3);\n  let submit = useSubmit();\n  let formAction = useFormAction(action, {\n    relative\n  });\n  let formMethod = method.toLowerCase() === \"get\" ? \"get\" : \"post\";\n  let submitHandler = event => {\n    onSubmit && onSubmit(event);\n    if (event.defaultPrevented) return;\n    event.preventDefault();\n    let submitter = event.nativeEvent.submitter;\n    let submitMethod = (submitter == null ? void 0 : submitter.getAttribute(\"formmethod\")) || method;\n    submit(submitter || event.currentTarget, {\n      fetcherKey,\n      method: submitMethod,\n      navigate,\n      replace,\n      state,\n      relative,\n      preventScrollReset,\n      viewTransition\n    });\n  };\n  return /*#__PURE__*/React.createElement(\"form\", _extends({\n    ref: forwardedRef,\n    method: formMethod,\n    action: formAction,\n    onSubmit: reloadDocument ? onSubmit : submitHandler\n  }, props));\n});\nif (process.env.NODE_ENV !== \"production\") {\n  Form.displayName = \"Form\";\n}\n/**\n * This component will emulate the browser's scroll restoration on location\n * changes.\n */\nfunction ScrollRestoration(_ref10) {\n  let {\n    getKey,\n    storageKey\n  } = _ref10;\n  useScrollRestoration({\n    getKey,\n    storageKey\n  });\n  return null;\n}\nif (process.env.NODE_ENV !== \"production\") {\n  ScrollRestoration.displayName = \"ScrollRestoration\";\n}\n//#endregion\n////////////////////////////////////////////////////////////////////////////////\n//#region Hooks\n////////////////////////////////////////////////////////////////////////////////\nvar DataRouterHook;\n(function (DataRouterHook) {\n  DataRouterHook[\"UseScrollRestoration\"] = \"useScrollRestoration\";\n  DataRouterHook[\"UseSubmit\"] = \"useSubmit\";\n  DataRouterHook[\"UseSubmitFetcher\"] = \"useSubmitFetcher\";\n  DataRouterHook[\"UseFetcher\"] = \"useFetcher\";\n  DataRouterHook[\"useViewTransitionState\"] = \"useViewTransitionState\";\n})(DataRouterHook || (DataRouterHook = {}));\nvar DataRouterStateHook;\n(function (DataRouterStateHook) {\n  DataRouterStateHook[\"UseFetcher\"] = \"useFetcher\";\n  DataRouterStateHook[\"UseFetchers\"] = \"useFetchers\";\n  DataRouterStateHook[\"UseScrollRestoration\"] = \"useScrollRestoration\";\n})(DataRouterStateHook || (DataRouterStateHook = {}));\n// Internal hooks\nfunction getDataRouterConsoleError(hookName) {\n  return hookName + \" must be used within a data router.  See https://reactrouter.com/v6/routers/picking-a-router.\";\n}\nfunction useDataRouterContext(hookName) {\n  let ctx = React.useContext(UNSAFE_DataRouterContext);\n  !ctx ? process.env.NODE_ENV !== \"production\" ? UNSAFE_invariant(false, getDataRouterConsoleError(hookName)) : UNSAFE_invariant(false) : void 0;\n  return ctx;\n}\nfunction useDataRouterState(hookName) {\n  let state = React.useContext(UNSAFE_DataRouterStateContext);\n  !state ? process.env.NODE_ENV !== \"production\" ? UNSAFE_invariant(false, getDataRouterConsoleError(hookName)) : UNSAFE_invariant(false) : void 0;\n  return state;\n}\n// External hooks\n/**\n * Handles the click behavior for router `<Link>` components. This is useful if\n * you need to create custom `<Link>` components with the same click behavior we\n * use in our exported `<Link>`.\n */\nfunction useLinkClickHandler(to, _temp) {\n  let {\n    target,\n    replace: replaceProp,\n    state,\n    preventScrollReset,\n    relative,\n    viewTransition\n  } = _temp === void 0 ? {} : _temp;\n  let navigate = useNavigate();\n  let location = useLocation();\n  let path = useResolvedPath(to, {\n    relative\n  });\n  return React.useCallback(event => {\n    if (shouldProcessLinkClick(event, target)) {\n      event.preventDefault();\n      // If the URL hasn't changed, a regular <a> will do a replace instead of\n      // a push, so do the same here unless the replace prop is explicitly set\n      let replace = replaceProp !== undefined ? replaceProp : createPath(location) === createPath(path);\n      navigate(to, {\n        replace,\n        state,\n        preventScrollReset,\n        relative,\n        viewTransition\n      });\n    }\n  }, [location, navigate, path, replaceProp, state, target, to, preventScrollReset, relative, viewTransition]);\n}\n/**\n * A convenient wrapper for reading and writing search parameters via the\n * URLSearchParams interface.\n */\nfunction useSearchParams(defaultInit) {\n  process.env.NODE_ENV !== \"production\" ? UNSAFE_warning(typeof URLSearchParams !== \"undefined\", \"You cannot use the `useSearchParams` hook in a browser that does not \" + \"support the URLSearchParams API. If you need to support Internet \" + \"Explorer 11, we recommend you load a polyfill such as \" + \"https://github.com/ungap/url-search-params.\") : void 0;\n  let defaultSearchParamsRef = React.useRef(createSearchParams(defaultInit));\n  let hasSetSearchParamsRef = React.useRef(false);\n  let location = useLocation();\n  let searchParams = React.useMemo(() =>\n  // Only merge in the defaults if we haven't yet called setSearchParams.\n  // Once we call that we want those to take precedence, otherwise you can't\n  // remove a param with setSearchParams({}) if it has an initial value\n  getSearchParamsForLocation(location.search, hasSetSearchParamsRef.current ? null : defaultSearchParamsRef.current), [location.search]);\n  let navigate = useNavigate();\n  let setSearchParams = React.useCallback((nextInit, navigateOptions) => {\n    const newSearchParams = createSearchParams(typeof nextInit === \"function\" ? nextInit(searchParams) : nextInit);\n    hasSetSearchParamsRef.current = true;\n    navigate(\"?\" + newSearchParams, navigateOptions);\n  }, [navigate, searchParams]);\n  return [searchParams, setSearchParams];\n}\nfunction validateClientSideSubmission() {\n  if (typeof document === \"undefined\") {\n    throw new Error(\"You are calling submit during the server render. \" + \"Try calling submit within a `useEffect` or callback instead.\");\n  }\n}\nlet fetcherId = 0;\nlet getUniqueFetcherId = () => \"__\" + String(++fetcherId) + \"__\";\n/**\n * Returns a function that may be used to programmatically submit a form (or\n * some arbitrary data) to the server.\n */\nfunction useSubmit() {\n  let {\n    router\n  } = useDataRouterContext(DataRouterHook.UseSubmit);\n  let {\n    basename\n  } = React.useContext(UNSAFE_NavigationContext);\n  let currentRouteId = UNSAFE_useRouteId();\n  return React.useCallback(function (target, options) {\n    if (options === void 0) {\n      options = {};\n    }\n    validateClientSideSubmission();\n    let {\n      action,\n      method,\n      encType,\n      formData,\n      body\n    } = getFormSubmissionInfo(target, basename);\n    if (options.navigate === false) {\n      let key = options.fetcherKey || getUniqueFetcherId();\n      router.fetch(key, currentRouteId, options.action || action, {\n        preventScrollReset: options.preventScrollReset,\n        formData,\n        body,\n        formMethod: options.method || method,\n        formEncType: options.encType || encType,\n        flushSync: options.flushSync\n      });\n    } else {\n      router.navigate(options.action || action, {\n        preventScrollReset: options.preventScrollReset,\n        formData,\n        body,\n        formMethod: options.method || method,\n        formEncType: options.encType || encType,\n        replace: options.replace,\n        state: options.state,\n        fromRouteId: currentRouteId,\n        flushSync: options.flushSync,\n        viewTransition: options.viewTransition\n      });\n    }\n  }, [router, basename, currentRouteId]);\n}\n// v7: Eventually we should deprecate this entirely in favor of using the\n// router method directly?\nfunction useFormAction(action, _temp2) {\n  let {\n    relative\n  } = _temp2 === void 0 ? {} : _temp2;\n  let {\n    basename\n  } = React.useContext(UNSAFE_NavigationContext);\n  let routeContext = React.useContext(UNSAFE_RouteContext);\n  !routeContext ? process.env.NODE_ENV !== \"production\" ? UNSAFE_invariant(false, \"useFormAction must be used inside a RouteContext\") : UNSAFE_invariant(false) : void 0;\n  let [match] = routeContext.matches.slice(-1);\n  // Shallow clone path so we can modify it below, otherwise we modify the\n  // object referenced by useMemo inside useResolvedPath\n  let path = _extends({}, useResolvedPath(action ? action : \".\", {\n    relative\n  }));\n  // If no action was specified, browsers will persist current search params\n  // when determining the path, so match that behavior\n  // https://github.com/remix-run/remix/issues/927\n  let location = useLocation();\n  if (action == null) {\n    // Safe to write to this directly here since if action was undefined, we\n    // would have called useResolvedPath(\".\") which will never include a search\n    path.search = location.search;\n    // When grabbing search params from the URL, remove any included ?index param\n    // since it might not apply to our contextual route.  We add it back based\n    // on match.route.index below\n    let params = new URLSearchParams(path.search);\n    let indexValues = params.getAll(\"index\");\n    let hasNakedIndexParam = indexValues.some(v => v === \"\");\n    if (hasNakedIndexParam) {\n      params.delete(\"index\");\n      indexValues.filter(v => v).forEach(v => params.append(\"index\", v));\n      let qs = params.toString();\n      path.search = qs ? \"?\" + qs : \"\";\n    }\n  }\n  if ((!action || action === \".\") && match.route.index) {\n    path.search = path.search ? path.search.replace(/^\\?/, \"?index&\") : \"?index\";\n  }\n  // If we're operating within a basename, prepend it to the pathname prior\n  // to creating the form action.  If this is a root navigation, then just use\n  // the raw basename which allows the basename to have full control over the\n  // presence of a trailing slash on root actions\n  if (basename !== \"/\") {\n    path.pathname = path.pathname === \"/\" ? basename : joinPaths([basename, path.pathname]);\n  }\n  return createPath(path);\n}\n// TODO: (v7) Change the useFetcher generic default from `any` to `unknown`\n/**\n * Interacts with route loaders and actions without causing a navigation. Great\n * for any interaction that stays on the same page.\n */\nfunction useFetcher(_temp3) {\n  var _route$matches;\n  let {\n    key\n  } = _temp3 === void 0 ? {} : _temp3;\n  let {\n    router\n  } = useDataRouterContext(DataRouterHook.UseFetcher);\n  let state = useDataRouterState(DataRouterStateHook.UseFetcher);\n  let fetcherData = React.useContext(FetchersContext);\n  let route = React.useContext(UNSAFE_RouteContext);\n  let routeId = (_route$matches = route.matches[route.matches.length - 1]) == null ? void 0 : _route$matches.route.id;\n  !fetcherData ? process.env.NODE_ENV !== \"production\" ? UNSAFE_invariant(false, \"useFetcher must be used inside a FetchersContext\") : UNSAFE_invariant(false) : void 0;\n  !route ? process.env.NODE_ENV !== \"production\" ? UNSAFE_invariant(false, \"useFetcher must be used inside a RouteContext\") : UNSAFE_invariant(false) : void 0;\n  !(routeId != null) ? process.env.NODE_ENV !== \"production\" ? UNSAFE_invariant(false, \"useFetcher can only be used on routes that contain a unique \\\"id\\\"\") : UNSAFE_invariant(false) : void 0;\n  // Fetcher key handling\n  // OK to call conditionally to feature detect `useId`\n  // eslint-disable-next-line react-hooks/rules-of-hooks\n  let defaultKey = useIdImpl ? useIdImpl() : \"\";\n  let [fetcherKey, setFetcherKey] = React.useState(key || defaultKey);\n  if (key && key !== fetcherKey) {\n    setFetcherKey(key);\n  } else if (!fetcherKey) {\n    // We will only fall through here when `useId` is not available\n    setFetcherKey(getUniqueFetcherId());\n  }\n  // Registration/cleanup\n  React.useEffect(() => {\n    router.getFetcher(fetcherKey);\n    return () => {\n      // Tell the router we've unmounted - if v7_fetcherPersist is enabled this\n      // will not delete immediately but instead queue up a delete after the\n      // fetcher returns to an `idle` state\n      router.deleteFetcher(fetcherKey);\n    };\n  }, [router, fetcherKey]);\n  // Fetcher additions\n  let load = React.useCallback((href, opts) => {\n    !routeId ? process.env.NODE_ENV !== \"production\" ? UNSAFE_invariant(false, \"No routeId available for fetcher.load()\") : UNSAFE_invariant(false) : void 0;\n    router.fetch(fetcherKey, routeId, href, opts);\n  }, [fetcherKey, routeId, router]);\n  let submitImpl = useSubmit();\n  let submit = React.useCallback((target, opts) => {\n    submitImpl(target, _extends({}, opts, {\n      navigate: false,\n      fetcherKey\n    }));\n  }, [fetcherKey, submitImpl]);\n  let FetcherForm = React.useMemo(() => {\n    let FetcherForm = /*#__PURE__*/React.forwardRef((props, ref) => {\n      return /*#__PURE__*/React.createElement(Form, _extends({}, props, {\n        navigate: false,\n        fetcherKey: fetcherKey,\n        ref: ref\n      }));\n    });\n    if (process.env.NODE_ENV !== \"production\") {\n      FetcherForm.displayName = \"fetcher.Form\";\n    }\n    return FetcherForm;\n  }, [fetcherKey]);\n  // Exposed FetcherWithComponents\n  let fetcher = state.fetchers.get(fetcherKey) || IDLE_FETCHER;\n  let data = fetcherData.get(fetcherKey);\n  let fetcherWithComponents = React.useMemo(() => _extends({\n    Form: FetcherForm,\n    submit,\n    load\n  }, fetcher, {\n    data\n  }), [FetcherForm, submit, load, fetcher, data]);\n  return fetcherWithComponents;\n}\n/**\n * Provides all fetchers currently on the page. Useful for layouts and parent\n * routes that need to provide pending/optimistic UI regarding the fetch.\n */\nfunction useFetchers() {\n  let state = useDataRouterState(DataRouterStateHook.UseFetchers);\n  return Array.from(state.fetchers.entries()).map(_ref11 => {\n    let [key, fetcher] = _ref11;\n    return _extends({}, fetcher, {\n      key\n    });\n  });\n}\nconst SCROLL_RESTORATION_STORAGE_KEY = \"react-router-scroll-positions\";\nlet savedScrollPositions = {};\n/**\n * When rendered inside a RouterProvider, will restore scroll positions on navigations\n */\nfunction useScrollRestoration(_temp4) {\n  let {\n    getKey,\n    storageKey\n  } = _temp4 === void 0 ? {} : _temp4;\n  let {\n    router\n  } = useDataRouterContext(DataRouterHook.UseScrollRestoration);\n  let {\n    restoreScrollPosition,\n    preventScrollReset\n  } = useDataRouterState(DataRouterStateHook.UseScrollRestoration);\n  let {\n    basename\n  } = React.useContext(UNSAFE_NavigationContext);\n  let location = useLocation();\n  let matches = useMatches();\n  let navigation = useNavigation();\n  // Trigger manual scroll restoration while we're active\n  React.useEffect(() => {\n    window.history.scrollRestoration = \"manual\";\n    return () => {\n      window.history.scrollRestoration = \"auto\";\n    };\n  }, []);\n  // Save positions on pagehide\n  usePageHide(React.useCallback(() => {\n    if (navigation.state === \"idle\") {\n      let key = (getKey ? getKey(location, matches) : null) || location.key;\n      savedScrollPositions[key] = window.scrollY;\n    }\n    try {\n      sessionStorage.setItem(storageKey || SCROLL_RESTORATION_STORAGE_KEY, JSON.stringify(savedScrollPositions));\n    } catch (error) {\n      process.env.NODE_ENV !== \"production\" ? UNSAFE_warning(false, \"Failed to save scroll positions in sessionStorage, <ScrollRestoration /> will not work properly (\" + error + \").\") : void 0;\n    }\n    window.history.scrollRestoration = \"auto\";\n  }, [storageKey, getKey, navigation.state, location, matches]));\n  // Read in any saved scroll locations\n  if (typeof document !== \"undefined\") {\n    // eslint-disable-next-line react-hooks/rules-of-hooks\n    React.useLayoutEffect(() => {\n      try {\n        let sessionPositions = sessionStorage.getItem(storageKey || SCROLL_RESTORATION_STORAGE_KEY);\n        if (sessionPositions) {\n          savedScrollPositions = JSON.parse(sessionPositions);\n        }\n      } catch (e) {\n        // no-op, use default empty object\n      }\n    }, [storageKey]);\n    // Enable scroll restoration in the router\n    // eslint-disable-next-line react-hooks/rules-of-hooks\n    React.useLayoutEffect(() => {\n      let getKeyWithoutBasename = getKey && basename !== \"/\" ? (location, matches) => getKey( // Strip the basename to match useLocation()\n      _extends({}, location, {\n        pathname: stripBasename(location.pathname, basename) || location.pathname\n      }), matches) : getKey;\n      let disableScrollRestoration = router == null ? void 0 : router.enableScrollRestoration(savedScrollPositions, () => window.scrollY, getKeyWithoutBasename);\n      return () => disableScrollRestoration && disableScrollRestoration();\n    }, [router, basename, getKey]);\n    // Restore scrolling when state.restoreScrollPosition changes\n    // eslint-disable-next-line react-hooks/rules-of-hooks\n    React.useLayoutEffect(() => {\n      // Explicit false means don't do anything (used for submissions)\n      if (restoreScrollPosition === false) {\n        return;\n      }\n      // been here before, scroll to it\n      if (typeof restoreScrollPosition === \"number\") {\n        window.scrollTo(0, restoreScrollPosition);\n        return;\n      }\n      // try to scroll to the hash\n      if (location.hash) {\n        let el = document.getElementById(decodeURIComponent(location.hash.slice(1)));\n        if (el) {\n          el.scrollIntoView();\n          return;\n        }\n      }\n      // Don't reset if this navigation opted out\n      if (preventScrollReset === true) {\n        return;\n      }\n      // otherwise go to the top on new locations\n      window.scrollTo(0, 0);\n    }, [location, restoreScrollPosition, preventScrollReset]);\n  }\n}\n/**\n * Setup a callback to be fired on the window's `beforeunload` event. This is\n * useful for saving some data to `window.localStorage` just before the page\n * refreshes.\n *\n * Note: The `callback` argument should be a function created with\n * `React.useCallback()`.\n */\nfunction useBeforeUnload(callback, options) {\n  let {\n    capture\n  } = options || {};\n  React.useEffect(() => {\n    let opts = capture != null ? {\n      capture\n    } : undefined;\n    window.addEventListener(\"beforeunload\", callback, opts);\n    return () => {\n      window.removeEventListener(\"beforeunload\", callback, opts);\n    };\n  }, [callback, capture]);\n}\n/**\n * Setup a callback to be fired on the window's `pagehide` event. This is\n * useful for saving some data to `window.localStorage` just before the page\n * refreshes.  This event is better supported than beforeunload across browsers.\n *\n * Note: The `callback` argument should be a function created with\n * `React.useCallback()`.\n */\nfunction usePageHide(callback, options) {\n  let {\n    capture\n  } = options || {};\n  React.useEffect(() => {\n    let opts = capture != null ? {\n      capture\n    } : undefined;\n    window.addEventListener(\"pagehide\", callback, opts);\n    return () => {\n      window.removeEventListener(\"pagehide\", callback, opts);\n    };\n  }, [callback, capture]);\n}\n/**\n * Wrapper around useBlocker to show a window.confirm prompt to users instead\n * of building a custom UI with useBlocker.\n *\n * Warning: This has *a lot of rough edges* and behaves very differently (and\n * very incorrectly in some cases) across browsers if user click addition\n * back/forward navigations while the confirm is open.  Use at your own risk.\n */\nfunction usePrompt(_ref12) {\n  let {\n    when,\n    message\n  } = _ref12;\n  let blocker = useBlocker(when);\n  React.useEffect(() => {\n    if (blocker.state === \"blocked\") {\n      let proceed = window.confirm(message);\n      if (proceed) {\n        // This timeout is needed to avoid a weird \"race\" on POP navigations\n        // between the `window.history` revert navigation and the result of\n        // `window.confirm`\n        setTimeout(blocker.proceed, 0);\n      } else {\n        blocker.reset();\n      }\n    }\n  }, [blocker, message]);\n  React.useEffect(() => {\n    if (blocker.state === \"blocked\" && !when) {\n      blocker.reset();\n    }\n  }, [blocker, when]);\n}\n/**\n * Return a boolean indicating if there is an active view transition to the\n * given href.  You can use this value to render CSS classes or viewTransitionName\n * styles onto your elements\n *\n * @param href The destination href\n * @param [opts.relative] Relative routing type (\"route\" | \"path\")\n */\nfunction useViewTransitionState(to, opts) {\n  if (opts === void 0) {\n    opts = {};\n  }\n  let vtContext = React.useContext(ViewTransitionContext);\n  !(vtContext != null) ? process.env.NODE_ENV !== \"production\" ? UNSAFE_invariant(false, \"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  \" + \"Did you accidentally import `RouterProvider` from `react-router`?\") : UNSAFE_invariant(false) : void 0;\n  let {\n    basename\n  } = useDataRouterContext(DataRouterHook.useViewTransitionState);\n  let path = useResolvedPath(to, {\n    relative: opts.relative\n  });\n  if (!vtContext.isTransitioning) {\n    return false;\n  }\n  let currentPath = stripBasename(vtContext.currentLocation.pathname, basename) || vtContext.currentLocation.pathname;\n  let nextPath = stripBasename(vtContext.nextLocation.pathname, basename) || vtContext.nextLocation.pathname;\n  // Transition is active if we're going to or coming from the indicated\n  // destination.  This ensures that other PUSH navigations that reverse\n  // an indicated transition apply.  I.e., on the list view you have:\n  //\n  //   <NavLink to=\"/details/1\" viewTransition>\n  //\n  // If you click the breadcrumb back to the list view:\n  //\n  //   <NavLink to=\"/list\" viewTransition>\n  //\n  // We should apply the transition because it's indicated as active going\n  // from /list -> /details/1 and therefore should be active on the reverse\n  // (even though this isn't strictly a POP reverse)\n  return matchPath(path.pathname, nextPath) != null || matchPath(path.pathname, currentPath) != null;\n}\n//#endregion\n\nexport { BrowserRouter, Form, HashRouter, Link, NavLink, RouterProvider, ScrollRestoration, FetchersContext as UNSAFE_FetchersContext, ViewTransitionContext as UNSAFE_ViewTransitionContext, useScrollRestoration as UNSAFE_useScrollRestoration, createBrowserRouter, createHashRouter, createSearchParams, HistoryRouter as unstable_HistoryRouter, usePrompt as unstable_usePrompt, useBeforeUnload, useFetcher, useFetchers, useFormAction, useLinkClickHandler, useSearchParams, useSubmit, useViewTransitionState };\n//# sourceMappingURL=index.js.map\n","import { createContext, useContext, useState, ReactNode } from 'react';\n\ntype Theme = 'NeXTSTEP' | 'Modern';\n\ninterface ThemeContextType {\n  theme: Theme;\n  setTheme: (theme: Theme) => void;\n}\n\nconst ThemeContext = createContext<ThemeContextType | undefined>(undefined);\n\ninterface ThemeProviderProps {\n  children: ReactNode;\n  defaultTheme?: Theme;\n}\n\nexport function ThemeProvider({ children, defaultTheme = 'Modern' }: ThemeProviderProps) {\n  const [theme, setTheme] = useState<Theme>(defaultTheme);\n\n  return (\n    <ThemeContext.Provider value={{ theme, setTheme }}>\n      {children}\n    </ThemeContext.Provider>\n  );\n}\n\nexport function useTheme() {\n  const context = useContext(ThemeContext);\n  if (context === undefined) {\n    throw new Error('useTheme must be used within a ThemeProvider');\n  }\n  return context;\n}\n","import { useSearchParams } from 'react-router-dom';\nimport { useCallback, useEffect, useState } from 'react';\n\n/**\n * Generic hook for synchronizing state with URL query parameters\n * @param key - Query parameter key\n * @param defaultValue - Default value if not present in URL\n * @param serialize - Function to serialize value to URL-safe string\n * @param deserialize - Function to deserialize URL string to value\n * @returns [value, setValue] tuple\n */\nexport function useURLState<T>(\n  key: string,\n  defaultValue: T,\n  serialize: (value: T) => string,\n  deserialize: (urlString: string) => T\n): [T, (value: T) => void] {\n  const [searchParams, setSearchParams] = useSearchParams();\n\n  // Get initial value from URL or use default\n  const urlValue = searchParams.get(key);\n  const [value, setValueInternal] = useState<T>(() => {\n    if (urlValue) {\n      try {\n        return deserialize(urlValue);\n      } catch (error) {\n        console.warn(`Failed to deserialize URL param \"${key}\":`, error);\n        return defaultValue;\n      }\n    }\n    return defaultValue;\n  });\n\n  // Update URL when value changes\n  const setValue = useCallback((newValue: T) => {\n    setValueInternal(newValue);\n    setSearchParams(prev => {\n      const next = new URLSearchParams(prev);\n      try {\n        const serialized = serialize(newValue);\n        // Only set if different from default to keep URLs clean\n        if (serialized === serialize(defaultValue)) {\n          next.delete(key);\n        } else {\n          next.set(key, serialized);\n        }\n      } catch (error) {\n        console.warn(`Failed to serialize value for \"${key}\":`, error);\n        next.delete(key);\n      }\n      return next;\n    }, { replace: true });\n  }, [key, defaultValue, serialize, setSearchParams]);\n\n  // Handle browser back/forward (popstate event)\n  useEffect(() => {\n    const currentUrlValue = searchParams.get(key);\n    if (currentUrlValue) {\n      try {\n        const deserialized = deserialize(currentUrlValue);\n        setValueInternal(deserialized);\n      } catch (error) {\n        console.warn(`Failed to deserialize URL param \"${key}\" on popstate:`, error);\n        setValueInternal(defaultValue);\n      }\n    } else {\n      setValueInternal(defaultValue);\n    }\n  }, [searchParams, key, defaultValue, deserialize]);\n\n  return [value, setValue];\n}\n\n/**\n * Simple string-based URL state hook (legacy compatibility)\n */\nexport function useURLStateString<T extends string>(\n  key: string,\n  defaultValue: T\n): [T, (value: T) => void] {\n  return useURLState(\n    key,\n    defaultValue,\n    (v) => v,\n    (s) => s as T\n  );\n}\n","import { createContext, useContext, ReactNode } from 'react';\nimport { useURLState } from '@/hooks/useURLState';\n\nexport type AppName = 'Demo' | 'Inbox' | 'Projects' | 'LinkedIn' | 'MTGs' | 'ReadWatch';\nexport type ViewName = 'List' | 'Gallery' | 'Timeline' | 'Calendar' | 'Tree' | 'Kanban' | 'Grid' | 'Charts' | 'Graphs';\nexport type DatasetName = 'ETL' | 'CAS' | 'Catalog' | 'Taxonomy' | 'Notes' | 'Projects' | 'Contacts' | 'Messages';\n\ninterface AppStateContextType {\n  activeApp: AppName;\n  activeView: ViewName;\n  activeDataset: DatasetName;\n  setActiveApp: (app: AppName) => void;\n  setActiveView: (view: ViewName) => void;\n  setActiveDataset: (dataset: DatasetName) => void;\n}\n\nconst AppStateContext = createContext<AppStateContextType | undefined>(undefined);\n\nexport function AppStateProvider({ children }: { children: ReactNode }) {\n  // URL-synced state for shareable views\n  const [activeApp, setActiveApp] = useURLState<AppName>(\n    'app',\n    'Demo',\n    (v) => v,\n    (s) => s as AppName\n  );\n  const [activeView, setActiveView] = useURLState<ViewName>(\n    'view',\n    'Grid',\n    (v) => v,\n    (s) => s as ViewName\n  );\n  const [activeDataset, setActiveDataset] = useURLState<DatasetName>(\n    'dataset',\n    'Notes',\n    (v) => v,\n    (s) => s as DatasetName\n  );\n\n  return (\n    <AppStateContext.Provider value={{\n      activeApp,\n      activeView,\n      activeDataset,\n      setActiveApp,\n      setActiveView,\n      setActiveDataset,\n    }}>\n      {children}\n    </AppStateContext.Provider>\n  );\n}\n\nexport function useAppState() {\n  const context = useContext(AppStateContext);\n  if (context === undefined) {\n    throw new Error('useAppState must be used within an AppStateProvider');\n  }\n  return context;\n}\n","/**\n * Input Sanitization and Validation Utilities\n *\n * Provides comprehensive input validation and sanitization for user inputs,\n * DSL compilation, and data processing to prevent injection attacks and\n * ensure data integrity.\n */\n\n/**\n * Validation result interface\n */\nexport interface ValidationResult {\n  isValid: boolean;\n  sanitizedValue?: string | number | boolean;\n  errors: string[];\n  warnings: string[];\n}\n\n/**\n * Sanitization options\n */\nexport interface SanitizationOptions {\n  maxLength?: number;\n  allowedCharacters?: RegExp;\n  stripHTML?: boolean;\n  escapeSQL?: boolean;\n  normalizeWhitespace?: boolean;\n  allowedValues?: string[];\n}\n\n/**\n * SQL injection patterns to detect and prevent\n */\nconst SQL_INJECTION_PATTERNS = [\n  /(\\b(ALTER|CREATE|DELETE|DROP|EXEC(UTE)?|INSERT( +INTO)?|MERGE|SELECT|UPDATE|UNION( +ALL)?)\\b)/i,\n  /(\\b(AND|OR)\\b.*(=|<|>|!=|<>|<=|>=).*(\\b(SELECT|INSERT|UPDATE|DELETE)\\b))/i,\n  /(;|--|\\/\\*|\\*\\/)/,\n  /(\\b(SCRIPT|JAVASCRIPT|VBSCRIPT|ONLOAD|ONERROR)\\b)/i,\n  /'(\\s*|\\s*[\\w\\s]*\\s*);?\\s*(DROP|DELETE|INSERT|UPDATE|SELECT|UNION)/i\n];\n\n/**\n * XSS patterns to detect and prevent\n */\nconst XSS_PATTERNS = [\n  /<script\\b[^<]*(?:(?!<\\/script>)<[^<]*)*<\\/script>/gi,\n  /<iframe\\b[^<]*(?:(?!<\\/iframe>)<[^<]*)*<\\/iframe>/gi,\n  /javascript:/gi,\n  /vbscript:/gi,\n  /on\\w+\\s*=/gi,\n  /<img[^>]+src[\\s]*=[\\s]*[\"']javascript:/gi\n];\n\n/**\n * Validates and sanitizes string input\n */\nexport function sanitizeString(\n  input: string,\n  options: SanitizationOptions = {}\n): ValidationResult {\n  const errors: string[] = [];\n  const warnings: string[] = [];\n  let sanitized = input;\n\n  // Basic null/undefined check\n  if (input == null) {\n    return {\n      isValid: false,\n      errors: ['Input cannot be null or undefined'],\n      warnings: []\n    };\n  }\n\n  // Convert to string if not already\n  if (typeof input !== 'string') {\n    sanitized = String(input);\n    warnings.push('Input converted to string');\n  }\n\n  // Length validation\n  if (options.maxLength && sanitized.length > options.maxLength) {\n    errors.push(`Input exceeds maximum length of ${options.maxLength}`);\n    sanitized = sanitized.substring(0, options.maxLength);\n    warnings.push(`Input truncated to ${options.maxLength} characters`);\n  }\n\n  // Character validation\n  if (options.allowedCharacters && !options.allowedCharacters.test(sanitized)) {\n    errors.push('Input contains invalid characters');\n  }\n\n  // SQL injection detection\n  if (options.escapeSQL !== false) {\n    const hasSQL = SQL_INJECTION_PATTERNS.some(pattern => pattern.test(sanitized));\n    if (hasSQL) {\n      errors.push('Input contains potential SQL injection patterns');\n    }\n\n    // Escape SQL characters\n    sanitized = sanitized\n      .replace(/'/g, \"''\")\n      .replace(/;/g, '\\\\;')\n      .replace(/--/g, '\\\\-\\\\-');\n  }\n\n  // XSS detection\n  const hasXSS = XSS_PATTERNS.some(pattern => pattern.test(sanitized));\n  if (hasXSS) {\n    errors.push('Input contains potential XSS patterns');\n  }\n\n  // HTML stripping\n  if (options.stripHTML) {\n    const originalLength = sanitized.length;\n    sanitized = sanitized.replace(/<[^>]*>/g, '');\n    if (sanitized.length < originalLength) {\n      warnings.push('HTML tags removed from input');\n    }\n  }\n\n  // Whitespace normalization\n  if (options.normalizeWhitespace) {\n    const original = sanitized;\n    sanitized = sanitized.replace(/\\s+/g, ' ').trim();\n    if (original !== sanitized) {\n      warnings.push('Whitespace normalized');\n    }\n  }\n\n  // Allowed values check\n  if (options.allowedValues && !options.allowedValues.includes(sanitized)) {\n    errors.push(`Value must be one of: ${options.allowedValues.join(', ')}`);\n  }\n\n  return {\n    isValid: errors.length === 0,\n    sanitizedValue: sanitized,\n    errors,\n    warnings\n  };\n}\n\n/**\n * Validates and sanitizes numeric input\n */\nexport function sanitizeNumber(\n  input: unknown,\n  options: { min?: number; max?: number; integer?: boolean } = {}\n): ValidationResult {\n  const errors: string[] = [];\n  const warnings: string[] = [];\n\n  if (input == null) {\n    return {\n      isValid: false,\n      errors: ['Input cannot be null or undefined'],\n      warnings: []\n    };\n  }\n\n  let num: number;\n\n  if (typeof input === 'string') {\n    // Check for injection patterns in string numbers\n    const hasInjection = SQL_INJECTION_PATTERNS.some(pattern => pattern.test(input));\n    if (hasInjection) {\n      return {\n        isValid: false,\n        errors: ['Numeric input contains invalid characters'],\n        warnings: []\n      };\n    }\n\n    num = Number(input);\n    warnings.push('String input converted to number');\n  } else if (typeof input === 'number') {\n    num = input;\n  } else {\n    return {\n      isValid: false,\n      errors: ['Input must be a number or numeric string'],\n      warnings: []\n    };\n  }\n\n  // NaN check\n  if (isNaN(num)) {\n    errors.push('Input is not a valid number');\n  }\n\n  // Infinity check\n  if (!isFinite(num)) {\n    errors.push('Input cannot be infinite');\n  }\n\n  // Integer validation\n  if (options.integer && !Number.isInteger(num)) {\n    errors.push('Input must be an integer');\n    num = Math.round(num);\n    warnings.push('Non-integer value rounded');\n  }\n\n  // Range validation\n  if (options.min !== undefined && num < options.min) {\n    errors.push(`Input must be at least ${options.min}`);\n  }\n\n  if (options.max !== undefined && num > options.max) {\n    errors.push(`Input cannot exceed ${options.max}`);\n  }\n\n  return {\n    isValid: errors.length === 0,\n    sanitizedValue: num,\n    errors,\n    warnings\n  };\n}\n\n/**\n * Sanitizes DSL filter values specifically\n */\nexport function sanitizeDSLValue(value: unknown): ValidationResult {\n  if (value == null) {\n    return {\n      isValid: true,\n      sanitizedValue: null,\n      errors: [],\n      warnings: []\n    };\n  }\n\n  // Handle different value types\n  if (typeof value === 'string') {\n    return sanitizeString(value, {\n      maxLength: 1000,\n      stripHTML: true,\n      escapeSQL: true,\n      normalizeWhitespace: true,\n      allowedCharacters: /^[a-zA-Z0-9\\s\\-_.:@/]+$/\n    });\n  }\n\n  if (typeof value === 'number') {\n    return sanitizeNumber(value, {\n      min: -1e10,\n      max: 1e10\n    });\n  }\n\n  if (typeof value === 'boolean') {\n    return {\n      isValid: true,\n      sanitizedValue: value,\n      errors: [],\n      warnings: []\n    };\n  }\n\n  // Handle objects (time presets, etc.)\n  if (typeof value === 'object') {\n    const errors: string[] = [];\n    const warnings: string[] = [];\n\n    // Validate object structure\n    if (Array.isArray(value)) {\n      errors.push('Arrays not supported in DSL values');\n    } else if ('preset' in value && typeof value.preset === 'string') {\n      // Validate time preset\n      const presetValidation = sanitizeString(value.preset, {\n        maxLength: 50,\n        allowedValues: [\n          'today', 'yesterday', 'last-week', 'last-7-days',\n          'last-month', 'last-30-days', 'this-year', 'next-week', 'overdue'\n        ]\n      });\n\n      if (!presetValidation.isValid) {\n        errors.push(...presetValidation.errors);\n      }\n\n      return {\n        isValid: errors.length === 0,\n        sanitizedValue: { preset: presetValidation.sanitizedValue },\n        errors,\n        warnings: [...warnings, ...presetValidation.warnings]\n      };\n    } else {\n      errors.push('Invalid object structure in DSL value');\n    }\n\n    return {\n      isValid: false,\n      errors,\n      warnings\n    };\n  }\n\n  return {\n    isValid: false,\n    errors: ['Unsupported value type'],\n    warnings: []\n  };\n}\n\n/**\n * Sanitizes field names in DSL queries\n */\nexport function sanitizeFieldName(fieldName: string): ValidationResult {\n  return sanitizeString(fieldName, {\n    maxLength: 100,\n    allowedCharacters: /^[a-zA-Z][a-zA-Z0-9_]*$/,\n    stripHTML: true,\n    normalizeWhitespace: true\n  });\n}\n\n/**\n * Sanitizes operator strings in DSL queries\n */\nexport function sanitizeOperator(operator: string): ValidationResult {\n  const allowedOperators = ['=', '!=', '<', '>', '<=', '>=', '~'];\n\n  return sanitizeString(operator, {\n    maxLength: 5,\n    allowedValues: allowedOperators,\n    stripHTML: true,\n    normalizeWhitespace: true\n  });\n}\n\n/**\n * Comprehensive validation for complete user inputs\n */\nexport function validateUserInput(input: {\n  type: 'search' | 'filter' | 'note' | 'command';\n  value: unknown;\n  context?: string;\n}): ValidationResult {\n  const { type, value, context } = input;\n  const warnings: string[] = [];\n\n  if (context) {\n    warnings.push(`Validating ${type} input in context: ${context}`);\n  }\n\n  switch (type) {\n    case 'search':\n      return sanitizeString(String(value), {\n        maxLength: 500,\n        stripHTML: true,\n        normalizeWhitespace: true,\n        allowedCharacters: /^[a-zA-Z0-9\\s\\-_.:@/()[\\]\"']+$/\n      });\n\n    case 'filter':\n      return sanitizeDSLValue(value);\n\n    case 'note':\n      return sanitizeString(String(value), {\n        maxLength: 50000, // Allow large notes\n        stripHTML: false, // Preserve formatting\n        normalizeWhitespace: false\n      });\n\n    case 'command':\n      return sanitizeString(String(value), {\n        maxLength: 1000,\n        stripHTML: true,\n        normalizeWhitespace: true,\n        escapeSQL: true\n      });\n\n    default:\n      return {\n        isValid: false,\n        errors: ['Unknown input type'],\n        warnings\n      };\n  }\n}\n\n/**\n * Batch validation for multiple inputs\n */\nexport function validateBatch(\n  inputs: Array<{ id: string; type: 'search' | 'filter' | 'note' | 'command'; value: unknown }>\n): { [id: string]: ValidationResult } {\n  const results: { [id: string]: ValidationResult } = {};\n\n  for (const input of inputs) {\n    results[input.id] = validateUserInput(input);\n  }\n\n  return results;\n}\n\n/**\n * Utility to check if a validation result indicates a security risk\n */\nexport function isSecurityRisk(result: ValidationResult): boolean {\n  return result.errors.some(error =>\n    error.includes('SQL injection') ||\n    error.includes('XSS') ||\n    error.includes('invalid characters') ||\n    error.includes('security')\n  );\n}\n\n/**\n * Create validation middleware for common use cases\n */\nexport function createValidator(defaultOptions: SanitizationOptions) {\n  return (input: string) => sanitizeString(input, defaultOptions);\n}\n\n// Pre-configured validators for common use cases\nexport const validateSearchQuery = createValidator({\n  maxLength: 500,\n  stripHTML: true,\n  normalizeWhitespace: true,\n  allowedCharacters: /^[a-zA-Z0-9\\s\\-_.:@/()[\\]\"']+$/\n});\n\nexport const validateFileName = createValidator({\n  maxLength: 255,\n  stripHTML: true,\n  normalizeWhitespace: true,\n  allowedCharacters: /^[a-zA-Z0-9\\s\\-_.]+$/\n});\n\nexport const validateMarkdownContent = createValidator({\n  maxLength: 100000,\n  stripHTML: false,\n  normalizeWhitespace: false,\n  escapeSQL: true\n});","// ============================================================================\n// Isometry DSL Compiler\n// ============================================================================\n// Compiles AST to SQL WHERE clause\n//\n// Usage:\n//   import { compile } from '@/dsl/compiler';\n//   const { sql, params } = compile(ast);\n// ============================================================================\n\nimport type { ASTNode, CompiledQuery, FilterOperator, TimePreset, FilterValue } from './types';\nimport {\n  sanitizeDSLValue,\n  sanitizeFieldName,\n  sanitizeOperator,\n  isSecurityRisk\n} from '../utils/input-sanitization';\n\n/**\n * Compile AST to SQL WHERE clause with parameterized values\n * @param ast Parsed AST\n * @returns SQL string and parameter values\n */\nexport function compile(ast: ASTNode | null): CompiledQuery {\n  if (!ast) {\n    return { sql: '1=1', params: [] };\n  }\n  \n  const params: (string | number | boolean)[] = [];\n  \n  function compileNode(node: ASTNode): string {\n    switch (node.type) {\n      case 'filter':\n        return compileFilter(node.field, node.operator, node.value);\n      \n      case 'axis':\n        return compileAxisFilter(node.axis, node.value);\n      \n      case 'and':\n        return `(${compileNode(node.left)} AND ${compileNode(node.right)})`;\n      \n      case 'or':\n        return `(${compileNode(node.left)} OR ${compileNode(node.right)})`;\n      \n      case 'not':\n        return `NOT (${compileNode(node.operand)})`;\n      \n      case 'group':\n        return `(${compileNode(node.expression)})`;\n      \n      default:\n        return '1=1';\n    }\n  }\n  \n  function compileFilter(field: string, operator: FilterOperator, value: FilterValue): string {\n    // Validate and sanitize field name\n    const fieldValidation = sanitizeFieldName(field);\n    if (!fieldValidation.isValid || isSecurityRisk(fieldValidation)) {\n      throw new Error(`Invalid field name: ${fieldValidation.errors.join(', ')}`);\n    }\n    const safeField = fieldValidation.sanitizedValue as string;\n\n    // Validate and sanitize operator\n    const operatorValidation = sanitizeOperator(operator);\n    if (!operatorValidation.isValid) {\n      throw new Error(`Invalid operator: ${operatorValidation.errors.join(', ')}`);\n    }\n    const safeOperator = operatorValidation.sanitizedValue as string;\n\n    // Validate and sanitize value\n    const valueValidation = sanitizeDSLValue(value);\n    if (!valueValidation.isValid || isSecurityRisk(valueValidation)) {\n      throw new Error(`Invalid filter value: ${valueValidation.errors.join(', ')}`);\n    }\n    const safeValue = valueValidation.sanitizedValue;\n\n    // Handle time presets\n    if (typeof safeValue === 'object' && safeValue && 'preset' in safeValue) {\n      return compileTimePreset(safeField, (safeValue as { preset: string }).preset);\n    }\n\n    // Handle LIKE operator\n    if (safeOperator === '~') {\n      params.push(`%${safeValue}%`);\n      return `${safeField} LIKE ?`;\n    }\n\n    // Handle standard operators\n    params.push(safeValue);\n    return `${safeField} ${safeOperator} ?`;\n  }\n  \n  function compileAxisFilter(axis: string, value: FilterValue): string {\n    // Validate axis name\n    const allowedAxes = ['time', 'category', 'hierarchy', 'alphabet', 'location'];\n    if (!allowedAxes.includes(axis)) {\n      throw new Error(`Invalid axis: ${axis}`);\n    }\n\n    // Validate and sanitize value\n    const valueValidation = sanitizeDSLValue(value);\n    if (!valueValidation.isValid || isSecurityRisk(valueValidation)) {\n      throw new Error(`Invalid axis value: ${valueValidation.errors.join(', ')}`);\n    }\n    const safeValue = valueValidation.sanitizedValue;\n\n    // Map LATCH axes to SQL\n    switch (axis) {\n      case 'time':\n        if (typeof safeValue === 'object' && safeValue && 'preset' in safeValue) {\n          return compileTimePreset('created', (safeValue as { preset: string }).preset);\n        }\n        params.push(safeValue);\n        return `created = ?`;\n\n      case 'category':\n        params.push(safeValue);\n        return `category = ?`;\n\n      case 'hierarchy':\n        params.push(safeValue);\n        return `priority <= ?`;\n\n      case 'alphabet':\n        // Handle ranges like A-M with proper parameterization\n        if (typeof safeValue === 'string' && safeValue.includes('-')) {\n          const rangeParts = safeValue.split('-');\n          if (rangeParts.length !== 2) {\n            throw new Error('Invalid alphabet range format');\n          }\n\n          const [start, end] = rangeParts;\n\n          // Validate range characters (single uppercase letters only)\n          if (!/^[A-Z]$/.test(start) || !/^[A-Z]$/.test(end)) {\n            throw new Error('Alphabet range must be single uppercase letters (A-Z)');\n          }\n\n          // Use parameterized query for range\n          params.push(start);\n          params.push(end);\n          return `SUBSTR(name, 1, 1) BETWEEN ? AND ?`;\n        }\n\n        params.push(`${safeValue}%`);\n        return `name LIKE ?`;\n\n      case 'location':\n        params.push(safeValue);\n        return `location = ?`;\n\n      default:\n        return '1=1';\n    }\n  }\n  \n  function compileTimePreset(field: string, preset: TimePreset): string {\n    // Validate field name for SQL injection\n    const fieldValidation = sanitizeFieldName(field);\n    if (!fieldValidation.isValid || isSecurityRisk(fieldValidation)) {\n      throw new Error(`Invalid time field name: ${fieldValidation.errors.join(', ')}`);\n    }\n    const safeField = fieldValidation.sanitizedValue as string;\n\n    // Validate preset value\n    const allowedPresets = [\n      'today', 'yesterday', 'last-week', 'last-7-days',\n      'last-month', 'last-30-days', 'this-year', 'next-week', 'overdue'\n    ] as const;\n\n    if (!allowedPresets.includes(preset as typeof allowedPresets[number])) {\n      throw new Error(`Invalid time preset: ${preset}`);\n    }\n\n    switch (preset) {\n      case 'today':\n        return `date(${safeField}) = date('now')`;\n      case 'yesterday':\n        return `date(${safeField}) = date('now', '-1 day')`;\n      case 'last-week':\n      case 'last-7-days':\n        return `${safeField} >= date('now', '-7 days')`;\n      case 'last-month':\n      case 'last-30-days':\n        return `${safeField} >= date('now', '-30 days')`;\n      case 'this-year':\n        return `${safeField} >= date('now', 'start of year')`;\n      case 'next-week':\n        return `${safeField} <= date('now', '+7 days')`;\n      case 'overdue':\n        return `${safeField} < date('now')`;\n      default:\n        return '1=1';\n    }\n  }\n  \n  return {\n    sql: compileNode(ast),\n    params\n  };\n}\n\n/**\n * Convenience function: parse + compile in one step\n */\nexport async function compileString(dsl: string): Promise<CompiledQuery> {\n  // Import dynamically to avoid circular dependency\n  const { parse } = await import('./parser');\n  const ast = parse(dsl);\n  return compile(ast);\n}\n","import { createContext, useContext, ReactNode, useState, useCallback, useMemo } from 'react';\nimport { compile } from '../dsl/compiler';\nimport type { FilterOperator, CompiledQuery, ASTNode, AndNode, FilterNode } from '../dsl/types';\n\nexport interface Filter {\n  field: string;\n  operator: FilterOperator;\n  value: string | number | boolean;\n}\n\ninterface FilterContextType {\n  filters: Filter[];\n  addFilter: (filter: Filter) => void;\n  removeFilter: (index: number) => void;\n  clearFilters: () => void;\n  compiledQuery: CompiledQuery;\n}\n\nconst FilterContext = createContext<FilterContextType | undefined>(undefined);\n\n/**\n * Convert filters array to AST for compilation\n */\nfunction filtersToAST(filters: Filter[]): ASTNode | null {\n  if (filters.length === 0) return null;\n\n  // Convert each filter to a FilterNode\n  const nodes: FilterNode[] = filters.map(f => ({\n    type: 'filter' as const,\n    field: f.field,\n    operator: f.operator,\n    value: f.value,\n  }));\n\n  // Combine with AND nodes\n  if (nodes.length === 1) {\n    return nodes[0];\n  }\n\n  // Build a left-associative AND tree\n  let result: ASTNode = nodes[0];\n  for (let i = 1; i < nodes.length; i++) {\n    result = {\n      type: 'and',\n      left: result,\n      right: nodes[i],\n    } as AndNode;\n  }\n\n  return result;\n}\n\nexport function FilterProvider({ children }: { children: ReactNode }) {\n  const [filters, setFilters] = useState<Filter[]>([]);\n\n  const addFilter = useCallback((filter: Filter) => {\n    setFilters(prev => [...prev, filter]);\n  }, []);\n\n  const removeFilter = useCallback((index: number) => {\n    setFilters(prev => prev.filter((_, i) => i !== index));\n  }, []);\n\n  const clearFilters = useCallback(() => {\n    setFilters([]);\n  }, []);\n\n  const compiledQuery = useMemo(() => {\n    const ast = filtersToAST(filters);\n    return compile(ast);\n  }, [filters]);\n\n  return (\n    <FilterContext.Provider value={{\n      filters,\n      addFilter,\n      removeFilter,\n      clearFilters,\n      compiledQuery,\n    }}>\n      {children}\n    </FilterContext.Provider>\n  );\n}\n\nexport function useFilters() {\n  const context = useContext(FilterContext);\n  if (context === undefined) {\n    throw new Error('useFilters must be used within a FilterProvider');\n  }\n  return context;\n}\n","import { createContext, useContext, ReactNode, useState, useCallback } from 'react';\n\nexport interface Chip {\n  id: string;\n  label: string;\n  hasCheckbox?: boolean;\n  checked?: boolean;\n}\n\nexport interface Wells {\n  available: Chip[];\n  rows: Chip[];      // Row headers (left side, vertical grouping)\n  columns: Chip[];   // Column headers (top, horizontal grouping)\n  zLayers: Chip[];\n}\n\ninterface PAFVContextType {\n  wells: Wells;\n  moveChip: (fromWell: keyof Wells, _fromIndex: number, toWell: keyof Wells, toIndex: number) => void;\n  toggleCheckbox: (well: keyof Wells, _chipId: string) => void;\n  transpose: () => void;\n}\n\nconst PAFVContext = createContext<PAFVContextType | undefined>(undefined);\n\nconst DEFAULT_WELLS: Wells = {\n  available: [],\n  rows: [\n    { id: 'folder', label: 'Folder' },\n    { id: 'subfolder', label: 'Sub-folder' },\n    { id: 'tags', label: 'Tags' },\n  ],\n  columns: [\n    { id: 'year', label: 'Year' },\n    { id: 'month', label: 'Month' },\n  ],\n  zLayers: [\n    { id: 'auditview', label: 'Audit View', hasCheckbox: true, checked: false },\n  ],\n};\n\nexport function PAFVProvider({ children }: { children: ReactNode }) {\n  const [wells, setWells] = useState<Wells>(DEFAULT_WELLS);\n\n  const moveChip = useCallback((\n    fromWell: keyof Wells,\n    fromIndex: number,\n    toWell: keyof Wells,\n    toIndex: number\n  ) => {\n    setWells(prev => {\n      const newWells: Wells = {\n        available: [...prev.available],\n        rows: [...prev.rows],\n        columns: [...prev.columns],\n        zLayers: [...prev.zLayers],\n      };\n      const [movedChip] = newWells[fromWell].splice(fromIndex, 1);\n      newWells[toWell].splice(toIndex, 0, movedChip);\n      return newWells;\n    });\n  }, []);\n\n  const toggleCheckbox = useCallback((well: keyof Wells, _chipId: string) => {\n    setWells(prev => ({\n      ...prev,\n      [well]: prev[well].map(chip =>\n        chip.id === chipId ? { ...chip, checked: !chip.checked } : chip\n      ),\n    }));\n  }, []);\n\n  const transpose = useCallback(() => {\n    setWells(prev => ({\n      ...prev,\n      rows: prev.columns,\n      columns: prev.rows,\n    }));\n  }, []);\n\n  return (\n    <PAFVContext.Provider value={{ wells, moveChip, toggleCheckbox, transpose }}>\n      {children}\n    </PAFVContext.Provider>\n  );\n}\n\nexport function usePAFV() {\n  const context = useContext(PAFVContext);\n  if (context === undefined) {\n    throw new Error('usePAFV must be used within a PAFVProvider');\n  }\n  return context;\n}\n","import { useState, useEffect } from 'react';\nimport type { Node } from '../types/node';\n\n// Simple mock data for MVP demonstration\nconst MOCK_NODES: Node[] = [\n  {\n    id: '1',\n    name: 'Project Alpha',\n    content: 'Initial project planning',\n    folder: 'Projects',\n    status: 'active',\n    priority: 'high',\n    createdAt: '2024-01-15T10:00:00Z',\n    modifiedAt: '2024-01-20T15:30:00Z',\n    deletedAt: null,\n  },\n  {\n    id: '2',\n    name: 'Meeting Notes',\n    content: 'Weekly team sync',\n    folder: 'Meetings',\n    status: 'completed',\n    priority: 'medium',\n    createdAt: '2024-01-10T09:00:00Z',\n    modifiedAt: '2024-01-10T16:00:00Z',\n    deletedAt: null,\n  },\n  {\n    id: '3',\n    name: 'Research Task',\n    content: 'Market analysis',\n    folder: 'Research',\n    status: 'pending',\n    priority: 'low',\n    createdAt: '2024-01-08T14:00:00Z',\n    modifiedAt: '2024-01-12T11:00:00Z',\n    deletedAt: null,\n  },\n  {\n    id: '4',\n    name: 'Bug Fix #123',\n    content: 'Critical production issue',\n    folder: 'Development',\n    status: 'active',\n    priority: 'high',\n    createdAt: '2024-01-22T08:00:00Z',\n    modifiedAt: '2024-01-22T08:30:00Z',\n    deletedAt: null,\n  },\n  {\n    id: '5',\n    name: 'Feature Spec',\n    content: 'New user dashboard',\n    folder: 'Projects',\n    status: 'draft',\n    priority: 'medium',\n    createdAt: '2024-01-05T13:00:00Z',\n    modifiedAt: '2024-01-18T10:00:00Z',\n    deletedAt: null,\n  },\n  {\n    id: '6',\n    name: 'Documentation Update',\n    content: 'API reference docs',\n    folder: 'Documentation',\n    status: 'completed',\n    priority: 'low',\n    createdAt: '2024-01-12T16:00:00Z',\n    modifiedAt: '2024-01-19T14:00:00Z',\n    deletedAt: null,\n  }\n];\n\nexport interface MockQueryState {\n  data: Node[] | null;\n  loading: boolean;\n  error: Error | null;\n}\n\n/**\n * Mock data hook for MVP demonstration - bypasses all database complexity\n * Returns data in same format as useFilteredNodes for drop-in replacement\n */\nexport function useMockData(): MockQueryState {\n  const [loading, setLoading] = useState(true);\n\n  useEffect(() => {\n    // Simulate async loading\n    const timer = setTimeout(() => {\n      setLoading(false);\n    }, 500);\n\n    return () => clearTimeout(timer);\n  }, []);\n\n  return {\n    data: loading ? null : MOCK_NODES,\n    loading,\n    error: null,\n  };\n}","function _extends() {\n  return _extends = Object.assign ? Object.assign.bind() : function (n) {\n    for (var e = 1; e < arguments.length; e++) {\n      var t = arguments[e];\n      for (var r in t) ({}).hasOwnProperty.call(t, r) && (n[r] = t[r]);\n    }\n    return n;\n  }, _extends.apply(null, arguments);\n}\nexport { _extends as default };","function _assertThisInitialized(e) {\n  if (void 0 === e) throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  return e;\n}\nexport { _assertThisInitialized as default };","function _setPrototypeOf(t, e) {\n  return _setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function (t, e) {\n    return t.__proto__ = e, t;\n  }, _setPrototypeOf(t, e);\n}\nexport { _setPrototypeOf as default };","var safeIsNaN = Number.isNaN ||\n    function ponyfill(value) {\n        return typeof value === 'number' && value !== value;\n    };\nfunction isEqual(first, second) {\n    if (first === second) {\n        return true;\n    }\n    if (safeIsNaN(first) && safeIsNaN(second)) {\n        return true;\n    }\n    return false;\n}\nfunction areInputsEqual(newInputs, lastInputs) {\n    if (newInputs.length !== lastInputs.length) {\n        return false;\n    }\n    for (var i = 0; i < newInputs.length; i++) {\n        if (!isEqual(newInputs[i], lastInputs[i])) {\n            return false;\n        }\n    }\n    return true;\n}\n\nfunction memoizeOne(resultFn, isEqual) {\n    if (isEqual === void 0) { isEqual = areInputsEqual; }\n    var lastThis;\n    var lastArgs = [];\n    var lastResult;\n    var calledOnce = false;\n    function memoized() {\n        var newArgs = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            newArgs[_i] = arguments[_i];\n        }\n        if (calledOnce && lastThis === this && isEqual(newArgs, lastArgs)) {\n            return lastResult;\n        }\n        lastResult = resultFn.apply(this, newArgs);\n        calledOnce = true;\n        lastThis = this;\n        lastArgs = newArgs;\n        return lastResult;\n    }\n    return memoized;\n}\n\nexport default memoizeOne;\n","import _extends from '@babel/runtime/helpers/esm/extends';\nimport _assertThisInitialized from '@babel/runtime/helpers/esm/assertThisInitialized';\nimport _inheritsLoose from '@babel/runtime/helpers/esm/inheritsLoose';\nimport memoizeOne from 'memoize-one';\nimport { createElement, PureComponent } from 'react';\nimport _objectWithoutPropertiesLoose from '@babel/runtime/helpers/esm/objectWithoutPropertiesLoose';\n\n// Animation frame based implementation of setTimeout.\n// Inspired by Joe Lambert, https://gist.github.com/joelambert/1002116#file-requesttimeout-js\nvar hasNativePerformanceNow = typeof performance === 'object' && typeof performance.now === 'function';\nvar now = hasNativePerformanceNow ? function () {\n  return performance.now();\n} : function () {\n  return Date.now();\n};\nfunction cancelTimeout(timeoutID) {\n  cancelAnimationFrame(timeoutID.id);\n}\nfunction requestTimeout(callback, delay) {\n  var start = now();\n\n  function tick() {\n    if (now() - start >= delay) {\n      callback.call(null);\n    } else {\n      timeoutID.id = requestAnimationFrame(tick);\n    }\n  }\n\n  var timeoutID = {\n    id: requestAnimationFrame(tick)\n  };\n  return timeoutID;\n}\n\nvar size = -1; // This utility copied from \"dom-helpers\" package.\n\nfunction getScrollbarSize(recalculate) {\n  if (recalculate === void 0) {\n    recalculate = false;\n  }\n\n  if (size === -1 || recalculate) {\n    var div = document.createElement('div');\n    var style = div.style;\n    style.width = '50px';\n    style.height = '50px';\n    style.overflow = 'scroll';\n    document.body.appendChild(div);\n    size = div.offsetWidth - div.clientWidth;\n    document.body.removeChild(div);\n  }\n\n  return size;\n}\nvar cachedRTLResult = null; // TRICKY According to the spec, scrollLeft should be negative for RTL aligned elements.\n// Chrome does not seem to adhere; its scrollLeft values are positive (measured relative to the left).\n// Safari's elastic bounce makes detecting this even more complicated wrt potential false positives.\n// The safest way to check this is to intentionally set a negative offset,\n// and then verify that the subsequent \"scroll\" event matches the negative offset.\n// If it does not match, then we can assume a non-standard RTL scroll implementation.\n\nfunction getRTLOffsetType(recalculate) {\n  if (recalculate === void 0) {\n    recalculate = false;\n  }\n\n  if (cachedRTLResult === null || recalculate) {\n    var outerDiv = document.createElement('div');\n    var outerStyle = outerDiv.style;\n    outerStyle.width = '50px';\n    outerStyle.height = '50px';\n    outerStyle.overflow = 'scroll';\n    outerStyle.direction = 'rtl';\n    var innerDiv = document.createElement('div');\n    var innerStyle = innerDiv.style;\n    innerStyle.width = '100px';\n    innerStyle.height = '100px';\n    outerDiv.appendChild(innerDiv);\n    document.body.appendChild(outerDiv);\n\n    if (outerDiv.scrollLeft > 0) {\n      cachedRTLResult = 'positive-descending';\n    } else {\n      outerDiv.scrollLeft = 1;\n\n      if (outerDiv.scrollLeft === 0) {\n        cachedRTLResult = 'negative';\n      } else {\n        cachedRTLResult = 'positive-ascending';\n      }\n    }\n\n    document.body.removeChild(outerDiv);\n    return cachedRTLResult;\n  }\n\n  return cachedRTLResult;\n}\n\nvar IS_SCROLLING_DEBOUNCE_INTERVAL = 150;\n\nvar defaultItemKey = function defaultItemKey(_ref) {\n  var columnIndex = _ref.columnIndex,\n      data = _ref.data,\n      rowIndex = _ref.rowIndex;\n  return rowIndex + \":\" + columnIndex;\n}; // In DEV mode, this Set helps us only log a warning once per component instance.\n// This avoids spamming the console every time a render happens.\n\n\nvar devWarningsOverscanCount = null;\nvar devWarningsOverscanRowsColumnsCount = null;\nvar devWarningsTagName = null;\n\nif (process.env.NODE_ENV !== 'production') {\n  if (typeof window !== 'undefined' && typeof window.WeakSet !== 'undefined') {\n    devWarningsOverscanCount = /*#__PURE__*/new WeakSet();\n    devWarningsOverscanRowsColumnsCount = /*#__PURE__*/new WeakSet();\n    devWarningsTagName = /*#__PURE__*/new WeakSet();\n  }\n}\n\nfunction createGridComponent(_ref2) {\n  var _class;\n\n  var getColumnOffset = _ref2.getColumnOffset,\n      getColumnStartIndexForOffset = _ref2.getColumnStartIndexForOffset,\n      getColumnStopIndexForStartIndex = _ref2.getColumnStopIndexForStartIndex,\n      getColumnWidth = _ref2.getColumnWidth,\n      getEstimatedTotalHeight = _ref2.getEstimatedTotalHeight,\n      getEstimatedTotalWidth = _ref2.getEstimatedTotalWidth,\n      getOffsetForColumnAndAlignment = _ref2.getOffsetForColumnAndAlignment,\n      getOffsetForRowAndAlignment = _ref2.getOffsetForRowAndAlignment,\n      getRowHeight = _ref2.getRowHeight,\n      getRowOffset = _ref2.getRowOffset,\n      getRowStartIndexForOffset = _ref2.getRowStartIndexForOffset,\n      getRowStopIndexForStartIndex = _ref2.getRowStopIndexForStartIndex,\n      initInstanceProps = _ref2.initInstanceProps,\n      shouldResetStyleCacheOnItemSizeChange = _ref2.shouldResetStyleCacheOnItemSizeChange,\n      validateProps = _ref2.validateProps;\n  return _class = /*#__PURE__*/function (_PureComponent) {\n    _inheritsLoose(Grid, _PureComponent);\n\n    // Always use explicit constructor for React components.\n    // It produces less code after transpilation. (#26)\n    // eslint-disable-next-line no-useless-constructor\n    function Grid(props) {\n      var _this;\n\n      _this = _PureComponent.call(this, props) || this;\n      _this._instanceProps = initInstanceProps(_this.props, _assertThisInitialized(_this));\n      _this._resetIsScrollingTimeoutId = null;\n      _this._outerRef = void 0;\n      _this.state = {\n        instance: _assertThisInitialized(_this),\n        isScrolling: false,\n        horizontalScrollDirection: 'forward',\n        scrollLeft: typeof _this.props.initialScrollLeft === 'number' ? _this.props.initialScrollLeft : 0,\n        scrollTop: typeof _this.props.initialScrollTop === 'number' ? _this.props.initialScrollTop : 0,\n        scrollUpdateWasRequested: false,\n        verticalScrollDirection: 'forward'\n      };\n      _this._callOnItemsRendered = void 0;\n      _this._callOnItemsRendered = memoizeOne(function (overscanColumnStartIndex, overscanColumnStopIndex, overscanRowStartIndex, overscanRowStopIndex, visibleColumnStartIndex, visibleColumnStopIndex, visibleRowStartIndex, visibleRowStopIndex) {\n        return _this.props.onItemsRendered({\n          overscanColumnStartIndex: overscanColumnStartIndex,\n          overscanColumnStopIndex: overscanColumnStopIndex,\n          overscanRowStartIndex: overscanRowStartIndex,\n          overscanRowStopIndex: overscanRowStopIndex,\n          visibleColumnStartIndex: visibleColumnStartIndex,\n          visibleColumnStopIndex: visibleColumnStopIndex,\n          visibleRowStartIndex: visibleRowStartIndex,\n          visibleRowStopIndex: visibleRowStopIndex\n        });\n      });\n      _this._callOnScroll = void 0;\n      _this._callOnScroll = memoizeOne(function (scrollLeft, scrollTop, horizontalScrollDirection, verticalScrollDirection, scrollUpdateWasRequested) {\n        return _this.props.onScroll({\n          horizontalScrollDirection: horizontalScrollDirection,\n          scrollLeft: scrollLeft,\n          scrollTop: scrollTop,\n          verticalScrollDirection: verticalScrollDirection,\n          scrollUpdateWasRequested: scrollUpdateWasRequested\n        });\n      });\n      _this._getItemStyle = void 0;\n\n      _this._getItemStyle = function (rowIndex, columnIndex) {\n        var _this$props = _this.props,\n            columnWidth = _this$props.columnWidth,\n            direction = _this$props.direction,\n            rowHeight = _this$props.rowHeight;\n\n        var itemStyleCache = _this._getItemStyleCache(shouldResetStyleCacheOnItemSizeChange && columnWidth, shouldResetStyleCacheOnItemSizeChange && direction, shouldResetStyleCacheOnItemSizeChange && rowHeight);\n\n        var key = rowIndex + \":\" + columnIndex;\n        var style;\n\n        if (itemStyleCache.hasOwnProperty(key)) {\n          style = itemStyleCache[key];\n        } else {\n          var _offset = getColumnOffset(_this.props, columnIndex, _this._instanceProps);\n\n          var isRtl = direction === 'rtl';\n          itemStyleCache[key] = style = {\n            position: 'absolute',\n            left: isRtl ? undefined : _offset,\n            right: isRtl ? _offset : undefined,\n            top: getRowOffset(_this.props, rowIndex, _this._instanceProps),\n            height: getRowHeight(_this.props, rowIndex, _this._instanceProps),\n            width: getColumnWidth(_this.props, columnIndex, _this._instanceProps)\n          };\n        }\n\n        return style;\n      };\n\n      _this._getItemStyleCache = void 0;\n      _this._getItemStyleCache = memoizeOne(function (_, __, ___) {\n        return {};\n      });\n\n      _this._onScroll = function (event) {\n        var _event$currentTarget = event.currentTarget,\n            clientHeight = _event$currentTarget.clientHeight,\n            clientWidth = _event$currentTarget.clientWidth,\n            scrollLeft = _event$currentTarget.scrollLeft,\n            scrollTop = _event$currentTarget.scrollTop,\n            scrollHeight = _event$currentTarget.scrollHeight,\n            scrollWidth = _event$currentTarget.scrollWidth;\n\n        _this.setState(function (prevState) {\n          if (prevState.scrollLeft === scrollLeft && prevState.scrollTop === scrollTop) {\n            // Scroll position may have been updated by cDM/cDU,\n            // In which case we don't need to trigger another render,\n            // And we don't want to update state.isScrolling.\n            return null;\n          }\n\n          var direction = _this.props.direction; // TRICKY According to the spec, scrollLeft should be negative for RTL aligned elements.\n          // This is not the case for all browsers though (e.g. Chrome reports values as positive, measured relative to the left).\n          // It's also easier for this component if we convert offsets to the same format as they would be in for ltr.\n          // So the simplest solution is to determine which browser behavior we're dealing with, and convert based on it.\n\n          var calculatedScrollLeft = scrollLeft;\n\n          if (direction === 'rtl') {\n            switch (getRTLOffsetType()) {\n              case 'negative':\n                calculatedScrollLeft = -scrollLeft;\n                break;\n\n              case 'positive-descending':\n                calculatedScrollLeft = scrollWidth - clientWidth - scrollLeft;\n                break;\n            }\n          } // Prevent Safari's elastic scrolling from causing visual shaking when scrolling past bounds.\n\n\n          calculatedScrollLeft = Math.max(0, Math.min(calculatedScrollLeft, scrollWidth - clientWidth));\n          var calculatedScrollTop = Math.max(0, Math.min(scrollTop, scrollHeight - clientHeight));\n          return {\n            isScrolling: true,\n            horizontalScrollDirection: prevState.scrollLeft < scrollLeft ? 'forward' : 'backward',\n            scrollLeft: calculatedScrollLeft,\n            scrollTop: calculatedScrollTop,\n            verticalScrollDirection: prevState.scrollTop < scrollTop ? 'forward' : 'backward',\n            scrollUpdateWasRequested: false\n          };\n        }, _this._resetIsScrollingDebounced);\n      };\n\n      _this._outerRefSetter = function (ref) {\n        var outerRef = _this.props.outerRef;\n        _this._outerRef = ref;\n\n        if (typeof outerRef === 'function') {\n          outerRef(ref);\n        } else if (outerRef != null && typeof outerRef === 'object' && outerRef.hasOwnProperty('current')) {\n          outerRef.current = ref;\n        }\n      };\n\n      _this._resetIsScrollingDebounced = function () {\n        if (_this._resetIsScrollingTimeoutId !== null) {\n          cancelTimeout(_this._resetIsScrollingTimeoutId);\n        }\n\n        _this._resetIsScrollingTimeoutId = requestTimeout(_this._resetIsScrolling, IS_SCROLLING_DEBOUNCE_INTERVAL);\n      };\n\n      _this._resetIsScrolling = function () {\n        _this._resetIsScrollingTimeoutId = null;\n\n        _this.setState({\n          isScrolling: false\n        }, function () {\n          // Clear style cache after state update has been committed.\n          // This way we don't break pure sCU for items that don't use isScrolling param.\n          _this._getItemStyleCache(-1);\n        });\n      };\n\n      return _this;\n    }\n\n    Grid.getDerivedStateFromProps = function getDerivedStateFromProps(nextProps, prevState) {\n      validateSharedProps(nextProps, prevState);\n      validateProps(nextProps);\n      return null;\n    };\n\n    var _proto = Grid.prototype;\n\n    _proto.scrollTo = function scrollTo(_ref3) {\n      var scrollLeft = _ref3.scrollLeft,\n          scrollTop = _ref3.scrollTop;\n\n      if (scrollLeft !== undefined) {\n        scrollLeft = Math.max(0, scrollLeft);\n      }\n\n      if (scrollTop !== undefined) {\n        scrollTop = Math.max(0, scrollTop);\n      }\n\n      this.setState(function (prevState) {\n        if (scrollLeft === undefined) {\n          scrollLeft = prevState.scrollLeft;\n        }\n\n        if (scrollTop === undefined) {\n          scrollTop = prevState.scrollTop;\n        }\n\n        if (prevState.scrollLeft === scrollLeft && prevState.scrollTop === scrollTop) {\n          return null;\n        }\n\n        return {\n          horizontalScrollDirection: prevState.scrollLeft < scrollLeft ? 'forward' : 'backward',\n          scrollLeft: scrollLeft,\n          scrollTop: scrollTop,\n          scrollUpdateWasRequested: true,\n          verticalScrollDirection: prevState.scrollTop < scrollTop ? 'forward' : 'backward'\n        };\n      }, this._resetIsScrollingDebounced);\n    };\n\n    _proto.scrollToItem = function scrollToItem(_ref4) {\n      var _ref4$align = _ref4.align,\n          align = _ref4$align === void 0 ? 'auto' : _ref4$align,\n          columnIndex = _ref4.columnIndex,\n          rowIndex = _ref4.rowIndex;\n      var _this$props2 = this.props,\n          columnCount = _this$props2.columnCount,\n          height = _this$props2.height,\n          rowCount = _this$props2.rowCount,\n          width = _this$props2.width;\n      var _this$state = this.state,\n          scrollLeft = _this$state.scrollLeft,\n          scrollTop = _this$state.scrollTop;\n      var scrollbarSize = getScrollbarSize();\n\n      if (columnIndex !== undefined) {\n        columnIndex = Math.max(0, Math.min(columnIndex, columnCount - 1));\n      }\n\n      if (rowIndex !== undefined) {\n        rowIndex = Math.max(0, Math.min(rowIndex, rowCount - 1));\n      }\n\n      var estimatedTotalHeight = getEstimatedTotalHeight(this.props, this._instanceProps);\n      var estimatedTotalWidth = getEstimatedTotalWidth(this.props, this._instanceProps); // The scrollbar size should be considered when scrolling an item into view,\n      // to ensure it's fully visible.\n      // But we only need to account for its size when it's actually visible.\n\n      var horizontalScrollbarSize = estimatedTotalWidth > width ? scrollbarSize : 0;\n      var verticalScrollbarSize = estimatedTotalHeight > height ? scrollbarSize : 0;\n      this.scrollTo({\n        scrollLeft: columnIndex !== undefined ? getOffsetForColumnAndAlignment(this.props, columnIndex, align, scrollLeft, this._instanceProps, verticalScrollbarSize) : scrollLeft,\n        scrollTop: rowIndex !== undefined ? getOffsetForRowAndAlignment(this.props, rowIndex, align, scrollTop, this._instanceProps, horizontalScrollbarSize) : scrollTop\n      });\n    };\n\n    _proto.componentDidMount = function componentDidMount() {\n      var _this$props3 = this.props,\n          initialScrollLeft = _this$props3.initialScrollLeft,\n          initialScrollTop = _this$props3.initialScrollTop;\n\n      if (this._outerRef != null) {\n        var outerRef = this._outerRef;\n\n        if (typeof initialScrollLeft === 'number') {\n          outerRef.scrollLeft = initialScrollLeft;\n        }\n\n        if (typeof initialScrollTop === 'number') {\n          outerRef.scrollTop = initialScrollTop;\n        }\n      }\n\n      this._callPropsCallbacks();\n    };\n\n    _proto.componentDidUpdate = function componentDidUpdate() {\n      var direction = this.props.direction;\n      var _this$state2 = this.state,\n          scrollLeft = _this$state2.scrollLeft,\n          scrollTop = _this$state2.scrollTop,\n          scrollUpdateWasRequested = _this$state2.scrollUpdateWasRequested;\n\n      if (scrollUpdateWasRequested && this._outerRef != null) {\n        // TRICKY According to the spec, scrollLeft should be negative for RTL aligned elements.\n        // This is not the case for all browsers though (e.g. Chrome reports values as positive, measured relative to the left).\n        // So we need to determine which browser behavior we're dealing with, and mimic it.\n        var outerRef = this._outerRef;\n\n        if (direction === 'rtl') {\n          switch (getRTLOffsetType()) {\n            case 'negative':\n              outerRef.scrollLeft = -scrollLeft;\n              break;\n\n            case 'positive-ascending':\n              outerRef.scrollLeft = scrollLeft;\n              break;\n\n            default:\n              var clientWidth = outerRef.clientWidth,\n                  scrollWidth = outerRef.scrollWidth;\n              outerRef.scrollLeft = scrollWidth - clientWidth - scrollLeft;\n              break;\n          }\n        } else {\n          outerRef.scrollLeft = Math.max(0, scrollLeft);\n        }\n\n        outerRef.scrollTop = Math.max(0, scrollTop);\n      }\n\n      this._callPropsCallbacks();\n    };\n\n    _proto.componentWillUnmount = function componentWillUnmount() {\n      if (this._resetIsScrollingTimeoutId !== null) {\n        cancelTimeout(this._resetIsScrollingTimeoutId);\n      }\n    };\n\n    _proto.render = function render() {\n      var _this$props4 = this.props,\n          children = _this$props4.children,\n          className = _this$props4.className,\n          columnCount = _this$props4.columnCount,\n          direction = _this$props4.direction,\n          height = _this$props4.height,\n          innerRef = _this$props4.innerRef,\n          innerElementType = _this$props4.innerElementType,\n          innerTagName = _this$props4.innerTagName,\n          itemData = _this$props4.itemData,\n          _this$props4$itemKey = _this$props4.itemKey,\n          itemKey = _this$props4$itemKey === void 0 ? defaultItemKey : _this$props4$itemKey,\n          outerElementType = _this$props4.outerElementType,\n          outerTagName = _this$props4.outerTagName,\n          rowCount = _this$props4.rowCount,\n          style = _this$props4.style,\n          useIsScrolling = _this$props4.useIsScrolling,\n          width = _this$props4.width;\n      var isScrolling = this.state.isScrolling;\n\n      var _this$_getHorizontalR = this._getHorizontalRangeToRender(),\n          columnStartIndex = _this$_getHorizontalR[0],\n          columnStopIndex = _this$_getHorizontalR[1];\n\n      var _this$_getVerticalRan = this._getVerticalRangeToRender(),\n          rowStartIndex = _this$_getVerticalRan[0],\n          rowStopIndex = _this$_getVerticalRan[1];\n\n      var items = [];\n\n      if (columnCount > 0 && rowCount) {\n        for (var _rowIndex = rowStartIndex; _rowIndex <= rowStopIndex; _rowIndex++) {\n          for (var _columnIndex = columnStartIndex; _columnIndex <= columnStopIndex; _columnIndex++) {\n            items.push(createElement(children, {\n              columnIndex: _columnIndex,\n              data: itemData,\n              isScrolling: useIsScrolling ? isScrolling : undefined,\n              key: itemKey({\n                columnIndex: _columnIndex,\n                data: itemData,\n                rowIndex: _rowIndex\n              }),\n              rowIndex: _rowIndex,\n              style: this._getItemStyle(_rowIndex, _columnIndex)\n            }));\n          }\n        }\n      } // Read this value AFTER items have been created,\n      // So their actual sizes (if variable) are taken into consideration.\n\n\n      var estimatedTotalHeight = getEstimatedTotalHeight(this.props, this._instanceProps);\n      var estimatedTotalWidth = getEstimatedTotalWidth(this.props, this._instanceProps);\n      return createElement(outerElementType || outerTagName || 'div', {\n        className: className,\n        onScroll: this._onScroll,\n        ref: this._outerRefSetter,\n        style: _extends({\n          position: 'relative',\n          height: height,\n          width: width,\n          overflow: 'auto',\n          WebkitOverflowScrolling: 'touch',\n          willChange: 'transform',\n          direction: direction\n        }, style)\n      }, createElement(innerElementType || innerTagName || 'div', {\n        children: items,\n        ref: innerRef,\n        style: {\n          height: estimatedTotalHeight,\n          pointerEvents: isScrolling ? 'none' : undefined,\n          width: estimatedTotalWidth\n        }\n      }));\n    };\n\n    _proto._callPropsCallbacks = function _callPropsCallbacks() {\n      var _this$props5 = this.props,\n          columnCount = _this$props5.columnCount,\n          onItemsRendered = _this$props5.onItemsRendered,\n          onScroll = _this$props5.onScroll,\n          rowCount = _this$props5.rowCount;\n\n      if (typeof onItemsRendered === 'function') {\n        if (columnCount > 0 && rowCount > 0) {\n          var _this$_getHorizontalR2 = this._getHorizontalRangeToRender(),\n              _overscanColumnStartIndex = _this$_getHorizontalR2[0],\n              _overscanColumnStopIndex = _this$_getHorizontalR2[1],\n              _visibleColumnStartIndex = _this$_getHorizontalR2[2],\n              _visibleColumnStopIndex = _this$_getHorizontalR2[3];\n\n          var _this$_getVerticalRan2 = this._getVerticalRangeToRender(),\n              _overscanRowStartIndex = _this$_getVerticalRan2[0],\n              _overscanRowStopIndex = _this$_getVerticalRan2[1],\n              _visibleRowStartIndex = _this$_getVerticalRan2[2],\n              _visibleRowStopIndex = _this$_getVerticalRan2[3];\n\n          this._callOnItemsRendered(_overscanColumnStartIndex, _overscanColumnStopIndex, _overscanRowStartIndex, _overscanRowStopIndex, _visibleColumnStartIndex, _visibleColumnStopIndex, _visibleRowStartIndex, _visibleRowStopIndex);\n        }\n      }\n\n      if (typeof onScroll === 'function') {\n        var _this$state3 = this.state,\n            _horizontalScrollDirection = _this$state3.horizontalScrollDirection,\n            _scrollLeft = _this$state3.scrollLeft,\n            _scrollTop = _this$state3.scrollTop,\n            _scrollUpdateWasRequested = _this$state3.scrollUpdateWasRequested,\n            _verticalScrollDirection = _this$state3.verticalScrollDirection;\n\n        this._callOnScroll(_scrollLeft, _scrollTop, _horizontalScrollDirection, _verticalScrollDirection, _scrollUpdateWasRequested);\n      }\n    } // Lazily create and cache item styles while scrolling,\n    // So that pure component sCU will prevent re-renders.\n    // We maintain this cache, and pass a style prop rather than index,\n    // So that List can clear cached styles and force item re-render if necessary.\n    ;\n\n    _proto._getHorizontalRangeToRender = function _getHorizontalRangeToRender() {\n      var _this$props6 = this.props,\n          columnCount = _this$props6.columnCount,\n          overscanColumnCount = _this$props6.overscanColumnCount,\n          overscanColumnsCount = _this$props6.overscanColumnsCount,\n          overscanCount = _this$props6.overscanCount,\n          rowCount = _this$props6.rowCount;\n      var _this$state4 = this.state,\n          horizontalScrollDirection = _this$state4.horizontalScrollDirection,\n          isScrolling = _this$state4.isScrolling,\n          scrollLeft = _this$state4.scrollLeft;\n      var overscanCountResolved = overscanColumnCount || overscanColumnsCount || overscanCount || 1;\n\n      if (columnCount === 0 || rowCount === 0) {\n        return [0, 0, 0, 0];\n      }\n\n      var startIndex = getColumnStartIndexForOffset(this.props, scrollLeft, this._instanceProps);\n      var stopIndex = getColumnStopIndexForStartIndex(this.props, startIndex, scrollLeft, this._instanceProps); // Overscan by one item in each direction so that tab/focus works.\n      // If there isn't at least one extra item, tab loops back around.\n\n      var overscanBackward = !isScrolling || horizontalScrollDirection === 'backward' ? Math.max(1, overscanCountResolved) : 1;\n      var overscanForward = !isScrolling || horizontalScrollDirection === 'forward' ? Math.max(1, overscanCountResolved) : 1;\n      return [Math.max(0, startIndex - overscanBackward), Math.max(0, Math.min(columnCount - 1, stopIndex + overscanForward)), startIndex, stopIndex];\n    };\n\n    _proto._getVerticalRangeToRender = function _getVerticalRangeToRender() {\n      var _this$props7 = this.props,\n          columnCount = _this$props7.columnCount,\n          overscanCount = _this$props7.overscanCount,\n          overscanRowCount = _this$props7.overscanRowCount,\n          overscanRowsCount = _this$props7.overscanRowsCount,\n          rowCount = _this$props7.rowCount;\n      var _this$state5 = this.state,\n          isScrolling = _this$state5.isScrolling,\n          verticalScrollDirection = _this$state5.verticalScrollDirection,\n          scrollTop = _this$state5.scrollTop;\n      var overscanCountResolved = overscanRowCount || overscanRowsCount || overscanCount || 1;\n\n      if (columnCount === 0 || rowCount === 0) {\n        return [0, 0, 0, 0];\n      }\n\n      var startIndex = getRowStartIndexForOffset(this.props, scrollTop, this._instanceProps);\n      var stopIndex = getRowStopIndexForStartIndex(this.props, startIndex, scrollTop, this._instanceProps); // Overscan by one item in each direction so that tab/focus works.\n      // If there isn't at least one extra item, tab loops back around.\n\n      var overscanBackward = !isScrolling || verticalScrollDirection === 'backward' ? Math.max(1, overscanCountResolved) : 1;\n      var overscanForward = !isScrolling || verticalScrollDirection === 'forward' ? Math.max(1, overscanCountResolved) : 1;\n      return [Math.max(0, startIndex - overscanBackward), Math.max(0, Math.min(rowCount - 1, stopIndex + overscanForward)), startIndex, stopIndex];\n    };\n\n    return Grid;\n  }(PureComponent), _class.defaultProps = {\n    direction: 'ltr',\n    itemData: undefined,\n    useIsScrolling: false\n  }, _class;\n}\n\nvar validateSharedProps = function validateSharedProps(_ref5, _ref6) {\n  var children = _ref5.children,\n      direction = _ref5.direction,\n      height = _ref5.height,\n      innerTagName = _ref5.innerTagName,\n      outerTagName = _ref5.outerTagName,\n      overscanColumnsCount = _ref5.overscanColumnsCount,\n      overscanCount = _ref5.overscanCount,\n      overscanRowsCount = _ref5.overscanRowsCount,\n      width = _ref5.width;\n  var instance = _ref6.instance;\n\n  if (process.env.NODE_ENV !== 'production') {\n    if (typeof overscanCount === 'number') {\n      if (devWarningsOverscanCount && !devWarningsOverscanCount.has(instance)) {\n        devWarningsOverscanCount.add(instance);\n        console.warn('The overscanCount prop has been deprecated. ' + 'Please use the overscanColumnCount and overscanRowCount props instead.');\n      }\n    }\n\n    if (typeof overscanColumnsCount === 'number' || typeof overscanRowsCount === 'number') {\n      if (devWarningsOverscanRowsColumnsCount && !devWarningsOverscanRowsColumnsCount.has(instance)) {\n        devWarningsOverscanRowsColumnsCount.add(instance);\n        console.warn('The overscanColumnsCount and overscanRowsCount props have been deprecated. ' + 'Please use the overscanColumnCount and overscanRowCount props instead.');\n      }\n    }\n\n    if (innerTagName != null || outerTagName != null) {\n      if (devWarningsTagName && !devWarningsTagName.has(instance)) {\n        devWarningsTagName.add(instance);\n        console.warn('The innerTagName and outerTagName props have been deprecated. ' + 'Please use the innerElementType and outerElementType props instead.');\n      }\n    }\n\n    if (children == null) {\n      throw Error('An invalid \"children\" prop has been specified. ' + 'Value should be a React component. ' + (\"\\\"\" + (children === null ? 'null' : typeof children) + \"\\\" was specified.\"));\n    }\n\n    switch (direction) {\n      case 'ltr':\n      case 'rtl':\n        // Valid values\n        break;\n\n      default:\n        throw Error('An invalid \"direction\" prop has been specified. ' + 'Value should be either \"ltr\" or \"rtl\". ' + (\"\\\"\" + direction + \"\\\" was specified.\"));\n    }\n\n    if (typeof width !== 'number') {\n      throw Error('An invalid \"width\" prop has been specified. ' + 'Grids must specify a number for width. ' + (\"\\\"\" + (width === null ? 'null' : typeof width) + \"\\\" was specified.\"));\n    }\n\n    if (typeof height !== 'number') {\n      throw Error('An invalid \"height\" prop has been specified. ' + 'Grids must specify a number for height. ' + (\"\\\"\" + (height === null ? 'null' : typeof height) + \"\\\" was specified.\"));\n    }\n  }\n};\n\nvar DEFAULT_ESTIMATED_ITEM_SIZE = 50;\n\nvar getEstimatedTotalHeight = function getEstimatedTotalHeight(_ref, _ref2) {\n  var rowCount = _ref.rowCount;\n  var rowMetadataMap = _ref2.rowMetadataMap,\n      estimatedRowHeight = _ref2.estimatedRowHeight,\n      lastMeasuredRowIndex = _ref2.lastMeasuredRowIndex;\n  var totalSizeOfMeasuredRows = 0; // Edge case check for when the number of items decreases while a scroll is in progress.\n  // https://github.com/bvaughn/react-window/pull/138\n\n  if (lastMeasuredRowIndex >= rowCount) {\n    lastMeasuredRowIndex = rowCount - 1;\n  }\n\n  if (lastMeasuredRowIndex >= 0) {\n    var itemMetadata = rowMetadataMap[lastMeasuredRowIndex];\n    totalSizeOfMeasuredRows = itemMetadata.offset + itemMetadata.size;\n  }\n\n  var numUnmeasuredItems = rowCount - lastMeasuredRowIndex - 1;\n  var totalSizeOfUnmeasuredItems = numUnmeasuredItems * estimatedRowHeight;\n  return totalSizeOfMeasuredRows + totalSizeOfUnmeasuredItems;\n};\n\nvar getEstimatedTotalWidth = function getEstimatedTotalWidth(_ref3, _ref4) {\n  var columnCount = _ref3.columnCount;\n  var columnMetadataMap = _ref4.columnMetadataMap,\n      estimatedColumnWidth = _ref4.estimatedColumnWidth,\n      lastMeasuredColumnIndex = _ref4.lastMeasuredColumnIndex;\n  var totalSizeOfMeasuredRows = 0; // Edge case check for when the number of items decreases while a scroll is in progress.\n  // https://github.com/bvaughn/react-window/pull/138\n\n  if (lastMeasuredColumnIndex >= columnCount) {\n    lastMeasuredColumnIndex = columnCount - 1;\n  }\n\n  if (lastMeasuredColumnIndex >= 0) {\n    var itemMetadata = columnMetadataMap[lastMeasuredColumnIndex];\n    totalSizeOfMeasuredRows = itemMetadata.offset + itemMetadata.size;\n  }\n\n  var numUnmeasuredItems = columnCount - lastMeasuredColumnIndex - 1;\n  var totalSizeOfUnmeasuredItems = numUnmeasuredItems * estimatedColumnWidth;\n  return totalSizeOfMeasuredRows + totalSizeOfUnmeasuredItems;\n};\n\nvar getItemMetadata = function getItemMetadata(itemType, props, index, instanceProps) {\n  var itemMetadataMap, itemSize, lastMeasuredIndex;\n\n  if (itemType === 'column') {\n    itemMetadataMap = instanceProps.columnMetadataMap;\n    itemSize = props.columnWidth;\n    lastMeasuredIndex = instanceProps.lastMeasuredColumnIndex;\n  } else {\n    itemMetadataMap = instanceProps.rowMetadataMap;\n    itemSize = props.rowHeight;\n    lastMeasuredIndex = instanceProps.lastMeasuredRowIndex;\n  }\n\n  if (index > lastMeasuredIndex) {\n    var offset = 0;\n\n    if (lastMeasuredIndex >= 0) {\n      var itemMetadata = itemMetadataMap[lastMeasuredIndex];\n      offset = itemMetadata.offset + itemMetadata.size;\n    }\n\n    for (var i = lastMeasuredIndex + 1; i <= index; i++) {\n      var size = itemSize(i);\n      itemMetadataMap[i] = {\n        offset: offset,\n        size: size\n      };\n      offset += size;\n    }\n\n    if (itemType === 'column') {\n      instanceProps.lastMeasuredColumnIndex = index;\n    } else {\n      instanceProps.lastMeasuredRowIndex = index;\n    }\n  }\n\n  return itemMetadataMap[index];\n};\n\nvar findNearestItem = function findNearestItem(itemType, props, instanceProps, offset) {\n  var itemMetadataMap, lastMeasuredIndex;\n\n  if (itemType === 'column') {\n    itemMetadataMap = instanceProps.columnMetadataMap;\n    lastMeasuredIndex = instanceProps.lastMeasuredColumnIndex;\n  } else {\n    itemMetadataMap = instanceProps.rowMetadataMap;\n    lastMeasuredIndex = instanceProps.lastMeasuredRowIndex;\n  }\n\n  var lastMeasuredItemOffset = lastMeasuredIndex > 0 ? itemMetadataMap[lastMeasuredIndex].offset : 0;\n\n  if (lastMeasuredItemOffset >= offset) {\n    // If we've already measured items within this range just use a binary search as it's faster.\n    return findNearestItemBinarySearch(itemType, props, instanceProps, lastMeasuredIndex, 0, offset);\n  } else {\n    // If we haven't yet measured this high, fallback to an exponential search with an inner binary search.\n    // The exponential search avoids pre-computing sizes for the full set of items as a binary search would.\n    // The overall complexity for this approach is O(log n).\n    return findNearestItemExponentialSearch(itemType, props, instanceProps, Math.max(0, lastMeasuredIndex), offset);\n  }\n};\n\nvar findNearestItemBinarySearch = function findNearestItemBinarySearch(itemType, props, instanceProps, high, low, offset) {\n  while (low <= high) {\n    var middle = low + Math.floor((high - low) / 2);\n    var currentOffset = getItemMetadata(itemType, props, middle, instanceProps).offset;\n\n    if (currentOffset === offset) {\n      return middle;\n    } else if (currentOffset < offset) {\n      low = middle + 1;\n    } else if (currentOffset > offset) {\n      high = middle - 1;\n    }\n  }\n\n  if (low > 0) {\n    return low - 1;\n  } else {\n    return 0;\n  }\n};\n\nvar findNearestItemExponentialSearch = function findNearestItemExponentialSearch(itemType, props, instanceProps, index, offset) {\n  var itemCount = itemType === 'column' ? props.columnCount : props.rowCount;\n  var interval = 1;\n\n  while (index < itemCount && getItemMetadata(itemType, props, index, instanceProps).offset < offset) {\n    index += interval;\n    interval *= 2;\n  }\n\n  return findNearestItemBinarySearch(itemType, props, instanceProps, Math.min(index, itemCount - 1), Math.floor(index / 2), offset);\n};\n\nvar getOffsetForIndexAndAlignment = function getOffsetForIndexAndAlignment(itemType, props, index, align, scrollOffset, instanceProps, scrollbarSize) {\n  var size = itemType === 'column' ? props.width : props.height;\n  var itemMetadata = getItemMetadata(itemType, props, index, instanceProps); // Get estimated total size after ItemMetadata is computed,\n  // To ensure it reflects actual measurements instead of just estimates.\n\n  var estimatedTotalSize = itemType === 'column' ? getEstimatedTotalWidth(props, instanceProps) : getEstimatedTotalHeight(props, instanceProps);\n  var maxOffset = Math.max(0, Math.min(estimatedTotalSize - size, itemMetadata.offset));\n  var minOffset = Math.max(0, itemMetadata.offset - size + scrollbarSize + itemMetadata.size);\n\n  if (align === 'smart') {\n    if (scrollOffset >= minOffset - size && scrollOffset <= maxOffset + size) {\n      align = 'auto';\n    } else {\n      align = 'center';\n    }\n  }\n\n  switch (align) {\n    case 'start':\n      return maxOffset;\n\n    case 'end':\n      return minOffset;\n\n    case 'center':\n      return Math.round(minOffset + (maxOffset - minOffset) / 2);\n\n    case 'auto':\n    default:\n      if (scrollOffset >= minOffset && scrollOffset <= maxOffset) {\n        return scrollOffset;\n      } else if (minOffset > maxOffset) {\n        // Because we only take into account the scrollbar size when calculating minOffset\n        // this value can be larger than maxOffset when at the end of the list\n        return minOffset;\n      } else if (scrollOffset < minOffset) {\n        return minOffset;\n      } else {\n        return maxOffset;\n      }\n\n  }\n};\n\nvar VariableSizeGrid = /*#__PURE__*/createGridComponent({\n  getColumnOffset: function getColumnOffset(props, index, instanceProps) {\n    return getItemMetadata('column', props, index, instanceProps).offset;\n  },\n  getColumnStartIndexForOffset: function getColumnStartIndexForOffset(props, scrollLeft, instanceProps) {\n    return findNearestItem('column', props, instanceProps, scrollLeft);\n  },\n  getColumnStopIndexForStartIndex: function getColumnStopIndexForStartIndex(props, startIndex, scrollLeft, instanceProps) {\n    var columnCount = props.columnCount,\n        width = props.width;\n    var itemMetadata = getItemMetadata('column', props, startIndex, instanceProps);\n    var maxOffset = scrollLeft + width;\n    var offset = itemMetadata.offset + itemMetadata.size;\n    var stopIndex = startIndex;\n\n    while (stopIndex < columnCount - 1 && offset < maxOffset) {\n      stopIndex++;\n      offset += getItemMetadata('column', props, stopIndex, instanceProps).size;\n    }\n\n    return stopIndex;\n  },\n  getColumnWidth: function getColumnWidth(props, index, instanceProps) {\n    return instanceProps.columnMetadataMap[index].size;\n  },\n  getEstimatedTotalHeight: getEstimatedTotalHeight,\n  getEstimatedTotalWidth: getEstimatedTotalWidth,\n  getOffsetForColumnAndAlignment: function getOffsetForColumnAndAlignment(props, index, align, scrollOffset, instanceProps, scrollbarSize) {\n    return getOffsetForIndexAndAlignment('column', props, index, align, scrollOffset, instanceProps, scrollbarSize);\n  },\n  getOffsetForRowAndAlignment: function getOffsetForRowAndAlignment(props, index, align, scrollOffset, instanceProps, scrollbarSize) {\n    return getOffsetForIndexAndAlignment('row', props, index, align, scrollOffset, instanceProps, scrollbarSize);\n  },\n  getRowOffset: function getRowOffset(props, index, instanceProps) {\n    return getItemMetadata('row', props, index, instanceProps).offset;\n  },\n  getRowHeight: function getRowHeight(props, index, instanceProps) {\n    return instanceProps.rowMetadataMap[index].size;\n  },\n  getRowStartIndexForOffset: function getRowStartIndexForOffset(props, scrollTop, instanceProps) {\n    return findNearestItem('row', props, instanceProps, scrollTop);\n  },\n  getRowStopIndexForStartIndex: function getRowStopIndexForStartIndex(props, startIndex, scrollTop, instanceProps) {\n    var rowCount = props.rowCount,\n        height = props.height;\n    var itemMetadata = getItemMetadata('row', props, startIndex, instanceProps);\n    var maxOffset = scrollTop + height;\n    var offset = itemMetadata.offset + itemMetadata.size;\n    var stopIndex = startIndex;\n\n    while (stopIndex < rowCount - 1 && offset < maxOffset) {\n      stopIndex++;\n      offset += getItemMetadata('row', props, stopIndex, instanceProps).size;\n    }\n\n    return stopIndex;\n  },\n  initInstanceProps: function initInstanceProps(props, instance) {\n    var _ref5 = props,\n        estimatedColumnWidth = _ref5.estimatedColumnWidth,\n        estimatedRowHeight = _ref5.estimatedRowHeight;\n    var instanceProps = {\n      columnMetadataMap: {},\n      estimatedColumnWidth: estimatedColumnWidth || DEFAULT_ESTIMATED_ITEM_SIZE,\n      estimatedRowHeight: estimatedRowHeight || DEFAULT_ESTIMATED_ITEM_SIZE,\n      lastMeasuredColumnIndex: -1,\n      lastMeasuredRowIndex: -1,\n      rowMetadataMap: {}\n    };\n\n    instance.resetAfterColumnIndex = function (columnIndex, shouldForceUpdate) {\n      if (shouldForceUpdate === void 0) {\n        shouldForceUpdate = true;\n      }\n\n      instance.resetAfterIndices({\n        columnIndex: columnIndex,\n        shouldForceUpdate: shouldForceUpdate\n      });\n    };\n\n    instance.resetAfterRowIndex = function (rowIndex, shouldForceUpdate) {\n      if (shouldForceUpdate === void 0) {\n        shouldForceUpdate = true;\n      }\n\n      instance.resetAfterIndices({\n        rowIndex: rowIndex,\n        shouldForceUpdate: shouldForceUpdate\n      });\n    };\n\n    instance.resetAfterIndices = function (_ref6) {\n      var columnIndex = _ref6.columnIndex,\n          rowIndex = _ref6.rowIndex,\n          _ref6$shouldForceUpda = _ref6.shouldForceUpdate,\n          shouldForceUpdate = _ref6$shouldForceUpda === void 0 ? true : _ref6$shouldForceUpda;\n\n      if (typeof columnIndex === 'number') {\n        instanceProps.lastMeasuredColumnIndex = Math.min(instanceProps.lastMeasuredColumnIndex, columnIndex - 1);\n      }\n\n      if (typeof rowIndex === 'number') {\n        instanceProps.lastMeasuredRowIndex = Math.min(instanceProps.lastMeasuredRowIndex, rowIndex - 1);\n      } // We could potentially optimize further by only evicting styles after this index,\n      // But since styles are only cached while scrolling is in progress-\n      // It seems an unnecessary optimization.\n      // It's unlikely that resetAfterIndex() will be called while a user is scrolling.\n\n\n      instance._getItemStyleCache(-1);\n\n      if (shouldForceUpdate) {\n        instance.forceUpdate();\n      }\n    };\n\n    return instanceProps;\n  },\n  shouldResetStyleCacheOnItemSizeChange: false,\n  validateProps: function validateProps(_ref7) {\n    var columnWidth = _ref7.columnWidth,\n        rowHeight = _ref7.rowHeight;\n\n    if (process.env.NODE_ENV !== 'production') {\n      if (typeof columnWidth !== 'function') {\n        throw Error('An invalid \"columnWidth\" prop has been specified. ' + 'Value should be a function. ' + (\"\\\"\" + (columnWidth === null ? 'null' : typeof columnWidth) + \"\\\" was specified.\"));\n      } else if (typeof rowHeight !== 'function') {\n        throw Error('An invalid \"rowHeight\" prop has been specified. ' + 'Value should be a function. ' + (\"\\\"\" + (rowHeight === null ? 'null' : typeof rowHeight) + \"\\\" was specified.\"));\n      }\n    }\n  }\n});\n\nvar IS_SCROLLING_DEBOUNCE_INTERVAL$1 = 150;\n\nvar defaultItemKey$1 = function defaultItemKey(index, data) {\n  return index;\n}; // In DEV mode, this Set helps us only log a warning once per component instance.\n// This avoids spamming the console every time a render happens.\n\n\nvar devWarningsDirection = null;\nvar devWarningsTagName$1 = null;\n\nif (process.env.NODE_ENV !== 'production') {\n  if (typeof window !== 'undefined' && typeof window.WeakSet !== 'undefined') {\n    devWarningsDirection = /*#__PURE__*/new WeakSet();\n    devWarningsTagName$1 = /*#__PURE__*/new WeakSet();\n  }\n}\n\nfunction createListComponent(_ref) {\n  var _class;\n\n  var getItemOffset = _ref.getItemOffset,\n      getEstimatedTotalSize = _ref.getEstimatedTotalSize,\n      getItemSize = _ref.getItemSize,\n      getOffsetForIndexAndAlignment = _ref.getOffsetForIndexAndAlignment,\n      getStartIndexForOffset = _ref.getStartIndexForOffset,\n      getStopIndexForStartIndex = _ref.getStopIndexForStartIndex,\n      initInstanceProps = _ref.initInstanceProps,\n      shouldResetStyleCacheOnItemSizeChange = _ref.shouldResetStyleCacheOnItemSizeChange,\n      validateProps = _ref.validateProps;\n  return _class = /*#__PURE__*/function (_PureComponent) {\n    _inheritsLoose(List, _PureComponent);\n\n    // Always use explicit constructor for React components.\n    // It produces less code after transpilation. (#26)\n    // eslint-disable-next-line no-useless-constructor\n    function List(props) {\n      var _this;\n\n      _this = _PureComponent.call(this, props) || this;\n      _this._instanceProps = initInstanceProps(_this.props, _assertThisInitialized(_this));\n      _this._outerRef = void 0;\n      _this._resetIsScrollingTimeoutId = null;\n      _this.state = {\n        instance: _assertThisInitialized(_this),\n        isScrolling: false,\n        scrollDirection: 'forward',\n        scrollOffset: typeof _this.props.initialScrollOffset === 'number' ? _this.props.initialScrollOffset : 0,\n        scrollUpdateWasRequested: false\n      };\n      _this._callOnItemsRendered = void 0;\n      _this._callOnItemsRendered = memoizeOne(function (overscanStartIndex, overscanStopIndex, visibleStartIndex, visibleStopIndex) {\n        return _this.props.onItemsRendered({\n          overscanStartIndex: overscanStartIndex,\n          overscanStopIndex: overscanStopIndex,\n          visibleStartIndex: visibleStartIndex,\n          visibleStopIndex: visibleStopIndex\n        });\n      });\n      _this._callOnScroll = void 0;\n      _this._callOnScroll = memoizeOne(function (scrollDirection, scrollOffset, scrollUpdateWasRequested) {\n        return _this.props.onScroll({\n          scrollDirection: scrollDirection,\n          scrollOffset: scrollOffset,\n          scrollUpdateWasRequested: scrollUpdateWasRequested\n        });\n      });\n      _this._getItemStyle = void 0;\n\n      _this._getItemStyle = function (index) {\n        var _this$props = _this.props,\n            direction = _this$props.direction,\n            itemSize = _this$props.itemSize,\n            layout = _this$props.layout;\n\n        var itemStyleCache = _this._getItemStyleCache(shouldResetStyleCacheOnItemSizeChange && itemSize, shouldResetStyleCacheOnItemSizeChange && layout, shouldResetStyleCacheOnItemSizeChange && direction);\n\n        var style;\n\n        if (itemStyleCache.hasOwnProperty(index)) {\n          style = itemStyleCache[index];\n        } else {\n          var _offset = getItemOffset(_this.props, index, _this._instanceProps);\n\n          var size = getItemSize(_this.props, index, _this._instanceProps); // TODO Deprecate direction \"horizontal\"\n\n          var isHorizontal = direction === 'horizontal' || layout === 'horizontal';\n          var isRtl = direction === 'rtl';\n          var offsetHorizontal = isHorizontal ? _offset : 0;\n          itemStyleCache[index] = style = {\n            position: 'absolute',\n            left: isRtl ? undefined : offsetHorizontal,\n            right: isRtl ? offsetHorizontal : undefined,\n            top: !isHorizontal ? _offset : 0,\n            height: !isHorizontal ? size : '100%',\n            width: isHorizontal ? size : '100%'\n          };\n        }\n\n        return style;\n      };\n\n      _this._getItemStyleCache = void 0;\n      _this._getItemStyleCache = memoizeOne(function (_, __, ___) {\n        return {};\n      });\n\n      _this._onScrollHorizontal = function (event) {\n        var _event$currentTarget = event.currentTarget,\n            clientWidth = _event$currentTarget.clientWidth,\n            scrollLeft = _event$currentTarget.scrollLeft,\n            scrollWidth = _event$currentTarget.scrollWidth;\n\n        _this.setState(function (prevState) {\n          if (prevState.scrollOffset === scrollLeft) {\n            // Scroll position may have been updated by cDM/cDU,\n            // In which case we don't need to trigger another render,\n            // And we don't want to update state.isScrolling.\n            return null;\n          }\n\n          var direction = _this.props.direction;\n          var scrollOffset = scrollLeft;\n\n          if (direction === 'rtl') {\n            // TRICKY According to the spec, scrollLeft should be negative for RTL aligned elements.\n            // This is not the case for all browsers though (e.g. Chrome reports values as positive, measured relative to the left).\n            // It's also easier for this component if we convert offsets to the same format as they would be in for ltr.\n            // So the simplest solution is to determine which browser behavior we're dealing with, and convert based on it.\n            switch (getRTLOffsetType()) {\n              case 'negative':\n                scrollOffset = -scrollLeft;\n                break;\n\n              case 'positive-descending':\n                scrollOffset = scrollWidth - clientWidth - scrollLeft;\n                break;\n            }\n          } // Prevent Safari's elastic scrolling from causing visual shaking when scrolling past bounds.\n\n\n          scrollOffset = Math.max(0, Math.min(scrollOffset, scrollWidth - clientWidth));\n          return {\n            isScrolling: true,\n            scrollDirection: prevState.scrollOffset < scrollOffset ? 'forward' : 'backward',\n            scrollOffset: scrollOffset,\n            scrollUpdateWasRequested: false\n          };\n        }, _this._resetIsScrollingDebounced);\n      };\n\n      _this._onScrollVertical = function (event) {\n        var _event$currentTarget2 = event.currentTarget,\n            clientHeight = _event$currentTarget2.clientHeight,\n            scrollHeight = _event$currentTarget2.scrollHeight,\n            scrollTop = _event$currentTarget2.scrollTop;\n\n        _this.setState(function (prevState) {\n          if (prevState.scrollOffset === scrollTop) {\n            // Scroll position may have been updated by cDM/cDU,\n            // In which case we don't need to trigger another render,\n            // And we don't want to update state.isScrolling.\n            return null;\n          } // Prevent Safari's elastic scrolling from causing visual shaking when scrolling past bounds.\n\n\n          var scrollOffset = Math.max(0, Math.min(scrollTop, scrollHeight - clientHeight));\n          return {\n            isScrolling: true,\n            scrollDirection: prevState.scrollOffset < scrollOffset ? 'forward' : 'backward',\n            scrollOffset: scrollOffset,\n            scrollUpdateWasRequested: false\n          };\n        }, _this._resetIsScrollingDebounced);\n      };\n\n      _this._outerRefSetter = function (ref) {\n        var outerRef = _this.props.outerRef;\n        _this._outerRef = ref;\n\n        if (typeof outerRef === 'function') {\n          outerRef(ref);\n        } else if (outerRef != null && typeof outerRef === 'object' && outerRef.hasOwnProperty('current')) {\n          outerRef.current = ref;\n        }\n      };\n\n      _this._resetIsScrollingDebounced = function () {\n        if (_this._resetIsScrollingTimeoutId !== null) {\n          cancelTimeout(_this._resetIsScrollingTimeoutId);\n        }\n\n        _this._resetIsScrollingTimeoutId = requestTimeout(_this._resetIsScrolling, IS_SCROLLING_DEBOUNCE_INTERVAL$1);\n      };\n\n      _this._resetIsScrolling = function () {\n        _this._resetIsScrollingTimeoutId = null;\n\n        _this.setState({\n          isScrolling: false\n        }, function () {\n          // Clear style cache after state update has been committed.\n          // This way we don't break pure sCU for items that don't use isScrolling param.\n          _this._getItemStyleCache(-1, null);\n        });\n      };\n\n      return _this;\n    }\n\n    List.getDerivedStateFromProps = function getDerivedStateFromProps(nextProps, prevState) {\n      validateSharedProps$1(nextProps, prevState);\n      validateProps(nextProps);\n      return null;\n    };\n\n    var _proto = List.prototype;\n\n    _proto.scrollTo = function scrollTo(scrollOffset) {\n      scrollOffset = Math.max(0, scrollOffset);\n      this.setState(function (prevState) {\n        if (prevState.scrollOffset === scrollOffset) {\n          return null;\n        }\n\n        return {\n          scrollDirection: prevState.scrollOffset < scrollOffset ? 'forward' : 'backward',\n          scrollOffset: scrollOffset,\n          scrollUpdateWasRequested: true\n        };\n      }, this._resetIsScrollingDebounced);\n    };\n\n    _proto.scrollToItem = function scrollToItem(index, align) {\n      if (align === void 0) {\n        align = 'auto';\n      }\n\n      var _this$props2 = this.props,\n          itemCount = _this$props2.itemCount,\n          layout = _this$props2.layout;\n      var scrollOffset = this.state.scrollOffset;\n      index = Math.max(0, Math.min(index, itemCount - 1)); // The scrollbar size should be considered when scrolling an item into view, to ensure it's fully visible.\n      // But we only need to account for its size when it's actually visible.\n      // This is an edge case for lists; normally they only scroll in the dominant direction.\n\n      var scrollbarSize = 0;\n\n      if (this._outerRef) {\n        var outerRef = this._outerRef;\n\n        if (layout === 'vertical') {\n          scrollbarSize = outerRef.scrollWidth > outerRef.clientWidth ? getScrollbarSize() : 0;\n        } else {\n          scrollbarSize = outerRef.scrollHeight > outerRef.clientHeight ? getScrollbarSize() : 0;\n        }\n      }\n\n      this.scrollTo(getOffsetForIndexAndAlignment(this.props, index, align, scrollOffset, this._instanceProps, scrollbarSize));\n    };\n\n    _proto.componentDidMount = function componentDidMount() {\n      var _this$props3 = this.props,\n          direction = _this$props3.direction,\n          initialScrollOffset = _this$props3.initialScrollOffset,\n          layout = _this$props3.layout;\n\n      if (typeof initialScrollOffset === 'number' && this._outerRef != null) {\n        var outerRef = this._outerRef; // TODO Deprecate direction \"horizontal\"\n\n        if (direction === 'horizontal' || layout === 'horizontal') {\n          outerRef.scrollLeft = initialScrollOffset;\n        } else {\n          outerRef.scrollTop = initialScrollOffset;\n        }\n      }\n\n      this._callPropsCallbacks();\n    };\n\n    _proto.componentDidUpdate = function componentDidUpdate() {\n      var _this$props4 = this.props,\n          direction = _this$props4.direction,\n          layout = _this$props4.layout;\n      var _this$state = this.state,\n          scrollOffset = _this$state.scrollOffset,\n          scrollUpdateWasRequested = _this$state.scrollUpdateWasRequested;\n\n      if (scrollUpdateWasRequested && this._outerRef != null) {\n        var outerRef = this._outerRef; // TODO Deprecate direction \"horizontal\"\n\n        if (direction === 'horizontal' || layout === 'horizontal') {\n          if (direction === 'rtl') {\n            // TRICKY According to the spec, scrollLeft should be negative for RTL aligned elements.\n            // This is not the case for all browsers though (e.g. Chrome reports values as positive, measured relative to the left).\n            // So we need to determine which browser behavior we're dealing with, and mimic it.\n            switch (getRTLOffsetType()) {\n              case 'negative':\n                outerRef.scrollLeft = -scrollOffset;\n                break;\n\n              case 'positive-ascending':\n                outerRef.scrollLeft = scrollOffset;\n                break;\n\n              default:\n                var clientWidth = outerRef.clientWidth,\n                    scrollWidth = outerRef.scrollWidth;\n                outerRef.scrollLeft = scrollWidth - clientWidth - scrollOffset;\n                break;\n            }\n          } else {\n            outerRef.scrollLeft = scrollOffset;\n          }\n        } else {\n          outerRef.scrollTop = scrollOffset;\n        }\n      }\n\n      this._callPropsCallbacks();\n    };\n\n    _proto.componentWillUnmount = function componentWillUnmount() {\n      if (this._resetIsScrollingTimeoutId !== null) {\n        cancelTimeout(this._resetIsScrollingTimeoutId);\n      }\n    };\n\n    _proto.render = function render() {\n      var _this$props5 = this.props,\n          children = _this$props5.children,\n          className = _this$props5.className,\n          direction = _this$props5.direction,\n          height = _this$props5.height,\n          innerRef = _this$props5.innerRef,\n          innerElementType = _this$props5.innerElementType,\n          innerTagName = _this$props5.innerTagName,\n          itemCount = _this$props5.itemCount,\n          itemData = _this$props5.itemData,\n          _this$props5$itemKey = _this$props5.itemKey,\n          itemKey = _this$props5$itemKey === void 0 ? defaultItemKey$1 : _this$props5$itemKey,\n          layout = _this$props5.layout,\n          outerElementType = _this$props5.outerElementType,\n          outerTagName = _this$props5.outerTagName,\n          style = _this$props5.style,\n          useIsScrolling = _this$props5.useIsScrolling,\n          width = _this$props5.width;\n      var isScrolling = this.state.isScrolling; // TODO Deprecate direction \"horizontal\"\n\n      var isHorizontal = direction === 'horizontal' || layout === 'horizontal';\n      var onScroll = isHorizontal ? this._onScrollHorizontal : this._onScrollVertical;\n\n      var _this$_getRangeToRend = this._getRangeToRender(),\n          startIndex = _this$_getRangeToRend[0],\n          stopIndex = _this$_getRangeToRend[1];\n\n      var items = [];\n\n      if (itemCount > 0) {\n        for (var _index = startIndex; _index <= stopIndex; _index++) {\n          items.push(createElement(children, {\n            data: itemData,\n            key: itemKey(_index, itemData),\n            index: _index,\n            isScrolling: useIsScrolling ? isScrolling : undefined,\n            style: this._getItemStyle(_index)\n          }));\n        }\n      } // Read this value AFTER items have been created,\n      // So their actual sizes (if variable) are taken into consideration.\n\n\n      var estimatedTotalSize = getEstimatedTotalSize(this.props, this._instanceProps);\n      return createElement(outerElementType || outerTagName || 'div', {\n        className: className,\n        onScroll: onScroll,\n        ref: this._outerRefSetter,\n        style: _extends({\n          position: 'relative',\n          height: height,\n          width: width,\n          overflow: 'auto',\n          WebkitOverflowScrolling: 'touch',\n          willChange: 'transform',\n          direction: direction\n        }, style)\n      }, createElement(innerElementType || innerTagName || 'div', {\n        children: items,\n        ref: innerRef,\n        style: {\n          height: isHorizontal ? '100%' : estimatedTotalSize,\n          pointerEvents: isScrolling ? 'none' : undefined,\n          width: isHorizontal ? estimatedTotalSize : '100%'\n        }\n      }));\n    };\n\n    _proto._callPropsCallbacks = function _callPropsCallbacks() {\n      if (typeof this.props.onItemsRendered === 'function') {\n        var itemCount = this.props.itemCount;\n\n        if (itemCount > 0) {\n          var _this$_getRangeToRend2 = this._getRangeToRender(),\n              _overscanStartIndex = _this$_getRangeToRend2[0],\n              _overscanStopIndex = _this$_getRangeToRend2[1],\n              _visibleStartIndex = _this$_getRangeToRend2[2],\n              _visibleStopIndex = _this$_getRangeToRend2[3];\n\n          this._callOnItemsRendered(_overscanStartIndex, _overscanStopIndex, _visibleStartIndex, _visibleStopIndex);\n        }\n      }\n\n      if (typeof this.props.onScroll === 'function') {\n        var _this$state2 = this.state,\n            _scrollDirection = _this$state2.scrollDirection,\n            _scrollOffset = _this$state2.scrollOffset,\n            _scrollUpdateWasRequested = _this$state2.scrollUpdateWasRequested;\n\n        this._callOnScroll(_scrollDirection, _scrollOffset, _scrollUpdateWasRequested);\n      }\n    } // Lazily create and cache item styles while scrolling,\n    // So that pure component sCU will prevent re-renders.\n    // We maintain this cache, and pass a style prop rather than index,\n    // So that List can clear cached styles and force item re-render if necessary.\n    ;\n\n    _proto._getRangeToRender = function _getRangeToRender() {\n      var _this$props6 = this.props,\n          itemCount = _this$props6.itemCount,\n          overscanCount = _this$props6.overscanCount;\n      var _this$state3 = this.state,\n          isScrolling = _this$state3.isScrolling,\n          scrollDirection = _this$state3.scrollDirection,\n          scrollOffset = _this$state3.scrollOffset;\n\n      if (itemCount === 0) {\n        return [0, 0, 0, 0];\n      }\n\n      var startIndex = getStartIndexForOffset(this.props, scrollOffset, this._instanceProps);\n      var stopIndex = getStopIndexForStartIndex(this.props, startIndex, scrollOffset, this._instanceProps); // Overscan by one item in each direction so that tab/focus works.\n      // If there isn't at least one extra item, tab loops back around.\n\n      var overscanBackward = !isScrolling || scrollDirection === 'backward' ? Math.max(1, overscanCount) : 1;\n      var overscanForward = !isScrolling || scrollDirection === 'forward' ? Math.max(1, overscanCount) : 1;\n      return [Math.max(0, startIndex - overscanBackward), Math.max(0, Math.min(itemCount - 1, stopIndex + overscanForward)), startIndex, stopIndex];\n    };\n\n    return List;\n  }(PureComponent), _class.defaultProps = {\n    direction: 'ltr',\n    itemData: undefined,\n    layout: 'vertical',\n    overscanCount: 2,\n    useIsScrolling: false\n  }, _class;\n} // NOTE: I considered further wrapping individual items with a pure ListItem component.\n// This would avoid ever calling the render function for the same index more than once,\n// But it would also add the overhead of a lot of components/fibers.\n// I assume people already do this (render function returning a class component),\n// So my doing it would just unnecessarily double the wrappers.\n\nvar validateSharedProps$1 = function validateSharedProps(_ref2, _ref3) {\n  var children = _ref2.children,\n      direction = _ref2.direction,\n      height = _ref2.height,\n      layout = _ref2.layout,\n      innerTagName = _ref2.innerTagName,\n      outerTagName = _ref2.outerTagName,\n      width = _ref2.width;\n  var instance = _ref3.instance;\n\n  if (process.env.NODE_ENV !== 'production') {\n    if (innerTagName != null || outerTagName != null) {\n      if (devWarningsTagName$1 && !devWarningsTagName$1.has(instance)) {\n        devWarningsTagName$1.add(instance);\n        console.warn('The innerTagName and outerTagName props have been deprecated. ' + 'Please use the innerElementType and outerElementType props instead.');\n      }\n    } // TODO Deprecate direction \"horizontal\"\n\n\n    var isHorizontal = direction === 'horizontal' || layout === 'horizontal';\n\n    switch (direction) {\n      case 'horizontal':\n      case 'vertical':\n        if (devWarningsDirection && !devWarningsDirection.has(instance)) {\n          devWarningsDirection.add(instance);\n          console.warn('The direction prop should be either \"ltr\" (default) or \"rtl\". ' + 'Please use the layout prop to specify \"vertical\" (default) or \"horizontal\" orientation.');\n        }\n\n        break;\n\n      case 'ltr':\n      case 'rtl':\n        // Valid values\n        break;\n\n      default:\n        throw Error('An invalid \"direction\" prop has been specified. ' + 'Value should be either \"ltr\" or \"rtl\". ' + (\"\\\"\" + direction + \"\\\" was specified.\"));\n    }\n\n    switch (layout) {\n      case 'horizontal':\n      case 'vertical':\n        // Valid values\n        break;\n\n      default:\n        throw Error('An invalid \"layout\" prop has been specified. ' + 'Value should be either \"horizontal\" or \"vertical\". ' + (\"\\\"\" + layout + \"\\\" was specified.\"));\n    }\n\n    if (children == null) {\n      throw Error('An invalid \"children\" prop has been specified. ' + 'Value should be a React component. ' + (\"\\\"\" + (children === null ? 'null' : typeof children) + \"\\\" was specified.\"));\n    }\n\n    if (isHorizontal && typeof width !== 'number') {\n      throw Error('An invalid \"width\" prop has been specified. ' + 'Horizontal lists must specify a number for width. ' + (\"\\\"\" + (width === null ? 'null' : typeof width) + \"\\\" was specified.\"));\n    } else if (!isHorizontal && typeof height !== 'number') {\n      throw Error('An invalid \"height\" prop has been specified. ' + 'Vertical lists must specify a number for height. ' + (\"\\\"\" + (height === null ? 'null' : typeof height) + \"\\\" was specified.\"));\n    }\n  }\n};\n\nvar DEFAULT_ESTIMATED_ITEM_SIZE$1 = 50;\n\nvar getItemMetadata$1 = function getItemMetadata(props, index, instanceProps) {\n  var _ref = props,\n      itemSize = _ref.itemSize;\n  var itemMetadataMap = instanceProps.itemMetadataMap,\n      lastMeasuredIndex = instanceProps.lastMeasuredIndex;\n\n  if (index > lastMeasuredIndex) {\n    var offset = 0;\n\n    if (lastMeasuredIndex >= 0) {\n      var itemMetadata = itemMetadataMap[lastMeasuredIndex];\n      offset = itemMetadata.offset + itemMetadata.size;\n    }\n\n    for (var i = lastMeasuredIndex + 1; i <= index; i++) {\n      var size = itemSize(i);\n      itemMetadataMap[i] = {\n        offset: offset,\n        size: size\n      };\n      offset += size;\n    }\n\n    instanceProps.lastMeasuredIndex = index;\n  }\n\n  return itemMetadataMap[index];\n};\n\nvar findNearestItem$1 = function findNearestItem(props, instanceProps, offset) {\n  var itemMetadataMap = instanceProps.itemMetadataMap,\n      lastMeasuredIndex = instanceProps.lastMeasuredIndex;\n  var lastMeasuredItemOffset = lastMeasuredIndex > 0 ? itemMetadataMap[lastMeasuredIndex].offset : 0;\n\n  if (lastMeasuredItemOffset >= offset) {\n    // If we've already measured items within this range just use a binary search as it's faster.\n    return findNearestItemBinarySearch$1(props, instanceProps, lastMeasuredIndex, 0, offset);\n  } else {\n    // If we haven't yet measured this high, fallback to an exponential search with an inner binary search.\n    // The exponential search avoids pre-computing sizes for the full set of items as a binary search would.\n    // The overall complexity for this approach is O(log n).\n    return findNearestItemExponentialSearch$1(props, instanceProps, Math.max(0, lastMeasuredIndex), offset);\n  }\n};\n\nvar findNearestItemBinarySearch$1 = function findNearestItemBinarySearch(props, instanceProps, high, low, offset) {\n  while (low <= high) {\n    var middle = low + Math.floor((high - low) / 2);\n    var currentOffset = getItemMetadata$1(props, middle, instanceProps).offset;\n\n    if (currentOffset === offset) {\n      return middle;\n    } else if (currentOffset < offset) {\n      low = middle + 1;\n    } else if (currentOffset > offset) {\n      high = middle - 1;\n    }\n  }\n\n  if (low > 0) {\n    return low - 1;\n  } else {\n    return 0;\n  }\n};\n\nvar findNearestItemExponentialSearch$1 = function findNearestItemExponentialSearch(props, instanceProps, index, offset) {\n  var itemCount = props.itemCount;\n  var interval = 1;\n\n  while (index < itemCount && getItemMetadata$1(props, index, instanceProps).offset < offset) {\n    index += interval;\n    interval *= 2;\n  }\n\n  return findNearestItemBinarySearch$1(props, instanceProps, Math.min(index, itemCount - 1), Math.floor(index / 2), offset);\n};\n\nvar getEstimatedTotalSize = function getEstimatedTotalSize(_ref2, _ref3) {\n  var itemCount = _ref2.itemCount;\n  var itemMetadataMap = _ref3.itemMetadataMap,\n      estimatedItemSize = _ref3.estimatedItemSize,\n      lastMeasuredIndex = _ref3.lastMeasuredIndex;\n  var totalSizeOfMeasuredItems = 0; // Edge case check for when the number of items decreases while a scroll is in progress.\n  // https://github.com/bvaughn/react-window/pull/138\n\n  if (lastMeasuredIndex >= itemCount) {\n    lastMeasuredIndex = itemCount - 1;\n  }\n\n  if (lastMeasuredIndex >= 0) {\n    var itemMetadata = itemMetadataMap[lastMeasuredIndex];\n    totalSizeOfMeasuredItems = itemMetadata.offset + itemMetadata.size;\n  }\n\n  var numUnmeasuredItems = itemCount - lastMeasuredIndex - 1;\n  var totalSizeOfUnmeasuredItems = numUnmeasuredItems * estimatedItemSize;\n  return totalSizeOfMeasuredItems + totalSizeOfUnmeasuredItems;\n};\n\nvar VariableSizeList = /*#__PURE__*/createListComponent({\n  getItemOffset: function getItemOffset(props, index, instanceProps) {\n    return getItemMetadata$1(props, index, instanceProps).offset;\n  },\n  getItemSize: function getItemSize(props, index, instanceProps) {\n    return instanceProps.itemMetadataMap[index].size;\n  },\n  getEstimatedTotalSize: getEstimatedTotalSize,\n  getOffsetForIndexAndAlignment: function getOffsetForIndexAndAlignment(props, index, align, scrollOffset, instanceProps, scrollbarSize) {\n    var direction = props.direction,\n        height = props.height,\n        layout = props.layout,\n        width = props.width; // TODO Deprecate direction \"horizontal\"\n\n    var isHorizontal = direction === 'horizontal' || layout === 'horizontal';\n    var size = isHorizontal ? width : height;\n    var itemMetadata = getItemMetadata$1(props, index, instanceProps); // Get estimated total size after ItemMetadata is computed,\n    // To ensure it reflects actual measurements instead of just estimates.\n\n    var estimatedTotalSize = getEstimatedTotalSize(props, instanceProps);\n    var maxOffset = Math.max(0, Math.min(estimatedTotalSize - size, itemMetadata.offset));\n    var minOffset = Math.max(0, itemMetadata.offset - size + itemMetadata.size + scrollbarSize);\n\n    if (align === 'smart') {\n      if (scrollOffset >= minOffset - size && scrollOffset <= maxOffset + size) {\n        align = 'auto';\n      } else {\n        align = 'center';\n      }\n    }\n\n    switch (align) {\n      case 'start':\n        return maxOffset;\n\n      case 'end':\n        return minOffset;\n\n      case 'center':\n        return Math.round(minOffset + (maxOffset - minOffset) / 2);\n\n      case 'auto':\n      default:\n        if (scrollOffset >= minOffset && scrollOffset <= maxOffset) {\n          return scrollOffset;\n        } else if (scrollOffset < minOffset) {\n          return minOffset;\n        } else {\n          return maxOffset;\n        }\n\n    }\n  },\n  getStartIndexForOffset: function getStartIndexForOffset(props, offset, instanceProps) {\n    return findNearestItem$1(props, instanceProps, offset);\n  },\n  getStopIndexForStartIndex: function getStopIndexForStartIndex(props, startIndex, scrollOffset, instanceProps) {\n    var direction = props.direction,\n        height = props.height,\n        itemCount = props.itemCount,\n        layout = props.layout,\n        width = props.width; // TODO Deprecate direction \"horizontal\"\n\n    var isHorizontal = direction === 'horizontal' || layout === 'horizontal';\n    var size = isHorizontal ? width : height;\n    var itemMetadata = getItemMetadata$1(props, startIndex, instanceProps);\n    var maxOffset = scrollOffset + size;\n    var offset = itemMetadata.offset + itemMetadata.size;\n    var stopIndex = startIndex;\n\n    while (stopIndex < itemCount - 1 && offset < maxOffset) {\n      stopIndex++;\n      offset += getItemMetadata$1(props, stopIndex, instanceProps).size;\n    }\n\n    return stopIndex;\n  },\n  initInstanceProps: function initInstanceProps(props, instance) {\n    var _ref4 = props,\n        estimatedItemSize = _ref4.estimatedItemSize;\n    var instanceProps = {\n      itemMetadataMap: {},\n      estimatedItemSize: estimatedItemSize || DEFAULT_ESTIMATED_ITEM_SIZE$1,\n      lastMeasuredIndex: -1\n    };\n\n    instance.resetAfterIndex = function (index, shouldForceUpdate) {\n      if (shouldForceUpdate === void 0) {\n        shouldForceUpdate = true;\n      }\n\n      instanceProps.lastMeasuredIndex = Math.min(instanceProps.lastMeasuredIndex, index - 1); // We could potentially optimize further by only evicting styles after this index,\n      // But since styles are only cached while scrolling is in progress-\n      // It seems an unnecessary optimization.\n      // It's unlikely that resetAfterIndex() will be called while a user is scrolling.\n\n      instance._getItemStyleCache(-1);\n\n      if (shouldForceUpdate) {\n        instance.forceUpdate();\n      }\n    };\n\n    return instanceProps;\n  },\n  shouldResetStyleCacheOnItemSizeChange: false,\n  validateProps: function validateProps(_ref5) {\n    var itemSize = _ref5.itemSize;\n\n    if (process.env.NODE_ENV !== 'production') {\n      if (typeof itemSize !== 'function') {\n        throw Error('An invalid \"itemSize\" prop has been specified. ' + 'Value should be a function. ' + (\"\\\"\" + (itemSize === null ? 'null' : typeof itemSize) + \"\\\" was specified.\"));\n      }\n    }\n  }\n});\n\nvar FixedSizeGrid = /*#__PURE__*/createGridComponent({\n  getColumnOffset: function getColumnOffset(_ref, index) {\n    var columnWidth = _ref.columnWidth;\n    return index * columnWidth;\n  },\n  getColumnWidth: function getColumnWidth(_ref2, index) {\n    var columnWidth = _ref2.columnWidth;\n    return columnWidth;\n  },\n  getRowOffset: function getRowOffset(_ref3, index) {\n    var rowHeight = _ref3.rowHeight;\n    return index * rowHeight;\n  },\n  getRowHeight: function getRowHeight(_ref4, index) {\n    var rowHeight = _ref4.rowHeight;\n    return rowHeight;\n  },\n  getEstimatedTotalHeight: function getEstimatedTotalHeight(_ref5) {\n    var rowCount = _ref5.rowCount,\n        rowHeight = _ref5.rowHeight;\n    return rowHeight * rowCount;\n  },\n  getEstimatedTotalWidth: function getEstimatedTotalWidth(_ref6) {\n    var columnCount = _ref6.columnCount,\n        columnWidth = _ref6.columnWidth;\n    return columnWidth * columnCount;\n  },\n  getOffsetForColumnAndAlignment: function getOffsetForColumnAndAlignment(_ref7, columnIndex, align, scrollLeft, instanceProps, scrollbarSize) {\n    var columnCount = _ref7.columnCount,\n        columnWidth = _ref7.columnWidth,\n        width = _ref7.width;\n    var lastColumnOffset = Math.max(0, columnCount * columnWidth - width);\n    var maxOffset = Math.min(lastColumnOffset, columnIndex * columnWidth);\n    var minOffset = Math.max(0, columnIndex * columnWidth - width + scrollbarSize + columnWidth);\n\n    if (align === 'smart') {\n      if (scrollLeft >= minOffset - width && scrollLeft <= maxOffset + width) {\n        align = 'auto';\n      } else {\n        align = 'center';\n      }\n    }\n\n    switch (align) {\n      case 'start':\n        return maxOffset;\n\n      case 'end':\n        return minOffset;\n\n      case 'center':\n        // \"Centered\" offset is usually the average of the min and max.\n        // But near the edges of the list, this doesn't hold true.\n        var middleOffset = Math.round(minOffset + (maxOffset - minOffset) / 2);\n\n        if (middleOffset < Math.ceil(width / 2)) {\n          return 0; // near the beginning\n        } else if (middleOffset > lastColumnOffset + Math.floor(width / 2)) {\n          return lastColumnOffset; // near the end\n        } else {\n          return middleOffset;\n        }\n\n      case 'auto':\n      default:\n        if (scrollLeft >= minOffset && scrollLeft <= maxOffset) {\n          return scrollLeft;\n        } else if (minOffset > maxOffset) {\n          // Because we only take into account the scrollbar size when calculating minOffset\n          // this value can be larger than maxOffset when at the end of the list\n          return minOffset;\n        } else if (scrollLeft < minOffset) {\n          return minOffset;\n        } else {\n          return maxOffset;\n        }\n\n    }\n  },\n  getOffsetForRowAndAlignment: function getOffsetForRowAndAlignment(_ref8, rowIndex, align, scrollTop, instanceProps, scrollbarSize) {\n    var rowHeight = _ref8.rowHeight,\n        height = _ref8.height,\n        rowCount = _ref8.rowCount;\n    var lastRowOffset = Math.max(0, rowCount * rowHeight - height);\n    var maxOffset = Math.min(lastRowOffset, rowIndex * rowHeight);\n    var minOffset = Math.max(0, rowIndex * rowHeight - height + scrollbarSize + rowHeight);\n\n    if (align === 'smart') {\n      if (scrollTop >= minOffset - height && scrollTop <= maxOffset + height) {\n        align = 'auto';\n      } else {\n        align = 'center';\n      }\n    }\n\n    switch (align) {\n      case 'start':\n        return maxOffset;\n\n      case 'end':\n        return minOffset;\n\n      case 'center':\n        // \"Centered\" offset is usually the average of the min and max.\n        // But near the edges of the list, this doesn't hold true.\n        var middleOffset = Math.round(minOffset + (maxOffset - minOffset) / 2);\n\n        if (middleOffset < Math.ceil(height / 2)) {\n          return 0; // near the beginning\n        } else if (middleOffset > lastRowOffset + Math.floor(height / 2)) {\n          return lastRowOffset; // near the end\n        } else {\n          return middleOffset;\n        }\n\n      case 'auto':\n      default:\n        if (scrollTop >= minOffset && scrollTop <= maxOffset) {\n          return scrollTop;\n        } else if (minOffset > maxOffset) {\n          // Because we only take into account the scrollbar size when calculating minOffset\n          // this value can be larger than maxOffset when at the end of the list\n          return minOffset;\n        } else if (scrollTop < minOffset) {\n          return minOffset;\n        } else {\n          return maxOffset;\n        }\n\n    }\n  },\n  getColumnStartIndexForOffset: function getColumnStartIndexForOffset(_ref9, scrollLeft) {\n    var columnWidth = _ref9.columnWidth,\n        columnCount = _ref9.columnCount;\n    return Math.max(0, Math.min(columnCount - 1, Math.floor(scrollLeft / columnWidth)));\n  },\n  getColumnStopIndexForStartIndex: function getColumnStopIndexForStartIndex(_ref10, startIndex, scrollLeft) {\n    var columnWidth = _ref10.columnWidth,\n        columnCount = _ref10.columnCount,\n        width = _ref10.width;\n    var left = startIndex * columnWidth;\n    var numVisibleColumns = Math.ceil((width + scrollLeft - left) / columnWidth);\n    return Math.max(0, Math.min(columnCount - 1, startIndex + numVisibleColumns - 1 // -1 is because stop index is inclusive\n    ));\n  },\n  getRowStartIndexForOffset: function getRowStartIndexForOffset(_ref11, scrollTop) {\n    var rowHeight = _ref11.rowHeight,\n        rowCount = _ref11.rowCount;\n    return Math.max(0, Math.min(rowCount - 1, Math.floor(scrollTop / rowHeight)));\n  },\n  getRowStopIndexForStartIndex: function getRowStopIndexForStartIndex(_ref12, startIndex, scrollTop) {\n    var rowHeight = _ref12.rowHeight,\n        rowCount = _ref12.rowCount,\n        height = _ref12.height;\n    var top = startIndex * rowHeight;\n    var numVisibleRows = Math.ceil((height + scrollTop - top) / rowHeight);\n    return Math.max(0, Math.min(rowCount - 1, startIndex + numVisibleRows - 1 // -1 is because stop index is inclusive\n    ));\n  },\n  initInstanceProps: function initInstanceProps(props) {// Noop\n  },\n  shouldResetStyleCacheOnItemSizeChange: true,\n  validateProps: function validateProps(_ref13) {\n    var columnWidth = _ref13.columnWidth,\n        rowHeight = _ref13.rowHeight;\n\n    if (process.env.NODE_ENV !== 'production') {\n      if (typeof columnWidth !== 'number') {\n        throw Error('An invalid \"columnWidth\" prop has been specified. ' + 'Value should be a number. ' + (\"\\\"\" + (columnWidth === null ? 'null' : typeof columnWidth) + \"\\\" was specified.\"));\n      }\n\n      if (typeof rowHeight !== 'number') {\n        throw Error('An invalid \"rowHeight\" prop has been specified. ' + 'Value should be a number. ' + (\"\\\"\" + (rowHeight === null ? 'null' : typeof rowHeight) + \"\\\" was specified.\"));\n      }\n    }\n  }\n});\n\nvar FixedSizeList = /*#__PURE__*/createListComponent({\n  getItemOffset: function getItemOffset(_ref, index) {\n    var itemSize = _ref.itemSize;\n    return index * itemSize;\n  },\n  getItemSize: function getItemSize(_ref2, index) {\n    var itemSize = _ref2.itemSize;\n    return itemSize;\n  },\n  getEstimatedTotalSize: function getEstimatedTotalSize(_ref3) {\n    var itemCount = _ref3.itemCount,\n        itemSize = _ref3.itemSize;\n    return itemSize * itemCount;\n  },\n  getOffsetForIndexAndAlignment: function getOffsetForIndexAndAlignment(_ref4, index, align, scrollOffset, instanceProps, scrollbarSize) {\n    var direction = _ref4.direction,\n        height = _ref4.height,\n        itemCount = _ref4.itemCount,\n        itemSize = _ref4.itemSize,\n        layout = _ref4.layout,\n        width = _ref4.width;\n    // TODO Deprecate direction \"horizontal\"\n    var isHorizontal = direction === 'horizontal' || layout === 'horizontal';\n    var size = isHorizontal ? width : height;\n    var lastItemOffset = Math.max(0, itemCount * itemSize - size);\n    var maxOffset = Math.min(lastItemOffset, index * itemSize);\n    var minOffset = Math.max(0, index * itemSize - size + itemSize + scrollbarSize);\n\n    if (align === 'smart') {\n      if (scrollOffset >= minOffset - size && scrollOffset <= maxOffset + size) {\n        align = 'auto';\n      } else {\n        align = 'center';\n      }\n    }\n\n    switch (align) {\n      case 'start':\n        return maxOffset;\n\n      case 'end':\n        return minOffset;\n\n      case 'center':\n        {\n          // \"Centered\" offset is usually the average of the min and max.\n          // But near the edges of the list, this doesn't hold true.\n          var middleOffset = Math.round(minOffset + (maxOffset - minOffset) / 2);\n\n          if (middleOffset < Math.ceil(size / 2)) {\n            return 0; // near the beginning\n          } else if (middleOffset > lastItemOffset + Math.floor(size / 2)) {\n            return lastItemOffset; // near the end\n          } else {\n            return middleOffset;\n          }\n        }\n\n      case 'auto':\n      default:\n        if (scrollOffset >= minOffset && scrollOffset <= maxOffset) {\n          return scrollOffset;\n        } else if (scrollOffset < minOffset) {\n          return minOffset;\n        } else {\n          return maxOffset;\n        }\n\n    }\n  },\n  getStartIndexForOffset: function getStartIndexForOffset(_ref5, offset) {\n    var itemCount = _ref5.itemCount,\n        itemSize = _ref5.itemSize;\n    return Math.max(0, Math.min(itemCount - 1, Math.floor(offset / itemSize)));\n  },\n  getStopIndexForStartIndex: function getStopIndexForStartIndex(_ref6, startIndex, scrollOffset) {\n    var direction = _ref6.direction,\n        height = _ref6.height,\n        itemCount = _ref6.itemCount,\n        itemSize = _ref6.itemSize,\n        layout = _ref6.layout,\n        width = _ref6.width;\n    // TODO Deprecate direction \"horizontal\"\n    var isHorizontal = direction === 'horizontal' || layout === 'horizontal';\n    var offset = startIndex * itemSize;\n    var size = isHorizontal ? width : height;\n    var numVisibleItems = Math.ceil((size + scrollOffset - offset) / itemSize);\n    return Math.max(0, Math.min(itemCount - 1, startIndex + numVisibleItems - 1 // -1 is because stop index is inclusive\n    ));\n  },\n  initInstanceProps: function initInstanceProps(props) {// Noop\n  },\n  shouldResetStyleCacheOnItemSizeChange: true,\n  validateProps: function validateProps(_ref7) {\n    var itemSize = _ref7.itemSize;\n\n    if (process.env.NODE_ENV !== 'production') {\n      if (typeof itemSize !== 'number') {\n        throw Error('An invalid \"itemSize\" prop has been specified. ' + 'Value should be a number. ' + (\"\\\"\" + (itemSize === null ? 'null' : typeof itemSize) + \"\\\" was specified.\"));\n      }\n    }\n  }\n});\n\n// Pulled from react-compat\n// https://github.com/developit/preact-compat/blob/7c5de00e7c85e2ffd011bf3af02899b63f699d3a/src/index.js#L349\nfunction shallowDiffers(prev, next) {\n  for (var attribute in prev) {\n    if (!(attribute in next)) {\n      return true;\n    }\n  }\n\n  for (var _attribute in next) {\n    if (prev[_attribute] !== next[_attribute]) {\n      return true;\n    }\n  }\n\n  return false;\n}\n\nvar _excluded = [\"style\"],\n    _excluded2 = [\"style\"];\n// It knows to compare individual style props and ignore the wrapper object.\n// See https://reactjs.org/docs/react-api.html#reactmemo\n\nfunction areEqual(prevProps, nextProps) {\n  var prevStyle = prevProps.style,\n      prevRest = _objectWithoutPropertiesLoose(prevProps, _excluded);\n\n  var nextStyle = nextProps.style,\n      nextRest = _objectWithoutPropertiesLoose(nextProps, _excluded2);\n\n  return !shallowDiffers(prevStyle, nextStyle) && !shallowDiffers(prevRest, nextRest);\n}\n\n// It knows to compare individual style props and ignore the wrapper object.\n// See https://reactjs.org/docs/react-component.html#shouldcomponentupdate\n\nfunction shouldComponentUpdate(nextProps, nextState) {\n  return !areEqual(this.props, nextProps) || shallowDiffers(this.state, nextState);\n}\n\nexport { FixedSizeGrid, FixedSizeList, VariableSizeGrid, VariableSizeList, areEqual, shouldComponentUpdate };\n//# sourceMappingURL=index.esm.js.map\n","import setPrototypeOf from \"./setPrototypeOf.js\";\nfunction _inheritsLoose(t, o) {\n  t.prototype = Object.create(o.prototype), t.prototype.constructor = t, setPrototypeOf(t, o);\n}\nexport { _inheritsLoose as default };","import { useContext } from 'react';\nimport { createContext } from 'react';\nimport type { PAFVState, AxisMapping, Plane, LATCHAxis } from '../types/pafv';\n\n// Re-export the context interface for use in tests\nexport interface PAFVContextValue {\n  state: PAFVState;\n  setMapping: (mapping: AxisMapping) => void;\n  removeMapping: (plane: Plane) => void;\n  setViewMode: (mode: 'grid' | 'list') => void;\n  resetToDefaults: () => void;\n  getAxisForPlane: (plane: Plane) => LATCHAxis | null;\n  getPlaneForAxis: (axis: LATCHAxis) => Plane | null;\n}\n\n// Export context for direct access if needed\nexport const PAFVContext = createContext<PAFVContextValue | null>(null);\n\n/**\n * Hook to access PAFV state and actions\n * Must be used within a PAFVProvider\n *\n * @throws Error if used outside PAFVProvider\n * @returns PAFVContextValue with state and actions\n */\nexport function usePAFV(): PAFVContextValue {\n  const context = useContext(PAFVContext);\n\n  if (!context) {\n    throw new Error('usePAFV must be used within PAFVProvider');\n  }\n\n  return context;\n}\n","import React, { createContext, useContext, useEffect, useState, useCallback } from 'react';\nimport { NativeAPIClient, nativeAPI } from './NativeAPIClient';\n\n/**\n * Native Database Context interface matching existing DatabaseContext exactly\n * Provides identical interface for seamless component compatibility\n */\nexport interface NativeDatabaseContextValue {\n  db: NativeAPIClient | null;\n  loading: boolean;\n  error: Error | null;\n  execute: <T = Record<string, unknown>>(sql: string, params?: unknown[]) => Promise<T[]>;\n  save: () => Promise<void>;\n  reset: () => Promise<void>;\n}\n\nconst NativeDatabaseContext = createContext<NativeDatabaseContextValue | null>(null);\n\nexport interface NativeDatabaseProviderProps {\n  children: React.ReactNode;\n  baseURL?: string;\n  timeout?: number;\n  retryAttempts?: number;\n  retryDelay?: number;\n}\n\n/**\n * Native Database Provider using HTTP API instead of sql.js\n * Maintains identical interface and state management patterns as DatabaseProvider\n */\nexport function NativeDatabaseProvider({\n  children,\n  baseURL = 'http://localhost:8080',\n  timeout = 5000,\n  retryAttempts = 3,\n  retryDelay = 1000,\n}: NativeDatabaseProviderProps) {\n  const [db, setDb] = useState<NativeAPIClient | null>(null);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<Error | null>(null);\n\n  // Initialize client with retry logic\n  useEffect(() => {\n    let isCancelled = false;\n\n    const initializeClient = async (attempt: number = 1) => {\n      if (isCancelled) return;\n\n      setLoading(true);\n      setError(null);\n\n      try {\n        console.log(`Connecting to native API server at ${baseURL} (attempt ${attempt}/${retryAttempts})`);\n        // Use existing nativeAPI instance instead of creating new client\n        const isAvailable = await nativeAPI.checkAvailability();\n        if (!isAvailable) {\n          throw new Error('Native API not available');\n        }\n        const client = nativeAPI;\n\n        if (!isCancelled) {\n          setDb(client);\n          console.log('Native API client connected successfully');\n        }\n      } catch (err) {\n        console.error(`Native API connection attempt ${attempt} failed:`, err);\n\n        if (!isCancelled) {\n          if (attempt < retryAttempts) {\n            // Retry after delay\n            setTimeout(() => {\n              if (!isCancelled) {\n                initializeClient(attempt + 1);\n              }\n            }, retryDelay * attempt); // Exponential backoff\n            return; // Don't set loading to false yet\n          } else {\n            // All retry attempts failed\n            setError(err as Error);\n          }\n        }\n      } finally {\n        if (!isCancelled) {\n          setLoading(false);\n        }\n      }\n    };\n\n    initializeClient();\n\n    return () => {\n      isCancelled = true;\n    };\n  }, [baseURL, timeout, retryAttempts, retryDelay]);\n\n  /**\n   * Execute SQL query - identical interface to sql.js DatabaseContext\n   */\n  const execute = useCallback(async <T = Record<string, unknown>>(\n    sql: string,\n    params?: unknown[]\n  ): Promise<T[]> => {\n    if (!db) {\n      throw new Error('Native database client not initialized');\n    }\n\n    try {\n      return await db.execute<T>(sql, params);\n    } catch (err) {\n      console.error('Native database execution error:', sql, params, err);\n\n      // Check if error indicates disconnection\n      const errorMessage = (err as Error).message.toLowerCase();\n      if (errorMessage.includes('network') || errorMessage.includes('fetch') || errorMessage.includes('not connected')) {\n        setError(err as Error);\n      }\n\n      throw err;\n    }\n  }, [db]);\n\n  /**\n   * Save operation - no-op for compatibility (native handles persistence)\n   */\n  const save = useCallback(async () => {\n    if (!db) {\n      throw new Error('Native database client not initialized');\n    }\n\n    await db.save();\n  }, [db]);\n\n  /**\n   * Reset database - calls native reset endpoint and reinitializes client\n   */\n  const reset = useCallback(async () => {\n    if (!db) {\n      throw new Error('Native database client not initialized');\n    }\n\n    setLoading(true);\n    setError(null);\n\n    try {\n      await db.reset();\n      // Client should still be connected after reset, no need to recreate\n      console.log('Native database reset successfully');\n    } catch (err) {\n      console.error('Native database reset error:', err);\n      setError(err as Error);\n\n      // Try to reconnect after failed reset\n      try {\n        const isAvailable = await nativeAPI.checkAvailability();\n        if (isAvailable) {\n          setDb(nativeAPI);\n        } else {\n          throw new Error('Native API not available after reset');\n        }\n        console.log('Reconnected to native API after reset failure');\n      } catch (reconnectErr) {\n        console.error('Failed to reconnect after reset failure:', reconnectErr);\n        setError(reconnectErr as Error);\n      }\n    } finally {\n      setLoading(false);\n    }\n  }, [db, baseURL, timeout]);\n\n  return (\n    <NativeDatabaseContext.Provider value={{ db, loading, error, execute, save, reset }}>\n      {children}\n    </NativeDatabaseContext.Provider>\n  );\n}\n\n/**\n * Hook to access native database context\n * Identical interface to useDatabase() for drop-in replacement\n */\nexport function useNativeDatabase(): NativeDatabaseContextValue {\n  const context = useContext(NativeDatabaseContext);\n  if (!context) {\n    throw new Error('useNativeDatabase must be used within NativeDatabaseProvider');\n  }\n  return context;\n}\n\n/**\n * Hook that provides the same interface as useDatabase() from DatabaseContext\n * Allows components to use either sql.js or native database transparently\n */\nexport function useDatabaseCompat(): {\n  db: NativeAPIClient | null;\n  loading: boolean;\n  error: Error | null;\n  execute: <T = Record<string, unknown>>(sql: string, params?: unknown[]) => T[] | Promise<T[]>;\n  save: () => Promise<void>;\n  reset: () => Promise<void>;\n} {\n  const { db, loading, error, execute, save, reset } = useNativeDatabase();\n\n  // Wrapper to maintain interface compatibility - some components might expect sync execute\n  const executeCompat = useCallback(<T = Record<string, unknown>>(\n    sql: string,\n    params?: unknown[]\n  ): Promise<T[]> => {\n    return execute<T>(sql, params);\n  }, [execute]);\n\n  return {\n    db,\n    loading,\n    error,\n    execute: executeCompat,\n    save,\n    reset,\n  };\n}\n\n/**\n * Utility component to display connection status for debugging\n */\nexport function NativeDatabaseStatus() {\n  const { db, loading, error } = useNativeDatabase();\n\n  if (loading) {\n    return <div className=\"text-sm text-gray-500\">Connecting to native API...</div>;\n  }\n\n  if (error) {\n    return (\n      <div className=\"text-sm text-red-500\">\n        Native API Error: {error.message}\n      </div>\n    );\n  }\n\n  if (db?.isConnected()) {\n    return <div className=\"text-sm text-green-500\">Native API Connected</div>;\n  }\n\n  return <div className=\"text-sm text-yellow-500\">Native API Status Unknown</div>;\n}","import validate from './validate.js';\nconst byteToHex = [];\nfor (let i = 0; i < 256; ++i) {\n    byteToHex.push((i + 0x100).toString(16).slice(1));\n}\nexport function unsafeStringify(arr, offset = 0) {\n    return (byteToHex[arr[offset + 0]] +\n        byteToHex[arr[offset + 1]] +\n        byteToHex[arr[offset + 2]] +\n        byteToHex[arr[offset + 3]] +\n        '-' +\n        byteToHex[arr[offset + 4]] +\n        byteToHex[arr[offset + 5]] +\n        '-' +\n        byteToHex[arr[offset + 6]] +\n        byteToHex[arr[offset + 7]] +\n        '-' +\n        byteToHex[arr[offset + 8]] +\n        byteToHex[arr[offset + 9]] +\n        '-' +\n        byteToHex[arr[offset + 10]] +\n        byteToHex[arr[offset + 11]] +\n        byteToHex[arr[offset + 12]] +\n        byteToHex[arr[offset + 13]] +\n        byteToHex[arr[offset + 14]] +\n        byteToHex[arr[offset + 15]]).toLowerCase();\n}\nfunction stringify(arr, offset = 0) {\n    const uuid = unsafeStringify(arr, offset);\n    if (!validate(uuid)) {\n        throw TypeError('Stringified UUID is invalid');\n    }\n    return uuid;\n}\nexport default stringify;\n","let getRandomValues;\nconst rnds8 = new Uint8Array(16);\nexport default function rng() {\n    if (!getRandomValues) {\n        if (typeof crypto === 'undefined' || !crypto.getRandomValues) {\n            throw new Error('crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported');\n        }\n        getRandomValues = crypto.getRandomValues.bind(crypto);\n    }\n    return getRandomValues(rnds8);\n}\n","const randomUUID = typeof crypto !== 'undefined' && crypto.randomUUID && crypto.randomUUID.bind(crypto);\nexport default { randomUUID };\n","import native from './native.js';\nimport rng from './rng.js';\nimport { unsafeStringify } from './stringify.js';\nfunction v4(options, buf, offset) {\n    if (native.randomUUID && !buf && !options) {\n        return native.randomUUID();\n    }\n    options = options || {};\n    const rnds = options.random || (options.rng || rng)();\n    rnds[6] = (rnds[6] & 0x0f) | 0x40;\n    rnds[8] = (rnds[8] & 0x3f) | 0x80;\n    if (buf) {\n        offset = offset || 0;\n        for (let i = 0; i < 16; ++i) {\n            buf[offset + i] = rnds[i];\n        }\n        return buf;\n    }\n    return unsafeStringify(rnds);\n}\nexport default v4;\n","/**\n * Structured Logging System\n * Replaces console.log/warn/error with production-ready logging\n * Features: log levels, environment detection, structured output\n */\n\nexport enum LogLevel {\n  ERROR = 0,\n  WARN = 1,\n  INFO = 2,\n  DEBUG = 3,\n  TRACE = 4\n}\n\nexport interface LogEntry {\n  timestamp: string;\n  level: LogLevel;\n  category: string;\n  message: string;\n  context?: Record<string, unknown>;\n  error?: Error;\n}\n\nexport interface LoggerConfig {\n  level: LogLevel;\n  enableConsole: boolean;\n  enablePersistence: boolean;\n  maxEntries: number;\n  categories: string[];\n}\n\nclass Logger {\n  private config: LoggerConfig;\n  private entries: LogEntry[] = [];\n\n  constructor(config: Partial<LoggerConfig> = {}) {\n    this.config = {\n      level: this.getDefaultLevel(),\n      enableConsole: true,\n      enablePersistence: false,\n      maxEntries: 1000,\n      categories: [],\n      ...config\n    };\n  }\n\n  private getDefaultLevel(): LogLevel {\n    if (typeof process !== 'undefined' && process.env.NODE_ENV === 'production') {\n      return LogLevel.WARN;\n    }\n    if (typeof process !== 'undefined' && process.env.NODE_ENV === 'test') {\n      return LogLevel.ERROR;\n    }\n    return LogLevel.DEBUG;\n  }\n\n  private shouldLog(level: LogLevel, category: string): boolean {\n    if (level > this.config.level) return false;\n    if (this.config.categories.length > 0 && !this.config.categories.includes(category)) {\n      return false;\n    }\n    return true;\n  }\n\n  private createEntry(level: LogLevel, category: string, message: string, context?: Record<string, unknown>, error?: Error): LogEntry {\n    return {\n      timestamp: new Date().toISOString(),\n      level,\n      category,\n      message,\n      context,\n      error\n    };\n  }\n\n  private logEntry(entry: LogEntry): void {\n    // Store in memory\n    if (this.config.enablePersistence) {\n      this.entries.unshift(entry);\n      if (this.entries.length > this.config.maxEntries) {\n        this.entries = this.entries.slice(0, this.config.maxEntries);\n      }\n    }\n\n    // Output to console if enabled\n    if (this.config.enableConsole) {\n      const prefix = `[${entry.category}]`;\n      const message = entry.context\n        ? `${entry.message} ${JSON.stringify(entry.context)}`\n        : entry.message;\n\n      switch (entry.level) {\n        case LogLevel.ERROR:\n          console.error(prefix, message, entry.error);\n          break;\n        case LogLevel.WARN:\n          console.warn(prefix, message);\n          break;\n        case LogLevel.INFO:\n          console.info(prefix, message);\n          break;\n        case LogLevel.DEBUG:\n        case LogLevel.TRACE:\n          console.log(prefix, message);\n          break;\n      }\n    }\n  }\n\n  // Public API\n  error(category: string, message: string, context?: Record<string, unknown>, error?: Error): void {\n    if (!this.shouldLog(LogLevel.ERROR, category)) return;\n    this.logEntry(this.createEntry(LogLevel.ERROR, category, message, context, error));\n  }\n\n  warn(category: string, message: string, context?: Record<string, unknown>): void {\n    if (!this.shouldLog(LogLevel.WARN, category)) return;\n    this.logEntry(this.createEntry(LogLevel.WARN, category, message, context));\n  }\n\n  info(category: string, message: string, context?: Record<string, unknown>): void {\n    if (!this.shouldLog(LogLevel.INFO, category)) return;\n    this.logEntry(this.createEntry(LogLevel.INFO, category, message, context));\n  }\n\n  debug(category: string, message: string, context?: Record<string, unknown>): void {\n    if (!this.shouldLog(LogLevel.DEBUG, category)) return;\n    this.logEntry(this.createEntry(LogLevel.DEBUG, category, message, context));\n  }\n\n  trace(category: string, message: string, context?: Record<string, unknown>): void {\n    if (!this.shouldLog(LogLevel.TRACE, category)) return;\n    this.logEntry(this.createEntry(LogLevel.TRACE, category, message, context));\n  }\n\n  // Configuration\n  setLevel(level: LogLevel): void {\n    this.config.level = level;\n  }\n\n  setCategories(categories: string[]): void {\n    this.config.categories = categories;\n  }\n\n  enableConsole(enabled: boolean): void {\n    this.config.enableConsole = enabled;\n  }\n\n  // Utility methods\n  getEntries(count?: number): LogEntry[] {\n    return count ? this.entries.slice(0, count) : [...this.entries];\n  }\n\n  clearEntries(): void {\n    this.entries = [];\n  }\n\n  getConfig(): LoggerConfig {\n    return { ...this.config };\n  }\n}\n\n// Create default logger instance\nexport const logger = new Logger();\n\n// Convenience functions for common categories\nexport const dbLogger = {\n  error: (msg: string, ctx?: Record<string, unknown>, err?: Error) => logger.error('database', msg, ctx, err),\n  warn: (msg: string, ctx?: Record<string, unknown>) => logger.warn('database', msg, ctx),\n  info: (msg: string, ctx?: Record<string, unknown>) => logger.info('database', msg, ctx),\n  debug: (msg: string, ctx?: Record<string, unknown>) => logger.debug('database', msg, ctx)\n};\n\nexport const bridgeLogger = {\n  error: (msg: string, ctx?: Record<string, unknown>, err?: Error) => logger.error('bridge', msg, ctx, err),\n  warn: (msg: string, ctx?: Record<string, unknown>) => logger.warn('bridge', msg, ctx),\n  info: (msg: string, ctx?: Record<string, unknown>) => logger.info('bridge', msg, ctx),\n  debug: (msg: string, ctx?: Record<string, unknown>) => logger.debug('bridge', msg, ctx)\n};\n\nexport const performanceLogger = {\n  error: (msg: string, ctx?: Record<string, unknown>, err?: Error) => logger.error('performance', msg, ctx, err),\n  warn: (msg: string, ctx?: Record<string, unknown>) => logger.warn('performance', msg, ctx),\n  info: (msg: string, ctx?: Record<string, unknown>) => logger.info('performance', msg, ctx),\n  debug: (msg: string, ctx?: Record<string, unknown>) => logger.debug('performance', msg, ctx)\n};\n\nexport const uiLogger = {\n  error: (msg: string, ctx?: Record<string, unknown>, err?: Error) => logger.error('ui', msg, ctx, err),\n  warn: (msg: string, ctx?: Record<string, unknown>) => logger.warn('ui', msg, ctx),\n  info: (msg: string, ctx?: Record<string, unknown>) => logger.info('ui', msg, ctx),\n  debug: (msg: string, ctx?: Record<string, unknown>) => logger.debug('ui', msg, ctx)\n};","/**\n * WebView Bridge Communication Layer\n *\n * Provides secure React-to-native communication through WebKit MessageHandler bridge.\n * Handles request/response correlation, environment detection, and promise-based async operations.\n * Replaces HTTP transport with direct native messaging for better security and performance.\n */\n\nimport { v4 as uuidv4 } from 'uuid';\nimport type { Node } from '../types/node';\nimport { bridgeLogger } from './logger';\n\nexport interface WebKitMessageHandlers {\n  database: {\n    postMessage(message: WebViewMessage): void;\n  };\n  filesystem: {\n    postMessage(message: WebViewMessage): void;\n  };\n}\n\nexport interface WebViewEnvironment {\n  isNative: boolean;\n  platform: 'iOS' | 'macOS' | 'browser';\n  version: string;\n  transport: 'webview-bridge' | 'http-api';\n}\n\nexport interface WebViewMessage {\n  id: string;\n  handler: 'database' | 'filesystem';\n  method: string;\n  params: Record<string, unknown>;\n  timestamp: number;\n}\n\nexport interface WebViewResponse {\n  id: string;\n  result?: unknown;\n  error?: string;\n  success: boolean;\n  timestamp?: number;\n}\n\n// Type alias for backward compatibility\nexport type BridgeResponse = WebViewResponse;\n\ndeclare global {\n  interface Window {\n    webkit?: {\n      messageHandlers: WebKitMessageHandlers;\n    };\n    _isometryBridge?: {\n      database: Record<string, unknown>;\n      filesystem: Record<string, unknown>;\n      environment: WebViewEnvironment;\n      sendMessage: (handler: string, _method: string, params: unknown) => Promise<unknown>;\n      handleResponse: (response: BridgeResponse) => void;\n      debug?: {\n        logMessages?: boolean;\n        showPerformance?: boolean;\n      };\n    };\n    resolveWebViewRequest?: (id: string, _result: unknown, error?: string) => void;\n    isometryDatabase?: Record<string, unknown>;\n    isometryFilesystem?: Record<string, unknown>;\n  }\n}\n\n/**\n * WebView Bridge Client\n *\n * Provides unified interface for React components to communicate with native app\n */\nexport class WebViewBridge {\n  private pendingRequests = new Map<string, {\n    resolve: (value: unknown) => void;\n    reject: (error: Error) => void;\n    timeout: NodeJS.Timeout;\n    timestamp: number;\n    retryCount: number;\n  }>();\n\n  private messageQueue: WebViewMessage[] = [];\n\n  private isConnected = false;\n  private connectionCheckInterval: NodeJS.Timeout | null = null;\n  private cleanupInterval: NodeJS.Timeout | null = null;\n  private failureCount = 0;\n  private lastConnectionTest = 0;\n  private circuitBreakerOpen = false;\n\n  private readonly DEFAULT_TIMEOUT = 10000; // 10 seconds\n  private readonly MAX_RETRIES = 3;\n  private readonly RETRY_DELAY = 1000; // 1 second\n  private readonly CONNECTION_CHECK_INTERVAL = 30000; // 30 seconds\n  private readonly CIRCUIT_BREAKER_THRESHOLD = 5; // failures before opening circuit\n  private readonly CIRCUIT_BREAKER_RESET_TIME = 60000; // 1 minute\n  private readonly MESSAGE_QUEUE_MAX_SIZE = 100;\n\n  constructor() {\n    // Set up global response handler for native to call back\n    if (typeof window !== 'undefined') {\n      window.resolveWebViewRequest = this.handleResponse.bind(this);\n    }\n\n    // Set up bridge response handler if not already set\n    if (this.isWebViewEnvironment() && window._isometryBridge) {\n      const originalHandler = window._isometryBridge.handleResponse;\n      window._isometryBridge.handleResponse = (response: WebViewResponse) => {\n        this.handleResponseInternal(response);\n        if (originalHandler) {\n          originalHandler(response);\n        }\n      };\n    }\n\n    // Set up cleanup interval for timed out requests\n    this.cleanupInterval = setInterval(() => this.cleanupTimedOutRequests(), 30000);\n\n    // Initialize connection monitoring\n    this.startConnectionMonitoring();\n\n    // Test initial connection\n    this.testConnection().then((connected) => {\n      this.isConnected = connected;\n      if (connected) {\n        this.processMessageQueue();\n      }\n    });\n\n    if (process.env.NODE_ENV === 'development') {\n      bridgeLogger.debug('Bridge initialized', { webViewAvailable: this.isWebViewEnvironment() });\n    }\n  }\n\n  /**\n   * Generate unique request ID for correlation\n   */\n  generateRequestId(): string {\n    return uuidv4();\n  }\n\n  /**\n   * Register callback for request correlation\n   */\n  registerCallback<T = unknown>(\n    id: string,\n    resolve: (value: T) => void,\n    reject: (error: Error) => void,\n    timeout: number = this.DEFAULT_TIMEOUT\n  ): void {\n    const timeoutHandle = setTimeout(() => {\n      this.pendingRequests.delete(id);\n      reject(new Error(`WebView request timeout after ${timeout}ms: ${id}`));\n    }, timeout);\n\n    this.pendingRequests.set(id, {\n      resolve: resolve as (value: unknown) => void,\n      reject,\n      timeout: timeoutHandle,\n      timestamp: Date.now(),\n      retryCount: 0\n    });\n\n    bridgeLogger.debug('Request callback registered', { requestId: id });\n  }\n\n  /**\n   * Post message to native handler with circuit breaker and queue management\n   */\n  public async postMessage<T = unknown>(\n    handler: 'database' | 'filesystem',\n    method: string,\n    params: Record<string, unknown> = {},\n    retries: number = 0\n  ): Promise<T> {\n    if (!this.isWebViewEnvironment()) {\n      throw new Error('WebView bridge not available');\n    }\n\n    // Check circuit breaker\n    if (this.circuitBreakerOpen) {\n      if (Date.now() - this.lastConnectionTest > this.CIRCUIT_BREAKER_RESET_TIME) {\n        // Reset circuit breaker after timeout\n        this.circuitBreakerOpen = false;\n        this.failureCount = 0;\n        bridgeLogger.info('Circuit breaker reset, attempting reconnection');\n      } else {\n        throw new Error('WebView bridge circuit breaker is open - service temporarily unavailable');\n      }\n    }\n\n    const requestId = this.generateRequestId();\n    const message: WebViewMessage = {\n      id: requestId,\n      handler,\n      method,\n      params,\n      timestamp: Date.now()\n    };\n\n    return new Promise<T>((resolve, reject) => {\n      try {\n        // Register callback before sending\n        this.registerCallback<T>(requestId, resolve, reject);\n\n        // If not connected, queue the message\n        if (!this.isConnected) {\n          this.queueMessage(message);\n          bridgeLogger.debug('Message queued due to disconnected bridge', { requestId });\n          return;\n        }\n\n        // Send message immediately if connected\n        this.sendMessageImmediate(message, retries);\n\n      } catch (error) {\n        this.pendingRequests.delete(requestId);\n        this.handleSendFailure<T>(error, handler, method, params, retries, resolve, reject);\n      }\n    });\n  }\n\n  /**\n   * Handle response from native side\n   */\n  handleResponse(id: string, result: unknown, error?: string): void {\n    const response: WebViewResponse = {\n      id,\n      result,\n      error,\n      success: !error,\n      timestamp: Date.now()\n    };\n\n    this.handleResponseInternal(response);\n  }\n\n  /**\n   * Handle response from native bridge (internal)\n   */\n  private handleResponseInternal(response: WebViewResponse): void {\n    const pending = this.pendingRequests.get(response.id);\n    if (!pending) {\n      if (process.env.NODE_ENV === 'development') {\n        bridgeLogger.warn('Received response for unknown request', { responseId: response.id });\n      }\n      return;\n    }\n\n    clearTimeout(pending.timeout);\n    this.pendingRequests.delete(response.id);\n\n    if (response.success) {\n      // Success - reset failure count and ensure we're marked connected\n      this.failureCount = 0;\n      this.isConnected = true;\n      pending.resolve(response.result);\n    } else {\n      this.handleResponseError(response, pending);\n    }\n\n    // Performance logging\n    if (process.env.NODE_ENV === 'development' && response.timestamp) {\n      const duration = Date.now() - pending.timestamp;\n      console.log(`[WebView Bridge Performance] ${response.id}: ${duration}ms`);\n    }\n  }\n\n  /**\n   * Check if error is retriable\n   */\n  private isRetriableError(error: unknown): boolean {\n    if (!error || typeof error !== 'object') return false;\n\n    const errorObj = error as Record<string, unknown>;\n    const message = typeof errorObj.message === 'string' ?\n      errorObj.message.toLowerCase() :\n      '';\n    return message.includes('timeout') ||\n           message.includes('network') ||\n           message.includes('connection');\n  }\n\n  /**\n   * Cleanup timed out requests\n   */\n  private cleanupTimedOutRequests(): void {\n    const now = Date.now();\n    const timeout = this.DEFAULT_TIMEOUT * 2; // Double timeout for cleanup\n\n    this.pendingRequests.forEach((request, id) => {\n      if (now - request.timestamp > timeout) {\n        clearTimeout(request.timeout);\n        this.pendingRequests.delete(id);\n        request.reject(new Error('Request expired during cleanup'));\n      }\n    });\n  }\n\n  /**\n   * Get bridge health status\n   */\n  public getHealthStatus(): {\n    isConnected: boolean;\n    pendingRequests: number;\n    environment: WebViewEnvironment;\n  } {\n    return {\n      isConnected: this.isWebViewEnvironment(),\n      pendingRequests: this.pendingRequests.size,\n      environment: this.getEnvironment()\n    };\n  }\n\n  /**\n   * Clean up pending callbacks (useful for component unmounting) - Legacy method\n   * @deprecated Use the enhanced cleanup() method instead\n   */\n  private legacyCleanup(): void {\n    this.pendingRequests.forEach((callback) => {\n      clearTimeout(callback.timeout);\n      callback.reject(new Error('WebView bridge cleanup - request cancelled'));\n    });\n    this.pendingRequests.clear();\n\n    if (process.env.NODE_ENV === 'development') {\n      console.log('WebViewBridge cleaned up all pending callbacks');\n    }\n  }\n\n  /**\n   * Check if WebView environment is available\n   */\n  public isWebViewEnvironment(): boolean {\n    return typeof window !== 'undefined' &&\n           typeof window.webkit !== 'undefined' &&\n           typeof window.webkit.messageHandlers !== 'undefined';\n  }\n\n  /**\n   * Check if specific handler is available\n   */\n  public isHandlerAvailable(handler: 'database' | 'filesystem'): boolean {\n    if (!this.isWebViewEnvironment()) {\n      return false;\n    }\n\n    return typeof window.webkit!.messageHandlers[handler] !== 'undefined' &&\n           typeof window.webkit!.messageHandlers[handler]!.postMessage === 'function';\n  }\n\n  /**\n   * Get environment information\n   */\n  public getEnvironment(): WebViewEnvironment {\n    if (this.isWebViewEnvironment() && window._isometryBridge) {\n      return window._isometryBridge.environment;\n    }\n\n    return {\n      isNative: false,\n      platform: 'browser',\n      version: '1.0',\n      transport: 'http-api'\n    };\n  }\n\n  /**\n   * Send message to native handler\n   */\n  public async sendMessage(handler: string, method: string, params: Record<string, unknown> = {}): Promise<unknown> {\n    if (!this.isWebViewEnvironment()) {\n      throw new Error('WebView bridge not available');\n    }\n\n    if (!window._isometryBridge) {\n      throw new Error('Bridge not initialized');\n    }\n\n    return window._isometryBridge.sendMessage(handler, method, params);\n  }\n\n  /**\n   * Database operations through WebView bridge\n   */\n  public database = {\n    execute: async (sql: string, params?: unknown[]): Promise<unknown[]> => {\n      return this.postMessage('database', 'execute', { sql, params });\n    },\n\n    getNodes: async (options: {\n      limit?: number;\n      offset?: number;\n      filter?: string;\n    } = {}): Promise<Node[]> => {\n      return this.postMessage('database', 'getNodes', options);\n    },\n\n    createNode: async (node: Partial<Node>): Promise<Node> => {\n      return this.postMessage('database', 'createNode', { node });\n    },\n\n    updateNode: async (node: Partial<Node>): Promise<Node> => {\n      return this.postMessage('database', 'updateNode', { node });\n    },\n\n    deleteNode: async (id: string): Promise<boolean> => {\n      const result = await this.postMessage<{ success: boolean }>('database', 'deleteNode', { id });\n      return result.success;\n    },\n\n    search: async (query: string, options: { limit?: number } = {}): Promise<Node[]> => {\n      return this.postMessage('database', 'search', { query, ...options });\n    },\n\n    getGraph: async (options: { nodeId?: string; depth?: number } = {}): Promise<{ nodes: Node[]; edges: { source: string; target: string; type: string }[] }> => {\n      return this.postMessage('database', 'getGraph', options);\n    },\n\n    reset: async (): Promise<void> => {\n      return this.postMessage('database', 'reset', {});\n    }\n  };\n\n  /**\n   * File system operations through WebView bridge\n   */\n  public filesystem = {\n    readFile: async (path: string): Promise<{ content: string; size: number; modified: number }> => {\n      return this.postMessage('filesystem', 'readFile', { path });\n    },\n\n    writeFile: async (path: string, content: string): Promise<boolean> => {\n      const result = await this.postMessage<{ success: boolean }>('filesystem', 'writeFile', { path, content });\n      return result.success;\n    },\n\n    deleteFile: async (path: string): Promise<boolean> => {\n      const result = await this.postMessage<{ success: boolean }>('filesystem', 'deleteFile', { path });\n      return result.success;\n    },\n\n    listFiles: async (path?: string): Promise<Array<{\n      name: string;\n      path: string;\n      isDirectory: boolean;\n      size: number;\n      modified: number;\n    }>> => {\n      return this.postMessage('filesystem', 'listFiles', { path });\n    },\n\n    fileExists: async (path: string): Promise<boolean> => {\n      const result = await this.postMessage<{ exists: boolean }>('filesystem', 'fileExists', { path });\n      return result.exists;\n    }\n  };\n\n  /**\n   * Wait for bridge to be ready\n   */\n  public async waitForReady(): Promise<void> {\n    if (!this.isWebViewEnvironment()) {\n      return Promise.resolve();\n    }\n\n    return new Promise((resolve) => {\n      if (window._isometryBridge) {\n        resolve();\n        return;\n      }\n\n      const handler = () => {\n        window.removeEventListener('isometry-bridge-ready', handler);\n        resolve();\n      };\n\n      window.addEventListener('isometry-bridge-ready', handler);\n\n      // Timeout after 5 seconds\n      setTimeout(() => {\n        window.removeEventListener('isometry-bridge-ready', handler);\n        resolve(); // Continue anyway\n      }, 5000);\n    });\n  }\n\n  // =============================================================================\n  // Connection Reliability and Recovery Methods\n  // =============================================================================\n\n  /**\n   * Start monitoring connection health\n   */\n  private startConnectionMonitoring(): void {\n    if (this.connectionCheckInterval) {\n      clearInterval(this.connectionCheckInterval);\n    }\n\n    this.connectionCheckInterval = setInterval(async () => {\n      if (this.isWebViewEnvironment()) {\n        const connected = await this.testConnection();\n\n        if (!connected && this.isConnected) {\n          // Connection lost\n          this.isConnected = false;\n          this.failureCount++;\n          bridgeLogger.warn('Connection lost, switching to queue mode');\n\n          if (this.failureCount >= this.CIRCUIT_BREAKER_THRESHOLD) {\n            this.circuitBreakerOpen = true;\n            this.lastConnectionTest = Date.now();\n            bridgeLogger.error('Circuit breaker opened due to repeated failures', { failureCount: this.failureCount });\n          }\n        } else if (connected && !this.isConnected) {\n          // Connection restored\n          this.isConnected = true;\n          this.failureCount = 0;\n          this.circuitBreakerOpen = false;\n          console.log('[WebView Bridge] Connection restored - processing queued messages');\n\n          // Process queued messages\n          this.processMessageQueue();\n        }\n      }\n    }, this.CONNECTION_CHECK_INTERVAL);\n  }\n\n  /**\n   * Test connection to WebView bridge\n   */\n  private async testConnection(): Promise<boolean> {\n    if (!this.isWebViewEnvironment()) {\n      return false;\n    }\n\n    try {\n      // Send a lightweight ping message\n      const testMessage: WebViewMessage = {\n        id: this.generateRequestId(),\n        handler: 'database',\n        method: 'ping',\n        params: {},\n        timestamp: Date.now()\n      };\n\n      // Quick timeout for connection test\n      const timeout = 2000;\n\n      return new Promise<boolean>((resolve) => {\n        const timeoutHandle = setTimeout(() => {\n          resolve(false);\n        }, timeout);\n\n        // Don't use normal callback registration to avoid interference\n        const tempCallback = (result: unknown) => {\n          clearTimeout(timeoutHandle);\n          resolve(result !== null && result !== undefined);\n        };\n\n        try {\n          if (window.webkit?.messageHandlers?.database) {\n            // Simple test without full callback registration\n            window.webkit.messageHandlers.database.postMessage(testMessage);\n            tempCallback(true); // If postMessage doesn't throw, assume connection works\n          } else {\n            resolve(false);\n          }\n        } catch {\n          resolve(false);\n        }\n      });\n\n    } catch {\n      return false;\n    }\n  }\n\n  /**\n   * Queue message for later delivery\n   */\n  private queueMessage(message: WebViewMessage): void {\n    // Remove oldest messages if queue is full\n    if (this.messageQueue.length >= this.MESSAGE_QUEUE_MAX_SIZE) {\n      const removed = this.messageQueue.shift();\n      if (removed) {\n        const pending = this.pendingRequests.get(removed.id);\n        if (pending) {\n          clearTimeout(pending.timeout);\n          this.pendingRequests.delete(removed.id);\n          pending.reject(new Error('Message queue overflow - message dropped'));\n        }\n      }\n    }\n\n    this.messageQueue.push(message);\n  }\n\n  /**\n   * Process queued messages when connection is restored\n   */\n  private processMessageQueue(): void {\n    const messagesToSend = [...this.messageQueue];\n    this.messageQueue = [];\n\n    console.log(`[WebView Bridge] Processing ${messagesToSend.length} queued messages`);\n\n    for (const message of messagesToSend) {\n      try {\n        this.sendMessageImmediate(message, 0);\n      } catch (error) {\n        console.error(`[WebView Bridge] Failed to send queued message ${message.id}:`, error);\n\n        // Reject the pending request\n        const pending = this.pendingRequests.get(message.id);\n        if (pending) {\n          clearTimeout(pending.timeout);\n          this.pendingRequests.delete(message.id);\n          pending.reject(new Error(`Failed to send queued message: ${error}`));\n        }\n      }\n    }\n  }\n\n  /**\n   * Send message immediately to native bridge\n   */\n  private sendMessageImmediate(message: WebViewMessage, _retries: number): void {\n    const handler = message.handler as keyof WebKitMessageHandlers;\n    if (!window.webkit?.messageHandlers?.[handler]) {\n      throw new Error(`WebView handler '${message.handler}' not available`);\n    }\n\n    try {\n      window.webkit.messageHandlers[handler].postMessage(message);\n\n      // Debug logging\n      if (process.env.NODE_ENV === 'development') {\n        console.log(`[WebView Bridge] ${message.handler}.${message.method}`, message.params);\n      }\n\n    } catch (error) {\n      // Increment failure count and potentially open circuit breaker\n      this.failureCount++;\n\n      if (this.failureCount >= this.CIRCUIT_BREAKER_THRESHOLD) {\n        this.circuitBreakerOpen = true;\n        this.lastConnectionTest = Date.now();\n      }\n\n      throw error;\n    }\n  }\n\n  /**\n   * Handle send failure with retry logic\n   */\n  private handleSendFailure<T = unknown>(\n    error: unknown,\n    handler: 'database' | 'filesystem',\n    method: string,\n    params: Record<string, unknown>,\n    retries: number,\n    resolve: (value: T) => void,\n    reject: (error: Error) => void\n  ): void {\n    // Retry logic for transient failures\n    if (retries < this.MAX_RETRIES && this.isRetriableError(error)) {\n      const delay = this.RETRY_DELAY * Math.pow(2, retries); // Exponential backoff with jitter\n      const jitter = Math.random() * 0.1 * delay; // 10% jitter\n      const totalDelay = delay + jitter;\n\n      setTimeout(() => {\n        this.postMessage<T>(handler, method, params, retries + 1)\n          .then(resolve)\n          .catch(reject);\n      }, totalDelay);\n      return;\n    }\n\n    reject(error instanceof Error ? error : new Error(`Failed to send message: ${error}`));\n  }\n\n  /**\n   * Handle response error with retry logic\n   */\n  private handleResponseError(\n    response: WebViewResponse,\n    pending: {\n      resolve: (value: unknown) => void;\n      reject: (error: Error) => void;\n      timeout: NodeJS.Timeout;\n      timestamp: number;\n      retryCount: number;\n    }\n  ): void {\n    const error = new Error(response.error || 'Unknown bridge error');\n\n    // Check if this error is worth retrying\n    if (pending.retryCount < this.MAX_RETRIES && this.isRetriableError(error)) {\n      pending.retryCount++;\n      this.failureCount++;\n\n      // Re-register for retry\n      const newId = this.generateRequestId();\n      this.pendingRequests.set(newId, {\n        ...pending,\n        timeout: setTimeout(() => {\n          this.pendingRequests.delete(newId);\n          pending.reject(new Error(`WebView request timeout after retry: ${newId}`));\n        }, this.DEFAULT_TIMEOUT)\n      });\n\n      // Retry the original request (this would need the original message data)\n      console.log(`[WebView Bridge] Retrying request ${response.id} as ${newId} (attempt ${pending.retryCount})`);\n    } else {\n      pending.reject(error);\n    }\n  }\n\n  /**\n   * Enhanced cleanup with connection state management\n   */\n  public cleanup(): void {\n    // Stop connection monitoring\n    if (this.connectionCheckInterval) {\n      clearInterval(this.connectionCheckInterval);\n      this.connectionCheckInterval = null;\n    }\n\n    // Stop cleanup interval\n    if (this.cleanupInterval) {\n      clearInterval(this.cleanupInterval);\n      this.cleanupInterval = null;\n    }\n\n    // Clear message queue and reject all pending\n    this.messageQueue = [];\n\n    this.pendingRequests.forEach((callback) => {\n      clearTimeout(callback.timeout);\n      callback.reject(new Error('WebView bridge cleanup - request cancelled'));\n    });\n    this.pendingRequests.clear();\n\n    // Reset connection state\n    this.isConnected = false;\n    this.circuitBreakerOpen = false;\n    this.failureCount = 0;\n\n    if (process.env.NODE_ENV === 'development') {\n      console.log('WebViewBridge cleaned up all pending callbacks and reset connection state');\n    }\n  }\n\n}\n\n/**\n * Singleton bridge instance\n */\nexport const webViewBridge = new WebViewBridge();\n\n/**\n * Environment detection utilities\n */\nexport const Environment = {\n  /**\n   * Check if running in WebView\n   */\n  isWebView: (): boolean => webViewBridge.isWebViewEnvironment(),\n\n  /**\n   * Check if running in browser\n   */\n  isBrowser: (): boolean => !webViewBridge.isWebViewEnvironment(),\n\n  /**\n   * Get current environment info\n   */\n  info: (): WebViewEnvironment => webViewBridge.getEnvironment(),\n\n  /**\n   * Get preferred transport method\n   */\n  getTransport: (): 'webview-bridge' | 'http-api' => {\n    if (webViewBridge.isWebViewEnvironment()) {\n      return 'webview-bridge';\n    }\n\n    return 'http-api';\n  }\n};\n\n/**\n * Get or create global WebView bridge instance\n */\nexport function getWebViewBridge(): WebViewBridge {\n  if (!webViewBridge) {\n    throw new Error('WebView bridge not initialized');\n  }\n  return webViewBridge;\n}\n\n/**\n * Standalone WebView environment detection\n * @returns true if running in WebView environment\n */\nexport function isWebViewEnvironment(): boolean {\n  return webViewBridge.isWebViewEnvironment();\n}\n\n/**\n * Check if specific handler is available\n */\nexport function isHandlerAvailable(handler: 'database' | 'filesystem'): boolean {\n  return webViewBridge.isHandlerAvailable(handler);\n}\n\n/**\n * Direct message posting to WebView handlers\n * @param handler - The handler name ('database' or 'filesystem')\n * @param method - The method to call\n * @param params - Parameters to send\n * @returns Promise that resolves with the response\n */\nexport async function postMessage<T = unknown>(\n  handler: 'database' | 'filesystem',\n  method: string,\n  params: Record<string, unknown> = {}\n): Promise<T> {\n  return webViewBridge.postMessage<T>(handler, method, params);\n}\n\n/**\n * Test WebView bridge connectivity\n */\nexport async function testBridge(): Promise<{\n  isWebView: boolean;\n  database: boolean;\n  filesystem: boolean;\n  healthInfo: ReturnType<WebViewBridge['getHealthStatus']>;\n}> {\n  const bridge = webViewBridge;\n  const isWebView = bridge.isWebViewEnvironment();\n\n  let databaseConnected = false;\n  let filesystemConnected = false;\n\n  if (isWebView) {\n    try {\n      await bridge.postMessage('database', 'ping', {});\n      databaseConnected = true;\n    } catch {\n      databaseConnected = false;\n    }\n\n    try {\n      await bridge.postMessage('filesystem', 'ping', {});\n      filesystemConnected = true;\n    } catch {\n      filesystemConnected = false;\n    }\n  }\n\n  return {\n    isWebView,\n    database: databaseConnected,\n    filesystem: filesystemConnected,\n    healthInfo: bridge.getHealthStatus(),\n  };\n}\n\n/**\n * Utility for graceful environment detection with fallback\n */\nexport function detectEnvironment(): {\n  type: 'webview' | 'browser' | 'unknown';\n  capabilities: {\n    database: boolean;\n    filesystem: boolean;\n    webkit: boolean;\n  };\n  recommendedTransport: 'webview' | 'http' | 'sqljs';\n} {\n  const isWebView = isWebViewEnvironment();\n  const hasDatabase = isHandlerAvailable('database');\n  const hasFilesystem = isHandlerAvailable('filesystem');\n\n  let type: 'webview' | 'browser' | 'unknown' = 'unknown';\n  let recommendedTransport: 'webview' | 'http' | 'sqljs' = 'sqljs';\n\n  if (isWebView && hasDatabase) {\n    type = 'webview';\n    recommendedTransport = 'webview';\n  } else if (typeof window !== 'undefined' && window.location) {\n    type = 'browser';\n    // Check if HTTP API is available in browser environment\n    recommendedTransport = 'http'; // Could test availability and fall back to 'sqljs'\n  }\n\n  return {\n    type,\n    capabilities: {\n      database: hasDatabase,\n      filesystem: hasFilesystem,\n      webkit: isWebView,\n    },\n    recommendedTransport,\n  };\n}\n\n/**\n * Development utilities\n */\nexport const DevTools = {\n  /**\n   * Enable bridge logging\n   */\n  enableLogging: (): void => {\n    if (webViewBridge.isWebViewEnvironment() && window._isometryBridge) {\n      if (window._isometryBridge.debug) {\n        window._isometryBridge.debug.logMessages = true;\n        window._isometryBridge.debug.showPerformance = true;\n      }\n    }\n  },\n\n  /**\n   * Test bridge connectivity\n   */\n  testConnection: async (): Promise<boolean> => {\n    try {\n      const result = await testBridge();\n      return result.database && result.isWebView;\n    } catch {\n      return false;\n    }\n  },\n\n  /**\n   * Get bridge statistics\n   */\n  getStats: () => {\n    return {\n      environment: webViewBridge.getEnvironment(),\n      isWebView: webViewBridge.isWebViewEnvironment(),\n      bridgeReady: !!(window._isometryBridge),\n      webkitReady: !!(window.webkit?.messageHandlers),\n      healthInfo: webViewBridge.getHealthStatus()\n    };\n  }\n};","/**\n * WebView Database Context\n *\n * Mirror exact interface of existing DatabaseContext but uses WebViewClient instead of sql.js.\n * Provides same loading/error state management and hook interfaces for seamless compatibility.\n */\n\nimport React, { createContext, useContext, useEffect, useState, useCallback } from 'react';\nimport { WebViewClient, createWebViewClient } from './WebViewClient';\nimport { isWebViewEnvironment } from '../utils/webview-bridge';\n\n/**\n * WebView Database Context interface matching existing DatabaseContext exactly\n * Provides identical interface for seamless component compatibility\n */\nexport interface WebViewDatabaseContextValue {\n  db: WebViewClient | null;\n  loading: boolean;\n  error: Error | null;\n  execute: <T = Record<string, unknown>>(sql: string, params?: unknown[]) => Promise<T[]>;\n  save: () => Promise<void>;\n  reset: () => Promise<void>;\n  isConnected: () => boolean;\n  getConnectionStatus: () => { isConnected: boolean; transport: string; };\n  getBridgeHealth: () => {\n    isConnected: boolean;\n    pendingRequests: number;\n    environment: {\n      isNative: boolean;\n      platform: string;\n      version: string;\n      transport: string;\n    };\n  };\n}\n\nconst WebViewDatabaseContext = createContext<WebViewDatabaseContextValue | null>(null);\n\nexport interface WebViewDatabaseProviderProps {\n  children: React.ReactNode;\n  timeout?: number;\n  retryAttempts?: number;\n  retryDelay?: number;\n}\n\n/**\n * WebView Database Provider using WebView bridge instead of sql.js\n * Maintains identical interface and state management patterns as DatabaseProvider\n */\nexport function WebViewDatabaseProvider({\n  children,\n  timeout = 10000,\n  retryAttempts = 3,\n  retryDelay = 1000,\n}: WebViewDatabaseProviderProps) {\n  const [db, setDb] = useState<WebViewClient | null>(null);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<Error | null>(null);\n\n  // Initialize client with retry logic\n  useEffect(() => {\n    let isCancelled = false;\n\n    const initializeClient = async (attempt: number = 1) => {\n      if (isCancelled) return;\n\n      setLoading(true);\n      setError(null);\n\n      try {\n        console.log(`Connecting to WebView bridge (attempt ${attempt}/${retryAttempts})`);\n\n        if (!isWebViewEnvironment()) {\n          throw new Error('WebView environment not available - ensure running in native app');\n        }\n\n        const client = await createWebViewClient(timeout);\n\n        if (!isCancelled) {\n          setDb(client);\n          console.log('WebView client connected successfully');\n        }\n      } catch (err) {\n        console.error(`WebView connection attempt ${attempt} failed:`, err);\n\n        if (!isCancelled) {\n          if (attempt < retryAttempts) {\n            // Retry after delay\n            setTimeout(() => {\n              if (!isCancelled) {\n                initializeClient(attempt + 1);\n              }\n            }, retryDelay * attempt); // Exponential backoff\n            return; // Don't set loading to false yet\n          } else {\n            // All retry attempts failed\n            setError(err as Error);\n          }\n        }\n      } finally {\n        if (!isCancelled) {\n          setLoading(false);\n        }\n      }\n    };\n\n    initializeClient();\n\n    return () => {\n      isCancelled = true;\n    };\n  }, [timeout, retryAttempts, retryDelay]);\n\n  /**\n   * Execute SQL query - identical interface to sql.js DatabaseContext\n   */\n  const execute = useCallback(async <T = Record<string, unknown>>(\n    sql: string,\n    params?: unknown[]\n  ): Promise<T[]> => {\n    if (!db) {\n      throw new Error('WebView database client not initialized');\n    }\n\n    try {\n      return await db.execute<T>(sql, params);\n    } catch (err) {\n      console.error('WebView database execution error:', sql, params, err);\n\n      // Check if error indicates disconnection\n      const errorMessage = (err as Error).message.toLowerCase();\n      if (errorMessage.includes('timeout') || errorMessage.includes('bridge') || errorMessage.includes('webview')) {\n        setError(err as Error);\n      }\n\n      throw err;\n    }\n  }, [db]);\n\n  /**\n   * Save operation - no-op for compatibility (native handles persistence)\n   */\n  const save = useCallback(async () => {\n    if (!db) {\n      throw new Error('WebView database client not initialized');\n    }\n\n    await db.save();\n  }, [db]);\n\n  /**\n   * Reset database - calls WebView reset and reinitializes client\n   */\n  const reset = useCallback(async () => {\n    if (!db) {\n      throw new Error('WebView database client not initialized');\n    }\n\n    setLoading(true);\n    setError(null);\n\n    try {\n      await db.reset();\n      console.log('WebView database reset successfully');\n    } catch (err) {\n      console.error('WebView database reset error:', err);\n      setError(err as Error);\n\n      // Try to reconnect after failed reset\n      try {\n        const newClient = await createWebViewClient(timeout);\n        setDb(newClient);\n        console.log('Reconnected to WebView bridge after reset failure');\n      } catch (reconnectErr) {\n        console.error('Failed to reconnect after reset failure:', reconnectErr);\n        setError(reconnectErr as Error);\n      }\n    } finally {\n      setLoading(false);\n    }\n  }, [db, timeout]);\n\n  /**\n   * Check if database client is connected\n   */\n  const isConnected = useCallback(() => {\n    return db ? db.isConnected() : false;\n  }, [db]);\n\n  /**\n   * Get connection status for monitoring\n   */\n  const getConnectionStatus = useCallback(() => {\n    return db ? db.getConnectionStatus() : { isConnected: false, transport: 'none' };\n  }, [db]);\n\n  /**\n   * Get bridge health information\n   */\n  const getBridgeHealth = useCallback(() => {\n    if (!db) {\n      return {\n        isConnected: false,\n        pendingRequests: 0,\n        environment: { isNative: false, platform: 'browser', version: '1.0', transport: 'http-api' }\n      };\n    }\n\n    // Access the bridge health through the client's getBridgeHealth method\n    const webViewClient = db as unknown as { getBridgeHealth?: () => unknown };\n    if (webViewClient.getBridgeHealth) {\n      return webViewClient.getBridgeHealth();\n    }\n\n    // Fallback to basic connection status\n    const connectionStatus = db.getConnectionStatus();\n    return {\n      isConnected: connectionStatus.isConnected,\n      pendingRequests: connectionStatus.pendingRequests || 0,\n      environment: {\n        isNative: connectionStatus.transport === 'webview',\n        platform: 'unknown',\n        version: '1.0',\n        transport: connectionStatus.transport\n      }\n    };\n  }, [db]);\n\n  const contextValue: WebViewDatabaseContextValue = {\n    db,\n    loading,\n    error,\n    execute,\n    save,\n    reset,\n    isConnected,\n    getConnectionStatus,\n    getBridgeHealth,\n  };\n\n  return (\n    <WebViewDatabaseContext.Provider value={contextValue}>\n      {children}\n    </WebViewDatabaseContext.Provider>\n  );\n}\n\n/**\n * Hook to access WebView database context\n * Identical interface to useDatabase() for drop-in replacement\n */\nexport function useWebViewDatabase(): WebViewDatabaseContextValue {\n  const context = useContext(WebViewDatabaseContext);\n  if (!context) {\n    throw new Error('useWebViewDatabase must be used within WebViewDatabaseProvider');\n  }\n  return context;\n}\n\n/**\n * Hook that provides the same interface as useDatabase() from DatabaseContext\n * Allows components to use WebView database transparently\n */\nexport function useDatabaseCompat(): {\n  db: WebViewClient | null;\n  loading: boolean;\n  error: Error | null;\n  execute: <T = Record<string, unknown>>(sql: string, params?: unknown[]) => Promise<T[]>;\n  save: () => Promise<void>;\n  reset: () => Promise<void>;\n} {\n  const { db, loading, error, execute, save, reset } = useWebViewDatabase();\n\n  return {\n    db,\n    loading,\n    error,\n    execute,\n    save,\n    reset,\n  };\n}\n\n/**\n * Utility component to display connection status for debugging\n */\nexport function WebViewDatabaseStatus() {\n  const { loading, error, getBridgeHealth } = useWebViewDatabase();\n\n  if (loading) {\n    return <div className=\"text-sm text-gray-500\">Connecting to WebView bridge...</div>;\n  }\n\n  if (error) {\n    return (\n      <div className=\"text-sm text-red-500\">\n        WebView Bridge Error: {error.message}\n      </div>\n    );\n  }\n\n  const health = getBridgeHealth();\n\n  if (health.isConnected) {\n    return (\n      <div className=\"text-sm text-green-500\">\n        WebView Bridge Connected\n        {health.pendingRequests > 0 && (\n          <span className=\"ml-2 text-gray-400\">({health.pendingRequests} pending)</span>\n        )}\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"text-sm text-yellow-500\">\n      WebView Bridge Disconnected\n      {health.pendingRequests > 0 && (\n        <span className=\"ml-2 text-gray-400\">({health.pendingRequests} queued)</span>\n      )}\n    </div>\n  );\n}\n\n/**\n * Advanced bridge status component for debugging and monitoring\n */\nexport function WebViewBridgeHealthStatus() {\n  const { getBridgeHealth } = useWebViewDatabase();\n  const health = getBridgeHealth();\n\n  return (\n    <div className=\"text-xs text-gray-600 space-y-1\">\n      <div className=\"flex justify-between\">\n        <span>Status:</span>\n        <span className={health.isConnected ? 'text-green-600' : 'text-red-600'}>\n          {health.isConnected ? 'Connected' : 'Disconnected'}\n        </span>\n      </div>\n      <div className=\"flex justify-between\">\n        <span>Transport:</span>\n        <span>{health.environment.transport}</span>\n      </div>\n      <div className=\"flex justify-between\">\n        <span>Platform:</span>\n        <span>{health.environment.platform}</span>\n      </div>\n      <div className=\"flex justify-between\">\n        <span>Pending Requests:</span>\n        <span>{health.pendingRequests}</span>\n      </div>\n      <div className=\"flex justify-between\">\n        <span>Version:</span>\n        <span>{health.environment.version}</span>\n      </div>\n    </div>\n  );\n}","/**\n * Environment Context\n *\n * Provides comprehensive environment detection and automatic database provider selection\n * Handles WebView and HTTP API providers\n */\n\nimport React, { createContext, useContext, useEffect, useState, ReactNode } from 'react';\nimport { Environment } from '../utils/webview-bridge';\n\nexport enum DatabaseMode {\n  HTTP_API = 'http-api',\n  WEBVIEW_BRIDGE = 'webview-bridge',\n  AUTO = 'auto'\n}\n\nexport interface EnvironmentCapabilities {\n  canReadFiles: boolean;\n  canWriteFiles: boolean;\n  hasRealTimeSync: boolean;\n  supportsOffline: boolean;\n  hasNativeExport: boolean;\n  hasCloudSync: boolean;\n}\n\nexport interface EnvironmentInfo {\n  mode: DatabaseMode;\n  capabilities: EnvironmentCapabilities;\n  platform: 'iOS' | 'macOS' | 'browser';\n  version: string;\n  isNative: boolean;\n  performanceProfile: 'fast' | 'medium' | 'slow';\n}\n\ninterface EnvironmentContextType {\n  environment: EnvironmentInfo;\n  isLoading: boolean;\n  error: string | null;\n  forceMode: (mode: DatabaseMode) => void;\n  refreshEnvironment: () => Promise<void>;\n  testConnection: () => Promise<boolean>;\n}\n\nconst EnvironmentContext = createContext<EnvironmentContextType | null>(null);\n\ninterface EnvironmentProviderProps {\n  children: ReactNode;\n  forcedMode?: DatabaseMode;\n  enableAutoDetection?: boolean;\n}\n\n/**\n * Environment Provider that automatically detects and configures the optimal database mode\n */\nexport function EnvironmentProvider({\n  children,\n  forcedMode,\n  enableAutoDetection = true\n}: EnvironmentProviderProps) {\n  const [environment, setEnvironment] = useState<EnvironmentInfo>({\n    mode: DatabaseMode.HTTP_API,\n    capabilities: getCapabilities(DatabaseMode.HTTP_API),\n    platform: 'browser',\n    version: '1.0',\n    isNative: false,\n    performanceProfile: 'medium'\n  });\n  const [isLoading, setIsLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n\n  /**\n   * Detect the optimal database mode based on available features\n   */\n  const detectEnvironment = async (): Promise<DatabaseMode> => {\n    try {\n      // If forced mode is specified, use it\n      if (forcedMode && forcedMode !== DatabaseMode.AUTO) {\n        return forcedMode;\n      }\n\n      // Check for WebView MessageHandlers (highest priority)\n      if (await testWebViewBridge()) {\n        console.log('Environment: WebView bridge detected');\n        return DatabaseMode.WEBVIEW_BRIDGE;\n      }\n\n      // Check for HTTP API availability (medium priority)\n      if (await testHTTPAPIConnection()) {\n        console.log('Environment: HTTP API detected');\n        return DatabaseMode.HTTP_API;\n      }\n\n      // Fall back to HTTP API (sql.js no longer supported)\n      console.log('Environment: Falling back to HTTP API');\n      return DatabaseMode.HTTP_API;\n\n    } catch (error) {\n      console.warn('Environment detection failed:', error);\n      return DatabaseMode.HTTP_API;\n    }\n  };\n\n  /**\n   * Test WebView bridge availability\n   */\n  const testWebViewBridge = async (): Promise<boolean> => {\n    if (!Environment.isWebView()) {\n      return false;\n    }\n\n    try {\n      // Test if bridge is actually functional with a simple ping\n      const response = await Environment.postMessage('database', 'ping', {});\n      return response !== null;\n    } catch (error) {\n      console.warn('WebView bridge test failed:', error);\n      return false;\n    }\n  };\n\n  /**\n   * Test HTTP API connection\n   */\n  const testHTTPAPIConnection = async (): Promise<boolean> => {\n    // Only test HTTP API if not in WebView\n    if (Environment.isWebView()) {\n      return false;\n    }\n\n    try {\n      const baseURL = process.env.REACT_APP_API_URL || 'http://localhost:8080';\n      const response = await fetch(`${baseURL}/health`, {\n        method: 'GET',\n        timeout: 2000\n      } as RequestInit);\n\n      return response.ok;\n    } catch (error) {\n      console.warn('HTTP API test failed:', error);\n      return false;\n    }\n  };\n\n  /**\n   * Get capabilities for a specific database mode\n   */\n  function getCapabilities(mode: DatabaseMode): EnvironmentCapabilities {\n    switch (mode) {\n      case DatabaseMode.WEBVIEW_BRIDGE:\n        return {\n          canReadFiles: true,\n          canWriteFiles: true,\n          hasRealTimeSync: true,\n          supportsOffline: true,\n          hasNativeExport: true,\n          hasCloudSync: true\n        };\n\n      case DatabaseMode.HTTP_API:\n        return {\n          canReadFiles: false,\n          canWriteFiles: false,\n          hasRealTimeSync: false,\n          supportsOffline: false,\n          hasNativeExport: false,\n          hasCloudSync: true\n        };\n\n      default:\n        return {\n          canReadFiles: false,\n          canWriteFiles: false,\n          hasRealTimeSync: false,\n          supportsOffline: false,\n          hasNativeExport: false,\n          hasCloudSync: true\n        };\n    }\n  }\n\n  /**\n   * Get performance profile for a database mode\n   */\n  function getPerformanceProfile(mode: DatabaseMode): 'fast' | 'medium' | 'slow' {\n    switch (mode) {\n      case DatabaseMode.WEBVIEW_BRIDGE:\n        return 'fast';\n      case DatabaseMode.HTTP_API:\n      default:\n        return 'medium';\n    }\n  }\n\n  /**\n   * Create environment info from detected mode\n   */\n  const createEnvironmentInfo = (mode: DatabaseMode): EnvironmentInfo => {\n    const envInfo = Environment.info();\n\n    return {\n      mode,\n      capabilities: getCapabilities(mode),\n      platform: envInfo.platform as 'iOS' | 'macOS' | 'browser',\n      version: envInfo.version,\n      isNative: envInfo.isNative,\n      performanceProfile: getPerformanceProfile(mode)\n    };\n  };\n\n  /**\n   * Initialize environment detection\n   */\n  const initializeEnvironment = async (): Promise<void> => {\n    if (!enableAutoDetection && !forcedMode) {\n      return;\n    }\n\n    setIsLoading(true);\n    setError(null);\n\n    try {\n      const detectedMode = await detectEnvironment();\n      const envInfo = createEnvironmentInfo(detectedMode);\n\n      setEnvironment(envInfo);\n\n      console.log(`Environment initialized: ${detectedMode}`, envInfo);\n    } catch (err) {\n      const errorMessage = err instanceof Error ? err.message : 'Environment detection failed';\n      setError(errorMessage);\n      console.error('Environment initialization failed:', err);\n\n      // Fall back to HTTP API on error\n      setEnvironment(createEnvironmentInfo(DatabaseMode.HTTP_API));\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  /**\n   * Force a specific database mode\n   */\n  const forceMode = (mode: DatabaseMode): void => {\n    if (mode === DatabaseMode.AUTO) {\n      initializeEnvironment();\n    } else {\n      setEnvironment(createEnvironmentInfo(mode));\n    }\n  };\n\n  /**\n   * Refresh environment detection\n   */\n  const refreshEnvironment = async (): Promise<void> => {\n    await initializeEnvironment();\n  };\n\n  /**\n   * Test current connection\n   */\n  const testConnection = async (): Promise<boolean> => {\n    switch (environment.mode) {\n      case DatabaseMode.WEBVIEW_BRIDGE:\n        return testWebViewBridge();\n      case DatabaseMode.HTTP_API:\n      default:\n        return testHTTPAPIConnection();\n    }\n  };\n\n  // Initialize on mount and when forced mode changes\n  useEffect(() => {\n    initializeEnvironment();\n  }, [forcedMode, enableAutoDetection]);\n\n  const contextValue: EnvironmentContextType = {\n    environment,\n    isLoading,\n    error,\n    forceMode,\n    refreshEnvironment,\n    testConnection\n  };\n\n  return (\n    <EnvironmentContext.Provider value={contextValue}>\n      {children}\n    </EnvironmentContext.Provider>\n  );\n}\n\n/**\n * Hook to access environment context\n */\nexport function useEnvironment(): EnvironmentContextType {\n  const context = useContext(EnvironmentContext);\n\n  if (!context) {\n    throw new Error('useEnvironment must be used within EnvironmentProvider');\n  }\n\n  return context;\n}\n\n/**\n * Hook for simple environment detection\n */\nexport function useEnvironmentInfo(): EnvironmentInfo {\n  const { environment } = useEnvironment();\n  return environment;\n}\n\n/**\n * Hook for capabilities checking\n */\nexport function useCapabilities(): EnvironmentCapabilities {\n  const { environment } = useEnvironment();\n  return environment.capabilities;\n}\n\n/**\n * Component for displaying environment information\n */\nexport function EnvironmentDebugInfo() {\n  const { environment, isLoading, error, testConnection } = useEnvironment();\n  const [connectionTest, setConnectionTest] = useState<boolean | null>(null);\n\n  const handleTestConnection = async () => {\n    const result = await testConnection();\n    setConnectionTest(result);\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"p-4 bg-gray-100 rounded\">\n        <p className=\"text-sm text-gray-600\">Detecting environment...</p>\n      </div>\n    );\n  }\n\n  if (error) {\n    return (\n      <div className=\"p-4 bg-red-100 border border-red-300 rounded\">\n        <p className=\"text-sm text-red-700\">Environment Error: {error}</p>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"p-4 bg-blue-50 border border-blue-200 rounded\">\n      <h3 className=\"text-sm font-semibold mb-2\">Environment Information</h3>\n      <div className=\"text-xs space-y-1\">\n        <div><strong>Mode:</strong> {environment.mode}</div>\n        <div><strong>Platform:</strong> {environment.platform}</div>\n        <div><strong>Performance:</strong> {environment.performanceProfile}</div>\n        <div><strong>Native:</strong> {environment.isNative ? 'Yes' : 'No'}</div>\n\n        <div className=\"mt-2\">\n          <strong>Capabilities:</strong>\n          <ul className=\"ml-4 text-xs\">\n            <li>Files: {environment.capabilities.canReadFiles ? '' : ''} Read, {environment.capabilities.canWriteFiles ? '' : ''} Write</li>\n            <li>Sync: {environment.capabilities.hasRealTimeSync ? '' : ''} Real-time, {environment.capabilities.hasCloudSync ? '' : ''} Cloud</li>\n            <li>Export: {environment.capabilities.hasNativeExport ? '' : ''} Native</li>\n            <li>Offline: {environment.capabilities.supportsOffline ? '' : ''} Supported</li>\n          </ul>\n        </div>\n\n        <div className=\"mt-2\">\n          <button\n            onClick={handleTestConnection}\n            className=\"text-xs px-2 py-1 bg-blue-600 text-white rounded hover:bg-blue-700\"\n          >\n            Test Connection\n          </button>\n          {connectionTest !== null && (\n            <span className={`ml-2 text-xs ${connectionTest ? 'text-green-600' : 'text-red-600'}`}>\n              {connectionTest ? ' Connected' : ' Failed'}\n            </span>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n}","import React from 'react';\nimport { NativeDatabaseProvider, useNativeDatabase, NativeDatabaseContextValue } from './NativeDatabaseContext';\nimport { WebViewDatabaseProvider, useWebViewDatabase } from './WebViewDatabaseContext';\nimport { DatabaseMode, useEnvironment } from '../contexts/EnvironmentContext';\n\n// Legacy interface for backward compatibility during migration\ninterface LegacyDatabase {\n  exec(sql: string, params?: unknown[]): Array<{ columns: string[]; values: unknown[][] }>;\n}\n\ninterface DatabaseContextValue {\n  db: LegacyDatabase | null;\n  loading: boolean;\n  error: Error | null;\n  execute: <T = Record<string, unknown>>(sql: string, params?: unknown[]) => T[];\n  save: () => Promise<void>;\n  reset: () => Promise<void>;\n}\n\n// Union type for unified database context (currently unused but may be needed for future type checking)\n// type UnifiedDatabaseContextValue = DatabaseContextValue | NativeDatabaseContextValue;\n\n\n// DEPRECATED: SQL.js Database Provider has been completely removed\n// Use NativeDatabaseProvider or WebViewDatabaseProvider instead\n\n/**\n * Smart Database Provider that uses EnvironmentContext for provider selection\n */\nfunction SmartDatabaseProvider({ children }: { children: React.ReactNode }) {\n  const { environment, isLoading } = useEnvironment();\n\n  // Set up development performance reporting\n  React.useEffect(() => {\n    if (process.env.NODE_ENV === 'development') {\n      // Log performance reports every 30 seconds\n      const interval = setInterval(() => {\n        logPerformanceReport();\n      }, 30000);\n\n      // Clean up on unmount\n      return () => clearInterval(interval);\n    }\n  }, []);\n\n  // Show loading state while environment is being detected\n  if (isLoading) {\n    return (\n      <div className=\"flex items-center justify-center min-h-screen\">\n        <div className=\"text-center space-y-4\">\n          <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500 mx-auto\"></div>\n          <p className=\"text-gray-600\">Detecting database environment...</p>\n        </div>\n      </div>\n    );\n  }\n\n  switch (environment.mode) {\n    case DatabaseMode.WEBVIEW_BRIDGE:\n      console.log('Using WebView Database Bridge (auto-detected)');\n      return (\n        <WebViewDatabaseProvider>\n          {children}\n        </WebViewDatabaseProvider>\n      );\n\n    case DatabaseMode.HTTP_API:\n      console.log('Using Native Database API (auto-detected)');\n      return (\n        <NativeDatabaseProvider>\n          {children}\n        </NativeDatabaseProvider>\n      );\n\n    default:\n      // Fallback to HTTP API - sql.js is no longer supported\n      console.log('Unknown database mode - using HTTP API');\n      return (\n        <NativeDatabaseProvider>\n          {children}\n        </NativeDatabaseProvider>\n      );\n  }\n}\n\n/**\n * Unified Database Provider with automatic environment detection\n * Now uses EnvironmentContext for intelligent provider selection\n */\nexport function DatabaseProvider({ children }: { children: React.ReactNode }) {\n  return (\n    <SmartDatabaseProvider>\n      {children}\n    </SmartDatabaseProvider>\n  );\n}\n\n/**\n * Unified database hook that works with all database contexts\n * Uses EnvironmentContext to determine the appropriate provider\n */\nexport function useDatabase(): DatabaseContextValue | NativeDatabaseContextValue {\n  const { environment } = useEnvironment();\n\n  switch (environment.mode) {\n    case DatabaseMode.WEBVIEW_BRIDGE:\n      return useWebViewDatabase();\n\n    case DatabaseMode.HTTP_API:\n      return useNativeDatabase();\n\n    default:\n      // Unknown mode - fallback to native API\n      return useNativeDatabase();\n  }\n}\n","// Node (Card) types\n\nexport type NodeType = 'note' | 'task' | 'contact' | 'event' | 'project' | 'resource' | 'notebook';\nexport type TaskStatus = 'active' | 'pending' | 'completed' | 'archived';\nexport type EdgeType = 'LINK' | 'NEST' | 'SEQUENCE' | 'AFFINITY';\n\nexport interface Node {\n  id: string;\n  nodeType: NodeType;\n  name: string;\n  content: string | null;\n  summary: string | null;\n  \n  // LATCH: Location\n  latitude: number | null;\n  longitude: number | null;\n  locationName: string | null;\n  locationAddress: string | null;\n  \n  // LATCH: Time\n  createdAt: string;\n  modifiedAt: string;\n  dueAt: string | null;\n  completedAt: string | null;\n  eventStart: string | null;\n  eventEnd: string | null;\n  \n  // LATCH: Category\n  folder: string | null;\n  tags: string[];\n  status: TaskStatus | null;\n  \n  // LATCH: Hierarchy\n  priority: number;\n  importance: number;\n  sortOrder: number;\n  \n  // Metadata\n  source: string | null;\n  sourceId: string | null;\n  sourceUrl: string | null;\n  deletedAt: string | null;\n  version: number;\n}\n\nexport interface Edge {\n  id: string;\n  edgeType: EdgeType;\n  sourceId: string;\n  targetId: string;\n  label: string | null;\n  weight: number;\n  directed: boolean;\n  sequenceOrder: number | null;\n  channel: string | null;\n  timestamp: string | null;\n  subject: string | null;\n  createdAt: string;\n}\n\n// Database row converters\nexport function rowToNode(row: Record<string, unknown>): Node {\n  return {\n    id: row.id as string,\n    nodeType: row.node_type as NodeType,\n    name: row.name as string,\n    content: row.content as string | null,\n    summary: row.summary as string | null,\n    latitude: row.latitude as number | null,\n    longitude: row.longitude as number | null,\n    locationName: row.location_name as string | null,\n    locationAddress: row.location_address as string | null,\n    createdAt: row.created_at as string,\n    modifiedAt: row.modified_at as string,\n    dueAt: row.due_at as string | null,\n    completedAt: row.completed_at as string | null,\n    eventStart: row.event_start as string | null,\n    eventEnd: row.event_end as string | null,\n    folder: row.folder as string | null,\n    tags: row.tags ? JSON.parse(row.tags as string) : [],\n    status: row.status as TaskStatus | null,\n    priority: (row.priority as number) ?? 0,\n    importance: (row.importance as number) ?? 0,\n    sortOrder: (row.sort_order as number) ?? 0,\n    source: row.source as string | null,\n    sourceId: row.source_id as string | null,\n    sourceUrl: row.source_url as string | null,\n    deletedAt: row.deleted_at as string | null,\n    version: (row.version as number) ?? 1,\n  };\n}\n","/**\n * Query Translation and Optimization Layer\n *\n * Routes common React query patterns to optimized native endpoints while maintaining\n * sql.js compatibility for complex queries. Provides intelligent pattern matching\n * and fallback strategies for maximum performance and compatibility.\n */\n\nexport interface QueryAnalysis {\n  sql: string;\n  params: unknown[];\n  patterns: QueryPattern[];\n  complexity: 'simple' | 'complex';\n  canOptimize: boolean;\n  estimatedRows: number;\n  hasJoins: boolean;\n  hasFTS: boolean;\n}\n\nexport interface QueryPattern {\n  type: 'select_nodes' | 'select_notebook_cards' | 'select_search' | 'insert' | 'update' | 'delete' | 'complex';\n  table?: string;\n  filters?: Record<string, unknown>;\n  orderBy?: string;\n  limit?: number;\n  confidence: number; // 0-1, how confident we are in this pattern match\n}\n\nexport interface OptimizedCall {\n  type: 'endpoint';\n  method: 'GET' | 'POST' | 'PUT' | 'DELETE';\n  url: string;\n  body?: unknown;\n  expectedFormat: 'rows' | 'json';\n}\n\nexport interface SQLCall {\n  type: 'sql';\n  sql: string;\n  params: unknown[];\n}\n\nexport type TranslationResult = OptimizedCall | SQLCall;\n\n/**\n * Query Optimizer class for intelligent routing and analysis\n */\nexport class QueryOptimizer {\n  private patterns: Map<RegExp, QueryPattern['type']> = new Map();\n  private performanceThresholds = {\n    maxSimpleRows: 1000,\n    maxComplexityScore: 10,\n    minConfidence: 0.8,\n  };\n\n  constructor() {\n    this.initializePatterns();\n  }\n\n  private initializePatterns(): void {\n    // Common React query patterns with regex matching\n    this.patterns.set(\n      /SELECT\\s+\\*\\s+FROM\\s+nodes\\s+WHERE.*deleted_at\\s+IS\\s+NULL/i,\n      'select_nodes'\n    );\n    this.patterns.set(\n      /SELECT\\s+\\*\\s+FROM\\s+nodes\\s+WHERE.*folder\\s*=\\s*\\?/i,\n      'select_nodes'\n    );\n    this.patterns.set(\n      /SELECT\\s+\\*\\s+FROM\\s+notebook_cards.*ORDER\\s+BY\\s+modified_at/i,\n      'select_notebook_cards'\n    );\n    this.patterns.set(\n      /SELECT.*FROM.*MATCH\\s*\\(/i,\n      'select_search'\n    );\n    this.patterns.set(\n      /INSERT\\s+INTO\\s+nodes/i,\n      'insert'\n    );\n    this.patterns.set(\n      /UPDATE\\s+nodes\\s+SET.*WHERE\\s+id\\s*=\\s*\\?/i,\n      'update'\n    );\n    this.patterns.set(\n      /DELETE\\s+FROM\\s+nodes\\s+WHERE\\s+id\\s*=\\s*\\?/i,\n      'delete'\n    );\n  }\n\n  /**\n   * Analyze SQL query to determine optimization potential\n   */\n  analyzeQuery(sql: string, params: unknown[] = []): QueryAnalysis {\n    const normalizedSQL = sql.trim().replace(/\\s+/g, ' ');\n    const patterns: QueryPattern[] = [];\n    let complexity: 'simple' | 'complex' = 'simple';\n\n    // Pattern matching\n    for (const [regex, type] of this.patterns) {\n      if (regex.test(normalizedSQL)) {\n        patterns.push({\n          type,\n          confidence: this.calculateConfidence(normalizedSQL, type),\n          ...this.extractPatternDetails(normalizedSQL, type, params),\n        });\n      }\n    }\n\n    // Complexity analysis\n    const hasJoins = /\\bJOIN\\b/i.test(normalizedSQL);\n    const hasFTS = /\\bMATCH\\b/i.test(normalizedSQL);\n    const hasSubqueries = /\\(\\s*SELECT/i.test(normalizedSQL);\n    const hasWindow = /\\bOVER\\s*\\(/i.test(normalizedSQL);\n    const hasRecursive = /\\bWITH\\s+RECURSIVE/i.test(normalizedSQL);\n\n    if (hasJoins || hasSubqueries || hasWindow || hasRecursive) {\n      complexity = 'complex';\n    }\n\n    // const _complexityScore = this.calculateComplexityScore(normalizedSQL);\n    const estimatedRows = this.estimateResultSize(normalizedSQL, params);\n\n    return {\n      sql: normalizedSQL,\n      params,\n      patterns,\n      complexity,\n      canOptimize: this.shouldOptimize({\n        sql: normalizedSQL,\n        params,\n        patterns,\n        complexity,\n        canOptimize: false, // Will be set by shouldOptimize\n        estimatedRows,\n        hasJoins,\n        hasFTS,\n      }),\n      estimatedRows,\n      hasJoins,\n      hasFTS,\n    };\n  }\n\n  /**\n   * Determine if query should be optimized based on analysis\n   */\n  shouldOptimize(analysis: QueryAnalysis): boolean {\n    // Don't optimize complex queries\n    if (analysis.complexity === 'complex') {\n      return false;\n    }\n\n    // Must have at least one confident pattern match\n    const bestPattern = analysis.patterns.reduce((best, current) =>\n      current.confidence > (best?.confidence || 0) ? current : best\n    , null as QueryPattern | null);\n\n    if (!bestPattern || bestPattern.confidence < this.performanceThresholds.minConfidence) {\n      return false;\n    }\n\n    // Don't optimize very large result sets\n    if (analysis.estimatedRows > this.performanceThresholds.maxSimpleRows) {\n      return false;\n    }\n\n    // FTS queries should be optimized\n    if (analysis.hasFTS) {\n      return true;\n    }\n\n    // Simple CRUD operations should be optimized\n    return ['select_nodes', 'select_notebook_cards', 'insert', 'update', 'delete'].includes(bestPattern.type);\n  }\n\n  /**\n   * Translate query analysis to optimized endpoint call\n   */\n  translateToEndpoint(analysis: QueryAnalysis): OptimizedCall | null {\n    if (!analysis.canOptimize) {\n      return null;\n    }\n\n    const bestPattern = analysis.patterns.reduce((best, current) =>\n      current.confidence > (best?.confidence || 0) ? current : best\n    , null as QueryPattern | null);\n\n    if (!bestPattern) {\n      return null;\n    }\n\n    switch (bestPattern.type) {\n      case 'select_nodes':\n        return this.buildNodesEndpoint(analysis, bestPattern);\n\n      case 'select_notebook_cards':\n        return this.buildNotebookCardsEndpoint(analysis, bestPattern);\n\n      case 'select_search':\n        return this.buildSearchEndpoint(analysis, bestPattern);\n\n      case 'insert':\n        return this.buildInsertEndpoint(analysis, bestPattern);\n\n      case 'update':\n        return this.buildUpdateEndpoint(analysis, bestPattern);\n\n      case 'delete':\n        return this.buildDeleteEndpoint(analysis, bestPattern);\n\n      default:\n        return null;\n    }\n  }\n\n  /**\n   * Create fallback SQL execution call\n   */\n  fallbackToSQL(sql: string, params: unknown[] = []): SQLCall {\n    return {\n      type: 'sql',\n      sql,\n      params,\n    };\n  }\n\n  private calculateConfidence(sql: string, type: QueryPattern['type']): number {\n    let confidence = 0.5;\n\n    switch (type) {\n      case 'select_nodes':\n        if (sql.includes('deleted_at IS NULL')) confidence += 0.3;\n        if (sql.includes('ORDER BY modified_at')) confidence += 0.2;\n        break;\n\n      case 'select_notebook_cards':\n        if (sql.includes('notebook_cards')) confidence += 0.4;\n        if (sql.includes('ORDER BY')) confidence += 0.1;\n        break;\n\n      case 'select_search':\n        if (sql.includes('MATCH(')) confidence += 0.4;\n        if (sql.includes('fts_')) confidence += 0.1;\n        break;\n\n      case 'insert':\n      case 'update':\n      case 'delete':\n        confidence += 0.3;\n        break;\n    }\n\n    return Math.min(confidence, 1.0);\n  }\n\n  private extractPatternDetails(sql: string, type: QueryPattern['type'], params: unknown[]): Partial<QueryPattern> {\n    const details: Partial<QueryPattern> = { type };\n\n    // Extract table name\n    const tableMatch = sql.match(/FROM\\s+(\\w+)/i);\n    if (tableMatch) {\n      details.table = tableMatch[1];\n    }\n\n    // Extract filters from WHERE clause\n    if (sql.includes('folder =') && params.length > 0) {\n      details.filters = { folder: params[0] };\n    }\n\n    // Extract ORDER BY\n    const orderMatch = sql.match(/ORDER\\s+BY\\s+([\\w_]+)/i);\n    if (orderMatch) {\n      details.orderBy = orderMatch[1];\n    }\n\n    // Extract LIMIT\n    const limitMatch = sql.match(/LIMIT\\s+(\\d+)/i);\n    if (limitMatch) {\n      details.limit = parseInt(limitMatch[1], 10);\n    }\n\n    return details;\n  }\n\n  private calculateComplexityScore(sql: string): number {\n    let score = 0;\n\n    if (/\\bJOIN\\b/i.test(sql)) score += 3;\n    if (/\\bUNION\\b/i.test(sql)) score += 2;\n    if (/\\(\\s*SELECT/i.test(sql)) score += 3;\n    if (/\\bWITH\\b/i.test(sql)) score += 4;\n    if (/\\bOVER\\s*\\(/i.test(sql)) score += 3;\n    if (/\\bCASE\\s+WHEN/i.test(sql)) score += 1;\n\n    return score;\n  }\n\n  private estimateResultSize(sql: string, _params: unknown[]): number {\n    // Simple heuristic estimation\n    if (sql.includes('LIMIT')) {\n      const limitMatch = sql.match(/LIMIT\\s+(\\d+)/i);\n      return limitMatch ? parseInt(limitMatch[1], 10) : 100;\n    }\n\n    if (sql.includes('WHERE id =')) {\n      return 1;\n    }\n\n    if (sql.includes('WHERE folder =')) {\n      return 50;\n    }\n\n    if (sql.includes('MATCH(')) {\n      return 25;\n    }\n\n    return 100; // Default estimate\n  }\n\n  private buildNodesEndpoint(analysis: QueryAnalysis, pattern: QueryPattern): OptimizedCall {\n    const queryParams = new URLSearchParams();\n\n    if (pattern.filters?.folder) {\n      queryParams.set('folder', String(pattern.filters.folder));\n    }\n\n    if (pattern.orderBy) {\n      queryParams.set('sort', pattern.orderBy);\n    }\n\n    if (pattern.limit) {\n      queryParams.set('limit', String(pattern.limit));\n    }\n\n    const url = `/api/nodes${queryParams.toString() ? '?' + queryParams.toString() : ''}`;\n\n    return {\n      type: 'endpoint',\n      method: 'GET',\n      url,\n      expectedFormat: 'rows',\n    };\n  }\n\n  private buildNotebookCardsEndpoint(analysis: QueryAnalysis, pattern: QueryPattern): OptimizedCall {\n    const queryParams = new URLSearchParams();\n\n    if (pattern.filters?.folder) {\n      queryParams.set('folder', String(pattern.filters.folder));\n    }\n\n    if (pattern.orderBy) {\n      queryParams.set('sort', pattern.orderBy);\n    }\n\n    if (pattern.limit) {\n      queryParams.set('limit', String(pattern.limit));\n    }\n\n    const url = `/api/notebook-cards${queryParams.toString() ? '?' + queryParams.toString() : ''}`;\n\n    return {\n      type: 'endpoint',\n      method: 'GET',\n      url,\n      expectedFormat: 'rows',\n    };\n  }\n\n  private buildSearchEndpoint(analysis: QueryAnalysis, pattern: QueryPattern): OptimizedCall {\n    // Extract search query from MATCH() clause\n    const matchPattern = /MATCH\\s*\\(\\s*(['\"])(.*?)\\1\\s*\\)/i;\n    const match = analysis.sql.match(matchPattern);\n    const query = match ? match[2] : analysis.params[0]?.toString() || '';\n\n    const queryParams = new URLSearchParams();\n    queryParams.set('q', query);\n\n    if (pattern.limit) {\n      queryParams.set('limit', String(pattern.limit));\n    }\n\n    return {\n      type: 'endpoint',\n      method: 'GET',\n      url: `/api/search?${queryParams.toString()}`,\n      expectedFormat: 'rows',\n    };\n  }\n\n  private buildInsertEndpoint(analysis: QueryAnalysis, pattern: QueryPattern): OptimizedCall {\n    return {\n      type: 'endpoint',\n      method: 'POST',\n      url: `/api/${pattern.table}`,\n      body: this.extractInsertData(analysis),\n      expectedFormat: 'json',\n    };\n  }\n\n  private buildUpdateEndpoint(analysis: QueryAnalysis, pattern: QueryPattern): OptimizedCall {\n    const id = this.extractIdFromParams(analysis.params);\n    return {\n      type: 'endpoint',\n      method: 'PUT',\n      url: `/api/${pattern.table}/${id}`,\n      body: this.extractUpdateData(analysis),\n      expectedFormat: 'json',\n    };\n  }\n\n  private buildDeleteEndpoint(analysis: QueryAnalysis, pattern: QueryPattern): OptimizedCall {\n    const id = this.extractIdFromParams(analysis.params);\n    return {\n      type: 'endpoint',\n      method: 'DELETE',\n      url: `/api/${pattern.table}/${id}`,\n      expectedFormat: 'json',\n    };\n  }\n\n  private extractInsertData(analysis: QueryAnalysis): Record<string, unknown> {\n    // Simple extraction - would need more sophisticated parsing for production\n    return Object.fromEntries(\n      analysis.params.map((param, index) => [`field_${index}`, param])\n    );\n  }\n\n  private extractUpdateData(analysis: QueryAnalysis): Record<string, unknown> {\n    // Simple extraction - would need more sophisticated parsing for production\n    const params = analysis.params.slice(0, -1); // Last param is usually the ID\n    return Object.fromEntries(\n      params.map((param, index) => [`field_${index}`, param])\n    );\n  }\n\n  private extractIdFromParams(params: unknown[]): string {\n    // ID is typically the last parameter in UPDATE/DELETE queries\n    return String(params[params.length - 1] || '');\n  }\n}\n\n/**\n * Main translation function - analyze and route query optimally\n */\nexport function translateQuery(sql: string, params: unknown[] = []): TranslationResult {\n  const optimizer = new QueryOptimizer();\n  const analysis = optimizer.analyzeQuery(sql, params);\n\n  if (process.env.NODE_ENV === 'development') {\n    console.log('Query Analysis:', {\n      sql: sql.substring(0, 100) + (sql.length > 100 ? '...' : ''),\n      canOptimize: analysis.canOptimize,\n      complexity: analysis.complexity,\n      patterns: analysis.patterns.map(p => ({ type: p.type, confidence: p.confidence })),\n    });\n  }\n\n  if (analysis.canOptimize) {\n    const optimized = optimizer.translateToEndpoint(analysis);\n    if (optimized) {\n      return optimized;\n    }\n  }\n\n  return optimizer.fallbackToSQL(sql, params);\n}\n\n/**\n * Convenience function to check if query should be optimized\n */\nexport function shouldOptimize(sql: string, params: unknown[] = []): boolean {\n  const optimizer = new QueryOptimizer();\n  const analysis = optimizer.analyzeQuery(sql, params);\n  return analysis.canOptimize;\n}\n\n/**\n * Export the main optimizer instance for advanced usage\n */\nexport const queryOptimizer = new QueryOptimizer();","// ============================================================================\n// Cache Invalidation System\n// ============================================================================\n// Centralized cache invalidation with dependency tracking and tagging\n// ============================================================================\n\nimport React, { useContext, createContext, useCallback, useRef, useEffect, ReactNode } from 'react';\n\n// Cache invalidation tags for different data types\nexport type CacheTag =\n  | 'nodes'           // All node data\n  | 'notebook_cards'  // All notebook card data\n  | 'search'          // All search results\n  | 'metadata'        // Schema and metadata\n  | `nodes:${string}` // Specific node folder\n  | `node:${string}`  // Specific node ID\n  | `card:${string}`  // Specific card ID\n  | string;           // Custom tags\n\n// Function to invalidate cache for specific tags\ntype InvalidateFn = (tags: CacheTag[]) => void;\n\n// Function to register a query with specific tags\ntype RegisterFn = (tags: CacheTag[], _refetch: () => void) => () => void; // Returns cleanup function\n\ninterface CacheInvalidationContextType {\n  invalidate: InvalidateFn;\n  register: RegisterFn;\n}\n\nconst CacheInvalidationContext = createContext<CacheInvalidationContextType | null>(null);\n\n/**\n * Provider component for cache invalidation system\n */\nexport function CacheInvalidationProvider({ children }: { children: ReactNode }) {\n  // Map of tags to registered refetch functions\n  const tagsToRefetch = useRef<Map<CacheTag, Set<() => void>>>(new Map());\n\n  const register = useCallback<RegisterFn>((tags, refetch) => {\n    // Register the refetch function for each tag\n    tags.forEach(tag => {\n      if (!tagsToRefetch.current.has(tag)) {\n        tagsToRefetch.current.set(tag, new Set());\n      }\n      tagsToRefetch.current.get(tag)!.add(refetch);\n    });\n\n    // Return cleanup function\n    return () => {\n      tags.forEach(tag => {\n        const refetchSet = tagsToRefetch.current.get(tag);\n        if (refetchSet) {\n          refetchSet.delete(refetch);\n          if (refetchSet.size === 0) {\n            tagsToRefetch.current.delete(tag);\n          }\n        }\n      });\n    };\n  }, []);\n\n  const invalidate = useCallback<InvalidateFn>((tags) => {\n    const refetchFunctions = new Set<() => void>();\n\n    // Collect all refetch functions for the given tags\n    tags.forEach(tag => {\n      const refetchSet = tagsToRefetch.current.get(tag);\n      if (refetchSet) {\n        refetchSet.forEach(fn => refetchFunctions.add(fn));\n      }\n    });\n\n    // Execute all unique refetch functions\n    refetchFunctions.forEach(refetch => {\n      try {\n        refetch();\n      } catch (error) {\n        console.error('Error during cache invalidation:', error);\n      }\n    });\n\n    if (import.meta.env.DEV && refetchFunctions.size > 0) {\n      console.log('Cache invalidation:', {\n        tags,\n        refetchCount: refetchFunctions.size\n      });\n    }\n  }, []);\n\n  return (\n    <CacheInvalidationContext.Provider value={{ invalidate, register }}>\n      {children}\n    </CacheInvalidationContext.Provider>\n  );\n}\n\n/**\n * Hook to access cache invalidation functions\n */\nexport function useCacheInvalidation() {\n  const context = useContext(CacheInvalidationContext);\n  if (!context) {\n    throw new Error('useCacheInvalidation must be used within CacheInvalidationProvider');\n  }\n  return context;\n}\n\n/**\n * Hook to register a query for cache invalidation with specific tags\n * @param tags Array of cache tags this query depends on\n * @param refetch Function to refetch the query data\n */\nexport function useQueryCacheRegistration(tags: CacheTag[], _refetch: () => void) {\n  const { register } = useCacheInvalidation();\n\n  const currentRefetch = useRef(refetch);\n  const cleanupRef = useRef<(() => void) | null>(null);\n  const lastTagsRef = useRef<string>('');\n\n  currentRefetch.current = refetch;\n\n  // Stable refetch function that always calls the latest refetch\n  const stableRefetch = useCallback(() => {\n    currentRefetch.current();\n  }, []);\n\n  // Create a stable tags key for comparison\n  const tagsKey = JSON.stringify(tags.slice().sort());\n\n  // Register/re-register only when tags change\n  if (lastTagsRef.current !== tagsKey) {\n    // Cleanup previous registration\n    if (cleanupRef.current) {\n      cleanupRef.current();\n      cleanupRef.current = null;\n    }\n\n    // Register with new tags (only if we have tags)\n    if (tags.length > 0) {\n      cleanupRef.current = register(tags, stableRefetch);\n    }\n\n    lastTagsRef.current = tagsKey;\n  }\n\n  // Cleanup on unmount\n  useEffect(() => {\n    return () => {\n      if (cleanupRef.current) {\n        cleanupRef.current();\n        cleanupRef.current = null;\n      }\n    };\n  }, []); // Empty dependency array - only run on mount/unmount\n}\n\n/**\n * Utility functions to generate cache tags for common patterns\n */\nexport const CacheTags = {\n  allNodes: (): CacheTag[] => ['nodes'],\n  allCards: (): CacheTag[] => ['notebook_cards'],\n  allSearch: (): CacheTag[] => ['search'],\n  allMetadata: (): CacheTag[] => ['metadata'],\n\n  nodesByFolder: (folder?: string): CacheTag[] =>\n    folder ? ['nodes', `nodes:${folder}`] : ['nodes'],\n\n  specificNode: (id: string): CacheTag[] =>\n    ['nodes', `node:${id}`],\n\n  specificCard: (id: string): CacheTag[] =>\n    ['notebook_cards', `card:${id}`],\n\n  searchResults: (query?: string): CacheTag[] =>\n    query ? ['search', `search:${query}`] : ['search'],\n\n  // Mutation-triggered invalidations\n  nodeCreated: (folder?: string): CacheTag[] => [\n    'nodes',\n    'search',\n    ...(folder ? [`nodes:${folder}`] : [])\n  ],\n\n  nodeUpdated: (id: string, folder?: string): CacheTag[] => [\n    'nodes',\n    'search',\n    `node:${id}`,\n    ...(folder ? [`nodes:${folder}`] : [])\n  ],\n\n  nodeDeleted: (id: string, folder?: string): CacheTag[] => [\n    'nodes',\n    'search',\n    `node:${id}`,\n    ...(folder ? [`nodes:${folder}`] : [])\n  ],\n\n  cardCreated: (): CacheTag[] => [\n    'notebook_cards',\n    'search'\n  ],\n\n  cardUpdated: (id: string): CacheTag[] => [\n    'notebook_cards',\n    'search',\n    `card:${id}`\n  ],\n\n  cardDeleted: (id: string): CacheTag[] => [\n    'notebook_cards',\n    'search',\n    `card:${id}`\n  ]\n};","import { useState, useEffect, useCallback, useRef, useMemo } from 'react';\nimport { useDatabase } from '../db/DatabaseContext';\nimport { rowToNode, Node } from '../types/node';\nimport { translateQuery, OptimizedCall, SQLCall } from '../db/QueryTranslation';\nimport { useQueryCacheRegistration, CacheTags, type CacheTag } from './useCacheInvalidation';\n\n// Environment variable detection for API mode\nconst USE_NATIVE_API = import.meta.env.REACT_APP_USE_NATIVE_API === 'true';\n\nexport interface QueryState<T> {\n  data: T[] | null;\n  loading: boolean;\n  error: Error | null;\n  refetch: () => void;\n  optimized?: boolean; // True if query used optimized endpoint\n  duration?: number; // Query execution time in milliseconds\n}\n\ninterface QueryOptions<T> {\n  enabled?: boolean;\n  transform?: (rows: Record<string, unknown>[]) => T[];\n  cacheTags?: CacheTag[];\n}\n\nexport function useSQLiteQuery<T = Record<string, unknown>>(\n  sql: string,\n  params: unknown[] = [],\n  options: QueryOptions<T> = {}\n): QueryState<T> {\n  const { execute, loading: dbLoading, error: dbError } = useDatabase();\n  const { enabled = true, transform, cacheTags } = options;\n\n  const [data, setData] = useState<T[] | null>(null);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<Error | null>(null);\n  const [optimized, setOptimized] = useState<boolean>(false);\n  const [duration, setDuration] = useState<number>(0);\n\n  // Use refs to store stable references and avoid infinite loops\n  const transformRef = useRef(transform);\n  transformRef.current = transform;\n\n  // Memoize params string to avoid re-renders\n  const paramsKey = useMemo(() => JSON.stringify(params), [params]);\n\n  const fetchData = useCallback(async () => {\n    if (!enabled || dbLoading) return;\n\n    setLoading(true);\n    setError(null);\n    setOptimized(false);\n    setDuration(0);\n\n    const startTime = performance.now();\n\n    try {\n      let rows: Record<string, unknown>[];\n      let wasOptimized = false;\n\n      if (USE_NATIVE_API) {\n        // Try to optimize the query first\n        const translation = translateQuery(sql, params);\n\n        if (translation.type === 'endpoint') {\n          // Use optimized endpoint\n          const apiCall = translation as OptimizedCall;\n          const response = await fetch(`http://localhost:8080${apiCall.url}`, {\n            method: apiCall.method,\n            headers: apiCall.body ? { 'Content-Type': 'application/json' } : undefined,\n            body: apiCall.body ? JSON.stringify(apiCall.body) : undefined,\n          });\n\n          if (!response.ok) {\n            throw new Error(`API error: ${response.status}`);\n          }\n\n          const apiResponse = await response.json();\n          rows = apiResponse.success ? apiResponse.data : [];\n          wasOptimized = true;\n        } else {\n          // Fallback to SQL execution\n          const sqlCall = translation as SQLCall;\n          rows = await (execute as (sql: string, params?: unknown[]) => Promise<Record<string, unknown>[]>)(\n            sqlCall.sql,\n            sqlCall.params\n          );\n        }\n      } else {\n        // SQL.js mode - direct execution\n        rows = (execute as (sql: string, params?: unknown[]) => Record<string, unknown>[])(sql, params);\n      }\n\n      const endTime = performance.now();\n      const queryDuration = endTime - startTime;\n\n      const result = transformRef.current ? transformRef.current(rows) : (rows as unknown as T[]);\n      setData(result);\n      setOptimized(wasOptimized);\n      setDuration(queryDuration);\n\n      // Log performance in development mode\n      if (import.meta.env.DEV) {\n        console.log('Query Performance:', {\n          sql: sql.substring(0, 100) + (sql.length > 100 ? '...' : ''),\n          optimized: wasOptimized,\n          duration: `${queryDuration.toFixed(2)}ms`,\n          rowCount: rows.length,\n        });\n      }\n    } catch (err) {\n      setError(err as Error);\n      setData(null);\n    } finally {\n      setLoading(false);\n    }\n  }, [execute, sql, paramsKey, enabled, dbLoading]);\n\n  // Register for cache invalidation (empty array if no cacheTags provided)\n  const finalCacheTags = useMemo(() => cacheTags || [], [cacheTags]);\n  useQueryCacheRegistration(finalCacheTags, fetchData);\n\n  useEffect(() => {\n    fetchData();\n  }, [fetchData]);\n\n  return {\n    data,\n    loading: loading || dbLoading,\n    error: error || dbError,\n    refetch: fetchData,\n    optimized,\n    duration,\n  };\n}\n\n// Transform function defined outside to be stable\nconst nodeTransform = (rows: Record<string, unknown>[]) => rows.map(rowToNode);\n\n// Convenience hook for node queries\nexport function useNodes(\n  whereClause: string = '1=1',\n  params: unknown[] = [],\n  options: Omit<QueryOptions<Node>, 'transform'> = {}\n): QueryState<Node> {\n  const sql = useMemo(() => `\n    SELECT * FROM nodes\n    WHERE ${whereClause} AND deleted_at IS NULL\n    ORDER BY modified_at DESC\n  `, [whereClause]);\n\n  // Add default cache tags for nodes if not provided\n  const cacheTags = useMemo(() =>\n    options.cacheTags || CacheTags.allNodes(),\n    [options.cacheTags]\n  );\n\n  return useSQLiteQuery<Node>(sql, params, {\n    ...options,\n    transform: nodeTransform,\n    cacheTags,\n  });\n}\n","import { useMemo } from 'react';\nimport { useFilters } from '../contexts/FilterContext';\nimport { useNodes, type QueryState } from './useSQLiteQuery';\nimport type { Node } from '../types/node';\n\n/**\n * Hook that combines FilterContext with useNodes to return filtered data.\n * Automatically recompiles SQL when filters change.\n */\nexport function useFilteredNodes(): QueryState<Node> {\n  const { filters: activeFilters } = useFilters();\n\n  // Compile filters to SQL WHERE clause - simplified for basic Filter[]\n  const { whereClause, params } = useMemo(() => {\n    if (activeFilters.length === 0) {\n      return { whereClause: '1=1', params: [] };\n    }\n\n    const conditions: string[] = [];\n    const filterParams: (string | number | boolean)[] = [];\n\n    activeFilters.forEach(filter => {\n      const field = filter.field;\n      const op = filter.operator;\n      const value = filter.value;\n\n      switch (op) {\n        case '=':\n          conditions.push(`${field} = ?`);\n          filterParams.push(value);\n          break;\n        case '!=':\n          conditions.push(`${field} != ?`);\n          filterParams.push(value);\n          break;\n        case '>':\n          conditions.push(`${field} > ?`);\n          filterParams.push(value);\n          break;\n        case '<':\n          conditions.push(`${field} < ?`);\n          filterParams.push(value);\n          break;\n        case 'contains':\n          conditions.push(`${field} LIKE ?`);\n          filterParams.push(`%${value}%`);\n          break;\n        default:\n          conditions.push(`${field} = ?`);\n          filterParams.push(value);\n      }\n    });\n\n    return {\n      whereClause: conditions.join(' AND '),\n      params: filterParams,\n    };\n  }, [activeFilters]);\n\n  // useNodes will append 'AND deleted_at IS NULL', but our compiler\n  // already includes it. We'll adjust to avoid duplication.\n  const adjustedWhereClause = useMemo(() => {\n    // Remove 'deleted_at IS NULL' from our compiled SQL since useNodes adds it\n    return whereClause\n      .replace(/^deleted_at IS NULL\\s*(AND\\s*)?/i, '')\n      .replace(/\\s*AND\\s*deleted_at IS NULL$/i, '')\n      .trim() || '1=1';\n  }, [whereClause]);\n\n  return useNodes(adjustedWhereClause, params);\n}\n\n/**\n * Hook to get filter summary for display\n */\nexport function useFilterSummary(): {\n  activeCount: number;\n  description: string;\n} {\n  const { filters } = useFilters();\n\n  const activeCount = filters.length;\n\n  const description = useMemo(() => {\n    if (filters.length === 0) {\n      return 'no filters';\n    }\n\n    const parts = filters.map(filter =>\n      `${filter.field} ${filter.operator} ${filter.value}`\n    );\n\n    return parts.join(', ');\n  }, [filters]);\n\n  return { activeCount, description };\n}\n","import { useMemo } from 'react';\nimport { usePAFV } from './usePAFV';\nimport { useFilteredNodes } from './useFilteredNodes';\nimport type { Node } from '../types/node';\nimport type { LATCHAxis } from '../types/pafv';\n\nexport interface ListGroup {\n  key: string;\n  label: string;\n  nodes: Node[];\n}\n\nexport interface ListData {\n  groups: ListGroup[] | null;\n  flatNodes: Node[];\n  sortAxis: LATCHAxis | null;\n  sortFacet: string | null;\n  isGrouped: boolean;\n  loading: boolean;\n  error: Error | null;\n}\n\n/**\n * Transform PAFV state into list data structure.\n *\n * - Reads PAFV state to determine sort axis (Y-axis mapping)\n * - Queries SQLite for all nodes with filters applied\n * - Sorts nodes by selected axis facet\n * - If grouping enabled, groups nodes by facet value\n */\nexport function useListData(groupingEnabled: boolean = true): ListData {\n  const { state } = usePAFV();\n\n  // Determine sort axis from PAFV state (use Y-axis mapping for list view)\n  const yMapping = useMemo(() => {\n    return state.mappings.find(m => m.plane === 'y');\n  }, [state.mappings]);\n\n  const sortAxis = yMapping?.axis ?? null;\n  const sortFacet = yMapping?.facet ?? null;\n\n  // Query filtered nodes (integrates with FilterContext)\n  const { data: nodes, loading, error } = useFilteredNodes();\n\n  // Sort nodes by the selected facet\n  const sortedNodes = useMemo(() => {\n    if (!nodes || !sortAxis || !sortFacet) return nodes ?? [];\n\n    const sorted = [...nodes];\n\n    // Sort based on axis type\n    switch (sortAxis) {\n      case 'time':\n        // Sort by time facets (year, month, day, etc.)\n        if (sortFacet === 'year') {\n          sorted.sort((a, b) => {\n            const yearA = new Date(a.createdAt).getFullYear();\n            const yearB = new Date(b.createdAt).getFullYear();\n            return yearB - yearA; // Descending (newest first)\n          });\n        } else if (sortFacet === 'month') {\n          sorted.sort((a, b) => {\n            const dateA = new Date(a.createdAt);\n            const dateB = new Date(b.createdAt);\n            return dateB.getTime() - dateA.getTime();\n          });\n        } else {\n          // Default: sort by createdAt descending\n          sorted.sort((a, b) => new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime());\n        }\n        break;\n\n      case 'category':\n        // Sort by category facets (folder, tag, status)\n        if (sortFacet === 'folder') {\n          sorted.sort((a, b) => (a.folder ?? '').localeCompare(b.folder ?? ''));\n        } else if (sortFacet === 'tag') {\n          sorted.sort((a, b) => {\n            const tagA = a.tags[0] ?? '';\n            const tagB = b.tags[0] ?? '';\n            return tagA.localeCompare(tagB);\n          });\n        } else if (sortFacet === 'status') {\n          sorted.sort((a, b) => (a.status ?? '').localeCompare(b.status ?? ''));\n        }\n        break;\n\n      case 'alphabet':\n        // Sort by name alphabetically\n        sorted.sort((a, b) => a.name.localeCompare(b.name));\n        break;\n\n      case 'hierarchy':\n        // Sort by priority/importance\n        if (sortFacet === 'priority') {\n          sorted.sort((a, b) => a.priority - b.priority);\n        } else if (sortFacet === 'importance') {\n          sorted.sort((a, b) => b.importance - a.importance);\n        }\n        break;\n\n      case 'location':\n        // Sort by location name\n        sorted.sort((a, b) => (a.locationName ?? '').localeCompare(b.locationName ?? ''));\n        break;\n\n      default:\n        // Default: sort by modifiedAt descending\n        sorted.sort((a, b) => new Date(b.modifiedAt).getTime() - new Date(a.modifiedAt).getTime());\n    }\n\n    return sorted;\n  }, [nodes, sortAxis, sortFacet]);\n\n  // Group nodes by facet value if grouping is enabled\n  const groups = useMemo(() => {\n    if (!groupingEnabled || !sortedNodes.length || !sortAxis || !sortFacet) {\n      return null;\n    }\n\n    const groupMap = new Map<string, Node[]>();\n\n    sortedNodes.forEach(node => {\n      let groupKey = 'Uncategorized';\n\n      // Determine group key based on axis and facet\n      switch (sortAxis) {\n        case 'time':\n          if (sortFacet === 'year') {\n            groupKey = new Date(node.createdAt).getFullYear().toString();\n          } else if (sortFacet === 'month') {\n            const date = new Date(node.createdAt);\n            groupKey = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;\n          } else {\n            groupKey = new Date(node.createdAt).toISOString().split('T')[0];\n          }\n          break;\n\n        case 'category':\n          if (sortFacet === 'folder') {\n            groupKey = node.folder ?? 'Uncategorized';\n          } else if (sortFacet === 'tag') {\n            groupKey = node.tags[0] ?? 'Untagged';\n          } else if (sortFacet === 'status') {\n            groupKey = node.status ?? 'No Status';\n          }\n          break;\n\n        case 'alphabet':\n          // Group by first letter\n          groupKey = node.name.charAt(0).toUpperCase();\n          break;\n\n        case 'hierarchy':\n          if (sortFacet === 'priority') {\n            groupKey = `Priority ${node.priority}`;\n          } else if (sortFacet === 'importance') {\n            groupKey = `Importance ${node.importance}`;\n          }\n          break;\n\n        case 'location':\n          groupKey = node.locationName ?? 'No Location';\n          break;\n      }\n\n      if (!groupMap.has(groupKey)) {\n        groupMap.set(groupKey, []);\n      }\n      groupMap.get(groupKey)!.push(node);\n    });\n\n    // Convert map to array of groups, sorted by key\n    return Array.from(groupMap.entries())\n      .map(([key, nodes]) => ({\n        key,\n        label: key,\n        nodes,\n      }))\n      .sort((a, b) => {\n        // For year groups, sort descending (newest first)\n        if (sortAxis === 'time' && sortFacet === 'year') {\n          return b.key.localeCompare(a.key);\n        }\n        // Default: sort ascending\n        return a.key.localeCompare(b.key);\n      });\n  }, [sortedNodes, groupingEnabled, sortAxis, sortFacet]);\n\n  return {\n    groups,\n    flatNodes: sortedNodes,\n    sortAxis,\n    sortFacet,\n    isGrouped: groupingEnabled && groups !== null,\n    loading,\n    error,\n  };\n}\n","import React, { createContext, useContext, useState, useCallback } from 'react';\n\ninterface SelectionState {\n  selectedIds: Set<string>;\n  lastSelectedId: string | null;\n}\n\ninterface SelectionContextValue {\n  selection: SelectionState;\n  select: (id: string) => void;\n  deselect: (id: string) => void;\n  toggle: (id: string) => void;\n  selectMultiple: (ids: string[]) => void;\n  clear: () => void;\n  isSelected: (id: string) => boolean;\n}\n\nconst SelectionContext = createContext<SelectionContextValue | null>(null);\n\nexport function SelectionProvider({ children }: { children: React.ReactNode }) {\n  const [selection, setSelection] = useState<SelectionState>({\n    selectedIds: new Set(),\n    lastSelectedId: null,\n  });\n  \n  const select = useCallback((id: string) => {\n    setSelection(() => ({\n      selectedIds: new Set([id]),\n      lastSelectedId: id,\n    }));\n  }, []);\n  \n  const deselect = useCallback((id: string) => {\n    setSelection(prev => {\n      const newIds = new Set(prev.selectedIds);\n      newIds.delete(id);\n      return { ...prev, selectedIds: newIds };\n    });\n  }, []);\n  \n  const toggle = useCallback((id: string) => {\n    setSelection(prev => {\n      const newIds = new Set(prev.selectedIds);\n      if (newIds.has(id)) {\n        newIds.delete(id);\n      } else {\n        newIds.add(id);\n      }\n      return { selectedIds: newIds, lastSelectedId: id };\n    });\n  }, []);\n  \n  const selectMultiple = useCallback((ids: string[]) => {\n    setSelection({\n      selectedIds: new Set(ids),\n      lastSelectedId: ids[ids.length - 1] ?? null,\n    });\n  }, []);\n  \n  const clear = useCallback(() => {\n    setSelection({ selectedIds: new Set(), lastSelectedId: null });\n  }, []);\n  \n  const isSelected = useCallback((id: string) => {\n    return selection.selectedIds.has(id);\n  }, [selection.selectedIds]);\n  \n  return (\n    <SelectionContext.Provider value={{\n      selection,\n      select,\n      deselect,\n      toggle,\n      selectMultiple,\n      clear,\n      isSelected,\n    }}>\n      {children}\n    </SelectionContext.Provider>\n  );\n}\n\nexport function useSelection(): SelectionContextValue {\n  const context = useContext(SelectionContext);\n  if (!context) {\n    throw new Error('useSelection must be used within SelectionProvider');\n  }\n  return context;\n}\n","import { memo } from 'react';\nimport { Calendar, Tag, Folder } from 'lucide-react';\nimport type { Node } from '../types/node';\n\ninterface ListItemProps {\n  node: Node;\n  onClick?: (node: Node) => void;\n  isSelected?: boolean;\n}\n\n/**\n * Individual list item component for ListView.\n *\n * Features:\n * - Displays node title, body snippet (first 100 chars), created date, tags\n * - Click handler opens Card Overlay (via SelectionContext)\n * - Hover state (subtle background color change)\n * - Compact layout: single line for small items, multi-line for rich content\n */\nexport const ListItem = memo(function ListItem({\n  node,\n  onClick,\n  isSelected = false,\n}: ListItemProps) {\n  const handleClick = () => {\n    onClick?.(node);\n  };\n\n  // Get body snippet (first 100 chars)\n  const bodySnippet = node.content\n    ? node.content.substring(0, 100) + (node.content.length > 100 ? '...' : '')\n    : node.summary\n    ? node.summary.substring(0, 100) + (node.summary.length > 100 ? '...' : '')\n    : '';\n\n  // Format created date\n  const createdDate = new Date(node.createdAt).toLocaleDateString('en-US', {\n    year: 'numeric',\n    month: 'short',\n    day: 'numeric',\n  });\n\n  return (\n    <div\n      onClick={handleClick}\n      className={`\n        list-item\n        px-4 py-3\n        border-b border-gray-200 dark:border-gray-700\n        hover:bg-gray-50 dark:hover:bg-gray-800\n        cursor-pointer\n        transition-colors\n        ${isSelected ? 'bg-blue-50 dark:bg-blue-900/20 border-l-4 border-l-blue-500' : ''}\n      `}\n      role=\"button\"\n      tabIndex={0}\n      aria-label={`Open ${node.name}`}\n      onKeyDown={(e) => {\n        if (e.key === 'Enter' || e.key === ' ') {\n          e.preventDefault();\n          handleClick();\n        }\n      }}\n    >\n      {/* Title */}\n      <div className=\"flex items-start justify-between gap-4 mb-1\">\n        <h3 className=\"font-medium text-sm text-gray-900 dark:text-gray-100 flex-1 truncate\">\n          {node.name}\n        </h3>\n\n        {/* Created Date */}\n        <div className=\"flex items-center gap-1 text-xs text-gray-500 dark:text-gray-400 flex-shrink-0\">\n          <Calendar size={12} />\n          <span>{createdDate}</span>\n        </div>\n      </div>\n\n      {/* Body Snippet (if available) */}\n      {bodySnippet && (\n        <p className=\"text-xs text-gray-600 dark:text-gray-400 mb-2 line-clamp-2\">\n          {bodySnippet}\n        </p>\n      )}\n\n      {/* Metadata Row */}\n      <div className=\"flex items-center gap-3 text-xs text-gray-500 dark:text-gray-400\">\n        {/* Folder */}\n        {node.folder && (\n          <div className=\"flex items-center gap-1\">\n            <Folder size={12} />\n            <span>{node.folder}</span>\n          </div>\n        )}\n\n        {/* Tags */}\n        {node.tags.length > 0 && (\n          <div className=\"flex items-center gap-1\">\n            <Tag size={12} />\n            <span>{node.tags.slice(0, 3).join(', ')}</span>\n            {node.tags.length > 3 && <span>+{node.tags.length - 3}</span>}\n          </div>\n        )}\n\n        {/* Priority (if set) */}\n        {node.priority > 0 && (\n          <div className=\"px-1.5 py-0.5 bg-gray-200 dark:bg-gray-700 rounded text-xs font-medium\">\n            P{node.priority}\n          </div>\n        )}\n\n        {/* Status (if set) */}\n        {node.status && (\n          <div\n            className={`\n              px-1.5 py-0.5 rounded text-xs font-medium\n              ${\n                node.status === 'completed'\n                  ? 'bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-300'\n                  : node.status === 'active'\n                  ? 'bg-blue-100 dark:bg-blue-900/30 text-blue-800 dark:text-blue-300'\n                  : 'bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-300'\n              }\n            `}\n          >\n            {node.status}\n          </div>\n        )}\n      </div>\n    </div>\n  );\n});\n","import { useState, useMemo, useCallback, useRef, useEffect } from 'react';\nimport { VariableSizeList as List } from 'react-window';\nimport { Search, X, ArrowUpDown } from 'lucide-react';\nimport { useListData } from '../../hooks/useListData';\nimport { useSelection } from '../../state/SelectionContext';\nimport { ListItem } from '../ListItem';\nimport type { Node } from '../../types/node';\n\n// Item heights for virtualization\nconst ITEM_HEIGHT = 100; // Regular list item height\nconst GROUP_HEADER_HEIGHT = 44; // Group header height\nconst SEARCH_BAR_HEIGHT = 60; // Search controls height\n\ninterface ListViewProps {\n  data?: Node[]; // Optional: if provided, bypasses useListData hook\n  onNodeClick?: (node: Node) => void;\n}\n\n/**\n * List View - Vertical list alternative to SuperGrid.\n *\n * Features:\n * - React-window virtualization for 10,000+ items\n * - PAFV-based sorting (Y-axis determines order)\n * - Collapsible grouping by facet value\n * - Search/filter controls\n * - Sort direction toggle\n * - Integrates with SelectionContext for Card Overlay\n */\nexport function ListView({ data: externalData, onNodeClick }: ListViewProps) {\n  const { selection, select } = useSelection();\n  const listRef = useRef<List>(null);\n\n  // Search state\n  const [searchQuery, setSearchQuery] = useState('');\n  const [sortAscending, setSortAscending] = useState(false);\n\n  // Grouping enabled by default (can be toggled in MiniNav in Wave 4)\n  const [groupingEnabled, setGroupingEnabled] = useState(true);\n\n  // Get list data from hook (unless external data provided)\n  const hookData = useListData(groupingEnabled);\n  const listData = externalData\n    ? {\n        groups: null,\n        flatNodes: externalData,\n        sortAxis: null,\n        sortFacet: null,\n        isGrouped: false,\n        loading: false,\n        error: null,\n      }\n    : hookData;\n\n  // Filter nodes by search query (debounced in the future, but immediate for now)\n  const filteredNodes = useMemo(() => {\n    if (!searchQuery.trim()) {\n      return listData.flatNodes;\n    }\n\n    const query = searchQuery.toLowerCase();\n    return listData.flatNodes.filter(\n      (node) =>\n        node.name.toLowerCase().includes(query) ||\n        node.content?.toLowerCase().includes(query) ||\n        node.summary?.toLowerCase().includes(query) ||\n        node.tags.some((tag) => tag.toLowerCase().includes(query))\n    );\n  }, [listData.flatNodes, searchQuery]);\n\n  // Sort filtered nodes\n  const sortedNodes = useMemo(() => {\n    const sorted = [...filteredNodes];\n    if (sortAscending) {\n      sorted.reverse();\n    }\n    return sorted;\n  }, [filteredNodes, sortAscending]);\n\n  // Build virtualized list items (groups + nodes)\n  const listItems = useMemo(() => {\n    if (!listData.isGrouped || !listData.groups) {\n      // Flat list (no grouping)\n      return sortedNodes.map((node) => ({\n        type: 'node' as const,\n        node,\n        groupKey: null,\n      }));\n    }\n\n    // Grouped list\n    const items: Array<\n      | { type: 'group'; groupKey: string; label: string; count: number }\n      | { type: 'node'; node: Node; groupKey: string }\n    > = [];\n\n    listData.groups.forEach((group) => {\n      // Filter group nodes by search\n      const groupNodes = group.nodes.filter((node) =>\n        filteredNodes.includes(node)\n      );\n\n      if (groupNodes.length === 0) {\n        return; // Skip empty groups\n      }\n\n      // Add group header\n      items.push({\n        type: 'group',\n        groupKey: group.key,\n        label: group.label,\n        count: groupNodes.length,\n      });\n\n      // Add group nodes\n      groupNodes.forEach((node) => {\n        items.push({\n          type: 'node',\n          node,\n          groupKey: group.key,\n        });\n      });\n    });\n\n    return items;\n  }, [listData, sortedNodes, filteredNodes]);\n\n  // Handle item click\n  const handleItemClick = useCallback(\n    (node: Node) => {\n      select(node.id);\n      onNodeClick?.(node);\n    },\n    [select, onNodeClick]\n  );\n\n  // Get item height for virtualization\n  const getItemSize = (index: number) => {\n    const item = listItems[index];\n    return item.type === 'group' ? GROUP_HEADER_HEIGHT : ITEM_HEIGHT;\n  };\n\n  // Render individual list item\n  const renderItem = ({ index, style }: { index: number; style: React.CSSProperties }) => {\n    const item = listItems[index];\n\n    if (item.type === 'group') {\n      return (\n        <div style={style}>\n          <div className=\"px-4 py-3 bg-gray-100 dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700\">\n            <div className=\"flex items-center justify-between\">\n              <h2 className=\"font-semibold text-sm text-gray-900 dark:text-gray-100\">\n                {item.label}\n              </h2>\n              <span className=\"px-2 py-0.5 text-xs font-medium text-gray-600 dark:text-gray-400 bg-gray-200 dark:bg-gray-700 rounded\">\n                {item.count}\n              </span>\n            </div>\n          </div>\n        </div>\n      );\n    }\n\n    return (\n      <div style={style}>\n        <ListItem\n          node={item.node}\n          onClick={handleItemClick}\n          isSelected={selection.selectedIds.has(item.node.id)}\n        />\n      </div>\n    );\n  };\n\n  // Scroll to top when search changes\n  useEffect(() => {\n    if (listRef.current) {\n      listRef.current.scrollToItem(0, 'start');\n    }\n  }, [searchQuery]);\n\n  // Clear search\n  const clearSearch = () => {\n    setSearchQuery('');\n  };\n\n  // Toggle sort direction\n  const toggleSort = () => {\n    setSortAscending(!sortAscending);\n  };\n\n  // Show loading state\n  if (listData.loading) {\n    return (\n      <div className=\"list-view flex items-center justify-center h-full w-full bg-white dark:bg-gray-900\">\n        <div className=\"text-gray-500 dark:text-gray-400\">Loading filtered notes...</div>\n      </div>\n    );\n  }\n\n  // Show error state\n  if (listData.error) {\n    return (\n      <div className=\"list-view flex items-center justify-center h-full w-full bg-white dark:bg-gray-900\">\n        <div className=\"text-center\">\n          <div className=\"text-red-600 dark:text-red-400 font-medium mb-2\">Error loading notes</div>\n          <div className=\"text-sm text-gray-600 dark:text-gray-400\">{listData.error.message}</div>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"list-view flex flex-col h-full w-full bg-white dark:bg-gray-900\">\n      {/* Search and Sort Controls */}\n      <div\n        className=\"search-controls flex items-center gap-3 px-4 py-3 border-b border-gray-200 dark:border-gray-700\"\n        style={{ height: SEARCH_BAR_HEIGHT }}\n      >\n        {/* Search Input */}\n        <div className=\"flex-1 relative\">\n          <div className=\"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none\">\n            <Search size={16} className=\"text-gray-400\" />\n          </div>\n          <input\n            type=\"text\"\n            value={searchQuery}\n            onChange={(e) => setSearchQuery(e.target.value)}\n            placeholder=\"Search by title, content, or tags...\"\n            className=\"w-full pl-10 pr-10 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100\"\n          />\n          {searchQuery && (\n            <button\n              onClick={clearSearch}\n              className=\"absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-600 dark:hover:text-gray-200\"\n              aria-label=\"Clear search\"\n            >\n              <X size={16} />\n            </button>\n          )}\n        </div>\n\n        {/* Sort Toggle */}\n        <button\n          onClick={toggleSort}\n          className=\"flex items-center gap-2 px-3 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-800 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-md transition-colors\"\n          aria-label={`Sort ${sortAscending ? 'descending' : 'ascending'}`}\n        >\n          <ArrowUpDown size={16} />\n          <span>{sortAscending ? '' : ''}</span>\n        </button>\n\n        {/* Grouping Toggle */}\n        <button\n          onClick={() => setGroupingEnabled(!groupingEnabled)}\n          className={`px-3 py-2 text-sm font-medium rounded-md transition-colors ${\n            groupingEnabled\n              ? 'bg-blue-100 dark:bg-blue-900/30 text-blue-800 dark:text-blue-300'\n              : 'bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700'\n          }`}\n          aria-label={`${groupingEnabled ? 'Disable' : 'Enable'} grouping`}\n        >\n          {groupingEnabled ? 'Grouped' : 'Flat'}\n        </button>\n      </div>\n\n      {/* Virtualized List */}\n      <div className=\"flex-1\">\n        {listItems.length === 0 ? (\n          <div className=\"flex flex-col items-center justify-center h-full text-gray-500 dark:text-gray-400\">\n            <p className=\"text-lg font-medium mb-2\">No notes match these filters</p>\n            <p className=\"text-sm\">Try adjusting your filter criteria or clearing all filters</p>\n          </div>\n        ) : (\n          <List\n            ref={listRef}\n            height={window.innerHeight - SEARCH_BAR_HEIGHT - 100} // Adjust for header/footer\n            itemCount={listItems.length}\n            itemSize={getItemSize}\n            width=\"100%\"\n            overscanCount={5} // Render 5 items above/below viewport for smooth scrolling\n          >\n            {renderItem}\n          </List>\n        )}\n      </div>\n    </div>\n  );\n}\n","import { useMemo } from 'react';\nimport { useTheme } from '@/contexts/ThemeContext';\nimport { usePAFV, type Chip } from '@/contexts/PAFVContext';\nimport type { Node } from '@/types/node';\n\ninterface GridViewProps {\n  data: Node[];\n  onNodeClick?: (node: Node) => void;\n}\n\n// Map chip IDs to Node fields\nconst FIELD_MAP: Record<string, keyof Node> = {\n  folder: 'folder',\n  subfolder: 'status',\n  tags: 'folder',\n  year: 'createdAt',\n  month: 'createdAt',\n  category: 'folder',\n  status: 'status',\n  priority: 'priority',\n};\n\nfunction getFieldValue(node: Node, chipId: string): string {\n  const field = FIELD_MAP[chipId] || 'folder';\n  const value = node[field];\n\n  if (field === 'createdAt' && value) {\n    if (chipId === 'year') {\n      return new Date(value as string).getFullYear().toString();\n    }\n    if (chipId === 'month') {\n      return new Date(value as string).toLocaleString('default', { month: 'short' });\n    }\n  }\n\n  return String(value ?? 'Unknown');\n}\n\n// Get composite key for multiple axes\nfunction getCompositeKey(node: Node, chips: Chip[]): string {\n  return chips.map(chip => getFieldValue(node, chip.id)).join('|');\n}\n\n// Hierarchical header node for nested headers\ninterface HeaderNode {\n  label: string;\n  depth: number;\n  span: number;\n  children: HeaderNode[];\n  path: string[];\n}\n\n// Build hierarchical header structure from data\nfunction buildHeaderTree(data: Node[], chips: Chip[]): HeaderNode {\n  if (chips.length === 0) {\n    return { label: '', depth: 0, span: 1, children: [], path: [] };\n  }\n\n  const root: HeaderNode = { label: 'root', depth: -1, span: 0, children: [], path: [] };\n  const valuePaths = new Map<string, boolean>();\n\n  data.forEach(node => {\n    const values = chips.map(chip => getFieldValue(node, chip.id));\n    valuePaths.set(values.join('|'), true);\n  });\n\n  Array.from(valuePaths.keys()).forEach(pathStr => {\n    const values = pathStr.split('|');\n    let current = root;\n\n    values.forEach((value, depth) => {\n      const path = values.slice(0, depth + 1);\n      let child = current.children.find(c => c.label === value);\n\n      if (!child) {\n        child = { label: value, depth, span: 0, children: [], path };\n        current.children.push(child);\n      }\n      current = child;\n    });\n  });\n\n  function calcSpan(node: HeaderNode): number {\n    if (node.children.length === 0) {\n      node.span = 1;\n    } else {\n      node.span = node.children.reduce((sum, child) => sum + calcSpan(child), 0);\n    }\n    return node.span;\n  }\n  calcSpan(root);\n\n  function sortChildren(node: HeaderNode) {\n    node.children.sort((a, b) => a.label.localeCompare(b.label));\n    node.children.forEach(sortChildren);\n  }\n  sortChildren(root);\n\n  return root;\n}\n\n// Get leaf paths for cell positioning\nfunction getLeafPaths(root: HeaderNode): string[][] {\n  const leaves: string[][] = [];\n\n  function traverse(node: HeaderNode, path: string[]) {\n    if (node.children.length === 0 && node.label !== 'root') {\n      leaves.push(path);\n    } else {\n      node.children.forEach(child => traverse(child, [...path, child.label]));\n    }\n  }\n  traverse(root, []);\n\n  return leaves;\n}\n\n// Flatten header tree by level with position info for CSS Grid\ninterface FlatHeader {\n  label: string;\n  span: number;\n  depth: number;\n  startCol: number; // 1-indexed for CSS grid\n}\n\nfunction flattenForGrid(root: HeaderNode, maxDepth: number): FlatHeader[][] {\n  const levels: FlatHeader[][] = [];\n  for (let d = 0; d < maxDepth; d++) {\n    levels.push([]);\n  }\n\n  function traverse(node: HeaderNode, depth: number, startCol: number): number {\n    if (depth >= 0 && depth < maxDepth) {\n      levels[depth].push({\n        label: node.label,\n        span: node.span,\n        depth,\n        startCol,\n      });\n    }\n\n    let currentCol = startCol;\n    node.children.forEach(child => {\n      currentCol = traverse(child, depth + 1, currentCol);\n    });\n\n    return depth >= 0 ? startCol + node.span : currentCol;\n  }\n\n  traverse(root, -1, 1);\n  return levels;\n}\n\nexport function GridView({ data, onNodeClick }: GridViewProps) {\n  const { theme } = useTheme();\n  const { wells } = usePAFV();\n\n  // Get axis chips from PAFV wells\n  const colChips = wells.columns.length > 0 ? wells.columns : [{ id: 'year', label: 'Year', hasCheckbox: false }];\n  const rowChips = wells.rows.length > 0 ? wells.rows : [{ id: 'folder', label: 'Folder', hasCheckbox: false }];\n\n  // Build hierarchical header structures\n  const { colLeafPaths, rowLeafPaths, grouped, colLevels, rowLevels } = useMemo(() => {\n    const colTree = buildHeaderTree(data, colChips);\n    const rowTree = buildHeaderTree(data, rowChips);\n    const colLeaves = getLeafPaths(colTree);\n    const rowLeaves = getLeafPaths(rowTree);\n    const colLvls = flattenForGrid(colTree, colChips.length);\n    const rowLvls = flattenForGrid(rowTree, rowChips.length);\n\n    const map = new Map<string, Node[]>();\n    data.forEach(node => {\n      const colKey = getCompositeKey(node, colChips);\n      const rowKey = getCompositeKey(node, rowChips);\n      const key = `${colKey}||${rowKey}`;\n      if (!map.has(key)) map.set(key, []);\n      map.get(key)!.push(node);\n    });\n\n    return {\n      colLeafPaths: colLeaves,\n      rowLeafPaths: rowLeaves,\n      grouped: map,\n      colLevels: colLvls,\n      rowLevels: rowLvls,\n    };\n  }, [data, colChips, rowChips]);\n\n  // Grid dimensions\n  const numColHeaders = rowChips.length; // Number of row header columns on the left\n  const numRowHeaders = colChips.length; // Number of column header rows at the top\n  const numDataCols = colLeafPaths.length || 1;\n  const numDataRows = rowLeafPaths.length || 1;\n\n  // Cell styling\n  const headerBg = theme === 'NeXTSTEP' ? 'bg-[#e8e8e8]' : 'bg-gray-100';\n  const headerBorder = theme === 'NeXTSTEP' ? 'border-[#a0a0a0]' : 'border-gray-300';\n  const cellBorder = theme === 'NeXTSTEP' ? 'border-[#c0c0c0]' : 'border-gray-200';\n  const cellBg = theme === 'NeXTSTEP' ? 'bg-white' : 'bg-white';\n\n  // Calculate minimum cell width for proper display\n  const minCellWidth = 100;\n  const rowHeaderWidth = 80;\n  const totalRowHeaderWidth = numColHeaders * rowHeaderWidth;\n\n  return (\n    <div className=\"w-full h-full overflow-auto\">\n      <div\n        className=\"grid\"\n        style={{\n          gridTemplateColumns: `repeat(${numColHeaders}, ${rowHeaderWidth}px) repeat(${numDataCols}, minmax(${minCellWidth}px, 1fr))`,\n          gridTemplateRows: `repeat(${numRowHeaders}, 28px) repeat(${numDataRows}, minmax(40px, 1fr))`,\n          minWidth: totalRowHeaderWidth + (numDataCols * minCellWidth),\n        }}\n      >\n        {/* Top-left corner: empty cells where row headers and column headers meet */}\n        {numColHeaders > 0 && numRowHeaders > 0 && (\n          <div\n            className={`${headerBg} border ${headerBorder}`}\n            style={{\n              gridColumn: `1 / ${numColHeaders + 1}`,\n              gridRow: `1 / ${numRowHeaders + 1}`,\n            }}\n          />\n        )}\n\n        {/* Column headers (horizontal, at top) */}\n        {colLevels.map((level, levelIdx) =>\n          level.map((header, idx) => (\n            <div\n              key={`col-${levelIdx}-${idx}-${header.label}`}\n              className={`${headerBg} border ${headerBorder} flex items-center justify-center text-sm font-medium px-2 truncate`}\n              style={{\n                gridColumn: `${numColHeaders + header.startCol} / span ${header.span}`,\n                gridRow: levelIdx + 1,\n              }}\n              title={header.label}\n            >\n              {header.label}\n            </div>\n          ))\n        )}\n\n        {/* Row headers (vertical, on left) */}\n        {rowLevels.map((level, levelIdx) =>\n          level.map((header, idx) => (\n            <div\n              key={`row-${levelIdx}-${idx}-${header.label}`}\n              className={`${headerBg} border ${headerBorder} flex items-center justify-center text-sm font-medium px-2 truncate`}\n              style={{\n                gridColumn: levelIdx + 1,\n                gridRow: `${numRowHeaders + header.startCol} / span ${header.span}`,\n              }}\n              title={header.label}\n            >\n              {header.label}\n            </div>\n          ))\n        )}\n\n        {/* Data cells */}\n        {colLeafPaths.map((colPath, colIdx) =>\n          rowLeafPaths.map((rowPath, rowIdx) => {\n            const colKey = colPath.join('|');\n            const rowKey = rowPath.join('|');\n            const nodes = grouped.get(`${colKey}||${rowKey}`) || [];\n\n            return (\n              <div\n                key={`cell-${colIdx}-${rowIdx}`}\n                className={`${cellBg} border ${cellBorder} p-1 overflow-hidden`}\n                style={{\n                  gridColumn: numColHeaders + colIdx + 1,\n                  gridRow: numRowHeaders + rowIdx + 1,\n                }}\n              >\n                {nodes.length === 1 ? (\n                  // Single node: fill the cell\n                  <div\n                    className={`w-full h-full flex items-center justify-center cursor-pointer hover:bg-gray-50 text-sm ${\n                      theme === 'NeXTSTEP' ? 'hover:bg-[#f0f0f0]' : ''\n                    }`}\n                    onClick={() => onNodeClick?.(nodes[0])}\n                    title={nodes[0].name}\n                  >\n                    <span className=\"truncate px-1\">{nodes[0].name}</span>\n                  </div>\n                ) : nodes.length > 1 ? (\n                  // Multiple nodes: show count or stack\n                  <div className=\"w-full h-full flex flex-col gap-0.5 overflow-auto\">\n                    {nodes.slice(0, 3).map((node) => (\n                      <div\n                        key={node.id}\n                        className={`flex-shrink-0 px-2 py-1 text-xs cursor-pointer truncate rounded ${\n                          theme === 'NeXTSTEP'\n                            ? 'bg-[#e8e8e8] hover:bg-[#d8d8d8] border border-[#c0c0c0]'\n                            : 'bg-gray-50 hover:bg-gray-100 border border-gray-200'\n                        }`}\n                        onClick={() => onNodeClick?.(node)}\n                        title={node.name}\n                      >\n                        {node.name}\n                      </div>\n                    ))}\n                    {nodes.length > 3 && (\n                      <div className=\"text-xs text-gray-400 text-center\">\n                        +{nodes.length - 3} more\n                      </div>\n                    )}\n                  </div>\n                ) : null}\n              </div>\n            );\n          })\n        )}\n      </div>\n    </div>\n  );\n}\n","import { useEffect, useRef, useMemo } from 'react';\nimport * as d3 from 'd3';\nimport { useTheme } from '@/contexts/ThemeContext';\nimport type { Node } from '@/types/node';\n\ninterface KanbanViewProps {\n  data: Node[];\n  groupBy?: 'status' | 'folder' | 'priority';\n  onNodeClick?: (node: Node) => void;\n}\n\nconst STATUS_ORDER = ['active', 'pending', 'completed', 'archived'];\n\nexport function KanbanView({ data, groupBy = 'status', onNodeClick }: KanbanViewProps) {\n  const containerRef = useRef<HTMLDivElement>(null);\n  const { theme } = useTheme();\n\n  // Group data by the groupBy field\n  const { columns, grouped } = useMemo(() => {\n    const map = new Map<string, Node[]>();\n\n    data.forEach(node => {\n      let value: string;\n      if (groupBy === 'status') {\n        value = node.status || 'Unknown';\n      } else if (groupBy === 'folder') {\n        value = node.folder || 'Unknown';\n      } else {\n        value = String(node.priority);\n      }\n\n      if (!map.has(value)) map.set(value, []);\n      map.get(value)!.push(node);\n    });\n\n    // Sort columns\n    const cols = Array.from(map.keys());\n    if (groupBy === 'status') {\n      cols.sort((a, b) => {\n        const ai = STATUS_ORDER.indexOf(a.toLowerCase());\n        const bi = STATUS_ORDER.indexOf(b.toLowerCase());\n        return (ai === -1 ? 999 : ai) - (bi === -1 ? 999 : bi);\n      });\n    } else if (groupBy === 'priority') {\n      cols.sort((a, b) => Number(a) - Number(b));\n    } else {\n      cols.sort();\n    }\n\n    return { columns: cols, grouped: map };\n  }, [data, groupBy]);\n\n  useEffect(() => {\n    if (!containerRef.current) return;\n\n    const container = d3.select(containerRef.current);\n\n    // Clear and rebuild columns\n    const colWidth = Math.max(200, Math.min(280, containerRef.current.clientWidth / columns.length - 16));\n\n    const columnsSelection = container\n      .selectAll<HTMLDivElement, string>('.kanban-column')\n      .data(columns, d => d)\n      .join(\n        enter => enter\n          .append('div')\n          .attr('class', 'kanban-column')\n          .style('opacity', 0)\n          .call(el => el.transition().duration(300).style('opacity', 1)),\n        update => update,\n        exit => exit.transition().duration(200).style('opacity', 0).remove()\n      );\n\n    columnsSelection\n      .attr('class', `kanban-column flex-shrink-0 ${\n        theme === 'NeXTSTEP'\n          ? 'bg-[#c0c0c0] border-2 border-[#808080]'\n          : 'bg-gray-50 rounded-lg border border-gray-200'\n      }`)\n      .style('width', `${colWidth}px`)\n      .style('min-height', '200px')\n      .style('display', 'flex')\n      .style('flex-direction', 'column');\n\n    columnsSelection.each(function(columnKey) {\n      const column = d3.select(this);\n      const nodes = grouped.get(columnKey) || [];\n\n      // Clear existing content\n      column.selectAll('*').remove();\n\n      // Column header\n      column.append('div')\n        .attr('class', `px-3 py-2 font-medium text-sm ${\n          theme === 'NeXTSTEP'\n            ? 'bg-[#a8a8a8] border-b-2 border-[#707070]'\n            : 'bg-gray-100 border-b border-gray-200 rounded-t-lg'\n        }`)\n        .html(`\n          <div class=\"flex items-center justify-between\">\n            <span>${columnKey}</span>\n            <span class=\"text-xs ${theme === 'NeXTSTEP' ? 'text-[#505050]' : 'text-gray-400'}\">${nodes.length}</span>\n          </div>\n        `);\n\n      // Nodes container\n      const nodesContainer = column.append('div')\n        .attr('class', 'flex-1 p-2 space-y-2 overflow-y-auto')\n        .style('max-height', '400px');\n\n      // Node elements\n      const nodeElements = nodesContainer\n        .selectAll<HTMLDivElement, Node>('.kanban-node')\n        .data(nodes, d => d.id)\n        .join(\n          enter => enter\n            .append('div')\n            .attr('class', 'kanban-node')\n            .style('opacity', 0)\n            .call(el => el.transition().duration(200).style('opacity', 1)),\n          update => update,\n          exit => exit.transition().duration(150).style('opacity', 0).remove()\n        );\n\n      nodeElements\n        .attr('class', `kanban-node cursor-pointer ${\n          theme === 'NeXTSTEP'\n            ? 'bg-[#d4d4d4] border-t-2 border-l-2 border-[#ffffff] border-b-2 border-r-2 border-b-[#707070] border-r-[#707070]'\n            : 'bg-white rounded-lg shadow-sm border border-gray-200 hover:shadow-md transition-shadow'\n        }`)\n        .style('padding', '8px 10px')\n        .on('click', (_event, d) => onNodeClick?.(d));\n\n      nodeElements.each(function(node) {\n        const nodeEl = d3.select(this);\n        nodeEl.selectAll('*').remove();\n\n        // Title\n        nodeEl.append('div')\n          .attr('class', 'font-medium text-sm mb-1 truncate')\n          .attr('title', node.name)\n          .text(node.name);\n\n        // Content preview\n        if (node.content) {\n          nodeEl.append('div')\n            .attr('class', `text-xs mb-2 line-clamp-2 ${\n              theme === 'NeXTSTEP' ? 'text-[#404040]' : 'text-gray-500'\n            }`)\n            .text(node.content.slice(0, 80) + (node.content.length > 80 ? '...' : ''));\n        }\n\n        // Footer with badges\n        const footer = nodeEl.append('div')\n          .attr('class', 'flex items-center gap-2');\n\n        if (groupBy !== 'folder' && node.folder) {\n          footer.append('span')\n            .attr('class', `px-1.5 py-0.5 text-xs rounded ${\n              theme === 'NeXTSTEP' ? 'bg-[#a0a0a0]' : 'bg-blue-100 text-blue-700'\n            }`)\n            .text(node.folder);\n        }\n\n        footer.append('span')\n          .attr('class', `ml-auto text-xs ${\n            theme === 'NeXTSTEP' ? 'text-[#505050]' : 'text-gray-400'\n          }`)\n          .text(`P${node.priority}`);\n      });\n    });\n\n  }, [columns, grouped, theme, groupBy, onNodeClick]);\n\n  return (\n    <div\n      ref={containerRef}\n      className=\"flex gap-4 p-4 overflow-x-auto h-full items-start\"\n    />\n  );\n}\n","import { useEffect, useRef, useMemo } from 'react';\nimport * as d3 from 'd3';\nimport { useTheme } from '@/contexts/ThemeContext';\nimport type { Node } from '@/types/node';\n\ninterface TimelineViewProps {\n  data: Node[];\n  dateField?: 'createdAt' | 'dueAt';\n  onNodeClick?: (node: Node) => void;\n}\n\nexport function TimelineView({ data, dateField = 'createdAt', onNodeClick }: TimelineViewProps) {\n  const svgRef = useRef<SVGSVGElement>(null);\n  const containerRef = useRef<HTMLDivElement>(null);\n  const { theme } = useTheme();\n\n  // Parse dates and filter valid items\n  const timelineData = useMemo(() => {\n    return data\n      .map(node => ({\n        ...node,\n        date: node[dateField] ? new Date(node[dateField]!) : null,\n      }))\n      .filter(node => node.date && !isNaN(node.date.getTime()))\n      .sort((a, b) => a.date!.getTime() - b.date!.getTime());\n  }, [data, dateField]);\n\n  useEffect(() => {\n    if (!svgRef.current || !containerRef.current || !timelineData.length) return;\n\n    const container = containerRef.current;\n    const width = container.clientWidth;\n    const height = container.clientHeight;\n    const margin = { top: 40, right: 40, bottom: 60, left: 60 };\n\n    const svg = d3.select(svgRef.current);\n    svg.selectAll('*').remove();\n\n    // Time scale\n    const dates = timelineData.map(d => d.date!);\n    const xScale = d3.scaleTime()\n      .domain([d3.min(dates)!, d3.max(dates)!])\n      .range([margin.left, width - margin.right])\n      .nice();\n\n    // Folder scale for y-axis (swim lanes)\n    const categories = Array.from(new Set(timelineData.map(d => d.folder || 'Uncategorized')));\n    const yScale = d3.scaleBand()\n      .domain(categories)\n      .range([margin.top, height - margin.bottom])\n      .padding(0.2);\n\n    // Color scale\n    const colorScale = d3.scaleOrdinal<string>()\n      .domain(categories)\n      .range(theme === 'NeXTSTEP'\n        ? ['#808080', '#606060', '#a0a0a0', '#707070', '#909090']\n        : d3.schemeTableau10\n      );\n\n    // Main group\n    const g = svg\n      .attr('width', width)\n      .attr('height', height)\n      .append('g');\n\n    // Add zoom\n    const zoom = d3.zoom<SVGSVGElement, unknown>()\n      .scaleExtent([0.5, 10])\n      .on('zoom', (event) => {\n        const newXScale = event.transform.rescaleX(xScale);\n        xAxisG.call(d3.axisBottom(newXScale).tickFormat(d3.timeFormat('%b %d') as (domainValue: Date | { valueOf(): number }) => string));\n\n        cards.attr('transform', d => {\n          const x = newXScale(d.date!);\n          const y = yScale(d.folder || 'Uncategorized')! + yScale.bandwidth() / 2;\n          return `translate(${x},${y})`;\n        });\n\n        // Update connecting lines\n        g.selectAll('.timeline-line')\n          .attr('x1', margin.left)\n          .attr('x2', width - margin.right);\n      });\n\n    svg.call(zoom);\n\n    // X-axis\n    const xAxisG = g.append('g')\n      .attr('class', 'x-axis')\n      .attr('transform', `translate(0,${height - margin.bottom})`)\n      .call(d3.axisBottom(xScale).tickFormat(d3.timeFormat('%b %d') as (domainValue: Date | { valueOf(): number }) => string));\n\n    xAxisG.selectAll('text')\n      .attr('fill', theme === 'NeXTSTEP' ? '#404040' : '#6b7280');\n    xAxisG.selectAll('line, path')\n      .attr('stroke', theme === 'NeXTSTEP' ? '#808080' : '#d1d5db');\n\n    // Y-axis (category lanes)\n    const yAxisG = g.append('g')\n      .attr('class', 'y-axis')\n      .attr('transform', `translate(${margin.left},0)`)\n      .call(d3.axisLeft(yScale));\n\n    yAxisG.selectAll('text')\n      .attr('fill', theme === 'NeXTSTEP' ? '#404040' : '#6b7280');\n    yAxisG.selectAll('line, path')\n      .attr('stroke', theme === 'NeXTSTEP' ? '#808080' : '#d1d5db');\n\n    // Swim lane lines\n    g.append('g')\n      .attr('class', 'swim-lanes')\n      .selectAll('line')\n      .data(categories)\n      .join('line')\n      .attr('class', 'timeline-line')\n      .attr('x1', margin.left)\n      .attr('x2', width - margin.right)\n      .attr('y1', d => yScale(d)! + yScale.bandwidth() / 2)\n      .attr('y2', d => yScale(d)! + yScale.bandwidth() / 2)\n      .attr('stroke', theme === 'NeXTSTEP' ? '#d0d0d0' : '#e5e7eb')\n      .attr('stroke-width', 1)\n      .attr('stroke-dasharray', '4,4');\n\n    // Nodes\n    const cards = g.append('g')\n      .attr('class', 'nodes')\n      .selectAll<SVGGElement, typeof timelineData[0]>('g')\n      .data(timelineData, d => d.id)\n      .join('g')\n      .attr('class', 'node')\n      .attr('transform', d => {\n        const x = xScale(d.date!);\n        const y = yScale(d.folder || 'Uncategorized')! + yScale.bandwidth() / 2;\n        return `translate(${x},${y})`;\n      })\n      .style('cursor', 'pointer')\n      .on('click', (event, d) => {\n        event.stopPropagation();\n        onNodeClick?.(d);\n      });\n\n    // Node circles\n    cards.append('circle')\n      .attr('r', d => 6 + (6 - d.priority) * 1.5)\n      .attr('fill', d => colorScale(d.folder || 'Uncategorized'))\n      .attr('stroke', theme === 'NeXTSTEP' ? '#404040' : '#6b7280')\n      .attr('stroke-width', 1.5);\n\n    // Card labels\n    cards.append('text')\n      .attr('dy', -12)\n      .attr('text-anchor', 'middle')\n      .attr('class', 'text-xs font-medium')\n      .attr('fill', theme === 'NeXTSTEP' ? '#404040' : '#374151')\n      .text(d => d.name.length > 15 ? d.name.slice(0, 15) + '...' : d.name);\n\n    // Hover effect\n    cards.on('mouseenter', function() {\n      d3.select(this).select('circle')\n        .transition()\n        .duration(150)\n        .attr('stroke-width', 3);\n    }).on('mouseleave', function() {\n      d3.select(this).select('circle')\n        .transition()\n        .duration(150)\n        .attr('stroke-width', 1.5);\n    });\n\n    // Tooltip\n    const tooltip = d3.select(containerRef.current)\n      .append('div')\n      .attr('class', `absolute hidden px-2 py-1 text-xs rounded shadow-lg pointer-events-none ${\n        theme === 'NeXTSTEP' ? 'bg-[#c0c0c0] border border-black' : 'bg-gray-800 text-white'\n      }`)\n      .style('z-index', '50');\n\n    cards.on('mouseenter', function(event, d) {\n      d3.select(this).select('circle')\n        .transition()\n        .duration(150)\n        .attr('stroke-width', 3);\n\n      const dateStr = d.date!.toLocaleDateString();\n      tooltip\n        .html(`<strong>${d.name}</strong><br/>${dateStr}`)\n        .style('left', `${event.offsetX + 10}px`)\n        .style('top', `${event.offsetY - 30}px`)\n        .classed('hidden', false);\n    }).on('mouseleave', function() {\n      d3.select(this).select('circle')\n        .transition()\n        .duration(150)\n        .attr('stroke-width', 1.5);\n      tooltip.classed('hidden', true);\n    });\n\n    return () => {\n      tooltip.remove();\n    };\n  }, [timelineData, theme, onNodeClick]);\n\n  return (\n    <div ref={containerRef} className=\"w-full h-full relative\">\n      <svg ref={svgRef} className=\"w-full h-full\" />\n      {timelineData.length === 0 && data.length > 0 && (\n        <div className=\"absolute inset-0 flex items-center justify-center pointer-events-none\">\n          <div className={`text-sm ${theme === 'NeXTSTEP' ? 'text-[#707070]' : 'text-gray-400'}`}>\n            No valid dates found. Cards need {dateField} dates for timeline view.\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n","import { useEffect, useRef, useMemo, useState } from 'react';\nimport * as d3 from 'd3';\nimport { useTheme } from '@/contexts/ThemeContext';\nimport { ChevronLeft, ChevronRight } from 'lucide-react';\nimport type { Node } from '@/types/node';\n\ninterface CalendarViewProps {\n  data: Node[];\n  dateField?: 'createdAt' | 'dueAt';\n  onNodeClick?: (node: Node) => void;\n}\n\nexport function CalendarView({ data, dateField = 'createdAt', onNodeClick }: CalendarViewProps) {\n  const svgRef = useRef<SVGSVGElement>(null);\n  const containerRef = useRef<HTMLDivElement>(null);\n  const { theme } = useTheme();\n  const [currentMonth, setCurrentMonth] = useState(() => {\n    const now = new Date();\n    return new Date(now.getFullYear(), now.getMonth(), 1);\n  });\n\n  // Group nodes by date\n  const nodesByDate = useMemo(() => {\n    const map = new Map<string, Node[]>();\n    data.forEach(node => {\n      const dateValue = node[dateField];\n      if (dateValue) {\n        const date = new Date(dateValue);\n        if (!isNaN(date.getTime())) {\n          const key = date.toISOString().split('T')[0];\n          if (!map.has(key)) map.set(key, []);\n          map.get(key)!.push(node);\n        }\n      }\n    });\n    return map;\n  }, [data, dateField]);\n\n  // Generate calendar days for current month\n  const calendarDays = useMemo(() => {\n    const year = currentMonth.getFullYear();\n    const month = currentMonth.getMonth();\n    const firstDay = new Date(year, month, 1);\n    const lastDay = new Date(year, month + 1, 0);\n    const startDayOfWeek = firstDay.getDay();\n\n    const days: Array<{ date: Date | null; isCurrentMonth: boolean }> = [];\n\n    // Add days from previous month\n    for (let i = 0; i < startDayOfWeek; i++) {\n      const date = new Date(year, month, -startDayOfWeek + i + 1);\n      days.push({ date, isCurrentMonth: false });\n    }\n\n    // Add days of current month\n    for (let i = 1; i <= lastDay.getDate(); i++) {\n      days.push({ date: new Date(year, month, i), isCurrentMonth: true });\n    }\n\n    // Add days from next month to complete the grid\n    const remaining = 42 - days.length; // 6 weeks * 7 days\n    for (let i = 1; i <= remaining; i++) {\n      days.push({ date: new Date(year, month + 1, i), isCurrentMonth: false });\n    }\n\n    return days;\n  }, [currentMonth]);\n\n  // Color scale\n  const colorScale = useMemo(() => {\n    const folders = Array.from(new Set(data.map(d => d.folder).filter(Boolean))) as string[];\n    return d3.scaleOrdinal<string>()\n      .domain(folders)\n      .range(theme === 'NeXTSTEP'\n        ? ['#808080', '#606060', '#a0a0a0', '#707070', '#909090']\n        : d3.schemeTableau10\n      );\n  }, [data, theme]);\n\n  useEffect(() => {\n    if (!svgRef.current || !containerRef.current) return;\n\n    const container = containerRef.current;\n    const width = container.clientWidth;\n    const height = container.clientHeight - 50; // Leave room for month nav\n    const padding = 4;\n    const cellWidth = (width - padding * 2) / 7;\n    const cellHeight = (height - 30) / 6; // 6 weeks, header row\n\n    const svg = d3.select(svgRef.current);\n    svg.selectAll('*').remove();\n\n    svg\n      .attr('width', width)\n      .attr('height', height);\n\n    const g = svg.append('g')\n      .attr('transform', `translate(${padding}, 0)`);\n\n    // Day headers\n    const dayNames = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];\n    g.append('g')\n      .attr('class', 'day-headers')\n      .selectAll('text')\n      .data(dayNames)\n      .join('text')\n      .attr('x', (_, i) => i * cellWidth + cellWidth / 2)\n      .attr('y', 20)\n      .attr('text-anchor', 'middle')\n      .attr('class', 'text-xs font-medium')\n      .attr('fill', theme === 'NeXTSTEP' ? '#404040' : '#6b7280')\n      .text(d => d);\n\n    // Calendar cells\n    const cells = g.append('g')\n      .attr('class', 'cells')\n      .attr('transform', 'translate(0, 30)')\n      .selectAll<SVGGElement, typeof calendarDays[0]>('g')\n      .data(calendarDays)\n      .join('g')\n      .attr('class', 'cell')\n      .attr('transform', (_, i) => {\n        const col = i % 7;\n        const row = Math.floor(i / 7);\n        return `translate(${col * cellWidth}, ${row * cellHeight})`;\n      });\n\n    // Cell backgrounds\n    cells.append('rect')\n      .attr('width', cellWidth - 2)\n      .attr('height', cellHeight - 2)\n      .attr('rx', theme === 'NeXTSTEP' ? 0 : 4)\n      .attr('fill', d => {\n        if (!d.isCurrentMonth) {\n          return theme === 'NeXTSTEP' ? '#e0e0e0' : '#f9fafb';\n        }\n        return theme === 'NeXTSTEP' ? '#d4d4d4' : '#ffffff';\n      })\n      .attr('stroke', theme === 'NeXTSTEP' ? '#a0a0a0' : '#e5e7eb')\n      .attr('stroke-width', 1);\n\n    // Day numbers\n    cells.append('text')\n      .attr('x', 6)\n      .attr('y', 14)\n      .attr('class', 'text-xs')\n      .attr('fill', d => {\n        if (!d.isCurrentMonth) {\n          return theme === 'NeXTSTEP' ? '#909090' : '#9ca3af';\n        }\n        return theme === 'NeXTSTEP' ? '#404040' : '#374151';\n      })\n      .text(d => d.date?.getDate() ?? '');\n\n    // Nodes in cells\n    cells.each(function(d) {\n      if (!d.date) return;\n      const dateKey = d.date.toISOString().split('T')[0];\n      const dayNodes = nodesByDate.get(dateKey) || [];\n\n      if (dayNodes.length === 0) return;\n\n      const cell = d3.select(this);\n      const maxVisible = Math.floor((cellHeight - 20) / 14);\n      const visibleNodes = dayNodes.slice(0, maxVisible);\n      const hiddenCount = dayNodes.length - maxVisible;\n\n      visibleNodes.forEach((node, i) => {\n        cell.append('rect')\n          .attr('x', 4)\n          .attr('y', 18 + i * 14)\n          .attr('width', cellWidth - 12)\n          .attr('height', 12)\n          .attr('rx', 2)\n          .attr('fill', colorScale(node.folder || 'Uncategorized'))\n          .attr('opacity', 0.8)\n          .style('cursor', 'pointer')\n          .on('click', (event) => {\n            event.stopPropagation();\n            onNodeClick?.(node);\n          })\n          .on('mouseenter', function() {\n            d3.select(this).attr('opacity', 1);\n          })\n          .on('mouseleave', function() {\n            d3.select(this).attr('opacity', 0.8);\n          });\n\n        cell.append('text')\n          .attr('x', 6)\n          .attr('y', 18 + i * 14 + 9)\n          .attr('class', 'text-[9px]')\n          .attr('fill', theme === 'NeXTSTEP' ? '#ffffff' : '#ffffff')\n          .style('pointer-events', 'none')\n          .text(node.name.length > 12 ? node.name.slice(0, 12) + '...' : node.name);\n      });\n\n      if (hiddenCount > 0) {\n        cell.append('text')\n          .attr('x', 6)\n          .attr('y', cellHeight - 6)\n          .attr('class', 'text-[9px]')\n          .attr('fill', theme === 'NeXTSTEP' ? '#606060' : '#9ca3af')\n          .text(`+${hiddenCount} more`);\n      }\n    });\n\n  }, [calendarDays, nodesByDate, theme, colorScale, onNodeClick]);\n\n  const monthName = currentMonth.toLocaleDateString('en-US', { month: 'long', year: 'numeric' });\n\n  const prevMonth = () => {\n    setCurrentMonth(new Date(currentMonth.getFullYear(), currentMonth.getMonth() - 1, 1));\n  };\n\n  const nextMonth = () => {\n    setCurrentMonth(new Date(currentMonth.getFullYear(), currentMonth.getMonth() + 1, 1));\n  };\n\n  return (\n    <div ref={containerRef} className=\"w-full h-full flex flex-col\">\n      {/* Month navigation */}\n      <div className={`h-10 flex items-center justify-between px-4 ${\n        theme === 'NeXTSTEP' ? 'bg-[#c0c0c0]' : 'bg-gray-50'\n      }`}>\n        <button\n          onClick={prevMonth}\n          className={`p-1 ${\n            theme === 'NeXTSTEP'\n              ? 'bg-[#d4d4d4] border-t-2 border-l-2 border-[#ffffff] border-b-2 border-r-2 border-b-[#707070] border-r-[#707070] active:border-t-[#707070] active:border-l-[#707070] active:border-b-[#ffffff] active:border-r-[#ffffff]'\n              : 'hover:bg-gray-200 rounded'\n          }`}\n        >\n          <ChevronLeft className=\"w-4 h-4\" />\n        </button>\n        <span className={`font-medium ${theme === 'NeXTSTEP' ? 'text-[#404040]' : 'text-gray-700'}`}>\n          {monthName}\n        </span>\n        <button\n          onClick={nextMonth}\n          className={`p-1 ${\n            theme === 'NeXTSTEP'\n              ? 'bg-[#d4d4d4] border-t-2 border-l-2 border-[#ffffff] border-b-2 border-r-2 border-b-[#707070] border-r-[#707070] active:border-t-[#707070] active:border-l-[#707070] active:border-b-[#ffffff] active:border-r-[#ffffff]'\n              : 'hover:bg-gray-200 rounded'\n          }`}\n        >\n          <ChevronRight className=\"w-4 h-4\" />\n        </button>\n      </div>\n\n      {/* Calendar grid */}\n      <div className=\"flex-1\">\n        <svg ref={svgRef} className=\"w-full h-full\" />\n      </div>\n    </div>\n  );\n}\n","// Centralized theme constants for Isometry\n// Eliminates inline ternaries throughout the codebase\n\nexport type ThemeName = 'NeXTSTEP' | 'Modern';\n\n// NeXTSTEP theme - retro grayscale with beveled edges\nexport const NEXTSTEP = {\n  // Backgrounds\n  bg: {\n    primary: '#c0c0c0',      // Main panel background\n    secondary: '#d4d4d4',    // Button/input background\n    tertiary: '#b8b8b8',     // Hover state\n    dark: '#a0a0a0',         // Headers, darker areas\n    light: '#e0e0e0',        // Disabled, muted areas\n    raised: '#d4d4d4',       // Raised elements (buttons)\n    sunken: '#b0b0b0',       // Sunken areas\n  },\n  // Borders - beveled effect\n  border: {\n    dark: '#505050',         // Bottom/right of raised, top/left of sunken\n    medium: '#707070',       // General borders\n    light: '#ffffff',        // Top/left of raised, bottom/right of sunken\n    outline: '#808080',      // Outline borders\n    separator: '#a0a0a0',    // Dividers\n  },\n  // Text\n  text: {\n    primary: '#404040',      // Main text\n    secondary: '#606060',    // Muted text\n    disabled: '#909090',     // Disabled state\n    inverse: '#ffffff',      // Text on dark backgrounds\n  },\n  // D3 visualization colors\n  chart: {\n    palette: ['#808080', '#606060', '#a0a0a0', '#707070', '#909090', '#b0b0b0'],\n    axis: '#808080',\n    axisText: '#404040',\n    grid: '#a0a0a0',\n    stroke: '#404040',\n  },\n  // Border radius\n  radius: '0',\n} as const;\n\n// Modern theme - macOS 26 style with translucency\nexport const MODERN = {\n  // Backgrounds\n  bg: {\n    primary: 'white',\n    secondary: 'rgb(249, 250, 251)',  // gray-50\n    tertiary: 'rgb(243, 244, 246)',   // gray-100\n    dark: 'rgb(229, 231, 235)',       // gray-200\n    light: 'rgb(255, 255, 255)',\n    raised: 'white',\n    sunken: 'rgb(249, 250, 251)',\n    blur: 'rgba(255, 255, 255, 0.8)', // For backdrop-blur\n  },\n  // Borders\n  border: {\n    dark: 'rgb(209, 213, 219)',       // gray-300\n    medium: 'rgb(229, 231, 235)',     // gray-200\n    light: 'rgb(243, 244, 246)',      // gray-100\n    outline: 'rgb(209, 213, 219)',\n    separator: 'rgb(229, 231, 235)',\n  },\n  // Text\n  text: {\n    primary: 'rgb(55, 65, 81)',       // gray-700\n    secondary: 'rgb(107, 114, 128)',  // gray-500\n    disabled: 'rgb(156, 163, 175)',   // gray-400\n    inverse: 'white',\n  },\n  // D3 visualization colors (Tableau10)\n  chart: {\n    palette: null, // Use d3.schemeTableau10\n    axis: '#d1d5db',\n    axisText: '#6b7280',\n    grid: '#e5e7eb',\n    stroke: '#6b7280',\n  },\n  // Border radius\n  radius: '0.5rem',\n} as const;\n\n// Theme lookup\nexport const THEMES = {\n  NeXTSTEP: NEXTSTEP,\n  Modern: MODERN,\n} as const;\n\n// Utility to get theme\nexport function getTheme(themeName: ThemeName) {\n  return THEMES[themeName];\n}\n\n// Common Tailwind class patterns for each theme\nexport const TAILWIND_CLASSES = {\n  NeXTSTEP: {\n    // Panels and containers\n    panel: 'bg-[#c0c0c0]',\n    panelBorder: 'border-2 border-[#505050]',\n    panelWithBorder: 'bg-[#c0c0c0] border-2 border-[#505050]',\n\n    // Raised elements (buttons, cards)\n    raised: 'bg-[#d4d4d4] border-t-2 border-l-2 border-[#ffffff] border-b-2 border-r-2 border-b-[#707070] border-r-[#707070]',\n    raisedActive: 'bg-[#d4d4d4] border-t-2 border-l-2 border-[#707070] border-b-2 border-r-2 border-b-[#ffffff] border-r-[#ffffff]',\n\n    // Sunken elements (inputs, wells)\n    sunken: 'bg-[#b0b0b0] border-t-2 border-l-2 border-[#707070] border-b-2 border-r-2 border-b-[#ffffff] border-r-[#ffffff]',\n\n    // Text\n    textPrimary: 'text-[#404040]',\n    textSecondary: 'text-[#606060]',\n    textDisabled: 'text-[#909090]',\n\n    // Interactive states\n    hover: 'hover:bg-[#b8b8b8]',\n    active: 'active:bg-[#a0a0a0]',\n\n    // Headers\n    header: 'bg-[#a8a8a8] border-b-2 border-[#707070]',\n\n    // Badges\n    badge: 'bg-[#a0a0a0]',\n    badgeAlt: 'bg-[#b0b0b0]',\n  },\n  Modern: {\n    // Panels and containers\n    panel: 'bg-white/80 backdrop-blur-xl',\n    panelBorder: 'border border-gray-200',\n    panelWithBorder: 'bg-white/80 backdrop-blur-xl border border-gray-200',\n\n    // Raised elements (buttons, cards)\n    raised: 'bg-white rounded-lg shadow-sm border border-gray-200',\n    raisedActive: 'bg-blue-500 text-white rounded-lg',\n\n    // Sunken elements (inputs, wells)\n    sunken: 'bg-gray-50 rounded-lg border border-gray-200',\n\n    // Text\n    textPrimary: 'text-gray-700',\n    textSecondary: 'text-gray-500',\n    textDisabled: 'text-gray-400',\n\n    // Interactive states\n    hover: 'hover:bg-gray-50',\n    active: 'active:bg-gray-100',\n\n    // Headers\n    header: 'bg-gray-100 border-b border-gray-200 rounded-t-lg',\n\n    // Badges\n    badge: 'bg-blue-100 text-blue-700 rounded',\n    badgeAlt: 'bg-gray-100 text-gray-600 rounded',\n  },\n} as const;\n\n// Helper to get Tailwind classes for a theme\nexport function tw(themeName: ThemeName) {\n  return TAILWIND_CLASSES[themeName];\n}\n","// D3.js utility hooks for Isometry\n// Extracts common D3 patterns into reusable hooks\n\nimport { useMemo } from 'react';\nimport * as d3 from 'd3';\nimport { useTheme } from '@/contexts/ThemeContext';\nimport { getTheme, type ThemeName } from '@/styles/themes';\n\n// ============================================================================\n// Types\n// ============================================================================\n\nexport interface Margins {\n  top: number;\n  right: number;\n  bottom: number;\n  left: number;\n}\n\nexport interface D3Dimensions {\n  width: number;\n  height: number;\n  innerWidth: number;\n  innerHeight: number;\n  margin: Margins;\n}\n\nexport interface D3SVGContext {\n  svg: d3.Selection<SVGSVGElement, unknown, null, undefined>;\n  g: d3.Selection<SVGGElement, unknown, null, undefined>;\n  dimensions: D3Dimensions;\n}\n\n// Default margins\nconst DEFAULT_MARGINS: Margins = { top: 40, right: 20, bottom: 20, left: 100 };\n\n// ============================================================================\n// useD3Dimensions - Calculate dimensions from container\n// ============================================================================\n\nexport function useD3Dimensions(\n  containerRef: React.RefObject<HTMLDivElement>,\n  margin: Partial<Margins> = {}\n): D3Dimensions | null {\n  const finalMargin = { ...DEFAULT_MARGINS, ...margin };\n\n  if (!containerRef.current) return null;\n\n  const width = containerRef.current.clientWidth;\n  const height = containerRef.current.clientHeight;\n  const innerWidth = width - finalMargin.left - finalMargin.right;\n  const innerHeight = height - finalMargin.top - finalMargin.bottom;\n\n  return {\n    width,\n    height,\n    innerWidth,\n    innerHeight,\n    margin: finalMargin,\n  };\n}\n\n// ============================================================================\n// useD3SVG - Initialize SVG with standard setup\n// ============================================================================\n\nexport function initD3SVG(\n  svgRef: React.RefObject<SVGSVGElement>,\n  containerRef: React.RefObject<HTMLDivElement>,\n  margin: Partial<Margins> = {}\n): D3SVGContext | null {\n  if (!svgRef.current || !containerRef.current) return null;\n\n  const finalMargin = { ...DEFAULT_MARGINS, ...margin };\n  const width = containerRef.current.clientWidth;\n  const height = containerRef.current.clientHeight;\n  const innerWidth = width - finalMargin.left - finalMargin.right;\n  const innerHeight = height - finalMargin.top - finalMargin.bottom;\n\n  const svg = d3.select(svgRef.current);\n  svg.selectAll('*').remove();\n  svg.attr('width', width).attr('height', height);\n\n  const g = svg\n    .append('g')\n    .attr('transform', `translate(${finalMargin.left},${finalMargin.top})`);\n\n  return {\n    svg,\n    g,\n    dimensions: {\n      width,\n      height,\n      innerWidth,\n      innerHeight,\n      margin: finalMargin,\n    },\n  };\n}\n\n// ============================================================================\n// useD3ColorScale - Theme-aware color scale\n// ============================================================================\n\nexport function useD3ColorScale(domain: string[]): d3.ScaleOrdinal<string, string> {\n  const { theme } = useTheme();\n  const themeValues = getTheme(theme as ThemeName);\n\n  return useMemo(() => {\n    const scale = d3.scaleOrdinal<string>();\n    scale.domain(domain);\n\n    if (themeValues.chart.palette) {\n      scale.range(themeValues.chart.palette);\n    } else {\n      scale.range(d3.schemeTableau10);\n    }\n\n    return scale;\n  }, [domain, themeValues]);\n}\n\n// Standalone function version for use in useEffect\nexport function createColorScale(\n  domain: string[],\n  theme: ThemeName\n): d3.ScaleOrdinal<string, string> {\n  const themeValues = getTheme(theme);\n  const scale = d3.scaleOrdinal<string>();\n  scale.domain(domain);\n\n  if (themeValues.chart.palette) {\n    scale.range(themeValues.chart.palette);\n  } else {\n    scale.range(d3.schemeTableau10);\n  }\n\n  return scale;\n}\n\n// ============================================================================\n// useD3Zoom - Add zoom behavior to SVG\n// ============================================================================\n\nexport interface ZoomOptions {\n  scaleExtent?: [number, number];\n  translateExtent?: [[number, number], [number, number]];\n  onZoom?: (transform: d3.ZoomTransform) => void;\n}\n\nexport function setupZoom(\n  svg: d3.Selection<SVGSVGElement, unknown, null, undefined>,\n  g: d3.Selection<SVGGElement, unknown, null, undefined>,\n  options: ZoomOptions = {}\n): d3.ZoomBehavior<SVGSVGElement, unknown> {\n  const { scaleExtent = [0.2, 4], translateExtent, onZoom } = options;\n\n  const zoom = d3.zoom<SVGSVGElement, unknown>()\n    .scaleExtent(scaleExtent)\n    .on('zoom', (event) => {\n      g.attr('transform', event.transform);\n      onZoom?.(event.transform);\n    });\n\n  if (translateExtent) {\n    zoom.translateExtent(translateExtent);\n  }\n\n  svg.call(zoom);\n\n  return zoom;\n}\n\n// ============================================================================\n// D3 Axis Styling - Theme-aware axis styling\n// ============================================================================\n\nexport interface AxisStyleOptions {\n  textRotation?: number;\n  textAnchor?: 'start' | 'middle' | 'end';\n}\n\nexport function styleAxis(\n  axisGroup: d3.Selection<SVGGElement, unknown, null, undefined>,\n  theme: ThemeName,\n  options: AxisStyleOptions = {}\n): void {\n  const themeValues = getTheme(theme);\n  const { textRotation, textAnchor } = options;\n\n  axisGroup.selectAll('text')\n    .attr('fill', themeValues.chart.axisText);\n\n  if (textRotation !== undefined) {\n    axisGroup.selectAll('text')\n      .attr('transform', `rotate(${textRotation})`)\n      .attr('text-anchor', textAnchor || 'end');\n  }\n\n  axisGroup.selectAll('line, path')\n    .attr('stroke', themeValues.chart.axis);\n}\n\n// ============================================================================\n// D3 Transitions - Standardized enter/update/exit animations\n// ============================================================================\n\nexport const TRANSITION_DURATIONS = {\n  fast: 150,\n  normal: 200,\n  slow: 300,\n} as const;\n\nexport function transitionEnter<GElement extends d3.BaseType, Datum>(\n  selection: d3.Selection<GElement, Datum, d3.BaseType, unknown>,\n  duration = TRANSITION_DURATIONS.slow\n): d3.Transition<GElement, Datum, d3.BaseType, unknown> {\n  return selection\n    .style('opacity', 0)\n    .transition()\n    .duration(duration)\n    .style('opacity', 1);\n}\n\nexport function transitionExit<GElement extends d3.BaseType, Datum>(\n  selection: d3.Selection<GElement, Datum, d3.BaseType, unknown>,\n  duration = TRANSITION_DURATIONS.normal\n): d3.Transition<GElement, Datum, d3.BaseType, unknown> {\n  return selection\n    .transition()\n    .duration(duration)\n    .style('opacity', 0)\n    .remove();\n}\n\nexport function transitionUpdate<GElement extends d3.BaseType, Datum>(\n  selection: d3.Selection<GElement, Datum, d3.BaseType, unknown>,\n  duration = TRANSITION_DURATIONS.normal\n): d3.Transition<GElement, Datum, d3.BaseType, unknown> {\n  return selection\n    .transition()\n    .duration(duration);\n}\n\n// ============================================================================\n// D3 Event Handlers - Common interaction patterns\n// ============================================================================\n\nexport function setupHoverEffect<GElement extends d3.BaseType, Datum>(\n  selection: d3.Selection<GElement, Datum, d3.BaseType, unknown>,\n  options: {\n    hoverOpacity?: number;\n    normalOpacity?: number;\n    scale?: number;\n  } = {}\n): void {\n  const { hoverOpacity = 0.8, normalOpacity = 1, scale } = options;\n\n  selection\n    .on('mouseenter', function () {\n      const el = d3.select(this);\n      el.attr('opacity', hoverOpacity);\n      if (scale) {\n        el.attr('transform', function () {\n          const current = d3.select(this).attr('transform') || '';\n          return `${current} scale(${scale})`;\n        });\n      }\n    })\n    .on('mouseleave', function () {\n      const el = d3.select(this);\n      el.attr('opacity', normalOpacity);\n      if (scale) {\n        el.attr('transform', function () {\n          const current = d3.select(this).attr('transform') || '';\n          return current.replace(/\\s*scale\\([^)]+\\)/, '');\n        });\n      }\n    });\n}\n\n// ============================================================================\n// D3 Grid Lines - Theme-aware grid\n// ============================================================================\n\nexport function drawGridLines(\n  g: d3.Selection<SVGGElement, unknown, null, undefined>,\n  options: {\n    xScale?: d3.ScaleBand<string> | d3.ScaleLinear<number, number> | d3.ScaleTime<number, number>;\n    yScale?: d3.ScaleBand<string> | d3.ScaleLinear<number, number>;\n    width: number;\n    height: number;\n    theme: ThemeName;\n  }\n): void {\n  const { xScale, yScale, width, height, theme } = options;\n  const themeValues = getTheme(theme);\n\n  // Horizontal grid lines\n  if (yScale && 'ticks' in yScale) {\n    g.append('g')\n      .attr('class', 'grid-lines-h')\n      .selectAll('line')\n      .data((yScale as d3.ScaleLinear<number, number>).ticks())\n      .join('line')\n      .attr('x1', 0)\n      .attr('x2', width)\n      .attr('y1', d => (yScale as d3.ScaleLinear<number, number>)(d))\n      .attr('y2', d => (yScale as d3.ScaleLinear<number, number>)(d))\n      .attr('stroke', themeValues.chart.grid)\n      .attr('stroke-width', 1)\n      .attr('stroke-dasharray', '2,2');\n  }\n\n  // Vertical grid lines\n  if (xScale && 'ticks' in xScale) {\n    g.append('g')\n      .attr('class', 'grid-lines-v')\n      .selectAll('line')\n      .data((xScale as d3.ScaleLinear<number, number>).ticks())\n      .join('line')\n      .attr('x1', d => (xScale as d3.ScaleLinear<number, number>)(d))\n      .attr('x2', d => (xScale as d3.ScaleLinear<number, number>)(d))\n      .attr('y1', 0)\n      .attr('y2', height)\n      .attr('stroke', themeValues.chart.grid)\n      .attr('stroke-width', 1)\n      .attr('stroke-dasharray', '2,2');\n  }\n}\n\n// ============================================================================\n// D3 Tooltip - Basic tooltip utilities (for future use)\n// ============================================================================\n\nexport function createTooltip(\n  container: d3.Selection<HTMLDivElement, unknown, null, undefined>,\n  theme: ThemeName\n): d3.Selection<HTMLDivElement, unknown, null, undefined> {\n  const themeValues = getTheme(theme);\n\n  return container\n    .append('div')\n    .attr('class', 'tooltip')\n    .style('position', 'absolute')\n    .style('visibility', 'hidden')\n    .style('background', theme === 'NeXTSTEP' ? '#d4d4d4' : 'white')\n    .style('border', theme === 'NeXTSTEP' ? '2px solid #707070' : '1px solid #e5e7eb')\n    .style('border-radius', theme === 'NeXTSTEP' ? '0' : '0.5rem')\n    .style('padding', '0.5rem')\n    .style('font-size', '0.75rem')\n    .style('color', themeValues.text.primary)\n    .style('box-shadow', '0 2px 4px rgba(0,0,0,0.1)')\n    .style('pointer-events', 'none')\n    .style('z-index', '1000');\n}\n\nexport function showTooltip(\n  tooltip: d3.Selection<HTMLDivElement, unknown, null, undefined>,\n  content: string,\n  event: MouseEvent\n): void {\n  tooltip\n    .style('visibility', 'visible')\n    .html(content)\n    .style('left', `${event.pageX + 10}px`)\n    .style('top', `${event.pageY - 10}px`);\n}\n\nexport function hideTooltip(\n  tooltip: d3.Selection<HTMLDivElement, unknown, null, undefined>\n): void {\n  tooltip.style('visibility', 'hidden');\n}\n","import { useEffect, useRef, useMemo, useState } from 'react';\nimport * as d3 from 'd3';\nimport { useTheme } from '@/contexts/ThemeContext';\nimport { usePanelTheme, useInputTheme, useTextTheme } from '@/hooks/useComponentTheme';\nimport { createColorScale, styleAxis, setupHoverEffect } from '@/d3/hooks';\nimport { getTheme, type ThemeName } from '@/styles/themes';\nimport type { Node } from '@/types/node';\nimport type {\n  D3SVGSelection,\n  D3PieGenerator,\n  D3ColorScale\n} from '@/types/d3';\n\ninterface ChartsViewProps {\n  data: Node[];\n  onNodeClick?: (node: Node) => void;\n}\n\ntype ChartType = 'bar' | 'pie' | 'treemap';\ntype GroupBy = 'folder' | 'status' | 'priority';\n\nexport function ChartsView({ data, onNodeClick }: ChartsViewProps) {\n  const svgRef = useRef<SVGSVGElement>(null);\n  const containerRef = useRef<HTMLDivElement>(null);\n  const { theme } = useTheme();\n  const panelTheme = usePanelTheme();\n  const inputTheme = useInputTheme();\n  const textTheme = useTextTheme();\n  const [chartType, setChartType] = useState<ChartType>('bar');\n  const [groupBy, setGroupBy] = useState<GroupBy>('folder');\n\n  // Group data\n  const groupedData = useMemo(() => {\n    const groups = new Map<string, Node[]>();\n    data.forEach(node => {\n      let key: string;\n      if (groupBy === 'priority') {\n        key = `Priority ${node.priority}`;\n      } else {\n        key = node[groupBy] || 'Unknown';\n      }\n      if (!groups.has(key)) groups.set(key, []);\n      groups.get(key)!.push(node);\n    });\n    return Array.from(groups.entries())\n      .map(([name, nodes]) => ({ name, count: nodes.length, nodes }))\n      .sort((a, b) => b.count - a.count);\n  }, [data, groupBy]);\n\n  // Color scale using utility\n  const colorScale = useMemo(() => {\n    const domain = groupedData.map(d => d.name);\n    return createColorScale(domain, theme as ThemeName);\n  }, [groupedData, theme]);\n\n  useEffect(() => {\n    if (!svgRef.current || !containerRef.current || !groupedData.length) return;\n\n    const container = containerRef.current;\n    const width = container.clientWidth;\n    const height = container.clientHeight - 50; // Leave room for controls\n    const margin = { top: 40, right: 40, bottom: 60, left: 60 };\n    const themeValues = getTheme(theme as ThemeName);\n\n    const svg = d3.select(svgRef.current);\n    svg.selectAll('*').remove();\n    svg.attr('width', width).attr('height', height);\n\n    if (chartType === 'bar') {\n      renderBarChart(svg, groupedData, width, height, margin, colorScale, theme as ThemeName, themeValues, onNodeClick);\n    } else if (chartType === 'pie') {\n      renderPieChart(svg, groupedData, width, height, colorScale, theme as ThemeName, themeValues, onNodeClick);\n    } else if (chartType === 'treemap') {\n      renderTreemap(svg, groupedData, width, height, colorScale, theme as ThemeName, themeValues, onNodeClick);\n    }\n\n  }, [groupedData, chartType, theme, colorScale, onNodeClick]);\n\n  return (\n    <div ref={containerRef} className=\"w-full h-full flex flex-col\">\n      {/* Chart controls */}\n      <div className={`h-12 flex items-center gap-4 px-4 ${panelTheme.section}`}>\n        <div className=\"flex items-center gap-2\">\n          <span className={textTheme.label}>Chart:</span>\n          <select\n            value={chartType}\n            onChange={(e) => setChartType(e.target.value as ChartType)}\n            className={`h-7 px-2 text-sm ${inputTheme.select}`}\n          >\n            <option value=\"bar\">Bar Chart</option>\n            <option value=\"pie\">Pie Chart</option>\n            <option value=\"treemap\">Treemap</option>\n          </select>\n        </div>\n\n        <div className=\"flex items-center gap-2\">\n          <span className={textTheme.label}>Group by:</span>\n          <select\n            value={groupBy}\n            onChange={(e) => setGroupBy(e.target.value as GroupBy)}\n            className={`h-7 px-2 text-sm ${inputTheme.select}`}\n          >\n            <option value=\"folder\">Folder</option>\n            <option value=\"status\">Status</option>\n            <option value=\"priority\">Priority</option>\n          </select>\n        </div>\n\n        <div className={`ml-auto text-xs ${textTheme.secondary}`}>\n          {data.length} notes in {groupedData.length} groups\n        </div>\n      </div>\n\n      {/* Chart */}\n      <div className=\"flex-1\">\n        <svg ref={svgRef} className=\"w-full h-full\" />\n      </div>\n    </div>\n  );\n}\n\nfunction renderBarChart(\n  svg: D3SVGSelection,\n  data: { name: string; count: number; nodes: Node[] }[],\n  width: number,\n  height: number,\n  margin: { top: number; right: number; bottom: number; left: number },\n  colorScale: D3ColorScale,\n  theme: ThemeName,\n  themeValues: ReturnType<typeof getTheme>,\n  onNodeClick?: (node: Node) => void\n) {\n  const g = svg.append('g')\n    .attr('transform', `translate(${margin.left}, ${margin.top})`);\n\n  const innerWidth = width - margin.left - margin.right;\n  const innerHeight = height - margin.top - margin.bottom;\n\n  const xScale = d3.scaleBand()\n    .domain(data.map(d => d.name))\n    .range([0, innerWidth])\n    .padding(0.2);\n\n  const yScale = d3.scaleLinear()\n    .domain([0, d3.max(data, d => d.count) || 0])\n    .range([innerHeight, 0])\n    .nice();\n\n  // X-axis with theme styling\n  const xAxis = g.append('g')\n    .attr('transform', `translate(0, ${innerHeight})`)\n    .call(d3.axisBottom(xScale));\n  styleAxis(xAxis, theme, { textRotation: -30, textAnchor: 'end' });\n\n  // Y-axis with theme styling\n  const yAxis = g.append('g').call(d3.axisLeft(yScale).ticks(5));\n  styleAxis(yAxis, theme);\n\n  // Bars with hover effect\n  const bars = g.append('g')\n    .selectAll('rect')\n    .data(data)\n    .join('rect')\n    .attr('x', d => xScale(d.name)!)\n    .attr('y', d => yScale(d.count))\n    .attr('width', xScale.bandwidth())\n    .attr('height', d => innerHeight - yScale(d.count))\n    .attr('fill', d => colorScale(d.name))\n    .attr('rx', theme === 'NeXTSTEP' ? 0 : 4)\n    .style('cursor', 'pointer')\n    .on('click', (_event, d) => {\n      if (d.nodes.length > 0) {\n        onNodeClick?.(d.nodes[0]);\n      }\n    });\n\n  setupHoverEffect(bars);\n\n  // Labels\n  g.append('g')\n    .selectAll('text')\n    .data(data)\n    .join('text')\n    .attr('x', d => xScale(d.name)! + xScale.bandwidth() / 2)\n    .attr('y', d => yScale(d.count) - 5)\n    .attr('text-anchor', 'middle')\n    .attr('class', 'text-xs font-medium')\n    .attr('fill', themeValues.chart.axisText)\n    .text(d => d.count);\n}\n\nfunction renderPieChart(\n  svg: D3SVGSelection,\n  data: { name: string; count: number; nodes: Node[] }[],\n  width: number,\n  height: number,\n  colorScale: D3ColorScale,\n  theme: ThemeName,\n  themeValues: ReturnType<typeof getTheme>,\n  onNodeClick?: (node: Node) => void\n) {\n  const radius = Math.min(width, height) / 2 - 60;\n  const g = svg.append('g')\n    .attr('transform', `translate(${width / 2}, ${height / 2})`);\n\n  type PieData = { name: string; count: number; nodes: Node[] };\n\n  const pie: D3PieGenerator<PieData> = d3.pie<PieData>()\n    .value(d => d.count)\n    .sort(null);\n\n  const arc = d3.arc<d3.BaseType, d3.PieArcDatum<PieData>>()\n    .innerRadius(radius * 0.4)\n    .outerRadius(radius);\n\n  const outerArc = d3.arc<d3.BaseType, d3.PieArcDatum<PieData>>()\n    .innerRadius(radius * 1.1)\n    .outerRadius(radius * 1.1);\n\n  // Slices\n  g.append('g')\n    .selectAll('path')\n    .data(pie(data))\n    .join('path')\n    .attr('d', arc)\n    .attr('fill', d => colorScale(d.data.name))\n    .attr('stroke', theme === 'NeXTSTEP' ? themeValues.border.dark : '#ffffff')\n    .attr('stroke-width', 2)\n    .style('cursor', 'pointer')\n    .on('click', (_event, d) => {\n      if (d.data.nodes.length > 0) {\n        onNodeClick?.(d.data.nodes[0]);\n      }\n    })\n    .on('mouseenter', function(_event: MouseEvent, d: d3.PieArcDatum<PieData>) {\n      d3.select(this)\n        .transition()\n        .duration(100)\n        .attr('transform', () => {\n          const [x, y] = arc.centroid(d);\n          const dist = 10;\n          const angle = Math.atan2(y, x);\n          return `translate(${Math.cos(angle) * dist}, ${Math.sin(angle) * dist})`;\n        });\n    })\n    .on('mouseleave', function() {\n      d3.select(this)\n        .transition()\n        .duration(100)\n        .attr('transform', 'translate(0, 0)');\n    });\n\n  // Labels\n  g.append('g')\n    .selectAll('text')\n    .data(pie(data))\n    .join('text')\n    .attr('transform', d => `translate(${outerArc.centroid(d)})`)\n    .attr('text-anchor', d => {\n      const midangle = d.startAngle + (d.endAngle - d.startAngle) / 2;\n      return midangle < Math.PI ? 'start' : 'end';\n    })\n    .attr('class', 'text-xs')\n    .attr('fill', themeValues.chart.axisText)\n    .text(d => `${d.data.name} (${d.data.count})`);\n\n  // Center label\n  const total = data.reduce((sum, d) => sum + d.count, 0);\n  g.append('text')\n    .attr('text-anchor', 'middle')\n    .attr('dy', '-0.2em')\n    .attr('class', 'text-2xl font-bold')\n    .attr('fill', themeValues.chart.axisText)\n    .text(total);\n\n  g.append('text')\n    .attr('text-anchor', 'middle')\n    .attr('dy', '1.2em')\n    .attr('class', 'text-xs')\n    .attr('fill', themeValues.text.secondary)\n    .text('Total');\n}\n\nfunction renderTreemap(\n  svg: D3SVGSelection,\n  data: { name: string; count: number; nodes: Node[] }[],\n  width: number,\n  height: number,\n  colorScale: D3ColorScale,\n  theme: ThemeName,\n  themeValues: ReturnType<typeof getTheme>,\n  onNodeClick?: (node: Node) => void\n) {\n  // Define treemap-specific interfaces\n  interface TreemapDataItem {\n    name: string;\n    count: number;\n    nodes: Node[];\n  }\n\n  interface TreemapData {\n    children?: TreemapDataItem[];\n  }\n\n  // Use d3.HierarchyRectangularNode directly (already has x0, x1, y0, y1)\n  type TreemapNode = d3.HierarchyRectangularNode<TreemapDataItem>;\n  const margin = { top: 20, right: 20, bottom: 20, left: 20 };\n  const innerWidth = width - margin.left - margin.right;\n  const innerHeight = height - margin.top - margin.bottom;\n\n  const g = svg.append('g')\n    .attr('transform', `translate(${margin.left}, ${margin.top})`);\n\n  const root = d3.hierarchy<TreemapData>({ children: data })\n    .sum(d => {\n      const item = d as unknown as TreemapDataItem;\n      return item.count || 0;\n    })\n    .sort((a, b) => (b.value || 0) - (a.value || 0));\n\n  const treemap = d3.treemap<TreemapData>()\n    .size([innerWidth, innerHeight])\n    .padding(2)\n    .round(true);\n\n  treemap(root);\n\n  // Cells\n  const cells = g.selectAll('g')\n    .data(root.leaves() as unknown as TreemapNode[])\n    .join('g')\n    .attr('transform', d => `translate(${d.x0},${d.y0})`);\n\n  const rects = cells.append('rect')\n    .attr('width', d => d.x1 - d.x0)\n    .attr('height', d => d.y1 - d.y0)\n    .attr('fill', d => colorScale(d.data.name))\n    .attr('rx', theme === 'NeXTSTEP' ? 0 : 4)\n    .attr('stroke', theme === 'NeXTSTEP' ? themeValues.border.dark : '#ffffff')\n    .attr('stroke-width', 1)\n    .style('cursor', 'pointer')\n    .on('click', (_event, d) => {\n      const nodes = d.data.nodes;\n      if (nodes && nodes.length > 0) {\n        onNodeClick?.(nodes[0]);\n      }\n    });\n\n  setupHoverEffect(rects);\n\n  // Labels\n  cells.append('text')\n    .attr('x', 4)\n    .attr('y', 14)\n    .attr('class', 'text-xs font-medium')\n    .attr('fill', '#ffffff')\n    .text(d => {\n      const name = d.data.name;\n      const w = d.x1 - d.x0;\n      if (w < 40) return '';\n      if (w < 80) return name.slice(0, 5) + '...';\n      return name;\n    });\n\n  cells.append('text')\n    .attr('x', 4)\n    .attr('y', 28)\n    .attr('class', 'text-xs')\n    .attr('fill', theme === 'NeXTSTEP' ? '#e0e0e0' : '#e5e7eb')\n    .text(d => {\n      const w = d.x1 - d.x0;\n      if (w < 40) return '';\n      return d.data.count;\n    });\n}\n","// Component-specific theme hooks\n// Provides pre-computed Tailwind classes for common UI patterns\n\nimport { useMemo } from 'react';\nimport { useTheme } from '@/contexts/ThemeContext';\nimport { tw, getTheme, type ThemeName } from '@/styles/themes';\n\n// Generic hook that returns theme classes for a component type\nexport function useThemeClasses() {\n  const { theme } = useTheme();\n  return useMemo(() => tw(theme as ThemeName), [theme]);\n}\n\n// Get raw theme values (colors, etc.)\nexport function useThemeValues() {\n  const { theme } = useTheme();\n  return useMemo(() => getTheme(theme as ThemeName), [theme]);\n}\n\n// Button theme hook\nexport function useButtonTheme() {\n  const { theme } = useTheme();\n\n  return useMemo(() => ({\n    base: theme === 'NeXTSTEP'\n      ? 'bg-[#d4d4d4] border-t-2 border-l-2 border-[#ffffff] border-b-2 border-r-2 border-b-[#707070] border-r-[#707070]'\n      : 'bg-white hover:bg-gray-50 rounded-lg border border-gray-300',\n    active: theme === 'NeXTSTEP'\n      ? 'bg-[#d4d4d4] border-t-2 border-l-2 border-[#707070] border-b-2 border-r-2 border-b-[#ffffff] border-r-[#ffffff]'\n      : 'bg-blue-500 text-white rounded-lg',\n    selected: theme === 'NeXTSTEP'\n      ? 'bg-black text-white'\n      : 'bg-blue-500 text-white',\n    hover: theme === 'NeXTSTEP'\n      ? 'hover:bg-[#c8c8c8]'\n      : 'hover:bg-gray-100',\n    disabled: theme === 'NeXTSTEP'\n      ? 'bg-[#d4d4d4] text-[#909090] cursor-not-allowed'\n      : 'bg-gray-100 text-gray-400 cursor-not-allowed',\n    icon: theme === 'NeXTSTEP'\n      ? 'p-1'\n      : 'p-1 rounded hover:bg-gray-200',\n  }), [theme]);\n}\n\n// Panel/container theme hook\nexport function usePanelTheme() {\n  const { theme } = useTheme();\n\n  return useMemo(() => ({\n    container: theme === 'NeXTSTEP'\n      ? 'bg-[#c0c0c0] border-r-2 border-[#505050]'\n      : 'bg-white/80 backdrop-blur-xl border-r border-gray-200',\n    header: theme === 'NeXTSTEP'\n      ? 'bg-[#a8a8a8] border-b-2 border-[#707070]'\n      : 'bg-gray-100 border-b border-gray-200',\n    section: theme === 'NeXTSTEP'\n      ? 'bg-[#c0c0c0]'\n      : 'bg-gray-50',\n    divider: theme === 'NeXTSTEP'\n      ? 'border-t border-[#a0a0a0]'\n      : 'border-t border-gray-200',\n  }), [theme]);\n}\n\n// Input/form theme hook\nexport function useInputTheme() {\n  const { theme } = useTheme();\n\n  return useMemo(() => ({\n    base: theme === 'NeXTSTEP'\n      ? 'bg-white border-t-2 border-l-2 border-[#707070] border-b-2 border-r-2 border-b-[#e8e8e8] border-r-[#e8e8e8]'\n      : 'bg-white border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500',\n    select: theme === 'NeXTSTEP'\n      ? 'bg-[#d4d4d4] border-2 border-[#707070]'\n      : 'bg-white border border-gray-300 rounded',\n    checkbox: theme === 'NeXTSTEP'\n      ? 'bg-white border-2 border-[#707070]'\n      : 'rounded border-gray-300 text-blue-600 focus:ring-blue-500',\n  }), [theme]);\n}\n\n// Dropdown theme hook\nexport function useDropdownTheme() {\n  const { theme } = useTheme();\n\n  return useMemo(() => ({\n    trigger: theme === 'NeXTSTEP'\n      ? 'bg-[#d4d4d4] border-t-2 border-l-2 border-[#ffffff] border-b-2 border-r-2 border-b-[#707070] border-r-[#707070]'\n      : 'bg-white hover:bg-gray-50 rounded-lg border border-gray-300',\n    menu: theme === 'NeXTSTEP'\n      ? 'absolute top-full left-0 mt-1 bg-[#d4d4d4] border-2 border-[#707070] shadow-lg z-50'\n      : 'absolute top-full left-0 mt-1 bg-white rounded-lg border border-gray-200 shadow-lg z-50',\n    item: theme === 'NeXTSTEP'\n      ? 'w-full px-3 py-1 text-left text-sm hover:bg-black hover:text-white'\n      : 'w-full px-3 py-1 text-left text-sm hover:bg-gray-100 first:rounded-t-lg last:rounded-b-lg',\n    itemActive: theme === 'NeXTSTEP'\n      ? 'bg-black text-white'\n      : 'bg-blue-50 text-blue-700',\n    label: theme === 'NeXTSTEP'\n      ? 'text-xs text-[#404040]'\n      : 'text-xs text-gray-600',\n  }), [theme]);\n}\n\n// Card theme hook\nexport function useCardTheme() {\n  const { theme } = useTheme();\n\n  return useMemo(() => ({\n    container: theme === 'NeXTSTEP'\n      ? 'bg-[#d4d4d4] border-t-2 border-l-2 border-[#ffffff] border-b-2 border-r-2 border-b-[#707070] border-r-[#707070]'\n      : 'bg-white rounded-lg shadow-sm border border-gray-200 hover:shadow-md transition-shadow',\n    header: theme === 'NeXTSTEP'\n      ? 'font-medium text-[#404040]'\n      : 'font-medium text-gray-900',\n    content: theme === 'NeXTSTEP'\n      ? 'text-[#404040]'\n      : 'text-gray-500',\n    footer: theme === 'NeXTSTEP'\n      ? 'text-xs text-[#606060]'\n      : 'text-xs text-gray-400',\n  }), [theme]);\n}\n\n// Badge theme hook\nexport function useBadgeTheme() {\n  const { theme } = useTheme();\n\n  return useMemo(() => ({\n    default: theme === 'NeXTSTEP'\n      ? 'px-2 py-0.5 text-xs bg-[#a0a0a0]'\n      : 'px-2 py-0.5 text-xs bg-gray-100 text-gray-600 rounded',\n    primary: theme === 'NeXTSTEP'\n      ? 'px-2 py-0.5 text-xs bg-[#808080] text-white'\n      : 'px-2 py-0.5 text-xs bg-blue-100 text-blue-700 rounded',\n    success: theme === 'NeXTSTEP'\n      ? 'px-2 py-0.5 text-xs bg-[#606060] text-white'\n      : 'px-2 py-0.5 text-xs bg-green-100 text-green-700 rounded',\n    warning: theme === 'NeXTSTEP'\n      ? 'px-2 py-0.5 text-xs bg-[#b0b0b0]'\n      : 'px-2 py-0.5 text-xs bg-yellow-100 text-yellow-700 rounded',\n  }), [theme]);\n}\n\n// Table/list theme hook\nexport function useTableTheme() {\n  const { theme } = useTheme();\n\n  return useMemo(() => ({\n    header: theme === 'NeXTSTEP'\n      ? 'bg-[#b0b0b0] text-[#404040] border-b-2 border-[#808080]'\n      : 'bg-gray-50 text-gray-500 border-b border-gray-200',\n    row: theme === 'NeXTSTEP'\n      ? 'bg-[#d4d4d4] border-t border-[#a0a0a0] hover:bg-[#c8c8c8]'\n      : 'bg-white border-b border-gray-100 hover:bg-gray-50',\n    rowAlt: theme === 'NeXTSTEP'\n      ? 'bg-[#c8c8c8] border-t border-[#a0a0a0] hover:bg-[#b8b8b8]'\n      : 'bg-gray-50 border-b border-gray-100 hover:bg-gray-100',\n    cell: theme === 'NeXTSTEP'\n      ? 'text-[#404040]'\n      : 'text-gray-700',\n  }), [theme]);\n}\n\n// Canvas/visualization container theme hook\nexport function useCanvasTheme() {\n  const { theme } = useTheme();\n\n  return useMemo(() => ({\n    container: theme === 'NeXTSTEP'\n      ? 'bg-white border-t-2 border-l-2 border-[#707070] border-b-2 border-r-2 border-b-[#e8e8e8] border-r-[#e8e8e8]'\n      : 'bg-white rounded-lg shadow-lg border border-gray-200',\n    emptyState: theme === 'NeXTSTEP'\n      ? 'text-[#707070]'\n      : 'text-gray-400',\n  }), [theme]);\n}\n\n// Text style hook\nexport function useTextTheme() {\n  const { theme } = useTheme();\n\n  return useMemo(() => ({\n    primary: theme === 'NeXTSTEP' ? 'text-[#404040]' : 'text-gray-700',\n    secondary: theme === 'NeXTSTEP' ? 'text-[#606060]' : 'text-gray-500',\n    muted: theme === 'NeXTSTEP' ? 'text-[#909090]' : 'text-gray-400',\n    inverse: theme === 'NeXTSTEP' ? 'text-white' : 'text-white',\n    label: theme === 'NeXTSTEP' ? 'text-xs text-[#404040]' : 'text-xs text-gray-600',\n  }), [theme]);\n}\n","import { useEffect, useRef, useState } from 'react';\nimport * as d3 from 'd3';\nimport { useTheme } from '@/contexts/ThemeContext';\nimport { useCanvasTheme } from '@/hooks/useComponentTheme';\nimport { useSQLiteQuery } from '@/hooks/useSQLiteQuery';\nimport { createColorScale, setupZoom } from '@/d3/hooks';\nimport { getTheme, type ThemeName } from '@/styles/themes';\nimport type { Node } from '@/types/node';\nimport type {\n  SimulationNodeDatum,\n  SimulationLinkDatum,\n  D3ForceSimulation\n} from '@/types/d3';\n\ninterface EdgeData {\n  id: string;\n  source_id: string;\n  target_id: string;\n  type: string;\n  weight: number;\n  label: string | null;\n}\n\ninterface NetworkViewProps {\n  data: Node[];\n  onNodeClick?: (node: Node) => void;\n}\n\ninterface SimNode extends SimulationNodeDatum {\n  id: string;\n  name: string;\n  folder: string | null;\n  priority: number;\n}\n\ninterface SimLink extends SimulationLinkDatum<SimNode> {\n  id: string;\n  type: string;\n  weight: number;\n  label: string | null;\n}\n\nexport function NetworkView({ data, onNodeClick }: NetworkViewProps) {\n  const svgRef = useRef<SVGSVGElement>(null);\n  const containerRef = useRef<HTMLDivElement>(null);\n  const { theme } = useTheme();\n  const canvasTheme = useCanvasTheme();\n  const [selectedNode, setSelectedNode] = useState<string | null>(null);\n\n  // Fetch edges\n  const { data: edges } = useSQLiteQuery<EdgeData>('SELECT * FROM edges');\n\n  useEffect(() => {\n    if (!svgRef.current || !containerRef.current || !data.length) return;\n\n    const container = containerRef.current;\n    const width = container.clientWidth;\n    const height = container.clientHeight;\n    const themeValues = getTheme(theme as ThemeName);\n\n    const svg = d3.select(svgRef.current);\n    svg.selectAll('*').remove();\n    svg.attr('width', width).attr('height', height);\n\n    // Convert data to simulation format\n    const nodes: SimNode[] = data.map(d => ({\n      id: d.id,\n      name: d.name,\n      folder: d.folder,\n      priority: d.priority,\n    }));\n\n    const nodeMap = new Map(nodes.map(n => [n.id, n]));\n\n    // Filter edges to only include those with valid source/target\n    const links: SimLink[] = (edges || [])\n      .filter(e => nodeMap.has(e.source_id) && nodeMap.has(e.target_id))\n      .map(e => ({\n        id: e.id,\n        source: e.source_id,\n        target: e.target_id,\n        type: e.type,\n        weight: e.weight,\n        label: e.label,\n      }));\n\n    // Create color scale using utility\n    const folders = Array.from(new Set(nodes.map(n => n.folder).filter(Boolean))) as string[];\n    const colorScale = createColorScale(folders, theme as ThemeName);\n\n    // Create simulation\n    const simulation: D3ForceSimulation<SimNode> = d3.forceSimulation<SimNode>(nodes)\n      .force('link', d3.forceLink<SimNode, SimLink>(links)\n        .id(d => d.id)\n        .distance(100)\n        .strength(0.5))\n      .force('charge', d3.forceManyBody().strength(-200))\n      .force('center', d3.forceCenter(width / 2, height / 2))\n      .force('collision', d3.forceCollide().radius(30));\n\n    // Main group\n    const g = svg.append('g');\n\n    // Setup zoom using utility\n    setupZoom(svg, g, { scaleExtent: [0.2, 4] });\n\n    // Arrow marker for directed edges\n    svg.append('defs').append('marker')\n      .attr('id', 'arrow')\n      .attr('viewBox', '0 -5 10 10')\n      .attr('refX', 25)\n      .attr('refY', 0)\n      .attr('markerWidth', 6)\n      .attr('markerHeight', 6)\n      .attr('orient', 'auto')\n      .append('path')\n      .attr('fill', themeValues.chart.axis)\n      .attr('d', 'M0,-5L10,0L0,5');\n\n    // Links\n    const link = g.append('g')\n      .attr('class', 'links')\n      .selectAll('line')\n      .data(links)\n      .join('line')\n      .attr('stroke', themeValues.chart.grid)\n      .attr('stroke-width', d => Math.sqrt(d.weight) * 1.5)\n      .attr('stroke-opacity', 0.6)\n      .attr('marker-end', 'url(#arrow)');\n\n    // Link labels\n    const linkLabels = g.append('g')\n      .attr('class', 'link-labels')\n      .selectAll('text')\n      .data(links.filter(l => l.label))\n      .join('text')\n      .attr('class', 'text-xs')\n      .attr('fill', themeValues.text.secondary)\n      .attr('text-anchor', 'middle')\n      .text(d => d.label || '');\n\n    // Nodes\n    const node = g.append('g')\n      .attr('class', 'nodes')\n      .selectAll<SVGGElement, SimNode>('g')\n      .data(nodes)\n      .join('g')\n      .attr('class', 'node')\n      .style('cursor', 'pointer')\n      .call(d3.drag<SVGGElement, SimNode>()\n        .on('start', (event, _d: SimNode) => {\n          if (!event.active) simulation.alphaTarget(0.3).restart();\n          d.fx = d.x;\n          d.fy = d.y;\n        })\n        .on('drag', (event, _d: SimNode) => {\n          d.fx = event.x;\n          d.fy = event.y;\n        })\n        .on('end', (event, _d: SimNode) => {\n          if (!event.active) simulation.alphaTarget(0);\n          d.fx = null;\n          d.fy = null;\n        })\n      );\n\n    // Node circles\n    node.append('circle')\n      .attr('r', d => 12 + (6 - d.priority) * 2)\n      .attr('fill', d => colorScale(d.folder || 'Unknown'))\n      .attr('stroke', d => selectedNode === d.id\n        ? (theme === 'NeXTSTEP' ? '#000000' : '#3b82f6')\n        : themeValues.chart.stroke\n      )\n      .attr('stroke-width', d => selectedNode === d.id ? 3 : 1.5);\n\n    // Node labels\n    node.append('text')\n      .attr('dy', 30)\n      .attr('text-anchor', 'middle')\n      .attr('class', 'text-xs font-medium')\n      .attr('fill', themeValues.chart.axisText)\n      .text(d => d.name.length > 12 ? d.name.slice(0, 12) + '...' : d.name);\n\n    // Node click handler\n    node.on('click', (event, _d: SimNode) => {\n      event.stopPropagation();\n      setSelectedNode(prev => prev === d.id ? null : d.id);\n      const nodeData = data.find(c => c.id === d.id);\n      if (nodeData) onNodeClick?.(nodeData);\n    });\n\n    // Background click to deselect\n    svg.on('click', () => setSelectedNode(null));\n\n    // Update positions on tick\n    simulation.on('tick', () => {\n      link\n        .attr('x1', d => (d.source as SimNode).x!)\n        .attr('y1', d => (d.source as SimNode).y!)\n        .attr('x2', d => (d.target as SimNode).x!)\n        .attr('y2', d => (d.target as SimNode).y!);\n\n      linkLabels\n        .attr('x', d => ((d.source as SimNode).x! + (d.target as SimNode).x!) / 2)\n        .attr('y', d => ((d.source as SimNode).y! + (d.target as SimNode).y!) / 2);\n\n      node.attr('transform', d => `translate(${d.x},${d.y})`);\n    });\n\n    // Cleanup\n    return () => {\n      simulation.stop();\n    };\n  }, [data, edges, theme, selectedNode, onNodeClick]);\n\n  return (\n    <div ref={containerRef} className=\"w-full h-full relative\">\n      <svg ref={svgRef} className=\"w-full h-full\" />\n      {(!edges || edges.length === 0) && (\n        <div className=\"absolute inset-0 flex items-center justify-center pointer-events-none\">\n          <div className={`text-sm ${canvasTheme.emptyState}`}>\n            No edges defined. Add relationships to see the network.\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n","import { useEffect, useRef, useMemo } from 'react';\nimport * as d3 from 'd3';\nimport { useTheme } from '@/contexts/ThemeContext';\nimport type { Node as DataNode } from '@/types/node';\nimport type {\n  D3ZoomBehavior,\n  D3ColorScale\n} from '@/types/d3';\n\ninterface TreeViewProps {\n  data: DataNode[];\n  onNodeClick?: (node: DataNode) => void;\n}\n\ninterface TreeNode {\n  id: string;\n  name: string;\n  folder: string | null;\n  priority: number;\n  children?: TreeNode[];\n  _node: DataNode;\n}\n\nfunction buildTree(data: DataNode[]): TreeNode[] {\n  const nodeMap = new Map<string, TreeNode>();\n  const roots: TreeNode[] = [];\n\n  // Create all nodes (no parent_id in schema, so all are roots)\n  data.forEach(node => {\n    nodeMap.set(node.id, {\n      id: node.id,\n      name: node.name,\n      folder: node.folder,\n      priority: node.priority,\n      children: [],\n      _node: node,\n    });\n  });\n\n  // All nodes are roots since there's no parent_id in the schema\n  data.forEach(node => {\n    const treeNode = nodeMap.get(node.id)!;\n    roots.push(treeNode);\n  });\n\n  return roots;\n}\n\nexport function TreeView({ data, onNodeClick }: TreeViewProps) {\n  const svgRef = useRef<SVGSVGElement>(null);\n  const containerRef = useRef<HTMLDivElement>(null);\n  const { theme } = useTheme();\n\n  // Build tree hierarchy\n  const treeRoots = useMemo(() => buildTree(data), [data]);\n\n  useEffect(() => {\n    if (!svgRef.current || !containerRef.current || !treeRoots.length) return;\n\n    const container = containerRef.current;\n    const width = container.clientWidth;\n    const height = container.clientHeight;\n    const margin = { top: 40, right: 120, bottom: 40, left: 120 };\n\n    const svg = d3.select(svgRef.current);\n    svg.selectAll('*').remove();\n\n    // If multiple roots, create a virtual root\n    const rootData: TreeNode = treeRoots.length === 1\n      ? treeRoots[0]\n      : {\n          id: '__root__',\n          name: 'Root',\n          folder: null,\n          priority: 0,\n          children: treeRoots,\n          _node: data[0], // Use first node as placeholder\n        };\n\n    // Create hierarchy\n    const root = d3.hierarchy<TreeNode>(rootData);\n\n    // Tree layout\n    const treeLayout = d3.tree<TreeNode>()\n      .size([height - margin.top - margin.bottom, width - margin.left - margin.right]);\n\n    const treeData = treeLayout(root);\n\n    // Color scale\n    const folders = Array.from(new Set(data.map(d => d.folder).filter(Boolean)));\n    const colorScale: D3ColorScale = d3.scaleOrdinal<string>()\n      .domain(folders as string[])\n      .range(theme === 'NeXTSTEP'\n        ? ['#808080', '#606060', '#a0a0a0', '#707070', '#909090']\n        : d3.schemeTableau10\n      );\n\n    // Main group\n    const g = svg\n      .attr('width', width)\n      .attr('height', height)\n      .append('g')\n      .attr('transform', `translate(${margin.left},${margin.top})`);\n\n    // Add zoom\n    const zoom: D3ZoomBehavior<SVGSVGElement> = d3.zoom<SVGSVGElement, unknown>()\n      .scaleExtent([0.3, 3])\n      .on('zoom', (event) => {\n        g.attr('transform', event.transform);\n      });\n\n    svg.call(zoom);\n    svg.call(zoom.transform, d3.zoomIdentity.translate(margin.left, margin.top));\n\n    // Links\n    g.append('g')\n      .attr('class', 'links')\n      .selectAll('path')\n      .data(treeData.links())\n      .join('path')\n      .attr('fill', 'none')\n      .attr('stroke', theme === 'NeXTSTEP' ? '#808080' : '#d1d5db')\n      .attr('stroke-width', 1.5)\n      .attr('d', d3.linkHorizontal<d3.HierarchyPointLink<TreeNode>, d3.HierarchyPointNode<TreeNode>>()\n        .x(d => d.y)\n        .y(d => d.x)\n      );\n\n    // Nodes\n    const node = g.append('g')\n      .attr('class', 'nodes')\n      .selectAll<SVGGElement, d3.HierarchyPointNode<TreeNode>>('g')\n      .data(treeData.descendants().filter(d => d.data.id !== '__root__'))\n      .join('g')\n      .attr('class', 'node')\n      .attr('transform', d => `translate(${d.y},${d.x})`)\n      .style('cursor', 'pointer')\n      .on('click', (event, _d: d3.HierarchyPointNode<TreeNode>) => {\n        event.stopPropagation();\n        onNodeClick?.(d.data._node);\n      });\n\n    // Node circles\n    node.append('circle')\n      .attr('r', d => 8 + (6 - d.data.priority) * 1.5)\n      .attr('fill', d => d.data.folder\n        ? colorScale(d.data.folder)\n        : (theme === 'NeXTSTEP' ? '#b0b0b0' : '#e5e7eb')\n      )\n      .attr('stroke', theme === 'NeXTSTEP' ? '#404040' : '#6b7280')\n      .attr('stroke-width', 1.5);\n\n    // Node labels\n    node.append('text')\n      .attr('dy', '0.31em')\n      .attr('x', d => d.children ? -15 : 15)\n      .attr('text-anchor', d => d.children ? 'end' : 'start')\n      .attr('class', 'text-xs font-medium')\n      .attr('fill', theme === 'NeXTSTEP' ? '#404040' : '#374151')\n      .text(d => d.data.name.length > 20 ? d.data.name.slice(0, 20) + '...' : d.data.name);\n\n    // Hover effect\n    node.on('mouseenter', function() {\n      d3.select(this).select('circle')\n        .transition()\n        .duration(150)\n        .attr('stroke-width', 3);\n    }).on('mouseleave', function() {\n      d3.select(this).select('circle')\n        .transition()\n        .duration(150)\n        .attr('stroke-width', 1.5);\n    });\n\n  }, [treeRoots, data, theme, onNodeClick]);\n\n  // Tree view shows all nodes (no parent_id in schema)\n  const hasHierarchy = false;\n\n  return (\n    <div ref={containerRef} className=\"w-full h-full relative\">\n      <svg ref={svgRef} className=\"w-full h-full\" />\n      {!hasHierarchy && data.length > 0 && (\n        <div className=\"absolute inset-0 flex items-center justify-center pointer-events-none\">\n          <div className={`text-sm ${theme === 'NeXTSTEP' ? 'text-[#707070]' : 'text-gray-400'}`}>\n            No hierarchy defined. Add NEST edges to see the tree.\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n","import * as d3 from 'd3';\nimport type { Chip } from '../contexts/PAFVContext';\nimport type { Node } from '../types/node';\n\n// ============================================================================\n// Scale Type Definitions\n// ============================================================================\n\nexport type ScaleType = 'temporal' | 'categorical' | 'numerical' | 'ordinal';\n\nexport interface ScaleConfig {\n  type: ScaleType;\n  domain: unknown[];\n  range: [number, number];\n  padding?: number;\n  nice?: boolean;\n}\n\nexport interface D3Scale {\n  scale: d3.ScaleTime<number, number> | d3.ScaleBand<string> | d3.ScaleLinear<number, number> | d3.ScaleOrdinal<string, unknown>;\n  type: ScaleType;\n  config: ScaleConfig;\n}\n\nexport interface ScaleSystemConfig {\n  width: number;\n  height: number;\n  padding: {\n    top: number;\n    right: number;\n    bottom: number;\n    left: number;\n  };\n  headerHeights: {\n    column: number;\n    row: number;\n  };\n}\n\nexport interface HierarchicalScale {\n  levels: D3Scale[];\n  composite: d3.ScaleBand<string>;\n  totalHeight: number;\n  totalWidth: number;\n}\n\n// ============================================================================\n// Field Analysis & Type Inference\n// ============================================================================\n\nconst FIELD_MAP: Record<string, keyof Node> = {\n  folder: 'folder',\n  subfolder: 'status',\n  tags: 'folder',\n  year: 'createdAt',\n  month: 'createdAt',\n  category: 'folder',\n  status: 'status',\n  priority: 'priority',\n};\n\n/**\n * Extract field value from node based on chip configuration\n */\nexport const extractFieldValue = (node: Node, chip: Chip): unknown => {\n  const field = FIELD_MAP[chip.id] || 'folder';\n  const value = node[field];\n\n  if (field === 'createdAt' && value) {\n    const date = new Date(value as string);\n    if (chip.id === 'year') {\n      return date.getFullYear();\n    }\n    if (chip.id === 'month') {\n      return date.getMonth(); // 0-11 for proper temporal scale\n    }\n    return date; // Full date for temporal scales\n  }\n\n  if (chip.id === 'priority' && typeof value === 'string') {\n    // Convert priority to numerical value for proper ordering\n    const priorityMap: Record<string, number> = {\n      'high': 3,\n      'medium': 2,\n      'low': 1\n    };\n    return priorityMap[value.toLowerCase()] || 1;\n  }\n\n  return value ?? 'Unknown';\n};\n\n/**\n * Infer optimal scale type from chip and data characteristics\n */\nexport const inferScaleType = (chip: Chip, domain: unknown[]): ScaleType => {\n  // Explicit temporal indicators\n  if (['year', 'month', 'date', 'time'].includes(chip.id)) {\n    return 'temporal';\n  }\n\n  // Check if domain contains dates\n  if (domain.length > 0 && domain[0] instanceof Date) {\n    return 'temporal';\n  }\n\n  // Check if domain is numerical\n  if (domain.length > 0 && typeof domain[0] === 'number') {\n    // For continuous numerical data, use linear scale\n    if (domain.length > 10 || chip.id === 'priority') {\n      return 'numerical';\n    }\n    // For discrete numerical data, use ordinal\n    return 'ordinal';\n  }\n\n  // Check for ordered categorical data\n  if (['priority', 'status', 'rating'].includes(chip.id)) {\n    return 'ordinal';\n  }\n\n  // Default to categorical for text/string data\n  return 'categorical';\n};\n\n/**\n * Extract domain values from nodes for a specific chip\n */\nexport const extractDomain = (nodes: Node[], chip: Chip): unknown[] => {\n  const values = nodes.map(node => extractFieldValue(node, chip));\n  const uniqueValues = Array.from(new Set(values));\n\n  const scaleType = inferScaleType(chip, uniqueValues);\n\n  switch (scaleType) {\n    case 'temporal':\n      // Sort dates chronologically\n      return uniqueValues.filter(v => v instanceof Date || typeof v === 'number').sort();\n\n    case 'numerical':\n      // Sort numbers numerically\n      return uniqueValues.filter(v => typeof v === 'number').sort((a, b) => (a as number) - (b as number));\n\n    case 'ordinal':\n      // Custom sorting for ordered categories\n      if (chip.id === 'priority') {\n        return [1, 2, 3]; // low, medium, high\n      }\n      if (chip.id === 'status') {\n        return ['draft', 'pending', 'active', 'completed']; // Workflow order\n      }\n      return uniqueValues.sort();\n\n    case 'categorical':\n    default:\n      // Alphabetical sorting for categories\n      return uniqueValues.map(v => String(v)).sort();\n  }\n};\n\n// ============================================================================\n// Scale Factory Functions\n// ============================================================================\n\n/**\n * Create a D3 scale from chip configuration and domain\n */\nexport const createScale = (chip: Chip, domain: unknown[], range: [number, number], padding: number = 0.1): D3Scale => {\n  const scaleType = inferScaleType(chip, domain);\n  const config: ScaleConfig = {\n    type: scaleType,\n    domain,\n    range,\n    padding\n  };\n\n  switch (scaleType) {\n    case 'temporal': {\n      const temporalDomain = domain as Date[] | number[];\n      const scale = d3.scaleTime()\n        .domain(d3.extent(temporalDomain) as [Date | number, Date | number])\n        .range(range)\n        .nice();\n\n      return { scale, type: scaleType, config };\n    }\n\n    case 'numerical': {\n      const numericalDomain = domain as number[];\n      const scale = d3.scaleLinear()\n        .domain(d3.extent(numericalDomain) as [number, number])\n        .range(range)\n        .nice();\n\n      return { scale, type: scaleType, config };\n    }\n\n    case 'ordinal': {\n      const ordinalDomain = domain.map(String);\n      const scale = d3.scaleOrdinal()\n        .domain(ordinalDomain)\n        .range(d3.range(range[0], range[1], (range[1] - range[0]) / ordinalDomain.length));\n\n      return { scale, type: scaleType, config };\n    }\n\n    case 'categorical':\n    default: {\n      const categoricalDomain = domain.map(String);\n      const scale = d3.scaleBand()\n        .domain(categoricalDomain)\n        .range(range)\n        .padding(padding);\n\n      return { scale, type: scaleType, config };\n    }\n  }\n};\n\n// ============================================================================\n// Hierarchical Scale System\n// ============================================================================\n\n/**\n * Create hierarchical scales for multi-chip axes\n */\nexport const createHierarchicalScales = (\n  chips: Chip[],\n  nodes: Node[],\n  range: [number, number],\n  systemConfig: ScaleSystemConfig\n): HierarchicalScale => {\n  if (chips.length === 0) {\n    const emptyScale = d3.scaleBand<string>().domain([]).range(range);\n    return {\n      levels: [],\n      composite: emptyScale,\n      totalHeight: 0,\n      totalWidth: 0\n    };\n  }\n\n  if (chips.length === 1) {\n    // Single level - create simple scale\n    const domain = extractDomain(nodes, chips[0]);\n    const d3Scale = createScale(chips[0], domain, range);\n    const bandScale = d3Scale.scale as d3.ScaleBand<string>;\n\n    return {\n      levels: [d3Scale],\n      composite: bandScale,\n      totalHeight: systemConfig.headerHeights.row,\n      totalWidth: systemConfig.headerHeights.column\n    };\n  }\n\n  // Multi-level hierarchical scales\n  const levels: D3Scale[] = [];\n  const rangeSplit = (range[1] - range[0]) / chips.length;\n\n  chips.forEach((chip, index) => {\n    const levelRange: [number, number] = [\n      range[0] + (index * rangeSplit),\n      range[0] + ((index + 1) * rangeSplit)\n    ];\n\n    const domain = extractDomain(nodes, chip);\n    const scale = createScale(chip, domain, levelRange, 0.05);\n    levels.push(scale);\n  });\n\n  // Create composite scale for positioning\n  const compositeKeys = new Set<string>();\n  nodes.forEach(node => {\n    const compositeKey = chips.map(chip => String(extractFieldValue(node, chip))).join('|');\n    compositeKeys.add(compositeKey);\n  });\n\n  const composite = d3.scaleBand<string>()\n    .domain(Array.from(compositeKeys).sort())\n    .range(range)\n    .padding(0.1);\n\n  return {\n    levels,\n    composite,\n    totalHeight: systemConfig.headerHeights.row * chips.length,\n    totalWidth: systemConfig.headerHeights.column * chips.length\n  };\n};\n\n// ============================================================================\n// Scale System Cache\n// ============================================================================\n\ninterface ScaleCacheEntry {\n  scale: D3Scale;\n  timestamp: number;\n  chipId: string;\n  domainHash: string;\n  rangeHash: string;\n}\n\nclass ScaleCache {\n  private cache = new Map<string, ScaleCacheEntry>();\n  private maxAge = 60000; // 1 minute\n  private maxEntries = 100;\n\n  private createCacheKey(chipId: string, domain: unknown[], range: [number, number]): string {\n    const domainHash = JSON.stringify(domain);\n    const rangeHash = `${range[0]},${range[1]}`;\n    return `${chipId}:${domainHash}:${rangeHash}`;\n  }\n\n  private createHashes(domain: unknown[], range: [number, number]): { domainHash: string; rangeHash: string } {\n    return {\n      domainHash: JSON.stringify(domain),\n      rangeHash: `${range[0]},${range[1]}`\n    };\n  }\n\n  get(chipId: string, domain: unknown[], range: [number, number]): D3Scale | null {\n    const key = this.createCacheKey(chipId, domain, range);\n    const entry = this.cache.get(key);\n\n    if (!entry) return null;\n\n    // Check if entry is expired\n    if (Date.now() - entry.timestamp > this.maxAge) {\n      this.cache.delete(key);\n      return null;\n    }\n\n    return entry.scale;\n  }\n\n  set(chipId: string, domain: unknown[], range: [number, number], scale: D3Scale): void {\n    const key = this.createCacheKey(chipId, domain, range);\n    const { domainHash, rangeHash } = this.createHashes(domain, range);\n\n    // Clean up old entries if cache is full\n    if (this.cache.size >= this.maxEntries) {\n      const oldestKey = this.cache.keys().next().value;\n      if (oldestKey) {\n        this.cache.delete(oldestKey);\n      }\n    }\n\n    this.cache.set(key, {\n      scale,\n      timestamp: Date.now(),\n      chipId,\n      domainHash,\n      rangeHash\n    });\n  }\n\n  clear(): void {\n    this.cache.clear();\n  }\n\n  size(): number {\n    return this.cache.size;\n  }\n\n  getStats(): { entries: number; oldestAge: number; newestAge: number } {\n    if (this.cache.size === 0) {\n      return { entries: 0, oldestAge: 0, newestAge: 0 };\n    }\n\n    const now = Date.now();\n    const timestamps = Array.from(this.cache.values()).map(entry => entry.timestamp);\n    const oldestAge = now - Math.min(...timestamps);\n    const newestAge = now - Math.max(...timestamps);\n\n    return {\n      entries: this.cache.size,\n      oldestAge,\n      newestAge\n    };\n  }\n}\n\n// Global scale cache instance\nconst scaleCache = new ScaleCache();\n\n// ============================================================================\n// Public API\n// ============================================================================\n\n/**\n * Create a cached D3 scale from chip configuration\n */\nexport const createCachedScale = (chip: Chip, domain: unknown[], range: [number, number], padding?: number): D3Scale => {\n  // Check cache first\n  const cachedScale = scaleCache.get(chip.id, domain, range);\n  if (cachedScale) {\n    return cachedScale;\n  }\n\n  // Create new scale\n  const scale = createScale(chip, domain, range, padding);\n\n  // Cache the result\n  scaleCache.set(chip.id, domain, range, scale);\n\n  return scale;\n};\n\n/**\n * Create complete scale system for PAFV visualization\n */\nexport const createScaleSystem = (\n  rowChips: Chip[],\n  colChips: Chip[],\n  nodes: Node[],\n  systemConfig: ScaleSystemConfig\n): {\n  x: HierarchicalScale;\n  y: HierarchicalScale;\n  color: d3.ScaleOrdinal<string, string>;\n  size: d3.ScaleLinear<number, number>;\n} => {\n  // Create hierarchical scales for rows and columns\n  const dataWidth = systemConfig.width - systemConfig.padding.left - systemConfig.padding.right;\n  const dataHeight = systemConfig.height - systemConfig.padding.top - systemConfig.padding.bottom;\n\n  const x = createHierarchicalScales(\n    colChips,\n    nodes,\n    [systemConfig.padding.left, systemConfig.padding.left + dataWidth],\n    systemConfig\n  );\n\n  const y = createHierarchicalScales(\n    rowChips,\n    nodes,\n    [systemConfig.padding.top, systemConfig.padding.top + dataHeight],\n    systemConfig\n  );\n\n  // Create supplementary scales\n  const folders = Array.from(new Set(nodes.map(n => n.folder)));\n  const color = d3.scaleOrdinal<string, string>()\n    .domain(folders)\n    .range(d3.schemeCategory10);\n\n  const nodeCountExtent = d3.extent(\n    Array.from(\n      d3.group(nodes, n => `${extractFieldValue(n, colChips[0] || { id: 'folder', label: 'Folder' })}`).values(),\n      group => group.length\n    )\n  ) as [number, number];\n\n  const size = d3.scaleLinear()\n    .domain(nodeCountExtent)\n    .range([2, 10])\n    .clamp(true);\n\n  return { x, y, color, size };\n};\n\n/**\n * Clear scale cache (useful for testing or memory management)\n */\nexport const clearScaleCache = (): void => {\n  scaleCache.clear();\n};\n\n/**\n * Get scale cache statistics\n */\nexport const getScaleCacheStats = () => {\n  return scaleCache.getStats();\n};\n\n// ============================================================================\n// Utility Functions\n// ============================================================================\n\n/**\n * Check if a scale is a band scale (supports bandwidth method)\n */\nexport const isBandScale = (scale: unknown): scale is d3.ScaleBand<string> => {\n  return typeof scale.bandwidth === 'function';\n};\n\n/**\n * Get the bandwidth of a scale, or default width for non-band scales\n */\nexport const getScaleBandwidth = (scale: unknown, defaultWidth: number = 100): number => {\n  if (isBandScale(scale)) {\n    return scale.bandwidth();\n  }\n  return defaultWidth;\n};\n\n/**\n * Format scale domain value for display\n */\nexport const formatDomainValue = (value: unknown, scaleType: ScaleType): string => {\n  switch (scaleType) {\n    case 'temporal':\n      if (value instanceof Date) {\n        return value.toLocaleDateString();\n      }\n      if (typeof value === 'number') {\n        return new Date(value).toLocaleDateString();\n      }\n      return String(value);\n\n    case 'numerical':\n      if (typeof value === 'number') {\n        return value.toLocaleString();\n      }\n      return String(value);\n\n    case 'ordinal':\n      if (typeof value === 'number') {\n        // Priority mapping\n        const priorityLabels: Record<number, string> = { 1: 'Low', 2: 'Medium', 3: 'High' };\n        return priorityLabels[value] || String(value);\n      }\n      return String(value);\n\n    case 'categorical':\n    default:\n      return String(value);\n  }\n};\n\n/**\n * Get optimal tick count for a scale based on available space\n */\nexport const getOptimalTickCount = (scale: unknown, availableSpace: number, minSpacing: number = 50): number => {\n  const maxTicks = Math.floor(availableSpace / minSpacing);\n\n  if (typeof scale.domain === 'function') {\n    const domainLength = scale.domain().length;\n    return Math.min(maxTicks, domainLength);\n  }\n\n  return Math.min(maxTicks, 10); // Default maximum\n};","import { useState, useEffect, useCallback, useRef } from 'react';\nimport { usePAFV, type Wells, type Chip } from '../contexts/PAFVContext';\nimport { useMockData } from './useMockData';\nimport type { Node } from '../types/node';\nimport * as d3 from 'd3';\nimport { createScaleSystem, extractFieldValue, type ScaleSystemConfig, type HierarchicalScale } from '../utils/d3Scales';\n\n// ============================================================================\n// Type Definitions\n// ============================================================================\n\nexport interface Viewport {\n  x: number;           // Left bound\n  y: number;           // Top bound\n  width: number;       // Visible width\n  height: number;      // Visible height\n  scale: number;       // Zoom level\n}\n\nexport interface Rect {\n  x: number;\n  y: number;\n  width: number;\n  height: number;\n}\n\nexport interface CellData {\n  nodes: Node[];\n  bounds: Rect;\n  rowKey: string;\n  colKey: string;\n  rowPath: string[];\n  colPath: string[];\n  isEmpty: boolean;\n}\n\nexport interface GroupedData {\n  cells: Map<string, CellData>;\n  rowKeys: string[];\n  colKeys: string[];\n  rowDomains: Map<string, unknown[]>;\n  colDomains: Map<string, unknown[]>;\n}\n\nexport interface D3ScaleSystem {\n  x: HierarchicalScale;\n  y: HierarchicalScale;\n  color: d3.ScaleOrdinal<string, string>;\n  size: d3.ScaleLinear<number, number>;\n}\n\nexport interface RenderCommands {\n  cells: CellDrawCommand[];\n  headers: HeaderDrawCommand[];\n}\n\nexport interface CellDrawCommand {\n  type: 'cell';\n  bounds: Rect;\n  nodes: Node[];\n  rowKey: string;\n  colKey: string;\n  style: CellStyle;\n}\n\nexport interface HeaderDrawCommand {\n  type: 'header';\n  bounds: Rect;\n  label: string;\n  axis: 'x' | 'y';\n  level: number;\n}\n\nexport interface CellStyle {\n  fill: string;\n  stroke: string;\n  strokeWidth: number;\n  opacity: number;\n}\n\nexport interface PerformanceMetrics {\n  dataTransform: number;\n  scaleGeneration: number;\n  layoutCalculation: number;\n  renderPrep: number;\n  totalPipeline: number;\n  memoryUsage: number;\n  nodeCount: number;\n  cellCount: number;\n}\n\nexport interface D3CanvasState {\n  rawData: Node[];\n  groupedData: GroupedData;\n  scaleSystem: D3ScaleSystem;\n  viewport: Viewport;\n  renderCommands: RenderCommands;\n  performance: PerformanceMetrics;\n  error: string | null;\n  loading: boolean;\n}\n\ninterface StateChanges {\n  data: boolean;\n  pafv: boolean;\n  viewport: boolean;\n}\n\n// ============================================================================\n// Field Mapping & Extraction\n// ============================================================================\n\n// Use extractFieldValue from d3Scales utility, but ensure string output for keys\nconst extractFieldValueAsString = (node: Node, chip: Chip): string => {\n  const value = extractFieldValue(node, chip);\n  return String(value);\n};\n\nconst createCompositeKey = (node: Node, chips: Chip[]): string => {\n  return chips.map(chip => extractFieldValueAsString(node, chip)).join('|');\n};\n\n// ============================================================================\n// Performance Monitoring\n// ============================================================================\n\nclass PerformanceMonitor {\n  private startTimes: Map<string, number> = new Map();\n  private durations: Map<string, number> = new Map();\n\n  start(operation: string): void {\n    this.startTimes.set(operation, performance.now());\n  }\n\n  end(operation: string): number {\n    const startTime = this.startTimes.get(operation);\n    if (!startTime) return 0;\n\n    const duration = performance.now() - startTime;\n    this.durations.set(operation, duration);\n    return duration;\n  }\n\n  getDuration(operation: string): number {\n    return this.durations.get(operation) || 0;\n  }\n\n  getMetrics(): Partial<PerformanceMetrics> {\n    return {\n      dataTransform: this.getDuration('dataTransform'),\n      scaleGeneration: this.getDuration('scaleGeneration'),\n      layoutCalculation: this.getDuration('layoutCalculation'),\n      renderPrep: this.getDuration('renderPrep'),\n      totalPipeline: this.getDuration('totalPipeline'),\n    };\n  }\n\n  getMemoryUsage(): number {\n    const memory = (performance as { memory?: { usedJSHeapSize: number } }).memory;\n    return memory ? memory.usedJSHeapSize / 1024 / 1024 : 0; // MB\n  }\n}\n\n// ============================================================================\n// Data Pipeline Stages\n// ============================================================================\n\n// Stage 1: Data source (handled by useMockData)\n\n// Stage 2: PAFV Transform\nconst transformPAFVData = (nodes: Node[], wells: Wells): GroupedData => {\n  const rowChips = wells.rows.length > 0 ? wells.rows : [{ id: 'folder', label: 'Folder', hasCheckbox: false }];\n  const colChips = wells.columns.length > 0 ? wells.columns : [{ id: 'year', label: 'Year', hasCheckbox: false }];\n\n  const cells = new Map<string, CellData>();\n  const rowKeys = new Set<string>();\n  const colKeys = new Set<string>();\n\n  // Group nodes by row and column combinations\n  nodes.forEach(node => {\n    const rowKey = createCompositeKey(node, rowChips);\n    const colKey = createCompositeKey(node, colChips);\n    const cellKey = `${colKey}||${rowKey}`;\n\n    rowKeys.add(rowKey);\n    colKeys.add(colKey);\n\n    if (!cells.has(cellKey)) {\n      cells.set(cellKey, {\n        nodes: [],\n        bounds: { x: 0, y: 0, width: 0, height: 0 },\n        rowKey,\n        colKey,\n        rowPath: rowKey.split('|'),\n        colPath: colKey.split('|'),\n        isEmpty: true\n      });\n    }\n\n    const cell = cells.get(cellKey)!;\n    cell.nodes.push(node);\n    cell.isEmpty = false;\n  });\n\n  // Create domain maps for scale generation\n  const rowDomains = new Map<string, unknown[]>();\n  const colDomains = new Map<string, unknown[]>();\n\n  rowChips.forEach((chip, index) => {\n    const values = Array.from(rowKeys).map(key => key.split('|')[index]);\n    rowDomains.set(chip.id, Array.from(new Set(values)).sort());\n  });\n\n  colChips.forEach((chip, index) => {\n    const values = Array.from(colKeys).map(key => key.split('|')[index]);\n    colDomains.set(chip.id, Array.from(new Set(values)).sort());\n  });\n\n  return {\n    cells,\n    rowKeys: Array.from(rowKeys).sort(),\n    colKeys: Array.from(colKeys).sort(),\n    rowDomains,\n    colDomains\n  };\n};\n\n// Stage 3: Scale Generation\nconst generateScales = (\n  groupedData: GroupedData,\n  viewport: Viewport,\n  rowChips: Chip[],\n  colChips: Chip[],\n  nodes: Node[]\n): D3ScaleSystem => {\n  const systemConfig: ScaleSystemConfig = {\n    width: viewport.width,\n    height: viewport.height,\n    padding: {\n      top: 60,    // Space for column headers\n      right: 20,\n      bottom: 20,\n      left: 120   // Space for row headers\n    },\n    headerHeights: {\n      column: 30,\n      row: 100\n    }\n  };\n\n  return createScaleSystem(rowChips, colChips, nodes, systemConfig);\n};\n\n// Stage 4: Layout Calculation\nconst calculateLayout = (groupedData: GroupedData, scaleSystem: D3ScaleSystem): GroupedData => {\n  const updatedCells = new Map(groupedData.cells);\n\n  updatedCells.forEach((cell) => {\n    const x = scaleSystem.x.composite(cell.colKey) || 0;\n    const y = scaleSystem.y.composite(cell.rowKey) || 0;\n    const width = scaleSystem.x.composite.bandwidth();\n    const height = scaleSystem.y.composite.bandwidth();\n\n    cell.bounds = { x, y, width, height };\n  });\n\n  return {\n    ...groupedData,\n    cells: updatedCells\n  };\n};\n\n// Stage 5: Render Preparation\nconst prepareRenderCommands = (groupedData: GroupedData): RenderCommands => {\n  const cells: CellDrawCommand[] = [];\n\n  groupedData.cells.forEach((cell) => {\n    const nodeCount = cell.nodes.length;\n    const style: CellStyle = {\n      fill: nodeCount === 0 ? '#f9f9f9' : '#e3f2fd',\n      stroke: '#ccc',\n      strokeWidth: 1,\n      opacity: nodeCount === 0 ? 0.3 : Math.min(1, 0.3 + (nodeCount / 5))\n    };\n\n    cells.push({\n      type: 'cell',\n      bounds: cell.bounds,\n      nodes: cell.nodes,\n      rowKey: cell.rowKey,\n      colKey: cell.colKey,\n      style\n    });\n  });\n\n  // Headers will be implemented in Task 3\n  const headers: HeaderDrawCommand[] = [];\n\n  return { cells, headers };\n};\n\n// ============================================================================\n// Main Hook\n// ============================================================================\n\nexport function useD3Canvas(_containerRef?: React.RefObject<HTMLElement>): {\n  canvasState: D3CanvasState;\n  performance: PerformanceMetrics;\n  error: string | null;\n  updateViewport: (viewport: Partial<Viewport>) => void;\n} {\n  const { data: nodes, loading, error: dataError } = useMockData();\n  const { wells } = usePAFV();\n  const monitorRef = useRef(new PerformanceMonitor());\n\n  // Canvas state\n  const [canvasState, setCanvasState] = useState<D3CanvasState>(() => ({\n    rawData: [],\n    groupedData: {\n      cells: new Map(),\n      rowKeys: [],\n      colKeys: [],\n      rowDomains: new Map(),\n      colDomains: new Map()\n    },\n    scaleSystem: {\n      x: {\n        levels: [],\n        composite: d3.scaleBand(),\n        totalHeight: 0,\n        totalWidth: 0\n      },\n      y: {\n        levels: [],\n        composite: d3.scaleBand(),\n        totalHeight: 0,\n        totalWidth: 0\n      },\n      color: d3.scaleOrdinal(),\n      size: d3.scaleLinear()\n    },\n    viewport: {\n      x: 0,\n      y: 0,\n      width: 800,\n      height: 600,\n      scale: 1\n    },\n    renderCommands: { cells: [], headers: [] },\n    performance: {\n      dataTransform: 0,\n      scaleGeneration: 0,\n      layoutCalculation: 0,\n      renderPrep: 0,\n      totalPipeline: 0,\n      memoryUsage: 0,\n      nodeCount: 0,\n      cellCount: 0\n    },\n    error: null,\n    loading: false\n  }));\n\n  // Previous state for change detection\n  const prevStateRef = useRef({ nodes: [] as Node[], wells: wells });\n\n  // Detect changes\n  const detectChanges = useCallback((newNodes: Node[], newWells: Wells): StateChanges => {\n    const prev = prevStateRef.current;\n    return {\n      data: prev.nodes !== newNodes,\n      pafv: JSON.stringify(prev.wells) !== JSON.stringify(newWells),\n      viewport: false // Will be handled separately\n    };\n  }, []);\n\n  // Update viewport\n  const updateViewport = useCallback((newViewport: Partial<Viewport>) => {\n    setCanvasState(prev => ({\n      ...prev,\n      viewport: { ...prev.viewport, ...newViewport }\n    }));\n  }, []);\n\n  // Process data through pipeline\n  const processDataPipeline = useCallback((\n    inputNodes: Node[],\n    inputWells: Wells,\n    viewport: Viewport\n  ): D3CanvasState => {\n    const monitor = monitorRef.current;\n\n    monitor.start('totalPipeline');\n\n    try {\n      // Stage 2: PAFV Transform\n      monitor.start('dataTransform');\n      const groupedData = transformPAFVData(inputNodes, inputWells);\n      monitor.end('dataTransform');\n\n      // Stage 3: Scale Generation\n      monitor.start('scaleGeneration');\n      const rowChips = inputWells.rows.length > 0 ? inputWells.rows : [{ id: 'folder', label: 'Folder', hasCheckbox: false }];\n      const colChips = inputWells.columns.length > 0 ? inputWells.columns : [{ id: 'year', label: 'Year', hasCheckbox: false }];\n      const scaleSystem = generateScales(groupedData, viewport, rowChips, colChips, inputNodes);\n      monitor.end('scaleGeneration');\n\n      // Stage 4: Layout Calculation\n      monitor.start('layoutCalculation');\n      const positionedData = calculateLayout(groupedData, scaleSystem);\n      monitor.end('layoutCalculation');\n\n      // Stage 5: Render Preparation\n      monitor.start('renderPrep');\n      const renderCommands = prepareRenderCommands(positionedData);\n      monitor.end('renderPrep');\n\n      monitor.end('totalPipeline');\n\n      const performanceMetrics: PerformanceMetrics = {\n        ...monitor.getMetrics(),\n        memoryUsage: monitor.getMemoryUsage(),\n        nodeCount: inputNodes.length,\n        cellCount: positionedData.cells.size,\n        totalPipeline: monitor.getDuration('totalPipeline')\n      };\n\n      return {\n        rawData: inputNodes,\n        groupedData: positionedData,\n        scaleSystem,\n        viewport,\n        renderCommands,\n        performance: performanceMetrics,\n        error: null,\n        loading: false\n      };\n\n    } catch (error) {\n      console.error('D3 Canvas pipeline error:', error);\n      monitor.end('totalPipeline');\n\n      return {\n        rawData: inputNodes,\n        groupedData: {\n          cells: new Map(),\n          rowKeys: [],\n          colKeys: [],\n          rowDomains: new Map(),\n          colDomains: new Map()\n        },\n        scaleSystem: {\n          x: {\n            levels: [],\n            composite: d3.scaleBand(),\n            totalHeight: 0,\n            totalWidth: 0\n          },\n          y: {\n            levels: [],\n            composite: d3.scaleBand(),\n            totalHeight: 0,\n            totalWidth: 0\n          },\n          color: d3.scaleOrdinal(),\n          size: d3.scaleLinear()\n        },\n        viewport,\n        renderCommands: { cells: [], headers: [] },\n        performance: {\n          ...monitor.getMetrics(),\n          memoryUsage: monitor.getMemoryUsage(),\n          nodeCount: inputNodes.length,\n          cellCount: 0,\n          totalPipeline: monitor.getDuration('totalPipeline')\n        },\n        error: error instanceof Error ? error.message : 'Unknown pipeline error',\n        loading: false\n      };\n    }\n  }, []);\n\n  // Main effect - process data when inputs change\n  useEffect(() => {\n    if (loading || !nodes) {\n      setCanvasState(prev => ({ ...prev, loading: true, error: null }));\n      return;\n    }\n\n    if (dataError) {\n      setCanvasState(prev => ({ ...prev, error: dataError.message, loading: false }));\n      return;\n    }\n\n    const changes = detectChanges(nodes, wells);\n\n    if (changes.data || changes.pafv || canvasState.rawData.length === 0) {\n      // Full pipeline reprocessing needed\n      const newState = processDataPipeline(nodes, wells, canvasState.viewport);\n      setCanvasState(newState);\n\n      // Update previous state reference\n      prevStateRef.current = { nodes, wells };\n    }\n  }, [nodes, wells, loading, dataError, canvasState.viewport, processDataPipeline, detectChanges, canvasState.rawData.length]);\n\n  // Viewport change effect\n  useEffect(() => {\n    if (canvasState.rawData.length > 0) {\n      const newState = processDataPipeline(canvasState.rawData, wells, canvasState.viewport);\n      setCanvasState(newState);\n    }\n  }, [canvasState.viewport.width, canvasState.viewport.height]);\n\n  // Development logging\n  useEffect(() => {\n    if (process.env.NODE_ENV === 'development' && canvasState.performance.totalPipeline > 0) {\n      console.log('D3 Canvas Pipeline Performance:', {\n        total: `${canvasState.performance.totalPipeline.toFixed(2)}ms`,\n        stages: {\n          transform: `${canvasState.performance.dataTransform.toFixed(2)}ms`,\n          scales: `${canvasState.performance.scaleGeneration.toFixed(2)}ms`,\n          layout: `${canvasState.performance.layoutCalculation.toFixed(2)}ms`,\n          render: `${canvasState.performance.renderPrep.toFixed(2)}ms`\n        },\n        data: {\n          nodes: canvasState.performance.nodeCount,\n          cells: canvasState.performance.cellCount,\n          memory: `${canvasState.performance.memoryUsage.toFixed(1)}MB`\n        }\n      });\n    }\n  }, [canvasState.performance]);\n\n  return {\n    canvasState,\n    performance: canvasState.performance,\n    error: canvasState.error || dataError?.message || null,\n    updateViewport\n  };\n}","import * as d3 from 'd3';\n\n// ============================================================================\n// Object Pooling for Canvas Elements\n// ============================================================================\n\ninterface PoolableCanvasElement {\n  type: 'rect' | 'text' | 'circle' | 'path';\n  x: number;\n  y: number;\n  width?: number;\n  height?: number;\n  style: Record<string, string | number>;\n  text?: string;\n  reset(): void;\n}\n\nclass CanvasElement implements PoolableCanvasElement {\n  type: 'rect' | 'text' | 'circle' | 'path' = 'rect';\n  x: number = 0;\n  y: number = 0;\n  width?: number;\n  height?: number;\n  style: Record<string, string | number> = {};\n  text?: string;\n\n  constructor(type: PoolableCanvasElement['type'] = 'rect') {\n    this.type = type;\n  }\n\n  reset(): void {\n    this.x = 0;\n    this.y = 0;\n    this.width = undefined;\n    this.height = undefined;\n    this.style = {};\n    this.text = undefined;\n  }\n\n  configure(config: Partial<PoolableCanvasElement>): this {\n    Object.assign(this, config);\n    return this;\n  }\n}\n\nclass ObjectPool<T> {\n  private available: T[] = [];\n  private createFn: () => T;\n  private resetFn: (item: T) => void;\n\n  constructor(createFn: () => T, resetFn: (item: T) => void, initialSize: number = 10) {\n    this.createFn = createFn;\n    this.resetFn = resetFn;\n\n    // Pre-populate pool\n    for (let i = 0; i < initialSize; i++) {\n      this.available.push(createFn());\n    }\n  }\n\n  acquire(): T {\n    if (this.available.length === 0) {\n      return this.createFn();\n    }\n    return this.available.pop()!;\n  }\n\n  release(item: T): void {\n    this.resetFn(item);\n    this.available.push(item);\n  }\n\n  size(): { available: number; total: number } {\n    return {\n      available: this.available.length,\n      total: this.available.length // Only tracking available for now\n    };\n  }\n\n  clear(): void {\n    this.available = [];\n  }\n}\n\n// Global object pools\nexport const canvasElementPool = new ObjectPool(\n  () => new CanvasElement(),\n  (element) => element.reset(),\n  50 // Start with 50 elements\n);\n\nexport const rectElementPool = new ObjectPool(\n  () => new CanvasElement('rect'),\n  (element) => element.reset(),\n  30\n);\n\nexport const textElementPool = new ObjectPool(\n  () => new CanvasElement('text'),\n  (element) => element.reset(),\n  20\n);\n\n// ============================================================================\n// Canvas Texture Cache\n// ============================================================================\n\ninterface CachedTexture {\n  canvas: OffscreenCanvas;\n  ctx: OffscreenCanvasRenderingContext2D;\n  width: number;\n  height: number;\n  lastUsed: number;\n  cacheKey: string;\n}\n\nclass TextureCache {\n  private cache = new Map<string, CachedTexture>();\n  private maxEntries = 50;\n  private maxAge = 300000; // 5 minutes\n\n  createCacheKey(type: string, config: Record<string, string | number | boolean>): string {\n    return `${type}:${JSON.stringify(config)}`;\n  }\n\n  get(cacheKey: string): CachedTexture | null {\n    const texture = this.cache.get(cacheKey);\n    if (!texture) return null;\n\n    // Check if expired\n    if (Date.now() - texture.lastUsed > this.maxAge) {\n      this.cache.delete(cacheKey);\n      return null;\n    }\n\n    texture.lastUsed = Date.now();\n    return texture;\n  }\n\n  set(cacheKey: string, width: number, height: number, renderFn: (ctx: OffscreenCanvasRenderingContext2D) => void): CachedTexture {\n    // Clean up old entries if cache is full\n    if (this.cache.size >= this.maxEntries) {\n      const oldestKey = this.getOldestEntry();\n      if (oldestKey) {\n        this.cache.delete(oldestKey);\n      }\n    }\n\n    // Create offscreen canvas\n    const canvas = new OffscreenCanvas(width, height);\n    const ctx = canvas.getContext('2d')!;\n\n    // Render to texture\n    renderFn(ctx);\n\n    const texture: CachedTexture = {\n      canvas,\n      ctx,\n      width,\n      height,\n      lastUsed: Date.now(),\n      cacheKey\n    };\n\n    this.cache.set(cacheKey, texture);\n    return texture;\n  }\n\n  private getOldestEntry(): string | null {\n    let oldestKey: string | null = null;\n    let oldestTime = Date.now();\n\n    for (const [key, texture] of this.cache) {\n      if (texture.lastUsed < oldestTime) {\n        oldestTime = texture.lastUsed;\n        oldestKey = key;\n      }\n    }\n\n    return oldestKey;\n  }\n\n  clear(): void {\n    this.cache.clear();\n  }\n\n  size(): number {\n    return this.cache.size;\n  }\n\n  getStats(): { entries: number; memoryEstimate: number; oldestAge: number } {\n    const now = Date.now();\n    let memoryEstimate = 0;\n    let oldestAge = 0;\n\n    for (const texture of this.cache.values()) {\n      memoryEstimate += texture.width * texture.height * 4; // RGBA\n      oldestAge = Math.max(oldestAge, now - texture.lastUsed);\n    }\n\n    return {\n      entries: this.cache.size,\n      memoryEstimate,\n      oldestAge\n    };\n  }\n}\n\nexport const textureCache = new TextureCache();\n\n// ============================================================================\n// Spatial Indexing for Hit Testing\n// ============================================================================\n\ninterface SpatialItem {\n  id: string;\n  bounds: { x: number; y: number; width: number; height: number };\n  data: unknown;\n}\n\nclass SpatialIndex {\n  private items: SpatialItem[] = [];\n  private dirty = false;\n  private sorted = false;\n\n  insert(item: SpatialItem): void {\n    this.items.push(item);\n    this.dirty = true;\n  }\n\n  remove(id: string): boolean {\n    const index = this.items.findIndex(item => item.id === id);\n    if (index !== -1) {\n      this.items.splice(index, 1);\n      this.dirty = true;\n      return true;\n    }\n    return false;\n  }\n\n  clear(): void {\n    this.items = [];\n    this.dirty = false;\n    this.sorted = false;\n  }\n\n  query(x: number, y: number, width: number = 0, height: number = 0): SpatialItem[] {\n    if (this.dirty) {\n      this.rebuild();\n    }\n\n    const queryBounds = {\n      left: x,\n      top: y,\n      right: x + width,\n      bottom: y + height\n    };\n\n    return this.items.filter(item => {\n      const bounds = {\n        left: item.bounds.x,\n        top: item.bounds.y,\n        right: item.bounds.x + item.bounds.width,\n        bottom: item.bounds.y + item.bounds.height\n      };\n\n      return !(\n        queryBounds.right < bounds.left ||\n        queryBounds.left > bounds.right ||\n        queryBounds.bottom < bounds.top ||\n        queryBounds.top > bounds.bottom\n      );\n    });\n  }\n\n  findAtPoint(x: number, y: number): SpatialItem | null {\n    const items = this.query(x, y);\n    return items.length > 0 ? items[0] : null;\n  }\n\n  private rebuild(): void {\n    // Sort by x coordinate for faster queries\n    this.items.sort((a, b) => a.bounds.x - b.bounds.x);\n    this.dirty = false;\n    this.sorted = true;\n  }\n\n  size(): number {\n    return this.items.length;\n  }\n\n  getStats(): { items: number; dirty: boolean; sorted: boolean } {\n    return {\n      items: this.items.length,\n      dirty: this.dirty,\n      sorted: this.sorted\n    };\n  }\n}\n\nexport const spatialIndex = new SpatialIndex();\n\n// ============================================================================\n// Transition Management\n// ============================================================================\n\ninterface TransitionConfig {\n  duration: number;\n  easing: (t: number) => number;\n  onUpdate?: (progress: number) => void;\n  onComplete?: () => void;\n}\n\ninterface ActiveTransition {\n  id: string;\n  startTime: number;\n  config: TransitionConfig;\n  startValues: Record<string, number>;\n  endValues: Record<string, number>;\n  currentValues: Record<string, number>;\n}\n\nclass TransitionManager {\n  private activeTransitions = new Map<string, ActiveTransition>();\n  private animationFrame: number | null = null;\n\n  start(id: string, startValues: Record<string, number>, endValues: Record<string, number>, config: TransitionConfig): void {\n    const transition: ActiveTransition = {\n      id,\n      startTime: performance.now(),\n      config,\n      startValues: { ...startValues },\n      endValues: { ...endValues },\n      currentValues: { ...startValues }\n    };\n\n    this.activeTransitions.set(id, transition);\n    this.ensureAnimationLoop();\n  }\n\n  stop(id: string): boolean {\n    return this.activeTransitions.delete(id);\n  }\n\n  isActive(id: string): boolean {\n    return this.activeTransitions.has(id);\n  }\n\n  getCurrentValues(id: string): Record<string, number> | null {\n    const transition = this.activeTransitions.get(id);\n    return transition ? { ...transition.currentValues } : null;\n  }\n\n  private ensureAnimationLoop(): void {\n    if (this.animationFrame === null && this.activeTransitions.size > 0) {\n      this.animationFrame = requestAnimationFrame(() => this.update());\n    }\n  }\n\n  private update(): void {\n    const now = performance.now();\n    const completedTransitions: string[] = [];\n\n    for (const [id, transition] of this.activeTransitions) {\n      const elapsed = now - transition.startTime;\n      const progress = Math.min(elapsed / transition.config.duration, 1);\n      const easedProgress = transition.config.easing(progress);\n\n      // Update current values\n      for (const key in transition.startValues) {\n        const start = transition.startValues[key];\n        const end = transition.endValues[key];\n        transition.currentValues[key] = start + (end - start) * easedProgress;\n      }\n\n      // Call update callback\n      transition.config.onUpdate?.(progress);\n\n      // Check if completed\n      if (progress >= 1) {\n        completedTransitions.push(id);\n        transition.config.onComplete?.();\n      }\n    }\n\n    // Remove completed transitions\n    for (const id of completedTransitions) {\n      this.activeTransitions.delete(id);\n    }\n\n    // Continue loop if needed\n    if (this.activeTransitions.size > 0) {\n      this.animationFrame = requestAnimationFrame(() => this.update());\n    } else {\n      this.animationFrame = null;\n    }\n  }\n\n  getStats(): { active: number; hasAnimationFrame: boolean } {\n    return {\n      active: this.activeTransitions.size,\n      hasAnimationFrame: this.animationFrame !== null\n    };\n  }\n\n  clear(): void {\n    this.activeTransitions.clear();\n    if (this.animationFrame) {\n      cancelAnimationFrame(this.animationFrame);\n      this.animationFrame = null;\n    }\n  }\n}\n\nexport const transitionManager = new TransitionManager();\n\n// ============================================================================\n// Performance Monitoring\n// ============================================================================\n\ninterface PerformanceMetric {\n  name: string;\n  startTime: number;\n  duration?: number;\n  samples: number[];\n  lastUpdated: number;\n}\n\nclass PerformanceMonitor {\n  private metrics = new Map<string, PerformanceMetric>();\n  private frameTimeHistory: number[] = [];\n  private lastFrameTime = 0;\n  private maxHistorySize = 60; // Keep 60 samples for FPS calculation\n\n  startMetric(name: string): void {\n    this.metrics.set(name, {\n      name,\n      startTime: performance.now(),\n      samples: [],\n      lastUpdated: Date.now()\n    });\n  }\n\n  endMetric(name: string): number {\n    const metric = this.metrics.get(name);\n    if (!metric) return 0;\n\n    const duration = performance.now() - metric.startTime;\n    metric.duration = duration;\n    metric.samples.push(duration);\n    metric.lastUpdated = Date.now();\n\n    // Keep only recent samples\n    if (metric.samples.length > this.maxHistorySize) {\n      metric.samples.shift();\n    }\n\n    return duration;\n  }\n\n  recordFrameTime(): number {\n    const now = performance.now();\n    if (this.lastFrameTime > 0) {\n      const frameTime = now - this.lastFrameTime;\n      this.frameTimeHistory.push(frameTime);\n\n      if (this.frameTimeHistory.length > this.maxHistorySize) {\n        this.frameTimeHistory.shift();\n      }\n    }\n\n    this.lastFrameTime = now;\n    return this.getFPS();\n  }\n\n  getFPS(): number {\n    if (this.frameTimeHistory.length === 0) return 0;\n\n    const averageFrameTime = this.frameTimeHistory.reduce((sum, time) => sum + time, 0) / this.frameTimeHistory.length;\n    return 1000 / averageFrameTime;\n  }\n\n  getMetricStats(name: string): { average: number; min: number; max: number; latest: number; samples: number } | null {\n    const metric = this.metrics.get(name);\n    if (!metric || metric.samples.length === 0) return null;\n\n    const samples = metric.samples;\n    const average = samples.reduce((sum, val) => sum + val, 0) / samples.length;\n    const min = Math.min(...samples);\n    const max = Math.max(...samples);\n    const latest = samples[samples.length - 1];\n\n    return { average, min, max, latest, samples: samples.length };\n  }\n\n  getAllStats(): Record<string, unknown> {\n    const stats: Record<string, unknown> = {\n      fps: this.getFPS(),\n      frameHistory: this.frameTimeHistory.length\n    };\n\n    for (const [name, metric] of this.metrics) {\n      stats[name] = this.getMetricStats(name);\n    }\n\n    return stats;\n  }\n\n  clear(): void {\n    this.metrics.clear();\n    this.frameTimeHistory = [];\n    this.lastFrameTime = 0;\n  }\n\n  getMemoryUsage(): { used: number; total: number; percentage: number } {\n    const memory = (performance as { memory?: { usedJSHeapSize: number; totalJSHeapSize: number } }).memory;\n    if (memory) {\n      return {\n        used: memory.usedJSHeapSize / 1024 / 1024, // MB\n        total: memory.totalJSHeapSize / 1024 / 1024, // MB\n        percentage: (memory.usedJSHeapSize / memory.totalJSHeapSize) * 100\n      };\n    }\n    return { used: 0, total: 0, percentage: 0 };\n  }\n}\n\nexport const performanceMonitor = new PerformanceMonitor();\n\n// ============================================================================\n// Smooth PAFV Transition Effects\n// ============================================================================\n\nexport const createPAFVTransition = (\n  fromState: unknown,\n  toState: unknown,\n  duration: number = 300\n): Promise<void> => {\n  return new Promise((resolve) => {\n    const transitionId = `pafv-${Date.now()}`;\n\n    // Calculate animation values\n    const startValues = {\n      scaleProgress: 0\n    };\n\n    const endValues = {\n      scaleProgress: 1\n    };\n\n    transitionManager.start(transitionId, startValues, endValues, {\n      duration,\n      easing: d3.easeCubicInOut,\n      onUpdate: (progress) => {\n        // Custom PAFV transition logic can be added here\n        // For now, just track progress\n      },\n      onComplete: () => {\n        resolve();\n      }\n    });\n  });\n};\n\n// ============================================================================\n// Utility Functions\n// ============================================================================\n\nexport const debounce = <T extends (...args: unknown[]) => unknown>(\n  fn: T,\n  delay: number\n): ((...args: Parameters<T>) => void) => {\n  let timeoutId: ReturnType<typeof setTimeout>;\n  return (...args: Parameters<T>) => {\n    clearTimeout(timeoutId);\n    timeoutId = setTimeout(() => fn(...args), delay);\n  };\n};\n\nexport const throttle = <T extends (...args: unknown[]) => unknown>(\n  fn: T,\n  limit: number\n): ((...args: Parameters<T>) => void) => {\n  let inThrottle: boolean;\n  return (...args: Parameters<T>) => {\n    if (!inThrottle) {\n      fn(...args);\n      inThrottle = true;\n      setTimeout(() => (inThrottle = false), limit);\n    }\n  };\n};\n\nexport const measurePerformance = async <T>(\n  name: string,\n  fn: () => T | Promise<T>\n): Promise<T> => {\n  performanceMonitor.startMetric(name);\n  try {\n    const result = await fn();\n    performanceMonitor.endMetric(name);\n    return result;\n  } catch (error) {\n    performanceMonitor.endMetric(name);\n    throw error;\n  }\n};\n\n// ============================================================================\n// Performance Target Validation\n// ============================================================================\n\ninterface PerformanceTargets {\n  maxFrameTime: number; // 16ms for 60fps\n  maxPipelineTime: number; // 100ms for responsiveness\n  maxMemoryUsage: number; // 50MB\n  minFPS: number; // 30fps minimum\n}\n\nconst DEFAULT_TARGETS: PerformanceTargets = {\n  maxFrameTime: 16,\n  maxPipelineTime: 100,\n  maxMemoryUsage: 50,\n  minFPS: 30\n};\n\nexport const validatePerformanceTargets = (\n  targets: Partial<PerformanceTargets> = {}\n): {\n  passed: boolean;\n  results: Record<string, { target: number; actual: number; passed: boolean }>;\n} => {\n  const finalTargets = { ...DEFAULT_TARGETS, ...targets };\n  const currentFPS = performanceMonitor.getFPS();\n  const memory = performanceMonitor.getMemoryUsage();\n\n  const results = {\n    fps: {\n      target: finalTargets.minFPS,\n      actual: currentFPS,\n      passed: currentFPS >= finalTargets.minFPS\n    },\n    memory: {\n      target: finalTargets.maxMemoryUsage,\n      actual: memory.used,\n      passed: memory.used <= finalTargets.maxMemoryUsage\n    }\n  };\n\n  const passed = Object.values(results).every(result => result.passed);\n\n  return { passed, results };\n};\n\nexport default {\n  canvasElementPool,\n  rectElementPool,\n  textElementPool,\n  textureCache,\n  spatialIndex,\n  transitionManager,\n  performanceMonitor,\n  createPAFVTransition,\n  debounce,\n  throttle,\n  measurePerformance,\n  validatePerformanceTargets\n};","import React, { useRef, useEffect, useState, useCallback } from 'react';\nimport { useResizeObserver } from '../hooks/useD3';\nimport { useD3Canvas, type D3CanvasState, type Viewport } from '../hooks/useD3Canvas';\nimport { Node } from '../types';\nimport {\n  performanceMonitor,\n  spatialIndex,\n  transitionManager,\n  measurePerformance,\n  debounce\n} from '../utils/d3Performance';\nimport * as d3 from 'd3';\n\n// ============================================================================\n// Type Definitions - TypeScript strict mode compliant\n// ============================================================================\n\ninterface D3CanvasProps {\n  className?: string;\n  onCellClick?: (cellData: { nodes: Node[]; rowKey: string; colKey: string }) => void;\n  onError?: (error: string) => void;\n  showPerformanceOverlay?: boolean;\n}\n\ninterface CellData {\n  nodes: Node[];\n  rowKey: string;\n  colKey: string;\n}\n\ninterface InteractionState {\n  hoveredCell: string | null;\n  selectedCells: Set<string>;\n  isDragging: boolean;\n  dragStart: { x: number; y: number } | null;\n}\n\n// ============================================================================\n// Enhanced Performance Overlay Component\n// ============================================================================\n\ninterface D3PerformanceStats {\n  fps?: number;\n  frameHistory?: number;\n  totalPipeline?: number;\n  memoryUsage?: number;\n  nodeCount?: number;\n  cellCount?: number;\n  dataTransform?: number;\n  scaleGeneration?: number;\n  layoutCalculation?: number;\n  renderPrep?: number;\n  [key: string]: {\n    average: number;\n    min: number;\n    max: number;\n    latest: number;\n    samples: number;\n  } | number | undefined;\n}\n\ninterface PerformanceOverlayProps {\n  performance: D3PerformanceStats;\n  frameRate: number;\n  error: string | null;\n}\n\nconst PerformanceOverlay: React.FC<PerformanceOverlayProps> = ({\n  performance,\n  frameRate,\n  error\n}) => {\n  if (!performance || (performance.totalPipeline ?? 0) === 0) return null;\n\n  const renderStats = performanceMonitor.getMetricStats('canvas-render');\n  const spatialStats = spatialIndex.getStats();\n  const transitionStats = transitionManager.getStats();\n\n  return (\n    <div className=\"absolute top-2 right-2 bg-black bg-opacity-85 text-white text-xs p-3 rounded font-mono max-w-xs\">\n      <div className=\"mb-2 pb-2 border-b border-gray-600\">\n        <div className=\"text-yellow-300 font-bold mb-1\">Performance Monitor</div>\n      </div>\n\n      <div className=\"grid grid-cols-2 gap-x-3 gap-y-1 mb-3\">\n        <span>FPS:</span>\n        <span className={frameRate >= 30 ? 'text-green-400' : 'text-red-400'}>\n          {frameRate.toFixed(1)}\n        </span>\n\n        <span>Pipeline:</span>\n        <span className={(performance.totalPipeline ?? 0) <= 100 ? 'text-green-400' : 'text-yellow-400'}>\n          {(performance.totalPipeline ?? 0).toFixed(1)}ms\n        </span>\n\n        <span>Render:</span>\n        <span>{renderStats ? renderStats.latest.toFixed(1) : '0.0'}ms</span>\n\n        <span>Memory:</span>\n        <span className={(performance.memoryUsage ?? 0) <= 50 ? 'text-green-400' : 'text-yellow-400'}>\n          {(performance.memoryUsage ?? 0).toFixed(1)}MB\n        </span>\n\n        <span>Nodes:</span>\n        <span>{performance.nodeCount ?? 0}</span>\n\n        <span>Cells:</span>\n        <span>{performance.cellCount ?? 0}</span>\n      </div>\n\n      <div className=\"mb-3 pb-2 border-b border-gray-600\">\n        <div className=\"text-blue-300 font-medium mb-1\">Optimizations</div>\n        <div className=\"grid grid-cols-2 gap-x-3 gap-y-1\">\n          <span>Spatial:</span>\n          <span className=\"text-cyan-300\">{spatialStats.items} items</span>\n\n          <span>Transitions:</span>\n          <span className=\"text-purple-300\">{transitionStats.active} active</span>\n        </div>\n      </div>\n\n      <div className=\"grid grid-cols-2 gap-x-3 gap-y-1 text-xs\">\n        <span>Transform:</span>\n        <span>{(performance.dataTransform ?? 0).toFixed(1)}ms</span>\n\n        <span>Scales:</span>\n        <span>{(performance.scaleGeneration ?? 0).toFixed(1)}ms</span>\n\n        <span>Layout:</span>\n        <span>{(performance.layoutCalculation ?? 0).toFixed(1)}ms</span>\n\n        <span>Prep:</span>\n        <span>{(performance.renderPrep ?? 0).toFixed(1)}ms</span>\n      </div>\n\n      {error && (\n        <div className=\"mt-3 pt-2 border-t border-red-400 text-red-300\">\n          <div className=\"font-medium mb-1\">Error:</div>\n          <div className=\"text-xs\">{error}</div>\n        </div>\n      )}\n    </div>\n  );\n};\n\n// ============================================================================\n// Canvas Renderer\n// ============================================================================\n\nclass CanvasRenderer {\n  private ctx: CanvasRenderingContext2D;\n\n  constructor(ctx: CanvasRenderingContext2D) {\n    this.ctx = ctx;\n  }\n\n  clear(width: number, height: number): void {\n    this.ctx.clearRect(0, 0, width, height);\n  }\n\n  drawCell(\n    x: number,\n    y: number,\n    width: number,\n    height: number,\n    style: { fill: string; stroke: string; strokeWidth: number; opacity: number },\n    nodeCount: number\n  ): void {\n    this.ctx.save();\n    this.ctx.globalAlpha = style.opacity;\n\n    // Draw cell background\n    this.ctx.fillStyle = style.fill;\n    this.ctx.fillRect(x, y, width, height);\n\n    // Draw cell border\n    this.ctx.strokeStyle = style.stroke;\n    this.ctx.lineWidth = style.strokeWidth;\n    this.ctx.strokeRect(x, y, width, height);\n\n    // Draw node count if > 0\n    if (nodeCount > 0) {\n      this.ctx.fillStyle = '#333';\n      this.ctx.font = '12px sans-serif';\n      this.ctx.textAlign = 'center';\n      this.ctx.textBaseline = 'middle';\n      this.ctx.fillText(\n        String(nodeCount),\n        x + width / 2,\n        y + height / 2\n      );\n    }\n\n    this.ctx.restore();\n  }\n\n  drawText(\n    text: string,\n    x: number,\n    y: number,\n    options: {\n      font?: string;\n      fill?: string;\n      align?: CanvasTextAlign;\n      baseline?: CanvasTextBaseline;\n      maxWidth?: number;\n    } = {}\n  ): void {\n    this.ctx.save();\n    this.ctx.font = options.font || '12px sans-serif';\n    this.ctx.fillStyle = options.fill || '#333';\n    this.ctx.textAlign = options.align || 'left';\n    this.ctx.textBaseline = options.baseline || 'top';\n\n    if (options.maxWidth) {\n      this.ctx.fillText(text, x, y, options.maxWidth);\n    } else {\n      this.ctx.fillText(text, x, y);\n    }\n    this.ctx.restore();\n  }\n}\n\n// ============================================================================\n// SVG Header Renderer\n// ============================================================================\n\nconst renderSVGHeaders = (\n  svg: SVGSVGElement,\n  canvasState: D3CanvasState,\n  _viewport: Viewport\n): void => {\n  const svgSelection = d3.select(svg);\n\n  // Clear previous content\n  svgSelection.selectAll('*').remove();\n\n  // For now, create simple placeholder headers\n  // TODO: Implement full hierarchical header rendering in next phase\n\n  const { scaleSystem } = canvasState;\n\n  // Column headers\n  const colHeaderHeight = 50;\n  const colHeaders = svgSelection\n    .append('g')\n    .attr('class', 'column-headers')\n    .attr('transform', `translate(0, 0)`);\n\n  scaleSystem.x.composite.domain().forEach((colKey, _index) => {\n    const x = scaleSystem.x.composite(colKey) || 0;\n    const width = scaleSystem.x.composite.bandwidth();\n\n    const header = colHeaders\n      .append('g')\n      .attr('class', 'column-header')\n      .attr('transform', `translate(${x}, 0)`);\n\n    header\n      .append('rect')\n      .attr('width', width)\n      .attr('height', colHeaderHeight)\n      .attr('fill', '#f5f5f5')\n      .attr('stroke', '#ccc')\n      .attr('stroke-width', 1);\n\n    header\n      .append('text')\n      .attr('x', width / 2)\n      .attr('y', colHeaderHeight / 2)\n      .attr('text-anchor', 'middle')\n      .attr('dominant-baseline', 'central')\n      .attr('font-size', '11px')\n      .attr('font-weight', 'bold')\n      .text(colKey.split('|').join('  '));\n  });\n\n  // Row headers\n  const rowHeaderWidth = 100;\n  const rowHeaders = svgSelection\n    .append('g')\n    .attr('class', 'row-headers')\n    .attr('transform', `translate(0, ${colHeaderHeight})`);\n\n  scaleSystem.y.composite.domain().forEach((rowKey, _index) => {\n    const y = scaleSystem.y.composite(rowKey) || 0;\n    const height = scaleSystem.y.composite.bandwidth();\n\n    const header = rowHeaders\n      .append('g')\n      .attr('class', 'row-header')\n      .attr('transform', `translate(0, ${y})`);\n\n    header\n      .append('rect')\n      .attr('width', rowHeaderWidth)\n      .attr('height', height)\n      .attr('fill', '#f5f5f5')\n      .attr('stroke', '#ccc')\n      .attr('stroke-width', 1);\n\n    header\n      .append('text')\n      .attr('x', rowHeaderWidth / 2)\n      .attr('y', height / 2)\n      .attr('text-anchor', 'middle')\n      .attr('dominant-baseline', 'central')\n      .attr('font-size', '11px')\n      .attr('font-weight', 'bold')\n      .text(rowKey.split('|').join('  '));\n  });\n};\n\n// ============================================================================\n// Main D3Canvas Component\n// ============================================================================\n\nexport const D3Canvas: React.FC<D3CanvasProps> = ({\n  className = '',\n  onCellClick,\n  onError,\n  showPerformanceOverlay = process.env.NODE_ENV === 'development'\n}) => {\n  // Refs for the three layers\n  const containerRef = useRef<HTMLDivElement>(null);\n  const svgRef = useRef<SVGSVGElement>(null);\n  const canvasRef = useRef<HTMLCanvasElement>(null);\n  const overlayRef = useRef<HTMLDivElement>(null);\n\n  // D3 Canvas state\n  const { canvasState, performance, error, updateViewport } = useD3Canvas(containerRef);\n\n  // Interaction state\n  const [interactionState, setInteractionState] = useState<InteractionState>({\n    hoveredCell: null,\n    selectedCells: new Set(),\n    isDragging: false,\n    dragStart: null\n  });\n\n  // Performance tracking\n  const [frameRate, setFrameRate] = useState(0);\n\n  // Viewport state\n  const [viewport, setViewport] = useState<Viewport>({\n    x: 0,\n    y: 0,\n    width: 800,\n    height: 600,\n    scale: 1\n  });\n\n  // Handle container resize\n  const handleResize = useCallback((entry: ResizeObserverEntry) => {\n    const { width, height } = entry.contentRect;\n    const newViewport = {\n      ...viewport,\n      width,\n      height\n    };\n\n    setViewport(newViewport);\n    updateViewport(newViewport);\n\n    // Update canvas size\n    if (canvasRef.current) {\n      canvasRef.current.width = width;\n      canvasRef.current.height = height;\n    }\n\n    // Update SVG size\n    if (svgRef.current) {\n      svgRef.current.setAttribute('width', String(width));\n      svgRef.current.setAttribute('height', String(height));\n    }\n  }, [viewport, updateViewport]);\n\n  // Use resize observer for responsive sizing\n  useResizeObserver(containerRef, handleResize);\n\n  // Optimized canvas rendering with performance monitoring\n  const debouncedRender = useCallback(\n    debounce(async () => {\n      if (!canvasRef.current || !canvasState.renderCommands.cells.length) return;\n\n      const canvas = canvasRef.current;\n      const ctx = canvas.getContext('2d');\n      if (!ctx) return;\n\n      await measurePerformance('canvas-render', async () => {\n        const renderer = new CanvasRenderer(ctx);\n\n        // Clear canvas\n        renderer.clear(canvas.width, canvas.height);\n\n        // Update spatial index for hit testing\n        spatialIndex.clear();\n\n        // Render cells with spatial indexing\n        canvasState.renderCommands.cells.forEach(cellCommand => {\n          const { bounds, style, nodes, rowKey, colKey } = cellCommand;\n\n          renderer.drawCell(\n            bounds.x,\n            bounds.y,\n            bounds.width,\n            bounds.height,\n            style,\n            nodes.length\n          );\n\n          // Add to spatial index for hit testing\n          spatialIndex.insert({\n            id: `${colKey}||${rowKey}`,\n            bounds,\n            data: { nodes, rowKey, colKey }\n          });\n        });\n\n        // Update frame rate\n        const fps = performanceMonitor.recordFrameTime();\n        setFrameRate(fps);\n      });\n    }, 16), // 60fps debouncing\n    [canvasState.renderCommands, spatialIndex]\n  );\n\n  // Render canvas content when state changes\n  useEffect(() => {\n    debouncedRender();\n  }, [debouncedRender]);\n\n  // Render SVG headers when state changes\n  useEffect(() => {\n    if (!svgRef.current || canvasState.error) return;\n\n    renderSVGHeaders(svgRef.current, canvasState, viewport);\n  }, [canvasState, viewport]);\n\n  // Optimized mouse interactions with spatial indexing\n  const handleMouseMove = useCallback((event: React.MouseEvent) => {\n    if (!canvasRef.current) return;\n\n    const canvas = canvasRef.current;\n    const rect = canvas.getBoundingClientRect();\n    const x = event.clientX - rect.left;\n    const y = event.clientY - rect.top;\n\n    // Optimized hit testing using spatial index\n    const hitItem = spatialIndex.findAtPoint(x, y);\n    const hoveredCell = hitItem?.id || null;\n\n    if (hoveredCell !== interactionState.hoveredCell) {\n      setInteractionState(prev => ({\n        ...prev,\n        hoveredCell\n      }));\n\n      // Update cursor\n      if (canvas.style) {\n        canvas.style.cursor = hoveredCell ? 'pointer' : 'default';\n      }\n    }\n  }, [interactionState.hoveredCell]);\n\n  const handleClick = useCallback((event: React.MouseEvent) => {\n    if (!canvasRef.current) return;\n\n    const canvas = canvasRef.current;\n    const rect = canvas.getBoundingClientRect();\n    const x = event.clientX - rect.left;\n    const y = event.clientY - rect.top;\n\n    // Optimized click handling using spatial index\n    const hitItem = spatialIndex.findAtPoint(x, y);\n    if (hitItem && hitItem.data) {\n      const cellData = hitItem.data as CellData;\n      const { nodes, rowKey, colKey } = cellData;\n\n      // Call click handler\n      onCellClick?.({\n        nodes,\n        rowKey,\n        colKey\n      });\n\n      // Update selection with smooth transition\n      const cellKey = hitItem.id;\n      setInteractionState(prev => {\n        const newSelected = new Set(prev.selectedCells);\n        if (newSelected.has(cellKey)) {\n          newSelected.delete(cellKey);\n        } else {\n          newSelected.add(cellKey);\n        }\n        return {\n          ...prev,\n          selectedCells: newSelected\n        };\n      });\n    }\n  }, [onCellClick]);\n\n  // Report errors to parent\n  useEffect(() => {\n    if (error && onError) {\n      onError(error);\n    }\n  }, [error, onError]);\n\n  // Loading state\n  if (canvasState.loading) {\n    return (\n      <div className={`flex items-center justify-center h-full ${className}`}>\n        <div className=\"text-gray-500\">Loading D3 Canvas...</div>\n      </div>\n    );\n  }\n\n  // Error state\n  if (canvasState.error) {\n    return (\n      <div className={`flex items-center justify-center h-full ${className}`}>\n        <div className=\"text-red-500\">\n          D3 Canvas Error: {canvasState.error}\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div\n      ref={containerRef}\n      className={`relative w-full h-full overflow-hidden ${className}`}\n    >\n      {/* SVG Layer - Headers and interactive elements */}\n      <svg\n        ref={svgRef}\n        className=\"absolute inset-0 pointer-events-none\"\n        style={{ zIndex: 2 }}\n        width={viewport.width}\n        height={viewport.height}\n      />\n\n      {/* Canvas Layer - High-performance data rendering */}\n      <canvas\n        ref={canvasRef}\n        className=\"absolute inset-0\"\n        style={{ zIndex: 1 }}\n        width={viewport.width}\n        height={viewport.height}\n        onMouseMove={handleMouseMove}\n        onClick={handleClick}\n      />\n\n      {/* DOM Overlay Layer - Accessibility and complex interactions */}\n      <div\n        ref={overlayRef}\n        className=\"absolute inset-0 pointer-events-none\"\n        style={{ zIndex: 3 }}\n      >\n        {/* Enhanced performance overlay */}\n        {showPerformanceOverlay && (\n          <PerformanceOverlay\n            performance={performance}\n            frameRate={frameRate}\n            error={error}\n          />\n        )}\n\n        {/* Future: Tooltips, accessibility layer, complex controls */}\n      </div>\n    </div>\n  );\n};\n\nexport default D3Canvas;","import { useRef, useEffect } from 'react';\nimport * as d3 from 'd3';\n\ntype D3Selection<T extends SVGElement> = d3.Selection<T, unknown, null, undefined>;\n\nexport function useD3<T extends SVGElement = SVGSVGElement>(\n  renderFn: (selection: D3Selection<T>) => void | (() => void),\n  deps: unknown[] = []\n): React.RefObject<T> {\n  const ref = useRef<T>(null);\n  \n  useEffect(() => {\n    if (!ref.current) return;\n    \n    const selection = d3.select(ref.current);\n    const cleanup = renderFn(selection as D3Selection<T>);\n    \n    return () => {\n      if (typeof cleanup === 'function') {\n        cleanup();\n      }\n    };\n  }, deps);\n  \n  return ref;\n}\n\n// Hook for managing resize observations\nexport function useResizeObserver(\n  ref: React.RefObject<Element>,\n  callback: (entry: ResizeObserverEntry) => void\n): void {\n  useEffect(() => {\n    if (!ref.current) return;\n    \n    const observer = new ResizeObserver((entries) => {\n      if (entries[0]) {\n        callback(entries[0]);\n      }\n    });\n    \n    observer.observe(ref.current);\n    return () => observer.disconnect();\n  }, [ref, callback]);\n}\n","import React, { useState, useCallback, useRef, useEffect } from 'react';\nimport { D3Canvas } from '../D3Canvas';\nimport { usePAFV } from '../../contexts/PAFVContext';\nimport { useTheme } from '../../contexts/ThemeContext';\nimport type { Node } from '../../types/node';\nimport * as d3 from 'd3';\n\ninterface D3GridViewProps {\n  data: Node[];\n  onNodeClick?: (node: Node) => void;\n}\n\ninterface CellDetailOverlay {\n  visible: boolean;\n  nodes: Node[];\n  position: { x: number; y: number };\n  rowKey: string;\n  colKey: string;\n}\n\ninterface GridInteractionState {\n  hoveredCell: string | null;\n  selectedCells: Set<string>;\n  zoomTransform: d3.ZoomTransform | null;\n  isDragging: boolean;\n}\n\n/**\n * Enhanced D3-powered Grid View component\n *\n * Features:\n * - Hierarchical header rendering with PAFV axes\n * - Cell hover effects and selection states\n * - Smooth transitions for axis changes\n * - Cell detail overlays with node information\n * - Pan/zoom functionality for large datasets\n * - Performance optimization with canvas rendering\n */\nexport function D3GridView({ data: _data, onNodeClick }: D3GridViewProps) {\n  const { wells } = usePAFV();\n  const { theme } = useTheme();\n\n  // Component state\n  const [cellDetailOverlay, setCellDetailOverlay] = useState<CellDetailOverlay>({\n    visible: false,\n    nodes: [],\n    position: { x: 0, y: 0 },\n    rowKey: '',\n    colKey: ''\n  });\n\n  const [interactionState, setInteractionState] = useState<GridInteractionState>({\n    hoveredCell: null,\n    selectedCells: new Set(),\n    zoomTransform: null,\n    isDragging: false\n  });\n\n  const containerRef = useRef<HTMLDivElement>(null);\n\n  // Handle cell interactions\n  const handleCellClick = useCallback((cellData: { nodes: Node[]; rowKey: string; colKey: string }) => {\n    const cellKey = `${cellData.colKey}||${cellData.rowKey}`;\n\n    // Update selection state\n    setInteractionState(prev => {\n      const newSelected = new Set(prev.selectedCells);\n      if (newSelected.has(cellKey)) {\n        newSelected.delete(cellKey);\n      } else {\n        newSelected.add(cellKey);\n      }\n      return { ...prev, selectedCells: newSelected };\n    });\n\n    // Show cell detail overlay if multiple nodes\n    if (cellData.nodes.length > 1) {\n      setCellDetailOverlay({\n        visible: true,\n        nodes: cellData.nodes,\n        position: { x: 0, y: 0 }, // Will be updated by mouse position\n        rowKey: cellData.rowKey,\n        colKey: cellData.colKey\n      });\n    } else if (cellData.nodes.length === 1 && onNodeClick) {\n      // Single node click\n      onNodeClick(cellData.nodes[0]);\n    }\n  }, [onNodeClick]);\n\n\n  const handleError = useCallback((error: string) => {\n    console.error('D3GridView error:', error);\n  }, []);\n\n  // Close overlay when clicking outside\n  const handleOverlayClick = useCallback((e: React.MouseEvent) => {\n    if (e.target === e.currentTarget) {\n      setCellDetailOverlay(prev => ({ ...prev, visible: false }));\n    }\n  }, []);\n\n  // Pan/zoom setup\n  useEffect(() => {\n    if (!containerRef.current) return;\n\n    const container = d3.select(containerRef.current);\n    const zoom = d3.zoom<HTMLDivElement, unknown>()\n      .scaleExtent([0.5, 5])\n      .on('zoom', (event) => {\n        setInteractionState(prev => ({\n          ...prev,\n          zoomTransform: event.transform\n        }));\n      });\n\n    container.call(zoom);\n\n    return () => {\n      container.on('.zoom', null);\n    };\n  }, []);\n\n  // Calculate axis summary for display\n  const axisSummary = `${wells.rows.map(chip => chip.label).join('  ')} vs ${wells.columns.map(chip => chip.label).join('  ')}`;\n\n  return (\n    <div className=\"d3-grid-view w-full h-full relative\">\n      {/* Axis Configuration Summary */}\n      <div className={`absolute top-2 left-2 z-10 px-2 py-1 text-xs rounded ${\n        theme === 'NeXTSTEP'\n          ? 'bg-[#e8e8e8] border border-[#c0c0c0] text-gray-700'\n          : 'bg-white border border-gray-200 text-gray-600 shadow-sm'\n      }`}>\n        <span className=\"font-medium\">Grid:</span> {axisSummary}\n      </div>\n\n      {/* Main D3 Canvas */}\n      <div ref={containerRef} className=\"w-full h-full\">\n        <D3Canvas\n          className=\"d3-grid-canvas\"\n          onCellClick={handleCellClick}\n          onError={handleError}\n          showPerformanceOverlay={process.env.NODE_ENV === 'development'}\n        />\n      </div>\n\n      {/* Zoom Controls */}\n      <div className={`absolute bottom-2 right-2 z-10 flex flex-col gap-1 ${\n        theme === 'NeXTSTEP' ? 'bg-[#e8e8e8]' : 'bg-white shadow-lg'\n      } border border-gray-300 rounded p-1`}>\n        <button\n          className={`px-2 py-1 text-xs ${\n            theme === 'NeXTSTEP'\n              ? 'bg-[#c0c0c0] hover:bg-[#b0b0b0] border border-[#808080]'\n              : 'bg-gray-100 hover:bg-gray-200 border border-gray-300'\n          }`}\n          onClick={() => {\n            if (containerRef.current) {\n              const zoom = d3.zoom<HTMLDivElement, unknown>();\n              d3.select(containerRef.current).transition().call(zoom.scaleBy, 1.5);\n            }\n          }}\n          title=\"Zoom In\"\n        >\n          +\n        </button>\n        <button\n          className={`px-2 py-1 text-xs ${\n            theme === 'NeXTSTEP'\n              ? 'bg-[#c0c0c0] hover:bg-[#b0b0b0] border border-[#808080]'\n              : 'bg-gray-100 hover:bg-gray-200 border border-gray-300'\n          }`}\n          onClick={() => {\n            if (containerRef.current) {\n              const zoom = d3.zoom<HTMLDivElement, unknown>();\n              d3.select(containerRef.current).transition().call(zoom.scaleBy, 0.67);\n            }\n          }}\n          title=\"Zoom Out\"\n        >\n          \n        </button>\n        <button\n          className={`px-2 py-1 text-xs ${\n            theme === 'NeXTSTEP'\n              ? 'bg-[#c0c0c0] hover:bg-[#b0b0b0] border border-[#808080]'\n              : 'bg-gray-100 hover:bg-gray-200 border border-gray-300'\n          }`}\n          onClick={() => {\n            if (containerRef.current) {\n              const zoom = d3.zoom<HTMLDivElement, unknown>();\n              d3.select(containerRef.current).transition().call(zoom.transform, d3.zoomIdentity);\n            }\n          }}\n          title=\"Reset Zoom\"\n        >\n          \n        </button>\n      </div>\n\n      {/* Cell Detail Overlay */}\n      {cellDetailOverlay.visible && (\n        <div\n          className=\"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center\"\n          onClick={handleOverlayClick}\n        >\n          <div\n            className={`max-w-md w-full mx-4 p-4 rounded-lg ${\n              theme === 'NeXTSTEP'\n                ? 'bg-white border-2 border-[#808080]'\n                : 'bg-white shadow-xl border border-gray-200'\n            }`}\n            onClick={(e) => e.stopPropagation()}\n          >\n            {/* Header */}\n            <div className=\"flex items-center justify-between mb-3\">\n              <h3 className=\"font-semibold text-lg\">\n                Cell Details\n              </h3>\n              <button\n                onClick={() => setCellDetailOverlay(prev => ({ ...prev, visible: false }))}\n                className={`px-2 py-1 text-sm ${\n                  theme === 'NeXTSTEP'\n                    ? 'bg-[#e8e8e8] hover:bg-[#d8d8d8]'\n                    : 'bg-gray-100 hover:bg-gray-200'\n                } rounded`}\n              >\n                \n              </button>\n            </div>\n\n            {/* Cell Information */}\n            <div className=\"mb-4 p-3 bg-gray-50 rounded\">\n              <div className=\"text-sm\">\n                <div><span className=\"font-medium\">Row:</span> {cellDetailOverlay.rowKey.split('|').join('  ')}</div>\n                <div><span className=\"font-medium\">Column:</span> {cellDetailOverlay.colKey.split('|').join('  ')}</div>\n                <div><span className=\"font-medium\">Count:</span> {cellDetailOverlay.nodes.length} items</div>\n              </div>\n            </div>\n\n            {/* Node List */}\n            <div className=\"space-y-2 max-h-60 overflow-y-auto\">\n              {cellDetailOverlay.nodes.map((node) => (\n                <div\n                  key={node.id}\n                  className={`p-2 rounded border cursor-pointer transition-colors ${\n                    theme === 'NeXTSTEP'\n                      ? 'border-[#c0c0c0] hover:bg-[#f5f5f5]'\n                      : 'border-gray-200 hover:bg-gray-50'\n                  }`}\n                  onClick={() => {\n                    onNodeClick?.(node);\n                    setCellDetailOverlay(prev => ({ ...prev, visible: false }));\n                  }}\n                >\n                  <div className=\"font-medium text-sm\">{node.name}</div>\n                  {node.content && (\n                    <div className=\"text-xs text-gray-600 truncate mt-1\">\n                      {node.content}\n                    </div>\n                  )}\n                  <div className=\"flex items-center gap-2 mt-1\">\n                    <span className={`px-1 py-0.5 text-xs rounded ${\n                      node.priority === 'high' ? 'bg-red-100 text-red-700' :\n                      node.priority === 'medium' ? 'bg-yellow-100 text-yellow-700' :\n                      'bg-green-100 text-green-700'\n                    }`}>\n                      {node.priority}\n                    </span>\n                    <span className=\"text-xs text-gray-500\">{node.status}</span>\n                  </div>\n                </div>\n              ))}\n            </div>\n          </div>\n        </div>\n      )}\n\n      {/* Development Info */}\n      {process.env.NODE_ENV === 'development' && (\n        <div className=\"absolute top-2 right-2 z-10 bg-black bg-opacity-75 text-white text-xs p-2 rounded\">\n          <div>Selected: {interactionState.selectedCells.size}</div>\n          <div>Hovered: {interactionState.hoveredCell || 'none'}</div>\n          {interactionState.zoomTransform && (\n            <div>Zoom: {interactionState.zoomTransform.k.toFixed(2)}x</div>\n          )}\n        </div>\n      )}\n    </div>\n  );\n}\n\nexport default D3GridView;","import React, { useState, useCallback, useMemo, useRef, useEffect } from 'react';\nimport { Search, X, ArrowUpDown } from 'lucide-react';\nimport { usePAFV } from '../../contexts/PAFVContext';\nimport { useTheme } from '../../contexts/ThemeContext';\nimport type { Node } from '../../types/node';\nimport * as d3 from 'd3';\n\ninterface D3ListViewProps {\n  data: Node[];\n  onNodeClick?: (node: Node) => void;\n}\n\ninterface ListItem {\n  id: string;\n  node: Node;\n  index: number;\n  groupKey?: string;\n  isGroupHeader?: boolean;\n  groupLabel?: string;\n  groupCount?: number;\n  isVisible?: boolean;\n}\n\ninterface ListGroup {\n  key: string;\n  label: string;\n  nodes: Node[];\n  collapsed: boolean;\n}\n\ninterface ListState {\n  searchQuery: string;\n  sortDirection: 'asc' | 'desc';\n  groupingEnabled: boolean;\n  collapsedGroups: Set<string>;\n  selectedItems: Set<string>;\n  hoveredItem: string | null;\n}\n\nconst ITEM_HEIGHT = 80;\nconst GROUP_HEADER_HEIGHT = 40;\nconst SEARCH_BAR_HEIGHT = 60;\n\n/**\n * Enhanced D3-powered List View component\n *\n * Features:\n * - D3-based virtual scrolling for efficient rendering\n * - Animated search result filtering and highlighting\n * - Group headers with expand/collapse functionality\n * - Sort animations and smooth list reordering\n * - Performance optimized for large datasets\n * - Smooth transitions and visual feedback\n */\nexport function D3ListView({ data, onNodeClick }: D3ListViewProps) {\n  const { wells } = usePAFV();\n  const { theme } = useTheme();\n  const svgRef = useRef<SVGSVGElement>(null);\n  const containerRef = useRef<HTMLDivElement>(null);\n\n  // Component state\n  const [listState, setListState] = useState<ListState>({\n    searchQuery: '',\n    sortDirection: 'desc',\n    groupingEnabled: true,\n    collapsedGroups: new Set(),\n    selectedItems: new Set(),\n    hoveredItem: null\n  });\n\n  // Virtual scrolling state\n  const [scrollTop, setScrollTop] = useState(0);\n  const [containerHeight, setContainerHeight] = useState(400);\n  const [animating, setAnimating] = useState(false);\n\n  // Create groups based on PAFV Y-axis\n  const groups = useMemo((): ListGroup[] => {\n    if (!listState.groupingEnabled || wells.rows.length === 0) {\n      return [{\n        key: 'all',\n        label: 'All Items',\n        nodes: data,\n        collapsed: false\n      }];\n    }\n\n    const groupMap = new Map<string, Node[]>();\n    const firstRowChip = wells.rows[0];\n\n    data.forEach(node => {\n      const groupValue = getFieldValue(node, firstRowChip.id);\n      const groupKey = String(groupValue);\n\n      if (!groupMap.has(groupKey)) {\n        groupMap.set(groupKey, []);\n      }\n      groupMap.get(groupKey)!.push(node);\n    });\n\n    return Array.from(groupMap.entries()).map(([key, nodes]) => ({\n      key,\n      label: key,\n      nodes: nodes.sort((a, b) => {\n        const aTime = new Date(a.modifiedAt).getTime();\n        const bTime = new Date(b.modifiedAt).getTime();\n        return listState.sortDirection === 'desc' ? bTime - aTime : aTime - bTime;\n      }),\n      collapsed: listState.collapsedGroups.has(key)\n    }));\n  }, [data, wells.rows, listState.groupingEnabled, listState.collapsedGroups, listState.sortDirection]);\n\n  // Filter nodes by search query\n  const filteredGroups = useMemo((): ListGroup[] => {\n    if (!listState.searchQuery.trim()) {\n      return groups;\n    }\n\n    const query = listState.searchQuery.toLowerCase();\n    return groups.map(group => ({\n      ...group,\n      nodes: group.nodes.filter(node =>\n        node.name.toLowerCase().includes(query) ||\n        node.content?.toLowerCase().includes(query) ||\n        (node as any).tags?.some?.((tag: string) => tag.toLowerCase().includes(query))\n      )\n    })).filter(group => group.nodes.length > 0);\n  }, [groups, listState.searchQuery]);\n\n  // Create flat list of items for virtual scrolling\n  const listItems = useMemo((): ListItem[] => {\n    const items: ListItem[] = [];\n    let globalIndex = 0;\n\n    filteredGroups.forEach(group => {\n      if (listState.groupingEnabled) {\n        // Add group header\n        items.push({\n          id: `group-${group.key}`,\n          node: {} as Node,\n          index: globalIndex++,\n          groupKey: group.key,\n          isGroupHeader: true,\n          groupLabel: group.label,\n          groupCount: group.nodes.length,\n          isVisible: true\n        });\n      }\n\n      // Add group items (only if not collapsed)\n      if (!group.collapsed) {\n        group.nodes.forEach(node => {\n          items.push({\n            id: node.id,\n            node,\n            index: globalIndex++,\n            groupKey: group.key,\n            isGroupHeader: false,\n            isVisible: true\n          });\n        });\n      }\n    });\n\n    return items;\n  }, [filteredGroups, listState.groupingEnabled]);\n\n  // Calculate visible items for virtual scrolling\n  const visibleItems = useMemo(() => {\n    const startY = scrollTop;\n    const endY = scrollTop + containerHeight;\n\n    let currentY = 0;\n    const visible: { item: ListItem; y: number; height: number }[] = [];\n\n    for (const item of listItems) {\n      const itemHeight = item.isGroupHeader ? GROUP_HEADER_HEIGHT : ITEM_HEIGHT;\n\n      if (currentY + itemHeight >= startY && currentY <= endY) {\n        visible.push({ item, y: currentY - scrollTop, height: itemHeight });\n      }\n\n      currentY += itemHeight;\n\n      // Early exit if we're past the visible area\n      if (currentY > endY) break;\n    }\n\n    return visible;\n  }, [listItems, scrollTop, containerHeight]);\n\n  // Helper function to get field value\n  function getFieldValue(node: Node, chipId: string): string {\n    const fieldMap: Record<string, keyof Node> = {\n      folder: 'folder',\n      status: 'status',\n      priority: 'priority',\n    };\n\n    const field = fieldMap[chipId] || 'folder';\n    return String(node[field] ?? 'Unknown');\n  }\n\n  // Event handlers\n  const handleSearch = useCallback((query: string) => {\n    setListState(prev => ({ ...prev, searchQuery: query }));\n  }, []);\n\n  const clearSearch = useCallback(() => {\n    setListState(prev => ({ ...prev, searchQuery: '' }));\n  }, []);\n\n  const toggleSort = useCallback(() => {\n    setAnimating(true);\n    setListState(prev => ({\n      ...prev,\n      sortDirection: prev.sortDirection === 'desc' ? 'asc' : 'desc'\n    }));\n\n    // Clear animation flag after transition\n    setTimeout(() => setAnimating(false), 300);\n  }, []);\n\n  const toggleGrouping = useCallback(() => {\n    setListState(prev => ({\n      ...prev,\n      groupingEnabled: !prev.groupingEnabled,\n      collapsedGroups: new Set() // Reset collapsed state\n    }));\n  }, []);\n\n  const toggleGroupCollapse = useCallback((groupKey: string) => {\n    setListState(prev => {\n      const newCollapsed = new Set(prev.collapsedGroups);\n      if (newCollapsed.has(groupKey)) {\n        newCollapsed.delete(groupKey);\n      } else {\n        newCollapsed.add(groupKey);\n      }\n      return { ...prev, collapsedGroups: newCollapsed };\n    });\n  }, []);\n\n  const handleItemClick = useCallback((item: ListItem) => {\n    if (item.isGroupHeader) {\n      toggleGroupCollapse(item.groupKey!);\n    } else {\n      onNodeClick?.(item.node);\n    }\n  }, [onNodeClick, toggleGroupCollapse]);\n\n  const handleScroll = useCallback((event: React.UIEvent<HTMLDivElement>) => {\n    setScrollTop(event.currentTarget.scrollTop);\n  }, []);\n\n  // Handle container resize\n  const handleResize = useCallback(() => {\n    if (containerRef.current) {\n      setContainerHeight(containerRef.current.clientHeight - SEARCH_BAR_HEIGHT);\n    }\n  }, []);\n\n  // Setup resize observer\n  useEffect(() => {\n    handleResize();\n\n    const resizeObserver = new ResizeObserver(handleResize);\n    if (containerRef.current) {\n      resizeObserver.observe(containerRef.current);\n    }\n\n    return () => resizeObserver.disconnect();\n  }, [handleResize]);\n\n  // Render D3 list items\n  useEffect(() => {\n    if (!svgRef.current) return;\n\n    const svg = d3.select(svgRef.current);\n    svg.selectAll('*').remove();\n\n    const container = svg.append('g').attr('class', 'list-container');\n\n    // Create groups for items\n    const itemGroups = container\n      .selectAll('.list-item')\n      .data(visibleItems, d => d.item.id)\n      .enter()\n      .append('g')\n      .attr('class', 'list-item')\n      .attr('transform', d => `translate(0, ${d.y})`)\n      .style('cursor', 'pointer')\n      .on('click', (event, d) => handleItemClick(d.item));\n\n    // Render group headers\n    const groupHeaders = itemGroups.filter(d => d.item.isGroupHeader);\n\n    groupHeaders\n      .append('rect')\n      .attr('width', '100%')\n      .attr('height', GROUP_HEADER_HEIGHT)\n      .attr('fill', theme === 'NeXTSTEP' ? '#e8e8e8' : '#f3f4f6')\n      .attr('stroke', theme === 'NeXTSTEP' ? '#c0c0c0' : '#e5e7eb')\n      .attr('stroke-width', 1);\n\n    groupHeaders\n      .append('text')\n      .attr('x', 12)\n      .attr('y', GROUP_HEADER_HEIGHT / 2)\n      .attr('dominant-baseline', 'central')\n      .attr('font-size', '12px')\n      .attr('font-weight', 'bold')\n      .attr('fill', '#374151')\n      .text(d => d.item.groupLabel || '');\n\n    groupHeaders\n      .append('text')\n      .attr('x', 200)\n      .attr('y', GROUP_HEADER_HEIGHT / 2)\n      .attr('dominant-baseline', 'central')\n      .attr('font-size', '10px')\n      .attr('fill', '#6b7280')\n      .text(d => `${d.item.groupCount} items`);\n\n    // Render regular items\n    const regularItems = itemGroups.filter(d => !d.item.isGroupHeader);\n\n    regularItems\n      .append('rect')\n      .attr('width', '100%')\n      .attr('height', ITEM_HEIGHT)\n      .attr('fill', 'white')\n      .attr('stroke', theme === 'NeXTSTEP' ? '#c0c0c0' : '#e5e7eb')\n      .attr('stroke-width', 0.5)\n      .on('mouseenter', function(_event, d) {\n        d3.select(this).attr('fill', theme === 'NeXTSTEP' ? '#f5f5f5' : '#f9fafb');\n        setListState(prev => ({ ...prev, hoveredItem: d.item.id }));\n      })\n      .on('mouseleave', function(_event, _d) {\n        d3.select(this).attr('fill', 'white');\n        setListState(prev => ({ ...prev, hoveredItem: null }));\n      });\n\n    // Item title\n    regularItems\n      .append('text')\n      .attr('x', 12)\n      .attr('y', 20)\n      .attr('font-size', '14px')\n      .attr('font-weight', '500')\n      .attr('fill', '#111827')\n      .text(d => d.item.node.name || '');\n\n    // Item content\n    regularItems\n      .append('text')\n      .attr('x', 12)\n      .attr('y', 38)\n      .attr('font-size', '12px')\n      .attr('fill', '#6b7280')\n      .text(d => {\n        const content = d.item.node.content || '';\n        return content.length > 60 ? content.substring(0, 60) + '...' : content;\n      });\n\n    // Item metadata\n    regularItems\n      .append('text')\n      .attr('x', 12)\n      .attr('y', 58)\n      .attr('font-size', '10px')\n      .attr('fill', '#9ca3af')\n      .text(d => {\n        const node = d.item.node;\n        return `${node.folder}  ${node.status}  ${node.priority}`;\n      });\n\n    // Priority indicator\n    regularItems\n      .append('rect')\n      .attr('x', '95%')\n      .attr('y', 10)\n      .attr('width', 4)\n      .attr('height', ITEM_HEIGHT - 20)\n      .attr('fill', d => {\n        const priority = d.item.node.priority;\n        return priority === 'high' ? '#ef4444' :\n               priority === 'medium' ? '#f59e0b' : '#10b981';\n      });\n\n    // Search highlighting\n    if (listState.searchQuery) {\n      regularItems.selectAll('text').each(function(_d) {\n        const element = d3.select(this);\n        const text = element.text();\n        const query = listState.searchQuery.toLowerCase();\n\n        if (text.toLowerCase().includes(query)) {\n          // Simple highlight by changing color\n          element.attr('fill', '#1f2937');\n        }\n      });\n    }\n\n    // Animations\n    if (animating) {\n      itemGroups\n        .style('opacity', 0)\n        .transition()\n        .duration(300)\n        .style('opacity', 1);\n    }\n\n  }, [visibleItems, theme, listState, animating, handleItemClick]);\n\n  // Calculate total content height for scrollbar\n  const totalHeight = listItems.reduce((sum, item) => {\n    return sum + (item.isGroupHeader ? GROUP_HEADER_HEIGHT : ITEM_HEIGHT);\n  }, 0);\n\n  return (\n    <div ref={containerRef} className=\"d3-list-view w-full h-full flex flex-col bg-white\">\n      {/* Search and Controls Bar */}\n      <div\n        className={`flex-shrink-0 flex items-center gap-3 px-4 py-3 border-b ${\n          theme === 'NeXTSTEP' ? 'border-[#c0c0c0]' : 'border-gray-200'\n        }`}\n        style={{ height: SEARCH_BAR_HEIGHT }}\n      >\n        {/* Search Input */}\n        <div className=\"flex-1 relative\">\n          <div className=\"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none\">\n            <Search size={16} className=\"text-gray-400\" />\n          </div>\n          <input\n            type=\"text\"\n            value={listState.searchQuery}\n            onChange={(e) => handleSearch(e.target.value)}\n            placeholder=\"Search by title, content, or metadata...\"\n            className={`w-full pl-10 pr-10 py-2 text-sm border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ${\n              theme === 'NeXTSTEP'\n                ? 'border-[#c0c0c0] bg-white'\n                : 'border-gray-300 bg-white'\n            }`}\n          />\n          {listState.searchQuery && (\n            <button\n              onClick={clearSearch}\n              className=\"absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-600\"\n            >\n              <X size={16} />\n            </button>\n          )}\n        </div>\n\n        {/* Sort Toggle */}\n        <button\n          onClick={toggleSort}\n          className={`flex items-center gap-2 px-3 py-2 text-sm font-medium rounded-md transition-colors ${\n            theme === 'NeXTSTEP'\n              ? 'bg-[#e8e8e8] text-gray-700 hover:bg-[#d8d8d8]'\n              : 'bg-gray-100 text-gray-700 hover:bg-gray-200'\n          }`}\n          title={`Sort ${listState.sortDirection === 'asc' ? 'ascending' : 'descending'}`}\n        >\n          <ArrowUpDown size={16} />\n          {listState.sortDirection === 'asc' ? '' : ''}\n        </button>\n\n        {/* Grouping Toggle */}\n        <button\n          onClick={toggleGrouping}\n          className={`px-3 py-2 text-sm font-medium rounded-md transition-colors ${\n            listState.groupingEnabled\n              ? theme === 'NeXTSTEP'\n                ? 'bg-[#0066cc] text-white'\n                : 'bg-blue-600 text-white'\n              : theme === 'NeXTSTEP'\n                ? 'bg-[#e8e8e8] text-gray-700 hover:bg-[#d8d8d8]'\n                : 'bg-gray-100 text-gray-700 hover:bg-gray-200'\n          }`}\n        >\n          {listState.groupingEnabled ? 'Grouped' : 'Flat'}\n        </button>\n      </div>\n\n      {/* Virtual Scrolling Container */}\n      <div\n        className=\"flex-1 overflow-auto\"\n        onScroll={handleScroll}\n        style={{ height: containerHeight }}\n      >\n        {/* Phantom content for scrollbar */}\n        <div style={{ height: totalHeight, position: 'relative' }}>\n          {/* SVG for D3 rendering */}\n          <svg\n            ref={svgRef}\n            className=\"absolute inset-0 w-full\"\n            style={{ height: containerHeight }}\n          />\n        </div>\n      </div>\n\n      {/* Results Summary */}\n      <div className={`flex-shrink-0 px-4 py-2 text-xs border-t ${\n        theme === 'NeXTSTEP'\n          ? 'border-[#c0c0c0] bg-[#f5f5f5] text-gray-600'\n          : 'border-gray-200 bg-gray-50 text-gray-600'\n      }`}>\n        {listState.searchQuery ? (\n          <span>\n            {filteredGroups.reduce((sum, group) => sum + group.nodes.length, 0)} of {data.length} items match \"{listState.searchQuery}\"\n          </span>\n        ) : (\n          <span>\n            {data.length} items {listState.groupingEnabled ? `in ${groups.length} groups` : ''}\n          </span>\n        )}\n      </div>\n    </div>\n  );\n}\n\nexport default D3ListView;","import { useFilters, type Filter } from '../contexts/FilterContext';\nimport { useTheme } from '../contexts/ThemeContext';\nimport { useState } from 'react';\n\nconst FILTER_FIELDS = [\n  { id: 'folder', label: 'Folder' },\n  { id: 'status', label: 'Status' },\n  { id: 'priority', label: 'Priority' },\n  { id: 'nodeType', label: 'Type' },\n  { id: 'tags', label: 'Tags' },\n] as const;\n\nconst OPERATORS = [\n  { id: '=', label: 'equals' },\n  { id: '!=', label: 'not equals' },\n  { id: '>', label: 'greater than' },\n  { id: '<', label: 'less than' },\n  { id: 'contains', label: 'contains' },\n] as const;\n\nexport function FilterBar() {\n  const { filters, addFilter, removeFilter, clearFilters } = useFilters();\n  const { theme } = useTheme();\n  const [isAdding, setIsAdding] = useState(false);\n  const [newFilter, setNewFilter] = useState<Partial<Filter>>({\n    field: 'folder',\n    operator: '=',\n    value: '',\n  });\n\n  const handleAddFilter = () => {\n    if (newFilter.field && newFilter.operator && newFilter.value !== undefined) {\n      addFilter(newFilter as Filter);\n      setNewFilter({ field: 'folder', operator: '=', value: '' });\n      setIsAdding(false);\n    }\n  };\n\n  const chipClass = theme === 'NeXTSTEP'\n    ? 'inline-flex items-center gap-1 px-2 py-0.5 text-xs bg-white border border-[#808080]'\n    : 'inline-flex items-center gap-1 px-2 py-0.5 text-xs bg-blue-100 text-blue-800 rounded-full';\n\n  const buttonClass = theme === 'NeXTSTEP'\n    ? 'px-2 py-1 text-xs bg-[#c0c0c0] border-t border-l border-[#e8e8e8] border-b border-r border-[#707070] hover:bg-[#d0d0d0]'\n    : 'px-2 py-1 text-xs bg-gray-100 hover:bg-gray-200 rounded border border-gray-300';\n\n  const inputClass = theme === 'NeXTSTEP'\n    ? 'px-2 py-1 text-xs bg-white border border-[#808080]'\n    : 'px-2 py-1 text-xs bg-white border border-gray-300 rounded focus:ring-2 focus:ring-blue-500';\n\n  if (filters.length === 0 && !isAdding) {\n    return (\n      <div className={`flex items-center gap-2 px-3 py-2 ${\n        theme === 'NeXTSTEP'\n          ? 'bg-[#d4d4d4] border-b border-[#808080]'\n          : 'bg-gray-50 border-b border-gray-200'\n      }`}>\n        <span className=\"text-xs text-gray-500\">No filters active</span>\n        <button\n          onClick={() => setIsAdding(true)}\n          className={buttonClass}\n        >\n          + Add Filter\n        </button>\n      </div>\n    );\n  }\n\n  return (\n    <div className={`flex flex-wrap items-center gap-2 px-3 py-2 ${\n      theme === 'NeXTSTEP'\n        ? 'bg-[#d4d4d4] border-b border-[#808080]'\n        : 'bg-gray-50 border-b border-gray-200'\n    }`}>\n      {/* Active filters */}\n      {filters.map((filter, index) => (\n        <span key={index} className={chipClass}>\n          <span className=\"font-medium\">{filter.field}</span>\n          <span className=\"opacity-70\">{filter.operator}</span>\n          <span>{String(filter.value)}</span>\n          <button\n            onClick={() => removeFilter(index)}\n            className=\"ml-1 hover:text-red-600\"\n          >\n            \n          </button>\n        </span>\n      ))}\n\n      {/* Add filter form */}\n      {isAdding ? (\n        <div className=\"flex items-center gap-1\">\n          <select\n            value={newFilter.field}\n            onChange={(e) => setNewFilter(prev => ({ ...prev, field: e.target.value }))}\n            className={inputClass}\n          >\n            {FILTER_FIELDS.map(f => (\n              <option key={f.id} value={f.id}>{f.label}</option>\n            ))}\n          </select>\n          <select\n            value={newFilter.operator}\n            onChange={(e) => setNewFilter(prev => ({ ...prev, operator: e.target.value as Filter['operator'] }))}\n            className={inputClass}\n          >\n            {OPERATORS.map(op => (\n              <option key={op.id} value={op.id}>{op.label}</option>\n            ))}\n          </select>\n          <input\n            type=\"text\"\n            value={String(newFilter.value ?? '')}\n            onChange={(e) => setNewFilter(prev => ({ ...prev, value: e.target.value }))}\n            placeholder=\"Value...\"\n            className={inputClass}\n          />\n          <button onClick={handleAddFilter} className={buttonClass}>\n            Add\n          </button>\n          <button onClick={() => setIsAdding(false)} className={buttonClass}>\n            Cancel\n          </button>\n        </div>\n      ) : (\n        <button\n          onClick={() => setIsAdding(true)}\n          className={buttonClass}\n        >\n          + Add Filter\n        </button>\n      )}\n\n      {/* Clear all button */}\n      {filters.length > 0 && (\n        <button\n          onClick={clearFilters}\n          className={`ml-auto ${buttonClass}`}\n        >\n          Clear All\n        </button>\n      )}\n    </div>\n  );\n}\n","import { useState, useCallback } from 'react';\nimport { useTheme } from '../contexts/ThemeContext';\nimport { useAppState } from '../contexts/AppStateContext';\n// import { useFilteredNodes } from '../hooks/useFilteredNodes';\nimport { useMockData } from '../hooks/useMockData';\nimport {\n  ListView,\n  GridView,\n  KanbanView,\n  TimelineView,\n  CalendarView,\n  ChartsView,\n  NetworkView,\n  TreeView,\n} from './views';\nimport { D3GridView } from './views/D3GridView';\nimport { D3ListView } from './views/D3ListView';\nimport { FilterBar } from './FilterBar';\nimport type { Node } from '@/types/node';\n\nexport function Canvas() {\n  const [activeTab, setActiveTab] = useState(0);\n  const [selectedNode, setSelectedNode] = useState<Node | null>(null);\n  const [useD3Mode, setUseD3Mode] = useState(false); // Toggle for D3 vs CSS rendering\n  const tabs = ['Tab 1', 'Tab 2', 'Tab 3'];\n  const { theme } = useTheme();\n  const { activeView } = useAppState();\n\n  // Use mock data for MVP demonstration (bypasses database complexity)\n  const { data: nodes, loading, error } = useMockData();\n\n  const handleNodeClick = useCallback((node: Node) => {\n    setSelectedNode(node);\n    console.log('Node clicked:', node);\n  }, []);\n\n  // Render the appropriate view based on activeView\n  const renderView = () => {\n    if (loading) {\n      return (\n        <div className=\"flex items-center justify-center h-full text-gray-500\">\n          Loading notes...\n        </div>\n      );\n    }\n\n    if (error) {\n      return (\n        <div className=\"flex items-center justify-center h-full text-red-500\">\n          Error: {error.message}\n        </div>\n      );\n    }\n\n    if (!nodes || nodes.length === 0) {\n      return (\n        <div className=\"flex items-center justify-center h-full text-gray-400\">\n          No notes found\n        </div>\n      );\n    }\n\n    // D3 Mode - Use D3 Canvas rendering\n    if (useD3Mode) {\n      switch (activeView) {\n        case 'List':\n          return <D3ListView data={nodes} onNodeClick={handleNodeClick} />;\n\n        case 'Gallery':\n        case 'Grid':\n        default:\n          return <D3GridView data={nodes} onNodeClick={handleNodeClick} />;\n      }\n    }\n\n    // CSS Mode - Use existing CSS-based components\n    switch (activeView) {\n      case 'List':\n        return <ListView data={nodes} onNodeClick={handleNodeClick} />;\n\n      case 'Gallery':\n      case 'Grid':\n        return <GridView data={nodes} onNodeClick={handleNodeClick} />;\n\n      case 'Kanban':\n        return <KanbanView data={nodes} onNodeClick={handleNodeClick} />;\n\n      case 'Timeline':\n        return <TimelineView data={nodes} onNodeClick={handleNodeClick} />;\n\n      case 'Calendar':\n        return <CalendarView data={nodes} onNodeClick={handleNodeClick} />;\n\n      case 'Charts':\n        return <ChartsView data={nodes} onNodeClick={handleNodeClick} />;\n\n      case 'Graphs':\n        return <NetworkView data={nodes} onNodeClick={handleNodeClick} />;\n\n      case 'Tree':\n        return <TreeView data={nodes} onNodeClick={handleNodeClick} />;\n\n      default:\n        // Default to Grid view for MVP\n        return <GridView data={nodes} onNodeClick={handleNodeClick} />;\n    }\n  };\n\n  return (\n    <div className={`flex-1 flex flex-col m-3 overflow-hidden ${\n      theme === 'NeXTSTEP'\n        ? 'bg-white border-t-2 border-l-2 border-[#707070] border-b-2 border-r-2 border-b-[#e8e8e8] border-r-[#e8e8e8]'\n        : 'bg-white rounded-lg shadow-lg border border-gray-200'\n    }`}>\n      {/* Filter Bar with D3 Mode Toggle */}\n      <div className=\"flex items-center\">\n        <div className=\"flex-1\">\n          <FilterBar />\n        </div>\n\n        {/* D3 Mode Toggle */}\n        {process.env.NODE_ENV === 'development' && (\n          <div className=\"px-3 py-2\">\n            <button\n              onClick={() => setUseD3Mode(!useD3Mode)}\n              className={`px-3 py-1 text-xs font-medium rounded ${\n                useD3Mode\n                  ? theme === 'NeXTSTEP'\n                    ? 'bg-[#0066cc] text-white'\n                    : 'bg-blue-600 text-white'\n                  : theme === 'NeXTSTEP'\n                    ? 'bg-[#e8e8e8] text-gray-700 hover:bg-[#d8d8d8]'\n                    : 'bg-gray-100 text-gray-700 hover:bg-gray-200'\n              }`}\n              title={useD3Mode ? 'Switch to CSS rendering' : 'Switch to D3 rendering'}\n            >\n              {useD3Mode ? 'D3 Mode' : 'CSS Mode'}\n            </button>\n          </div>\n        )}\n      </div>\n\n      {/* Main Canvas Area */}\n      <div className=\"flex-1 overflow-hidden\">\n        {renderView()}\n      </div>\n\n      {/* Selected Node Info (optional mini-display) */}\n      {selectedNode && (\n        <div className={`h-8 flex items-center px-3 text-xs ${\n          theme === 'NeXTSTEP'\n            ? 'bg-[#d4d4d4] border-t border-[#808080]'\n            : 'bg-gray-50 border-t border-gray-200'\n        }`}>\n          <span className=\"font-medium mr-2\">Selected:</span>\n          <span className=\"truncate\">{selectedNode.name}</span>\n          <button\n            onClick={() => setSelectedNode(null)}\n            className={`ml-auto px-2 ${\n              theme === 'NeXTSTEP' ? 'hover:bg-[#c0c0c0]' : 'hover:bg-gray-200 rounded'\n            }`}\n          >\n            \n          </button>\n        </div>\n      )}\n\n      {/* Sheet Tabs */}\n      <div className={theme === 'NeXTSTEP'\n        ? 'bg-[#c0c0c0] border-t-2 border-[#808080] flex items-end gap-0.5 px-2 pb-1 pt-2'\n        : 'bg-gray-50 border-t border-gray-200 flex items-end gap-1 px-2 pb-1 pt-2'\n      }>\n        {tabs.map((tab, index) => (\n          <button\n            key={index}\n            onClick={() => setActiveTab(index)}\n            className={theme === 'NeXTSTEP'\n              ? `px-4 py-1.5 text-sm rounded-t ${\n                  activeTab === index\n                    ? 'bg-white border-t-2 border-l-2 border-r-2 border-[#808080]'\n                    : 'bg-[#b0b0b0] border-t-2 border-l-2 border-r-2 border-[#707070] hover:bg-[#b8b8b8]'\n                }`\n              : `px-4 py-1.5 text-sm rounded-t-lg ${\n                  activeTab === index\n                    ? 'bg-white text-gray-900 border-t border-l border-r border-gray-200'\n                    : 'bg-gray-100 text-gray-600 hover:bg-gray-200'\n                }`\n            }\n          >\n            {tab}\n          </button>\n        ))}\n      </div>\n    </div>\n  );\n}\n","/**\n * IconButton Component\n *\n * Square icon button for toolbars and actions.\n * Extracted pattern from Toolbar command buttons.\n */\n\nimport { forwardRef, type ButtonHTMLAttributes, type ReactNode } from 'react';\nimport { useTheme } from '@/contexts/ThemeContext';\n\n// ============================================\n// Types\n// ============================================\n\nexport type IconButtonVariant = 'default' | 'ghost' | 'active';\nexport type IconButtonSize = 'sm' | 'md' | 'lg';\n\nexport interface IconButtonProps extends ButtonHTMLAttributes<HTMLButtonElement> {\n  icon: ReactNode;\n  variant?: IconButtonVariant;\n  size?: IconButtonSize;\n  label?: string; // For accessibility\n  active?: boolean;\n}\n\n// ============================================\n// Style Maps\n// ============================================\n\nconst sizeStyles: Record<IconButtonSize, string> = {\n  sm: 'w-6 h-6',\n  md: 'w-7 h-7',\n  lg: 'w-9 h-9',\n};\n\nconst iconSizeStyles: Record<IconButtonSize, string> = {\n  sm: 'w-3 h-3',\n  md: 'w-4 h-4',\n  lg: 'w-5 h-5',\n};\n\n// NeXTSTEP beveled border pattern\nconst nextStepVariants: Record<IconButtonVariant, string> = {\n  default: `\n    bg-[#d4d4d4]\n    border-t-2 border-l-2 border-[#ffffff]\n    border-b-2 border-r-2 border-b-[#707070] border-r-[#707070]\n    active:border-t-[#707070] active:border-l-[#707070]\n    active:border-b-[#ffffff] active:border-r-[#ffffff]\n  `,\n  ghost: `\n    bg-transparent\n    border-2 border-transparent\n    hover:bg-[#c8c8c8]\n  `,\n  active: `\n    bg-[#b0b0b0]\n    border-t-2 border-l-2 border-[#707070]\n    border-b-2 border-r-2 border-b-[#ffffff] border-r-[#ffffff]\n  `,\n};\n\n// Modern rounded pattern\nconst modernVariants: Record<IconButtonVariant, string> = {\n  default: `\n    bg-white\n    rounded-lg border border-gray-300\n    hover:bg-gray-50 active:bg-gray-100\n    shadow-sm\n  `,\n  ghost: `\n    bg-transparent\n    rounded-lg border border-transparent\n    hover:bg-gray-100 active:bg-gray-200\n  `,\n  active: `\n    bg-blue-100\n    rounded-lg border border-blue-300\n    text-blue-600\n  `,\n};\n\n// ============================================\n// Component\n// ============================================\n\nexport const IconButton = forwardRef<HTMLButtonElement, IconButtonProps>(\n  (\n    {\n      icon,\n      variant = 'default',\n      size = 'md',\n      label,\n      active = false,\n      className = '',\n      disabled,\n      ...props\n    },\n    ref\n  ) => {\n    const { theme } = useTheme();\n\n    const effectiveVariant = active ? 'active' : variant;\n    const variantStyles =\n      theme === 'NeXTSTEP'\n        ? nextStepVariants[effectiveVariant]\n        : modernVariants[effectiveVariant];\n\n    const disabledStyles = 'opacity-50 cursor-not-allowed';\n\n    const textColor =\n      theme === 'NeXTSTEP'\n        ? 'text-[#404040]'\n        : effectiveVariant === 'active'\n          ? 'text-blue-600'\n          : 'text-gray-600';\n\n    return (\n      <button\n        ref={ref}\n        disabled={disabled}\n        aria-label={label}\n        title={label}\n        className={`\n          inline-flex items-center justify-center\n          transition-colors duration-150\n          ${sizeStyles[size]}\n          ${variantStyles}\n          ${textColor}\n          ${disabled ? disabledStyles : ''}\n          ${className}\n        `}\n        {...props}\n      >\n        <span className={iconSizeStyles[size]}>{icon}</span>\n      </button>\n    );\n  }\n);\n\nIconButton.displayName = 'IconButton';\n\nexport default IconButton;\n","import { useState } from 'react';\nimport { FileText, Save, FolderOpen, Download, LayoutGrid, Layers, BarChart3, type LucideIcon } from 'lucide-react';\nimport { useTheme } from '@/contexts/ThemeContext';\nimport { IconButton } from '@/components/ui/buttons/IconButton';\n\ninterface MenuItem {\n  label?: string;\n  action?: () => void;\n  separator?: boolean;\n  submenu?: MenuItem[];\n}\n\ninterface MenuSection {\n  label: string;\n  items: MenuItem[];\n}\n\nexport function Toolbar() {\n  const [openMenu, setOpenMenu] = useState<string | null>(null);\n  // TODO: Implement submenus when needed\n  const { theme, setTheme } = useTheme();\n\n  const menuSections: MenuSection[] = [\n    {\n      label: 'Isometry',\n      items: [\n        { label: 'About Isometry', _action: () => console.log('About') },\n        { separator: true },\n        { \n          label: 'Settings',\n          submenu: [\n            { \n              label: 'Theme', \n              submenu: [\n                { label: 'NeXTSTEP', _action: () => setTheme('NeXTSTEP') },\n                { label: 'Modern', _action: () => setTheme('Modern') },\n              ]\n            },\n          ]\n        },\n        { separator: true },\n        { label: 'Quit Isometry', _action: () => console.log('Quit') },\n      ]\n    },\n    {\n      label: 'File',\n      items: [\n        { label: 'New', _action: () => console.log('New') },\n        { label: 'Open', _action: () => console.log('Open') },\n        { separator: true },\n        { label: 'Save As', _action: () => console.log('Save As') },\n      ]\n    },\n    {\n      label: 'Edit',\n      items: [\n        { label: 'Undo', _action: () => console.log('Undo') },\n        { label: 'Redo', _action: () => console.log('Redo') },\n        { separator: true },\n        { label: 'Cut', _action: () => console.log('Cut') },\n        { label: 'Copy', _action: () => console.log('Copy') },\n        { label: 'Paste', _action: () => console.log('Paste') },\n      ]\n    },\n    {\n      label: 'View',\n      items: [\n        { label: 'Workbench', _action: () => console.log('Workbench') },\n        { label: 'Apps', _action: () => console.log('Apps') },\n        { label: 'Datasets', _action: () => console.log('Datasets') },\n      ]\n    },\n  ];\n\n  const commandButtons: { icon: LucideIcon; label: string; action: () => void }[] = [\n    { icon: FileText, _label: 'New', action: () => console.log('New') },\n    { icon: FolderOpen, _label: 'Open', action: () => console.log('Open') },\n    { icon: Save, _label: 'Save', action: () => console.log('Save') },\n    { icon: Download, _label: 'Export', action: () => console.log('Export') },\n  ];\n\n  const appLauncherButtons: { icon: LucideIcon; label: string; action: () => void }[] = [\n    { icon: LayoutGrid, _label: 'Grid View', action: () => console.log('Grid View') },\n    { icon: Layers, _label: 'Dimensions', action: () => console.log('Dimensions') },\n    { icon: BarChart3, _label: 'Charts', action: () => console.log('Charts') },\n  ];\n\n  return (\n    <div className=\"relative\">\n      {/* Menu Bar */}\n      <div className={`h-7 flex items-center px-1 ${\n        theme === 'NeXTSTEP' \n          ? 'bg-[#c0c0c0] border-b-2 border-[#505050]'\n          : 'bg-white/80 backdrop-blur-xl border-b border-gray-200'\n      }`}>\n        {/* Menu Items */}\n        <div className=\"flex items-center\">\n          {menuSections.map((section) => (\n            <div key={section.label} className=\"relative\">\n              <button\n                onClick={() => setOpenMenu(openMenu === section.label ? null : section.label)}\n                className={`px-3 py-0.5 text-sm ${\n                  theme === 'NeXTSTEP'\n                    ? openMenu === section.label ? 'bg-black text-white' : 'hover:bg-[#a0a0a0]'\n                    : openMenu === section.label ? 'bg-blue-500 text-white rounded' : 'hover:bg-gray-100 rounded'\n                }`}\n              >\n                {section.label}\n              </button>\n              {openMenu === section.label && (\n                <div className={`absolute top-full left-0 mt-0 min-w-[160px] z-50 ${\n                  theme === 'NeXTSTEP'\n                    ? 'bg-[#d4d4d4] border-2 border-black shadow-lg'\n                    : 'bg-white/95 backdrop-blur-xl rounded-lg border border-gray-200 shadow-2xl'\n                }`}>\n                  {section.items.map((item, index) => (\n                    item.separator ? (\n                      <div key={index} className={`my-1 ${theme === 'NeXTSTEP' ? 'border-t border-gray-500' : 'border-t border-gray-200'}`} />\n                    ) : (\n                      <button\n                        key={index}\n                        onClick={() => { item.action?.(); setOpenMenu(null); }}\n                        className={`w-full px-4 py-1.5 text-left text-sm ${\n                          theme === 'NeXTSTEP'\n                            ? 'hover:bg-black hover:text-white'\n                            : 'hover:bg-blue-500 hover:text-white rounded-md mx-1'\n                        }`}\n                      >\n                        {item.label}\n                      </button>\n                    )\n                  ))}\n                </div>\n              )}\n            </div>\n          ))}\n        </div>\n\n        <div className=\"flex-1\" />\n\n        {/* Theme Toggle */}\n        <div className=\"flex items-center gap-1 mr-1\">\n          <button\n            onClick={() => setTheme('NeXTSTEP')}\n            className={`px-3 py-0.5 text-xs ${\n              theme === 'NeXTSTEP' ? 'bg-black text-white' : 'bg-gray-100 hover:bg-gray-200 rounded'\n            }`}\n          >NeXTSTEP</button>\n          <button\n            onClick={() => setTheme('Modern')}\n            className={`px-3 py-0.5 text-xs ${\n              theme === 'Modern' ? 'bg-blue-500 text-white rounded' : 'bg-gray-100 hover:bg-gray-200 rounded'\n            }`}\n          >Modern</button>\n        </div>\n      </div>\n\n      {/* Toolbar */}\n      <div className={`h-12 flex items-center px-2 gap-1 ${\n        theme === 'NeXTSTEP'\n          ? 'bg-[#c0c0c0] border-b-2 border-[#505050]'\n          : 'bg-white/50 backdrop-blur-xl border-b border-gray-200'\n      }`}>\n        {commandButtons.map((button, index) => (\n          <IconButton\n            key={index}\n            icon={<button.icon className=\"w-5 h-5\" />}\n            label={button.label}\n            onClick={button.action}\n            variant=\"ghost\"\n            className=\"w-10 h-10\"\n          />\n        ))}\n\n        <div className={theme === 'NeXTSTEP' ? 'w-[3px] h-8 bg-[#808080] mx-1' : 'w-px h-8 bg-gray-300 mx-2'} />\n\n        {appLauncherButtons.map((button, index) => (\n          <IconButton\n            key={index}\n            icon={<button.icon className=\"w-5 h-5\" />}\n            label={button.label}\n            onClick={button.action}\n            variant=\"ghost\"\n            className=\"w-10 h-10\"\n          />\n        ))}\n\n        <div className=\"flex-1\" />\n      </div>\n    </div>\n  );\n}\n","import { createContext } from 'react';\n/**\n * Create the React Context\n */ export const DndContext = createContext({\n    dragDropManager: undefined\n});\n\n//# sourceMappingURL=DndContext.js.map","import _objectSpread from '@babel/runtime/helpers/esm/objectSpread2';\n\n/**\n * Adapted from React: https://github.com/facebook/react/blob/master/packages/shared/formatProdErrorMessage.js\n *\n * Do not require this module directly! Use normal throw error calls. These messages will be replaced with error codes\n * during build.\n * @param {number} code\n */\nfunction formatProdErrorMessage(code) {\n  return \"Minified Redux error #\" + code + \"; visit https://redux.js.org/Errors?code=\" + code + \" for the full message or \" + 'use the non-minified dev environment for full errors. ';\n}\n\n// Inlined version of the `symbol-observable` polyfill\nvar $$observable = (function () {\n  return typeof Symbol === 'function' && Symbol.observable || '@@observable';\n})();\n\n/**\n * These are private action types reserved by Redux.\n * For any unknown actions, you must return the current state.\n * If the current state is undefined, you must return the initial state.\n * Do not reference these action types directly in your code.\n */\nvar randomString = function randomString() {\n  return Math.random().toString(36).substring(7).split('').join('.');\n};\n\nvar ActionTypes = {\n  INIT: \"@@redux/INIT\" + randomString(),\n  REPLACE: \"@@redux/REPLACE\" + randomString(),\n  PROBE_UNKNOWN_ACTION: function PROBE_UNKNOWN_ACTION() {\n    return \"@@redux/PROBE_UNKNOWN_ACTION\" + randomString();\n  }\n};\n\n/**\n * @param {any} obj The object to inspect.\n * @returns {boolean} True if the argument appears to be a plain object.\n */\nfunction isPlainObject(obj) {\n  if (typeof obj !== 'object' || obj === null) return false;\n  var proto = obj;\n\n  while (Object.getPrototypeOf(proto) !== null) {\n    proto = Object.getPrototypeOf(proto);\n  }\n\n  return Object.getPrototypeOf(obj) === proto;\n}\n\n// Inlined / shortened version of `kindOf` from https://github.com/jonschlinkert/kind-of\nfunction miniKindOf(val) {\n  if (val === void 0) return 'undefined';\n  if (val === null) return 'null';\n  var type = typeof val;\n\n  switch (type) {\n    case 'boolean':\n    case 'string':\n    case 'number':\n    case 'symbol':\n    case 'function':\n      {\n        return type;\n      }\n  }\n\n  if (Array.isArray(val)) return 'array';\n  if (isDate(val)) return 'date';\n  if (isError(val)) return 'error';\n  var constructorName = ctorName(val);\n\n  switch (constructorName) {\n    case 'Symbol':\n    case 'Promise':\n    case 'WeakMap':\n    case 'WeakSet':\n    case 'Map':\n    case 'Set':\n      return constructorName;\n  } // other\n\n\n  return type.slice(8, -1).toLowerCase().replace(/\\s/g, '');\n}\n\nfunction ctorName(val) {\n  return typeof val.constructor === 'function' ? val.constructor.name : null;\n}\n\nfunction isError(val) {\n  return val instanceof Error || typeof val.message === 'string' && val.constructor && typeof val.constructor.stackTraceLimit === 'number';\n}\n\nfunction isDate(val) {\n  if (val instanceof Date) return true;\n  return typeof val.toDateString === 'function' && typeof val.getDate === 'function' && typeof val.setDate === 'function';\n}\n\nfunction kindOf(val) {\n  var typeOfVal = typeof val;\n\n  if (process.env.NODE_ENV !== 'production') {\n    typeOfVal = miniKindOf(val);\n  }\n\n  return typeOfVal;\n}\n\n/**\n * @deprecated\n *\n * **We recommend using the `configureStore` method\n * of the `@reduxjs/toolkit` package**, which replaces `createStore`.\n *\n * Redux Toolkit is our recommended approach for writing Redux logic today,\n * including store setup, reducers, data fetching, and more.\n *\n * **For more details, please read this Redux docs page:**\n * **https://redux.js.org/introduction/why-rtk-is-redux-today**\n *\n * `configureStore` from Redux Toolkit is an improved version of `createStore` that\n * simplifies setup and helps avoid common bugs.\n *\n * You should not be using the `redux` core package by itself today, except for learning purposes.\n * The `createStore` method from the core `redux` package will not be removed, but we encourage\n * all users to migrate to using Redux Toolkit for all Redux code.\n *\n * If you want to use `createStore` without this visual deprecation warning, use\n * the `legacy_createStore` import instead:\n *\n * `import { legacy_createStore as createStore} from 'redux'`\n *\n */\n\nfunction createStore(reducer, preloadedState, enhancer) {\n  var _ref2;\n\n  if (typeof preloadedState === 'function' && typeof enhancer === 'function' || typeof enhancer === 'function' && typeof arguments[3] === 'function') {\n    throw new Error(process.env.NODE_ENV === \"production\" ? formatProdErrorMessage(0) : 'It looks like you are passing several store enhancers to ' + 'createStore(). This is not supported. Instead, compose them ' + 'together to a single function. See https://redux.js.org/tutorials/fundamentals/part-4-store#creating-a-store-with-enhancers for an example.');\n  }\n\n  if (typeof preloadedState === 'function' && typeof enhancer === 'undefined') {\n    enhancer = preloadedState;\n    preloadedState = undefined;\n  }\n\n  if (typeof enhancer !== 'undefined') {\n    if (typeof enhancer !== 'function') {\n      throw new Error(process.env.NODE_ENV === \"production\" ? formatProdErrorMessage(1) : \"Expected the enhancer to be a function. Instead, received: '\" + kindOf(enhancer) + \"'\");\n    }\n\n    return enhancer(createStore)(reducer, preloadedState);\n  }\n\n  if (typeof reducer !== 'function') {\n    throw new Error(process.env.NODE_ENV === \"production\" ? formatProdErrorMessage(2) : \"Expected the root reducer to be a function. Instead, received: '\" + kindOf(reducer) + \"'\");\n  }\n\n  var currentReducer = reducer;\n  var currentState = preloadedState;\n  var currentListeners = [];\n  var nextListeners = currentListeners;\n  var isDispatching = false;\n  /**\n   * This makes a shallow copy of currentListeners so we can use\n   * nextListeners as a temporary list while dispatching.\n   *\n   * This prevents any bugs around consumers calling\n   * subscribe/unsubscribe in the middle of a dispatch.\n   */\n\n  function ensureCanMutateNextListeners() {\n    if (nextListeners === currentListeners) {\n      nextListeners = currentListeners.slice();\n    }\n  }\n  /**\n   * Reads the state tree managed by the store.\n   *\n   * @returns {any} The current state tree of your application.\n   */\n\n\n  function getState() {\n    if (isDispatching) {\n      throw new Error(process.env.NODE_ENV === \"production\" ? formatProdErrorMessage(3) : 'You may not call store.getState() while the reducer is executing. ' + 'The reducer has already received the state as an argument. ' + 'Pass it down from the top reducer instead of reading it from the store.');\n    }\n\n    return currentState;\n  }\n  /**\n   * Adds a change listener. It will be called any time an action is dispatched,\n   * and some part of the state tree may potentially have changed. You may then\n   * call `getState()` to read the current state tree inside the callback.\n   *\n   * You may call `dispatch()` from a change listener, with the following\n   * caveats:\n   *\n   * 1. The subscriptions are snapshotted just before every `dispatch()` call.\n   * If you subscribe or unsubscribe while the listeners are being invoked, this\n   * will not have any effect on the `dispatch()` that is currently in progress.\n   * However, the next `dispatch()` call, whether nested or not, will use a more\n   * recent snapshot of the subscription list.\n   *\n   * 2. The listener should not expect to see all state changes, as the state\n   * might have been updated multiple times during a nested `dispatch()` before\n   * the listener is called. It is, however, guaranteed that all subscribers\n   * registered before the `dispatch()` started will be called with the latest\n   * state by the time it exits.\n   *\n   * @param {Function} listener A callback to be invoked on every dispatch.\n   * @returns {Function} A function to remove this change listener.\n   */\n\n\n  function subscribe(listener) {\n    if (typeof listener !== 'function') {\n      throw new Error(process.env.NODE_ENV === \"production\" ? formatProdErrorMessage(4) : \"Expected the listener to be a function. Instead, received: '\" + kindOf(listener) + \"'\");\n    }\n\n    if (isDispatching) {\n      throw new Error(process.env.NODE_ENV === \"production\" ? formatProdErrorMessage(5) : 'You may not call store.subscribe() while the reducer is executing. ' + 'If you would like to be notified after the store has been updated, subscribe from a ' + 'component and invoke store.getState() in the callback to access the latest state. ' + 'See https://redux.js.org/api/store#subscribelistener for more details.');\n    }\n\n    var isSubscribed = true;\n    ensureCanMutateNextListeners();\n    nextListeners.push(listener);\n    return function unsubscribe() {\n      if (!isSubscribed) {\n        return;\n      }\n\n      if (isDispatching) {\n        throw new Error(process.env.NODE_ENV === \"production\" ? formatProdErrorMessage(6) : 'You may not unsubscribe from a store listener while the reducer is executing. ' + 'See https://redux.js.org/api/store#subscribelistener for more details.');\n      }\n\n      isSubscribed = false;\n      ensureCanMutateNextListeners();\n      var index = nextListeners.indexOf(listener);\n      nextListeners.splice(index, 1);\n      currentListeners = null;\n    };\n  }\n  /**\n   * Dispatches an action. It is the only way to trigger a state change.\n   *\n   * The `reducer` function, used to create the store, will be called with the\n   * current state tree and the given `action`. Its return value will\n   * be considered the **next** state of the tree, and the change listeners\n   * will be notified.\n   *\n   * The base implementation only supports plain object actions. If you want to\n   * dispatch a Promise, an Observable, a thunk, or something else, you need to\n   * wrap your store creating function into the corresponding middleware. For\n   * example, see the documentation for the `redux-thunk` package. Even the\n   * middleware will eventually dispatch plain object actions using this method.\n   *\n   * @param {Object} action A plain object representing what changed. It is\n   * a good idea to keep actions serializable so you can record and replay user\n   * sessions, or use the time travelling `redux-devtools`. An action must have\n   * a `type` property which may not be `undefined`. It is a good idea to use\n   * string constants for action types.\n   *\n   * @returns {Object} For convenience, the same action object you dispatched.\n   *\n   * Note that, if you use a custom middleware, it may wrap `dispatch()` to\n   * return something else (for example, a Promise you can await).\n   */\n\n\n  function dispatch(action) {\n    if (!isPlainObject(action)) {\n      throw new Error(process.env.NODE_ENV === \"production\" ? formatProdErrorMessage(7) : \"Actions must be plain objects. Instead, the actual type was: '\" + kindOf(action) + \"'. You may need to add middleware to your store setup to handle dispatching other values, such as 'redux-thunk' to handle dispatching functions. See https://redux.js.org/tutorials/fundamentals/part-4-store#middleware and https://redux.js.org/tutorials/fundamentals/part-6-async-logic#using-the-redux-thunk-middleware for examples.\");\n    }\n\n    if (typeof action.type === 'undefined') {\n      throw new Error(process.env.NODE_ENV === \"production\" ? formatProdErrorMessage(8) : 'Actions may not have an undefined \"type\" property. You may have misspelled an action type string constant.');\n    }\n\n    if (isDispatching) {\n      throw new Error(process.env.NODE_ENV === \"production\" ? formatProdErrorMessage(9) : 'Reducers may not dispatch actions.');\n    }\n\n    try {\n      isDispatching = true;\n      currentState = currentReducer(currentState, action);\n    } finally {\n      isDispatching = false;\n    }\n\n    var listeners = currentListeners = nextListeners;\n\n    for (var i = 0; i < listeners.length; i++) {\n      var listener = listeners[i];\n      listener();\n    }\n\n    return action;\n  }\n  /**\n   * Replaces the reducer currently used by the store to calculate the state.\n   *\n   * You might need this if your app implements code splitting and you want to\n   * load some of the reducers dynamically. You might also need this if you\n   * implement a hot reloading mechanism for Redux.\n   *\n   * @param {Function} nextReducer The reducer for the store to use instead.\n   * @returns {void}\n   */\n\n\n  function replaceReducer(nextReducer) {\n    if (typeof nextReducer !== 'function') {\n      throw new Error(process.env.NODE_ENV === \"production\" ? formatProdErrorMessage(10) : \"Expected the nextReducer to be a function. Instead, received: '\" + kindOf(nextReducer));\n    }\n\n    currentReducer = nextReducer; // This action has a similiar effect to ActionTypes.INIT.\n    // Any reducers that existed in both the new and old rootReducer\n    // will receive the previous state. This effectively populates\n    // the new state tree with any relevant data from the old one.\n\n    dispatch({\n      type: ActionTypes.REPLACE\n    });\n  }\n  /**\n   * Interoperability point for observable/reactive libraries.\n   * @returns {observable} A minimal observable of state changes.\n   * For more information, see the observable proposal:\n   * https://github.com/tc39/proposal-observable\n   */\n\n\n  function observable() {\n    var _ref;\n\n    var outerSubscribe = subscribe;\n    return _ref = {\n      /**\n       * The minimal observable subscription method.\n       * @param {Object} observer Any object that can be used as an observer.\n       * The observer object should have a `next` method.\n       * @returns {subscription} An object with an `unsubscribe` method that can\n       * be used to unsubscribe the observable from the store, and prevent further\n       * emission of values from the observable.\n       */\n      subscribe: function subscribe(observer) {\n        if (typeof observer !== 'object' || observer === null) {\n          throw new Error(process.env.NODE_ENV === \"production\" ? formatProdErrorMessage(11) : \"Expected the observer to be an object. Instead, received: '\" + kindOf(observer) + \"'\");\n        }\n\n        function observeState() {\n          if (observer.next) {\n            observer.next(getState());\n          }\n        }\n\n        observeState();\n        var unsubscribe = outerSubscribe(observeState);\n        return {\n          unsubscribe: unsubscribe\n        };\n      }\n    }, _ref[$$observable] = function () {\n      return this;\n    }, _ref;\n  } // When a store is created, an \"INIT\" action is dispatched so that every\n  // reducer returns their initial state. This effectively populates\n  // the initial state tree.\n\n\n  dispatch({\n    type: ActionTypes.INIT\n  });\n  return _ref2 = {\n    dispatch: dispatch,\n    subscribe: subscribe,\n    getState: getState,\n    replaceReducer: replaceReducer\n  }, _ref2[$$observable] = observable, _ref2;\n}\n/**\n * Creates a Redux store that holds the state tree.\n *\n * **We recommend using `configureStore` from the\n * `@reduxjs/toolkit` package**, which replaces `createStore`:\n * **https://redux.js.org/introduction/why-rtk-is-redux-today**\n *\n * The only way to change the data in the store is to call `dispatch()` on it.\n *\n * There should only be a single store in your app. To specify how different\n * parts of the state tree respond to actions, you may combine several reducers\n * into a single reducer function by using `combineReducers`.\n *\n * @param {Function} reducer A function that returns the next state tree, given\n * the current state tree and the action to handle.\n *\n * @param {any} [preloadedState] The initial state. You may optionally specify it\n * to hydrate the state from the server in universal apps, or to restore a\n * previously serialized user session.\n * If you use `combineReducers` to produce the root reducer function, this must be\n * an object with the same shape as `combineReducers` keys.\n *\n * @param {Function} [enhancer] The store enhancer. You may optionally specify it\n * to enhance the store with third-party capabilities such as middleware,\n * time travel, persistence, etc. The only store enhancer that ships with Redux\n * is `applyMiddleware()`.\n *\n * @returns {Store} A Redux store that lets you read the state, dispatch actions\n * and subscribe to changes.\n */\n\nvar legacy_createStore = createStore;\n\n/**\n * Prints a warning in the console if it exists.\n *\n * @param {String} message The warning message.\n * @returns {void}\n */\nfunction warning(message) {\n  /* eslint-disable no-console */\n  if (typeof console !== 'undefined' && typeof console.error === 'function') {\n    console.error(message);\n  }\n  /* eslint-enable no-console */\n\n\n  try {\n    // This error was thrown as a convenience so that if you enable\n    // \"break on all exceptions\" in your console,\n    // it would pause the execution at this line.\n    throw new Error(message);\n  } catch (e) {} // eslint-disable-line no-empty\n\n}\n\nfunction getUnexpectedStateShapeWarningMessage(inputState, reducers, action, unexpectedKeyCache) {\n  var reducerKeys = Object.keys(reducers);\n  var argumentName = action && action.type === ActionTypes.INIT ? 'preloadedState argument passed to createStore' : 'previous state received by the reducer';\n\n  if (reducerKeys.length === 0) {\n    return 'Store does not have a valid reducer. Make sure the argument passed ' + 'to combineReducers is an object whose values are reducers.';\n  }\n\n  if (!isPlainObject(inputState)) {\n    return \"The \" + argumentName + \" has unexpected type of \\\"\" + kindOf(inputState) + \"\\\". Expected argument to be an object with the following \" + (\"keys: \\\"\" + reducerKeys.join('\", \"') + \"\\\"\");\n  }\n\n  var unexpectedKeys = Object.keys(inputState).filter(function (key) {\n    return !reducers.hasOwnProperty(key) && !unexpectedKeyCache[key];\n  });\n  unexpectedKeys.forEach(function (key) {\n    unexpectedKeyCache[key] = true;\n  });\n  if (action && action.type === ActionTypes.REPLACE) return;\n\n  if (unexpectedKeys.length > 0) {\n    return \"Unexpected \" + (unexpectedKeys.length > 1 ? 'keys' : 'key') + \" \" + (\"\\\"\" + unexpectedKeys.join('\", \"') + \"\\\" found in \" + argumentName + \". \") + \"Expected to find one of the known reducer keys instead: \" + (\"\\\"\" + reducerKeys.join('\", \"') + \"\\\". Unexpected keys will be ignored.\");\n  }\n}\n\nfunction assertReducerShape(reducers) {\n  Object.keys(reducers).forEach(function (key) {\n    var reducer = reducers[key];\n    var initialState = reducer(undefined, {\n      type: ActionTypes.INIT\n    });\n\n    if (typeof initialState === 'undefined') {\n      throw new Error(process.env.NODE_ENV === \"production\" ? formatProdErrorMessage(12) : \"The slice reducer for key \\\"\" + key + \"\\\" returned undefined during initialization. \" + \"If the state passed to the reducer is undefined, you must \" + \"explicitly return the initial state. The initial state may \" + \"not be undefined. If you don't want to set a value for this reducer, \" + \"you can use null instead of undefined.\");\n    }\n\n    if (typeof reducer(undefined, {\n      type: ActionTypes.PROBE_UNKNOWN_ACTION()\n    }) === 'undefined') {\n      throw new Error(process.env.NODE_ENV === \"production\" ? formatProdErrorMessage(13) : \"The slice reducer for key \\\"\" + key + \"\\\" returned undefined when probed with a random type. \" + (\"Don't try to handle '\" + ActionTypes.INIT + \"' or other actions in \\\"redux/*\\\" \") + \"namespace. They are considered private. Instead, you must return the \" + \"current state for any unknown actions, unless it is undefined, \" + \"in which case you must return the initial state, regardless of the \" + \"action type. The initial state may not be undefined, but can be null.\");\n    }\n  });\n}\n/**\n * Turns an object whose values are different reducer functions, into a single\n * reducer function. It will call every child reducer, and gather their results\n * into a single state object, whose keys correspond to the keys of the passed\n * reducer functions.\n *\n * @param {Object} reducers An object whose values correspond to different\n * reducer functions that need to be combined into one. One handy way to obtain\n * it is to use ES6 `import * as reducers` syntax. The reducers may never return\n * undefined for any action. Instead, they should return their initial state\n * if the state passed to them was undefined, and the current state for any\n * unrecognized action.\n *\n * @returns {Function} A reducer function that invokes every reducer inside the\n * passed object, and builds a state object with the same shape.\n */\n\n\nfunction combineReducers(reducers) {\n  var reducerKeys = Object.keys(reducers);\n  var finalReducers = {};\n\n  for (var i = 0; i < reducerKeys.length; i++) {\n    var key = reducerKeys[i];\n\n    if (process.env.NODE_ENV !== 'production') {\n      if (typeof reducers[key] === 'undefined') {\n        warning(\"No reducer provided for key \\\"\" + key + \"\\\"\");\n      }\n    }\n\n    if (typeof reducers[key] === 'function') {\n      finalReducers[key] = reducers[key];\n    }\n  }\n\n  var finalReducerKeys = Object.keys(finalReducers); // This is used to make sure we don't warn about the same\n  // keys multiple times.\n\n  var unexpectedKeyCache;\n\n  if (process.env.NODE_ENV !== 'production') {\n    unexpectedKeyCache = {};\n  }\n\n  var shapeAssertionError;\n\n  try {\n    assertReducerShape(finalReducers);\n  } catch (e) {\n    shapeAssertionError = e;\n  }\n\n  return function combination(state, action) {\n    if (state === void 0) {\n      state = {};\n    }\n\n    if (shapeAssertionError) {\n      throw shapeAssertionError;\n    }\n\n    if (process.env.NODE_ENV !== 'production') {\n      var warningMessage = getUnexpectedStateShapeWarningMessage(state, finalReducers, action, unexpectedKeyCache);\n\n      if (warningMessage) {\n        warning(warningMessage);\n      }\n    }\n\n    var hasChanged = false;\n    var nextState = {};\n\n    for (var _i = 0; _i < finalReducerKeys.length; _i++) {\n      var _key = finalReducerKeys[_i];\n      var reducer = finalReducers[_key];\n      var previousStateForKey = state[_key];\n      var nextStateForKey = reducer(previousStateForKey, action);\n\n      if (typeof nextStateForKey === 'undefined') {\n        var actionType = action && action.type;\n        throw new Error(process.env.NODE_ENV === \"production\" ? formatProdErrorMessage(14) : \"When called with an action of type \" + (actionType ? \"\\\"\" + String(actionType) + \"\\\"\" : '(unknown type)') + \", the slice reducer for key \\\"\" + _key + \"\\\" returned undefined. \" + \"To ignore an action, you must explicitly return the previous state. \" + \"If you want this reducer to hold no value, you can return null instead of undefined.\");\n      }\n\n      nextState[_key] = nextStateForKey;\n      hasChanged = hasChanged || nextStateForKey !== previousStateForKey;\n    }\n\n    hasChanged = hasChanged || finalReducerKeys.length !== Object.keys(state).length;\n    return hasChanged ? nextState : state;\n  };\n}\n\nfunction bindActionCreator(actionCreator, dispatch) {\n  return function () {\n    return dispatch(actionCreator.apply(this, arguments));\n  };\n}\n/**\n * Turns an object whose values are action creators, into an object with the\n * same keys, but with every function wrapped into a `dispatch` call so they\n * may be invoked directly. This is just a convenience method, as you can call\n * `store.dispatch(MyActionCreators.doSomething())` yourself just fine.\n *\n * For convenience, you can also pass an action creator as the first argument,\n * and get a dispatch wrapped function in return.\n *\n * @param {Function|Object} actionCreators An object whose values are action\n * creator functions. One handy way to obtain it is to use ES6 `import * as`\n * syntax. You may also pass a single function.\n *\n * @param {Function} dispatch The `dispatch` function available on your Redux\n * store.\n *\n * @returns {Function|Object} The object mimicking the original object, but with\n * every action creator wrapped into the `dispatch` call. If you passed a\n * function as `actionCreators`, the return value will also be a single\n * function.\n */\n\n\nfunction bindActionCreators(actionCreators, dispatch) {\n  if (typeof actionCreators === 'function') {\n    return bindActionCreator(actionCreators, dispatch);\n  }\n\n  if (typeof actionCreators !== 'object' || actionCreators === null) {\n    throw new Error(process.env.NODE_ENV === \"production\" ? formatProdErrorMessage(16) : \"bindActionCreators expected an object or a function, but instead received: '\" + kindOf(actionCreators) + \"'. \" + \"Did you write \\\"import ActionCreators from\\\" instead of \\\"import * as ActionCreators from\\\"?\");\n  }\n\n  var boundActionCreators = {};\n\n  for (var key in actionCreators) {\n    var actionCreator = actionCreators[key];\n\n    if (typeof actionCreator === 'function') {\n      boundActionCreators[key] = bindActionCreator(actionCreator, dispatch);\n    }\n  }\n\n  return boundActionCreators;\n}\n\n/**\n * Composes single-argument functions from right to left. The rightmost\n * function can take multiple arguments as it provides the signature for\n * the resulting composite function.\n *\n * @param {...Function} funcs The functions to compose.\n * @returns {Function} A function obtained by composing the argument functions\n * from right to left. For example, compose(f, g, h) is identical to doing\n * (...args) => f(g(h(...args))).\n */\nfunction compose() {\n  for (var _len = arguments.length, funcs = new Array(_len), _key = 0; _key < _len; _key++) {\n    funcs[_key] = arguments[_key];\n  }\n\n  if (funcs.length === 0) {\n    return function (arg) {\n      return arg;\n    };\n  }\n\n  if (funcs.length === 1) {\n    return funcs[0];\n  }\n\n  return funcs.reduce(function (a, b) {\n    return function () {\n      return a(b.apply(void 0, arguments));\n    };\n  });\n}\n\n/**\n * Creates a store enhancer that applies middleware to the dispatch method\n * of the Redux store. This is handy for a variety of tasks, such as expressing\n * asynchronous actions in a concise manner, or logging every action payload.\n *\n * See `redux-thunk` package as an example of the Redux middleware.\n *\n * Because middleware is potentially asynchronous, this should be the first\n * store enhancer in the composition chain.\n *\n * Note that each middleware will be given the `dispatch` and `getState` functions\n * as named arguments.\n *\n * @param {...Function} middlewares The middleware chain to be applied.\n * @returns {Function} A store enhancer applying the middleware.\n */\n\nfunction applyMiddleware() {\n  for (var _len = arguments.length, middlewares = new Array(_len), _key = 0; _key < _len; _key++) {\n    middlewares[_key] = arguments[_key];\n  }\n\n  return function (createStore) {\n    return function () {\n      var store = createStore.apply(void 0, arguments);\n\n      var _dispatch = function dispatch() {\n        throw new Error(process.env.NODE_ENV === \"production\" ? formatProdErrorMessage(15) : 'Dispatching while constructing your middleware is not allowed. ' + 'Other middleware would not be applied to this dispatch.');\n      };\n\n      var middlewareAPI = {\n        getState: store.getState,\n        dispatch: function dispatch() {\n          return _dispatch.apply(void 0, arguments);\n        }\n      };\n      var chain = middlewares.map(function (middleware) {\n        return middleware(middlewareAPI);\n      });\n      _dispatch = compose.apply(void 0, chain)(store.dispatch);\n      return _objectSpread(_objectSpread({}, store), {}, {\n        dispatch: _dispatch\n      });\n    };\n  };\n}\n\nexport { ActionTypes as __DO_NOT_USE__ActionTypes, applyMiddleware, bindActionCreators, combineReducers, compose, createStore, legacy_createStore };\n","/**\n * Use invariant() to assert state which your program assumes to be true.\n *\n * Provide sprintf-style format (only %s is supported) and arguments\n * to provide information about what broke and what you were\n * expecting.\n *\n * The invariant message will be stripped in production, but the invariant\n * will remain to ensure logic does not differ in production.\n */ export function invariant(condition, format, ...args) {\n    if (isProduction()) {\n        if (format === undefined) {\n            throw new Error('invariant requires an error message argument');\n        }\n    }\n    if (!condition) {\n        let error;\n        if (format === undefined) {\n            error = new Error('Minified exception occurred; use the non-minified dev environment ' + 'for the full error message and additional helpful warnings.');\n        } else {\n            let argIndex = 0;\n            error = new Error(format.replace(/%s/g, function() {\n                return args[argIndex++];\n            }));\n            error.name = 'Invariant Violation';\n        }\n        error.framesToPop = 1 // we don't care about invariant's own frame\n        ;\n        throw error;\n    }\n}\nfunction isProduction() {\n    return typeof process !== 'undefined' && process.env['NODE_ENV'] === 'production';\n}\n\n//# sourceMappingURL=index.js.map","// cheap lodash replacements\n/**\n * drop-in replacement for _.get\n * @param obj\n * @param path\n * @param defaultValue\n */ export function get(obj, path, defaultValue) {\n    return path.split('.').reduce((a, c)=>a && a[c] ? a[c] : defaultValue || null\n    , obj);\n}\n/**\n * drop-in replacement for _.without\n */ export function without(items, item) {\n    return items.filter((i)=>i !== item\n    );\n}\n/**\n * drop-in replacement for _.isString\n * @param input\n */ export function isString(input) {\n    return typeof input === 'string';\n}\n/**\n * drop-in replacement for _.isString\n * @param input\n */ export function isObject(input) {\n    return typeof input === 'object';\n}\n/**\n * replacement for _.xor\n * @param itemsA\n * @param itemsB\n */ export function xor(itemsA, itemsB) {\n    const map = new Map();\n    const insertItem = (item)=>{\n        map.set(item, map.has(item) ? map.get(item) + 1 : 1);\n    };\n    itemsA.forEach(insertItem);\n    itemsB.forEach(insertItem);\n    const result = [];\n    map.forEach((count, key)=>{\n        if (count === 1) {\n            result.push(key);\n        }\n    });\n    return result;\n}\n/**\n * replacement for _.intersection\n * @param itemsA\n * @param itemsB\n */ export function intersection(itemsA, itemsB) {\n    return itemsA.filter((t)=>itemsB.indexOf(t) > -1\n    );\n}\n\n//# sourceMappingURL=js_utils.js.map","export const INIT_COORDS = 'dnd-core/INIT_COORDS';\nexport const BEGIN_DRAG = 'dnd-core/BEGIN_DRAG';\nexport const PUBLISH_DRAG_SOURCE = 'dnd-core/PUBLISH_DRAG_SOURCE';\nexport const HOVER = 'dnd-core/HOVER';\nexport const DROP = 'dnd-core/DROP';\nexport const END_DRAG = 'dnd-core/END_DRAG';\n\n//# sourceMappingURL=types.js.map","import { INIT_COORDS } from '../types.js';\nexport function setClientOffset(clientOffset, sourceClientOffset) {\n    return {\n        type: INIT_COORDS,\n        payload: {\n            sourceClientOffset: sourceClientOffset || null,\n            clientOffset: clientOffset || null\n        }\n    };\n}\n\n//# sourceMappingURL=setClientOffset.js.map","import { invariant } from '@react-dnd/invariant';\nimport { isObject } from '../../utils/js_utils.js';\nimport { setClientOffset } from './local/setClientOffset.js';\nimport { BEGIN_DRAG, INIT_COORDS } from './types.js';\nconst ResetCoordinatesAction = {\n    type: INIT_COORDS,\n    payload: {\n        clientOffset: null,\n        sourceClientOffset: null\n    }\n};\nexport function createBeginDrag(manager) {\n    return function beginDrag(sourceIds = [], options = {\n        publishSource: true\n    }) {\n        const { publishSource =true , clientOffset , getSourceClientOffset ,  } = options;\n        const monitor = manager.getMonitor();\n        const registry = manager.getRegistry();\n        // Initialize the coordinates using the client offset\n        manager.dispatch(setClientOffset(clientOffset));\n        verifyInvariants(sourceIds, monitor, registry);\n        // Get the draggable source\n        const sourceId = getDraggableSource(sourceIds, monitor);\n        if (sourceId == null) {\n            manager.dispatch(ResetCoordinatesAction);\n            return;\n        }\n        // Get the source client offset\n        let sourceClientOffset = null;\n        if (clientOffset) {\n            if (!getSourceClientOffset) {\n                throw new Error('getSourceClientOffset must be defined');\n            }\n            verifyGetSourceClientOffsetIsFunction(getSourceClientOffset);\n            sourceClientOffset = getSourceClientOffset(sourceId);\n        }\n        // Initialize the full coordinates\n        manager.dispatch(setClientOffset(clientOffset, sourceClientOffset));\n        const source = registry.getSource(sourceId);\n        const item = source.beginDrag(monitor, sourceId);\n        // If source.beginDrag returns null, this is an indicator to cancel the drag\n        if (item == null) {\n            return undefined;\n        }\n        verifyItemIsObject(item);\n        registry.pinSource(sourceId);\n        const itemType = registry.getSourceType(sourceId);\n        return {\n            type: BEGIN_DRAG,\n            payload: {\n                itemType,\n                item,\n                sourceId,\n                clientOffset: clientOffset || null,\n                sourceClientOffset: sourceClientOffset || null,\n                isSourcePublic: !!publishSource\n            }\n        };\n    };\n}\nfunction verifyInvariants(sourceIds, monitor, registry) {\n    invariant(!monitor.isDragging(), 'Cannot call beginDrag while dragging.');\n    sourceIds.forEach(function(sourceId) {\n        invariant(registry.getSource(sourceId), 'Expected sourceIds to be registered.');\n    });\n}\nfunction verifyGetSourceClientOffsetIsFunction(getSourceClientOffset) {\n    invariant(typeof getSourceClientOffset === 'function', 'When clientOffset is provided, getSourceClientOffset must be a function.');\n}\nfunction verifyItemIsObject(item) {\n    invariant(isObject(item), 'Item must be an object.');\n}\nfunction getDraggableSource(sourceIds, monitor) {\n    let sourceId = null;\n    for(let i = sourceIds.length - 1; i >= 0; i--){\n        if (monitor.canDragSource(sourceIds[i])) {\n            sourceId = sourceIds[i];\n            break;\n        }\n    }\n    return sourceId;\n}\n\n//# sourceMappingURL=beginDrag.js.map","function _defineProperty(obj, key, value) {\n    if (key in obj) {\n        Object.defineProperty(obj, key, {\n            value: value,\n            enumerable: true,\n            configurable: true,\n            writable: true\n        });\n    } else {\n        obj[key] = value;\n    }\n    return obj;\n}\nfunction _objectSpread(target) {\n    for(var i = 1; i < arguments.length; i++){\n        var source = arguments[i] != null ? arguments[i] : {};\n        var ownKeys = Object.keys(source);\n        if (typeof Object.getOwnPropertySymbols === 'function') {\n            ownKeys = ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function(sym) {\n                return Object.getOwnPropertyDescriptor(source, sym).enumerable;\n            }));\n        }\n        ownKeys.forEach(function(key) {\n            _defineProperty(target, key, source[key]);\n        });\n    }\n    return target;\n}\nimport { invariant } from '@react-dnd/invariant';\nimport { isObject } from '../../utils/js_utils.js';\nimport { DROP } from './types.js';\nexport function createDrop(manager) {\n    return function drop(options = {}) {\n        const monitor = manager.getMonitor();\n        const registry = manager.getRegistry();\n        verifyInvariants(monitor);\n        const targetIds = getDroppableTargets(monitor);\n        // Multiple actions are dispatched here, which is why this doesn't return an action\n        targetIds.forEach((targetId, index)=>{\n            const dropResult = determineDropResult(targetId, index, registry, monitor);\n            const action = {\n                type: DROP,\n                payload: {\n                    dropResult: _objectSpread({}, options, dropResult)\n                }\n            };\n            manager.dispatch(action);\n        });\n    };\n}\nfunction verifyInvariants(monitor) {\n    invariant(monitor.isDragging(), 'Cannot call drop while not dragging.');\n    invariant(!monitor.didDrop(), 'Cannot call drop twice during one drag operation.');\n}\nfunction determineDropResult(targetId, index, registry, monitor) {\n    const target = registry.getTarget(targetId);\n    let dropResult = target ? target.drop(monitor, targetId) : undefined;\n    verifyDropResultType(dropResult);\n    if (typeof dropResult === 'undefined') {\n        dropResult = index === 0 ? {} : monitor.getDropResult();\n    }\n    return dropResult;\n}\nfunction verifyDropResultType(dropResult) {\n    invariant(typeof dropResult === 'undefined' || isObject(dropResult), 'Drop result must either be an object or undefined.');\n}\nfunction getDroppableTargets(monitor) {\n    const targetIds = monitor.getTargetIds().filter(monitor.canDropOnTarget, monitor);\n    targetIds.reverse();\n    return targetIds;\n}\n\n//# sourceMappingURL=drop.js.map","import { invariant } from '@react-dnd/invariant';\nimport { END_DRAG } from './types.js';\nexport function createEndDrag(manager) {\n    return function endDrag() {\n        const monitor = manager.getMonitor();\n        const registry = manager.getRegistry();\n        verifyIsDragging(monitor);\n        const sourceId = monitor.getSourceId();\n        if (sourceId != null) {\n            const source = registry.getSource(sourceId, true);\n            source.endDrag(monitor, sourceId);\n            registry.unpinSource();\n        }\n        return {\n            type: END_DRAG\n        };\n    };\n}\nfunction verifyIsDragging(monitor) {\n    invariant(monitor.isDragging(), 'Cannot call endDrag while not dragging.');\n}\n\n//# sourceMappingURL=endDrag.js.map","export function matchesType(targetType, draggedItemType) {\n    if (draggedItemType === null) {\n        return targetType === null;\n    }\n    return Array.isArray(targetType) ? targetType.some((t)=>t === draggedItemType\n    ) : targetType === draggedItemType;\n}\n\n//# sourceMappingURL=matchesType.js.map","import { invariant } from '@react-dnd/invariant';\nimport { matchesType } from '../../utils/matchesType.js';\nimport { HOVER } from './types.js';\nexport function createHover(manager) {\n    return function hover(targetIdsArg, { clientOffset  } = {}) {\n        verifyTargetIdsIsArray(targetIdsArg);\n        const targetIds = targetIdsArg.slice(0);\n        const monitor = manager.getMonitor();\n        const registry = manager.getRegistry();\n        const draggedItemType = monitor.getItemType();\n        removeNonMatchingTargetIds(targetIds, registry, draggedItemType);\n        checkInvariants(targetIds, monitor, registry);\n        hoverAllTargets(targetIds, monitor, registry);\n        return {\n            type: HOVER,\n            payload: {\n                targetIds,\n                clientOffset: clientOffset || null\n            }\n        };\n    };\n}\nfunction verifyTargetIdsIsArray(targetIdsArg) {\n    invariant(Array.isArray(targetIdsArg), 'Expected targetIds to be an array.');\n}\nfunction checkInvariants(targetIds, monitor, registry) {\n    invariant(monitor.isDragging(), 'Cannot call hover while not dragging.');\n    invariant(!monitor.didDrop(), 'Cannot call hover after drop.');\n    for(let i = 0; i < targetIds.length; i++){\n        const targetId = targetIds[i];\n        invariant(targetIds.lastIndexOf(targetId) === i, 'Expected targetIds to be unique in the passed array.');\n        const target = registry.getTarget(targetId);\n        invariant(target, 'Expected targetIds to be registered.');\n    }\n}\nfunction removeNonMatchingTargetIds(targetIds, registry, draggedItemType) {\n    // Remove those targetIds that don't match the targetType.  This\n    // fixes shallow isOver which would only be non-shallow because of\n    // non-matching targets.\n    for(let i = targetIds.length - 1; i >= 0; i--){\n        const targetId = targetIds[i];\n        const targetType = registry.getTargetType(targetId);\n        if (!matchesType(targetType, draggedItemType)) {\n            targetIds.splice(i, 1);\n        }\n    }\n}\nfunction hoverAllTargets(targetIds, monitor, registry) {\n    // Finally call hover on all matching targets.\n    targetIds.forEach(function(targetId) {\n        const target = registry.getTarget(targetId);\n        target.hover(monitor, targetId);\n    });\n}\n\n//# sourceMappingURL=hover.js.map","import { PUBLISH_DRAG_SOURCE } from './types.js';\nexport function createPublishDragSource(manager) {\n    return function publishDragSource() {\n        const monitor = manager.getMonitor();\n        if (monitor.isDragging()) {\n            return {\n                type: PUBLISH_DRAG_SOURCE\n            };\n        }\n        return;\n    };\n}\n\n//# sourceMappingURL=publishDragSource.js.map","import { createDragDropActions } from '../actions/dragDrop/index.js';\nexport class DragDropManagerImpl {\n    receiveBackend(backend) {\n        this.backend = backend;\n    }\n    getMonitor() {\n        return this.monitor;\n    }\n    getBackend() {\n        return this.backend;\n    }\n    getRegistry() {\n        return this.monitor.registry;\n    }\n    getActions() {\n        /* eslint-disable-next-line @typescript-eslint/no-this-alias */ const manager = this;\n        const { dispatch  } = this.store;\n        function bindActionCreator(actionCreator) {\n            return (...args)=>{\n                const action = actionCreator.apply(manager, args);\n                if (typeof action !== 'undefined') {\n                    dispatch(action);\n                }\n            };\n        }\n        const actions = createDragDropActions(this);\n        return Object.keys(actions).reduce((boundActions, key)=>{\n            const action = actions[key];\n            boundActions[key] = bindActionCreator(action);\n            return boundActions;\n        }, {});\n    }\n    dispatch(action) {\n        this.store.dispatch(action);\n    }\n    constructor(store, monitor){\n        this.isSetUp = false;\n        this.handleRefCountChange = ()=>{\n            const shouldSetUp = this.store.getState().refCount > 0;\n            if (this.backend) {\n                if (shouldSetUp && !this.isSetUp) {\n                    this.backend.setup();\n                    this.isSetUp = true;\n                } else if (!shouldSetUp && this.isSetUp) {\n                    this.backend.teardown();\n                    this.isSetUp = false;\n                }\n            }\n        };\n        this.store = store;\n        this.monitor = monitor;\n        store.subscribe(this.handleRefCountChange);\n    }\n}\n\n//# sourceMappingURL=DragDropManagerImpl.js.map","import { createBeginDrag } from './beginDrag.js';\nimport { createDrop } from './drop.js';\nimport { createEndDrag } from './endDrag.js';\nimport { createHover } from './hover.js';\nimport { createPublishDragSource } from './publishDragSource.js';\nexport * from './types.js';\nexport function createDragDropActions(manager) {\n    return {\n        beginDrag: createBeginDrag(manager),\n        publishDragSource: createPublishDragSource(manager),\n        hover: createHover(manager),\n        drop: createDrop(manager),\n        endDrag: createEndDrag(manager)\n    };\n}\n\n//# sourceMappingURL=index.js.map","/**\n * Coordinate addition\n * @param a The first coordinate\n * @param b The second coordinate\n */ export function add(a, b) {\n    return {\n        x: a.x + b.x,\n        y: a.y + b.y\n    };\n}\n/**\n * Coordinate subtraction\n * @param a The first coordinate\n * @param b The second coordinate\n */ export function subtract(a, b) {\n    return {\n        x: a.x - b.x,\n        y: a.y - b.y\n    };\n}\n/**\n * Returns the cartesian distance of the drag source component's position, based on its position\n * at the time when the current drag operation has started, and the movement difference.\n *\n * Returns null if no item is being dragged.\n *\n * @param state The offset state to compute from\n */ export function getSourceClientOffset(state) {\n    const { clientOffset , initialClientOffset , initialSourceClientOffset  } = state;\n    if (!clientOffset || !initialClientOffset || !initialSourceClientOffset) {\n        return null;\n    }\n    return subtract(add(clientOffset, initialSourceClientOffset), initialClientOffset);\n}\n/**\n * Determines the x,y offset between the client offset and the initial client offset\n *\n * @param state The offset state to compute from\n */ export function getDifferenceFromInitialOffset(state) {\n    const { clientOffset , initialClientOffset  } = state;\n    if (!clientOffset || !initialClientOffset) {\n        return null;\n    }\n    return subtract(clientOffset, initialClientOffset);\n}\n\n//# sourceMappingURL=coords.js.map","import { intersection } from './js_utils.js';\nexport const NONE = [];\nexport const ALL = [];\nNONE.__IS_NONE__ = true;\nALL.__IS_ALL__ = true;\n/**\n * Determines if the given handler IDs are dirty or not.\n *\n * @param dirtyIds The set of dirty handler ids\n * @param handlerIds The set of handler ids to check\n */ export function areDirty(dirtyIds, handlerIds) {\n    if (dirtyIds === NONE) {\n        return false;\n    }\n    if (dirtyIds === ALL || typeof handlerIds === 'undefined') {\n        return true;\n    }\n    const commonIds = intersection(handlerIds, dirtyIds);\n    return commonIds.length > 0;\n}\n\n//# sourceMappingURL=dirtiness.js.map","import { invariant } from '@react-dnd/invariant';\nimport { getDifferenceFromInitialOffset, getSourceClientOffset } from '../utils/coords.js';\nimport { areDirty } from '../utils/dirtiness.js';\nimport { matchesType } from '../utils/matchesType.js';\nexport class DragDropMonitorImpl {\n    subscribeToStateChange(listener, options = {}) {\n        const { handlerIds  } = options;\n        invariant(typeof listener === 'function', 'listener must be a function.');\n        invariant(typeof handlerIds === 'undefined' || Array.isArray(handlerIds), 'handlerIds, when specified, must be an array of strings.');\n        let prevStateId = this.store.getState().stateId;\n        const handleChange = ()=>{\n            const state = this.store.getState();\n            const currentStateId = state.stateId;\n            try {\n                const canSkipListener = currentStateId === prevStateId || currentStateId === prevStateId + 1 && !areDirty(state.dirtyHandlerIds, handlerIds);\n                if (!canSkipListener) {\n                    listener();\n                }\n            } finally{\n                prevStateId = currentStateId;\n            }\n        };\n        return this.store.subscribe(handleChange);\n    }\n    subscribeToOffsetChange(listener) {\n        invariant(typeof listener === 'function', 'listener must be a function.');\n        let previousState = this.store.getState().dragOffset;\n        const handleChange = ()=>{\n            const nextState = this.store.getState().dragOffset;\n            if (nextState === previousState) {\n                return;\n            }\n            previousState = nextState;\n            listener();\n        };\n        return this.store.subscribe(handleChange);\n    }\n    canDragSource(sourceId) {\n        if (!sourceId) {\n            return false;\n        }\n        const source = this.registry.getSource(sourceId);\n        invariant(source, `Expected to find a valid source. sourceId=${sourceId}`);\n        if (this.isDragging()) {\n            return false;\n        }\n        return source.canDrag(this, sourceId);\n    }\n    canDropOnTarget(targetId) {\n        // undefined on initial render\n        if (!targetId) {\n            return false;\n        }\n        const target = this.registry.getTarget(targetId);\n        invariant(target, `Expected to find a valid target. targetId=${targetId}`);\n        if (!this.isDragging() || this.didDrop()) {\n            return false;\n        }\n        const targetType = this.registry.getTargetType(targetId);\n        const draggedItemType = this.getItemType();\n        return matchesType(targetType, draggedItemType) && target.canDrop(this, targetId);\n    }\n    isDragging() {\n        return Boolean(this.getItemType());\n    }\n    isDraggingSource(sourceId) {\n        // undefined on initial render\n        if (!sourceId) {\n            return false;\n        }\n        const source = this.registry.getSource(sourceId, true);\n        invariant(source, `Expected to find a valid source. sourceId=${sourceId}`);\n        if (!this.isDragging() || !this.isSourcePublic()) {\n            return false;\n        }\n        const sourceType = this.registry.getSourceType(sourceId);\n        const draggedItemType = this.getItemType();\n        if (sourceType !== draggedItemType) {\n            return false;\n        }\n        return source.isDragging(this, sourceId);\n    }\n    isOverTarget(targetId, options = {\n        shallow: false\n    }) {\n        // undefined on initial render\n        if (!targetId) {\n            return false;\n        }\n        const { shallow  } = options;\n        if (!this.isDragging()) {\n            return false;\n        }\n        const targetType = this.registry.getTargetType(targetId);\n        const draggedItemType = this.getItemType();\n        if (draggedItemType && !matchesType(targetType, draggedItemType)) {\n            return false;\n        }\n        const targetIds = this.getTargetIds();\n        if (!targetIds.length) {\n            return false;\n        }\n        const index = targetIds.indexOf(targetId);\n        if (shallow) {\n            return index === targetIds.length - 1;\n        } else {\n            return index > -1;\n        }\n    }\n    getItemType() {\n        return this.store.getState().dragOperation.itemType;\n    }\n    getItem() {\n        return this.store.getState().dragOperation.item;\n    }\n    getSourceId() {\n        return this.store.getState().dragOperation.sourceId;\n    }\n    getTargetIds() {\n        return this.store.getState().dragOperation.targetIds;\n    }\n    getDropResult() {\n        return this.store.getState().dragOperation.dropResult;\n    }\n    didDrop() {\n        return this.store.getState().dragOperation.didDrop;\n    }\n    isSourcePublic() {\n        return Boolean(this.store.getState().dragOperation.isSourcePublic);\n    }\n    getInitialClientOffset() {\n        return this.store.getState().dragOffset.initialClientOffset;\n    }\n    getInitialSourceClientOffset() {\n        return this.store.getState().dragOffset.initialSourceClientOffset;\n    }\n    getClientOffset() {\n        return this.store.getState().dragOffset.clientOffset;\n    }\n    getSourceClientOffset() {\n        return getSourceClientOffset(this.store.getState().dragOffset);\n    }\n    getDifferenceFromInitialOffset() {\n        return getDifferenceFromInitialOffset(this.store.getState().dragOffset);\n    }\n    constructor(store, registry){\n        this.store = store;\n        this.registry = registry;\n    }\n}\n\n//# sourceMappingURL=DragDropMonitorImpl.js.map","// Safari 6 and 6.1 for desktop, iPad, and iPhone are the only browsers that\n// have WebKitMutationObserver but not un-prefixed MutationObserver.\n// Must use `global` or `self` instead of `window` to work in both frames and web\n// workers. `global` is a provision of Browserify, Mr, Mrs, or Mop.\n/* globals self */ const scope = typeof global !== 'undefined' ? global : self;\nconst BrowserMutationObserver = scope.MutationObserver || scope.WebKitMutationObserver;\nexport function makeRequestCallFromTimer(callback) {\n    return function requestCall() {\n        // We dispatch a timeout with a specified delay of 0 for engines that\n        // can reliably accommodate that request. This will usually be snapped\n        // to a 4 milisecond delay, but once we're flushing, there's no delay\n        // between events.\n        const timeoutHandle = setTimeout(handleTimer, 0);\n        // However, since this timer gets frequently dropped in Firefox\n        // workers, we enlist an interval handle that will try to fire\n        // an event 20 times per second until it succeeds.\n        const intervalHandle = setInterval(handleTimer, 50);\n        function handleTimer() {\n            // Whichever timer succeeds will cancel both timers and\n            // execute the callback.\n            clearTimeout(timeoutHandle);\n            clearInterval(intervalHandle);\n            callback();\n        }\n    };\n}\n// To request a high priority event, we induce a mutation observer by toggling\n// the text of a text node between \"1\" and \"-1\".\nexport function makeRequestCallFromMutationObserver(callback) {\n    let toggle = 1;\n    const observer = new BrowserMutationObserver(callback);\n    const node = document.createTextNode('');\n    observer.observe(node, {\n        characterData: true\n    });\n    return function requestCall() {\n        toggle = -toggle;\n        node.data = toggle;\n    };\n}\nexport const makeRequestCall = typeof BrowserMutationObserver === 'function' ? // reliably everywhere they are implemented.\n// They are implemented in all modern browsers.\n//\n// - Android 4-4.3\n// - Chrome 26-34\n// - Firefox 14-29\n// - Internet Explorer 11\n// - iPad Safari 6-7.1\n// - iPhone Safari 7-7.1\n// - Safari 6-7\nmakeRequestCallFromMutationObserver : // task queue, are implemented in Internet Explorer 10, Safari 5.0-1, and Opera\n// 11-12, and in web workers in many engines.\n// Although message channels yield to any queued rendering and IO tasks, they\n// would be better than imposing the 4ms delay of timers.\n// However, they do not work reliably in Internet Explorer or Safari.\n// Internet Explorer 10 is the only browser that has setImmediate but does\n// not have MutationObservers.\n// Although setImmediate yields to the browser's renderer, it would be\n// preferrable to falling back to setTimeout since it does not have\n// the minimum 4ms penalty.\n// Unfortunately there appears to be a bug in Internet Explorer 10 Mobile (and\n// Desktop to a lesser extent) that renders both setImmediate and\n// MessageChannel useless for the purposes of ASAP.\n// https://github.com/kriskowal/q/issues/396\n// Timers are implemented universally.\n// We fall back to timers in workers in most engines, and in foreground\n// contexts in the following browsers.\n// However, note that even this simple case requires nuances to operate in a\n// broad spectrum of browsers.\n//\n// - Firefox 3-13\n// - Internet Explorer 6-9\n// - iPad Safari 4.3\n// - Lynx 2.8.7\nmakeRequestCallFromTimer;\n\n//# sourceMappingURL=makeRequestCall.js.map","// `call`, just like a function.\nexport class RawTask {\n    call() {\n        try {\n            this.task && this.task();\n        } catch (error) {\n            this.onError(error);\n        } finally{\n            this.task = null;\n            this.release(this);\n        }\n    }\n    constructor(onError, release){\n        this.onError = onError;\n        this.release = release;\n        this.task = null;\n    }\n}\n\n//# sourceMappingURL=RawTask.js.map","import { AsapQueue } from './AsapQueue.js';\nimport { TaskFactory } from './TaskFactory.js';\nconst asapQueue = new AsapQueue();\nconst taskFactory = new TaskFactory(asapQueue.registerPendingError);\n/**\n * Calls a task as soon as possible after returning, in its own event, with priority\n * over other events like animation, reflow, and repaint. An error thrown from an\n * event will not interrupt, nor even substantially slow down the processing of\n * other events, but will be rather postponed to a lower priority event.\n * @param {{call}} task A callable object, typically a function that takes no\n * arguments.\n */ export function asap(task) {\n    asapQueue.enqueueTask(taskFactory.create(task));\n}\n\n//# sourceMappingURL=asap.js.map","/* eslint-disable no-restricted-globals, @typescript-eslint/ban-ts-comment, @typescript-eslint/no-unused-vars, @typescript-eslint/no-non-null-assertion */ import { makeRequestCall, makeRequestCallFromTimer } from './makeRequestCall.js';\nexport class AsapQueue {\n    // Use the fastest means possible to execute a task in its own turn, with\n    // priority over other events including IO, animation, reflow, and redraw\n    // events in browsers.\n    //\n    // An exception thrown by a task will permanently interrupt the processing of\n    // subsequent tasks. The higher level `asap` function ensures that if an\n    // exception is thrown by a task, that the task queue will continue flushing as\n    // soon as possible, but if you use `rawAsap` directly, you are responsible to\n    // either ensure that no exceptions are thrown from your task, or to manually\n    // call `rawAsap.requestFlush` if an exception is thrown.\n    enqueueTask(task) {\n        const { queue: q , requestFlush  } = this;\n        if (!q.length) {\n            requestFlush();\n            this.flushing = true;\n        }\n        // Equivalent to push, but avoids a function call.\n        q[q.length] = task;\n    }\n    constructor(){\n        this.queue = [];\n        // We queue errors to ensure they are thrown in right order (FIFO).\n        // Array-as-queue is good enough here, since we are just dealing with exceptions.\n        this.pendingErrors = [];\n        // Once a flush has been requested, no further calls to `requestFlush` are\n        // necessary until the next `flush` completes.\n        // @ts-ignore\n        this.flushing = false;\n        // The position of the next task to execute in the task queue. This is\n        // preserved between calls to `flush` so that it can be resumed if\n        // a task throws an exception.\n        this.index = 0;\n        // If a task schedules additional tasks recursively, the task queue can grow\n        // unbounded. To prevent memory exhaustion, the task queue will periodically\n        // truncate already-completed tasks.\n        this.capacity = 1024;\n        // The flush function processes all tasks that have been scheduled with\n        // `rawAsap` unless and until one of those tasks throws an exception.\n        // If a task throws an exception, `flush` ensures that its state will remain\n        // consistent and will resume where it left off when called again.\n        // However, `flush` does not make any arrangements to be called again if an\n        // exception is thrown.\n        this.flush = ()=>{\n            const { queue: q  } = this;\n            while(this.index < q.length){\n                const currentIndex = this.index;\n                // Advance the index before calling the task. This ensures that we will\n                // begin flushing on the next task the task throws an error.\n                this.index++;\n                q[currentIndex].call();\n                // Prevent leaking memory for long chains of recursive calls to `asap`.\n                // If we call `asap` within tasks scheduled by `asap`, the queue will\n                // grow, but to avoid an O(n) walk for every task we execute, we don't\n                // shift tasks off the queue after they have been executed.\n                // Instead, we periodically shift 1024 tasks off the queue.\n                if (this.index > this.capacity) {\n                    // Manually shift all values starting at the index back to the\n                    // beginning of the queue.\n                    for(let scan = 0, newLength = q.length - this.index; scan < newLength; scan++){\n                        q[scan] = q[scan + this.index];\n                    }\n                    q.length -= this.index;\n                    this.index = 0;\n                }\n            }\n            q.length = 0;\n            this.index = 0;\n            this.flushing = false;\n        };\n        // In a web browser, exceptions are not fatal. However, to avoid\n        // slowing down the queue of pending tasks, we rethrow the error in a\n        // lower priority turn.\n        this.registerPendingError = (err)=>{\n            this.pendingErrors.push(err);\n            this.requestErrorThrow();\n        };\n        // `requestFlush` requests that the high priority event queue be flushed as\n        // soon as possible.\n        // This is useful to prevent an error thrown in a task from stalling the event\n        // queue if the exception handled by Node.jss\n        // `process.on(\"uncaughtException\")` or by a domain.\n        // `requestFlush` is implemented using a strategy based on data collected from\n        // every available SauceLabs Selenium web driver worker at time of writing.\n        // https://docs.google.com/spreadsheets/d/1mG-5UYGup5qxGdEMWkhP6BWCz053NUb2E1QoUTU16uA/edit#gid=783724593\n        this.requestFlush = makeRequestCall(this.flush);\n        this.requestErrorThrow = makeRequestCallFromTimer(()=>{\n            // Throw first error\n            if (this.pendingErrors.length) {\n                throw this.pendingErrors.shift();\n            }\n        });\n    }\n} // The message channel technique was discovered by Malte Ubl and was the\n // original foundation for this library.\n // http://www.nonblocking.io/2011/06/windownexttick.html\n // Safari 6.0.5 (at least) intermittently fails to create message ports on a\n // page's first load. Thankfully, this version of Safari supports\n // MutationObservers, so we don't need to fall back in that case.\n // function makeRequestCallFromMessageChannel(callback) {\n //     var channel = new MessageChannel();\n //     channel.port1.onmessage = callback;\n //     return function requestCall() {\n //         channel.port2.postMessage(0);\n //     };\n // }\n // For reasons explained above, we are also unable to use `setImmediate`\n // under any circumstances.\n // Even if we were, there is another bug in Internet Explorer 10.\n // It is not sufficient to assign `setImmediate` to `requestFlush` because\n // `setImmediate` must be called *by name* and therefore must be wrapped in a\n // closure.\n // Never forget.\n // function makeRequestCallFromSetImmediate(callback) {\n //     return function requestCall() {\n //         setImmediate(callback);\n //     };\n // }\n // Safari 6.0 has a problem where timers will get lost while the user is\n // scrolling. This problem does not impact ASAP because Safari 6.0 supports\n // mutation observers, so that implementation is used instead.\n // However, if we ever elect to use timers in Safari, the prevalent work-around\n // is to add a scroll event listener that calls for a flush.\n // `setTimeout` does not call the passed callback if the delay is less than\n // approximately 7 in web workers in Firefox 8 through 18, and sometimes not\n // even then.\n // This is for `asap.js` only.\n // Its name will be periodically randomized to break any code that depends on\n // // its existence.\n // rawAsap.makeRequestCallFromTimer = makeRequestCallFromTimer\n // ASAP was originally a nextTick shim included in Q. This was factored out\n // into this ASAP package. It was later adapted to RSVP which made further\n // amendments. These decisions, particularly to marginalize MessageChannel and\n // to capture the MutationObserver implementation in a closure, were integrated\n // back into ASAP proper.\n // https://github.com/tildeio/rsvp.js/blob/cddf7232546a9cf858524b75cde6f9edf72620a7/lib/rsvp/asap.js\n\n//# sourceMappingURL=AsapQueue.js.map","import { RawTask } from './RawTask.js';\nexport class TaskFactory {\n    create(task) {\n        const tasks = this.freeTasks;\n        const t1 = tasks.length ? tasks.pop() : new RawTask(this.onError, (t)=>tasks[tasks.length] = t\n        );\n        t1.task = task;\n        return t1;\n    }\n    constructor(onError){\n        this.onError = onError;\n        this.freeTasks = [];\n    }\n}\n\n//# sourceMappingURL=TaskFactory.js.map","export const ADD_SOURCE = 'dnd-core/ADD_SOURCE';\nexport const ADD_TARGET = 'dnd-core/ADD_TARGET';\nexport const REMOVE_SOURCE = 'dnd-core/REMOVE_SOURCE';\nexport const REMOVE_TARGET = 'dnd-core/REMOVE_TARGET';\nexport function addSource(sourceId) {\n    return {\n        type: ADD_SOURCE,\n        payload: {\n            sourceId\n        }\n    };\n}\nexport function addTarget(targetId) {\n    return {\n        type: ADD_TARGET,\n        payload: {\n            targetId\n        }\n    };\n}\nexport function removeSource(sourceId) {\n    return {\n        type: REMOVE_SOURCE,\n        payload: {\n            sourceId\n        }\n    };\n}\nexport function removeTarget(targetId) {\n    return {\n        type: REMOVE_TARGET,\n        payload: {\n            targetId\n        }\n    };\n}\n\n//# sourceMappingURL=registry.js.map","import { invariant } from '@react-dnd/invariant';\nexport function validateSourceContract(source) {\n    invariant(typeof source.canDrag === 'function', 'Expected canDrag to be a function.');\n    invariant(typeof source.beginDrag === 'function', 'Expected beginDrag to be a function.');\n    invariant(typeof source.endDrag === 'function', 'Expected endDrag to be a function.');\n}\nexport function validateTargetContract(target) {\n    invariant(typeof target.canDrop === 'function', 'Expected canDrop to be a function.');\n    invariant(typeof target.hover === 'function', 'Expected hover to be a function.');\n    invariant(typeof target.drop === 'function', 'Expected beginDrag to be a function.');\n}\nexport function validateType(type, allowArray) {\n    if (allowArray && Array.isArray(type)) {\n        type.forEach((t)=>validateType(t, false)\n        );\n        return;\n    }\n    invariant(typeof type === 'string' || typeof type === 'symbol', allowArray ? 'Type can only be a string, a symbol, or an array of either.' : 'Type can only be a string or a symbol.');\n}\n\n//# sourceMappingURL=contracts.js.map","export var HandlerRole;\n(function(HandlerRole) {\n    HandlerRole[\"SOURCE\"] = \"SOURCE\";\n    HandlerRole[\"TARGET\"] = \"TARGET\";\n})(HandlerRole || (HandlerRole = {}));\n\n//# sourceMappingURL=interfaces.js.map","let nextUniqueId = 0;\nexport function getNextUniqueId() {\n    return nextUniqueId++;\n}\n\n//# sourceMappingURL=getNextUniqueId.js.map","import { asap } from '@react-dnd/asap';\nimport { invariant } from '@react-dnd/invariant';\nimport { addSource, addTarget, removeSource, removeTarget } from '../actions/registry.js';\nimport { validateSourceContract, validateTargetContract, validateType } from '../contracts.js';\nimport { HandlerRole } from '../interfaces.js';\nimport { getNextUniqueId } from '../utils/getNextUniqueId.js';\nfunction getNextHandlerId(role) {\n    const id = getNextUniqueId().toString();\n    switch(role){\n        case HandlerRole.SOURCE:\n            return `S${id}`;\n        case HandlerRole.TARGET:\n            return `T${id}`;\n        default:\n            throw new Error(`Unknown Handler Role: ${role}`);\n    }\n}\nfunction parseRoleFromHandlerId(handlerId) {\n    switch(handlerId[0]){\n        case 'S':\n            return HandlerRole.SOURCE;\n        case 'T':\n            return HandlerRole.TARGET;\n        default:\n            throw new Error(`Cannot parse handler ID: ${handlerId}`);\n    }\n}\nfunction mapContainsValue(map, searchValue) {\n    const entries = map.entries();\n    let isDone = false;\n    do {\n        const { done , value: [, value] ,  } = entries.next();\n        if (value === searchValue) {\n            return true;\n        }\n        isDone = !!done;\n    }while (!isDone)\n    return false;\n}\nexport class HandlerRegistryImpl {\n    addSource(type, source) {\n        validateType(type);\n        validateSourceContract(source);\n        const sourceId = this.addHandler(HandlerRole.SOURCE, type, source);\n        this.store.dispatch(addSource(sourceId));\n        return sourceId;\n    }\n    addTarget(type, target) {\n        validateType(type, true);\n        validateTargetContract(target);\n        const targetId = this.addHandler(HandlerRole.TARGET, type, target);\n        this.store.dispatch(addTarget(targetId));\n        return targetId;\n    }\n    containsHandler(handler) {\n        return mapContainsValue(this.dragSources, handler) || mapContainsValue(this.dropTargets, handler);\n    }\n    getSource(sourceId, includePinned = false) {\n        invariant(this.isSourceId(sourceId), 'Expected a valid source ID.');\n        const isPinned = includePinned && sourceId === this.pinnedSourceId;\n        const source = isPinned ? this.pinnedSource : this.dragSources.get(sourceId);\n        return source;\n    }\n    getTarget(targetId) {\n        invariant(this.isTargetId(targetId), 'Expected a valid target ID.');\n        return this.dropTargets.get(targetId);\n    }\n    getSourceType(sourceId) {\n        invariant(this.isSourceId(sourceId), 'Expected a valid source ID.');\n        return this.types.get(sourceId);\n    }\n    getTargetType(targetId) {\n        invariant(this.isTargetId(targetId), 'Expected a valid target ID.');\n        return this.types.get(targetId);\n    }\n    isSourceId(handlerId) {\n        const role = parseRoleFromHandlerId(handlerId);\n        return role === HandlerRole.SOURCE;\n    }\n    isTargetId(handlerId) {\n        const role = parseRoleFromHandlerId(handlerId);\n        return role === HandlerRole.TARGET;\n    }\n    removeSource(sourceId) {\n        invariant(this.getSource(sourceId), 'Expected an existing source.');\n        this.store.dispatch(removeSource(sourceId));\n        asap(()=>{\n            this.dragSources.delete(sourceId);\n            this.types.delete(sourceId);\n        });\n    }\n    removeTarget(targetId) {\n        invariant(this.getTarget(targetId), 'Expected an existing target.');\n        this.store.dispatch(removeTarget(targetId));\n        this.dropTargets.delete(targetId);\n        this.types.delete(targetId);\n    }\n    pinSource(sourceId) {\n        const source = this.getSource(sourceId);\n        invariant(source, 'Expected an existing source.');\n        this.pinnedSourceId = sourceId;\n        this.pinnedSource = source;\n    }\n    unpinSource() {\n        invariant(this.pinnedSource, 'No source is pinned at the time.');\n        this.pinnedSourceId = null;\n        this.pinnedSource = null;\n    }\n    addHandler(role, type, handler) {\n        const id = getNextHandlerId(role);\n        this.types.set(id, type);\n        if (role === HandlerRole.SOURCE) {\n            this.dragSources.set(id, handler);\n        } else if (role === HandlerRole.TARGET) {\n            this.dropTargets.set(id, handler);\n        }\n        return id;\n    }\n    constructor(store){\n        this.types = new Map();\n        this.dragSources = new Map();\n        this.dropTargets = new Map();\n        this.pinnedSourceId = null;\n        this.pinnedSource = null;\n        this.store = store;\n    }\n}\n\n//# sourceMappingURL=HandlerRegistryImpl.js.map","export const strictEquality = (a, b)=>a === b\n;\n/**\n * Determine if two cartesian coordinate offsets are equal\n * @param offsetA\n * @param offsetB\n */ export function areCoordsEqual(offsetA, offsetB) {\n    if (!offsetA && !offsetB) {\n        return true;\n    } else if (!offsetA || !offsetB) {\n        return false;\n    } else {\n        return offsetA.x === offsetB.x && offsetA.y === offsetB.y;\n    }\n}\n/**\n * Determines if two arrays of items are equal\n * @param a The first array of items\n * @param b The second array of items\n */ export function areArraysEqual(a, b, isEqual = strictEquality) {\n    if (a.length !== b.length) {\n        return false;\n    }\n    for(let i = 0; i < a.length; ++i){\n        if (!isEqual(a[i], b[i])) {\n            return false;\n        }\n    }\n    return true;\n}\n\n//# sourceMappingURL=equality.js.map","import { BEGIN_DRAG, DROP, END_DRAG, HOVER, PUBLISH_DRAG_SOURCE } from '../actions/dragDrop/index.js';\nimport { ADD_SOURCE, ADD_TARGET, REMOVE_SOURCE, REMOVE_TARGET } from '../actions/registry.js';\nimport { ALL, NONE } from '../utils/dirtiness.js';\nimport { areArraysEqual } from '../utils/equality.js';\nimport { xor } from '../utils/js_utils.js';\nexport function reduce(// eslint-disable-next-line @typescript-eslint/no-unused-vars\n_state = NONE, action) {\n    switch(action.type){\n        case HOVER:\n            break;\n        case ADD_SOURCE:\n        case ADD_TARGET:\n        case REMOVE_TARGET:\n        case REMOVE_SOURCE:\n            return NONE;\n        case BEGIN_DRAG:\n        case PUBLISH_DRAG_SOURCE:\n        case END_DRAG:\n        case DROP:\n        default:\n            return ALL;\n    }\n    const { targetIds =[] , prevTargetIds =[]  } = action.payload;\n    const result = xor(targetIds, prevTargetIds);\n    const didChange = result.length > 0 || !areArraysEqual(targetIds, prevTargetIds);\n    if (!didChange) {\n        return NONE;\n    }\n    // Check the target ids at the innermost position. If they are valid, add them\n    // to the result\n    const prevInnermostTargetId = prevTargetIds[prevTargetIds.length - 1];\n    const innermostTargetId = targetIds[targetIds.length - 1];\n    if (prevInnermostTargetId !== innermostTargetId) {\n        if (prevInnermostTargetId) {\n            result.push(prevInnermostTargetId);\n        }\n        if (innermostTargetId) {\n            result.push(innermostTargetId);\n        }\n    }\n    return result;\n}\n\n//# sourceMappingURL=dirtyHandlerIds.js.map","function _defineProperty(obj, key, value) {\n    if (key in obj) {\n        Object.defineProperty(obj, key, {\n            value: value,\n            enumerable: true,\n            configurable: true,\n            writable: true\n        });\n    } else {\n        obj[key] = value;\n    }\n    return obj;\n}\nfunction _objectSpread(target) {\n    for(var i = 1; i < arguments.length; i++){\n        var source = arguments[i] != null ? arguments[i] : {};\n        var ownKeys = Object.keys(source);\n        if (typeof Object.getOwnPropertySymbols === 'function') {\n            ownKeys = ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function(sym) {\n                return Object.getOwnPropertyDescriptor(source, sym).enumerable;\n            }));\n        }\n        ownKeys.forEach(function(key) {\n            _defineProperty(target, key, source[key]);\n        });\n    }\n    return target;\n}\nimport { BEGIN_DRAG, DROP, END_DRAG, HOVER, INIT_COORDS } from '../actions/dragDrop/index.js';\nimport { areCoordsEqual } from '../utils/equality.js';\nconst initialState = {\n    initialSourceClientOffset: null,\n    initialClientOffset: null,\n    clientOffset: null\n};\nexport function reduce(state = initialState, action) {\n    const { payload  } = action;\n    switch(action.type){\n        case INIT_COORDS:\n        case BEGIN_DRAG:\n            return {\n                initialSourceClientOffset: payload.sourceClientOffset,\n                initialClientOffset: payload.clientOffset,\n                clientOffset: payload.clientOffset\n            };\n        case HOVER:\n            if (areCoordsEqual(state.clientOffset, payload.clientOffset)) {\n                return state;\n            }\n            return _objectSpread({}, state, {\n                clientOffset: payload.clientOffset\n            });\n        case END_DRAG:\n        case DROP:\n            return initialState;\n        default:\n            return state;\n    }\n}\n\n//# sourceMappingURL=dragOffset.js.map","function _defineProperty(obj, key, value) {\n    if (key in obj) {\n        Object.defineProperty(obj, key, {\n            value: value,\n            enumerable: true,\n            configurable: true,\n            writable: true\n        });\n    } else {\n        obj[key] = value;\n    }\n    return obj;\n}\nfunction _objectSpread(target) {\n    for(var i = 1; i < arguments.length; i++){\n        var source = arguments[i] != null ? arguments[i] : {};\n        var ownKeys = Object.keys(source);\n        if (typeof Object.getOwnPropertySymbols === 'function') {\n            ownKeys = ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function(sym) {\n                return Object.getOwnPropertyDescriptor(source, sym).enumerable;\n            }));\n        }\n        ownKeys.forEach(function(key) {\n            _defineProperty(target, key, source[key]);\n        });\n    }\n    return target;\n}\nimport { BEGIN_DRAG, DROP, END_DRAG, HOVER, PUBLISH_DRAG_SOURCE } from '../actions/dragDrop/index.js';\nimport { REMOVE_TARGET } from '../actions/registry.js';\nimport { without } from '../utils/js_utils.js';\nconst initialState = {\n    itemType: null,\n    item: null,\n    sourceId: null,\n    targetIds: [],\n    dropResult: null,\n    didDrop: false,\n    isSourcePublic: null\n};\nexport function reduce(state = initialState, action) {\n    const { payload  } = action;\n    switch(action.type){\n        case BEGIN_DRAG:\n            return _objectSpread({}, state, {\n                itemType: payload.itemType,\n                item: payload.item,\n                sourceId: payload.sourceId,\n                isSourcePublic: payload.isSourcePublic,\n                dropResult: null,\n                didDrop: false\n            });\n        case PUBLISH_DRAG_SOURCE:\n            return _objectSpread({}, state, {\n                isSourcePublic: true\n            });\n        case HOVER:\n            return _objectSpread({}, state, {\n                targetIds: payload.targetIds\n            });\n        case REMOVE_TARGET:\n            if (state.targetIds.indexOf(payload.targetId) === -1) {\n                return state;\n            }\n            return _objectSpread({}, state, {\n                targetIds: without(state.targetIds, payload.targetId)\n            });\n        case DROP:\n            return _objectSpread({}, state, {\n                dropResult: payload.dropResult,\n                didDrop: true,\n                targetIds: []\n            });\n        case END_DRAG:\n            return _objectSpread({}, state, {\n                itemType: null,\n                item: null,\n                sourceId: null,\n                dropResult: null,\n                didDrop: false,\n                isSourcePublic: null,\n                targetIds: []\n            });\n        default:\n            return state;\n    }\n}\n\n//# sourceMappingURL=dragOperation.js.map","import { ADD_SOURCE, ADD_TARGET, REMOVE_SOURCE, REMOVE_TARGET } from '../actions/registry.js';\nexport function reduce(state = 0, action) {\n    switch(action.type){\n        case ADD_SOURCE:\n        case ADD_TARGET:\n            return state + 1;\n        case REMOVE_SOURCE:\n        case REMOVE_TARGET:\n            return state - 1;\n        default:\n            return state;\n    }\n}\n\n//# sourceMappingURL=refCount.js.map","export function reduce(state = 0) {\n    return state + 1;\n}\n\n//# sourceMappingURL=stateId.js.map","function _defineProperty(obj, key, value) {\n    if (key in obj) {\n        Object.defineProperty(obj, key, {\n            value: value,\n            enumerable: true,\n            configurable: true,\n            writable: true\n        });\n    } else {\n        obj[key] = value;\n    }\n    return obj;\n}\nfunction _objectSpread(target) {\n    for(var i = 1; i < arguments.length; i++){\n        var source = arguments[i] != null ? arguments[i] : {};\n        var ownKeys = Object.keys(source);\n        if (typeof Object.getOwnPropertySymbols === 'function') {\n            ownKeys = ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function(sym) {\n                return Object.getOwnPropertyDescriptor(source, sym).enumerable;\n            }));\n        }\n        ownKeys.forEach(function(key) {\n            _defineProperty(target, key, source[key]);\n        });\n    }\n    return target;\n}\nimport { get } from '../utils/js_utils.js';\nimport { reduce as dirtyHandlerIds } from './dirtyHandlerIds.js';\nimport { reduce as dragOffset } from './dragOffset.js';\nimport { reduce as dragOperation } from './dragOperation.js';\nimport { reduce as refCount } from './refCount.js';\nimport { reduce as stateId } from './stateId.js';\nexport function reduce(state = {}, action) {\n    return {\n        dirtyHandlerIds: dirtyHandlerIds(state.dirtyHandlerIds, {\n            type: action.type,\n            payload: _objectSpread({}, action.payload, {\n                prevTargetIds: get(state, 'dragOperation.targetIds', [])\n            })\n        }),\n        dragOffset: dragOffset(state.dragOffset, action),\n        refCount: refCount(state.refCount, action),\n        dragOperation: dragOperation(state.dragOperation, action),\n        stateId: stateId(state.stateId)\n    };\n}\n\n//# sourceMappingURL=index.js.map","import { createStore } from 'redux';\nimport { DragDropManagerImpl } from './classes/DragDropManagerImpl.js';\nimport { DragDropMonitorImpl } from './classes/DragDropMonitorImpl.js';\nimport { HandlerRegistryImpl } from './classes/HandlerRegistryImpl.js';\nimport { reduce } from './reducers/index.js';\nexport function createDragDropManager(backendFactory, globalContext = undefined, backendOptions = {}, debugMode = false) {\n    const store = makeStoreInstance(debugMode);\n    const monitor = new DragDropMonitorImpl(store, new HandlerRegistryImpl(store));\n    const manager = new DragDropManagerImpl(store, monitor);\n    const backend = backendFactory(manager, globalContext, backendOptions);\n    manager.receiveBackend(backend);\n    return manager;\n}\nfunction makeStoreInstance(debugMode) {\n    // TODO: if we ever make a react-native version of this,\n    // we'll need to consider how to pull off dev-tooling\n    const reduxDevTools = typeof window !== 'undefined' && window.__REDUX_DEVTOOLS_EXTENSION__;\n    return createStore(reduce, debugMode && reduxDevTools && reduxDevTools({\n        name: 'dnd-core',\n        instanceId: 'dnd-core'\n    }));\n}\n\n//# sourceMappingURL=createDragDropManager.js.map","function _objectWithoutProperties(source, excluded) {\n    if (source == null) return {};\n    var target = _objectWithoutPropertiesLoose(source, excluded);\n    var key, i;\n    if (Object.getOwnPropertySymbols) {\n        var sourceSymbolKeys = Object.getOwnPropertySymbols(source);\n        for(i = 0; i < sourceSymbolKeys.length; i++){\n            key = sourceSymbolKeys[i];\n            if (excluded.indexOf(key) >= 0) continue;\n            if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue;\n            target[key] = source[key];\n        }\n    }\n    return target;\n}\nfunction _objectWithoutPropertiesLoose(source, excluded) {\n    if (source == null) return {};\n    var target = {};\n    var sourceKeys = Object.keys(source);\n    var key, i;\n    for(i = 0; i < sourceKeys.length; i++){\n        key = sourceKeys[i];\n        if (excluded.indexOf(key) >= 0) continue;\n        target[key] = source[key];\n    }\n    return target;\n}\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { createDragDropManager } from 'dnd-core';\nimport { memo, useEffect } from 'react';\nimport { DndContext } from './DndContext.js';\nlet refCount = 0;\nconst INSTANCE_SYM = Symbol.for('__REACT_DND_CONTEXT_INSTANCE__');\nvar DndProvider = /*#__PURE__*/ memo(function DndProvider(_param) {\n    var { children  } = _param, props = _objectWithoutProperties(_param, [\n        \"children\"\n    ]);\n    const [manager, isGlobalInstance] = getDndContextValue(props) // memoized from props\n    ;\n    /**\n\t\t * If the global context was used to store the DND context\n\t\t * then where theres no more references to it we should\n\t\t * clean it up to avoid memory leaks\n\t\t */ useEffect(()=>{\n        if (isGlobalInstance) {\n            const context = getGlobalContext();\n            ++refCount;\n            return ()=>{\n                if (--refCount === 0) {\n                    context[INSTANCE_SYM] = null;\n                }\n            };\n        }\n        return;\n    }, []);\n    return /*#__PURE__*/ _jsx(DndContext.Provider, {\n        value: manager,\n        children: children\n    });\n});\n/**\n * A React component that provides the React-DnD context\n */ export { DndProvider,  };\nfunction getDndContextValue(props) {\n    if ('manager' in props) {\n        const manager = {\n            dragDropManager: props.manager\n        };\n        return [\n            manager,\n            false\n        ];\n    }\n    const manager = createSingletonDndContext(props.backend, props.context, props.options, props.debugMode);\n    const isGlobalInstance = !props.context;\n    return [\n        manager,\n        isGlobalInstance\n    ];\n}\nfunction createSingletonDndContext(backend, context = getGlobalContext(), options, debugMode) {\n    const ctx = context;\n    if (!ctx[INSTANCE_SYM]) {\n        ctx[INSTANCE_SYM] = {\n            dragDropManager: createDragDropManager(backend, context, options, debugMode)\n        };\n    }\n    return ctx[INSTANCE_SYM];\n}\nfunction getGlobalContext() {\n    return typeof global !== 'undefined' ? global : window;\n}\n\n//# sourceMappingURL=DndProvider.js.map","'use strict';\n\n// do not edit .js files directly - edit src/index.jst\n\n\n\nmodule.exports = function equal(a, b) {\n  if (a === b) return true;\n\n  if (a && b && typeof a == 'object' && typeof b == 'object') {\n    if (a.constructor !== b.constructor) return false;\n\n    var length, i, keys;\n    if (Array.isArray(a)) {\n      length = a.length;\n      if (length != b.length) return false;\n      for (i = length; i-- !== 0;)\n        if (!equal(a[i], b[i])) return false;\n      return true;\n    }\n\n\n\n    if (a.constructor === RegExp) return a.source === b.source && a.flags === b.flags;\n    if (a.valueOf !== Object.prototype.valueOf) return a.valueOf() === b.valueOf();\n    if (a.toString !== Object.prototype.toString) return a.toString() === b.toString();\n\n    keys = Object.keys(a);\n    length = keys.length;\n    if (length !== Object.keys(b).length) return false;\n\n    for (i = length; i-- !== 0;)\n      if (!Object.prototype.hasOwnProperty.call(b, keys[i])) return false;\n\n    for (i = length; i-- !== 0;) {\n      var key = keys[i];\n\n      if (!equal(a[key], b[key])) return false;\n    }\n\n    return true;\n  }\n\n  // true if both NaN, false otherwise\n  return a!==a && b!==b;\n};\n","import { useEffect, useLayoutEffect } from 'react';\n// suppress the useLayoutEffect warning on server side.\nexport const useIsomorphicLayoutEffect = typeof window !== 'undefined' ? useLayoutEffect : useEffect;\n\n//# sourceMappingURL=useIsomorphicLayoutEffect.js.map","import { useCollector } from './useCollector.js';\nimport { useIsomorphicLayoutEffect } from './useIsomorphicLayoutEffect.js';\nexport function useMonitorOutput(monitor, collect, onCollect) {\n    const [collected, updateCollected] = useCollector(monitor, collect, onCollect);\n    useIsomorphicLayoutEffect(function subscribeToMonitorStateChange() {\n        const handlerId = monitor.getHandlerId();\n        if (handlerId == null) {\n            return;\n        }\n        return monitor.subscribeToStateChange(updateCollected, {\n            handlerIds: [\n                handlerId\n            ]\n        });\n    }, [\n        monitor,\n        updateCollected\n    ]);\n    return collected;\n}\n\n//# sourceMappingURL=useMonitorOutput.js.map","import equal from 'fast-deep-equal';\nimport { useCallback, useState } from 'react';\nimport { useIsomorphicLayoutEffect } from './useIsomorphicLayoutEffect.js';\n/**\n *\n * @param monitor The monitor to collect state from\n * @param collect The collecting function\n * @param onUpdate A method to invoke when updates occur\n */ export function useCollector(monitor, collect, onUpdate) {\n    const [collected, setCollected] = useState(()=>collect(monitor)\n    );\n    const updateCollected = useCallback(()=>{\n        const nextValue = collect(monitor);\n        // This needs to be a deep-equality check because some monitor-collected values\n        // include XYCoord objects that may be equivalent, but do not have instance equality.\n        if (!equal(collected, nextValue)) {\n            setCollected(nextValue);\n            if (onUpdate) {\n                onUpdate();\n            }\n        }\n    }, [\n        collected,\n        monitor,\n        onUpdate\n    ]);\n    // update the collected properties after react renders.\n    // Note that the \"Dustbin Stress Test\" fails if this is not\n    // done when the component updates\n    useIsomorphicLayoutEffect(updateCollected);\n    return [\n        collected,\n        updateCollected\n    ];\n}\n\n//# sourceMappingURL=useCollector.js.map","import { useMonitorOutput } from './useMonitorOutput.js';\nexport function useCollectedProps(collector, monitor, connector) {\n    return useMonitorOutput(monitor, collector || (()=>({})\n    ), ()=>connector.reconnect()\n    );\n}\n\n//# sourceMappingURL=useCollectedProps.js.map","import { useMemo } from 'react';\nexport function useOptionalFactory(arg, deps) {\n    const memoDeps = [\n        ...deps || []\n    ];\n    if (deps == null && typeof arg !== 'function') {\n        memoDeps.push(arg);\n    }\n    return useMemo(()=>{\n        return typeof arg === 'function' ? arg() : arg;\n    }, memoDeps);\n}\n\n//# sourceMappingURL=useOptionalFactory.js.map","import { useMemo } from 'react';\nexport function useConnectDragSource(connector) {\n    return useMemo(()=>connector.hooks.dragSource()\n    , [\n        connector\n    ]);\n}\nexport function useConnectDragPreview(connector) {\n    return useMemo(()=>connector.hooks.dragPreview()\n    , [\n        connector\n    ]);\n}\n\n//# sourceMappingURL=connectors.js.map","import { invariant } from '@react-dnd/invariant';\nlet isCallingCanDrag = false;\nlet isCallingIsDragging = false;\nexport class DragSourceMonitorImpl {\n    receiveHandlerId(sourceId) {\n        this.sourceId = sourceId;\n    }\n    getHandlerId() {\n        return this.sourceId;\n    }\n    canDrag() {\n        invariant(!isCallingCanDrag, 'You may not call monitor.canDrag() inside your canDrag() implementation. ' + 'Read more: http://react-dnd.github.io/react-dnd/docs/api/drag-source-monitor');\n        try {\n            isCallingCanDrag = true;\n            return this.internalMonitor.canDragSource(this.sourceId);\n        } finally{\n            isCallingCanDrag = false;\n        }\n    }\n    isDragging() {\n        if (!this.sourceId) {\n            return false;\n        }\n        invariant(!isCallingIsDragging, 'You may not call monitor.isDragging() inside your isDragging() implementation. ' + 'Read more: http://react-dnd.github.io/react-dnd/docs/api/drag-source-monitor');\n        try {\n            isCallingIsDragging = true;\n            return this.internalMonitor.isDraggingSource(this.sourceId);\n        } finally{\n            isCallingIsDragging = false;\n        }\n    }\n    subscribeToStateChange(listener, options) {\n        return this.internalMonitor.subscribeToStateChange(listener, options);\n    }\n    isDraggingSource(sourceId) {\n        return this.internalMonitor.isDraggingSource(sourceId);\n    }\n    isOverTarget(targetId, options) {\n        return this.internalMonitor.isOverTarget(targetId, options);\n    }\n    getTargetIds() {\n        return this.internalMonitor.getTargetIds();\n    }\n    isSourcePublic() {\n        return this.internalMonitor.isSourcePublic();\n    }\n    getSourceId() {\n        return this.internalMonitor.getSourceId();\n    }\n    subscribeToOffsetChange(listener) {\n        return this.internalMonitor.subscribeToOffsetChange(listener);\n    }\n    canDragSource(sourceId) {\n        return this.internalMonitor.canDragSource(sourceId);\n    }\n    canDropOnTarget(targetId) {\n        return this.internalMonitor.canDropOnTarget(targetId);\n    }\n    getItemType() {\n        return this.internalMonitor.getItemType();\n    }\n    getItem() {\n        return this.internalMonitor.getItem();\n    }\n    getDropResult() {\n        return this.internalMonitor.getDropResult();\n    }\n    didDrop() {\n        return this.internalMonitor.didDrop();\n    }\n    getInitialClientOffset() {\n        return this.internalMonitor.getInitialClientOffset();\n    }\n    getInitialSourceClientOffset() {\n        return this.internalMonitor.getInitialSourceClientOffset();\n    }\n    getSourceClientOffset() {\n        return this.internalMonitor.getSourceClientOffset();\n    }\n    getClientOffset() {\n        return this.internalMonitor.getClientOffset();\n    }\n    getDifferenceFromInitialOffset() {\n        return this.internalMonitor.getDifferenceFromInitialOffset();\n    }\n    constructor(manager){\n        this.sourceId = null;\n        this.internalMonitor = manager.getMonitor();\n    }\n}\n\n//# sourceMappingURL=DragSourceMonitorImpl.js.map","import { invariant } from '@react-dnd/invariant';\nlet isCallingCanDrop = false;\nexport class DropTargetMonitorImpl {\n    receiveHandlerId(targetId) {\n        this.targetId = targetId;\n    }\n    getHandlerId() {\n        return this.targetId;\n    }\n    subscribeToStateChange(listener, options) {\n        return this.internalMonitor.subscribeToStateChange(listener, options);\n    }\n    canDrop() {\n        // Cut out early if the target id has not been set. This should prevent errors\n        // where the user has an older version of dnd-core like in\n        // https://github.com/react-dnd/react-dnd/issues/1310\n        if (!this.targetId) {\n            return false;\n        }\n        invariant(!isCallingCanDrop, 'You may not call monitor.canDrop() inside your canDrop() implementation. ' + 'Read more: http://react-dnd.github.io/react-dnd/docs/api/drop-target-monitor');\n        try {\n            isCallingCanDrop = true;\n            return this.internalMonitor.canDropOnTarget(this.targetId);\n        } finally{\n            isCallingCanDrop = false;\n        }\n    }\n    isOver(options) {\n        if (!this.targetId) {\n            return false;\n        }\n        return this.internalMonitor.isOverTarget(this.targetId, options);\n    }\n    getItemType() {\n        return this.internalMonitor.getItemType();\n    }\n    getItem() {\n        return this.internalMonitor.getItem();\n    }\n    getDropResult() {\n        return this.internalMonitor.getDropResult();\n    }\n    didDrop() {\n        return this.internalMonitor.didDrop();\n    }\n    getInitialClientOffset() {\n        return this.internalMonitor.getInitialClientOffset();\n    }\n    getInitialSourceClientOffset() {\n        return this.internalMonitor.getInitialSourceClientOffset();\n    }\n    getSourceClientOffset() {\n        return this.internalMonitor.getSourceClientOffset();\n    }\n    getClientOffset() {\n        return this.internalMonitor.getClientOffset();\n    }\n    getDifferenceFromInitialOffset() {\n        return this.internalMonitor.getDifferenceFromInitialOffset();\n    }\n    constructor(manager){\n        this.targetId = null;\n        this.internalMonitor = manager.getMonitor();\n    }\n}\n\n//# sourceMappingURL=DropTargetMonitorImpl.js.map","export function shallowEqual(objA, objB, compare, compareContext) {\n    let compareResult = compare ? compare.call(compareContext, objA, objB) : void 0;\n    if (compareResult !== void 0) {\n        return !!compareResult;\n    }\n    if (objA === objB) {\n        return true;\n    }\n    if (typeof objA !== 'object' || !objA || typeof objB !== 'object' || !objB) {\n        return false;\n    }\n    const keysA = Object.keys(objA);\n    const keysB = Object.keys(objB);\n    if (keysA.length !== keysB.length) {\n        return false;\n    }\n    const bHasOwnProperty = Object.prototype.hasOwnProperty.bind(objB);\n    // Test for A's keys different from B.\n    for(let idx = 0; idx < keysA.length; idx++){\n        const key = keysA[idx];\n        if (!bHasOwnProperty(key)) {\n            return false;\n        }\n        const valueA = objA[key];\n        const valueB = objB[key];\n        compareResult = compare ? compare.call(compareContext, valueA, valueB, key) : void 0;\n        if (compareResult === false || compareResult === void 0 && valueA !== valueB) {\n            return false;\n        }\n    }\n    return true;\n}\n\n//# sourceMappingURL=index.js.map","export function isRef(obj) {\n    return(// eslint-disable-next-line no-prototype-builtins\n    obj !== null && typeof obj === 'object' && Object.prototype.hasOwnProperty.call(obj, 'current'));\n}\n\n//# sourceMappingURL=isRef.js.map","import { invariant } from '@react-dnd/invariant';\nimport { cloneElement, isValidElement } from 'react';\nfunction throwIfCompositeComponentElement(element) {\n    // Custom components can no longer be wrapped directly in React DnD 2.0\n    // so that we don't need to depend on findDOMNode() from react-dom.\n    if (typeof element.type === 'string') {\n        return;\n    }\n    const displayName = element.type.displayName || element.type.name || 'the component';\n    throw new Error('Only native element nodes can now be passed to React DnD connectors.' + `You can either wrap ${displayName} into a <div>, or turn it into a ` + 'drag source or a drop target itself.');\n}\nfunction wrapHookToRecognizeElement(hook) {\n    return (elementOrNode = null, options = null)=>{\n        // When passed a node, call the hook straight away.\n        if (!isValidElement(elementOrNode)) {\n            const node = elementOrNode;\n            hook(node, options);\n            // return the node so it can be chained (e.g. when within callback refs\n            // <div ref={node => connectDragSource(connectDropTarget(node))}/>\n            return node;\n        }\n        // If passed a ReactElement, clone it and attach this function as a ref.\n        // This helps us achieve a neat API where user doesn't even know that refs\n        // are being used under the hood.\n        const element = elementOrNode;\n        throwIfCompositeComponentElement(element);\n        // When no options are passed, use the hook directly\n        const ref = options ? (node)=>hook(node, options)\n         : hook;\n        return cloneWithRef(element, ref);\n    };\n}\nexport function wrapConnectorHooks(hooks) {\n    const wrappedHooks = {};\n    Object.keys(hooks).forEach((key)=>{\n        const hook = hooks[key];\n        // ref objects should be passed straight through without wrapping\n        if (key.endsWith('Ref')) {\n            wrappedHooks[key] = hooks[key];\n        } else {\n            const wrappedHook = wrapHookToRecognizeElement(hook);\n            wrappedHooks[key] = ()=>wrappedHook\n            ;\n        }\n    });\n    return wrappedHooks;\n}\nfunction setRef(ref, node) {\n    if (typeof ref === 'function') {\n        ref(node);\n    } else {\n        ref.current = node;\n    }\n}\nfunction cloneWithRef(element, newRef) {\n    const previousRef = element.ref;\n    invariant(typeof previousRef !== 'string', 'Cannot connect React DnD to an element with an existing string ref. ' + 'Please convert it to use a callback ref instead, or wrap it into a <span> or <div>. ' + 'Read more: https://reactjs.org/docs/refs-and-the-dom.html#callback-refs');\n    if (!previousRef) {\n        // When there is no ref on the element, use the new ref directly\n        return cloneElement(element, {\n            ref: newRef\n        });\n    } else {\n        return cloneElement(element, {\n            ref: (node)=>{\n                setRef(previousRef, node);\n                setRef(newRef, node);\n            }\n        });\n    }\n}\n\n//# sourceMappingURL=wrapConnectorHooks.js.map","import { shallowEqual } from '@react-dnd/shallowequal';\nimport { isRef } from './isRef.js';\nimport { wrapConnectorHooks } from './wrapConnectorHooks.js';\nexport class SourceConnector {\n    receiveHandlerId(newHandlerId) {\n        if (this.handlerId === newHandlerId) {\n            return;\n        }\n        this.handlerId = newHandlerId;\n        this.reconnect();\n    }\n    get connectTarget() {\n        return this.dragSource;\n    }\n    get dragSourceOptions() {\n        return this.dragSourceOptionsInternal;\n    }\n    set dragSourceOptions(options) {\n        this.dragSourceOptionsInternal = options;\n    }\n    get dragPreviewOptions() {\n        return this.dragPreviewOptionsInternal;\n    }\n    set dragPreviewOptions(options) {\n        this.dragPreviewOptionsInternal = options;\n    }\n    reconnect() {\n        const didChange = this.reconnectDragSource();\n        this.reconnectDragPreview(didChange);\n    }\n    reconnectDragSource() {\n        const dragSource = this.dragSource;\n        // if nothing has changed then don't resubscribe\n        const didChange = this.didHandlerIdChange() || this.didConnectedDragSourceChange() || this.didDragSourceOptionsChange();\n        if (didChange) {\n            this.disconnectDragSource();\n        }\n        if (!this.handlerId) {\n            return didChange;\n        }\n        if (!dragSource) {\n            this.lastConnectedDragSource = dragSource;\n            return didChange;\n        }\n        if (didChange) {\n            this.lastConnectedHandlerId = this.handlerId;\n            this.lastConnectedDragSource = dragSource;\n            this.lastConnectedDragSourceOptions = this.dragSourceOptions;\n            this.dragSourceUnsubscribe = this.backend.connectDragSource(this.handlerId, dragSource, this.dragSourceOptions);\n        }\n        return didChange;\n    }\n    reconnectDragPreview(forceDidChange = false) {\n        const dragPreview = this.dragPreview;\n        // if nothing has changed then don't resubscribe\n        const didChange = forceDidChange || this.didHandlerIdChange() || this.didConnectedDragPreviewChange() || this.didDragPreviewOptionsChange();\n        if (didChange) {\n            this.disconnectDragPreview();\n        }\n        if (!this.handlerId) {\n            return;\n        }\n        if (!dragPreview) {\n            this.lastConnectedDragPreview = dragPreview;\n            return;\n        }\n        if (didChange) {\n            this.lastConnectedHandlerId = this.handlerId;\n            this.lastConnectedDragPreview = dragPreview;\n            this.lastConnectedDragPreviewOptions = this.dragPreviewOptions;\n            this.dragPreviewUnsubscribe = this.backend.connectDragPreview(this.handlerId, dragPreview, this.dragPreviewOptions);\n        }\n    }\n    didHandlerIdChange() {\n        return this.lastConnectedHandlerId !== this.handlerId;\n    }\n    didConnectedDragSourceChange() {\n        return this.lastConnectedDragSource !== this.dragSource;\n    }\n    didConnectedDragPreviewChange() {\n        return this.lastConnectedDragPreview !== this.dragPreview;\n    }\n    didDragSourceOptionsChange() {\n        return !shallowEqual(this.lastConnectedDragSourceOptions, this.dragSourceOptions);\n    }\n    didDragPreviewOptionsChange() {\n        return !shallowEqual(this.lastConnectedDragPreviewOptions, this.dragPreviewOptions);\n    }\n    disconnectDragSource() {\n        if (this.dragSourceUnsubscribe) {\n            this.dragSourceUnsubscribe();\n            this.dragSourceUnsubscribe = undefined;\n        }\n    }\n    disconnectDragPreview() {\n        if (this.dragPreviewUnsubscribe) {\n            this.dragPreviewUnsubscribe();\n            this.dragPreviewUnsubscribe = undefined;\n            this.dragPreviewNode = null;\n            this.dragPreviewRef = null;\n        }\n    }\n    get dragSource() {\n        return this.dragSourceNode || this.dragSourceRef && this.dragSourceRef.current;\n    }\n    get dragPreview() {\n        return this.dragPreviewNode || this.dragPreviewRef && this.dragPreviewRef.current;\n    }\n    clearDragSource() {\n        this.dragSourceNode = null;\n        this.dragSourceRef = null;\n    }\n    clearDragPreview() {\n        this.dragPreviewNode = null;\n        this.dragPreviewRef = null;\n    }\n    constructor(backend){\n        this.hooks = wrapConnectorHooks({\n            dragSource: (node, options)=>{\n                this.clearDragSource();\n                this.dragSourceOptions = options || null;\n                if (isRef(node)) {\n                    this.dragSourceRef = node;\n                } else {\n                    this.dragSourceNode = node;\n                }\n                this.reconnectDragSource();\n            },\n            dragPreview: (node, options)=>{\n                this.clearDragPreview();\n                this.dragPreviewOptions = options || null;\n                if (isRef(node)) {\n                    this.dragPreviewRef = node;\n                } else {\n                    this.dragPreviewNode = node;\n                }\n                this.reconnectDragPreview();\n            }\n        });\n        this.handlerId = null;\n        // The drop target may either be attached via ref or connect function\n        this.dragSourceRef = null;\n        this.dragSourceOptionsInternal = null;\n        // The drag preview may either be attached via ref or connect function\n        this.dragPreviewRef = null;\n        this.dragPreviewOptionsInternal = null;\n        this.lastConnectedHandlerId = null;\n        this.lastConnectedDragSource = null;\n        this.lastConnectedDragSourceOptions = null;\n        this.lastConnectedDragPreview = null;\n        this.lastConnectedDragPreviewOptions = null;\n        this.backend = backend;\n    }\n}\n\n//# sourceMappingURL=SourceConnector.js.map","import { shallowEqual } from '@react-dnd/shallowequal';\nimport { isRef } from './isRef.js';\nimport { wrapConnectorHooks } from './wrapConnectorHooks.js';\nexport class TargetConnector {\n    get connectTarget() {\n        return this.dropTarget;\n    }\n    reconnect() {\n        // if nothing has changed then don't resubscribe\n        const didChange = this.didHandlerIdChange() || this.didDropTargetChange() || this.didOptionsChange();\n        if (didChange) {\n            this.disconnectDropTarget();\n        }\n        const dropTarget = this.dropTarget;\n        if (!this.handlerId) {\n            return;\n        }\n        if (!dropTarget) {\n            this.lastConnectedDropTarget = dropTarget;\n            return;\n        }\n        if (didChange) {\n            this.lastConnectedHandlerId = this.handlerId;\n            this.lastConnectedDropTarget = dropTarget;\n            this.lastConnectedDropTargetOptions = this.dropTargetOptions;\n            this.unsubscribeDropTarget = this.backend.connectDropTarget(this.handlerId, dropTarget, this.dropTargetOptions);\n        }\n    }\n    receiveHandlerId(newHandlerId) {\n        if (newHandlerId === this.handlerId) {\n            return;\n        }\n        this.handlerId = newHandlerId;\n        this.reconnect();\n    }\n    get dropTargetOptions() {\n        return this.dropTargetOptionsInternal;\n    }\n    set dropTargetOptions(options) {\n        this.dropTargetOptionsInternal = options;\n    }\n    didHandlerIdChange() {\n        return this.lastConnectedHandlerId !== this.handlerId;\n    }\n    didDropTargetChange() {\n        return this.lastConnectedDropTarget !== this.dropTarget;\n    }\n    didOptionsChange() {\n        return !shallowEqual(this.lastConnectedDropTargetOptions, this.dropTargetOptions);\n    }\n    disconnectDropTarget() {\n        if (this.unsubscribeDropTarget) {\n            this.unsubscribeDropTarget();\n            this.unsubscribeDropTarget = undefined;\n        }\n    }\n    get dropTarget() {\n        return this.dropTargetNode || this.dropTargetRef && this.dropTargetRef.current;\n    }\n    clearDropTarget() {\n        this.dropTargetRef = null;\n        this.dropTargetNode = null;\n    }\n    constructor(backend){\n        this.hooks = wrapConnectorHooks({\n            dropTarget: (node, options)=>{\n                this.clearDropTarget();\n                this.dropTargetOptions = options;\n                if (isRef(node)) {\n                    this.dropTargetRef = node;\n                } else {\n                    this.dropTargetNode = node;\n                }\n                this.reconnect();\n            }\n        });\n        this.handlerId = null;\n        // The drop target may either be attached via ref or connect function\n        this.dropTargetRef = null;\n        this.dropTargetOptionsInternal = null;\n        this.lastConnectedHandlerId = null;\n        this.lastConnectedDropTarget = null;\n        this.lastConnectedDropTargetOptions = null;\n        this.backend = backend;\n    }\n}\n\n//# sourceMappingURL=TargetConnector.js.map","import { invariant } from '@react-dnd/invariant';\nimport { useContext } from 'react';\nimport { DndContext } from '../core/index.js';\n/**\n * A hook to retrieve the DragDropManager from Context\n */ export function useDragDropManager() {\n    const { dragDropManager  } = useContext(DndContext);\n    invariant(dragDropManager != null, 'Expected drag drop context');\n    return dragDropManager;\n}\n\n//# sourceMappingURL=useDragDropManager.js.map","export class DragSourceImpl {\n    beginDrag() {\n        const spec = this.spec;\n        const monitor = this.monitor;\n        let result = null;\n        if (typeof spec.item === 'object') {\n            result = spec.item;\n        } else if (typeof spec.item === 'function') {\n            result = spec.item(monitor);\n        } else {\n            result = {};\n        }\n        return result !== null && result !== void 0 ? result : null;\n    }\n    canDrag() {\n        const spec = this.spec;\n        const monitor = this.monitor;\n        if (typeof spec.canDrag === 'boolean') {\n            return spec.canDrag;\n        } else if (typeof spec.canDrag === 'function') {\n            return spec.canDrag(monitor);\n        } else {\n            return true;\n        }\n    }\n    isDragging(globalMonitor, target) {\n        const spec = this.spec;\n        const monitor = this.monitor;\n        const { isDragging  } = spec;\n        return isDragging ? isDragging(monitor) : target === globalMonitor.getSourceId();\n    }\n    endDrag() {\n        const spec = this.spec;\n        const monitor = this.monitor;\n        const connector = this.connector;\n        const { end  } = spec;\n        if (end) {\n            end(monitor.getItem(), monitor);\n        }\n        connector.reconnect();\n    }\n    constructor(spec, monitor, connector){\n        this.spec = spec;\n        this.monitor = monitor;\n        this.connector = connector;\n    }\n}\n\n//# sourceMappingURL=DragSourceImpl.js.map","import { registerSource } from '../../internals/index.js';\nimport { useDragDropManager } from '../useDragDropManager.js';\nimport { useIsomorphicLayoutEffect } from '../useIsomorphicLayoutEffect.js';\nimport { useDragSource } from './useDragSource.js';\nimport { useDragType } from './useDragType.js';\nexport function useRegisteredDragSource(spec, monitor, connector) {\n    const manager = useDragDropManager();\n    const handler = useDragSource(spec, monitor, connector);\n    const itemType = useDragType(spec);\n    useIsomorphicLayoutEffect(function registerDragSource() {\n        if (itemType != null) {\n            const [handlerId, unregister] = registerSource(itemType, handler, manager);\n            monitor.receiveHandlerId(handlerId);\n            connector.receiveHandlerId(handlerId);\n            return unregister;\n        }\n        return;\n    }, [\n        manager,\n        monitor,\n        connector,\n        handler,\n        itemType\n    ]);\n}\n\n//# sourceMappingURL=useRegisteredDragSource.js.map","import { useEffect, useMemo } from 'react';\nimport { DragSourceImpl } from './DragSourceImpl.js';\nexport function useDragSource(spec, monitor, connector) {\n    const handler = useMemo(()=>new DragSourceImpl(spec, monitor, connector)\n    , [\n        monitor,\n        connector\n    ]);\n    useEffect(()=>{\n        handler.spec = spec;\n    }, [\n        spec\n    ]);\n    return handler;\n}\n\n//# sourceMappingURL=useDragSource.js.map","import { invariant } from '@react-dnd/invariant';\nimport { useMemo } from 'react';\nexport function useDragType(spec) {\n    return useMemo(()=>{\n        const result = spec.type;\n        invariant(result != null, 'spec.type must be defined');\n        return result;\n    }, [\n        spec\n    ]);\n}\n\n//# sourceMappingURL=useDragType.js.map","export function registerTarget(type, target, manager) {\n    const registry = manager.getRegistry();\n    const targetId = registry.addTarget(type, target);\n    return [\n        targetId,\n        ()=>registry.removeTarget(targetId)\n    ];\n}\nexport function registerSource(type, source, manager) {\n    const registry = manager.getRegistry();\n    const sourceId = registry.addSource(type, source);\n    return [\n        sourceId,\n        ()=>registry.removeSource(sourceId)\n    ];\n}\n\n//# sourceMappingURL=registration.js.map","import { invariant } from '@react-dnd/invariant';\nimport { useCollectedProps } from '../useCollectedProps.js';\nimport { useOptionalFactory } from '../useOptionalFactory.js';\nimport { useConnectDragPreview, useConnectDragSource } from './connectors.js';\nimport { useDragSourceConnector } from './useDragSourceConnector.js';\nimport { useDragSourceMonitor } from './useDragSourceMonitor.js';\nimport { useRegisteredDragSource } from './useRegisteredDragSource.js';\n/**\n * useDragSource hook\n * @param sourceSpec The drag source specification (object or function, function preferred)\n * @param deps The memoization deps array to use when evaluating spec changes\n */ export function useDrag(specArg, deps) {\n    const spec = useOptionalFactory(specArg, deps);\n    invariant(!spec.begin, `useDrag::spec.begin was deprecated in v14. Replace spec.begin() with spec.item(). (see more here - https://react-dnd.github.io/react-dnd/docs/api/use-drag)`);\n    const monitor = useDragSourceMonitor();\n    const connector = useDragSourceConnector(spec.options, spec.previewOptions);\n    useRegisteredDragSource(spec, monitor, connector);\n    return [\n        useCollectedProps(spec.collect, monitor, connector),\n        useConnectDragSource(connector),\n        useConnectDragPreview(connector), \n    ];\n}\n\n//# sourceMappingURL=useDrag.js.map","import { useMemo } from 'react';\nimport { DragSourceMonitorImpl } from '../../internals/index.js';\nimport { useDragDropManager } from '../useDragDropManager.js';\nexport function useDragSourceMonitor() {\n    const manager = useDragDropManager();\n    return useMemo(()=>new DragSourceMonitorImpl(manager)\n    , [\n        manager\n    ]);\n}\n\n//# sourceMappingURL=useDragSourceMonitor.js.map","import { useMemo } from 'react';\nimport { SourceConnector } from '../../internals/index.js';\nimport { useDragDropManager } from '../useDragDropManager.js';\nimport { useIsomorphicLayoutEffect } from '../useIsomorphicLayoutEffect.js';\nexport function useDragSourceConnector(dragSourceOptions, dragPreviewOptions) {\n    const manager = useDragDropManager();\n    const connector = useMemo(()=>new SourceConnector(manager.getBackend())\n    , [\n        manager\n    ]);\n    useIsomorphicLayoutEffect(()=>{\n        connector.dragSourceOptions = dragSourceOptions || null;\n        connector.reconnect();\n        return ()=>connector.disconnectDragSource()\n        ;\n    }, [\n        connector,\n        dragSourceOptions\n    ]);\n    useIsomorphicLayoutEffect(()=>{\n        connector.dragPreviewOptions = dragPreviewOptions || null;\n        connector.reconnect();\n        return ()=>connector.disconnectDragPreview()\n        ;\n    }, [\n        connector,\n        dragPreviewOptions\n    ]);\n    return connector;\n}\n\n//# sourceMappingURL=useDragSourceConnector.js.map","import { useMemo } from 'react';\nexport function useConnectDropTarget(connector) {\n    return useMemo(()=>connector.hooks.dropTarget()\n    , [\n        connector\n    ]);\n}\n\n//# sourceMappingURL=connectors.js.map","export class DropTargetImpl {\n    canDrop() {\n        const spec = this.spec;\n        const monitor = this.monitor;\n        return spec.canDrop ? spec.canDrop(monitor.getItem(), monitor) : true;\n    }\n    hover() {\n        const spec = this.spec;\n        const monitor = this.monitor;\n        if (spec.hover) {\n            spec.hover(monitor.getItem(), monitor);\n        }\n    }\n    drop() {\n        const spec = this.spec;\n        const monitor = this.monitor;\n        if (spec.drop) {\n            return spec.drop(monitor.getItem(), monitor);\n        }\n        return;\n    }\n    constructor(spec, monitor){\n        this.spec = spec;\n        this.monitor = monitor;\n    }\n}\n\n//# sourceMappingURL=DropTargetImpl.js.map","import { registerTarget } from '../../internals/index.js';\nimport { useDragDropManager } from '../useDragDropManager.js';\nimport { useIsomorphicLayoutEffect } from '../useIsomorphicLayoutEffect.js';\nimport { useAccept } from './useAccept.js';\nimport { useDropTarget } from './useDropTarget.js';\nexport function useRegisteredDropTarget(spec, monitor, connector) {\n    const manager = useDragDropManager();\n    const dropTarget = useDropTarget(spec, monitor);\n    const accept = useAccept(spec);\n    useIsomorphicLayoutEffect(function registerDropTarget() {\n        const [handlerId, unregister] = registerTarget(accept, dropTarget, manager);\n        monitor.receiveHandlerId(handlerId);\n        connector.receiveHandlerId(handlerId);\n        return unregister;\n    }, [\n        manager,\n        monitor,\n        dropTarget,\n        connector,\n        accept.map((a)=>a.toString()\n        ).join('|'), \n    ]);\n}\n\n//# sourceMappingURL=useRegisteredDropTarget.js.map","import { useEffect, useMemo } from 'react';\nimport { DropTargetImpl } from './DropTargetImpl.js';\nexport function useDropTarget(spec, monitor) {\n    const dropTarget = useMemo(()=>new DropTargetImpl(spec, monitor)\n    , [\n        monitor\n    ]);\n    useEffect(()=>{\n        dropTarget.spec = spec;\n    }, [\n        spec\n    ]);\n    return dropTarget;\n}\n\n//# sourceMappingURL=useDropTarget.js.map","import { invariant } from '@react-dnd/invariant';\nimport { useMemo } from 'react';\n/**\n * Internal utility hook to get an array-version of spec.accept.\n * The main utility here is that we aren't creating a new array on every render if a non-array spec.accept is passed in.\n * @param spec\n */ export function useAccept(spec) {\n    const { accept  } = spec;\n    return useMemo(()=>{\n        invariant(spec.accept != null, 'accept must be defined');\n        return Array.isArray(accept) ? accept : [\n            accept\n        ];\n    }, [\n        accept\n    ]);\n}\n\n//# sourceMappingURL=useAccept.js.map","import { useCollectedProps } from '../useCollectedProps.js';\nimport { useOptionalFactory } from '../useOptionalFactory.js';\nimport { useConnectDropTarget } from './connectors.js';\nimport { useDropTargetConnector } from './useDropTargetConnector.js';\nimport { useDropTargetMonitor } from './useDropTargetMonitor.js';\nimport { useRegisteredDropTarget } from './useRegisteredDropTarget.js';\n/**\n * useDropTarget Hook\n * @param spec The drop target specification (object or function, function preferred)\n * @param deps The memoization deps array to use when evaluating spec changes\n */ export function useDrop(specArg, deps) {\n    const spec = useOptionalFactory(specArg, deps);\n    const monitor = useDropTargetMonitor();\n    const connector = useDropTargetConnector(spec.options);\n    useRegisteredDropTarget(spec, monitor, connector);\n    return [\n        useCollectedProps(spec.collect, monitor, connector),\n        useConnectDropTarget(connector), \n    ];\n}\n\n//# sourceMappingURL=useDrop.js.map","import { useMemo } from 'react';\nimport { DropTargetMonitorImpl } from '../../internals/index.js';\nimport { useDragDropManager } from '../useDragDropManager.js';\nexport function useDropTargetMonitor() {\n    const manager = useDragDropManager();\n    return useMemo(()=>new DropTargetMonitorImpl(manager)\n    , [\n        manager\n    ]);\n}\n\n//# sourceMappingURL=useDropTargetMonitor.js.map","import { useMemo } from 'react';\nimport { TargetConnector } from '../../internals/index.js';\nimport { useDragDropManager } from '../useDragDropManager.js';\nimport { useIsomorphicLayoutEffect } from '../useIsomorphicLayoutEffect.js';\nexport function useDropTargetConnector(options) {\n    const manager = useDragDropManager();\n    const connector = useMemo(()=>new TargetConnector(manager.getBackend())\n    , [\n        manager\n    ]);\n    useIsomorphicLayoutEffect(()=>{\n        connector.dropTargetOptions = options || null;\n        connector.reconnect();\n        return ()=>connector.disconnectDropTarget()\n        ;\n    }, [\n        options\n    ]);\n    return connector;\n}\n\n//# sourceMappingURL=useDropTargetConnector.js.map","// cheap lodash replacements\nexport function memoize(fn) {\n    let result = null;\n    const memoized = ()=>{\n        if (result == null) {\n            result = fn();\n        }\n        return result;\n    };\n    return memoized;\n}\n/**\n * drop-in replacement for _.without\n */ export function without(items, item) {\n    return items.filter((i)=>i !== item\n    );\n}\nexport function union(itemsA, itemsB) {\n    const set = new Set();\n    const insertItem = (item)=>set.add(item)\n    ;\n    itemsA.forEach(insertItem);\n    itemsB.forEach(insertItem);\n    const result = [];\n    set.forEach((key)=>result.push(key)\n    );\n    return result;\n}\n\n//# sourceMappingURL=js_utils.js.map","import { union, without } from './utils/js_utils.js';\nexport class EnterLeaveCounter {\n    enter(enteringNode) {\n        const previousLength = this.entered.length;\n        const isNodeEntered = (node)=>this.isNodeInDocument(node) && (!node.contains || node.contains(enteringNode))\n        ;\n        this.entered = union(this.entered.filter(isNodeEntered), [\n            enteringNode\n        ]);\n        return previousLength === 0 && this.entered.length > 0;\n    }\n    leave(leavingNode) {\n        const previousLength = this.entered.length;\n        this.entered = without(this.entered.filter(this.isNodeInDocument), leavingNode);\n        return previousLength > 0 && this.entered.length === 0;\n    }\n    reset() {\n        this.entered = [];\n    }\n    constructor(isNodeInDocument){\n        this.entered = [];\n        this.isNodeInDocument = isNodeInDocument;\n    }\n}\n\n//# sourceMappingURL=EnterLeaveCounter.js.map","export class NativeDragSource {\n    initializeExposedProperties() {\n        Object.keys(this.config.exposeProperties).forEach((property)=>{\n            Object.defineProperty(this.item, property, {\n                configurable: true,\n                enumerable: true,\n                get () {\n                    // eslint-disable-next-line no-console\n                    console.warn(`Browser doesn't allow reading \"${property}\" until the drop event.`);\n                    return null;\n                }\n            });\n        });\n    }\n    loadDataTransfer(dataTransfer) {\n        if (dataTransfer) {\n            const newProperties = {};\n            Object.keys(this.config.exposeProperties).forEach((property)=>{\n                const propertyFn = this.config.exposeProperties[property];\n                if (propertyFn != null) {\n                    newProperties[property] = {\n                        value: propertyFn(dataTransfer, this.config.matchesTypes),\n                        configurable: true,\n                        enumerable: true\n                    };\n                }\n            });\n            Object.defineProperties(this.item, newProperties);\n        }\n    }\n    canDrag() {\n        return true;\n    }\n    beginDrag() {\n        return this.item;\n    }\n    isDragging(monitor, handle) {\n        return handle === monitor.getSourceId();\n    }\n    endDrag() {\n    // empty\n    }\n    constructor(config){\n        this.config = config;\n        this.item = {};\n        this.initializeExposedProperties();\n    }\n}\n\n//# sourceMappingURL=NativeDragSource.js.map","export const FILE = '__NATIVE_FILE__';\nexport const URL = '__NATIVE_URL__';\nexport const TEXT = '__NATIVE_TEXT__';\nexport const HTML = '__NATIVE_HTML__';\n\n//# sourceMappingURL=NativeTypes.js.map","export function getDataFromDataTransfer(dataTransfer, typesToTry, defaultValue) {\n    const result = typesToTry.reduce((resultSoFar, typeToTry)=>resultSoFar || dataTransfer.getData(typeToTry)\n    , '');\n    return result != null ? result : defaultValue;\n}\n\n//# sourceMappingURL=getDataFromDataTransfer.js.map","import * as NativeTypes from '../NativeTypes.js';\nimport { getDataFromDataTransfer } from './getDataFromDataTransfer.js';\nexport const nativeTypesConfig = {\n    [NativeTypes.FILE]: {\n        exposeProperties: {\n            files: (dataTransfer)=>Array.prototype.slice.call(dataTransfer.files)\n            ,\n            items: (dataTransfer)=>dataTransfer.items\n            ,\n            dataTransfer: (dataTransfer)=>dataTransfer\n        },\n        matchesTypes: [\n            'Files'\n        ]\n    },\n    [NativeTypes.HTML]: {\n        exposeProperties: {\n            html: (dataTransfer, matchesTypes)=>getDataFromDataTransfer(dataTransfer, matchesTypes, '')\n            ,\n            dataTransfer: (dataTransfer)=>dataTransfer\n        },\n        matchesTypes: [\n            'Html',\n            'text/html'\n        ]\n    },\n    [NativeTypes.URL]: {\n        exposeProperties: {\n            urls: (dataTransfer, matchesTypes)=>getDataFromDataTransfer(dataTransfer, matchesTypes, '').split('\\n')\n            ,\n            dataTransfer: (dataTransfer)=>dataTransfer\n        },\n        matchesTypes: [\n            'Url',\n            'text/uri-list'\n        ]\n    },\n    [NativeTypes.TEXT]: {\n        exposeProperties: {\n            text: (dataTransfer, matchesTypes)=>getDataFromDataTransfer(dataTransfer, matchesTypes, '')\n            ,\n            dataTransfer: (dataTransfer)=>dataTransfer\n        },\n        matchesTypes: [\n            'Text',\n            'text/plain'\n        ]\n    }\n};\n\n//# sourceMappingURL=nativeTypesConfig.js.map","import { NativeDragSource } from './NativeDragSource.js';\nimport { nativeTypesConfig } from './nativeTypesConfig.js';\nexport function createNativeDragSource(type, dataTransfer) {\n    const config = nativeTypesConfig[type];\n    if (!config) {\n        throw new Error(`native type ${type} has no configuration`);\n    }\n    const result = new NativeDragSource(config);\n    result.loadDataTransfer(dataTransfer);\n    return result;\n}\nexport function matchNativeItemType(dataTransfer) {\n    if (!dataTransfer) {\n        return null;\n    }\n    const dataTransferTypes = Array.prototype.slice.call(dataTransfer.types || []);\n    return Object.keys(nativeTypesConfig).filter((nativeItemType)=>{\n        const typeConfig = nativeTypesConfig[nativeItemType];\n        if (!(typeConfig === null || typeConfig === void 0 ? void 0 : typeConfig.matchesTypes)) {\n            return false;\n        }\n        return typeConfig.matchesTypes.some((t)=>dataTransferTypes.indexOf(t) > -1\n        );\n    })[0] || null;\n}\n\n//# sourceMappingURL=index.js.map","import { memoize } from './utils/js_utils.js';\nexport const isFirefox = memoize(()=>/firefox/i.test(navigator.userAgent)\n);\nexport const isSafari = memoize(()=>Boolean(window.safari)\n);\n\n//# sourceMappingURL=BrowserDetector.js.map","export class MonotonicInterpolant {\n    interpolate(x) {\n        const { xs , ys , c1s , c2s , c3s  } = this;\n        // The rightmost point in the dataset should give an exact result\n        let i = xs.length - 1;\n        if (x === xs[i]) {\n            return ys[i];\n        }\n        // Search for the interval x is in, returning the corresponding y if x is one of the original xs\n        let low = 0;\n        let high = c3s.length - 1;\n        let mid;\n        while(low <= high){\n            mid = Math.floor(0.5 * (low + high));\n            const xHere = xs[mid];\n            if (xHere < x) {\n                low = mid + 1;\n            } else if (xHere > x) {\n                high = mid - 1;\n            } else {\n                return ys[mid];\n            }\n        }\n        i = Math.max(0, high);\n        // Interpolate\n        const diff = x - xs[i];\n        const diffSq = diff * diff;\n        return ys[i] + c1s[i] * diff + c2s[i] * diffSq + c3s[i] * diff * diffSq;\n    }\n    constructor(xs, ys){\n        const { length  } = xs;\n        // Rearrange xs and ys so that xs is sorted\n        const indexes = [];\n        for(let i = 0; i < length; i++){\n            indexes.push(i);\n        }\n        indexes.sort((a, b)=>xs[a] < xs[b] ? -1 : 1\n        );\n        // Get consecutive differences and slopes\n        const dys = [];\n        const dxs = [];\n        const ms = [];\n        let dx;\n        let dy;\n        for(let i1 = 0; i1 < length - 1; i1++){\n            dx = xs[i1 + 1] - xs[i1];\n            dy = ys[i1 + 1] - ys[i1];\n            dxs.push(dx);\n            dys.push(dy);\n            ms.push(dy / dx);\n        }\n        // Get degree-1 coefficients\n        const c1s = [\n            ms[0]\n        ];\n        for(let i2 = 0; i2 < dxs.length - 1; i2++){\n            const m2 = ms[i2];\n            const mNext = ms[i2 + 1];\n            if (m2 * mNext <= 0) {\n                c1s.push(0);\n            } else {\n                dx = dxs[i2];\n                const dxNext = dxs[i2 + 1];\n                const common = dx + dxNext;\n                c1s.push(3 * common / ((common + dxNext) / m2 + (common + dx) / mNext));\n            }\n        }\n        c1s.push(ms[ms.length - 1]);\n        // Get degree-2 and degree-3 coefficients\n        const c2s = [];\n        const c3s = [];\n        let m;\n        for(let i3 = 0; i3 < c1s.length - 1; i3++){\n            m = ms[i3];\n            const c1 = c1s[i3];\n            const invDx = 1 / dxs[i3];\n            const common = c1 + c1s[i3 + 1] - m - m;\n            c2s.push((m - c1 - common) * invDx);\n            c3s.push(common * invDx * invDx);\n        }\n        this.xs = xs;\n        this.ys = ys;\n        this.c1s = c1s;\n        this.c2s = c2s;\n        this.c3s = c3s;\n    }\n}\n\n//# sourceMappingURL=MonotonicInterpolant.js.map","import { isFirefox, isSafari } from './BrowserDetector.js';\nimport { MonotonicInterpolant } from './MonotonicInterpolant.js';\nconst ELEMENT_NODE = 1;\nexport function getNodeClientOffset(node) {\n    const el = node.nodeType === ELEMENT_NODE ? node : node.parentElement;\n    if (!el) {\n        return null;\n    }\n    const { top , left  } = el.getBoundingClientRect();\n    return {\n        x: left,\n        y: top\n    };\n}\nexport function getEventClientOffset(e) {\n    return {\n        x: e.clientX,\n        y: e.clientY\n    };\n}\nfunction isImageNode(node) {\n    var ref;\n    return node.nodeName === 'IMG' && (isFirefox() || !((ref = document.documentElement) === null || ref === void 0 ? void 0 : ref.contains(node)));\n}\nfunction getDragPreviewSize(isImage, dragPreview, sourceWidth, sourceHeight) {\n    let dragPreviewWidth = isImage ? dragPreview.width : sourceWidth;\n    let dragPreviewHeight = isImage ? dragPreview.height : sourceHeight;\n    // Work around @2x coordinate discrepancies in browsers\n    if (isSafari() && isImage) {\n        dragPreviewHeight /= window.devicePixelRatio;\n        dragPreviewWidth /= window.devicePixelRatio;\n    }\n    return {\n        dragPreviewWidth,\n        dragPreviewHeight\n    };\n}\nexport function getDragPreviewOffset(sourceNode, dragPreview, clientOffset, anchorPoint, offsetPoint) {\n    // The browsers will use the image intrinsic size under different conditions.\n    // Firefox only cares if it's an image, but WebKit also wants it to be detached.\n    const isImage = isImageNode(dragPreview);\n    const dragPreviewNode = isImage ? sourceNode : dragPreview;\n    const dragPreviewNodeOffsetFromClient = getNodeClientOffset(dragPreviewNode);\n    const offsetFromDragPreview = {\n        x: clientOffset.x - dragPreviewNodeOffsetFromClient.x,\n        y: clientOffset.y - dragPreviewNodeOffsetFromClient.y\n    };\n    const { offsetWidth: sourceWidth , offsetHeight: sourceHeight  } = sourceNode;\n    const { anchorX , anchorY  } = anchorPoint;\n    const { dragPreviewWidth , dragPreviewHeight  } = getDragPreviewSize(isImage, dragPreview, sourceWidth, sourceHeight);\n    const calculateYOffset = ()=>{\n        const interpolantY = new MonotonicInterpolant([\n            0,\n            0.5,\n            1\n        ], [\n            // Dock to the top\n            offsetFromDragPreview.y,\n            // Align at the center\n            (offsetFromDragPreview.y / sourceHeight) * dragPreviewHeight,\n            // Dock to the bottom\n            offsetFromDragPreview.y + dragPreviewHeight - sourceHeight, \n        ]);\n        let y = interpolantY.interpolate(anchorY);\n        // Work around Safari 8 positioning bug\n        if (isSafari() && isImage) {\n            // We'll have to wait for @3x to see if this is entirely correct\n            y += (window.devicePixelRatio - 1) * dragPreviewHeight;\n        }\n        return y;\n    };\n    const calculateXOffset = ()=>{\n        // Interpolate coordinates depending on anchor point\n        // If you know a simpler way to do this, let me know\n        const interpolantX = new MonotonicInterpolant([\n            0,\n            0.5,\n            1\n        ], [\n            // Dock to the left\n            offsetFromDragPreview.x,\n            // Align at the center\n            (offsetFromDragPreview.x / sourceWidth) * dragPreviewWidth,\n            // Dock to the right\n            offsetFromDragPreview.x + dragPreviewWidth - sourceWidth, \n        ]);\n        return interpolantX.interpolate(anchorX);\n    };\n    // Force offsets if specified in the options.\n    const { offsetX , offsetY  } = offsetPoint;\n    const isManualOffsetX = offsetX === 0 || offsetX;\n    const isManualOffsetY = offsetY === 0 || offsetY;\n    return {\n        x: isManualOffsetX ? offsetX : calculateXOffset(),\n        y: isManualOffsetY ? offsetY : calculateYOffset()\n    };\n}\n\n//# sourceMappingURL=OffsetUtils.js.map","export class OptionsReader {\n    get window() {\n        if (this.globalContext) {\n            return this.globalContext;\n        } else if (typeof window !== 'undefined') {\n            return window;\n        }\n        return undefined;\n    }\n    get document() {\n        var ref;\n        if ((ref = this.globalContext) === null || ref === void 0 ? void 0 : ref.document) {\n            return this.globalContext.document;\n        } else if (this.window) {\n            return this.window.document;\n        } else {\n            return undefined;\n        }\n    }\n    get rootElement() {\n        var ref;\n        return ((ref = this.optionsArgs) === null || ref === void 0 ? void 0 : ref.rootElement) || this.window;\n    }\n    constructor(globalContext, options){\n        this.ownerDocument = null;\n        this.globalContext = globalContext;\n        this.optionsArgs = options;\n    }\n}\n\n//# sourceMappingURL=OptionsReader.js.map","function _defineProperty(obj, key, value) {\n    if (key in obj) {\n        Object.defineProperty(obj, key, {\n            value: value,\n            enumerable: true,\n            configurable: true,\n            writable: true\n        });\n    } else {\n        obj[key] = value;\n    }\n    return obj;\n}\nfunction _objectSpread(target) {\n    for(var i = 1; i < arguments.length; i++){\n        var source = arguments[i] != null ? arguments[i] : {};\n        var ownKeys = Object.keys(source);\n        if (typeof Object.getOwnPropertySymbols === 'function') {\n            ownKeys = ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function(sym) {\n                return Object.getOwnPropertyDescriptor(source, sym).enumerable;\n            }));\n        }\n        ownKeys.forEach(function(key) {\n            _defineProperty(target, key, source[key]);\n        });\n    }\n    return target;\n}\nimport { EnterLeaveCounter } from './EnterLeaveCounter.js';\nimport { createNativeDragSource, matchNativeItemType } from './NativeDragSources/index.js';\nimport * as NativeTypes from './NativeTypes.js';\nimport { getDragPreviewOffset, getEventClientOffset, getNodeClientOffset } from './OffsetUtils.js';\nimport { OptionsReader } from './OptionsReader.js';\nexport class HTML5BackendImpl {\n    /**\n\t * Generate profiling statistics for the HTML5Backend.\n\t */ profile() {\n        var ref, ref1;\n        return {\n            sourcePreviewNodes: this.sourcePreviewNodes.size,\n            sourcePreviewNodeOptions: this.sourcePreviewNodeOptions.size,\n            sourceNodeOptions: this.sourceNodeOptions.size,\n            sourceNodes: this.sourceNodes.size,\n            dragStartSourceIds: ((ref = this.dragStartSourceIds) === null || ref === void 0 ? void 0 : ref.length) || 0,\n            dropTargetIds: this.dropTargetIds.length,\n            dragEnterTargetIds: this.dragEnterTargetIds.length,\n            dragOverTargetIds: ((ref1 = this.dragOverTargetIds) === null || ref1 === void 0 ? void 0 : ref1.length) || 0\n        };\n    }\n    // public for test\n    get window() {\n        return this.options.window;\n    }\n    get document() {\n        return this.options.document;\n    }\n    /**\n\t * Get the root element to use for event subscriptions\n\t */ get rootElement() {\n        return this.options.rootElement;\n    }\n    setup() {\n        const root = this.rootElement;\n        if (root === undefined) {\n            return;\n        }\n        if (root.__isReactDndBackendSetUp) {\n            throw new Error('Cannot have two HTML5 backends at the same time.');\n        }\n        root.__isReactDndBackendSetUp = true;\n        this.addEventListeners(root);\n    }\n    teardown() {\n        const root = this.rootElement;\n        if (root === undefined) {\n            return;\n        }\n        root.__isReactDndBackendSetUp = false;\n        this.removeEventListeners(this.rootElement);\n        this.clearCurrentDragSourceNode();\n        if (this.asyncEndDragFrameId) {\n            var ref;\n            (ref = this.window) === null || ref === void 0 ? void 0 : ref.cancelAnimationFrame(this.asyncEndDragFrameId);\n        }\n    }\n    connectDragPreview(sourceId, node, options) {\n        this.sourcePreviewNodeOptions.set(sourceId, options);\n        this.sourcePreviewNodes.set(sourceId, node);\n        return ()=>{\n            this.sourcePreviewNodes.delete(sourceId);\n            this.sourcePreviewNodeOptions.delete(sourceId);\n        };\n    }\n    connectDragSource(sourceId, node, options) {\n        this.sourceNodes.set(sourceId, node);\n        this.sourceNodeOptions.set(sourceId, options);\n        const handleDragStart = (e)=>this.handleDragStart(e, sourceId)\n        ;\n        const handleSelectStart = (e)=>this.handleSelectStart(e)\n        ;\n        node.setAttribute('draggable', 'true');\n        node.addEventListener('dragstart', handleDragStart);\n        node.addEventListener('selectstart', handleSelectStart);\n        return ()=>{\n            this.sourceNodes.delete(sourceId);\n            this.sourceNodeOptions.delete(sourceId);\n            node.removeEventListener('dragstart', handleDragStart);\n            node.removeEventListener('selectstart', handleSelectStart);\n            node.setAttribute('draggable', 'false');\n        };\n    }\n    connectDropTarget(targetId, node) {\n        const handleDragEnter = (e)=>this.handleDragEnter(e, targetId)\n        ;\n        const handleDragOver = (e)=>this.handleDragOver(e, targetId)\n        ;\n        const handleDrop = (e)=>this.handleDrop(e, targetId)\n        ;\n        node.addEventListener('dragenter', handleDragEnter);\n        node.addEventListener('dragover', handleDragOver);\n        node.addEventListener('drop', handleDrop);\n        return ()=>{\n            node.removeEventListener('dragenter', handleDragEnter);\n            node.removeEventListener('dragover', handleDragOver);\n            node.removeEventListener('drop', handleDrop);\n        };\n    }\n    addEventListeners(target) {\n        // SSR Fix (https://github.com/react-dnd/react-dnd/pull/813\n        if (!target.addEventListener) {\n            return;\n        }\n        target.addEventListener('dragstart', this.handleTopDragStart);\n        target.addEventListener('dragstart', this.handleTopDragStartCapture, true);\n        target.addEventListener('dragend', this.handleTopDragEndCapture, true);\n        target.addEventListener('dragenter', this.handleTopDragEnter);\n        target.addEventListener('dragenter', this.handleTopDragEnterCapture, true);\n        target.addEventListener('dragleave', this.handleTopDragLeaveCapture, true);\n        target.addEventListener('dragover', this.handleTopDragOver);\n        target.addEventListener('dragover', this.handleTopDragOverCapture, true);\n        target.addEventListener('drop', this.handleTopDrop);\n        target.addEventListener('drop', this.handleTopDropCapture, true);\n    }\n    removeEventListeners(target) {\n        // SSR Fix (https://github.com/react-dnd/react-dnd/pull/813\n        if (!target.removeEventListener) {\n            return;\n        }\n        target.removeEventListener('dragstart', this.handleTopDragStart);\n        target.removeEventListener('dragstart', this.handleTopDragStartCapture, true);\n        target.removeEventListener('dragend', this.handleTopDragEndCapture, true);\n        target.removeEventListener('dragenter', this.handleTopDragEnter);\n        target.removeEventListener('dragenter', this.handleTopDragEnterCapture, true);\n        target.removeEventListener('dragleave', this.handleTopDragLeaveCapture, true);\n        target.removeEventListener('dragover', this.handleTopDragOver);\n        target.removeEventListener('dragover', this.handleTopDragOverCapture, true);\n        target.removeEventListener('drop', this.handleTopDrop);\n        target.removeEventListener('drop', this.handleTopDropCapture, true);\n    }\n    getCurrentSourceNodeOptions() {\n        const sourceId = this.monitor.getSourceId();\n        const sourceNodeOptions = this.sourceNodeOptions.get(sourceId);\n        return _objectSpread({\n            dropEffect: this.altKeyPressed ? 'copy' : 'move'\n        }, sourceNodeOptions || {});\n    }\n    getCurrentDropEffect() {\n        if (this.isDraggingNativeItem()) {\n            // It makes more sense to default to 'copy' for native resources\n            return 'copy';\n        }\n        return this.getCurrentSourceNodeOptions().dropEffect;\n    }\n    getCurrentSourcePreviewNodeOptions() {\n        const sourceId = this.monitor.getSourceId();\n        const sourcePreviewNodeOptions = this.sourcePreviewNodeOptions.get(sourceId);\n        return _objectSpread({\n            anchorX: 0.5,\n            anchorY: 0.5,\n            captureDraggingState: false\n        }, sourcePreviewNodeOptions || {});\n    }\n    isDraggingNativeItem() {\n        const itemType = this.monitor.getItemType();\n        return Object.keys(NativeTypes).some((key)=>NativeTypes[key] === itemType\n        );\n    }\n    beginDragNativeItem(type, dataTransfer) {\n        this.clearCurrentDragSourceNode();\n        this.currentNativeSource = createNativeDragSource(type, dataTransfer);\n        this.currentNativeHandle = this.registry.addSource(type, this.currentNativeSource);\n        this.actions.beginDrag([\n            this.currentNativeHandle\n        ]);\n    }\n    setCurrentDragSourceNode(node) {\n        this.clearCurrentDragSourceNode();\n        this.currentDragSourceNode = node;\n        // A timeout of > 0 is necessary to resolve Firefox issue referenced\n        // See:\n        //   * https://github.com/react-dnd/react-dnd/pull/928\n        //   * https://github.com/react-dnd/react-dnd/issues/869\n        const MOUSE_MOVE_TIMEOUT = 1000;\n        // Receiving a mouse event in the middle of a dragging operation\n        // means it has ended and the drag source node disappeared from DOM,\n        // so the browser didn't dispatch the dragend event.\n        //\n        // We need to wait before we start listening for mousemove events.\n        // This is needed because the drag preview needs to be drawn or else it fires an 'mousemove' event\n        // immediately in some browsers.\n        //\n        // See:\n        //   * https://github.com/react-dnd/react-dnd/pull/928\n        //   * https://github.com/react-dnd/react-dnd/issues/869\n        //\n        this.mouseMoveTimeoutTimer = setTimeout(()=>{\n            var ref;\n            return (ref = this.rootElement) === null || ref === void 0 ? void 0 : ref.addEventListener('mousemove', this.endDragIfSourceWasRemovedFromDOM, true);\n        }, MOUSE_MOVE_TIMEOUT);\n    }\n    clearCurrentDragSourceNode() {\n        if (this.currentDragSourceNode) {\n            this.currentDragSourceNode = null;\n            if (this.rootElement) {\n                var ref;\n                (ref = this.window) === null || ref === void 0 ? void 0 : ref.clearTimeout(this.mouseMoveTimeoutTimer || undefined);\n                this.rootElement.removeEventListener('mousemove', this.endDragIfSourceWasRemovedFromDOM, true);\n            }\n            this.mouseMoveTimeoutTimer = null;\n            return true;\n        }\n        return false;\n    }\n    handleDragStart(e, sourceId) {\n        if (e.defaultPrevented) {\n            return;\n        }\n        if (!this.dragStartSourceIds) {\n            this.dragStartSourceIds = [];\n        }\n        this.dragStartSourceIds.unshift(sourceId);\n    }\n    handleDragEnter(_e, targetId) {\n        this.dragEnterTargetIds.unshift(targetId);\n    }\n    handleDragOver(_e, targetId) {\n        if (this.dragOverTargetIds === null) {\n            this.dragOverTargetIds = [];\n        }\n        this.dragOverTargetIds.unshift(targetId);\n    }\n    handleDrop(_e, targetId) {\n        this.dropTargetIds.unshift(targetId);\n    }\n    constructor(manager, globalContext, options){\n        this.sourcePreviewNodes = new Map();\n        this.sourcePreviewNodeOptions = new Map();\n        this.sourceNodes = new Map();\n        this.sourceNodeOptions = new Map();\n        this.dragStartSourceIds = null;\n        this.dropTargetIds = [];\n        this.dragEnterTargetIds = [];\n        this.currentNativeSource = null;\n        this.currentNativeHandle = null;\n        this.currentDragSourceNode = null;\n        this.altKeyPressed = false;\n        this.mouseMoveTimeoutTimer = null;\n        this.asyncEndDragFrameId = null;\n        this.dragOverTargetIds = null;\n        this.lastClientOffset = null;\n        this.hoverRafId = null;\n        this.getSourceClientOffset = (sourceId)=>{\n            const source = this.sourceNodes.get(sourceId);\n            return source && getNodeClientOffset(source) || null;\n        };\n        this.endDragNativeItem = ()=>{\n            if (!this.isDraggingNativeItem()) {\n                return;\n            }\n            this.actions.endDrag();\n            if (this.currentNativeHandle) {\n                this.registry.removeSource(this.currentNativeHandle);\n            }\n            this.currentNativeHandle = null;\n            this.currentNativeSource = null;\n        };\n        this.isNodeInDocument = (node)=>{\n            // Check the node either in the main document or in the current context\n            return Boolean(node && this.document && this.document.body && this.document.body.contains(node));\n        };\n        this.endDragIfSourceWasRemovedFromDOM = ()=>{\n            const node = this.currentDragSourceNode;\n            if (node == null || this.isNodeInDocument(node)) {\n                return;\n            }\n            if (this.clearCurrentDragSourceNode() && this.monitor.isDragging()) {\n                this.actions.endDrag();\n            }\n            this.cancelHover();\n        };\n        this.scheduleHover = (dragOverTargetIds)=>{\n            if (this.hoverRafId === null && typeof requestAnimationFrame !== 'undefined') {\n                this.hoverRafId = requestAnimationFrame(()=>{\n                    if (this.monitor.isDragging()) {\n                        this.actions.hover(dragOverTargetIds || [], {\n                            clientOffset: this.lastClientOffset\n                        });\n                    }\n                    this.hoverRafId = null;\n                });\n            }\n        };\n        this.cancelHover = ()=>{\n            if (this.hoverRafId !== null && typeof cancelAnimationFrame !== 'undefined') {\n                cancelAnimationFrame(this.hoverRafId);\n                this.hoverRafId = null;\n            }\n        };\n        this.handleTopDragStartCapture = ()=>{\n            this.clearCurrentDragSourceNode();\n            this.dragStartSourceIds = [];\n        };\n        this.handleTopDragStart = (e)=>{\n            if (e.defaultPrevented) {\n                return;\n            }\n            const { dragStartSourceIds  } = this;\n            this.dragStartSourceIds = null;\n            const clientOffset = getEventClientOffset(e);\n            // Avoid crashing if we missed a drop event or our previous drag died\n            if (this.monitor.isDragging()) {\n                this.actions.endDrag();\n                this.cancelHover();\n            }\n            // Don't publish the source just yet (see why below)\n            this.actions.beginDrag(dragStartSourceIds || [], {\n                publishSource: false,\n                getSourceClientOffset: this.getSourceClientOffset,\n                clientOffset\n            });\n            const { dataTransfer  } = e;\n            const nativeType = matchNativeItemType(dataTransfer);\n            if (this.monitor.isDragging()) {\n                if (dataTransfer && typeof dataTransfer.setDragImage === 'function') {\n                    // Use custom drag image if user specifies it.\n                    // If child drag source refuses drag but parent agrees,\n                    // use parent's node as drag image. Neither works in IE though.\n                    const sourceId = this.monitor.getSourceId();\n                    const sourceNode = this.sourceNodes.get(sourceId);\n                    const dragPreview = this.sourcePreviewNodes.get(sourceId) || sourceNode;\n                    if (dragPreview) {\n                        const { anchorX , anchorY , offsetX , offsetY  } = this.getCurrentSourcePreviewNodeOptions();\n                        const anchorPoint = {\n                            anchorX,\n                            anchorY\n                        };\n                        const offsetPoint = {\n                            offsetX,\n                            offsetY\n                        };\n                        const dragPreviewOffset = getDragPreviewOffset(sourceNode, dragPreview, clientOffset, anchorPoint, offsetPoint);\n                        dataTransfer.setDragImage(dragPreview, dragPreviewOffset.x, dragPreviewOffset.y);\n                    }\n                }\n                try {\n                    // Firefox won't drag without setting data\n                    dataTransfer === null || dataTransfer === void 0 ? void 0 : dataTransfer.setData('application/json', {});\n                } catch (err) {\n                // IE doesn't support MIME types in setData\n                }\n                // Store drag source node so we can check whether\n                // it is removed from DOM and trigger endDrag manually.\n                this.setCurrentDragSourceNode(e.target);\n                // Now we are ready to publish the drag source.. or are we not?\n                const { captureDraggingState  } = this.getCurrentSourcePreviewNodeOptions();\n                if (!captureDraggingState) {\n                    // Usually we want to publish it in the next tick so that browser\n                    // is able to screenshot the current (not yet dragging) state.\n                    //\n                    // It also neatly avoids a situation where render() returns null\n                    // in the same tick for the source element, and browser freaks out.\n                    setTimeout(()=>this.actions.publishDragSource()\n                    , 0);\n                } else {\n                    // In some cases the user may want to override this behavior, e.g.\n                    // to work around IE not supporting custom drag previews.\n                    //\n                    // When using a custom drag layer, the only way to prevent\n                    // the default drag preview from drawing in IE is to screenshot\n                    // the dragging state in which the node itself has zero opacity\n                    // and height. In this case, though, returning null from render()\n                    // will abruptly end the dragging, which is not obvious.\n                    //\n                    // This is the reason such behavior is strictly opt-in.\n                    this.actions.publishDragSource();\n                }\n            } else if (nativeType) {\n                // A native item (such as URL) dragged from inside the document\n                this.beginDragNativeItem(nativeType);\n            } else if (dataTransfer && !dataTransfer.types && (e.target && !e.target.hasAttribute || !e.target.hasAttribute('draggable'))) {\n                // Looks like a Safari bug: dataTransfer.types is null, but there was no draggable.\n                // Just let it drag. It's a native type (URL or text) and will be picked up in\n                // dragenter handler.\n                return;\n            } else {\n                // If by this time no drag source reacted, tell browser not to drag.\n                e.preventDefault();\n            }\n        };\n        this.handleTopDragEndCapture = ()=>{\n            if (this.clearCurrentDragSourceNode() && this.monitor.isDragging()) {\n                // Firefox can dispatch this event in an infinite loop\n                // if dragend handler does something like showing an alert.\n                // Only proceed if we have not handled it already.\n                this.actions.endDrag();\n            }\n            this.cancelHover();\n        };\n        this.handleTopDragEnterCapture = (e)=>{\n            this.dragEnterTargetIds = [];\n            if (this.isDraggingNativeItem()) {\n                var ref;\n                (ref = this.currentNativeSource) === null || ref === void 0 ? void 0 : ref.loadDataTransfer(e.dataTransfer);\n            }\n            const isFirstEnter = this.enterLeaveCounter.enter(e.target);\n            if (!isFirstEnter || this.monitor.isDragging()) {\n                return;\n            }\n            const { dataTransfer  } = e;\n            const nativeType = matchNativeItemType(dataTransfer);\n            if (nativeType) {\n                // A native item (such as file or URL) dragged from outside the document\n                this.beginDragNativeItem(nativeType, dataTransfer);\n            }\n        };\n        this.handleTopDragEnter = (e)=>{\n            const { dragEnterTargetIds  } = this;\n            this.dragEnterTargetIds = [];\n            if (!this.monitor.isDragging()) {\n                // This is probably a native item type we don't understand.\n                return;\n            }\n            this.altKeyPressed = e.altKey;\n            // If the target changes position as the result of `dragenter`, `dragover` might still\n            // get dispatched despite target being no longer there. The easy solution is to check\n            // whether there actually is a target before firing `hover`.\n            if (dragEnterTargetIds.length > 0) {\n                this.actions.hover(dragEnterTargetIds, {\n                    clientOffset: getEventClientOffset(e)\n                });\n            }\n            const canDrop = dragEnterTargetIds.some((targetId)=>this.monitor.canDropOnTarget(targetId)\n            );\n            if (canDrop) {\n                // IE requires this to fire dragover events\n                e.preventDefault();\n                if (e.dataTransfer) {\n                    e.dataTransfer.dropEffect = this.getCurrentDropEffect();\n                }\n            }\n        };\n        this.handleTopDragOverCapture = (e)=>{\n            this.dragOverTargetIds = [];\n            if (this.isDraggingNativeItem()) {\n                var ref;\n                (ref = this.currentNativeSource) === null || ref === void 0 ? void 0 : ref.loadDataTransfer(e.dataTransfer);\n            }\n        };\n        this.handleTopDragOver = (e)=>{\n            const { dragOverTargetIds  } = this;\n            this.dragOverTargetIds = [];\n            if (!this.monitor.isDragging()) {\n                // This is probably a native item type we don't understand.\n                // Prevent default \"drop and blow away the whole document\" action.\n                e.preventDefault();\n                if (e.dataTransfer) {\n                    e.dataTransfer.dropEffect = 'none';\n                }\n                return;\n            }\n            this.altKeyPressed = e.altKey;\n            this.lastClientOffset = getEventClientOffset(e);\n            this.scheduleHover(dragOverTargetIds);\n            const canDrop = (dragOverTargetIds || []).some((targetId)=>this.monitor.canDropOnTarget(targetId)\n            );\n            if (canDrop) {\n                // Show user-specified drop effect.\n                e.preventDefault();\n                if (e.dataTransfer) {\n                    e.dataTransfer.dropEffect = this.getCurrentDropEffect();\n                }\n            } else if (this.isDraggingNativeItem()) {\n                // Don't show a nice cursor but still prevent default\n                // \"drop and blow away the whole document\" action.\n                e.preventDefault();\n            } else {\n                e.preventDefault();\n                if (e.dataTransfer) {\n                    e.dataTransfer.dropEffect = 'none';\n                }\n            }\n        };\n        this.handleTopDragLeaveCapture = (e)=>{\n            if (this.isDraggingNativeItem()) {\n                e.preventDefault();\n            }\n            const isLastLeave = this.enterLeaveCounter.leave(e.target);\n            if (!isLastLeave) {\n                return;\n            }\n            if (this.isDraggingNativeItem()) {\n                setTimeout(()=>this.endDragNativeItem()\n                , 0);\n            }\n            this.cancelHover();\n        };\n        this.handleTopDropCapture = (e)=>{\n            this.dropTargetIds = [];\n            if (this.isDraggingNativeItem()) {\n                var ref;\n                e.preventDefault();\n                (ref = this.currentNativeSource) === null || ref === void 0 ? void 0 : ref.loadDataTransfer(e.dataTransfer);\n            } else if (matchNativeItemType(e.dataTransfer)) {\n                // Dragging some elements, like <a> and <img> may still behave like a native drag event,\n                // even if the current drag event matches a user-defined type.\n                // Stop the default behavior when we're not expecting a native item to be dropped.\n                e.preventDefault();\n            }\n            this.enterLeaveCounter.reset();\n        };\n        this.handleTopDrop = (e)=>{\n            const { dropTargetIds  } = this;\n            this.dropTargetIds = [];\n            this.actions.hover(dropTargetIds, {\n                clientOffset: getEventClientOffset(e)\n            });\n            this.actions.drop({\n                dropEffect: this.getCurrentDropEffect()\n            });\n            if (this.isDraggingNativeItem()) {\n                this.endDragNativeItem();\n            } else if (this.monitor.isDragging()) {\n                this.actions.endDrag();\n            }\n            this.cancelHover();\n        };\n        this.handleSelectStart = (e)=>{\n            const target = e.target;\n            // Only IE requires us to explicitly say\n            // we want drag drop operation to start\n            if (typeof target.dragDrop !== 'function') {\n                return;\n            }\n            // Inputs and textareas should be selectable\n            if (target.tagName === 'INPUT' || target.tagName === 'SELECT' || target.tagName === 'TEXTAREA' || target.isContentEditable) {\n                return;\n            }\n            // For other targets, ask IE\n            // to enable drag and drop\n            e.preventDefault();\n            target.dragDrop();\n        };\n        this.options = new OptionsReader(globalContext, options);\n        this.actions = manager.getActions();\n        this.monitor = manager.getMonitor();\n        this.registry = manager.getRegistry();\n        this.enterLeaveCounter = new EnterLeaveCounter(this.isNodeInDocument);\n    }\n}\n\n//# sourceMappingURL=HTML5BackendImpl.js.map","import { HTML5BackendImpl } from './HTML5BackendImpl.js';\nimport * as _NativeTypes from './NativeTypes.js';\nexport { getEmptyImage } from './getEmptyImage.js';\nexport { _NativeTypes as NativeTypes };\nexport const HTML5Backend = function createBackend(manager, context, options) {\n    return new HTML5BackendImpl(manager, context, options);\n};\n\n//# sourceMappingURL=index.js.map","import { useDrag, useDrop, DndProvider } from 'react-dnd';\nimport { HTML5Backend } from 'react-dnd-html5-backend';\nimport { ArrowRightLeft } from 'lucide-react';\nimport { useTheme } from '@/contexts/ThemeContext';\nimport { usePAFV, type Chip, type Wells } from '@/contexts/PAFVContext';\n\nconst ItemType = 'CHIP';\n\ninterface DraggableChipProps {\n  chip: Chip;\n  well: keyof Wells;\n  index: number;\n  moveChip: (fromWell: keyof Wells, _fromIndex: number, toWell: keyof Wells, toIndex: number) => void;\n  toggleCheckbox: (well: keyof Wells, _chipId: string) => void;\n  theme: 'NeXTSTEP' | 'Modern';\n}\n\nfunction DraggableChip({ chip, well, index, moveChip, toggleCheckbox, theme }: DraggableChipProps) {\n  const [{ isDragging }, drag] = useDrag({\n    type: ItemType,\n    item: { well, index, chip },\n    collect: (monitor) => ({ isDragging: monitor.isDragging() }),\n  });\n\n  const [, drop] = useDrop({\n    accept: ItemType,\n    hover: (item: { well: keyof Wells; index: number }) => {\n      if (item.well !== well || item.index !== index) {\n        moveChip(item.well as keyof Wells, item.index, well, index);\n        item.well = well;\n        item.index = index;\n      }\n    },\n  });\n\n  return (\n    <div\n      ref={(node) => drag(drop(node))}\n      className={`flex items-center gap-1.5 h-7 px-2.5 cursor-move text-xs w-full ${\n        isDragging ? 'opacity-50' : 'opacity-100'\n      } ${\n        theme === 'NeXTSTEP'\n          ? 'bg-[#d4d4d4] border-t-2 border-l-2 border-[#ffffff] border-b-2 border-r-2 border-b-[#707070] border-r-[#707070]'\n          : 'bg-white hover:bg-gray-50 rounded-md border border-gray-300'\n      }`}\n    >\n      {chip.hasCheckbox && (\n        <input\n          type=\"checkbox\"\n          checked={chip.checked || false}\n          onChange={() => toggleCheckbox(well, chip.id)}\n          onClick={(e) => e.stopPropagation()}\n          className=\"w-3 h-3 cursor-pointer\"\n        />\n      )}\n      <span>{chip.label}</span>\n    </div>\n  );\n}\n\ninterface DropWellProps {\n  title: string;\n  well: keyof Wells;\n  chips: Chip[];\n  moveChip: (fromWell: keyof Wells, _fromIndex: number, toWell: keyof Wells, toIndex: number) => void;\n  toggleCheckbox: (well: keyof Wells, _chipId: string) => void;\n  theme: 'NeXTSTEP' | 'Modern';\n}\n\nfunction DropWell({ title, well, chips, moveChip, toggleCheckbox, theme }: DropWellProps) {\n  const [, drop] = useDrop({\n    accept: ItemType,\n    drop: (item: { well: keyof Wells; index: number }) => {\n      if (item.well !== well) {\n        moveChip(item.well, item.index, well, chips.length);\n      }\n    },\n  });\n\n  return (\n    <div className=\"flex-1 min-w-0\">\n      <div className={`text-[10px] mb-1 px-1 ${theme === 'NeXTSTEP' ? 'text-[#404040]' : 'text-gray-600 font-medium'}`}>\n        {title}\n      </div>\n      <div\n        ref={drop}\n        className={`min-h-[140px] p-2 flex flex-col gap-1.5 ${\n          theme === 'NeXTSTEP'\n            ? 'bg-[#a0a0a0] border-t-2 border-l-2 border-[#606060] border-b-2 border-r-2 border-r-[#d0d0d0] border-b-[#d0d0d0]'\n            : 'bg-gray-50 border border-gray-300 rounded-lg'\n        }`}\n      >\n        {chips.map((chip, index) => (\n          <DraggableChip key={chip.id} chip={chip} well={well} index={index} moveChip={moveChip} toggleCheckbox={toggleCheckbox} theme={theme} />\n        ))}\n      </div>\n    </div>\n  );\n}\n\nfunction PAFVNavigatorContent() {\n  const { theme } = useTheme();\n  const { wells, moveChip, toggleCheckbox, transpose } = usePAFV();\n\n  return (\n    <div className={`p-3 ${\n      theme === 'NeXTSTEP'\n        ? 'bg-[#b8b8b8] border-b-2 border-[#505050]'\n        : 'bg-white/50 backdrop-blur-xl border-b border-gray-200'\n    }`}>\n      <div className=\"flex gap-3\">\n        <DropWell title=\"Available\" well=\"available\" chips={wells.available} moveChip={moveChip} toggleCheckbox={toggleCheckbox} theme={theme} />\n        <DropWell title=\"Rows\" well=\"rows\" chips={wells.rows} moveChip={moveChip} toggleCheckbox={toggleCheckbox} theme={theme} />\n\n        {/* Transpose button between Rows and Columns */}\n        <div className=\"flex items-center\">\n          <button\n            onClick={transpose}\n            className={`p-2 rounded transition-colors ${\n              theme === 'NeXTSTEP'\n                ? 'bg-[#d4d4d4] border-t-2 border-l-2 border-[#ffffff] border-b-2 border-r-2 border-b-[#707070] border-r-[#707070] hover:bg-[#c0c0c0] active:border-t-[#707070] active:border-l-[#707070] active:border-b-[#ffffff] active:border-r-[#ffffff]'\n                : 'bg-gray-100 hover:bg-gray-200 border border-gray-300'\n            }`}\n            title=\"Transpose rows and columns\"\n          >\n            <ArrowRightLeft className=\"w-4 h-4\" />\n          </button>\n        </div>\n\n        <DropWell title=\"Columns\" well=\"columns\" chips={wells.columns} moveChip={moveChip} toggleCheckbox={toggleCheckbox} theme={theme} />\n        <DropWell title=\"Layers\" well=\"zLayers\" chips={wells.zLayers} moveChip={moveChip} toggleCheckbox={toggleCheckbox} theme={theme} />\n      </div>\n    </div>\n  );\n}\n\nexport function PAFVNavigator() {\n  return (\n    <DndProvider backend={HTML5Backend}>\n      <PAFVNavigatorContent />\n    </DndProvider>\n  );\n}\n","/**\n * Dropdown Component\n *\n * Theme-aware dropdown/select component.\n * Extracted pattern from Navigator.tsx inline Dropdown.\n */\n\nimport { useState, useRef, useEffect, type ReactNode } from 'react';\nimport { ChevronDown } from 'lucide-react';\nimport { useTheme } from '@/contexts/ThemeContext';\n\n// ============================================\n// Types\n// ============================================\n\nexport interface DropdownOption<T = string> {\n  value: T;\n  label: string;\n  icon?: ReactNode;\n  disabled?: boolean;\n}\n\nexport interface DropdownProps<T = string> {\n  label?: string;\n  value: T;\n  options: DropdownOption<T>[];\n  onSelect: (value: T) => void;\n  placeholder?: string;\n  disabled?: boolean;\n  fullWidth?: boolean;\n  className?: string;\n}\n\n// ============================================\n// Component\n// ============================================\n\nexport function Dropdown<T = string>({\n  label,\n  value,\n  options,\n  onSelect,\n  placeholder = 'Select...',\n  disabled = false,\n  fullWidth = false,\n  className = '',\n}: DropdownProps<T>) {\n  const { theme } = useTheme();\n  const [isOpen, setIsOpen] = useState(false);\n  const containerRef = useRef<HTMLDivElement>(null);\n\n  // Close on click outside\n  useEffect(() => {\n    const handleClickOutside = (event: MouseEvent) => {\n      if (containerRef.current && !containerRef.current.contains(event.target as Node)) {\n        setIsOpen(false);\n      }\n    };\n\n    document.addEventListener('mousedown', handleClickOutside);\n    return () => document.removeEventListener('mousedown', handleClickOutside);\n  }, []);\n\n  // Close on Escape\n  useEffect(() => {\n    const handleKeyDown = (event: KeyboardEvent) => {\n      if (event.key === 'Escape') {\n        setIsOpen(false);\n      }\n    };\n\n    if (isOpen) {\n      document.addEventListener('keydown', handleKeyDown);\n      return () => document.removeEventListener('keydown', handleKeyDown);\n    }\n  }, [isOpen]);\n\n  const selectedOption = options.find((opt) => opt.value === value);\n  const displayValue = selectedOption?.label || placeholder;\n\n  const buttonStyles =\n    theme === 'NeXTSTEP'\n      ? `\n        bg-[#d4d4d4] text-[#404040]\n        border-t-2 border-l-2 border-[#ffffff]\n        border-b-2 border-r-2 border-b-[#707070] border-r-[#707070]\n        active:border-t-[#707070] active:border-l-[#707070]\n        active:border-b-[#ffffff] active:border-r-[#ffffff]\n      `\n      : `\n        bg-white text-gray-700\n        rounded-lg border border-gray-300\n        hover:bg-gray-50\n        shadow-sm\n      `;\n\n  const menuStyles =\n    theme === 'NeXTSTEP'\n      ? `\n        bg-[#d4d4d4]\n        border-2 border-[#707070]\n        shadow-[2px_2px_0_#505050]\n      `\n      : `\n        bg-white\n        rounded-lg border border-gray-200\n        shadow-lg\n      `;\n\n  const itemStyles =\n    theme === 'NeXTSTEP'\n      ? 'hover:bg-[#2850a0] hover:text-white'\n      : 'hover:bg-gray-100 rounded';\n\n  const labelStyles =\n    theme === 'NeXTSTEP'\n      ? 'text-xs text-[#404040]'\n      : 'text-xs text-gray-600 font-medium';\n\n  return (\n    <div\n      ref={containerRef}\n      className={`relative ${fullWidth ? 'w-full' : ''} ${className}`}\n    >\n      <div className=\"flex items-center gap-1\">\n        {label && (\n          <span className={`${labelStyles} whitespace-nowrap`}>{label}:</span>\n        )}\n        <button\n          type=\"button\"\n          disabled={disabled}\n          onClick={() => !disabled && setIsOpen(!isOpen)}\n          className={`\n            h-7 px-3 flex items-center gap-2 text-sm\n            ${fullWidth ? 'w-full' : 'min-w-[120px]'}\n            justify-between\n            ${buttonStyles}\n            ${disabled ? 'opacity-50 cursor-not-allowed' : 'cursor-pointer'}\n            transition-colors duration-150\n          `}\n        >\n          <span className=\"truncate\">\n            {selectedOption?.icon && (\n              <span className=\"mr-2\">{selectedOption.icon}</span>\n            )}\n            {displayValue}\n          </span>\n          <ChevronDown\n            className={`w-3 h-3 flex-shrink-0 transition-transform duration-150 ${\n              isOpen ? 'rotate-180' : ''\n            }`}\n          />\n        </button>\n      </div>\n\n      {isOpen && (\n        <div\n          className={`\n            absolute z-50 top-full left-0 mt-1\n            min-w-full max-h-60 overflow-auto\n            ${menuStyles}\n          `}\n        >\n          {options.map((option) => (\n            <button\n              key={String(option.value)}\n              type=\"button\"\n              disabled={option.disabled}\n              onClick={() => {\n                if (!option.disabled) {\n                  onSelect(option.value);\n                  setIsOpen(false);\n                }\n              }}\n              className={`\n                w-full px-3 py-1.5 text-sm text-left\n                flex items-center gap-2\n                ${option.value === value ? 'font-medium' : ''}\n                ${option.disabled ? 'opacity-50 cursor-not-allowed' : itemStyles}\n                ${theme === 'NeXTSTEP' ? 'text-[#404040]' : 'text-gray-700'}\n              `}\n            >\n              {option.icon && <span className=\"w-4 h-4\">{option.icon}</span>}\n              <span className=\"truncate\">{option.label}</span>\n            </button>\n          ))}\n        </div>\n      )}\n    </div>\n  );\n}\n\nexport default Dropdown;\n","import { useState, useMemo } from 'react';\nimport { ChevronDown, ChevronUp } from 'lucide-react';\nimport { PAFVNavigator } from './PAFVNavigator';\nimport { useTheme } from '@/contexts/ThemeContext';\nimport { useAppState, type AppName, type ViewName, type DatasetName } from '@/contexts/AppStateContext';\nimport { Dropdown, type DropdownOption } from '@/components/ui/Dropdown';\n\nexport function Navigator() {\n  const { activeApp, activeView, activeDataset, setActiveApp, setActiveView, setActiveDataset } = useAppState();\n  const [isExpanded, setIsExpanded] = useState(true);\n  const { theme } = useTheme();\n\n  // TODO: Replace with SQLite queries\n  const appOptions: DropdownOption<AppName>[] = useMemo(() => [\n    { value: 'Demo', label: 'Demo' },\n    { value: 'Inbox', label: 'Inbox' },\n    { value: 'Projects', label: 'Projects' },\n    { value: 'LinkedIn', label: 'LinkedIn' },\n    { value: 'MTGs', label: 'MTGs' },\n    { value: 'ReadWatch', label: 'ReadWatch' },\n  ], []);\n\n  const viewOptions: DropdownOption<ViewName>[] = useMemo(() => [\n    { value: 'List', label: 'List' },\n    { value: 'Gallery', label: 'Gallery' },\n    { value: 'Timeline', label: 'Timeline' },\n    { value: 'Calendar', label: 'Calendar' },\n    { value: 'Tree', label: 'Tree' },\n    { value: 'Kanban', label: 'Kanban' },\n    { value: 'Grid', label: 'Grid' },\n    { value: 'Charts', label: 'Charts' },\n    { value: 'Graphs', label: 'Graphs' },\n  ], []);\n\n  const datasetOptions: DropdownOption<DatasetName>[] = useMemo(() => [\n    { value: 'ETL', label: 'ETL' },\n    { value: 'CAS', label: 'CAS' },\n    { value: 'Catalog', label: 'Catalog' },\n    { value: 'Taxonomy', label: 'Taxonomy' },\n    { value: 'Notes', label: 'Notes' },\n    { value: 'Projects', label: 'Projects' },\n    { value: 'Contacts', label: 'Contacts' },\n    { value: 'Messages', label: 'Messages' },\n  ], []);\n\n  return (\n    <>\n      {/* Navigator row needs relative + z-20 so dropdown menus appear above PAFVNavigator */}\n      <div className={`relative z-20 h-12 flex items-center px-3 gap-4 ${\n        theme === 'NeXTSTEP'\n          ? 'bg-[#b8b8b8] border-b-2 border-[#505050]'\n          : 'bg-white/50 backdrop-blur-xl border-b border-gray-200'\n      }`}>\n        <button\n          onClick={() => setIsExpanded(!isExpanded)}\n          className={`h-7 w-7 flex items-center justify-center ${\n            theme === 'NeXTSTEP'\n              ? 'bg-[#d4d4d4] border-t-2 border-l-2 border-[#ffffff] border-b-2 border-r-2 border-b-[#707070] border-r-[#707070]'\n              : 'bg-gray-100 hover:bg-gray-200 rounded-lg'\n          }`}\n        >\n          {isExpanded ? <ChevronUp className=\"w-3 h-3\" /> : <ChevronDown className=\"w-3 h-3\" />}\n        </button>\n\n        <Dropdown\n          label=\"Apps\"\n          value={activeApp}\n          options={appOptions}\n          onSelect={setActiveApp}\n        />\n        <Dropdown\n          label=\"Views\"\n          value={activeView}\n          options={viewOptions}\n          onSelect={setActiveView}\n        />\n        <Dropdown\n          label=\"Datasets\"\n          value={activeDataset}\n          options={datasetOptions}\n          onSelect={setActiveDataset}\n        />\n      </div>\n\n      {/* PAFVNavigator at z-10, below Navigator dropdowns (z-20) */}\n      {isExpanded && (\n        <div className=\"relative z-10\">\n          <PAFVNavigator />\n        </div>\n      )}\n    </>\n  );\n}\n","/**\n * TabPanel Component\n *\n * Theme-aware tab navigation with icon support.\n * Extracted pattern from Sidebar and RightSidebar.\n */\n\nimport { useState, type ReactNode } from 'react';\nimport { useTheme } from '@/contexts/ThemeContext';\n\n// ============================================\n// Types\n// ============================================\n\nexport interface Tab {\n  id: string;\n  label: string;\n  icon?: ReactNode;\n  content: ReactNode;\n  disabled?: boolean;\n}\n\nexport interface TabPanelProps {\n  tabs: Tab[];\n  defaultTab?: string;\n  activeTab?: string;\n  onTabChange?: (tabId: string) => void;\n  className?: string;\n}\n\n// ============================================\n// Component\n// ============================================\n\nexport function TabPanel({\n  tabs,\n  defaultTab,\n  activeTab: controlledActiveTab,\n  onTabChange,\n  className = '',\n}: TabPanelProps) {\n  const { theme } = useTheme();\n  const [internalActiveTab, setInternalActiveTab] = useState(\n    defaultTab || tabs[0]?.id\n  );\n\n  // Support both controlled and uncontrolled modes\n  const activeTab = controlledActiveTab ?? internalActiveTab;\n\n  const handleTabClick = (tabId: string) => {\n    if (!controlledActiveTab) {\n      setInternalActiveTab(tabId);\n    }\n    onTabChange?.(tabId);\n  };\n\n  const activeTabContent = tabs.find((tab) => tab.id === activeTab)?.content;\n\n  // Tab button styles\n  const tabBaseStyles =\n    theme === 'NeXTSTEP'\n      ? `\n        px-3 py-1.5 text-xs\n        border-t-2 border-l-2 border-r-2\n        border-b-0\n        -mb-[2px]\n      `\n      : `\n        px-3 py-1.5 text-xs font-medium\n        rounded-t-lg\n        -mb-px\n      `;\n\n  const tabActiveStyles =\n    theme === 'NeXTSTEP'\n      ? `\n        bg-[#d4d4d4] text-[#404040]\n        border-t-[#ffffff] border-l-[#ffffff] border-r-[#707070]\n        z-10\n      `\n      : `\n        bg-white text-gray-900\n        border border-gray-200 border-b-white\n      `;\n\n  const tabInactiveStyles =\n    theme === 'NeXTSTEP'\n      ? `\n        bg-[#b0b0b0] text-[#606060]\n        border-t-[#d4d4d4] border-l-[#d4d4d4] border-r-[#707070]\n        hover:bg-[#c0c0c0]\n      `\n      : `\n        bg-gray-100 text-gray-600\n        border border-transparent\n        hover:bg-gray-200 hover:text-gray-900\n      `;\n\n  // Content panel styles\n  const panelStyles =\n    theme === 'NeXTSTEP'\n      ? `\n        bg-[#d4d4d4]\n        border-2\n        border-t-[#ffffff] border-l-[#ffffff]\n        border-b-[#707070] border-r-[#707070]\n      `\n      : `\n        bg-white\n        border border-gray-200\n        rounded-b-lg rounded-tr-lg\n      `;\n\n  return (\n    <div className={`flex flex-col ${className}`}>\n      {/* Tab list */}\n      <div className=\"flex\" role=\"tablist\">\n        {tabs.map((tab) => (\n          <button\n            key={tab.id}\n            type=\"button\"\n            role=\"tab\"\n            aria-selected={activeTab === tab.id}\n            aria-controls={`panel-${tab.id}`}\n            disabled={tab.disabled}\n            onClick={() => !tab.disabled && handleTabClick(tab.id)}\n            className={`\n              ${tabBaseStyles}\n              ${activeTab === tab.id ? tabActiveStyles : tabInactiveStyles}\n              ${tab.disabled ? 'opacity-50 cursor-not-allowed' : 'cursor-pointer'}\n              flex items-center gap-1.5\n              transition-colors duration-150\n            `}\n          >\n            {tab.icon && <span className=\"w-3.5 h-3.5\">{tab.icon}</span>}\n            <span>{tab.label}</span>\n          </button>\n        ))}\n      </div>\n\n      {/* Tab content */}\n      <div\n        id={`panel-${activeTab}`}\n        role=\"tabpanel\"\n        aria-labelledby={activeTab}\n        className={`${panelStyles} flex-1 overflow-auto`}\n      >\n        {activeTabContent}\n      </div>\n    </div>\n  );\n}\n\nexport default TabPanel;\n","/**\n * AccordionSection Component\n *\n * Theme-aware collapsible section with chevron toggle.\n * Extracted pattern from Sidebar and RightSidebar filter panels.\n */\n\nimport { useState, type ReactNode } from 'react';\nimport { ChevronRight } from 'lucide-react';\nimport { useTheme } from '@/contexts/ThemeContext';\n\n// ============================================\n// Types\n// ============================================\n\nexport interface AccordionSectionProps {\n  title: string;\n  icon?: ReactNode;\n  badge?: ReactNode;\n  children: ReactNode;\n  defaultExpanded?: boolean;\n  expanded?: boolean;\n  onToggle?: (expanded: boolean) => void;\n  className?: string;\n}\n\n// ============================================\n// Component\n// ============================================\n\nexport function AccordionSection({\n  title,\n  icon,\n  badge,\n  children,\n  defaultExpanded = true,\n  expanded: controlledExpanded,\n  onToggle,\n  className = '',\n}: AccordionSectionProps) {\n  const { theme } = useTheme();\n  const [internalExpanded, setInternalExpanded] = useState(defaultExpanded);\n\n  // Support both controlled and uncontrolled modes\n  const expanded = controlledExpanded ?? internalExpanded;\n\n  const handleToggle = () => {\n    const newExpanded = !expanded;\n    if (controlledExpanded === undefined) {\n      setInternalExpanded(newExpanded);\n    }\n    onToggle?.(newExpanded);\n  };\n\n  const headerStyles =\n    theme === 'NeXTSTEP'\n      ? `\n        bg-[#c0c0c0]\n        border-b border-[#707070]\n        hover:bg-[#c8c8c8]\n      `\n      : `\n        bg-gray-50\n        border-b border-gray-200\n        hover:bg-gray-100\n      `;\n\n  const titleStyles =\n    theme === 'NeXTSTEP'\n      ? 'text-xs font-medium text-[#404040]'\n      : 'text-xs font-semibold text-gray-700';\n\n  const chevronStyles =\n    theme === 'NeXTSTEP' ? 'text-[#606060]' : 'text-gray-400';\n\n  const contentStyles =\n    theme === 'NeXTSTEP'\n      ? 'bg-[#d4d4d4]'\n      : 'bg-white';\n\n  return (\n    <div className={`${className}`}>\n      {/* Header */}\n      <button\n        type=\"button\"\n        onClick={handleToggle}\n        className={`\n          w-full px-3 py-2\n          flex items-center gap-2\n          ${headerStyles}\n          cursor-pointer\n          transition-colors duration-150\n        `}\n        aria-expanded={expanded}\n      >\n        <ChevronRight\n          className={`\n            w-3.5 h-3.5 flex-shrink-0\n            transition-transform duration-200\n            ${expanded ? 'rotate-90' : ''}\n            ${chevronStyles}\n          `}\n        />\n        {icon && (\n          <span\n            className={`w-4 h-4 ${\n              theme === 'NeXTSTEP' ? 'text-[#606060]' : 'text-gray-500'\n            }`}\n          >\n            {icon}\n          </span>\n        )}\n        <span className={`flex-1 text-left ${titleStyles}`}>{title}</span>\n        {badge && <span className=\"flex-shrink-0\">{badge}</span>}\n      </button>\n\n      {/* Content */}\n      <div\n        className={`\n          overflow-hidden\n          transition-all duration-200 ease-in-out\n          ${expanded ? 'max-h-[1000px] opacity-100' : 'max-h-0 opacity-0'}\n        `}\n      >\n        <div className={`${contentStyles} p-3`}>{children}</div>\n      </div>\n    </div>\n  );\n}\n\nexport default AccordionSection;\n","import { useState, useMemo } from 'react';\nimport { Filter, FileText, X } from 'lucide-react';\nimport { useTheme } from '../contexts/ThemeContext';\nimport { useFilters } from '../contexts/FilterContext';\nimport { useSQLiteQuery } from '../hooks/useSQLiteQuery';\nimport { TabPanel, type Tab } from './ui/TabPanel';\nimport { AccordionSection } from './ui/AccordionSection';\n\ntype TabType = 'filters' | 'templates';\n\ninterface FacetValue {\n  value: string;\n  count: number;\n}\n\ninterface ColumnInfo {\n  name: string;\n}\n\nexport function Sidebar() {\n  const [activeTab, setActiveTab] = useState<TabType>('filters');\n  const [activeFilterPanel, setActiveFilterPanel] = useState<string | null>(null);\n  const { theme } = useTheme();\n  const { filters, addFilter, removeFilter, clearFilters } = useFilters();\n\n  const templateBuilders = ['Apps Builder', 'Views Builder', 'Buttons Builder', 'Charts Builder'];\n\n  // Query table schema to discover available columns\n  const { data: columns } = useSQLiteQuery<ColumnInfo>(\n    `PRAGMA table_info(cards)`\n  );\n\n  // Full LATCH filter list - always show all, dim unavailable ones\n  const LATCH_FILTERS = ['Location', 'Alphabet', 'Time', 'Category', 'Hierarchy'];\n\n  // Determine which filterable columns exist in the schema\n  const availableFilters = useMemo(() => {\n    if (!columns) return new Set<string>();\n\n    const columnNames = new Set(columns.map(c => c.name));\n    const available = new Set<string>();\n\n    // Map LATCH axes to available columns\n    if (columnNames.has('location') || columnNames.has('lat') || columnNames.has('lng')) available.add('Location');\n    if (columnNames.has('name') || columnNames.has('title')) available.add('Alphabet');\n    if (columnNames.has('created') || columnNames.has('due') || columnNames.has('createdAt')) available.add('Time');\n    if (columnNames.has('category') || columnNames.has('status') || columnNames.has('priority') || columnNames.has('tags') || columnNames.has('folder')) available.add('Category');\n    if (columnNames.has('parent') || columnNames.has('parent_id') || columnNames.has('folder')) available.add('Hierarchy');\n\n    return available;\n  }, [columns]);\n\n  // Build filter sections - show all LATCH filters, mark availability\n  const filterSections = useMemo(() => {\n    return [\n      {\n        title: 'Analytics',\n        items: LATCH_FILTERS.map(filter => ({\n          name: filter,\n          available: availableFilters.has(filter)\n        }))\n      },\n      {\n        title: 'Synthetics',\n        items: ['Links', 'Paths', 'Vectors', 'Centrality', 'Similarity', 'Community'].map(item => ({\n          name: item,\n          available: false // TODO: Check for edges table\n        }))\n      },\n      {\n        title: 'Formulas',\n        items: ['Active Filters', 'Algorithms', 'Audit View', 'Versions'].map(item => ({\n          name: item,\n          available: true // These are always available\n        }))\n      }\n    ];\n  }, [availableFilters]);\n\n  // Check if Category filter is available (has category-related columns)\n  const hasCategoryFilter = availableFilters.has('Category');\n  const hasTimeFilter = availableFilters.has('Time');\n\n  // Query distinct values for category facet (uses 'folder' as proxy since our schema uses folder)\n  const { data: categories } = useSQLiteQuery<FacetValue>(\n    hasCategoryFilter\n      ? `SELECT folder as value, COUNT(*) as count FROM cards WHERE folder IS NOT NULL AND folder != '' GROUP BY folder ORDER BY count DESC`\n      : `SELECT NULL as value, 0 as count WHERE 0`,\n    [],\n    { enabled: hasCategoryFilter }\n  );\n\n  // Query distinct values for status facet\n  const { data: statuses } = useSQLiteQuery<FacetValue>(\n    hasCategoryFilter\n      ? `SELECT status as value, COUNT(*) as count FROM cards WHERE status IS NOT NULL AND status != '' GROUP BY status ORDER BY count DESC`\n      : `SELECT NULL as value, 0 as count WHERE 0`,\n    [],\n    { enabled: hasCategoryFilter }\n  );\n\n  // Query distinct values for priority facet\n  const { data: priorities } = useSQLiteQuery<FacetValue>(\n    hasCategoryFilter\n      ? `SELECT CAST(priority as TEXT) as value, COUNT(*) as count FROM cards WHERE priority IS NOT NULL GROUP BY priority ORDER BY priority ASC`\n      : `SELECT NULL as value, 0 as count WHERE 0`,\n    [],\n    { enabled: hasCategoryFilter }\n  );\n\n  // Query distinct values for tags facet\n  const { data: tags } = useSQLiteQuery<FacetValue>(\n    hasCategoryFilter\n      ? `SELECT tags as value, COUNT(*) as count FROM cards WHERE tags IS NOT NULL AND tags != '' GROUP BY tags ORDER BY count DESC`\n      : `SELECT NULL as value, 0 as count WHERE 0`,\n    [],\n    { enabled: hasCategoryFilter }\n  );\n\n  // Query date range info for time filters\n  const { data: dateRange } = useSQLiteQuery<{ min_date: string; max_date: string; has_created: number; has_due: number }>(\n    hasTimeFilter\n      ? `SELECT\n          MIN(COALESCE(createdAt, created, due)) as min_date,\n          MAX(COALESCE(createdAt, created, due)) as max_date,\n          SUM(CASE WHEN createdAt IS NOT NULL OR created IS NOT NULL THEN 1 ELSE 0 END) as has_created,\n          SUM(CASE WHEN due IS NOT NULL THEN 1 ELSE 0 END) as has_due\n         FROM cards`\n      : `SELECT NULL as min_date, NULL as max_date, 0 as has_created, 0 as has_due WHERE 0`,\n    [],\n    { enabled: hasTimeFilter }\n  );\n\n  const handleFilterItemClick = (item: string, _isAvailable: boolean) => {\n    if (isAvailable) {\n      setActiveFilterPanel(activeFilterPanel === item ? null : item);\n    }\n    // Unavailable items are dimmed and not clickable\n  };\n\n  const handleFacetClick = (field: string, _value: string) => {\n    addFilter({ field, operator: '=', value });\n    setActiveFilterPanel(null);\n  };\n\n  const renderFacetList = (\n    data: FacetValue[] | null | undefined,\n    field: string,\n    emptyMessage: string\n  ) => {\n    if (!data || data.length === 0) {\n      return <div className=\"text-xs text-gray-400 p-2\">{emptyMessage}</div>;\n    }\n\n    return (\n      <div className=\"space-y-1\">\n        {data.filter(item => item.value).map((item) => (\n          <button\n            key={item.value}\n            onClick={() => handleFacetClick(field, item.value)}\n            className={`w-full h-7 px-2 flex items-center justify-between text-sm ${\n              theme === 'NeXTSTEP'\n                ? 'bg-[#d4d4d4] hover:bg-black hover:text-white'\n                : 'bg-white hover:bg-blue-500 hover:text-white rounded'\n            }`}\n          >\n            <span>{item.value}</span>\n            <span className={`text-xs ${theme === 'NeXTSTEP' ? 'text-[#606060]' : 'text-gray-400'}`}>\n              {item.count}\n            </span>\n          </button>\n        ))}\n      </div>\n    );\n  };\n\n  const renderFilterPanel = () => {\n    if (!activeFilterPanel) return null;\n\n    const panelContent = () => {\n      switch (activeFilterPanel) {\n        case 'Category':\n          return renderFacetList(categories, 'category', 'No categories in data');\n\n        case 'Status':\n          return renderFacetList(statuses, 'status', 'No statuses in data');\n\n        case 'Priority':\n          return renderFacetList(priorities, 'priority', 'No priorities in data');\n\n        case 'Tags':\n          return renderFacetList(tags, 'tags', 'No tags in data');\n\n        case 'Time': {\n          // Only show time filters if we have date data\n          if (!dateRange || dateRange.length === 0 || (!dateRange[0]?.has_created && !dateRange[0]?.has_due)) {\n            return <div className=\"text-xs text-gray-400 p-2\">No date fields in data</div>;\n          }\n\n          const timeRanges: Array<{ label: string; start: string; end: string; field?: string }> = [];\n          const now = new Date();\n          const today = now.toISOString().split('T')[0]!;\n\n          // Calculate date boundaries\n          const weekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000).toISOString().split('T')[0]!;\n          const monthAgo = new Date(now.getFullYear(), now.getMonth() - 1, now.getDate()).toISOString().split('T')[0]!;\n          const yearAgo = new Date(now.getFullYear() - 1, now.getMonth(), now.getDate()).toISOString().split('T')[0]!\n\n          timeRanges.push({ label: 'Today', start: today, end: today });\n          timeRanges.push({ label: 'This Week', start: weekAgo, end: today });\n          timeRanges.push({ label: 'This Month', start: monthAgo, end: today });\n          timeRanges.push({ label: 'This Year', start: yearAgo, end: today });\n\n          if (dateRange[0]?.has_due) {\n            timeRanges.push({ label: 'Overdue', start: '1900-01-01', end: today, field: 'due' });\n          }\n\n          return (\n            <div className=\"space-y-1\">\n              {timeRanges.map((range) => (\n                <button\n                  key={range.label}\n                  onClick={() => {\n                    // Add time range filter\n                    const dateField = range.field || (dateRange[0]?.has_created ? 'created' : 'due');\n                    addFilter({\n                      field: dateField,\n                      operator: range.label === 'Overdue' ? '<' : '>=',\n                      value: range.label === 'Overdue' ? today : range.start\n                    });\n                    setActiveFilterPanel(null);\n                  }}\n                  className={`w-full h-7 px-2 text-left text-sm ${\n                    theme === 'NeXTSTEP'\n                      ? 'bg-[#d4d4d4] hover:bg-black hover:text-white'\n                      : 'bg-white hover:bg-blue-500 hover:text-white rounded'\n                  }`}\n                >\n                  {range.label}\n                </button>\n              ))}\n            </div>\n          );\n        }\n\n        default:\n          return null;\n      }\n    };\n\n    return (\n      <div className={`mt-2 p-2 ${\n        theme === 'NeXTSTEP'\n          ? 'bg-[#b8b8b8] border-2 border-[#707070]'\n          : 'bg-gray-50 rounded-lg border border-gray-200'\n      }`}>\n        <div className=\"flex items-center justify-between mb-2\">\n          <span className=\"text-xs font-medium\">{activeFilterPanel}</span>\n          <button\n            onClick={() => setActiveFilterPanel(null)}\n            className={`p-0.5 ${\n              theme === 'NeXTSTEP' ? 'hover:bg-[#a0a0a0]' : 'hover:bg-gray-200 rounded'\n            }`}\n          >\n            <X className=\"w-3 h-3\" />\n          </button>\n        </div>\n        {panelContent()}\n      </div>\n    );\n  };\n\n  // Render active filters display\n  const renderActiveFilters = () => {\n    if (filters.length === 0) return null;\n\n    return (\n      <div className={`p-2 border-b ${\n        theme === 'NeXTSTEP' ? 'border-[#808080] bg-[#b8b8b8]' : 'border-gray-200 bg-blue-50'\n      }`}>\n        <div className=\"flex items-center justify-between mb-1\">\n          <span className=\"text-xs font-medium\">Active Filters</span>\n          <button\n            onClick={clearFilters}\n            className={`text-xs ${\n              theme === 'NeXTSTEP' ? 'text-[#404040] hover:underline' : 'text-blue-500 hover:underline'\n            }`}\n          >\n            Clear All\n          </button>\n        </div>\n        <div className=\"flex flex-wrap gap-1\">\n          {filters.map((filter, index) => (\n            <span\n              key={index}\n              className={`inline-flex items-center gap-1 px-2 py-0.5 text-xs ${\n                theme === 'NeXTSTEP'\n                  ? 'bg-[#d4d4d4] border border-[#808080]'\n                  : 'bg-blue-100 text-blue-700 rounded-full'\n              }`}\n            >\n              {filter.field} {filter.operator} {String(filter.value)}\n              <button\n                onClick={() => removeFilter(index)}\n                className=\"hover:text-red-500\"\n              >\n                <X className=\"w-3 h-3\" />\n              </button>\n            </span>\n          ))}\n        </div>\n      </div>\n    );\n  };\n\n  // Render filter item button with availability state\n  const renderFilterItem = (item: { name: string; available: boolean }) => (\n    <button\n      key={item.name}\n      onClick={() => handleFilterItemClick(item.name, item.available)}\n      disabled={!item.available}\n      className={`w-full h-7 px-3 text-left text-sm transition-opacity ${\n        !item.available\n          ? theme === 'NeXTSTEP'\n            ? 'bg-[#d4d4d4] border border-[#a0a0a0] opacity-40 cursor-not-allowed text-[#808080]'\n            : 'bg-gray-100 border border-gray-200 opacity-40 cursor-not-allowed text-gray-400 rounded-md'\n          : activeFilterPanel === item.name\n            ? theme === 'NeXTSTEP'\n              ? 'bg-black text-white'\n              : 'bg-blue-500 text-white rounded-md'\n            : theme === 'NeXTSTEP'\n              ? 'bg-[#d4d4d4] border border-[#a0a0a0] hover:bg-black hover:text-white'\n              : 'bg-white hover:bg-blue-500 hover:text-white rounded-md border border-gray-200'\n      }`}\n    >\n      {item.name}\n    </button>\n  );\n\n  // Render filters tab content\n  const renderFiltersContent = () => (\n    <div className=\"p-2\">\n      {renderActiveFilters()}\n      {filterSections.map((section) => (\n        <AccordionSection\n          key={section.title}\n          title={section.title}\n          defaultExpanded={section.title === 'Analytics'}\n          className=\"mb-1\"\n        >\n          <div className=\"mt-1 ml-2 space-y-0.5\">\n            {section.items.map(renderFilterItem)}\n          </div>\n        </AccordionSection>\n      ))}\n      {renderFilterPanel()}\n    </div>\n  );\n\n  // Render templates tab content\n  const renderTemplatesContent = () => (\n    <div className=\"p-2\">\n      {templateBuilders.map((builder) => (\n        <button\n          key={builder}\n          className={`w-full h-8 px-2 mb-2 flex items-center text-sm ${\n            theme === 'NeXTSTEP'\n              ? 'bg-[#a8a8a8] border-t-2 border-l-2 border-[#c8c8c8] border-b-2 border-r-2 border-b-[#505050] border-r-[#505050]'\n              : 'bg-gray-100 hover:bg-gray-200 rounded-lg'\n          }`}\n        >\n          {builder}\n        </button>\n      ))}\n    </div>\n  );\n\n  // Define tabs for TabPanel\n  const tabs: Tab[] = [\n    {\n      id: 'filters',\n      label: 'Filters',\n      icon: <Filter className=\"w-4 h-4\" />,\n      content: renderFiltersContent(),\n    },\n    {\n      id: 'templates',\n      label: 'Templates',\n      icon: <FileText className=\"w-4 h-4\" />,\n      content: renderTemplatesContent(),\n    },\n  ];\n\n  return (\n    <div className={`w-64 h-full flex flex-col ${\n      theme === 'NeXTSTEP'\n        ? 'bg-[#c0c0c0] border-r-2 border-[#505050]'\n        : 'bg-white/80 backdrop-blur-xl border-r border-gray-200'\n    }`}>\n      <TabPanel\n        tabs={tabs}\n        activeTab={activeTab}\n        onTabChange={(tabId) => setActiveTab(tabId as TabType)}\n        className=\"flex-1 flex flex-col\"\n      />\n    </div>\n  );\n}\n","/**\n * RightSidebar Component\n *\n * Formats and Settings panel using TabPanel and AccordionSection primitives.\n */\n\nimport { useState } from 'react';\nimport { Palette, Settings as SettingsIcon } from 'lucide-react';\nimport { useTheme } from '@/contexts/ThemeContext';\nimport { TabPanel, type Tab } from '@/components/ui/TabPanel';\nimport { AccordionSection } from '@/components/ui/AccordionSection';\n\n// ============================================\n// Types\n// ============================================\n\ntype TabType = 'formats' | 'settings';\n\n// ============================================\n// Section Content Components\n// ============================================\n\nfunction TextFormatContent() {\n  const { theme } = useTheme();\n\n  const inputClass =\n    theme === 'NeXTSTEP'\n      ? 'w-full h-7 px-2 bg-white border-t-2 border-l-2 border-[#707070] border-b-2 border-r-2 border-b-[#e8e8e8] border-r-[#e8e8e8] text-sm'\n      : 'w-full h-7 px-2 bg-white border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500';\n\n  return (\n    <div className=\"space-y-2\">\n      <div>\n        <label className=\"text-xs block mb-1\">Font Family</label>\n        <select className={inputClass}>\n          <option>Helvetica</option>\n          <option>Times</option>\n          <option>Courier</option>\n        </select>\n      </div>\n      <div className=\"flex gap-2\">\n        <div className=\"flex-1\">\n          <label className=\"text-xs block mb-1\">Size</label>\n          <input type=\"number\" defaultValue=\"12\" className={inputClass} />\n        </div>\n        <div className=\"flex-1\">\n          <label className=\"text-xs block mb-1\">Color</label>\n          <input type=\"color\" defaultValue=\"#000000\" className={inputClass} />\n        </div>\n      </div>\n    </div>\n  );\n}\n\nfunction PlaceholderContent() {\n  return <p className=\"text-xs text-center text-gray-500\">Coming soon...</p>;\n}\n\n// ============================================\n// Main Component\n// ============================================\n\nexport function RightSidebar() {\n  const [activeTab, setActiveTab] = useState<TabType>('formats');\n  const [expandedSections, setExpandedSections] = useState<Set<string>>(\n    new Set(['View', 'Cell', 'Text'])\n  );\n  const { theme } = useTheme();\n\n  const formatSections = ['View', 'Cell', 'Text', 'Arrange', 'Conditional Formatting'];\n  const settingsSections = ['General', 'ETL Datasets', 'Toolbars', 'Formats', 'Views', 'Security'];\n\n  const toggleSection = (title: string) => {\n    const newExpanded = new Set(expandedSections);\n    if (newExpanded.has(title)) {\n      newExpanded.delete(title);\n    } else {\n      newExpanded.add(title);\n    }\n    setExpandedSections(newExpanded);\n  };\n\n  const renderSectionContent = (section: string, _isFormats: boolean) => {\n    if (isFormats && section === 'Text') {\n      return <TextFormatContent />;\n    }\n    return <PlaceholderContent />;\n  };\n\n  const renderSections = (sections: string[], _isFormats: boolean) => (\n    <>\n      {sections.map((section) => (\n        <AccordionSection\n          key={section}\n          title={section}\n          expanded={expandedSections.has(section)}\n          onToggle={() => toggleSection(section)}\n          className=\"mb-2\"\n        >\n          {renderSectionContent(section, isFormats)}\n        </AccordionSection>\n      ))}\n    </>\n  );\n\n  const tabs: Tab[] = [\n    {\n      id: 'formats',\n      label: 'Formats',\n      icon: <Palette className=\"w-4 h-4\" />,\n      content: <div className=\"p-2\">{renderSections(formatSections, true)}</div>,\n    },\n    {\n      id: 'settings',\n      label: 'Settings',\n      icon: <SettingsIcon className=\"w-4 h-4\" />,\n      content: <div className=\"p-2\">{renderSections(settingsSections, false)}</div>,\n    },\n  ];\n\n  return (\n    <div\n      className={`w-64 h-full flex flex-col ${\n        theme === 'NeXTSTEP'\n          ? 'bg-[#c0c0c0] border-l-2 border-[#e8e8e8]'\n          : 'bg-white/80 backdrop-blur-xl border-l border-gray-200'\n      }`}\n    >\n      <TabPanel\n        tabs={tabs}\n        activeTab={activeTab}\n        onTabChange={(tabId) => setActiveTab(tabId as TabType)}\n        className=\"flex-1 flex flex-col\"\n      />\n    </div>\n  );\n}\n","import { useState } from 'react';\nimport { ChevronDown, ChevronUp } from 'lucide-react';\nimport { useTheme } from '@/contexts/ThemeContext';\n\nexport function NavigatorFooter() {\n  const [activeTab, setActiveTab] = useState<'map' | 'slider'>('map');\n  const [isExpanded, setIsExpanded] = useState(true);\n  const { theme } = useTheme();\n\n  // TODO: Replace with dynamic coordinates from SpatiaLite\n  const boulderLat = 40.0150;\n  const boulderLon = -105.2705;\n  const mapUrl = `https://www.openstreetmap.org/export/embed.html?bbox=${boulderLon - 0.05},${boulderLat - 0.05},${boulderLon + 0.05},${boulderLat + 0.05}&layer=mapnik&marker=${boulderLat},${boulderLon}`;\n\n  return (\n    <div className={theme === 'NeXTSTEP'\n      ? 'bg-[#b8b8b8] border-t-2 border-[#808080]'\n      : 'bg-white/80 backdrop-blur-xl border-t border-gray-200'\n    }>\n      {/* Tab Headers */}\n      <div className={theme === 'NeXTSTEP' ? 'flex border-b-2 border-[#808080]' : 'flex border-b border-gray-200'}>\n        <button\n          onClick={() => setIsExpanded(!isExpanded)}\n          className={`w-8 h-8 flex items-center justify-center ${\n            theme === 'NeXTSTEP' ? 'bg-[#d4d4d4] border-r border-[#808080]' : 'bg-gray-100 border-r border-gray-200 rounded-tl-lg'\n          }`}\n        >\n          {isExpanded ? <ChevronDown className=\"w-3 h-3\" /> : <ChevronUp className=\"w-3 h-3\" />}\n        </button>\n        <button\n          onClick={() => setActiveTab('map')}\n          className={`px-4 h-8 text-sm ${\n            theme === 'NeXTSTEP'\n              ? activeTab === 'map' ? 'bg-[#b8b8b8]' : 'bg-[#a0a0a0] hover:bg-[#b0b0b0]'\n              : activeTab === 'map' ? 'bg-white text-blue-500 border-b-2 border-blue-500' : 'bg-gray-50 text-gray-600 hover:bg-gray-100'\n          }`}\n        >Location Map</button>\n        <button\n          onClick={() => setActiveTab('slider')}\n          className={`px-4 h-8 text-sm ${\n            theme === 'NeXTSTEP'\n              ? activeTab === 'slider' ? 'bg-[#b8b8b8]' : 'bg-[#a0a0a0] hover:bg-[#b0b0b0]'\n              : activeTab === 'slider' ? 'bg-white text-blue-500 border-b-2 border-blue-500' : 'bg-gray-50 text-gray-600 hover:bg-gray-100'\n          }`}\n        >Time Slider</button>\n      </div>\n\n      {/* Tab Content */}\n      {isExpanded && (\n        <div className=\"p-4\">\n          {activeTab === 'map' && (\n            <div className={`h-48 overflow-hidden ${\n              theme === 'NeXTSTEP' ? 'border-2 border-[#606060]' : 'border border-gray-300 rounded-lg'\n            }`}>\n              {/* TODO: Replace with MapLibre GL JS */}\n              <iframe width=\"100%\" height=\"100%\" frameBorder=\"0\" scrolling=\"no\" src={mapUrl} title=\"Location Map\" />\n            </div>\n          )}\n          {activeTab === 'slider' && (\n            <div className={`h-48 p-4 flex flex-col justify-center gap-4 ${\n              theme === 'NeXTSTEP' ? 'bg-[#a0a0a0] border-2 border-[#606060]' : 'bg-gray-50 border border-gray-300 rounded-lg'\n            }`}>\n              <div className=\"text-sm text-center text-gray-600\">Time series data controls</div>\n              <input type=\"range\" className=\"w-full\" min=\"0\" max=\"100\" defaultValue=\"50\" />\n              <div className=\"flex justify-between text-xs text-gray-600\">\n                <span>Start Date</span>\n                <span>End Date</span>\n              </div>\n            </div>\n          )}\n        </div>\n      )}\n    </div>\n  );\n}\n","// ============================================================================\n// Isometry DSL Parser\n// ============================================================================\n// Parses DSL strings into AST using PEG.js generated parser\n//\n// Usage:\n//   import { parse } from '@/dsl/parser';\n//   const ast = parse('status:active AND priority:>3');\n// ============================================================================\n\nimport type { ASTNode, ParseError } from './types';\n\n// Import the generated PEG.js parser (CommonJS format)\n// eslint-disable-next-line @typescript-eslint/no-require-imports\nconst pegParser = require('./grammar/parser.cjs');\n\n/**\n * Parse a DSL string into an AST\n * @param input DSL query string\n * @returns Parsed AST or null for empty input\n * @throws ParseError if input is invalid\n */\nexport function parse(input: string): ASTNode | null {\n  const trimmed = input.trim();\n  if (!trimmed) return null;\n\n  try {\n    // Use the generated PEG.js parser\n    return pegParser.parse(trimmed);\n  } catch (error: unknown) {\n    // Transform PEG.js error to our ParseError interface\n    if (error && typeof error === 'object' && 'location' in error) {\n      const pegError = error as {\n        message: string;\n        location?: { start?: { line: number; column: number } };\n        expected?: Array<{ description: string }>;\n        found?: string;\n      };\n\n      throw {\n        message: pegError.message,\n        position: pegError.location?.start?.column || 0,\n        line: pegError.location?.start?.line || 1,\n        column: pegError.location?.start?.column || 1,\n        expected: pegError.expected?.map(e => e.description) || [],\n        found: pegError.found || ''\n      } as ParseError;\n    }\n\n    // Fallback for unknown error types\n    throw {\n      message: error instanceof Error ? error.message : 'Parse error',\n      position: 0,\n      line: 1,\n      column: 1,\n      expected: [],\n      found: trimmed\n    } as ParseError;\n  }\n}\n\n/**\n * Validate that all fields in AST exist in schema\n * @param ast Parsed AST\n * @param schema Available field names\n * @returns Array of validation errors\n */\nexport function validate(ast: ASTNode, schema: string[]): string[] {\n  const errors: string[] = [];\n  \n  function walk(node: ASTNode) {\n    switch (node.type) {\n      case 'filter':\n        if (!schema.includes(node.field)) {\n          errors.push(`Unknown field: ${node.field}`);\n        }\n        break;\n      case 'and':\n      case 'or':\n        walk(node.left);\n        walk(node.right);\n        break;\n      case 'not':\n        walk(node.operand);\n        break;\n      case 'group':\n        walk(node.expression);\n        break;\n    }\n  }\n  \n  if (ast) walk(ast);\n  return errors;\n}\n","import { useState } from 'react';\nimport { useTheme } from '../contexts/ThemeContext';\nimport { useFilters } from '../contexts/FilterContext';\nimport { parse } from '../dsl/parser';\nimport type { FilterNode } from '../dsl/types';\n\nexport function CommandBar() {\n  const [commandText, setCommandText] = useState('');\n  const [error, setError] = useState<string | null>(null);\n  const { theme } = useTheme();\n  const { addFilter, clearFilters } = useFilters();\n\n  const handleCommandSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    setError(null);\n\n    const trimmed = commandText.trim();\n    if (!trimmed) return;\n\n    // Handle special commands\n    if (trimmed === 'clear' || trimmed === 'reset') {\n      clearFilters();\n      setCommandText('');\n      return;\n    }\n\n    try {\n      // Parse the DSL input\n      const ast = parse(trimmed);\n\n      if (ast && ast.type === 'filter') {\n        const filterNode = ast as FilterNode;\n        addFilter({\n          field: filterNode.field,\n          operator: filterNode.operator,\n          value: filterNode.value as string | number | boolean,\n        });\n        setCommandText('');\n      }\n    } catch (err: unknown) {\n      setError(err instanceof Error ? err.message : 'Invalid command');\n    }\n  };\n\n  return (\n    <div className={`h-10 flex items-center px-3 gap-3 ${\n      theme === 'NeXTSTEP'\n        ? 'bg-[#c0c0c0] border-t-2 border-[#e8e8e8]'\n        : 'bg-white/50 backdrop-blur-xl border-t border-gray-200'\n    }`}>\n      <button\n        onClick={clearFilters}\n        className={`w-8 h-8 rounded-full flex items-center justify-center ${\n          theme === 'NeXTSTEP'\n            ? 'bg-[#d4d4d4] border-t-2 border-l-2 border-[#ffffff] border-b-2 border-r-2 border-b-[#707070] border-r-[#707070]'\n            : 'bg-gray-100 hover:bg-gray-200'\n        }`}\n        title=\"Clear filters\"\n      >\n        <span className=\"text-lg leading-none\"></span>\n      </button>\n\n      <form onSubmit={handleCommandSubmit} className=\"flex-1 relative\">\n        <input\n          type=\"text\"\n          value={commandText}\n          onChange={(e) => { setCommandText(e.target.value); setError(null); }}\n          placeholder=\"Enter filter (e.g. status:active, category:extract)...\"\n          className={`w-full h-7 px-3 focus:outline-none ${\n            error\n              ? 'border-red-500 bg-red-50'\n              : theme === 'NeXTSTEP'\n                ? 'bg-white border-t-2 border-l-2 border-[#707070] border-b-2 border-r-2 border-b-[#e8e8e8] border-r-[#e8e8e8]'\n                : 'bg-white/80 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500'\n          }`}\n        />\n        {error && (\n          <div className=\"absolute top-full left-0 mt-1 text-xs text-red-500\">\n            {error}\n          </div>\n        )}\n      </form>\n    </div>\n  );\n}\n","import { Component, ReactNode, ErrorInfo } from 'react';\nimport { AlertTriangle, RefreshCw, Bug, ChevronDown, ChevronUp } from 'lucide-react';\n\n// Type definitions for global error reporting\ninterface ErrorReportingData {\n  error: Error;\n  errorInfo?: ErrorInfo;\n  level?: string;\n  name?: string;\n  retryCount: number;\n}\n\ninterface GlobalErrorReporting {\n  reportError: (data: ErrorReportingData) => void;\n}\n\ndeclare global {\n  interface Window {\n    errorReporting?: GlobalErrorReporting;\n  }\n}\n\ninterface ErrorBoundaryProps {\n  children: ReactNode;\n  fallback?: ReactNode;\n  level?: 'app' | 'feature' | 'component';\n  name?: string;\n  onError?: (error: Error, _errorInfo: ErrorInfo) => void;\n}\n\ninterface ErrorBoundaryState {\n  hasError: boolean;\n  error: Error | null;\n  errorInfo: ErrorInfo | null;\n  showDetails: boolean;\n  retryCount: number;\n}\n\nexport class ErrorBoundary extends Component<ErrorBoundaryProps, ErrorBoundaryState> {\n  constructor(props: ErrorBoundaryProps) {\n    super(props);\n    this.state = {\n      hasError: false,\n      error: null,\n      errorInfo: null,\n      showDetails: false,\n      retryCount: 0\n    };\n  }\n\n  static getDerivedStateFromError(error: Error): Partial<ErrorBoundaryState> {\n    return { hasError: true, error };\n  }\n\n  componentDidCatch(error: Error, errorInfo: ErrorInfo) {\n    this.setState({ errorInfo });\n\n    // Log error for debugging\n    console.error(`Error Boundary (${this.props.level || 'unknown'} level):`, {\n      name: this.props.name,\n      error: error.message,\n      stack: error.stack,\n      componentStack: errorInfo.componentStack,\n      retryCount: this.state.retryCount\n    });\n\n    // Report to external error tracking if configured\n    if (this.props.onError) {\n      this.props.onError(error, errorInfo);\n    }\n\n    // Report to global error service if available\n    if (typeof window !== 'undefined' && window.errorReporting) {\n      window.errorReporting.reportError({\n        error,\n        errorInfo,\n        level: this.props.level,\n        name: this.props.name,\n        retryCount: this.state.retryCount\n      });\n    }\n  }\n\n  handleRetry = () => {\n    this.setState(prevState => ({\n      hasError: false,\n      error: null,\n      errorInfo: null,\n      showDetails: false,\n      retryCount: prevState.retryCount + 1\n    }));\n  };\n\n  handleShowDetails = () => {\n    this.setState(prevState => ({ showDetails: !prevState.showDetails }));\n  };\n\n  getErrorSeverity = (): 'low' | 'medium' | 'high' => {\n    const { level } = this.props;\n    const { retryCount } = this.state;\n\n    if (level === 'app' || retryCount > 2) return 'high';\n    if (level === 'feature' || retryCount > 0) return 'medium';\n    return 'low';\n  };\n\n  getErrorMessage = (): string => {\n    const { error } = this.state;\n    // const { level, name } = this.props; // Level is assigned but not used in current implementation\n    const severity = this.getErrorSeverity();\n\n    if (severity === 'high') {\n      return 'A critical error occurred. Please refresh the page or contact support if the issue persists.';\n    }\n\n    if (severity === 'medium') {\n      return `An error occurred in ${name || 'this section'}. You can try again or continue using other parts of the app.`;\n    }\n\n    return error?.message || 'Something went wrong. Please try again.';\n  };\n\n  getActionableSteps = (): string[] => {\n    const severity = this.getErrorSeverity();\n    const steps: string[] = [];\n\n    if (severity === 'low') {\n      steps.push('Try the action again');\n      steps.push('Refresh this section');\n    } else if (severity === 'medium') {\n      steps.push('Try again in a few moments');\n      steps.push('Check your internet connection');\n      steps.push('Use other features while we investigate');\n    } else {\n      steps.push('Refresh the entire page');\n      steps.push('Clear browser cache and try again');\n      steps.push('Contact support if the problem persists');\n    }\n\n    return steps;\n  };\n\n  render() {\n    if (this.state.hasError) {\n      if (this.props.fallback) {\n        return this.props.fallback;\n      }\n\n      const severity = this.getErrorSeverity();\n      const message = this.getErrorMessage();\n      const steps = this.getActionableSteps();\n\n      const containerClasses = `p-6 m-4 rounded-lg border-2 ${\n        severity === 'high'\n          ? 'border-red-500 bg-red-50'\n          : severity === 'medium'\n          ? 'border-orange-500 bg-orange-50'\n          : 'border-yellow-500 bg-yellow-50'\n      }`;\n\n      const iconColor = severity === 'high' ? 'text-red-600' : severity === 'medium' ? 'text-orange-600' : 'text-yellow-600';\n\n      return (\n        <div className={containerClasses}>\n          <div className=\"flex items-start gap-3\">\n            <AlertTriangle className={`w-6 h-6 mt-0.5 flex-shrink-0 ${iconColor}`} />\n            <div className=\"flex-1\">\n              <div className=\"flex items-start justify-between\">\n                <div className=\"flex-1\">\n                  <h3 className={`font-semibold text-lg ${iconColor}`}>\n                    {severity === 'high' ? 'Critical Error' : severity === 'medium' ? 'Error Occurred' : 'Something Went Wrong'}\n                  </h3>\n                  <p className=\"mt-2 text-gray-700\">\n                    {message}\n                  </p>\n                </div>\n              </div>\n\n              {/* Actionable steps */}\n              <div className=\"mt-4\">\n                <p className=\"font-medium text-gray-800 mb-2\">What you can do:</p>\n                <ul className=\"list-disc list-inside space-y-1 text-sm text-gray-600\">\n                  {steps.map((step, index) => (\n                    <li key={index}>{step}</li>\n                  ))}\n                </ul>\n              </div>\n\n              {/* Action buttons */}\n              <div className=\"flex items-center gap-3 mt-4\">\n                <button\n                  onClick={this.handleRetry}\n                  className=\"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors\"\n                >\n                  <RefreshCw className=\"w-4 h-4\" />\n                  Try Again\n                </button>\n\n                <button\n                  onClick={this.handleShowDetails}\n                  className=\"flex items-center gap-2 px-4 py-2 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300 transition-colors\"\n                >\n                  <Bug className=\"w-4 h-4\" />\n                  {this.state.showDetails ? 'Hide' : 'Show'} Details\n                  {this.state.showDetails ? <ChevronUp className=\"w-4 h-4\" /> : <ChevronDown className=\"w-4 h-4\" />}\n                </button>\n              </div>\n\n              {/* Error details */}\n              {this.state.showDetails && this.state.error && (\n                <div className=\"mt-4 p-4 bg-gray-100 rounded-md\">\n                  <h4 className=\"font-medium text-gray-800 mb-2\">Technical Details:</h4>\n                  <div className=\"space-y-3\">\n                    <div>\n                      <p className=\"text-sm font-medium text-gray-700\">Error:</p>\n                      <code className=\"block text-xs bg-white p-2 rounded mt-1 text-red-600\">\n                        {this.state.error.message}\n                      </code>\n                    </div>\n                    {this.state.error.stack && (\n                      <div>\n                        <p className=\"text-sm font-medium text-gray-700\">Stack Trace:</p>\n                        <pre className=\"block text-xs bg-white p-2 rounded mt-1 overflow-x-auto max-h-32 text-gray-600\">\n                          {this.state.error.stack}\n                        </pre>\n                      </div>\n                    )}\n                    {this.state.errorInfo?.componentStack && (\n                      <div>\n                        <p className=\"text-sm font-medium text-gray-700\">Component Stack:</p>\n                        <pre className=\"block text-xs bg-white p-2 rounded mt-1 overflow-x-auto max-h-32 text-gray-600\">\n                          {this.state.errorInfo.componentStack}\n                        </pre>\n                      </div>\n                    )}\n                    <div className=\"text-xs text-gray-500 pt-2 border-t\">\n                      Retry count: {this.state.retryCount} |\n                      Level: {this.props.level || 'unknown'} |\n                      Component: {this.props.name || 'unnamed'}\n                    </div>\n                  </div>\n                </div>\n              )}\n            </div>\n          </div>\n        </div>\n      );\n    }\n\n    return this.props.children;\n  }\n}\n","import type { ErrorInfo } from 'react';\n\nexport interface ErrorReport {\n  id: string;\n  timestamp: string;\n  level: 'low' | 'medium' | 'high';\n  message: string;\n  stack?: string;\n  componentStack?: string;\n  errorBoundary?: {\n    name?: string;\n    level?: 'app' | 'feature' | 'component';\n    retryCount: number;\n  };\n  userAgent: string;\n  url: string;\n  userId?: string;\n  sessionId: string;\n  additionalContext?: Record<string, unknown>;\n}\n\nexport interface ErrorNotification {\n  id: string;\n  type: 'error' | 'warning' | 'info';\n  title: string;\n  message: string;\n  actions?: Array<{\n    label: string;\n    action: () => void;\n  }>;\n  autoHide?: boolean;\n  duration?: number;\n}\n\nclass ErrorReportingService {\n  private reports: ErrorReport[] = [];\n  private notifications: ErrorNotification[] = [];\n  private listeners: Array<(notifications: ErrorNotification[]) => void> = [];\n  private sessionId: string;\n  private maxReports = 100;\n  private errorHandler: (event: ErrorEvent) => void;\n  private unhandledRejectionHandler: (event: PromiseRejectionEvent) => void;\n\n  constructor() {\n    this.sessionId = this.generateSessionId();\n    this.setupGlobalErrorHandlers();\n  }\n\n  private generateSessionId(): string {\n    return `session_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n  }\n\n  private setupGlobalErrorHandlers(): void {\n    // Create bound handlers to enable cleanup\n    this.errorHandler = (event: ErrorEvent) => {\n      this.reportError({\n        error: event.error || new Error(event.message),\n        level: 'high',\n        additionalContext: {\n          filename: event.filename,\n          lineno: event.lineno,\n          colno: event.colno,\n          type: 'javascript'\n        }\n      });\n    };\n\n    this.unhandledRejectionHandler = (event: PromiseRejectionEvent) => {\n      this.reportError({\n        error: event.reason instanceof Error ? event.reason : new Error(String(event.reason)),\n        level: 'medium',\n        additionalContext: {\n          type: 'promise_rejection',\n          reason: event.reason\n        }\n      });\n    };\n\n    // Global unhandled errors\n    window.addEventListener('error', this.errorHandler);\n\n    // Unhandled promise rejections\n    window.addEventListener('unhandledrejection', this.unhandledRejectionHandler);\n\n    // Make service available globally for error boundaries\n    (window as unknown as { errorReporting: ErrorReportingService }).errorReporting = this;\n  }\n\n  public reportError(params: {\n    error: Error;\n    errorInfo?: ErrorInfo;\n    level?: 'app' | 'feature' | 'component';\n    name?: string;\n    retryCount?: number;\n    additionalContext?: Record<string, unknown>;\n  }): string {\n    const reportId = `error_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n\n    const severity = this.determineSeverity(params.error, params.level, params.retryCount);\n\n    const report: ErrorReport = {\n      id: reportId,\n      timestamp: new Date().toISOString(),\n      level: severity,\n      message: params.error.message,\n      stack: params.error.stack,\n      componentStack: params.errorInfo?.componentStack,\n      errorBoundary: params.level ? {\n        name: params.name,\n        level: params.level,\n        retryCount: params.retryCount || 0\n      } : undefined,\n      userAgent: navigator.userAgent,\n      url: window.location.href,\n      sessionId: this.sessionId,\n      additionalContext: params.additionalContext\n    };\n\n    // Store report\n    this.reports.unshift(report);\n    if (this.reports.length > this.maxReports) {\n      this.reports = this.reports.slice(0, this.maxReports);\n    }\n\n    // Log to console\n    console.error('Error reported:', report);\n\n    // Create user notification if appropriate\n    this.createErrorNotification(report);\n\n    return reportId;\n  }\n\n  private determineSeverity(\n    error: Error,\n    level?: 'app' | 'feature' | 'component',\n    retryCount = 0\n  ): 'low' | 'medium' | 'high' {\n    // High severity conditions\n    if (level === 'app') return 'high';\n    if (retryCount > 2) return 'high';\n    if (error.name === 'ChunkLoadError') return 'high'; // Bundle loading failures\n    if (error.message.includes('out of memory')) return 'high';\n\n    // Medium severity conditions\n    if (level === 'feature') return 'medium';\n    if (retryCount > 0) return 'medium';\n    if (error.name === 'NetworkError') return 'medium';\n    if (error.name === 'TypeError' && error.message.includes('fetch')) return 'medium';\n\n    // Default to low\n    return 'low';\n  }\n\n  private createErrorNotification(report: ErrorReport): void {\n    // Don't spam user with too many error notifications\n    if (this.notifications.filter(n => n.type === 'error').length >= 3) {\n      return;\n    }\n\n    const notification: ErrorNotification = {\n      id: `notif_${report.id}`,\n      type: 'error',\n      title: this.getNotificationTitle(report.level),\n      message: this.getNotificationMessage(report),\n      actions: this.getNotificationActions(report),\n      autoHide: report.level === 'low',\n      duration: report.level === 'low' ? 5000 : undefined\n    };\n\n    this.addNotification(notification);\n  }\n\n  private getNotificationTitle(level: 'low' | 'medium' | 'high'): string {\n    switch (level) {\n      case 'high': return 'Critical Error';\n      case 'medium': return 'Error Occurred';\n      case 'low': return 'Something Went Wrong';\n    }\n  }\n\n  private getNotificationMessage(report: ErrorReport): string {\n    if (report.level === 'high') {\n      return 'A critical error has occurred. Please refresh the page.';\n    }\n    if (report.level === 'medium') {\n      return 'An error occurred. Some features may not work properly.';\n    }\n    return 'A minor error occurred. You can continue using the app normally.';\n  }\n\n  private getNotificationActions(report: ErrorReport): Array<{ label: string; action: () => void }> {\n    const actions: Array<{ label: string; action: () => void }> = [];\n\n    if (report.level === 'high') {\n      actions.push({\n        label: 'Refresh Page',\n        action: () => window.location.reload()\n      });\n    } else {\n      actions.push({\n        label: 'Retry',\n        action: () => {\n          // This would need to be connected to the specific operation\n          // For now, just remove the notification\n          this.removeNotification(report.id);\n        }\n      });\n    }\n\n    actions.push({\n      label: 'Dismiss',\n      action: () => this.removeNotification(`notif_${report.id}`)\n    });\n\n    return actions;\n  }\n\n  public addNotification(notification: ErrorNotification): void {\n    this.notifications.unshift(notification);\n    this.notifyListeners();\n\n    if (notification.autoHide && notification.duration) {\n      setTimeout(() => {\n        this.removeNotification(notification.id);\n      }, notification.duration);\n    }\n  }\n\n  public removeNotification(id: string): void {\n    this.notifications = this.notifications.filter(n => n.id !== id);\n    this.notifyListeners();\n  }\n\n  public getNotifications(): ErrorNotification[] {\n    return [...this.notifications];\n  }\n\n  public onNotificationsChange(listener: (notifications: ErrorNotification[]) => void): () => void {\n    this.listeners.push(listener);\n    return () => {\n      this.listeners = this.listeners.filter(l => l !== listener);\n    };\n  }\n\n  private notifyListeners(): void {\n    const currentNotifications = [...this.notifications];\n    this.listeners.forEach(listener => listener(currentNotifications));\n  }\n\n  public getReports(limit?: number): ErrorReport[] {\n    return limit ? this.reports.slice(0, limit) : [...this.reports];\n  }\n\n  public clearReports(): void {\n    this.reports = [];\n  }\n\n  public getSessionInfo(): { sessionId: string; reportCount: number; highSeverityCount: number } {\n    return {\n      sessionId: this.sessionId,\n      reportCount: this.reports.length,\n      highSeverityCount: this.reports.filter(r => r.level === 'high').length\n    };\n  }\n\n  public destroy(): void {\n    // Remove global error handlers to prevent memory leaks\n    if (this.errorHandler) {\n      window.removeEventListener('error', this.errorHandler);\n    }\n    if (this.unhandledRejectionHandler) {\n      window.removeEventListener('unhandledrejection', this.unhandledRejectionHandler);\n    }\n\n    // Clear all data and listeners\n    this.reports = [];\n    this.notifications = [];\n    this.listeners = [];\n\n    // Remove global reference\n    interface WindowWithErrorReporting extends Window {\n      errorReporting?: ErrorReportingService;\n    }\n    delete (window as WindowWithErrorReporting).errorReporting;\n  }\n\n  // User feedback methods\n  public reportUserError(title: string, _message: string, actions?: Array<{ label: string; action: () => void }>): void {\n    const notification: ErrorNotification = {\n      id: `user_${Date.now()}`,\n      type: 'error',\n      title,\n      message,\n      actions: actions || [{\n        label: 'OK',\n        action: () => this.removeNotification(`user_${Date.now()}`)\n      }]\n    };\n\n    this.addNotification(notification);\n  }\n\n  public reportUserWarning(title: string, message: string): void {\n    const notification: ErrorNotification = {\n      id: `warning_${Date.now()}`,\n      type: 'warning',\n      title,\n      message,\n      autoHide: true,\n      duration: 4000\n    };\n\n    this.addNotification(notification);\n  }\n\n  public reportUserInfo(title: string, message: string): void {\n    const notification: ErrorNotification = {\n      id: `info_${Date.now()}`,\n      type: 'info',\n      title,\n      message,\n      autoHide: true,\n      duration: 3000\n    };\n\n    this.addNotification(notification);\n  }\n}\n\n// Create singleton instance\nexport const errorReporting = new ErrorReportingService();\n\n// Export hook for React components\nexport function useErrorReporting() {\n  return errorReporting;\n}","import { useState, useEffect } from 'react';\nimport { X, AlertTriangle, AlertCircle, Info, CheckCircle } from 'lucide-react';\nimport { useErrorReporting, type ErrorNotification } from '../../services/ErrorReportingService';\n\ninterface NotificationItemProps {\n  notification: ErrorNotification;\n  onRemove: (id: string) => void;\n}\n\nfunction NotificationItem({ notification, onRemove }: NotificationItemProps) {\n  const getIcon = () => {\n    switch (notification.type) {\n      case 'error':\n        return <AlertTriangle className=\"w-5 h-5 text-red-600\" />;\n      case 'warning':\n        return <AlertCircle className=\"w-5 h-5 text-orange-600\" />;\n      case 'info':\n        return <Info className=\"w-5 h-5 text-blue-600\" />;\n      default:\n        return <CheckCircle className=\"w-5 h-5 text-green-600\" />;\n    }\n  };\n\n  const getBackgroundColor = () => {\n    switch (notification.type) {\n      case 'error':\n        return 'bg-red-50 border-red-200';\n      case 'warning':\n        return 'bg-orange-50 border-orange-200';\n      case 'info':\n        return 'bg-blue-50 border-blue-200';\n      default:\n        return 'bg-green-50 border-green-200';\n    }\n  };\n\n  return (\n    <div className={`${getBackgroundColor()} border rounded-lg p-4 shadow-md max-w-md animate-slide-in`}>\n      <div className=\"flex items-start gap-3\">\n        <div className=\"flex-shrink-0\">\n          {getIcon()}\n        </div>\n        <div className=\"flex-1 min-w-0\">\n          <h4 className=\"font-medium text-gray-900 text-sm\">\n            {notification.title}\n          </h4>\n          <p className=\"mt-1 text-sm text-gray-600\">\n            {notification.message}\n          </p>\n          {notification.actions && notification.actions.length > 0 && (\n            <div className=\"mt-3 flex gap-2\">\n              {notification.actions.map((action, index) => (\n                <button\n                  key={index}\n                  onClick={action.action}\n                  className={`px-3 py-1 text-xs font-medium rounded transition-colors ${\n                    index === 0\n                      ? 'bg-gray-700 text-white hover:bg-gray-800'\n                      : 'bg-gray-200 text-gray-700 hover:bg-gray-300'\n                  }`}\n                >\n                  {action.label}\n                </button>\n              ))}\n            </div>\n          )}\n        </div>\n        <button\n          onClick={() => onRemove(notification.id)}\n          className=\"flex-shrink-0 p-1 text-gray-400 hover:text-gray-600 transition-colors\"\n          aria-label=\"Dismiss notification\"\n        >\n          <X className=\"w-4 h-4\" />\n        </button>\n      </div>\n    </div>\n  );\n}\n\nexport function NotificationSystem() {\n  const errorReporting = useErrorReporting();\n  const [notifications, setNotifications] = useState<ErrorNotification[]>([]);\n\n  useEffect(() => {\n    const unsubscribe = errorReporting.onNotificationsChange(setNotifications);\n    setNotifications(errorReporting.getNotifications());\n    return unsubscribe;\n  }, [errorReporting]);\n\n  const handleRemove = (id: string) => {\n    errorReporting.removeNotification(id);\n  };\n\n  if (notifications.length === 0) {\n    return null;\n  }\n\n  return (\n    <div className=\"fixed top-4 right-4 z-50 space-y-2\">\n      {notifications.map((notification) => (\n        <NotificationItem\n          key={notification.id}\n          notification={notification}\n          onRemove={handleRemove}\n        />\n      ))}\n    </div>\n  );\n}","import { BrowserRouter } from 'react-router-dom';\nimport { ThemeProvider } from '../contexts/ThemeContext';\nimport { EnvironmentProvider } from '../contexts/EnvironmentContext';\nimport { AppStateProvider } from '../contexts/AppStateContext';\nimport { FilterProvider } from '../contexts/FilterContext';\nimport { PAFVProvider } from '../contexts/PAFVContext';\n\n// Import all Figma components\nimport { Toolbar } from './Toolbar';\nimport { Navigator } from './Navigator';\nimport { PAFVNavigator } from './PAFVNavigator';\nimport { Sidebar } from './Sidebar';\nimport { RightSidebar } from './RightSidebar';\nimport { Canvas } from './Canvas';\nimport { NavigatorFooter } from './NavigatorFooter';\nimport { CommandBar } from './CommandBar';\nimport { ErrorBoundary } from './ui/ErrorBoundary';\nimport { NotificationSystem } from './ui/NotificationSystem';\n\n/**\n * Unified App Component\n *\n * Combines our working MVP Canvas with all Figma-designed UI components\n * following the architectural layout:\n *\n * - Toolbar (menu + commands)\n * - Navigator (app/view selectors)\n * - PAFVNavigator (axis wells)\n * - MainContent\n *   - Sidebar (LATCH filters)\n *   - Canvas (with MVP data visualization)\n *   - RightSidebar (formats/settings)\n * - NavigatorFooter (map + time)\n * - CommandBar (DSL input)\n */\nexport function UnifiedApp() {\n  return (\n    <BrowserRouter>\n      <ThemeProvider>\n        <EnvironmentProvider>\n          <AppStateProvider>\n            <FilterProvider>\n              <PAFVProvider>\n              <div className=\"h-screen flex flex-col bg-gray-50\">\n                {/* Toolbar: Menu bar + command buttons */}\n                <ErrorBoundary level=\"component\" name=\"Toolbar\">\n                  <Toolbar />\n                </ErrorBoundary>\n\n                {/* Navigator: App/View/Dataset selectors */}\n                <ErrorBoundary level=\"component\" name=\"Navigator\">\n                  <Navigator />\n                </ErrorBoundary>\n\n                {/* PAFVNavigator: Drag-drop axis assignment wells */}\n                <ErrorBoundary level=\"component\" name=\"PAFVNavigator\">\n                  <PAFVNavigator />\n                </ErrorBoundary>\n\n                {/* Main Content Area */}\n                <div className=\"flex-1 flex min-h-0\">\n                  {/* Left Sidebar: LATCH filters + Templates */}\n                  <ErrorBoundary level=\"feature\" name=\"Sidebar\">\n                    <Sidebar />\n                  </ErrorBoundary>\n\n                  {/* Central Canvas: Main data visualization */}\n                  <div className=\"flex-1 flex flex-col\">\n                    <ErrorBoundary level=\"feature\" name=\"Canvas\">\n                      <Canvas />\n                    </ErrorBoundary>\n                  </div>\n\n                  {/* Right Sidebar: Formats + Settings */}\n                  <ErrorBoundary level=\"feature\" name=\"RightSidebar\">\n                    <RightSidebar />\n                  </ErrorBoundary>\n                </div>\n\n                {/* Navigator Footer: Location map + Time slider */}\n                <ErrorBoundary level=\"component\" name=\"NavigatorFooter\">\n                  <NavigatorFooter />\n                </ErrorBoundary>\n\n                {/* Command Bar: DSL command input */}\n                <ErrorBoundary level=\"feature\" name=\"CommandBar\">\n                  <CommandBar />\n                </ErrorBoundary>\n              </div>\n              <NotificationSystem />\n              </PAFVProvider>\n            </FilterProvider>\n          </AppStateProvider>\n        </EnvironmentProvider>\n      </ThemeProvider>\n    </BrowserRouter>\n  );\n}","import { useState } from 'react';\nimport { BrowserRouter } from 'react-router-dom';\nimport { ThemeProvider } from './contexts/ThemeContext';\nimport { AppStateProvider } from './contexts/AppStateContext';\nimport { FilterProvider } from './contexts/FilterContext';\nimport { PAFVProvider } from './contexts/PAFVContext';\nimport { Canvas } from './components/Canvas';\nimport { UnifiedApp } from './components/UnifiedApp';\nimport { ErrorBoundary } from './components/ui/ErrorBoundary';\nimport { NotificationSystem } from './components/ui/NotificationSystem';\n\n/**\n * Minimal MVP Demo - bypasses all complex dependencies\n * Just shows Canvas with mock data to prove visualization works\n * Now includes access to UnifiedApp for testing UI/UX integration\n */\nfunction MVPDemo() {\n  const [showUnified, setShowUnified] = useState(false);\n\n  if (showUnified) {\n    return (\n      <ErrorBoundary level=\"app\" name=\"UnifiedApp\">\n        <UnifiedApp />\n        <NotificationSystem />\n      </ErrorBoundary>\n    );\n  }\n\n  return (\n    <ErrorBoundary level=\"app\" name=\"MVPDemo\">\n      <BrowserRouter>\n        <ThemeProvider>\n          <AppStateProvider>\n            <FilterProvider>\n              <PAFVProvider>\n                <div className=\"h-screen bg-gray-50\">\n                  <div className=\"p-4\">\n                    <div className=\"flex justify-between items-center mb-4\">\n                      <div>\n                        <h1 className=\"text-2xl font-bold mb-2\">Isometry MVP Demo</h1>\n                        <p className=\"text-gray-600\">Canvas with mock data - no database dependencies</p>\n                      </div>\n                      <button\n                        onClick={() => setShowUnified(true)}\n                        className=\"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 transition-colors\"\n                      >\n                        Test Unified UI\n                      </button>\n                    </div>\n                  </div>\n                  <ErrorBoundary level=\"feature\" name=\"Canvas\">\n                    <div className=\"h-[calc(100vh-120px)]\">\n                      <Canvas />\n                    </div>\n                  </ErrorBoundary>\n                </div>\n                <NotificationSystem />\n              </PAFVProvider>\n            </FilterProvider>\n          </AppStateProvider>\n        </ThemeProvider>\n      </BrowserRouter>\n    </ErrorBoundary>\n  );\n}\n\nexport default MVPDemo;","import MVPDemo from './MVPDemo';\n\nfunction App() {\n  // GSD: Use working MVP demo with UnifiedApp accessible via \"Unified\" button\n  // This provides clean testing environment without complex context dependencies\n  return <MVPDemo />;\n}\n\n// Original complex App implementation moved to separate file for future restoration\n// See docs/specs/app-architecture.md for complete component hierarchy\n\nexport default App;","import React from 'react';\nimport ReactDOM from 'react-dom/client';\nimport App from './App';\nimport './index.css';\n\nReactDOM.createRoot(document.getElementById('root')!).render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>\n);\n"],"names":["m","require$$0","client","createRoot","hydrateRoot","_extends","Object","assign","bind","target","i","arguments","length","source","key","prototype","hasOwnProperty","call","apply","this","Action","PopStateEventType","createBrowserHistory","options","getLocation","createHref","validateLocation","window","document","defaultView","v5Compat","globalHistory","history","action","Pop","listener","index","getIndex","replaceState","state","idx","handlePop","nextIndex","delta","location","push","to","Push","createLocation","historyState","getHistoryState","url","pushState","error","DOMException","name","replace","Replace","createURL","base","origin","href","createPath","invariant","URL","listen","fn","Error","addEventListener","removeEventListener","encodeLocation","pathname","search","hash","go","n","getUrlBasedHistory","usr","value","message","current","parsePath","Math","random","toString","substr","_ref","charAt","path","parsedPath","hashIndex","indexOf","searchIndex","ResultType","ABSOLUTE_URL_REGEX$1","resolvePath","fromPathname","toPathname","test","includes","oldPathname","cond","console","warn","e","warning","startsWith","resolvePathname","substring","normalizeSearch","normalizeHash","relativePath","segments","split","forEach","segment","pop","join","getInvalidPathError","char","field","dest","JSON","stringify","validMutationMethodsArr","Set","validRequestMethodsArr","DataRouterContext","React.createContext","NavigationContext","LocationContext","RouteContext","outlet","matches","isDataRoute","useInRouterContext","React.useContext","useLocation","UNSAFE_invariant","useIsomorphicLayoutEffect","cb","static","React.useLayoutEffect","useNavigate","router","ctx","useDataRouterContext","DataRouterHook","UseNavigateStable","id","route","useRouteContext","thisRoute","useCurrentRouteId","DataRouterStateHook","activeRef","React.useRef","React.useCallback","navigate","fromRouteId","useNavigateStable","dataRouterContext","basename","future","navigator","locationPathname","routePathnamesJson","v7_relativeSplatPath","pathMatches","filter","match","getPathContributingMatches","map","pathnameBase","UNSAFE_getResolveToMatches","toArg","routePathnames","isPathRelative","from","isEmptyPath","routePathnameIndex","toSegments","shift","hasExplicitTrailingSlash","endsWith","hasCurrentTrailingSlash","resolveTo","parse","relative","useNavigateUnstable","Router","_ref5","basenameProp","children","locationProp","navigationType","staticProp","navigationContext","React.useMemo","locationContext","trailingPathname","toLowerCase","startIndex","nextChar","slice","stripBasename","React.createElement","Provider","createSearchParams","init","URLSearchParams","Array","isArray","keys","reduce","memo","concat","v","Promise","__reactRouterVersion","startTransitionImpl","React","BrowserRouter","_ref4","historyRef","setStateImpl","React.useState","v7_startTransition","setState","newState","React.useEffect","UNSAFE_logV6DeprecationWarnings","renderFuture","useSearchParams","defaultInit","defaultSearchParamsRef","hasSetSearchParamsRef","searchParams","locationSearch","defaultSearchParams","_","has","getAll","append","setSearchParams","nextInit","navigateOptions","newSearchParams","ThemeContext","createContext","ThemeProvider","defaultTheme","theme","setTheme","useState","jsx","useTheme","context","useContext","useURLState","defaultValue","serialize","deserialize","urlValue","get","setValueInternal","setValue","useCallback","newValue","prev","next","serialized","delete","set","useEffect","currentUrlValue","deserialized","AppStateContext","AppStateProvider","activeApp","setActiveApp","s","activeView","setActiveView","activeDataset","setActiveDataset","useAppState","SQL_INJECTION_PATTERNS","XSS_PATTERNS","sanitizeString","input","errors","warnings","sanitized","isValid","String","maxLength","allowedCharacters","escapeSQL","some","pattern","stripHTML","originalLength","normalizeWhitespace","original","trim","allowedValues","sanitizedValue","sanitizeDSLValue","num","Number","isNaN","isFinite","integer","isInteger","round","min","max","sanitizeNumber","preset","presetValidation","sanitizeFieldName","fieldName","isSecurityRisk","result","compile","ast","sql","params","compileTimePreset","fieldValidation","safeField","compileNode","node","type","operator","operatorValidation","sanitizeOperator","safeOperator","valueValidation","safeValue","compileFilter","axis","rangeParts","start","end","compileAxisFilter","left","right","operand","expression","FilterContext","FilterProvider","filters","setFilters","addFilter","removeFilter","clearFilters","compiledQuery","useMemo","nodes","f","filtersToAST","useFilters","PAFVContext","DEFAULT_WELLS","available","rows","label","columns","zLayers","hasCheckbox","checked","PAFVProvider","wells","setWells","moveChip","fromWell","fromIndex","toWell","toIndex","newWells","movedChip","splice","toggleCheckbox","well","_chipId","chip","chipId","transpose","usePAFV","MOCK_NODES","content","folder","status","priority","createdAt","modifiedAt","deletedAt","useMockData","loading","setLoading","timer","setTimeout","clearTimeout","data","t","r","_assertThisInitialized","ReferenceError","_setPrototypeOf","setPrototypeOf","__proto__","safeIsNaN","isEqual","first","second","areInputsEqual","newInputs","lastInputs","memoizeOne","resultFn","lastThis","lastResult","lastArgs","calledOnce","newArgs","_i","now","performance","Date","cancelTimeout","timeoutID","cancelAnimationFrame","size","getScrollbarSize","recalculate","div","createElement","style","width","height","overflow","body","appendChild","offsetWidth","clientWidth","removeChild","cachedRTLResult","getRTLOffsetType","outerDiv","outerStyle","direction","innerDiv","innerStyle","scrollLeft","defaultItemKey$1","createListComponent","_class","getItemOffset","getEstimatedTotalSize","getItemSize","getOffsetForIndexAndAlignment","getStartIndexForOffset","getStopIndexForStartIndex","initInstanceProps","shouldResetStyleCacheOnItemSizeChange","validateProps","_PureComponent","o","List","props","_this","_instanceProps","_outerRef","_resetIsScrollingTimeoutId","instance","isScrolling","scrollDirection","scrollOffset","initialScrollOffset","scrollUpdateWasRequested","_callOnItemsRendered","overscanStartIndex","overscanStopIndex","visibleStartIndex","visibleStopIndex","onItemsRendered","_callOnScroll","onScroll","_getItemStyle","_this$props","itemSize","layout","itemStyleCache","_getItemStyleCache","_offset","isHorizontal","isRtl","offsetHorizontal","position","top","__","___","_onScrollHorizontal","event","_event$currentTarget","currentTarget","scrollWidth","prevState","_resetIsScrollingDebounced","_onScrollVertical","_event$currentTarget2","clientHeight","scrollHeight","scrollTop","_outerRefSetter","ref","outerRef","callback","delay","_resetIsScrolling","requestAnimationFrame","tick","create","constructor","getDerivedStateFromProps","nextProps","validateSharedProps$1","_proto","scrollTo","scrollToItem","align","_this$props2","itemCount","scrollbarSize","componentDidMount","_this$props3","_callPropsCallbacks","componentDidUpdate","_this$props4","_this$state","componentWillUnmount","render","_this$props5","className","innerRef","innerElementType","innerTagName","itemData","_this$props5$itemKey","itemKey","outerElementType","outerTagName","useIsScrolling","_this$_getRangeToRend","_getRangeToRender","stopIndex","items","_index","estimatedTotalSize","WebkitOverflowScrolling","willChange","pointerEvents","_this$_getRangeToRend2","_overscanStartIndex","_overscanStopIndex","_visibleStartIndex","_visibleStopIndex","_this$state2","_scrollDirection","_scrollOffset","_scrollUpdateWasRequested","_this$props6","overscanCount","_this$state3","overscanBackward","overscanForward","PureComponent","defaultProps","_ref2","_ref3","getItemMetadata$1","instanceProps","itemMetadataMap","lastMeasuredIndex","offset","itemMetadata","findNearestItemBinarySearch$1","high","low","middle","floor","currentOffset","findNearestItemExponentialSearch$1","interval","estimatedItemSize","totalSizeOfMeasuredItems","VariableSizeList","maxOffset","minOffset","findNearestItem$1","resetAfterIndex","shouldForceUpdate","forceUpdate","NativeDatabaseContext","useNativeDatabase","byteToHex","getRandomValues","rnds8","Uint8Array","rng","crypto","native","randomUUID","v4","buf","rnds","arr","unsafeStringify","logger","config","entries","level","getDefaultLevel","enableConsole","enablePersistence","maxEntries","categories","process","shouldLog","category","createEntry","timestamp","toISOString","logEntry","entry","unshift","prefix","info","log","debug","trace","setLevel","setCategories","enabled","getEntries","count","clearEntries","getConfig","bridgeLogger","msg","err","webViewBridge","pendingRequests","Map","messageQueue","isConnected","connectionCheckInterval","cleanupInterval","failureCount","lastConnectionTest","circuitBreakerOpen","DEFAULT_TIMEOUT","MAX_RETRIES","RETRY_DELAY","CONNECTION_CHECK_INTERVAL","CIRCUIT_BREAKER_THRESHOLD","CIRCUIT_BREAKER_RESET_TIME","MESSAGE_QUEUE_MAX_SIZE","resolveWebViewRequest","handleResponse","isWebViewEnvironment","_isometryBridge","originalHandler","response","handleResponseInternal","setInterval","cleanupTimedOutRequests","startConnectionMonitoring","testConnection","then","connected","processMessageQueue","generateRequestId","uuidv4","registerCallback","resolve","reject","timeout","timeoutHandle","retryCount","requestId","postMessage","handler","method","retries","queueMessage","sendMessageImmediate","handleSendFailure","success","pending","handleResponseError","isRetriableError","errorObj","request","getHealthStatus","environment","getEnvironment","legacyCleanup","clear","webkit","messageHandlers","isHandlerAvailable","isNative","platform","version","transport","sendMessage","database","execute","async","getNodes","createNode","updateNode","deleteNode","query","getGraph","reset","filesystem","readFile","writeFile","deleteFile","listFiles","fileExists","exists","waitForReady","clearInterval","testMessage","removed","messagesToSend","_retries","pow","jitter","catch","newId","cleanup","Environment","isWebView","isBrowser","getTransport","WebViewDatabaseContext","DatabaseMode","EnvironmentContext","EnvironmentProvider","forcedMode","enableAutoDetection","setEnvironment","mode","capabilities","getCapabilities","performanceProfile","isLoading","setIsLoading","setError","testWebViewBridge","testHTTPAPIConnection","baseURL","define_process_env_default","REACT_APP_API_URL","fetch","ok","canReadFiles","canWriteFiles","hasRealTimeSync","supportsOffline","hasNativeExport","hasCloudSync","getPerformanceProfile","createEnvironmentInfo","envInfo","initializeEnvironment","detectedMode","detectEnvironment","errorMessage","contextValue","forceMode","refreshEnvironment","useDatabase","useEnvironment","WEBVIEW_BRIDGE","useWebViewDatabase","HTTP_API","rowToNode","row","nodeType","node_type","summary","latitude","longitude","locationName","location_name","locationAddress","location_address","created_at","modified_at","dueAt","due_at","completedAt","completed_at","eventStart","event_start","eventEnd","event_end","tags","importance","sortOrder","sort_order","sourceId","source_id","sourceUrl","source_url","deleted_at","QueryOptimizer","patterns","performanceThresholds","maxSimpleRows","maxComplexityScore","minConfidence","initializePatterns","analyzeQuery","normalizedSQL","complexity","regex","confidence","calculateConfidence","extractPatternDetails","hasJoins","hasFTS","hasSubqueries","hasWindow","hasRecursive","estimatedRows","estimateResultSize","canOptimize","shouldOptimize","analysis","bestPattern","best","translateToEndpoint","buildNodesEndpoint","buildNotebookCardsEndpoint","buildSearchEndpoint","buildInsertEndpoint","buildUpdateEndpoint","buildDeleteEndpoint","fallbackToSQL","details","tableMatch","table","orderMatch","orderBy","limitMatch","limit","parseInt","calculateComplexityScore","score","_params","queryParams","expectedFormat","extractInsertData","extractIdFromParams","extractUpdateData","fromEntries","param","CacheInvalidationContext","useQueryCacheRegistration","_refetch","register","useCacheInvalidation","currentRefetch","useRef","refetch","cleanupRef","lastTagsRef","stableRefetch","tagsKey","sort","CacheTags","useSQLiteQuery","dbLoading","dbError","transform","cacheTags","setData","optimized","setOptimized","duration","setDuration","transformRef","paramsKey","fetchData","startTime","wasOptimized","queryDuration","nodeTransform","useFilteredNodes","activeFilters","whereClause","conditions","filterParams","op","useNodes","useListData","groupingEnabled","yMapping","mappings","find","plane","sortAxis","sortFacet","facet","sortedNodes","sorted","a","b","yearA","getFullYear","dateA","getTime","localeCompare","tagA","tagB","groups","groupMap","groupKey","date","getMonth","padStart","toUpperCase","flatNodes","isGrouped","SelectionContext","ListItem","onClick","isSelected","handleClick","bodySnippet","createdDate","toLocaleDateString","year","month","day","jsxs","role","tabIndex","onKeyDown","preventDefault","Calendar","Folder","Tag","ListView","externalData","onNodeClick","selection","select","useSelection","listRef","searchQuery","setSearchQuery","sortAscending","setSortAscending","setGroupingEnabled","hookData","listData","filteredNodes","tag","reverse","listItems","group","groupNodes","handleItemClick","Search","onChange","placeholder","X","ArrowUpDown","innerHeight","item","selectedIds","FIELD_MAP","subfolder","getFieldValue","toLocaleString","getCompositeKey","chips","buildHeaderTree","depth","span","root","valuePaths","values","pathStr","child","c","calcSpan","sum","sortChildren","getLeafPaths","leaves","traverse","flattenForGrid","maxDepth","levels","d","startCol","currentCol","GridView","colChips","rowChips","colLeafPaths","rowLeafPaths","grouped","colLevels","rowLevels","colTree","rowTree","colLeaves","rowLeaves","colLvls","rowLvls","numColHeaders","numRowHeaders","numDataCols","numDataRows","headerBg","headerBorder","cellBorder","totalRowHeaderWidth","gridTemplateColumns","gridTemplateRows","minWidth","gridColumn","gridRow","levelIdx","header","title","colPath","colIdx","rowPath","rowIdx","colKey","rowKey","STATUS_ORDER","KanbanView","groupBy","containerRef","cols","ai","bi","container","d3.select","colWidth","columnsSelection","selectAll","enter","attr","el","transition","update","exit","remove","each","columnKey","column","html","nodeElements","on","_event","nodeEl","text","footer","TimelineView","dateField","svgRef","timelineData","margin","svg","dates","xScale","d3.scaleTime","domain","d3.min","d3.max","range","nice","yScale","d3.scaleBand","padding","colorScale","d3.scaleOrdinal","d3.schemeTableau10","g","zoom","d3.zoom","scaleExtent","newXScale","rescaleX","xAxisG","d3.axisBottom","tickFormat","d3.timeFormat","cards","bandwidth","yAxisG","d3.axisLeft","stopPropagation","tooltip","dateStr","offsetX","offsetY","classed","CalendarView","currentMonth","setCurrentMonth","nodesByDate","dateValue","calendarDays","firstDay","lastDay","startDayOfWeek","getDay","days","isCurrentMonth","getDate","remaining","folders","Boolean","cellWidth","cellHeight","cells","col","dateKey","dayNodes","cell","maxVisible","visibleNodes","hiddenCount","monthName","ChevronLeft","ChevronRight","THEMES","NeXTSTEP","bg","primary","secondary","tertiary","dark","light","raised","sunken","border","medium","outline","separator","disabled","inverse","chart","palette","axisText","grid","stroke","radius","Modern","blur","getTheme","themeName","createColorScale","themeValues","scale","styleAxis","axisGroup","textRotation","textAnchor","setupHoverEffect","hoverOpacity","normalOpacity","ChartsView","panelTheme","section","divider","usePanelTheme","inputTheme","checkbox","useInputTheme","textTheme","muted","useTextTheme","chartType","setChartType","setGroupBy","groupedData","bottom","innerWidth","d3.scaleLinear","ticks","bars","renderBarChart","pie","d3.pie","arc","d3.arc","innerRadius","outerRadius","outerArc","x","y","centroid","dist","angle","atan2","cos","sin","startAngle","endAngle","PI","total","renderPieChart","d3.hierarchy","d3.treemap","treemap","x0","y0","rects","x1","y1","w","renderTreemap","NetworkView","canvasTheme","emptyState","useCanvasTheme","selectedNode","setSelectedNode","edges","nodeMap","links","target_id","weight","simulation","d3.forceSimulation","force","d3.forceLink","distance","strength","d3.forceManyBody","d3.forceCenter","d3.forceCollide","translateExtent","onZoom","setupZoom","link","sqrt","linkLabels","l","d3.drag","_d","active","alphaTarget","restart","fx","fy","nodeData","stop","TreeView","treeRoots","roots","_node","treeNode","buildTree","rootData","treeData","d3.tree","treeLayout","d3.zoomIdentity","translate","d3.linkHorizontal","descendants","extractFieldValue","inferScaleType","extractDomain","uniqueValues","createScale","scaleType","temporalDomain","d3.extent","numericalDomain","ordinalDomain","d3.range","categoricalDomain","createHierarchicalScales","systemConfig","composite","totalHeight","totalWidth","d3Scale","headerHeights","rangeSplit","levelRange","compositeKeys","compositeKey","add","createCompositeKey","extractFieldValueAsString","PerformanceMonitor$1","startTimes","durations","operation","getDuration","getMetrics","dataTransform","scaleGeneration","layoutCalculation","renderPrep","totalPipeline","getMemoryUsage","memory","usedJSHeapSize","generateScales","viewport","dataWidth","dataHeight","color","d3.schemeCategory10","nodeCountExtent","d3.group","clamp","createScaleSystem","useD3Canvas","_containerRef","dataError","monitorRef","PerformanceMonitor","canvasState","setCanvasState","rawData","rowKeys","colKeys","rowDomains","colDomains","scaleSystem","renderCommands","headers","memoryUsage","nodeCount","cellCount","prevStateRef","detectChanges","newNodes","pafv","updateViewport","newViewport","processDataPipeline","inputNodes","inputWells","monitor","cellKey","bounds","isEmpty","transformPAFVData","positionedData","updatedCells","calculateLayout","fill","strokeWidth","opacity","prepareRenderCommands","changes","CanvasElement","configure","ObjectPool","createFn","resetFn","initialSize","acquire","release","element","spatialIndex","dirty","insert","findIndex","rebuild","queryBounds","findAtPoint","getStats","transitionManager","activeTransitions","animationFrame","startValues","endValues","currentValues","ensureAnimationLoop","isActive","getCurrentValues","completedTransitions","elapsed","progress","easedProgress","easing","onUpdate","onComplete","hasAnimationFrame","performanceMonitor","metrics","frameTimeHistory","lastFrameTime","maxHistorySize","startMetric","samples","lastUpdated","endMetric","metric","recordFrameTime","frameTime","getFPS","averageFrameTime","time","getMetricStats","average","val","latest","getAllStats","stats","fps","frameHistory","used","totalJSHeapSize","percentage","PerformanceOverlay","frameRate","renderStats","spatialStats","transitionStats","toFixed","CanvasRenderer","clearRect","drawCell","save","globalAlpha","fillStyle","fillRect","strokeStyle","lineWidth","strokeRect","font","textAlign","textBaseline","fillText","restore","drawText","baseline","maxWidth","D3Canvas","onCellClick","onError","showPerformanceOverlay","canvasRef","overlayRef","interactionState","setInteractionState","hoveredCell","selectedCells","isDragging","dragStart","setFrameRate","setViewport","handleResize","contentRect","setAttribute","observer","ResizeObserver","observe","disconnect","debouncedRender","timeoutId","args","debounce","canvas","getContext","measurePerformance","renderer","cellCommand","svgSelection","colHeaders","colHeaderHeight","rowHeaders","rowHeaderWidth","renderSVGHeaders","handleMouseMove","rect","getBoundingClientRect","clientX","clientY","hitItem","cursor","cellData","newSelected","zIndex","onMouseMove","D3GridView","_data","cellDetailOverlay","setCellDetailOverlay","visible","zoomTransform","handleCellClick","handleError","handleOverlayClick","axisSummary","scaleBy","D3ListView","listState","setListState","sortDirection","collapsedGroups","selectedItems","hoveredItem","setScrollTop","containerHeight","setContainerHeight","animating","setAnimating","collapsed","firstRowChip","groupValue","aTime","bTime","filteredGroups","globalIndex","isGroupHeader","groupLabel","groupCount","isVisible","visibleItems","startY","endY","currentY","itemHeight","handleSearch","clearSearch","toggleSort","toggleGrouping","toggleGroupCollapse","newCollapsed","handleScroll","resizeObserver","itemGroups","groupHeaders","GROUP_HEADER_HEIGHT","regularItems","ITEM_HEIGHT","FILTER_FIELDS","OPERATORS","FilterBar","isAdding","setIsAdding","newFilter","setNewFilter","chipClass","buttonClass","inputClass","Canvas","activeTab","setActiveTab","useD3Mode","setUseD3Mode","handleNodeClick","tab","sizeStyles","sm","md","lg","iconSizeStyles","nextStepVariants","default","ghost","modernVariants","IconButton","forwardRef","icon","variant","effectiveVariant","variantStyles","textColor","Toolbar","openMenu","setOpenMenu","menuSections","_action","submenu","commandButtons","FileText","_label","FolderOpen","Save","Download","appLauncherButtons","LayoutGrid","Layers","BarChart3","button","displayName","DndContext","dragDropManager","undefined","formatProdErrorMessage","code","$$observable","Symbol","observable","randomString","ActionTypes","INIT","REPLACE","createStore","reducer","preloadedState","enhancer","currentReducer","currentState","currentListeners","nextListeners","isDispatching","ensureCanMutateNextListeners","getState","subscribe","isSubscribed","dispatch","obj","proto","getPrototypeOf","isPlainObject","listeners","replaceReducer","nextReducer","outerSubscribe","observeState","unsubscribe","condition","format","argIndex","framesToPop","isObject","INIT_COORDS","BEGIN_DRAG","PUBLISH_DRAG_SOURCE","HOVER","DROP","END_DRAG","setClientOffset","clientOffset","sourceClientOffset","payload","ResetCoordinatesAction","createBeginDrag","manager","sourceIds","publishSource","getSourceClientOffset","getMonitor","registry","getRegistry","getSource","verifyInvariants","canDragSource","getDraggableSource","verifyGetSourceClientOffsetIsFunction","beginDrag","verifyItemIsObject","pinSource","itemType","getSourceType","isSourcePublic","_defineProperty","defineProperty","enumerable","configurable","writable","_objectSpread","ownKeys","getOwnPropertySymbols","sym","getOwnPropertyDescriptor","createDrop","didDrop","targetIds","getTargetIds","canDropOnTarget","getDroppableTargets","targetId","dropResult","getTarget","drop","verifyDropResultType","getDropResult","determineDropResult","createEndDrag","verifyIsDragging","getSourceId","endDrag","unpinSource","matchesType","targetType","draggedItemType","createHover","targetIdsArg","verifyTargetIdsIsArray","getTargetType","removeNonMatchingTargetIds","getItemType","lastIndexOf","checkInvariants","hover","hoverAllTargets","createPublishDragSource","DragDropManagerImpl","receiveBackend","backend","getBackend","getActions","store","actions","publishDragSource","createDragDropActions","boundActions","actionCreator","isSetUp","handleRefCountChange","shouldSetUp","refCount","setup","teardown","subtract","NONE","ALL","__IS_NONE__","__IS_ALL__","DragDropMonitorImpl","subscribeToStateChange","handlerIds","prevStateId","stateId","currentStateId","canSkipListener","dirtyIds","itemsB","areDirty","dirtyHandlerIds","subscribeToOffsetChange","previousState","dragOffset","nextState","canDrag","canDrop","isDraggingSource","isOverTarget","shallow","dragOperation","getItem","getInitialClientOffset","initialClientOffset","getInitialSourceClientOffset","initialSourceClientOffset","getClientOffset","getDifferenceFromInitialOffset","scope","global","self","BrowserMutationObserver","MutationObserver","WebKitMutationObserver","makeRequestCallFromTimer","handleTimer","intervalHandle","makeRequestCall","toggle","createTextNode","characterData","RawTask","task","asapQueue","enqueueTask","queue","q","requestFlush","flushing","pendingErrors","capacity","flush","currentIndex","scan","newLength","registerPendingError","requestErrorThrow","taskFactory","tasks","freeTasks","t1","ADD_SOURCE","ADD_TARGET","REMOVE_SOURCE","REMOVE_TARGET","validateType","allowArray","HandlerRole","nextUniqueId","getNextHandlerId","SOURCE","TARGET","parseRoleFromHandlerId","handlerId","mapContainsValue","searchValue","isDone","done","HandlerRegistryImpl","addSource","validateSourceContract","addHandler","addTarget","validateTargetContract","containsHandler","dragSources","dropTargets","includePinned","isSourceId","pinnedSourceId","pinnedSource","isTargetId","types","removeSource","removeTarget","strictEquality","_state","prevTargetIds","itemsA","insertItem","xor","didChange","areArraysEqual","prevInnermostTargetId","innermostTargetId","initialState","offsetA","offsetB","createDragDropManager","backendFactory","globalContext","backendOptions","debugMode","reduxDevTools","__REDUX_DEVTOOLS_EXTENSION__","instanceId","makeStoreInstance","_objectWithoutProperties","excluded","sourceKeys","_objectWithoutPropertiesLoose","sourceSymbolKeys","propertyIsEnumerable","INSTANCE_SYM","for","DndProvider","_param","isGlobalInstance","getGlobalContext","createSingletonDndContext","getDndContextValue","_jsx","fastDeepEqual","equal","RegExp","flags","valueOf","useLayoutEffect","useMonitorOutput","collect","onCollect","collected","updateCollected","setCollected","nextValue","useCollector","getHandlerId","useCollectedProps","collector","connector","reconnect","useOptionalFactory","arg","deps","memoDeps","useConnectDragSource","hooks","dragSource","useConnectDragPreview","dragPreview","isCallingCanDrag","isCallingIsDragging","DragSourceMonitorImpl","receiveHandlerId","internalMonitor","isCallingCanDrop","DropTargetMonitorImpl","isOver","shallowEqual","objA","objB","compare","compareContext","compareResult","keysA","keysB","bHasOwnProperty","valueA","valueB","isRef","wrapHookToRecognizeElement","hook","elementOrNode","isValidElement","throwIfCompositeComponentElement","newRef","previousRef","cloneElement","setRef","cloneWithRef","wrapConnectorHooks","wrappedHooks","wrappedHook","SourceConnector","newHandlerId","connectTarget","dragSourceOptions","dragSourceOptionsInternal","dragPreviewOptions","dragPreviewOptionsInternal","reconnectDragSource","reconnectDragPreview","didHandlerIdChange","didConnectedDragSourceChange","didDragSourceOptionsChange","disconnectDragSource","lastConnectedHandlerId","lastConnectedDragSource","lastConnectedDragSourceOptions","dragSourceUnsubscribe","connectDragSource","forceDidChange","didConnectedDragPreviewChange","didDragPreviewOptionsChange","disconnectDragPreview","lastConnectedDragPreview","lastConnectedDragPreviewOptions","dragPreviewUnsubscribe","connectDragPreview","dragPreviewNode","dragPreviewRef","dragSourceNode","dragSourceRef","clearDragSource","clearDragPreview","TargetConnector","dropTarget","didDropTargetChange","didOptionsChange","disconnectDropTarget","lastConnectedDropTarget","lastConnectedDropTargetOptions","dropTargetOptions","unsubscribeDropTarget","connectDropTarget","dropTargetOptionsInternal","dropTargetNode","dropTargetRef","clearDropTarget","useDragDropManager","DragSourceImpl","spec","globalMonitor","useRegisteredDragSource","useDragSource","useDragType","unregister","registerSource","useDrag","specArg","begin","useDragSourceMonitor","useDragSourceConnector","previewOptions","useConnectDropTarget","DropTargetImpl","useRegisteredDropTarget","useDropTarget","accept","useAccept","registerTarget","useDrop","useDropTargetMonitor","useDropTargetConnector","memoize","EnterLeaveCounter","enteringNode","previousLength","entered","union","isNodeInDocument","contains","leave","leavingNode","NativeDragSource","initializeExposedProperties","exposeProperties","property","loadDataTransfer","dataTransfer","newProperties","propertyFn","matchesTypes","defineProperties","handle","FILE","TEXT","HTML","getDataFromDataTransfer","typesToTry","resultSoFar","typeToTry","getData","nativeTypesConfig","NativeTypes.FILE","files","NativeTypes.HTML","URL$1","NativeTypes.URL","urls","NativeTypes.TEXT","matchNativeItemType","dataTransferTypes","nativeItemType","typeConfig","isFirefox","userAgent","isSafari","safari","MonotonicInterpolant","interpolate","xs","ys","c1s","c2s","c3s","mid","xHere","diff","diffSq","indexes","dxs","ms","dx","dy","i1","i2","m2","mNext","dxNext","common","i3","c1","invDx","getNodeClientOffset","parentElement","getEventClientOffset","getDragPreviewOffset","sourceNode","anchorPoint","offsetPoint","isImage","nodeName","documentElement","dragPreviewNodeOffsetFromClient","offsetFromDragPreview","sourceWidth","offsetHeight","sourceHeight","anchorX","anchorY","dragPreviewWidth","dragPreviewHeight","devicePixelRatio","getDragPreviewSize","isManualOffsetY","calculateYOffset","OptionsReader","rootElement","optionsArgs","ownerDocument","HTML5BackendImpl","profile","ref1","sourcePreviewNodes","sourcePreviewNodeOptions","sourceNodeOptions","sourceNodes","dragStartSourceIds","dropTargetIds","dragEnterTargetIds","dragOverTargetIds","__isReactDndBackendSetUp","addEventListeners","removeEventListeners","clearCurrentDragSourceNode","asyncEndDragFrameId","handleDragStart","handleSelectStart","handleDragEnter","handleDragOver","handleDrop","handleTopDragStart","handleTopDragStartCapture","handleTopDragEndCapture","handleTopDragEnter","handleTopDragEnterCapture","handleTopDragLeaveCapture","handleTopDragOver","handleTopDragOverCapture","handleTopDrop","handleTopDropCapture","getCurrentSourceNodeOptions","dropEffect","altKeyPressed","getCurrentDropEffect","isDraggingNativeItem","getCurrentSourcePreviewNodeOptions","captureDraggingState","NativeTypes","beginDragNativeItem","currentNativeSource","createNativeDragSource","currentNativeHandle","setCurrentDragSourceNode","currentDragSourceNode","mouseMoveTimeoutTimer","endDragIfSourceWasRemovedFromDOM","defaultPrevented","_e","lastClientOffset","hoverRafId","endDragNativeItem","cancelHover","scheduleHover","nativeType","setDragImage","dragPreviewOffset","hasAttribute","enterLeaveCounter","altKey","dragDrop","tagName","isContentEditable","HTML5Backend","ItemType","DraggableChip","drag","DropWell","PAFVNavigatorContent","ArrowRightLeft","PAFVNavigator","Dropdown","onSelect","fullWidth","isOpen","setIsOpen","handleClickOutside","handleKeyDown","selectedOption","opt","displayValue","buttonStyles","menuStyles","itemStyles","labelStyles","ChevronDown","option","Navigator","isExpanded","setIsExpanded","appOptions","viewOptions","datasetOptions","Fragment","ChevronUp","TabPanel","tabs","defaultTab","controlledActiveTab","onTabChange","internalActiveTab","setInternalActiveTab","activeTabContent","tabBaseStyles","tabActiveStyles","tabInactiveStyles","panelStyles","tabId","AccordionSection","badge","defaultExpanded","expanded","controlledExpanded","onToggle","internalExpanded","setInternalExpanded","headerStyles","titleStyles","chevronStyles","contentStyles","newExpanded","Sidebar","activeFilterPanel","setActiveFilterPanel","templateBuilders","LATCH_FILTERS","availableFilters","columnNames","filterSections","hasCategoryFilter","hasTimeFilter","statuses","priorities","dateRange","renderFacetList","emptyMessage","handleFacetClick","renderFilterPanel","has_created","has_due","timeRanges","today","weekAgo","monthAgo","yearAgo","panelContent","renderFilterItem","isAvailable","handleFilterItemClick","Filter","builder","TextFormatContent","PlaceholderContent","RightSidebar","expandedSections","setExpandedSections","renderSectionContent","_isFormats","isFormats","renderSections","sections","toggleSection","Palette","SettingsIcon","NavigatorFooter","frameBorder","scrolling","src","pegParser","require","CommandBar","commandText","setCommandText","onSubmit","trimmed","pegError","line","expected","description","found","filterNode","ErrorBoundary","Component","super","hasError","errorInfo","showDetails","getDerivedStateFromError","componentDidCatch","stack","componentStack","errorReporting","reportError","handleRetry","handleShowDetails","getErrorSeverity","getErrorMessage","severity","getActionableSteps","steps","fallback","containerClasses","iconColor","AlertTriangle","step","RefreshCw","Bug","reports","notifications","sessionId","maxReports","errorHandler","unhandledRejectionHandler","generateSessionId","setupGlobalErrorHandlers","additionalContext","filename","lineno","colno","reason","reportId","determineSeverity","report","errorBoundary","createErrorNotification","notification","getNotificationTitle","getNotificationMessage","getNotificationActions","autoHide","addNotification","reload","removeNotification","notifyListeners","getNotifications","onNotificationsChange","currentNotifications","getReports","clearReports","getSessionInfo","reportCount","highSeverityCount","destroy","reportUserError","_message","reportUserWarning","reportUserInfo","useErrorReporting","NotificationItem","onRemove","getBackgroundColor","AlertCircle","Info","CheckCircle","getIcon","NotificationSystem","setNotifications","handleRemove","UnifiedApp","MVPDemo","showUnified","setShowUnified","App","ReactDOM","getElementById","StrictMode"],"mappings":"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","x_google_ignoreList":[0,1,2,3,12,13,14,15,16,17,20,21,22,23,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138]}