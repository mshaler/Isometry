# v4.9 Data Layer Completion

**Goal:** Complete versioning, URL deep linking, and catalog browsing to fully leverage unified ETL.

**Source:** Feature assessment from 2026-02-13 session identifying gaps in Versioning (Partial), URL Routing (Partial), and Catalog Features (Partial).

## Requirements

### Phase 77: Versioning (P0 - Critical)

**VER-01: Version Increment on Update**
- UPDATE queries must increment `version` column
- Implement via SQL trigger or explicit logic in update functions
- All update paths in useDatabaseService.ts must be covered

**VER-02: Version Tracking in UI**
- Display version number on node detail views
- Show "modified" indicator when version > 1
- Expose version in data inspector queries

### Phase 78: URL Deep Linking (P1 - High)

**URL-01: Node Deep Links**
- Support `?nodeId={id}` URL parameter
- App loads and focuses specified node on page load
- Works with all view types (Grid, List, Kanban, Network)

**URL-02: Filter State in URL**
- Serialize active LATCH filters to URL parameters
- Restore filter state from URL on page load
- Enable shareable filtered views via URL

**URL-03: Selection State in URL**
- Persist selected node IDs in URL (`?selected=id1,id2`)
- Restore selection on page load
- Limit to reasonable selection size (max 50 IDs)

### Phase 79: Catalog Browser (P2 - Medium)

**CAT-01: Facet Aggregate Queries**
- Query folder/tag/status with counts: `SELECT folder, COUNT(*) FROM nodes GROUP BY folder`
- Expose via useFacetAggregates hook
- Include only non-deleted nodes

**CAT-02: Catalog Browser Component**
- Hierarchical folder tree with expand/collapse
- Tag cloud or list with counts
- Status filter chips
- Click to filter SuperGrid by that facet value

**CAT-03: Breadcrumb Navigation**
- Show current filter path as breadcrumb
- Click breadcrumb segment to navigate up
- Clear all filters button

## Success Criteria

1. User edits a node and version increments from 1 to 2 automatically
2. User shares a URL with `?nodeId=xyz` and recipient sees that node focused
3. User applies folder filter and URL updates; sharing URL applies same filter
4. User opens Catalog browser and sees folder tree with card counts
5. User clicks folder in Catalog and SuperGrid filters to show only that folder's cards

## Dependencies

- Depends on: v4.8 ETL Consolidation (Phase 72 complete)
- Enables: v5.1 Feature Gaps (Version History, Advanced Routing)

## Phases

| Phase | Name | Plans | Priority |
|-------|------|-------|----------|
| 77 | Versioning | 2 | P0 |
| 78 | URL Deep Linking | 3 | P1 |
| 79 | Catalog Browser | 3 | P2 |

---
*Created: 2026-02-13*
