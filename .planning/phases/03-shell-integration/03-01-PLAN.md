---
phase: 03-shell-integration
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - src/components/notebook/ShellComponent.tsx
  - src/hooks/useTerminal.ts
autonomous: true

must_haves:
  truths:
    - "User can type commands in functional terminal interface"
    - "Terminal displays command output with proper formatting"
    - "Terminal state persists across component re-renders"
    - "Terminal supports standard shell interactions (ls, pwd, etc.)"
  artifacts:
    - path: "src/hooks/useTerminal.ts"
      provides: "Terminal instance management and command execution"
      exports: ["useTerminal"]
    - path: "src/components/notebook/ShellComponent.tsx"
      provides: "Functional terminal UI component"
      min_lines: 100
      contains: "Terminal from '@xterm/xterm'"
  key_links:
    - from: "src/hooks/useTerminal.ts"
      to: "node-pty spawned process"
      via: "WebSocket or process communication"
      pattern: "ptyProcess\\.(write|kill|resize)"
    - from: "src/components/notebook/ShellComponent.tsx"
      to: "useTerminal hook"
      via: "React hook integration"
      pattern: "useTerminal\\(.*\\)"
---

<objective>
Implement functional terminal embedding with react-xtermjs and node-pty for command execution.

Purpose: Establish core terminal functionality as foundation for AI integration
Output: Working terminal component that can execute system commands
</objective>

<execution_context>
@/Users/mshaler/.claude/get-shit-done/workflows/execute-plan.md
@/Users/mshaler/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/REQUIREMENTS.md
@package.json
@src/components/notebook/ShellComponent.tsx
</context>

<tasks>

<task type="auto">
  <name>Install terminal dependencies</name>
  <files>package.json</files>
  <action>
    Add terminal emulator dependencies to package.json:
    - @xterm/xterm: Modern terminal emulator core library
    - @xterm/addon-fit: Terminal sizing addon for responsive layouts
    - @xterm/addon-web-links: Web link detection and handling
    - node-pty: Native process spawning for command execution

    Install with npm install to update package-lock.json.

    Avoid outdated packages:
    - Don't use react-xtermjs (unmaintained)
    - Use @xterm/xterm namespace (actively maintained)
    - Include type definitions for TypeScript support
  </action>
  <verify>npm ls @xterm/xterm @xterm/addon-fit @xterm/addon-web-links node-pty shows installed versions</verify>
  <done>Terminal emulator and process spawning dependencies installed and available</done>
</task>

<task type="auto">
  <name>Create useTerminal hook</name>
  <files>src/hooks/useTerminal.ts</files>
  <action>
    Create terminal management hook using @xterm/xterm with:

    Interface:
    - createTerminal(containerId: string): Terminal instance
    - executeCommand(command: string): Sends command to process
    - attachToProcess(): Spawns node-pty process and connects I/O
    - dispose(): Cleanup terminal and process
    - resizeTerminal(cols: number, rows: number): Handle resize

    Implementation:
    - Use Terminal from @xterm/xterm with FitAddon for responsive sizing
    - Configure terminal with 256 color support and proper themes
    - Handle process communication via node-pty (spawn bash/zsh)
    - Set working directory to project root
    - Implement proper cleanup on unmount
    - Add error handling for process spawn failures

    Theme support:
    - Dark theme for consistency with ShellComponent styling
    - Font family: 'Monaco', 'Menlo', 'Consolas', monospace
    - Font size: 14px to match existing terminal mock
  </action>
  <verify>TypeScript compilation passes without errors</verify>
  <done>Terminal hook provides complete terminal lifecycle management</done>
</task>

<task type="auto">
  <name>Replace ShellComponent mock with functional terminal</name>
  <files>src/components/notebook/ShellComponent.tsx</files>
  <action>
    Replace mock terminal with functional implementation:

    1. Import useTerminal hook and Terminal from @xterm/xterm
    2. Replace mock terminal display with xterm terminal container
    3. Initialize terminal on component mount using useTerminal
    4. Handle terminal resize when component dimensions change
    5. Add proper cleanup on component unmount
    6. Maintain existing header, status bar, and minimize functionality
    7. Keep connection status display (connected when terminal active)

    Terminal container:
    - Use ref for xterm element attachment
    - Handle focus management for keyboard input
    - Maintain responsive sizing with parent container
    - Preserve existing styling and theme integration

    Keep existing features:
    - Minimize/maximize functionality
    - Header with Terminal icon and connection status
    - Status bar showing shell type and state
    - Theme consistency with existing components
  </action>
  <verify>ShellComponent renders functional terminal that accepts keyboard input and displays output</verify>
  <done>Shell component provides working terminal interface within notebook layout</done>
</task>

</tasks>

<verification>
Terminal functionality verification:
1. Terminal renders in ShellComponent with proper sizing
2. User can type commands and see output (try `pwd`, `ls`, `echo "test"`)
3. Terminal maintains state across component re-renders
4. Terminal resizes properly when parent container changes
5. Terminal cleanup works correctly on component unmount
</verification>

<success_criteria>
- User can execute basic shell commands (pwd, ls, echo) in terminal
- Command output displays with proper formatting and colors
- Terminal responds to keyboard input including special keys (arrows, tab)
- Terminal integrates seamlessly with existing ShellComponent UI
- Terminal state persists during component lifecycle
</success_criteria>

<output>
After completion, create `.planning/phases/03-shell-integration/03-01-SUMMARY.md`
</output>