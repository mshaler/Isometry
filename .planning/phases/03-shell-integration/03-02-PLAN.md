---
phase: 03-shell-integration
plan: 02
type: execute
wave: 2
depends_on: ["03-01"]
files_modified:
  - package.json
  - src/hooks/useClaudeAPI.ts
  - src/types/shell.ts
  - src/utils/environmentSetup.ts
autonomous: false
user_setup:
  - service: anthropic
    why: "Claude Code API integration for AI-assisted development"
    env_vars:
      - name: ANTHROPIC_API_KEY
        source: "Anthropic Console -> API Keys -> Create Key"
      - name: VITE_ANTHROPIC_API_KEY
        source: "Copy from ANTHROPIC_API_KEY for client-side access (if needed)"
    dashboard_config:
      - task: "Create API key"
        location: "Anthropic Console -> API Keys"

must_haves:
  truths:
    - "User can execute Claude commands through terminal interface"
    - "Claude API responses display in terminal with proper formatting"
    - "API errors handled gracefully with user-friendly messages"
    - "API key configuration prevents unauthorized usage"
  artifacts:
    - path: "src/hooks/useClaudeAPI.ts"
      provides: "Claude API client and command processing"
      exports: ["useClaudeAPI"]
    - path: "src/types/shell.ts"
      provides: "Shell command and response type definitions"
      exports: ["CommandType", "ShellCommand", "CommandResponse"]
    - path: "src/utils/environmentSetup.ts"
      provides: "Environment variable validation and setup"
      exports: ["validateAPIKey", "getEnvironmentConfig"]
  key_links:
    - from: "src/hooks/useClaudeAPI.ts"
      to: "@anthropic-ai/sdk"
      via: "Anthropic client initialization"
      pattern: "new Anthropic\\(.*apiKey.*\\)"
    - from: "src/components/notebook/ShellComponent.tsx"
      to: "useClaudeAPI hook"
      via: "React hook integration for AI commands"
      pattern: "useClaudeAPI\\(.*\\)"
---

<objective>
Integrate Claude Code API using @anthropic-ai/sdk for AI-assisted development commands.

Purpose: Enable AI command execution through terminal interface
Output: Working Claude API integration with proper authentication and error handling
</objective>

<execution_context>
@/Users/mshaler/.claude/get-shit-done/workflows/execute-plan.md
@/Users/mshaler/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/REQUIREMENTS.md
@.planning/phases/03-shell-integration/03-01-SUMMARY.md
@src/hooks/useTerminal.ts
</context>

<tasks>

<task type="auto">
  <name>Install Claude API dependencies</name>
  <files>package.json</files>
  <action>
    Add Claude API integration dependencies to package.json:
    - @anthropic-ai/sdk: Official Anthropic SDK for Claude API
    - @types/node: Node.js type definitions for environment variables

    Install with npm install to update package-lock.json.

    Version considerations:
    - Use latest stable version of @anthropic-ai/sdk
    - Ensure compatibility with React 18 and TypeScript 5.2
    - Include type definitions for full TypeScript support
  </action>
  <verify>npm ls @anthropic-ai/sdk @types/node shows installed versions</verify>
  <done>Claude API SDK and supporting dependencies installed</done>
</task>

<task type="auto">
  <name>Create shell types and API hook</name>
  <files>src/types/shell.ts, src/hooks/useClaudeAPI.ts</files>
  <action>
    Create shell type definitions in src/types/shell.ts:
    ```typescript
    export type CommandType = 'system' | 'claude';

    export interface ShellCommand {
      id: string;
      type: CommandType;
      command: string;
      timestamp: Date;
      cwd?: string;
    }

    export interface CommandResponse {
      id: string;
      success: boolean;
      output: string;
      error?: string;
      duration: number;
      type: CommandType;
    }

    export interface ClaudeAPIConfig {
      apiKey: string;
      maxTokens?: number;
      temperature?: number;
    }
    ```

    Create Claude API hook in src/hooks/useClaudeAPI.ts:
    - Initialize Anthropic client with API key from environment
    - executeClaudeCommand(prompt: string): Send request to Claude API
    - formatClaudeResponse(response): Format API response for terminal display
    - handleAPIError(error): Convert API errors to user-friendly messages
    - validateAPIKey(): Check if API key is properly configured

    Error handling:
    - Rate limiting: Display retry suggestions
    - Authentication: Clear setup instructions
    - Network errors: Fallback to system command suggestion
    - Invalid prompts: Helpful prompt formatting tips

    Response formatting:
    - Markdown formatting for code blocks
    - Syntax highlighting hints for terminal display
    - Clear separation between AI response and system output
  </action>
  <verify>TypeScript compilation passes without errors for shell types and API hook</verify>
  <done>Claude API integration provides type-safe command execution</done>
</task>

<task type="auto">
  <name>Create environment setup utility</name>
  <files>src/utils/environmentSetup.ts</files>
  <action>
    Create environment configuration utility:

    Functions:
    - validateAPIKey(): Check if ANTHROPIC_API_KEY is present and valid format
    - getEnvironmentConfig(): Return configuration object with validation status
    - setupEnvironmentInstructions(): Return setup steps for missing configuration
    - isProductionEnvironment(): Detect production vs development mode

    Validation:
    - API key format validation (starts with 'sk-ant-')
    - Environment variable accessibility check
    - Development vs production key handling
    - Clear error messages for configuration issues

    Configuration priorities:
    1. ANTHROPIC_API_KEY (server-side)
    2. VITE_ANTHROPIC_API_KEY (client-side Vite)
    3. Fall back to configuration instructions

    Error messages should guide user to proper setup without exposing sensitive information.
  </action>
  <verify>Environment setup utility compiles and exports expected functions</verify>
  <done>Environment configuration provides secure API key management</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Claude API integration with authentication setup</what-built>
  <how-to-verify>
    1. Check terminal for API setup instructions
    2. Navigate to Anthropic Console (https://console.anthropic.com/account/keys)
    3. Create new API key if needed
    4. Set environment variable: `export ANTHROPIC_API_KEY=sk-ant-...`
    5. Restart development server: `npm run dev`
    6. Verify connection status shows "connected" in shell component
    7. Test simple Claude command (will be implemented in next plan)
  </how-to-verify>
  <resume-signal>Type "api-configured" when API key is set up and server restarted</resume-signal>
</task>

</tasks>

<verification>
Claude API integration verification:
1. API key validation works correctly
2. Environment setup utility provides clear instructions
3. Error handling covers common API failure modes
4. Type definitions support both system and Claude commands
5. API hook initializes without errors when properly configured
</verification>

<success_criteria>
- Claude API SDK installed and properly configured
- API key validation prevents unauthorized access
- Error handling provides helpful user feedback
- Type system distinguishes between command types
- Foundation ready for command routing implementation
</success_criteria>

<output>
After completion, create `.planning/phases/03-shell-integration/03-02-SUMMARY.md`
</output>