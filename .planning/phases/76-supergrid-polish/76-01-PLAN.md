---
phase: 76-supergrid-polish
plan: 01
subsystem: supergrid
tags: [supersearch, fts5, highlighting, integration]

# Dependency graph
requires:
  - phase: 75
    provides: SuperFilter, SuperSort, SuperCards, SuperAudit complete
provides:
  - SuperSearch FTS5 integration with in-grid highlighting
  - Search state preservation across view transitions
affects: [supergrid-mvp, search-ux]

# Tech tracking
tech-stack:
  existing: [fts5, sql.js, d3.js, react]
  patterns: [callback-wiring, d3-selection-styling]

key-files:
  existing:
    - src/components/supergrid/SuperSearch.tsx (complete)
    - src/hooks/database/useFTS5Search.ts (complete)
    - src/contexts/SuperGridContext.tsx (complete)
    - src/engine/SuperGridEngine.ts (complete)
  modify:
    - src/d3/grid-rendering/GridRenderingEngine.ts (add highlight support)
    - src/components/supergrid/SuperGridV5.tsx (wire onHighlight)

---

# Phase 76-01: SuperSearch Integration

**Goal:** Complete the in-grid highlighting for FTS5 search results (MVP criterion)

## Context

SuperSearch infrastructure is 90% complete:
- ✅ SuperSearch.tsx component with UI and faceted search
- ✅ useFTS5Search.ts hook with debouncing and FTS5 queries
- ✅ SuperGridContext with useSuperSearch() hook
- ✅ SuperGridEngine with search state management
- ✅ SuperGridV5 renders SuperSearch in chrome

**Gap:** The `onHighlight` callback only logs to console - doesn't highlight cells in D3 renderer.

## Tasks

### Task 1: Add Search Highlight Support to GridRenderingEngine

Add `searchHighlightIds` state and rendering logic, following the `selectedIds` pattern.

**Changes:**
1. Add `private searchHighlightIds: Set<string> = new Set();`
2. Add `public setSearchHighlightIds(ids: Set<string>): void`
3. Update `renderCards()` to apply highlight styling

**Highlight styling:**
- Background tint: `rgba(250, 204, 21, 0.3)` (yellow highlight)
- Border: `2px solid #facc15`

### Task 2: Wire SuperGridV5 onHighlight Callback

Update SuperGridV5.tsx to:
1. Get GridRenderingEngine reference
2. Call `setSearchHighlightIds()` from `onHighlight` callback
3. Ensure highlight clears when search clears

### Task 3: Verify Integration

- [ ] Search highlights matching cells in grid
- [ ] Clear search clears highlights
- [ ] Selection and search highlights coexist correctly
- [ ] Performance acceptable (no re-render jank)

## Acceptance Criteria

- [ ] SRCH-03: In-grid highlighting of matching cells works
- [ ] Search results visually distinct from selection
- [ ] No regression in selection behavior
- [ ] Tests pass

## Estimated Duration

~10 minutes (small integration gap)
