---
phase: 101-ui-integration
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/CardDetailModal.tsx
autonomous: true

must_haves:
  truths:
    - "Folder dropdown in CardDetailModal shows values discovered from database"
    - "Status dropdown in CardDetailModal shows values discovered from database"
    - "Status colors use neutral gray default when status not in settings"
    - "Loading states prevent interaction while data loads"
    - "Empty dropdown states show helpful message when no values exist"
  artifacts:
    - path: "src/components/CardDetailModal.tsx"
      provides: "Dynamic folder/status dropdowns with Phase 100 hooks"
      min_lines: 480
  key_links:
    - from: "src/components/CardDetailModal.tsx"
      to: "src/hooks/useFacetValues.ts"
      via: "useFolderValues and useStatusValues imports"
      pattern: "useFolderValues|useStatusValues"
    - from: "src/components/CardDetailModal.tsx"
      to: "src/hooks/useSettings.ts"
      via: "useSetting import for status colors"
      pattern: "useSetting.*status_colors"
---

<objective>
Replace hardcoded folder and status dropdown options in CardDetailModal with dynamic values discovered from the database using Phase 100 hooks.

Purpose: Eliminate hardcoded LATCH filter values (UI-01, UI-02, UI-03) so dropdowns reflect actual data in any dataset.

Output: Updated CardDetailModal.tsx using useFolderValues, useStatusValues, and useSetting for dynamic discovery.
</objective>

<execution_context>
@/Users/mshaler/.claude/get-shit-done/workflows/execute-plan.md
@/Users/mshaler/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/101-ui-integration/101-RESEARCH.md
@src/components/CardDetailModal.tsx
@src/hooks/useFacetValues.ts
@src/hooks/useSettings.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Replace hardcoded folder options with useFolderValues</name>
  <files>src/components/CardDetailModal.tsx</files>
  <action>
Add imports at top of file:
```typescript
import { useFolderValues, useStatusValues } from '@/hooks/useFacetValues';
import { useSetting } from '@/hooks/useSettings';
```

In CardDetailModal component, add folder discovery hook call after existing state hooks:
```typescript
const { data: folderValues, isLoading: foldersLoading } = useFolderValues();
```

Replace hardcoded folder options (lines 185-192) with dynamic options:
```typescript
options={[
  { value: '', label: 'No folder' },
  ...(folderValues || []).map(fv => ({
    value: fv.value,
    label: fv.value
  }))
]}
```

Update CardFormSelect isLoading prop to combine loading states:
```typescript
isLoading={isLoading || foldersLoading}
```

IMPORTANT: Do NOT add an isLoading prop to CardFormSelectProps - the prop already exists on line 47.
  </action>
  <verify>
Run `npm run typecheck` - should pass with no new errors.
Open CardDetailModal in browser dev tools, verify useFolderValues hook is called and returns data.
  </verify>
  <done>Folder dropdown shows values from database instead of hardcoded array</done>
</task>

<task type="auto">
  <name>Task 2: Replace hardcoded status options with useStatusValues and dynamic colors</name>
  <files>src/components/CardDetailModal.tsx</files>
  <action>
In CardStatusField component (lines 421-476), replace hardcoded statusOptions with discovery hook:

First, update CardStatusFieldProps interface to pass through discovery hook results:
```typescript
interface CardStatusFieldProps {
  label: string;
  editMode: boolean;
  isLoading: boolean;
  editValue: string;
  displayValue: string;
  onEdit: (value: string) => void;
  statusOptions: Array<{ value: string; label: string }>;
  statusLoading: boolean;
  getStatusColor: (status?: string) => string;
}
```

In CardDetailModal, add status discovery and settings hooks:
```typescript
const { data: statusValues, isLoading: statusLoading } = useStatusValues();
const [statusColors] = useSetting<Record<string, string>>('status_colors', {});

const statusOptions = [
  { value: '', label: 'No status' },
  ...(statusValues || []).map(sv => ({
    value: sv.value,
    label: sv.value
  }))
];

const getStatusColor = (status?: string): string => {
  if (!status) return '#9ca3af'; // neutral gray
  return statusColors[status] || '#9ca3af'; // neutral default for unknown
};
```

Pass these to CardStatusField:
```typescript
<CardStatusField
  label="Status"
  editMode={editMode}
  isLoading={isLoading}
  editValue={editedCard.status || ''}
  displayValue={card.status || ''}
  onEdit={(value: string) => setEditedCard(prev => ({ ...prev, status: value || undefined }))}
  statusOptions={statusOptions}
  statusLoading={statusLoading}
  getStatusColor={getStatusColor}
/>
```

Update CardStatusField function to use props instead of internal constants:
- Remove internal statusOptions array (lines 428-434)
- Remove internal getStatusColor function (lines 436-444)
- Use props.statusOptions and props.getStatusColor
- Add statusLoading to disabled state: `disabled={isLoading || statusLoading}`
  </action>
  <verify>
Run `npm run typecheck` - should pass with no new errors.
Open browser, check CardStatusField shows values from database.
Check that unknown statuses display with neutral gray (#9ca3af).
  </verify>
  <done>Status dropdown populated from database, colors from settings with neutral fallback</done>
</task>

<task type="auto">
  <name>Task 3: Add empty state handling for dropdowns</name>
  <files>src/components/CardDetailModal.tsx</files>
  <action>
Add empty state hints below each dropdown when no values are discovered.

After folder CardFormSelect (around line 193), add:
```typescript
{!foldersLoading && (folderValues?.length === 0) && (
  <p className="text-xs text-gray-500 mt-1 italic">
    No folders found. Type a folder name when creating cards to add options.
  </p>
)}
```

After CardStatusField (around line 203), add:
```typescript
{!statusLoading && (statusValues?.length === 0) && (
  <p className="text-xs text-gray-500 mt-1 italic">
    No statuses found. Set a status when creating cards to add options.
  </p>
)}
```

These hints satisfy UI-05: Empty states shown when no values discovered.
  </action>
  <verify>
Run `npm run typecheck` - should pass.
Manual test: With empty database, verify empty state messages appear.
Manual test: With populated database, verify messages do NOT appear.
  </verify>
  <done>Empty state hints display when no folder/status values exist in database</done>
</task>

</tasks>

<verification>
1. `npm run typecheck` passes with no new errors
2. `npm run lint` passes with no new errors in CardDetailModal.tsx
3. Manual verification:
   - Open CardDetailModal in app
   - Verify folder dropdown shows values from actual data (not hardcoded "Work", "Personal", etc.)
   - Verify status dropdown shows values from actual data (not hardcoded "Active", "Completed", etc.)
   - Verify unknown status colors display as neutral gray
   - If database has no folders/statuses, verify empty state messages appear
</verification>

<success_criteria>
- CardDetailModal folder dropdown populated from useFolderValues hook
- CardDetailModal status dropdown populated from useStatusValues hook
- Status colors retrieved from settings, neutral gray (#9ca3af) for unknowns
- Empty state hints visible when no values discovered
- No TypeScript errors
- Requirements UI-01, UI-02, UI-03, UI-05 (for CardDetailModal) satisfied
</success_criteria>

<output>
After completion, create `.planning/phases/101-ui-integration/101-01-SUMMARY.md`
</output>
