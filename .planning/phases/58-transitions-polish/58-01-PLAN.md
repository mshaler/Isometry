# Plan 58-01: Transitions & Polish

## Summary

Add smooth animations and visual polish to Navigator and SuperGrid components. Based on P3 items from FIGMA-REVIEW-PUNCHLIST.md and milestone 58-01/58-02 scope.

## Context

**Current State:**
- Navigator chips toggle instantly (no enter/exit animations)
- Drop zones don't show red border on invalid drops
- SuperGrid cards reposition without animation
- Empty cells handled but transitions abrupt

**Priority per Punchlist (P3 items):**
- CSS transition on chip opacity/height for check/uncheck (200ms ease)
- CSS transitions on chip enter/exit (150ms opacity + translateY)
- Red border on invalid drop targets
- Card FLIP animations on axis change

## Scope

### In Scope
1. Chip enter/exit animations in DraggableFacet
2. Invalid drop indicator (red border) in PlaneDropZone
3. Card FLIP animations in GridRenderingEngine
4. View mode transition polish

### Out of Scope (Phase 59+)
- Location Slider mini-map (P3 design decision)
- Non-contiguous time selection (P3)
- Category visual distribution bar (P3)
- Axis-specific density expansion panel (P3)

## Tasks

### Task 1: Chip Toggle Animations
**File:** `src/components/navigator/DraggableFacet.tsx` (MODIFY)

Add CSS transitions for chip visibility toggle:

```css
/* Add to chip container */
transition: opacity 200ms ease, transform 150ms ease;

/* Entering state */
opacity: 1;
transform: translateY(0);

/* Exiting/disabled state */
opacity: 0.6;
```

**Implementation:**
- Add Tailwind transition classes: `transition-all duration-200 ease-in-out`
- Use conditional opacity based on disabled state
- Consider using React Transition Group for enter/exit

### Task 2: Invalid Drop Indicator
**File:** `src/components/navigator/PlaneDropZone.tsx` (MODIFY)

Show red border when dropping GRAPH facets (invalid):

```typescript
// In useDrop collect
collect: (monitor) => ({
  isOver: monitor.isOver({ shallow: true }),
  canDrop: monitor.canDrop(),
  isInvalid: monitor.isOver() && !monitor.canDrop(),
}),

// In container classes
${isInvalid ? 'border-red-500 bg-red-50' : ''}
```

### Task 3: Card FLIP Animations
**Files:**
- `src/d3/grid-rendering/GridRenderingEngine.ts` (MODIFY)

Add D3 transitions when cards reposition:

```typescript
// In renderCards, for update selection:
cardUpdate
  .transition()
  .duration(300)
  .ease(d3.easeCubicOut)
  .attr('transform', (d: CardRecord) =>
    `translate(${(d.x as number) || 0}, ${(d.y as number) || 0})`
  );

// For enter selection:
cardEnter
  .attr('opacity', 0)
  .transition()
  .duration(200)
  .attr('opacity', 1);

// For exit selection:
cardSelection.exit()
  .transition()
  .duration(200)
  .attr('opacity', 0)
  .remove();
```

### Task 4: View Mode Transition
**File:** `src/components/Navigator.tsx` (MODIFY)

Add transition when switching Grid/List view mode:

```tsx
<button
  onClick={() => setViewMode('grid')}
  className={`
    px-3 py-1 text-xs rounded
    transition-colors duration-150
    ${state.viewMode === 'grid'
      ? 'bg-blue-500 text-white'
      : 'bg-gray-100 hover:bg-gray-200'
    }
  `}
>
```

### Task 5: Encoding Dropdown Transitions
**File:** `src/components/navigator/EncodingDropdown.tsx` (MODIFY)

Add dropdown open/close animation:

```tsx
// Dropdown container
<div className={`
  ${dropdownClasses}
  transition-all duration-150 ease-out
  ${isOpen ? 'opacity-100 translate-y-0' : 'opacity-0 -translate-y-2 pointer-events-none'}
`}>
```

## Verification

```bash
npm run check:types
npm run dev
# Navigate to /?test=integrated
# Verify:
# 1. Click facet checkbox → chip fades in/out smoothly
# 2. Drag GRAPH facet to X/Y well → red border appears
# 3. Change axis mapping → cards animate to new positions
# 4. Toggle Grid/List → button transitions smoothly
# 5. Open/close encoding dropdown → slides in/out
```

## Files Changed

| File | Action | Description |
|------|--------|-------------|
| `src/components/navigator/DraggableFacet.tsx` | MODIFY | Add chip toggle transitions |
| `src/components/navigator/PlaneDropZone.tsx` | MODIFY | Add invalid drop red border |
| `src/d3/grid-rendering/GridRenderingEngine.ts` | MODIFY | Add D3 FLIP animations |
| `src/components/Navigator.tsx` | MODIFY | Add view mode button transitions |
| `src/components/navigator/EncodingDropdown.tsx` | MODIFY | Add dropdown animations |

## Dependencies

- Phase 57-03 complete (encoding dropdowns exist)
- D3.js transition API available
- Tailwind CSS transition utilities

## Estimated Complexity

Low — Mostly CSS transitions and D3 animation tweaks.

---

*Plan: 58-01*
*Phase: 58 - Transitions & Polish*
*Status: ✅ COMPLETED 2026-02-11*

## Completion Summary

All 5 tasks completed:
- ✅ Task 1: Added chip toggle animations (transition-all, opacity, scale)
- ✅ Task 2: Added invalid drop indicator (red border on GRAPH facet drops)
- ✅ Task 3: Added card FLIP animations (enter fade-in, update slide, exit fade-out)
- ✅ Task 4: Added view mode button transitions (transition-colors)
- ✅ Task 5: Added encoding dropdown transitions (slide-up animation)
