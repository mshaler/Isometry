---
phase: 36-supergrid-headers
plan: 03
type: execute
wave: 1
depends_on: []
files_modified: ["src/d3/SuperGrid.ts", "src/components/SuperGridDemo.tsx"]
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "User can control data density through orthogonal zoom (value) and pan (extent) controls"
    - "User can navigate with pinned upper-left corner zoom behavior"
    - "Zoom/pan controls operate independently per Janus model"
  artifacts:
    - path: "src/d3/SuperGrid.ts"
      provides: "SuperGridZoom integration"
      contains: "new SuperGridZoom"
    - path: "src/components/SuperGridDemo.tsx"
      provides: "UI controls for zoom/pan levels"
      contains: "ZoomLevel|PanLevel"
  key_links:
    - from: "src/d3/SuperGrid.ts"
      to: "src/d3/SuperGridZoom.ts"
      via: "import and instantiation"
      pattern: "SuperGridZoom.*constructor"
    - from: "src/components/SuperGridDemo.tsx"
      to: "SuperGrid zoom controls"
      via: "React state and callbacks"
      pattern: "setZoomLevel|setPanLevel"
---

<objective>
Integrate SuperGridZoom into SuperGrid to enable orthogonal density controls and close verification gaps.

Purpose: Enable the Janus density model (zoom/pan controls) that was implemented but not integrated, making the SuperGrid's advanced density controls accessible to users.
Output: Working zoom/pan controls with UI integration and proper state management.
</objective>

<execution_context>
@/Users/mshaler/.claude/get-shit-done/workflows/execute-plan.md
@/Users/mshaler/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior phase work
@.planning/phases/36-supergrid-headers/36-01-SUMMARY.md
@.planning/phases/36-supergrid-headers/36-02-SUMMARY.md

# Gap context
@.planning/phases/36-supergrid-headers/36-VERIFICATION.md

# Source files to integrate
@src/d3/SuperGridZoom.ts
@src/d3/SuperGrid.ts
@src/components/SuperGridDemo.tsx
</context>

<tasks>

<task type="auto">
  <name>Integrate SuperGridZoom into SuperGrid</name>
  <files>src/d3/SuperGrid.ts</files>
  <action>
    Integrate the existing SuperGridZoom component into SuperGrid class:

    1. Import SuperGridZoom types and class at top of file
    2. Add private superGridZoom property to class
    3. Instantiate SuperGridZoom in constructor with proper callbacks:
       - onZoomChange: trigger grid re-render with new zoom level
       - onPanChange: trigger grid re-render with new pan level
       - onStateChange: save state to database via this.database
    4. Add public methods to expose zoom/pan controls:
       - setZoomLevel(level: ZoomLevel): void
       - setPanLevel(level: PanLevel): void
       - getJanusState(): JanusState
    5. Wire zoom behavior to grid rendering in render/update methods
    6. Clean up in destroy method

    Reference existing SuperGridHeaders integration pattern for consistency.
    Maintain all existing SuperGrid functionality while adding zoom capabilities.
  </action>
  <verify>npm run typecheck passes && grep -q "SuperGridZoom" src/d3/SuperGrid.ts</verify>
  <done>SuperGrid imports, instantiates, and exposes SuperGridZoom controls with proper callbacks</done>
</task>

<task type="auto">
  <name>Add zoom/pan UI controls to SuperGridDemo</name>
  <files>src/components/SuperGridDemo.tsx</files>
  <action>
    Add UI controls for zoom/pan level selection to the SuperGrid demo:

    1. Import ZoomLevel, PanLevel types from SuperGridZoom
    2. Add React state for current zoom/pan levels
    3. Add button group or select controls for:
       - Zoom Level: "Leaf" (shows Jan, Feb, Mar) vs "Collapsed" (shows Q1)
       - Pan Level: "Dense" (populated-only) vs "Sparse" (full Cartesian)
    4. Wire controls to SuperGrid instance via setZoomLevel/setPanLevel methods
    5. Display current state for user feedback
    6. Add controls near existing filter controls for logical grouping

    Follow existing demo UI patterns and styling.
    Ensure controls are clearly labeled and intuitive.
  </action>
  <verify>grep -q "ZoomLevel\|PanLevel" src/components/SuperGridDemo.tsx && npm run dev loads without errors</verify>
  <done>Demo UI has working zoom/pan controls that trigger SuperGrid density changes</done>
</task>

<task type="auto">
  <name>Test zoom/pan integration and state persistence</name>
  <files>src/d3/SuperGrid.ts, src/components/SuperGridDemo.tsx</files>
  <action>
    Verify end-to-end zoom/pan functionality:

    1. Test zoom level changes trigger proper grid re-rendering
    2. Test pan level changes adjust cell density (sparse vs dense)
    3. Verify fixed upper-left corner anchor behavior during zoom
    4. Test state persistence via database integration
    5. Ensure smooth animations match "quiet app" aesthetic (300ms)
    6. Verify orthogonal operation (zoom/pan independently)

    Add debug logging for state changes to aid verification.
    Remove any remaining console.log statements from SuperGridZoom.
  </action>
  <verify>npm run test passes && npm run dev shows responsive zoom/pan controls</verify>
  <done>Zoom/pan controls work end-to-end with proper state persistence and user feedback</done>
</task>

</tasks>

<verification>
1. Run npm run typecheck - should pass without SuperGridZoom errors
2. Load SuperGrid demo - zoom/pan controls should be visible and functional
3. Test zoom level changes - grid should re-render with appropriate density
4. Test pan level changes - extent should adjust between sparse/dense
5. Verify upper-left corner stays pinned during zoom operations
6. Confirm state persists across page refreshes
</verification>

<success_criteria>
- SuperGridZoom is imported and instantiated in SuperGrid.ts with proper integration
- UI controls allow user to set zoom/pan levels with immediate visual feedback
- Orthogonal zoom (value) and pan (extent) controls operate independently
- Fixed upper-left corner anchor zoom behavior works as specified
- State persistence preserves user zoom/pan settings across sessions
- All verification gaps from Phase 36 are resolved
</success_criteria>

<output>
After completion, create `.planning/phases/36-supergrid-headers/36-03-SUMMARY.md`
</output>