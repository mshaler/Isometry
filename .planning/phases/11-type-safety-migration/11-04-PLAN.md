---
phase: 11-type-safety-migration
plan: 04
type: execute
wave: 2
depends_on: [11-01, 11-02, 11-03]
files_modified: [
  "src/components/notebook/CaptureComponent.tsx",
  "src/components/notebook/PropertyEditor.tsx",
  "src/components/notebook/property-editor/CustomFieldAdder.tsx",
  "src/utils/type-guards.ts",
  "src/types/bridge-types.ts",
  "src/types/property-types.ts"
]
autonomous: true

must_haves:
  truths:
    - "npx tsc --noEmit --strict completes with zero errors"
    - "All property editor components handle unknown data with type safety"
    - "Bridge message validation prevents runtime type errors"
    - "Legacy components migrate gracefully with type guard protection"
  artifacts:
    - path: "src/utils/type-guards.ts"
      provides: "Comprehensive type guard functions for runtime validation"
      contains: "isPropertyDefinition, isBridgeMessage, isErrorReportingMethod"
    - path: "src/types/bridge-types.ts"
      provides: "Unified React/Swift bridge interface definitions"
      contains: "BridgeMessage, BridgeResponse, ErrorReporting"
    - path: "src/types/property-types.ts"
      provides: "Complete property system type definitions"
      exports: ["PropertyDefinition", "PropertyValue", "PropertyType"]
    - path: "src/components/notebook/CaptureComponent.tsx"
      provides: "Type-safe notebook capture with error reporting"
      min_lines: 80
  key_links:
    - from: "src/components/notebook/*.tsx"
      to: "src/utils/type-guards.ts"
      via: "Type validation before operations"
      pattern: "is[A-Z].*\\(.*\\)"
    - from: "src/types/bridge-types.ts"
      to: "src/utils/webview-bridge.ts"
      via: "Unified message interface usage"
      pattern: "BridgeMessage.*BridgeResponse"
    - from: "src/components/notebook/property-editor/CustomFieldAdder.tsx"
      to: "src/types/property-types.ts"
      via: "Complete PropertyDefinition interface"
      pattern: "PropertyDefinition.*id.*name.*type"
---

<objective>
Implement comprehensive type guard system and bridge interface consistency to eliminate TypeScript strict mode errors and establish bulletproof runtime type validation for legacy code migration.

Purpose: Address TYPE-02 (type guards for legacy migration) and TYPE-03 (React/Swift bridge consistency) requirements by creating robust type validation that protects against runtime errors during incremental type safety adoption.

Output: Zero TypeScript strict mode errors with comprehensive type guard system enabling safe migration of legacy components.
</objective>

<execution_context>
@/Users/mshaler/.claude/get-shit-done/workflows/execute-plan.md
@/Users/mshaler/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/REQUIREMENTS.md

# Phase 11 foundation completed
@.planning/phases/11-type-safety-migration/11-01-SUMMARY.md
@.planning/phases/11-type-safety-migration/11-02-SUMMARY.md
@.planning/phases/11-type-safety-migration/11-03-SUMMARY.md

# Current TypeScript errors to resolve
# CaptureComponent.tsx: GlobalErrorReporting method mismatches
# PropertyEditor.tsx: Type incompatibility in props handling
# CustomFieldAdder.tsx: Missing 'id' property in PropertyDefinition
</context>

<tasks>

<task type="auto">
  <name>Type Guard Implementation for Legacy Migration</name>
  <files>src/utils/type-guards.ts, src/components/notebook/CaptureComponent.tsx, src/components/notebook/PropertyEditor.tsx</files>
  <action>
    Create comprehensive type guard system to handle legacy code migration safely:

    1. Create src/utils/type-guards.ts with runtime validation functions:
       - isPropertyDefinition(value: unknown): value is PropertyDefinition
       - isBridgeMessage(value: unknown): value is BridgeMessage
       - isErrorReportingMethod(method: string, obj: unknown): method validation
       - isValidPropertyValue(value: unknown, type: PropertyType): value is PropertyValue

    2. Fix CaptureComponent.tsx TypeScript errors:
       - Resolve GlobalErrorReporting method mismatches (reportUserError vs reportError)
       - Add type guards before calling error reporting methods
       - Ensure consistent interface usage with error reporting service established in 11-02

    3. Fix PropertyEditor.tsx TypeScript errors:
       - Resolve props type incompatibility in async function parameter
       - Add type validation for dynamic property updates using type guards
       - Maintain compatibility with existing property management patterns

    Follow the established interface patterns from Phase 11-02 error reporting system and maintain consistency with the GlobalErrorReporting interface.
  </action>
  <verify>npx tsc --noEmit shows no errors in CaptureComponent.tsx and PropertyEditor.tsx</verify>
  <done>Type guard system implemented with legacy component errors resolved</done>
</task>

<task type="auto">
  <name>Bridge Interface Consistency Implementation</name>
  <files>src/types/bridge-types.ts, src/types/property-types.ts, src/components/notebook/property-editor/CustomFieldAdder.tsx</files>
  <action>
    Establish complete interface consistency between React and Swift bridge components:

    1. Create src/types/bridge-types.ts consolidating bridge interfaces:
       - Unify BridgeMessage and BridgeResponse from existing WebView implementations
       - Standardize ErrorReporting interface matching 11-02 error reporting service
       - Ensure message validation interfaces match Swift MessageHandler expectations

    2. Create src/types/property-types.ts with complete PropertyDefinition:
       - Add missing 'id' field to PropertyDefinition interface
       - Ensure PropertyType enum matches Swift property system
       - Define PropertyValue union type for type-safe property handling

    3. Fix CustomFieldAdder.tsx TypeScript error:
       - Add required 'id' field to PropertyDefinition object creation
       - Use proper PropertyDefinition interface from property-types
       - Generate UUID for new property IDs using consistent pattern

    Reference the established WebView bridge patterns from 11-03 and error reporting interfaces from 11-02 to maintain consistency.
  </action>
  <verify>npx tsc --noEmit shows no errors in CustomFieldAdder.tsx, all property operations work correctly</verify>
  <done>Complete bridge interface consistency achieved across React/Swift boundary</done>
</task>

<task type="auto">
  <name>Comprehensive Type Safety Validation</name>
  <files>src/components/notebook/CaptureComponent.tsx, src/components/notebook/PropertyEditor.tsx</files>
  <action>
    Apply type guards and interface consistency to eliminate all remaining TypeScript strict mode errors:

    1. Resolve any remaining GlobalErrorReporting interface mismatches:
       - Ensure all method calls match the interface established in 11-02
       - Add type guards before dynamic method calls
       - Use consistent error reporting patterns across components

    2. Fix property declaration conflicts and type mismatches:
       - Resolve duplicate property declarations with consistent types
       - Apply proper async function parameter typing
       - Use type guards for runtime validation of dynamic properties

    3. Test comprehensive type safety:
       - Run full TypeScript strict mode compilation
       - Ensure no new type errors introduced
       - Validate all component functionality remains intact

    Apply the established TypeScript patterns from Phase 10-11 including interface extensions, parameter omission strategies, and comprehensive interface definitions.
  </action>
  <verify>npx tsc --noEmit --strict completes with exit code 0, all notebook components function correctly</verify>
  <done>Complete TypeScript strict mode compliance achieved for all notebook components</done>
</task>

</tasks>

<verification>
- Run `npx tsc --noEmit --strict` and confirm zero compilation errors
- Test all notebook capture and property editing functionality
- Verify error reporting works correctly in all components
- Test property creation and editing with type safety
- Ensure bridge message validation prevents runtime errors
- Confirm no performance regression in component operations
</verification>

<success_criteria>
1. TypeScript strict mode compilation succeeds with zero errors across all files
2. Type guard system prevents runtime type errors during property operations
3. Bridge interface consistency maintained between React and Swift layers
4. All notebook components handle edge cases gracefully with type safety
5. Legacy code migration patterns established for future component updates
6. TYPE-02 and TYPE-03 requirements satisfied with comprehensive validation
</success_criteria>

<output>
After completion, create `.planning/phases/11-type-safety-migration/11-04-SUMMARY.md`
</output>