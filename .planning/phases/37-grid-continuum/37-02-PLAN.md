---
phase: 37-grid-continuum
plan: 02
type: execute
wave: 2
depends_on: [37-01]
files_modified: [src/d3/ListView.ts, src/d3/KanbanView.ts, src/components/ViewSwitcher.tsx, src/components/SuperGridDemo.tsx, src/d3/SuperGrid.ts]
autonomous: false

must_haves:
  truths:
    - "User can view data as 1-axis list with hierarchical folder structure"
    - "User can view data as kanban columns grouped by category facet"
    - "User can switch between views via toolbar with keyboard shortcuts"
    - "View transitions preserve selection state and animate smoothly"
    - "Same dataset renders consistently across all projection modes"
  artifacts:
    - path: "src/d3/ListView.ts"
      provides: "1-axis list projection using D3"
      exports: ["ListView"]
    - path: "src/d3/KanbanView.ts"
      provides: "1-facet column projection using D3"
      exports: ["KanbanView"]
    - path: "src/components/ViewSwitcher.tsx"
      provides: "React toolbar for view type selection"
      exports: ["ViewSwitcher"]
  key_links:
    - from: "src/components/ViewSwitcher.tsx"
      to: "src/d3/ViewContinuum.ts"
      via: "view change commands"
      pattern: "viewContinuum\\.switchTo"
    - from: "ListView/KanbanView classes"
      to: "FLIP animation system"
      via: "getCardPositions method"
      pattern: "getCardPositions.*Map<string.*x.*y.*width.*height"
    - from: "keyboard shortcuts"
      to: "view switching"
      via: "document keydown listener"
      pattern: "Cmd\\+[123].*switchView"
---

<objective>
Complete view continuum system with ListView, KanbanView implementations and ViewSwitcher UI integration for seamless data projection transitions.

Purpose: Enable users to transition between list, kanban, and SuperGrid views of the same dataset while preserving selection state and filter context. This implements the core Grid Continuum feature where view transitions are PAFV axis-to-plane remappings.
Output: Working view continuum with three projection modes, animated transitions, and integrated user interface.
</objective>

<execution_context>
@/Users/mshaler/.claude/get-shit-done/workflows/execute-plan.md
@/Users/mshaler/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/37-grid-continuum/37-CONTEXT.md
@.planning/phases/37-grid-continuum/37-RESEARCH.md
@.planning/phases/37-grid-continuum/37-01-SUMMARY.md
@src/d3/SuperGrid.ts
@src/d3/ViewContinuum.ts
@src/types/views.ts
@src/components/SuperGridDemo.tsx
</context>

<tasks>

<task type="auto">
  <name>Implement ListView and KanbanView projection classes</name>
  <files>src/d3/ListView.ts, src/d3/KanbanView.ts</files>
  <action>
    Create ListView and KanbanView classes implementing common interface for ViewContinuum delegation.

    ListView (1-axis projection):
    - Default axis: Hierarchy (H) using folder/nesting structure via NEST edges
    - Renders as vertical list with nested indentation for hierarchies
    - Respects current LATCH sort, defaults to modified_at DESC
    - Uses same SVG container pattern as SuperGrid

    KanbanView (1-facet column projection):
    - Default column facet: status (Category C axis)
    - Renders as horizontal columns with cards sorted within
    - User can change column facet to any Category axis facet
    - Cards within columns sorted by current LATCH sort

    Both classes must implement common interface per CONTEXT.md:
    - render(cards, axisMapping, activeFilters) — project cards into view
    - getCardPositions(): Map<string, {x, y, width, height}> — for FLIP animation
    - scrollToCard(cardId) — semantic scroll to focused card
    - destroy() — cleanup

    Use D3.js data binding with key functions (d => d.id) following established SuperGrid patterns. Apply same card dimensions and styling for consistency.

    Handle missing data gracefully: show available data with non-blocking message for missing fields ("Some cards lack status and appear in 'Unassigned' column").
  </action>
  <verify>npm run typecheck passes, ListView and KanbanView classes instantiate and render test data without errors</verify>
  <done>ListView and KanbanView classes exist with common interface implementation for seamless ViewContinuum integration</done>
</task>

<task type="auto">
  <name>Create ViewSwitcher toolbar and integrate with SuperGridDemo</name>
  <files>src/components/ViewSwitcher.tsx, src/components/SuperGridDemo.tsx</files>
  <action>
    Create ViewSwitcher React component with view type icons and keyboard shortcut registration.

    ViewSwitcher requirements from CONTEXT.md:
    - Toolbar with view type icons (standard Finder/Numbers pattern)
    - Keyboard shortcuts: Cmd+1 = List, Cmd+2 = Kanban, Cmd+3 = SuperGrid
    - Register shortcuts at React component level via useEffect with document keydown listener
    - View choice persists per-canvas via ViewState localStorage

    Integration with SuperGridDemo:
    - Replace direct SuperGrid instantiation with ViewContinuum orchestration
    - Add ViewSwitcher component to layout
    - Wire ViewSwitcher callbacks to ViewContinuum.switchTo() method
    - Preserve existing functionality while adding view continuum capability

    Follow established React patterns from existing SuperGridDemo component structure.
  </action>
  <verify>npm run dev shows ViewSwitcher toolbar, keyboard shortcuts work, view switching between modes functions</verify>
  <done>ViewSwitcher component integrated with SuperGridDemo, providing working view continuum interface</done>
</task>

<task type="auto">
  <name>Expose SuperGrid interface methods and complete FLIP animations</name>
  <files>src/d3/SuperGrid.ts</files>
  <action>
    Modify SuperGrid class to expose methods needed by ViewContinuum for seamless integration.

    Required SuperGrid interface additions:
    - getCardPositions(): Map<string, {x, y, width, height}> method for FLIP animation source/target coordinates
    - Accept pre-queried data parameter in render method (vs self-querying) to support ViewContinuum cached data pattern
    - scrollToCard(cardId) method for semantic focus preservation
    - Ensure destroy() method exists for cleanup

    Complete FLIP animation implementation in ViewContinuum per CONTEXT.md flow:
    1. Capture outgoing.getCardPositions()
    2. Switch active view class
    3. Render incoming view at target positions
    4. Capture incoming.getCardPositions()
    5. Calculate FLIP delta (First→Last, Invert, Play)
    6. Animate to identity over 300ms with d3.easeCubicOut
    7. scrollToCard for focused card

    Animations must be interruptible via selection.interrupt() if user triggers another view switch mid-transition.

    Maintain backward compatibility with existing SuperGrid usage patterns.
  </action>
  <verify>All three view types render correctly, FLIP animations work smoothly between view transitions, no regression in existing SuperGrid functionality</verify>
  <done>SuperGrid interface complete, FLIP animations functional, view continuum system fully operational</done>
</task>

<task type="checkpoint:human-verify">
  <what-built>Complete Grid Continuum system with seamless transitions between List, Kanban, and SuperGrid views</what-built>
  <how-to-verify>
    1. Open http://localhost:5173 and navigate to SuperGrid demo
    2. Test view switching via toolbar buttons and keyboard shortcuts (Cmd+1/2/3)
    3. Verify smooth FLIP animations during transitions (300ms duration)
    4. Confirm selection state persists across view switches
    5. Check that LATCH filters apply consistently across all view types
    6. Test focus preservation - select a card, switch views, confirm it stays focused
    7. Verify data consistency - same cards appear in all views, no phantom additions/removals
    8. Test graceful degradation - ensure missing data fields show appropriate messages
  </how-to-verify>
  <resume-signal>Type "approved" if view continuum works as specified, or describe any issues found</resume-signal>
</task>

</tasks>

<verification>
- Three view types (List, Kanban, SuperGrid) render same dataset consistently
- View transitions animate smoothly with 300ms FLIP animations
- Selection state and LATCH filters persist across view switches
- Keyboard shortcuts (Cmd+1/2/3) and toolbar buttons both work
- ViewState persistence via localStorage maintains user preferences
- Focus preservation keeps selected card visible after transitions
</verification>

<success_criteria>
- User can seamlessly transition between list → kanban → SuperGrid projections
- View transitions complete within 200ms with smooth visual animations
- Same LATCH-filtered dataset renders consistently across all modes
- User's semantic position (selection, filters, focus) preserves during transitions
- Grid continuum system ready for future view type additions
</success_criteria>

<output>
After completion, create `.planning/phases/37-grid-continuum/37-02-SUMMARY.md`
</output>