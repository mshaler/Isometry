---
phase: 13.3
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [
  "scripts/build-and-upload-appstore.sh",
  "native/Sources/Isometry/Beta/BetaTestingManager.swift",
  ".planning/phases/13.3-beta-testing-quality-validation/13.3-TESTFLIGHT-CHECKLIST.md",
  ".planning/phases/13.3-beta-testing-quality-validation/13.3-01-USER-SETUP.md"
]
autonomous: false
user_setup:
  - service: app-store-connect
    why: "Enable external TestFlight testing and distribute beta builds"
    env_vars:
      - name: APPLE_DEVELOPER_TEAM_ID
        source: "Apple Developer Account -> Membership -> Team ID"
      - name: ASC_API_KEY_ID
        source: "App Store Connect API Keys"
      - name: ASC_API_ISSUER_ID
        source: "App Store Connect API Keys"
      - name: ASC_API_KEY_PATH
        source: "Path to AuthKey_XXXX.p8"
    dashboard_config:
      - task: "Create TestFlight external testing group"
        location: "App Store Connect -> TestFlight -> External Testing"
      - task: "Add external testers (email invites)"
        location: "App Store Connect -> TestFlight -> Testers"
      - task: "Enable beta app review info and compliance"
        location: "App Store Connect -> TestFlight -> Beta App Review Info"
      - task: "Submit beta build for TestFlight review"
        location: "App Store Connect -> TestFlight -> Builds"

must_haves:
  truths:
    - "External TestFlight beta distribution is active"
    - "Beta testers can install and launch the app"
    - "Beta feedback channels are available to testers"
  artifacts:
    - path: ".planning/phases/13.3-beta-testing-quality-validation/13.3-TESTFLIGHT-CHECKLIST.md"
      provides: "Operational checklist for TestFlight beta rollout"
      min_lines: 25
    - path: ".planning/phases/13.3-beta-testing-quality-validation/13.3-01-USER-SETUP.md"
      provides: "Manual App Store Connect setup steps"
      min_lines: 20
  key_links:
    - from: "scripts/build-and-upload-appstore.sh"
      to: "TestFlight beta workflow"
      via: "--beta-only pathway"
      pattern: "--beta-only"
---

<objective>
Enable external TestFlight beta distribution and onboarding with a concrete rollout checklist.
</objective>

<context>
@.planning/STATE.md
@.planning/milestones/v3.0-production-deployment/REQUIREMENTS.md
@.planning/phases/09.3-cloudkit-beta-verification/BETA-01-verification-results.md
@.planning/phases/09.3-cloudkit-beta-verification/BETA-02-verification-results.md
@native/Sources/Isometry/Beta/BetaTestingManager.swift
@scripts/build-and-upload-appstore.sh
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create TestFlight rollout checklist + user setup guide</name>
  <files>
    .planning/phases/13.3-beta-testing-quality-validation/13.3-TESTFLIGHT-CHECKLIST.md
    .planning/phases/13.3-beta-testing-quality-validation/13.3-01-USER-SETUP.md
  </files>
  <action>
    Create a concise operational checklist for TestFlight external beta rollout and a USER-SETUP guide.

    Checklist must include:
    - Beta app review info completion
    - Export compliance settings
    - External testing group creation
    - Invite workflow and tester onboarding
    - Build submission and review status monitoring
    - Beta feedback collection entry points

    USER-SETUP should include environment variables, App Store Connect steps, and verification commands.
  </action>
  <verify>
    rg -n "TestFlight" .planning/phases/13.3-beta-testing-quality-validation/13.3-TESTFLIGHT-CHECKLIST.md
    rg -n "App Store Connect" .planning/phases/13.3-beta-testing-quality-validation/13.3-01-USER-SETUP.md
  </verify>
  <done>TestFlight rollout checklist and user setup guide exist and are actionable</done>
</task>

<task type="auto">
  <name>Task 2: Ensure beta-only pipeline path is documented</name>
  <files>
    scripts/build-and-upload-appstore.sh
    .planning/phases/13.3-beta-testing-quality-validation/13.3-TESTFLIGHT-CHECKLIST.md
  </files>
  <action>
    Verify scripts/build-and-upload-appstore.sh includes a clear beta-only pathway and update checklist with the exact command to run for TestFlight distribution.

    If the script needs a minimal comment or usage clarification, add it. Avoid changing pipeline behavior.
  </action>
  <verify>
    rg -n "beta-only" scripts/build-and-upload-appstore.sh
    rg -n "beta-only" .planning/phases/13.3-beta-testing-quality-validation/13.3-TESTFLIGHT-CHECKLIST.md
  </verify>
  <done>Checklist references the beta-only command and script supports it</done>
</task>

<task type="checkpoint:human-action" gate="blocking">
  <action>Enable external TestFlight beta testing</action>
  <instructions>
    1) App Store Connect → TestFlight → Beta App Review Info
    2) Create external testing group
    3) Add external testers (email invites)
    4) Upload build for TestFlight review (use beta-only pipeline)
    5) Confirm build status: "Ready to Test"
  </instructions>
  <resume-signal>Type "testflight-external-ready" when external testers can install the build</resume-signal>
</task>

</tasks>

<verification>
- Run: scripts/build-and-upload-appstore.sh --beta-only
- Confirm TestFlight build is ready for external testing
</verification>

<success_criteria>
- External TestFlight testing enabled
- Testers can install the build
- Beta onboarding instructions available
</success_criteria>
