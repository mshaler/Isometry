# Plan 73-03: SuperZoom Upper-Left Anchor

**Phase:** 73 (SuperGrid Phase A)
**Plan:** 03 of 04
**Status:** READY
**Priority:** P1 — UX critical, quick win
**Estimated Effort:** 2-4 hours

## Goal

Pin zoom behavior to upper-left corner instead of D3's default center-on-cursor behavior. Users expect spreadsheet-like zoom where the anchor stays fixed.

## Requirements Covered

- ZOOM-01: Pin zoom to upper-left corner
- ZOOM-02: Constrain pan to grid boundaries

## Current State

D3's default zoom centers on cursor position. No boundary constraints.

## Target State

- Scroll wheel zoom anchors to (0,0)
- Cannot drag past left/top edge of grid
- Grid expands/contracts from upper-left corner

## Tasks

### Task 1: Implement Pinned Zoom Transform

**Files:** `src/d3/SuperGridEngine/Renderer.ts`

**Implementation:**

```typescript
function setupZoomBehavior(
  svg: d3.Selection<SVGSVGElement, unknown, null, undefined>,
  mainGroup: d3.Selection<SVGGElement, unknown, null, undefined>,
  bounds: { width: number; height: number }
)
```

**Algorithm:**
1. On zoom event, calculate scale delta
2. If zooming (not panning), scale from origin instead of cursor
3. Apply boundary constraints

**TDD:**
1. Write test: Zoom in keeps (0,0) at (0,0)
2. Write test: Zoom out contracts toward upper-left
3. Implement transform calculation

### Task 2: Implement Boundary Constraints

**Files:** `src/d3/SuperGridEngine/Renderer.ts`

**Implementation:**

```typescript
function constrainToBounds(
  transform: d3.ZoomTransform,
  bounds: { width: number; height: number },
  scale: number
): d3.ZoomTransform
```

**Constraints:**
- `x <= 0` (can't pan past left edge)
- `y <= 0` (can't pan past top edge)
- `x >= -(scaledWidth - viewportWidth)` (can't pan past right edge)
- `y >= -(scaledHeight - viewportHeight)` (can't pan past bottom edge)

**TDD:**
1. Write test: Pan right stops at left boundary
2. Write test: Pan down stops at top boundary
3. Implement boundary clamping

### Task 3: Wire to Existing Zoom Setup

**Files:** `src/d3/SuperGridEngine/Renderer.ts`

**Integration:**
- Replace existing d3.zoom setup with pinned version
- Ensure smooth transitions (no jank)
- Preserve existing keyboard shortcuts if any

## Verification Gates

| Test | Action | Pass Criteria |
|------|--------|---------------|
| Zoom in | Scroll wheel up | Upper-left cell stays pinned, grid expands down-right |
| Zoom out | Scroll wheel down | Upper-left cell stays pinned, grid contracts |
| Pan right | Drag right | Grid moves, can't pan past left edge |
| Pan down | Drag down | Grid moves, can't pan past top edge |
| Combined | Zoom then pan | Both behaviors work correctly |

## Commit

```bash
feat(supergrid): pin zoom to upper-left corner with boundary constraints
```

## Files Modified

- `src/d3/SuperGridEngine/Renderer.ts` — Zoom behavior implementation
- `src/d3/SuperGridEngine/__tests__/Renderer.test.ts` — Unit tests
