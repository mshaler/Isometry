# Plan 73-04: Header Click Zones

**Phase:** 73 (SuperGrid Phase A)
**Plan:** 04 of 04
**Status:** READY
**Priority:** P0 — Required for header interaction
**Estimated Effort:** 1 day

## Goal

Implement zone-based hit testing for headers. Different areas of a header have different behaviors:
- **Parent label zone** (~32px): Structural operations (expand/collapse)
- **Child body zone**: Data selection (select all children)
- **Resize edge** (4px): Column/row resizing

## Requirements Covered

- ZONE-01: Hit test for click zones
- ZONE-02: Zone-based cursor state machine
- ZONE-03: Wire click handlers to zone-specific actions

## Current State

Single click handler for the entire header. No zone differentiation.

## Target State

```
┌──────────────────────────────────────┐
│  PARENT LABEL ZONE (32px)            │ ← Click: expand/collapse
├──────────────────────────────────────┤
│                                      │
│  CHILD BODY ZONE                     │ ← Click: select children
│                                      │
│                                ┃     │ ← RESIZE EDGE (4px)
└──────────────────────────────────────┘
```

## Tasks

### Task 1: Implement Hit Test Algorithm

**Files:** `src/d3/SuperGridEngine/ClickZoneManager.ts` (NEW)

**Implementation:**

```typescript
type ClickZone = 'parent-label' | 'child-body' | 'resize-edge' | 'data-cell';

interface HitTestResult {
  zone: ClickZone;
  header?: HeaderDescriptor;
  cell?: CellDescriptor;
}

function hitTest(
  point: { x: number; y: number },
  headers: HeaderDescriptor[],
  cells: CellDescriptor[],
  config: { labelHeight: number; resizeEdgeWidth: number }
): HitTestResult
```

**TDD:**
1. Write test: Point in parent label zone returns `parent-label`
2. Write test: Point in child body returns `child-body`
3. Write test: Point near right edge returns `resize-edge`
4. Write test: Point in data cell returns `data-cell`

### Task 2: Implement Cursor State Machine

**Files:** `src/d3/SuperGridEngine/ClickZoneManager.ts`

**Implementation:**

```typescript
const ZONE_CURSORS: Record<ClickZone, string> = {
  'parent-label': 'pointer',
  'child-body': 'cell',
  'resize-edge': 'col-resize',
  'data-cell': 'default'
};

function updateCursor(zone: ClickZone, svg: SVGSVGElement): void
```

**TDD:**
1. Write test: `updateCursor` sets correct cursor style
2. Wire to mousemove handler
3. Verify cursor changes at zone boundaries

### Task 3: Wire Click Handlers by Zone

**Files:** `src/d3/SuperGridEngine/Renderer.ts`, `src/d3/SuperGridEngine/index.ts`

**Implementation:**

```typescript
function handleClick(result: HitTestResult, engine: SuperGridEngine): void {
  switch (result.zone) {
    case 'parent-label':
      engine.toggleHeaderCollapsed(result.header!.id);
      break;
    case 'child-body':
      engine.selectHeaderChildren(result.header!.id);
      break;
    case 'data-cell':
      if (result.cell) {
        engine.selectCells([result.cell.id]);
      }
      break;
  }
}
```

**TDD:**
1. Write test: Parent label click calls toggleHeaderCollapsed
2. Write test: Child body click calls selectHeaderChildren
3. Write test: Data cell click calls selectCells

### Task 4: Add Hover Highlighting

**Files:** `src/d3/SuperGridEngine/Renderer.ts`

**Implementation:**
- On parent zone hover, highlight entire span boundary
- On child zone hover, highlight just that child's cell
- Selection preview: brief indication of what would be selected

## Verification Gates

| Test | Action | Pass Criteria |
|------|--------|---------------|
| Cursor: parent zone | Hover over "Q1" label | Cursor becomes pointer |
| Cursor: child zone | Hover over "Jan" body | Cursor becomes cell |
| Cursor: resize edge | Hover near right edge | Cursor becomes col-resize |
| Click: parent label | Click "Q1" label | Q1 expands/collapses |
| Click: child body | Click "Jan" body | All Jan cells selected |
| Drag: resize edge | Drag right edge | Column resizes |

## Commit Sequence

```bash
# Commit 1: Hit test logic
feat(supergrid): implement header click zone hit testing

# Commit 2: Cursor state
feat(supergrid): add zone-based cursor state machine

# Commit 3: Click behaviors
feat(supergrid): wire click handlers to zone-specific actions
```

## Files Modified

- `src/d3/SuperGridEngine/ClickZoneManager.ts` — NEW: Hit testing and cursor logic
- `src/d3/SuperGridEngine/Renderer.ts` — Wire handlers and hover effects
- `src/d3/SuperGridEngine/index.ts` — Expose zone-related API
- `src/d3/SuperGridEngine/__tests__/ClickZoneManager.test.ts` — Unit tests
