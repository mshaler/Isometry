---
phase: 09-error-elimination
plan: 03
type: execute
wave: 2
depends_on: ["09-01", "09-02"]
files_modified: [
  "src/components/CommandBar.tsx",
  "src/components/PAFVNavigator.tsx",
  "src/components/notebook/CaptureComponent.tsx",
  "src/components/__tests__/Canvas.mvp.test.tsx",
  "src/db/types.ts",
  "src/hooks/useD3.ts"
]
autonomous: true

must_haves:
  truths:
    - "No explicit `any` types in D3 operations"
    - "Proper TypeScript interfaces for D3 complex operations"
    - "Type safety maintained in data binding and transitions"
  artifacts:
    - path: "src/types/d3-types.ts"
      provides: "D3 operation type definitions"
      min_lines: 50
    - path: "src/components/CommandBar.tsx"
      provides: "Type-safe command bar component"
      contains: "CommandBarProps"
    - path: "src/hooks/useD3.ts"
      provides: "Type-safe D3 hook"
      contains: "D3Selection"
  key_links:
    - from: "src/types/d3-types.ts"
      to: "D3 components"
      via: "type imports"
      pattern: "import.*D3.*from.*d3-types"
    - from: "D3 operations"
      to: "type definitions"
      via: "generic constraints"
      pattern: "Selection<.*>"
---

<objective>
Eliminate `any` types from D3 operations and establish comprehensive type safety for complex D3 manipulations.

Purpose: Fix remaining TypeScript warnings while maintaining D3 functionality and improving type safety.
Output: Fully type-safe D3 operations with proper interfaces for selections, data binding, and transitions.
</objective>

<execution_context>
@/Users/mshaler/.claude/get-shit-done/workflows/execute-plan.md
@/Users/mshaler/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
</context>

<tasks>

<task type="auto">
  <name>Create comprehensive D3 type definitions</name>
  <files>
    src/types/d3-types.ts
  </files>
  <action>
    Create comprehensive TypeScript interfaces for D3 operations:

    1. D3 Selection types:
    - Generic Selection interfaces for DOM elements
    - Typed data binding interfaces (D3Selection<T, D, P, PDatum>)
    - Transition type definitions
    - Scale type definitions

    2. Force simulation types:
    - Node and Link interfaces for graph layouts
    - Force simulation configuration types
    - Event handler type definitions

    3. Custom scale and axis types:
    - Scale domain/range types
    - Axis configuration interfaces
    - Custom scale function types

    4. Data binding types:
    - Enter/update/exit selection types
    - Data join operation types
    - Nested selection types

    Focus on creating reusable, generic types that can be imported throughout the codebase.
  </action>
  <verify>File exists and exports at least 10 type definitions</verify>
  <done>Comprehensive D3 type definitions available for import</done>
</task>

<task type="auto">
  <name>Update D3 operations in components to use proper types</name>
  <files>
    src/components/CommandBar.tsx
    src/components/PAFVNavigator.tsx
    src/components/notebook/CaptureComponent.tsx
    src/components/__tests__/Canvas.mvp.test.tsx
  </files>
  <action>
    Replace `any` types with proper D3 type definitions:

    1. CommandBar.tsx:
    - Replace `any` with proper command handler types
    - Define interfaces for command operations
    - Add proper event handler types

    2. PAFVNavigator.tsx:
    - Replace `any` with navigation state types
    - Define proper PAFV operation interfaces
    - Add type safety for navigation callbacks

    3. CaptureComponent.tsx:
    - Replace `any` with proper capture event types
    - Define interfaces for capture operations
    - Add type safety for menu operations

    4. Canvas.mvp.test.tsx:
    - Replace test `any` types with proper mock interfaces
    - Add proper D3 selection types for test operations

    Import types from src/types/d3-types.ts and apply to D3 operations.
  </action>
  <verify>npm run lint shows no `any` type warnings in updated files</verify>
  <done>D3 operations use proper TypeScript types instead of `any`</done>
</task>

<task type="auto">
  <name>Update D3 hook and database types</name>
  <files>
    src/hooks/useD3.ts
    src/db/types.ts
  </files>
  <action>
    Complete type safety for D3 hook and database operations:

    1. useD3.ts:
    - Replace any `any` types with proper D3 selection types
    - Define proper hook return types
    - Add generic constraints for D3 operations
    - Ensure proper typing for container references

    2. db/types.ts:
    - Add any missing database operation types
    - Ensure query result types are properly defined
    - Add proper typing for performance monitoring

    Focus on creating type-safe interfaces that eliminate remaining `any` usage while maintaining functionality.
  </action>
  <verify>npm run typecheck passes with no `any` type issues</verify>
  <done>D3 hook and database operations are fully type-safe</done>
</task>

</tasks>

<verification>
- npm run lint should show dramatically reduced `any` type warnings
- npm run typecheck should pass without D3-related type errors
- All D3 operations should have proper TypeScript interfaces
</verification>

<success_criteria>
- Zero `any` types in D3 operations
- Comprehensive D3 type definitions available
- All complex D3 manipulations properly typed
- TypeScript compilation succeeds for all D3 usage
</success_criteria>

<output>
After completion, create `.planning/phases/09-error-elimination/09-03-SUMMARY.md`
</output>