---
phase: 79-catalog-browser
plan: 03
type: execute
wave: 2
depends_on: [79-02]
files_modified:
  - src/components/catalog/FilterBreadcrumb.tsx
  - src/components/layout/Header.tsx
autonomous: true

must_haves:
  truths:
    - "Breadcrumb shows active filter path"
    - "Click segment removes deeper filters"
    - "Clear all button removes all filters"
    - "Empty state shows 'All Cards'"
  artifacts:
    - path: "src/components/catalog/FilterBreadcrumb.tsx"
      provides: "Filter breadcrumb navigation"
      exports: ["FilterBreadcrumb"]
---

<objective>
Implement breadcrumb navigation showing current filter state.

Purpose: Give users a clear visual representation of active filters with easy navigation back to parent or clear state.

Output: FilterBreadcrumb component integrated into header/toolbar.
</objective>

<context>
@.planning/phases/79-catalog-browser/79-02-PLAN.md
@src/state/FilterContext.tsx
@src/components/layout/Header.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create FilterBreadcrumb component</name>
  <files>src/components/catalog/FilterBreadcrumb.tsx</files>
  <action>
Create breadcrumb component:

```typescript
import React, { useCallback, useMemo } from 'react';
import { ChevronRight, X, Home } from 'lucide-react';
import { useFilters } from '../../state/FilterContext';
import { cn } from '../../lib/utils';

interface BreadcrumbSegment {
  type: 'folder' | 'tag' | 'status' | 'search';
  value: string;
  label: string;
}

export function FilterBreadcrumb() {
  const { filters, setFilters, clearFilters } = useFilters();

  // Build breadcrumb segments from active filters
  const segments = useMemo<BreadcrumbSegment[]>(() => {
    const result: BreadcrumbSegment[] = [];

    // Folder path segments
    if (filters.folder) {
      const parts = filters.folder.split('/');
      let path = '';
      parts.forEach(part => {
        path = path ? `${path}/${part}` : part;
        result.push({
          type: 'folder',
          value: path,
          label: part
        });
      });
    }

    // Status filter
    if (filters.status) {
      result.push({
        type: 'status',
        value: filters.status,
        label: `Status: ${filters.status}`
      });
    }

    // Tags (show first 3)
    if (filters.tags?.length) {
      filters.tags.slice(0, 3).forEach(tag => {
        result.push({
          type: 'tag',
          value: tag,
          label: `#${tag}`
        });
      });
      if (filters.tags.length > 3) {
        result.push({
          type: 'tag',
          value: '',
          label: `+${filters.tags.length - 3} more`
        });
      }
    }

    // Search query
    if (filters.search) {
      result.push({
        type: 'search',
        value: filters.search,
        label: `"${filters.search}"`
      });
    }

    return result;
  }, [filters]);

  const handleSegmentClick = useCallback((segment: BreadcrumbSegment) => {
    switch (segment.type) {
      case 'folder':
        // Navigate to this folder level (removes deeper paths)
        setFilters(prev => ({ ...prev, folder: segment.value }));
        break;
      case 'status':
        // Remove status filter
        setFilters(prev => ({ ...prev, status: undefined }));
        break;
      case 'tag':
        // Remove this tag
        if (segment.value) {
          setFilters(prev => ({
            ...prev,
            tags: prev.tags?.filter(t => t !== segment.value)
          }));
        }
        break;
      case 'search':
        // Clear search
        setFilters(prev => ({ ...prev, search: undefined }));
        break;
    }
  }, [setFilters]);

  const handleClearAll = useCallback(() => {
    clearFilters();
  }, [clearFilters]);

  const handleGoHome = useCallback(() => {
    clearFilters();
  }, [clearFilters]);

  // Empty state
  if (segments.length === 0) {
    return (
      <div className="flex items-center gap-2 text-sm text-gray-500">
        <Home className="w-4 h-4" />
        <span>All Cards</span>
      </div>
    );
  }

  return (
    <nav className="flex items-center gap-1 text-sm">
      {/* Home button */}
      <button
        onClick={handleGoHome}
        className="p-1 rounded hover:bg-gray-100 dark:hover:bg-gray-800 text-gray-500"
        title="Clear all filters"
      >
        <Home className="w-4 h-4" />
      </button>

      {segments.map((segment, index) => (
        <React.Fragment key={`${segment.type}-${segment.value}-${index}`}>
          <ChevronRight className="w-4 h-4 text-gray-300" />

          <button
            onClick={() => handleSegmentClick(segment)}
            className={cn(
              'px-2 py-1 rounded flex items-center gap-1 hover:bg-gray-100 dark:hover:bg-gray-800',
              segment.type === 'folder' && 'text-blue-600',
              segment.type === 'tag' && 'text-green-600',
              segment.type === 'status' && 'text-purple-600',
              segment.type === 'search' && 'text-orange-600'
            )}
            title={`Click to ${segment.type === 'folder' ? 'navigate to' : 'remove'} ${segment.label}`}
          >
            <span>{segment.label}</span>
            {segment.type !== 'folder' && <X className="w-3 h-3 opacity-50 hover:opacity-100" />}
          </button>
        </React.Fragment>
      ))}

      {/* Clear all button */}
      {segments.length > 1 && (
        <>
          <span className="mx-2 text-gray-300">|</span>
          <button
            onClick={handleClearAll}
            className="text-xs text-gray-500 hover:text-gray-700 underline"
          >
            Clear all
          </button>
        </>
      )}
    </nav>
  );
}

export default FilterBreadcrumb;
```
  </action>
  <verify>Component renders breadcrumb segments</verify>
  <done>FilterBreadcrumb component created</done>
</task>

<task type="auto">
  <name>Task 2: Add clearFilters to FilterContext</name>
  <files>src/state/FilterContext.tsx</files>
  <action>
Ensure FilterContext exports a clearFilters function:

```typescript
// Add to FilterContextType interface:
clearFilters: () => void;

// Add to FilterProvider:
const clearFilters = useCallback(() => {
  setFilters(defaultFilters);
}, []);

// Add to context value:
<FilterContext.Provider value={{ filters, setFilters, clearFilters }}>
```

If already exists, verify it resets to default state.
  </action>
  <verify>clearFilters exported from context</verify>
  <done>clearFilters available in context</done>
</task>

<task type="auto">
  <name>Task 3: Integrate breadcrumb into Header</name>
  <files>src/components/layout/Header.tsx</files>
  <action>
Add FilterBreadcrumb to the header or toolbar:

```typescript
import { FilterBreadcrumb } from '../catalog/FilterBreadcrumb';

// In Header component render:
<div className="flex items-center gap-4">
  <FilterBreadcrumb />
  {/* ... other header content */}
</div>
```

Place after logo/title, before actions.
If Header doesn't exist, add to App.tsx toolbar area.
  </action>
  <verify>Breadcrumb visible in header</verify>
  <done>Breadcrumb integrated into layout</done>
</task>

<task type="auto">
  <name>Task 4: Write breadcrumb tests</name>
  <files>src/components/catalog/__tests__/FilterBreadcrumb.test.tsx</files>
  <action>
Create tests:

```typescript
import { describe, it, expect, vi } from 'vitest';
import { render, screen, fireEvent } from '@testing-library/react';
import { FilterBreadcrumb } from '../FilterBreadcrumb';
import { FilterProvider } from '../../../state/FilterContext';

// Mock FilterContext
const mockSetFilters = vi.fn();
const mockClearFilters = vi.fn();

vi.mock('../../../state/FilterContext', () => ({
  useFilters: () => ({
    filters: {
      folder: 'work/projects',
      tags: ['urgent'],
      status: 'active'
    },
    setFilters: mockSetFilters,
    clearFilters: mockClearFilters
  })
}));

describe('FilterBreadcrumb', () => {
  it('renders folder path segments', () => {
    render(<FilterBreadcrumb />);

    expect(screen.getByText('work')).toBeInTheDocument();
    expect(screen.getByText('projects')).toBeInTheDocument();
  });

  it('renders tag filters', () => {
    render(<FilterBreadcrumb />);

    expect(screen.getByText('#urgent')).toBeInTheDocument();
  });

  it('renders status filter', () => {
    render(<FilterBreadcrumb />);

    expect(screen.getByText('Status: active')).toBeInTheDocument();
  });

  it('shows clear all when multiple filters', () => {
    render(<FilterBreadcrumb />);

    expect(screen.getByText('Clear all')).toBeInTheDocument();
  });

  it('calls clearFilters on clear all click', () => {
    render(<FilterBreadcrumb />);

    fireEvent.click(screen.getByText('Clear all'));
    expect(mockClearFilters).toHaveBeenCalled();
  });

  it('navigates to folder on segment click', () => {
    render(<FilterBreadcrumb />);

    fireEvent.click(screen.getByText('work'));
    expect(mockSetFilters).toHaveBeenCalledWith(expect.any(Function));
  });
});
```
  </action>
  <verify>npm run test -- FilterBreadcrumb passes</verify>
  <done>Breadcrumb tests written</done>
</task>

</tasks>

<verification>
1. Breadcrumb shows all active filters
2. Clicking folder segment navigates to that level
3. Clicking tag/status removes that filter
4. Clear all resets to default state
5. Empty state shows "All Cards"
</verification>

<success_criteria>
- CAT-03 satisfied: Breadcrumb navigation works
- Visual filter path representation
- Click to navigate/remove
- Clear all functionality
</success_criteria>
