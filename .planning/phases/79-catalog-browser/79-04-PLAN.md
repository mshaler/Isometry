---
phase: 79-catalog-browser
plan: 04
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/catalog/CollapsibleCatalogSidebar.tsx
  - src/components/catalog/index.ts
  - src/components/IntegratedLayout.tsx
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "Clicking folder/tag/status in CatalogBrowser filters SuperGrid cards via FilterContext"
    - "Breadcrumb shows active filter path with clear-all option"
    - "CatalogBrowser visible in collapsible application sidebar"
    - "FilterBreadcrumb visible below command bar"
    - "Collapse/expand toggle controls sidebar visibility"
  artifacts:
    - path: "src/components/catalog/CollapsibleCatalogSidebar.tsx"
      provides: "Collapsible sidebar wrapper for CatalogBrowser"
      exports: ["CollapsibleCatalogSidebar"]
    - path: "src/components/IntegratedLayout.tsx"
      provides: "Integrated layout with catalog sidebar and breadcrumb"
      contains: ["import { CollapsibleCatalogSidebar, FilterBreadcrumb }", "<CollapsibleCatalogSidebar", "<FilterBreadcrumb"]
  key_links:
    - from: "IntegratedLayout.tsx"
      to: "src/components/catalog/CollapsibleCatalogSidebar.tsx"
      via: "import and render"
      pattern: "import.*CollapsibleCatalogSidebar.*catalog"
    - from: "IntegratedLayout.tsx"
      to: "src/components/catalog/FilterBreadcrumb.tsx"
      via: "import and render"
      pattern: "import.*FilterBreadcrumb.*catalog"
    - from: "CollapsibleCatalogSidebar.tsx"
      to: "src/components/catalog/CatalogBrowser.tsx"
      via: "import and render"
      pattern: "import.*CatalogBrowser"
---

<objective>
Integrate CatalogBrowser and FilterBreadcrumb into IntegratedLayout.tsx to close verification gaps from Phase 79.

Purpose: The catalog browser components were fully implemented and tested but never added to the main application layout. Users cannot access the catalog browsing UI or see the filter breadcrumb.

Output: CollapsibleCatalogSidebar component wrapping CatalogBrowser with collapse state, integrated into IntegratedLayout.tsx alongside FilterBreadcrumb.
</objective>

<execution_context>
@/Users/mshaler/.claude/get-shit-done/workflows/execute-plan.md
@/Users/mshaler/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/79-catalog-browser/79-VERIFICATION.md
@src/components/IntegratedLayout.tsx
@src/components/catalog/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create CollapsibleCatalogSidebar component</name>
  <files>src/components/catalog/CollapsibleCatalogSidebar.tsx, src/components/catalog/index.ts</files>
  <action>
    1. Create new file `src/components/catalog/CollapsibleCatalogSidebar.tsx`:

    ```typescript
    import React, { useState } from 'react';
    import { ChevronLeft, ChevronRight } from 'lucide-react';
    import { CatalogBrowser } from './CatalogBrowser';
    import { useTheme } from '@/contexts/ThemeContext';

    interface CollapsibleCatalogSidebarProps {
      defaultOpen?: boolean;
    }

    export function CollapsibleCatalogSidebar({ defaultOpen = true }: CollapsibleCatalogSidebarProps) {
      const [isOpen, setIsOpen] = useState(defaultOpen);
      const { theme } = useTheme();

      const isNeXTSTEP = theme === 'NeXTSTEP';
      const panelBg = isNeXTSTEP ? 'bg-[#252525]' : 'bg-white';
      const borderColor = isNeXTSTEP ? 'border-[#3A3A3A]' : 'border-gray-200';
      const textColor = isNeXTSTEP ? 'text-[#E0E0E0]' : 'text-gray-900';
      const mutedColor = isNeXTSTEP ? 'text-[#999]' : 'text-gray-500';
      const hoverBg = isNeXTSTEP ? 'hover:bg-[#3A3A3A]' : 'hover:bg-gray-100';

      if (!isOpen) {
        // Collapsed state: show expand button
        return (
          <div className={`flex items-center ${panelBg} border-r ${borderColor}`}>
            <button
              type="button"
              onClick={() => setIsOpen(true)}
              className={`p-2 ${hoverBg} ${mutedColor}`}
              title="Show catalog"
            >
              <ChevronRight className="w-4 h-4" />
            </button>
          </div>
        );
      }

      // Expanded state: show sidebar with CatalogBrowser
      return (
        <div className={`w-64 ${panelBg} border-r ${borderColor} overflow-y-auto flex flex-col`}>
          <div className={`flex items-center justify-between px-3 py-2 border-b ${borderColor}`}>
            <span className={`text-xs font-medium ${textColor}`}>Catalog</span>
            <button
              type="button"
              onClick={() => setIsOpen(false)}
              className={`p-1 rounded ${hoverBg} ${mutedColor}`}
              title="Hide catalog"
            >
              <ChevronLeft className="w-4 h-4" />
            </button>
          </div>
          <div className="flex-1 overflow-y-auto">
            <CatalogBrowser />
          </div>
        </div>
      );
    }
    ```

    2. Update `src/components/catalog/index.ts` to export CollapsibleCatalogSidebar:
       - Add: `export { CollapsibleCatalogSidebar } from './CollapsibleCatalogSidebar';`

    Note: This component encapsulates the collapse/expand logic and theme styling,
    keeping IntegratedLayout.tsx changes minimal (~15 lines).
  </action>
  <verify>
    - `npm run typecheck` passes
    - CollapsibleCatalogSidebar exported from catalog index
    - ChevronLeft and ChevronRight imported from lucide-react
  </verify>
  <done>CollapsibleCatalogSidebar component with collapse/expand toggle created and exported</done>
</task>

<task type="auto">
  <name>Task 2: Integrate FilterBreadcrumb and CollapsibleCatalogSidebar into IntegratedLayout</name>
  <files>src/components/IntegratedLayout.tsx</files>
  <action>
    1. Add import at top of file (after existing imports):
       `import { CollapsibleCatalogSidebar, FilterBreadcrumb } from './catalog';`

    2. Add FilterBreadcrumb row after the command bar section (locate "Command Bar (top)" comment,
       insert after the closing div of that section):
       ```tsx
       {/* Filter Breadcrumb */}
       <div className={`h-8 ${panelBg} border-b ${borderColor} flex items-center px-4`}>
         <FilterBreadcrumb />
       </div>
       ```
       The breadcrumb shows "All Cards" when no filters are active, or a navigable path
       with clear-all option when filters exist.

    3. Restructure the SuperGrid container area (locate "SuperGrid Canvas - MAXIMIZED" comment):
       - Wrap in a horizontal flex container
       - Add CollapsibleCatalogSidebar on the left
       - SuperGrid takes remaining space

       Before:
       ```tsx
       {/* SuperGrid Canvas - MAXIMIZED with scroll */}
       <div className="flex-1 min-h-0 overflow-auto relative" style={{ minHeight: '200px' }}>
       ```

       After:
       ```tsx
       {/* Content Area: Catalog Sidebar + SuperGrid */}
       <div className="flex-1 min-h-0 flex">
         {/* Catalog Sidebar */}
         <CollapsibleCatalogSidebar />

         {/* SuperGrid Canvas - MAXIMIZED with scroll */}
         <div className="flex-1 overflow-auto relative" style={{ minHeight: '200px' }}>
       ```

    Note: CatalogBrowser uses FilterContext.setFilters updater to modify folder/tags/status
    fields, which triggers SuperGrid reactivity via activeFilters. No additional wiring needed.
  </action>
  <verify>
    - `npm run typecheck` passes
    - IntegratedLayout.tsx imports CollapsibleCatalogSidebar and FilterBreadcrumb from './catalog'
    - FilterBreadcrumb renders between command bar and dataset switcher
    - CollapsibleCatalogSidebar renders as left sidebar containing CatalogBrowser
    - Clicking collapse/expand button toggles sidebar visibility
    - SuperGrid still takes remaining horizontal space
  </verify>
  <done>IntegratedLayout renders catalog sidebar and breadcrumb; file remains under 500 lines by extracting sidebar to separate component</done>
</task>

</tasks>

<verification>
After completion:
1. Run `npm run typecheck` - must pass with zero errors
2. Run `npm run dev` and verify:
   - FilterBreadcrumb visible below command bar showing "All Cards"
   - CatalogBrowser visible in left sidebar (collapsible)
   - Click collapse button -> sidebar collapses to narrow strip with expand button
   - Click expand button -> sidebar expands showing CatalogBrowser
   - Click any folder in CatalogBrowser -> FilterBreadcrumb updates to show that folder
   - Click any tag -> FilterBreadcrumb shows tag
   - Click Clear All in breadcrumb -> returns to "All Cards"
3. SuperGrid renders correctly beside sidebar in both collapsed/expanded states
</verification>

<success_criteria>
- IntegratedLayout imports CollapsibleCatalogSidebar and FilterBreadcrumb from './catalog'
- FilterBreadcrumb renders below command bar
- CollapsibleCatalogSidebar renders in left sidebar position
- Clicking facets updates breadcrumb (proves FilterContext wiring works)
- Collapse/expand toggle works
- IntegratedLayout.tsx stays under 500 lines (sidebar logic extracted)
- `npm run typecheck` passes
</success_criteria>

<output>
After completion, create `.planning/phases/79-catalog-browser/79-04-SUMMARY.md`
</output>
