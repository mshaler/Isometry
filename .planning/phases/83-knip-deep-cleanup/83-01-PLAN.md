# Plan 83-01: Dependency Chain Analysis & Safe Deletions

**Phase:** 83 (Knip Deep Cleanup)
**Plan:** 01
**Status:** COMPLETE
**Requirements:** KNIP-01, KNIP-02

## Objective

Analyze the remaining 209 unused files identified by Knip, map their dependency chains, and safely delete files that won't break the build.

## Key Learning

**Knip's "unused files" are NOT safe to blindly delete.**

Knip identifies files not reached from configured entry points, but:
1. TypeScript's import resolution is transitive - "unused" files may be imported by other "unused" files that ARE compiled
2. Barrel exports (index.ts) create chains where deleting one file breaks the entire barrel
3. The 209 "unused" files include many that are actually needed by the build

**Attempted aggressive deletion:** Tried deleting 98 chain-safe files → broke 20+ index.ts barrel exports → had to revert.

## Revised Approach

Instead of file deletion, focus on:
1. **Barrel export cleanup** - Remove dead exports from index.ts files (keeps files, fixes unused export warnings)
2. **Entry point configuration** - Update Knip config to recognize more entry points
3. **Manual review** - Identify truly orphaned files one at a time with human verification

## Current State

- **Unused files:** 209 (down from 287 after initial cleanup)
- **Initial cleanup deleted:** 78 files, 16,869 lines

### Largest Clusters (from Knip analysis)

| Directory | Unused Files | Notes |
|-----------|--------------|-------|
| `src/components/views/` | 20 | View components |
| `src/components/ui/` | 19 | UI primitives |
| `src/utils/d3-visualization/` | 10 | D3 utilities |
| `src/utils/database/` | 9 | DB utilities |
| `src/hooks/database/` | 5 | DB hooks |
| `src/hooks/data/` | 5 | Data hooks |
| `src/db/services/` | 5 | DB services |
| `src/d3/SuperDensityRenderer/` | 5 | Old renderer |
| `src/components/supergrid/` | 5 | SuperGrid components |

## Approach

### Phase 1: Safe Deletions (No Import Chain)
Files with zero imports from any other file - can be deleted immediately.

### Phase 2: Chain Deletions
Files that are only imported by other unused files - delete entire chains.

### Phase 3: Manual Review
Files with complex import patterns requiring case-by-case analysis.

## Implementation Steps

1. [ ] Generate full dependency map with `grep` for each unused file
2. [ ] Categorize into Safe/Chain/Manual
3. [ ] Delete Safe files
4. [ ] Delete Chain files (bottom-up)
5. [ ] Verify build after each batch
6. [ ] Document Manual review items

## Success Criteria

- [ ] Unused file count reduced to < 150
- [ ] TypeScript compiles with no errors
- [ ] No regression in test failures

## Files to Analyze

See execution output for categorized file list.
