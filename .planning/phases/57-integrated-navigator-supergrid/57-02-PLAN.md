# Plan 57-02: LATCH Sliders Implementation

## Summary

Implement functional LATCH Sliders for the Integrated Layout. Focuses on P1 (broken range sliders) and P2 (data-bound controls) from FIGMA-REVIEW-PUNCHLIST.md.

## Context

**Current State (Figma Export):**
- Collapsible panel structure: âœ…
- 5 slider rows with LATCH icons/colors: âœ…
- Time histogram: Static, hardcoded bars
- Dual-range sliders: Broken (overlapping inputs)
- Category chips: Flat list, no grouping
- No data binding to FilterContext

**Priority per Punchlist:**
- P1: Fix dual-thumb range sliders (Time, Hierarchy)
- P2: Time histogram with real data
- P2: Category multi-facet sub-sections
- P2: Alphabet value checklist (deferred - complex)
- P3: Location mini-map (deferred - requires map tiles)

## Scope

### In Scope
1. Create RangeSlider component (dual-thumb slider)
2. Port LATCHSliders from Figma with fixes
3. Wire Time slider to real card data
4. Wire Category slider to facet values
5. Integrate with IntegratedLayout
6. Connect to LATCHFilterService

### Out of Scope (Phase 57-03+)
- Alphabet Excel-style checklist (complex)
- Location mini-map (requires Mapbox/Leaflet)
- Non-contiguous time selection
- Hierarchy histogram distribution

## Tasks

### Task 1: Create RangeSlider Component
**File:** `src/components/ui/RangeSlider.tsx` (NEW)

Custom dual-thumb range slider replacing broken overlapping inputs.

```tsx
interface RangeSliderProps {
  min: number;
  max: number;
  value: [number, number];
  onChange: (value: [number, number]) => void;
  step?: number;
  className?: string;
}
```

**Implementation:**
- Single track element with two draggable thumb elements
- Proper event handling (no conflicting inputs)
- Visual: highlighted range between thumbs
- Theme-aware styling (NeXTSTEP)

**Acceptance:**
- Both thumbs independently draggable
- Range highlight updates in real-time
- No mouse event conflicts

### Task 2: Create LATCHSliders Component
**File:** `src/components/LATCHSliders.tsx` (NEW)

Port Figma LatchSliders with fixes and data binding.

**Structure:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [LATCH Filters â–²] L A T C H icons               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ“ Location  â”‚ [Text DSL input]           â”‚ âœ•  â”‚
â”‚ ğŸ”¤ Alphabet  â”‚ [Search] [Property â–¾]      â”‚ âœ•  â”‚
â”‚ â±  Time      â”‚ [Histogram] [RangeSlider]  â”‚ âœ•  â”‚
â”‚ ğŸ·  Category  â”‚ [Folder][Tags][Status]     â”‚ âœ•  â”‚
â”‚ ğŸ“Š Hierarchy â”‚ [Gradient] [RangeSlider]   â”‚ âœ•  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Per-slider details:**

1. **Location** (placeholder for now)
   - Text input with DSL hint
   - Clear button

2. **Alphabet** (basic version)
   - Search input
   - Property selector dropdown
   - (Excel checklist deferred to 57-03)

3. **Time** (data-bound)
   - Histogram from card timestamps
   - RangeSlider for date range
   - Preset shortcuts (Today, This Week, etc.)

4. **Category** (multi-facet)
   - Sub-sections: Folder, Tags, Status
   - Chips with selection state
   - AND/OR toggle

5. **Hierarchy** (enhanced)
   - Property selector (Priority, Importance)
   - Gradient bar with tick labels
   - RangeSlider

### Task 3: Wire Time Slider to Data
**Files:**
- `src/components/LATCHSliders.tsx`
- `src/hooks/data/useTimeDistribution.ts` (NEW)

**useTimeDistribution hook:**
```typescript
interface TimeDistribution {
  buckets: Array<{ start: Date; end: Date; count: number }>;
  minDate: Date;
  maxDate: Date;
  totalCount: number;
}

function useTimeDistribution(facet: string): TimeDistribution
```

**Behavior:**
- Query card timestamps from sql.js
- Aggregate into buckets (auto-granularity: year/quarter/month/week)
- Return distribution for histogram rendering

### Task 4: Wire Category Slider to Facets
**Files:**
- `src/components/LATCHSliders.tsx`
- `src/hooks/data/useFacetValues.ts` (NEW)

**useFacetValues hook:**
```typescript
interface FacetValue {
  value: string;
  count: number;
}

function useFacetValues(facet: string): FacetValue[]
```

**Category sub-sections:**
- Folder: useFacetValues('folder')
- Tags: useFacetValues('tags')
- Status: useFacetValues('status')

### Task 5: Connect to LATCHFilterService
**Files:**
- `src/components/LATCHSliders.tsx`
- `src/components/IntegratedLayout.tsx`

**Integration:**
```tsx
// LATCHSliders receives filter callbacks
<LATCHSliders
  filterService={filterService}
  onFilterChange={(filters) => superGrid?.query(filterService.compileToSQL())}
/>
```

**Filter operations:**
- Time range â†’ `addFilter({ axis: 'T', facet: 'created_at', ... })`
- Category selection â†’ `addFilter({ axis: 'C', facet: 'folder', ... })`
- Clear button â†’ `removeFilter(id)`

### Task 6: Integrate with IntegratedLayout
**File:** `src/components/IntegratedLayout.tsx`

Replace placeholder with actual LATCHSliders component.

**Acceptance:**
- Sliders visible in bottom panel
- Expand/collapse works
- Filter changes update SuperGrid

## Verification

```bash
npm run typecheck
npm run test
npm run dev
# Navigate to /?test=integrated
# Verify:
# 1. LATCH Sliders expand/collapse
# 2. Time histogram shows real distribution
# 3. Time range slider works (drag both thumbs)
# 4. Category chips toggle selection
# 5. Filter changes update SuperGrid
```

## Files Changed

| File | Action | Description |
|------|--------|-------------|
| `src/components/ui/RangeSlider.tsx` | CREATE | Dual-thumb range slider |
| `src/components/LATCHSliders.tsx` | CREATE | Full LATCH slider panel |
| `src/hooks/data/useTimeDistribution.ts` | CREATE | Time histogram data hook |
| `src/hooks/data/useFacetValues.ts` | CREATE | Facet value counts hook |
| `src/components/IntegratedLayout.tsx` | MODIFY | Replace placeholder |

## Dependencies

- RangeSlider needs no external libs (pure React/CSS)
- Time distribution needs sql.js access via useDatabaseService
- LATCHFilterService already exists

## Estimated Complexity

Medium-High â€” Custom RangeSlider component + data binding hooks.

---

*Plan: 57-02*
*Phase: 57 - Integrated Navigator + SuperGrid + Sliders*
*Status: COMPLETE*
*Executed: 2026-02-11*

## Execution Notes

All 6 tasks completed:
- Task 1: RangeSlider.tsx created with dual-thumb support
- Task 2: LATCHSliders.tsx created with 5 slider rows
- Task 3: useTimeDistribution.ts created with auto-granularity
- Task 4: useFacetValues.ts created with facet counts
- Task 5: LATCHFilterService integration complete
- Task 6: IntegratedLayout integration complete

TypeScript: PASS (0 errors)
ESLint: 0 errors, warnings within budget
