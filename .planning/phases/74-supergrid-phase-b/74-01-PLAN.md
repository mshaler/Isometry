# Plan 74-01: SuperDynamic — Axis Repositioning

**Phase:** 74 (SuperGrid Phase B)
**Status:** IN PROGRESS
**Created:** 2026-02-12
**Goal:** Enable drag-and-drop axis repositioning to transpose rows ↔ columns

## Context

SuperDynamic enables the PAFV principle "any axis maps to any plane" as a direct manipulation interaction. Users drag column headers to become row headers and vice versa, triggering grid reflow.

## Requirements (from Spec Section 2.2)

- Drag column header → row header area triggers grid reflow from insertion point
- Visual cues during drag: ghost header, insertion indicator, drop zone highlighting
- Grid reflows with D3 transition after drop
- Axis assignments update PAFV state (propagates to FilterNav and all consumers)
- Cancel drag via Escape key returns header to original position

## Approach

### Files to Create
1. `src/d3/SuperGridEngine/DragManager.ts` — Encapsulates D3 drag behavior
2. `src/d3/SuperGridEngine/__tests__/DragManager.test.ts` — Unit tests

### Files to Modify
1. `src/d3/SuperGridEngine/index.ts` — Wire DragManager into engine
2. `src/d3/SuperGridEngine/Renderer.ts` — Add drag handles to headers
3. `src/d3/SuperGridEngine/HeaderManager.ts` — Update header data for drag state
4. `src/contexts/PAFVContext.tsx` — Add `swapPlaneMapping()` action

## Implementation Steps

### Step 1: Create DragManager skeleton
- Define `DragManager` class with `setupHeaderDrag()` method
- Export from SuperGridEngine index
- Test: instantiation works

### Step 2: Implement drag behavior
- Use `d3.drag()` for header elements
- Track drag source (x-axis or y-axis header)
- Create ghost element during drag
- Test: drag start creates ghost

### Step 3: Implement drop zones
- Calculate drop zone boundaries for x-axis and y-axis areas
- Highlight drop zone when dragged over
- Test: hovering over opposite axis highlights drop zone

### Step 4: Implement axis swap
- On drop in opposite zone, call `swapPlaneMapping()`
- Trigger grid re-render with new projection
- Animate reflow with D3 transition
- Test: dropping header in opposite zone transposes grid

### Step 5: Handle cancel
- Escape key during drag returns to original position
- Release outside drop zones cancels drag
- Test: Escape cancels drag without state change

## Testing Criteria

| Test | Input | Expected |
|------|-------|----------|
| Transpose 2D grid | Drag x-axis header to y-axis | Rows become columns |
| Cancel drag | Start drag, press Escape | Header returns to original position |
| Reflow animation | Complete axis drop | Grid reflows with transition < 500ms |
| PAFV state update | Drop header | FilterNav reflects new axis mapping |

## Verification

```bash
npm run test -- src/d3/SuperGridEngine/__tests__/DragManager.test.ts
npm run typecheck
npm run check
```

## Notes

- DragManager follows same pattern as ClickZoneManager
- Ghost element uses 50% opacity for visibility during drag
- Drop zone highlighting uses theme-aware colors
