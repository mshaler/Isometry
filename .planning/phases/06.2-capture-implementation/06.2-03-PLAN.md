---
phase: 06.2-capture-implementation
plan: 03
type: execute
wave: 1
depends_on: []
files_modified: [
  "native/Sources/Isometry/Views/Notebook/TemplateGallery.swift",
  "native/Sources/Isometry/Views/Notebook/TemplateCard.swift",
  "native/Sources/Isometry/Models/NotebookTemplate.swift",
  "native/Sources/Isometry/Models/TemplateManager.swift"
]
autonomous: true

must_haves:
  truths:
    - "User can browse available templates in native collection view"
    - "User can create new cards from templates with pre-filled content"
    - "User can save custom templates from existing cards"
    - "Built-in templates provide professional starting points"
  artifacts:
    - path: "native/Sources/Isometry/Views/Notebook/TemplateGallery.swift"
      provides: "Native collection view for template browsing and selection"
      min_lines: 100
    - path: "native/Sources/Isometry/Models/NotebookTemplate.swift"
      provides: "Template data model with content and properties"
      exports: ["NotebookTemplate", "TemplateCategory"]
    - path: "native/Sources/Isometry/Models/TemplateManager.swift"
      provides: "Template storage and management with built-in templates"
      exports: ["TemplateManager", "BuiltinTemplates"]
  key_links:
    - from: "native/Sources/Isometry/Views/Notebook/TemplateGallery.swift"
      to: "TemplateManager.createCard"
      via: "template selection trigger"
      pattern: "createCard.*fromTemplate"
    - from: "native/Sources/Isometry/Models/TemplateManager.swift"
      to: "Core Data or Documents directory"
      via: "custom template persistence"
      pattern: "save.*custom.*template"
---

<objective>
Implement native template system using collection views for rapid card creation with professional built-in templates and custom template support

Purpose: Accelerate content creation through reusable templates while maintaining native performance and user experience
Output: Template gallery integrated into notebook workflow with built-in and custom templates
</objective>

<execution_context>
@/Users/mshaler/.claude/get-shit-done/workflows/execute-plan.md
@/Users/mshaler/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/02-capture-implementation/02-SUMMARY.md
@native/Sources/Isometry/Models/NotebookCard.swift
@src/components/notebook/TemplateManager.tsx
@src/types/notebook.ts
@src/hooks/useSlashCommands.ts
</context>

<tasks>

<task type="auto">
  <name>Create Template Data Model</name>
  <files>native/Sources/Isometry/Models/NotebookTemplate.swift</files>
  <action>
    Create comprehensive template data model with content and metadata:

    1. Define NotebookTemplate struct with:
       - id: String (UUID for custom, constants for built-in)
       - title: String (display name)
       - description: String (template purpose and usage)
       - category: TemplateCategory (meeting, code, project, etc.)
       - markdownContent: String (template markdown with placeholders)
       - properties: [String: String] (default property values)
       - isBuiltIn: Bool (distinguishes built-in from custom)
       - createdAt: Date, modifiedAt: Date
       - usage Count: Int (popularity tracking)
    2. Implement TemplateCategory enum:
       - meeting (standup, retrospective, planning)
       - code (snippet, documentation, bug report)
       - project (proposal, status, roadmap)
       - research (analysis, findings, hypothesis)
       - general (note, todo, journal)
    3. Add template operations:
       - applyToCard(NotebookCard) -> NotebookCard (creates card from template)
       - createFromCard(NotebookCard) -> NotebookTemplate (saves as template)
       - validateTemplate() -> checks for required fields
       - extractPlaceholders() -> finds {{placeholder}} tokens
    4. Implement template placeholders:
       - Support {{date}}, {{time}}, {{username}} auto-replacement
       - Custom placeholders for user input during creation
       - Placeholder validation and type checking
       - Smart placeholder suggestions based on context
    5. Add Codable conformance:
       - JSON serialization for custom template storage
       - Backward compatibility for template format changes
       - Export/import functionality for template sharing
    6. Performance optimizations:
       - Lazy loading for template content
       - Template content caching for frequently used templates
       - Efficient placeholder replacement algorithm

    Pattern: Follow React template system design from TemplateManager.tsx.
    Storage: Prepare for both document directory and potential CloudKit sync.
  </action>
  <verify>Template model compiles with placeholder replacement and category organization</verify>
  <done>NotebookTemplate provides complete template data model with placeholders and categorization</done>
</task>

<task type="auto">
  <name>Create Template Manager</name>
  <files>native/Sources/Isometry/Models/TemplateManager.swift</files>
  <action>
    Create template management system with built-in templates and custom template storage:

    1. Implement TemplateManager ObservableObject with:
       - @Published templates: [NotebookTemplate] (all available templates)
       - @Published builtInTemplates: [NotebookTemplate] (read-only defaults)
       - @Published customTemplates: [NotebookTemplate] (user created)
       - @Published favoriteTemplateIds: Set<String> (user favorites)
    2. Create built-in template library (matching React prototype):
       - Meeting Notes: standup template with attendees, topics, actions
       - Code Snippet: code block with language, description, usage
       - Project Plan: goals, milestones, timeline, resources
       - Research Notes: hypothesis, methodology, findings, conclusions
       - Bug Report: steps to reproduce, expected vs actual, environment
       - Retrospective: went well, could improve, action items
    3. Implement custom template operations:
       - saveCustomTemplate(NotebookTemplate) -> persists to document directory
       - deleteCustomTemplate(id) -> removes with confirmation
       - duplicateTemplate(id) -> creates copy for modification
       - exportTemplate(id) -> creates shareable JSON
       - importTemplate(json) -> validates and adds template
    4. Add template discovery and organization:
       - Category filtering with search
       - Template popularity ranking
       - Recently used templates list
       - Template usage analytics and recommendations
    5. Implement storage system:
       - Document directory storage for custom templates
       - Template backup and restore functionality
       - Template syncing preparation (future CloudKit integration)
       - Template versioning and migration support
    6. Add template validation:
       - Template content validation before saving
       - Placeholder syntax checking
       - Property compatibility validation
       - Template metadata completeness checks

    Pattern: Follow existing manager patterns in codebase (database, sync managers).
    Built-ins: Recreate the 6 professional templates from React prototype exactly.
  </action>
  <verify>TemplateManager loads built-in templates and provides custom template CRUD operations</verify>
  <done>TemplateManager provides complete template lifecycle management with built-in library and custom storage</done>
</task>

<task type="auto">
  <name>Create Template Gallery Interface</name>
  <files>native/Sources/Isometry/Views/Notebook/TemplateGallery.swift</files>
  <action>
    Create native collection view interface for template browsing and selection:

    1. Implement TemplateGallery struct with:
       - LazyVGrid layout for template cards
       - Category filtering with segmented control
       - Search bar for template discovery
       - Template preview with markdown rendering
    2. Create template gallery layout:
       - Grid layout adapting to available space (2-3 columns)
       - Template cards with title, description, category badge
       - Preview thumbnail showing template content
       - Usage count and favorite indicators
    3. Add template interaction features:
       - Tap to create card from template
       - Long press for template actions menu (favorite, duplicate, delete)
       - Drag to reorder favorites
       - Contextual menu with template operations
    4. Implement template filtering:
       - Category-based filtering with quick access buttons
       - Search functionality across title, description, content
       - Filter by built-in vs custom templates
       - Recently used and favorites sections
    5. Add template preview:
       - Modal sheet with full template preview
       - Markdown rendering of template content
       - Property list showing default values
       - Template metadata display
    6. Create template management UI:
       - Add new template from current card button
       - Template import/export functionality
       - Template sharing via system share sheet
       - Template analytics and usage insights
    7. Performance optimizations:
       - Virtual scrolling for large template collections
       - Image caching for template thumbnails
       - Debounced search with efficient filtering
       - Lazy loading of template content

    Pattern: Native LazyVGrid with card-style layout, similar to iOS App Store or Photos.
    UX: Focus on quick template discovery and one-tap card creation.
  </action>
  <verify>Template gallery renders with grid layout, search, and category filtering</verify>
  <done>TemplateGallery provides native collection view for template browsing with search and filtering</done>
</task>

<task type="auto">
  <name>Create Template Card Component</name>
  <files>native/Sources/Isometry/Views/Notebook/TemplateCard.swift</files>
  <action>
    Create template card component for gallery display with preview and actions:

    1. Implement TemplateCard struct with:
       - Card container with template information
       - Template thumbnail or icon representation
       - Title, description, and category display
       - Action buttons for template operations
    2. Create template card layout:
       - Card-style container with shadow and border
       - Template preview area with content snippet
       - Metadata section with category, usage count
       - Action area with create button and menu
    3. Add template card features:
       - Category color coding and badge display
       - Favorite indicator with toggle functionality
       - Usage count display for popularity indication
       - Template freshness indicator (new, updated)
    4. Implement template actions:
       - Primary action: create card from template
       - Secondary actions: favorite, duplicate, edit, delete
       - Context menu with full action set
       - Confirmation dialogs for destructive actions
    5. Add accessibility support:
       - VoiceOver labels and descriptions
       - Voice control support for all actions
       - High contrast mode support
       - Reduced motion support for animations
    6. Style integration:
       - Match existing app card design patterns
       - Theme support (light/dark modes)
       - Consistent typography and spacing
       - Platform-appropriate interaction patterns
    7. Performance considerations:
       - Efficient template content preview generation
       - Image loading optimization
       - Memory management for card reuse
       - Smooth animation performance

    Pattern: Follow existing card component patterns in codebase for visual consistency.
    Interaction: Native iOS/macOS interaction patterns with smooth animations.
  </action>
  <verify>Template cards render with proper styling, actions, and accessibility support</verify>
  <done>TemplateCard provides polished template display with native interactions and accessibility</done>
</task>

</tasks>

<verification>
1. Template gallery loads with built-in templates in grid layout
2. Search and category filtering work correctly
3. Template cards show preview and metadata
4. Creating cards from templates pre-fills content and properties
5. Custom template saving and loading functions properly
</verification>

<success_criteria>
1. User can browse templates in native collection view with smooth scrolling
2. Template creation from selection pre-fills markdown and properties
3. Custom templates can be saved and reused
4. Built-in templates provide professional starting points matching React prototype
5. Template search and filtering enable quick discovery
</success_criteria>

<output>
After completion, create `.planning/phases/06.2-capture-implementation/06.2-03-SUMMARY.md`
</output>