---
phase: 65-facet-discovery
plan: 02
type: execute
wave: 2
depends_on: ["65-01"]
files_modified:
  - src/components/navigator/PafvNavigator.tsx
  - src/components/navigator/DraggablePropertyChip.tsx
autonomous: true

must_haves:
  truths:
    - "Navigator displays dynamic properties with visual distinction (sparkle icon, dashed border)"
    - "Dynamic properties show node count badge"
    - "Dragging dynamic property to plane updates axis mapping"
    - "SuperGrid renders grid with dynamic property as axis"
  artifacts:
    - path: "src/components/navigator/PafvNavigator.tsx"
      provides: "Dynamic property rendering with isDynamic styling"
      contains: "isDynamic"
    - path: "src/components/navigator/DraggablePropertyChip.tsx"
      provides: "Extracted chip component with dynamic property visual indicators"
      exports: ["DraggablePropertyChip"]
  key_links:
    - from: "src/components/navigator/PafvNavigator.tsx"
      to: "src/services/property-classifier.ts"
      via: "usePropertyClassification hook"
      pattern: "property\\.isDynamic"
---

<objective>
Add visual distinction for dynamic properties in Navigator UI.

Purpose: Users need to understand which facets are schema-defined vs discovered from data.
Output: Navigator displays dynamic properties with sparkle icon, dashed border, and node count badge.
</objective>

<execution_context>
@/Users/mshaler/.claude/get-shit-done/workflows/execute-plan.md
@/Users/mshaler/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/65-facet-discovery/65-RESEARCH.md
@.planning/phases/65-facet-discovery/65-01-SUMMARY.md

@src/components/navigator/PafvNavigator.tsx
@src/services/property-classifier.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Extract DraggablePropertyChip component with dynamic styling</name>
  <files>src/components/navigator/DraggablePropertyChip.tsx</files>
  <action>
Create new file extracting DraggablePropertyChip from PafvNavigator.tsx with enhanced styling for dynamic properties:

1. Import dependencies:
   - `useDrag` from 'react-dnd'
   - `GripVertical`, `Sparkles` from 'lucide-react'
   - `useTheme` from '@/contexts/ThemeContext'
   - `ClassifiedProperty`, `PropertyBucket` from '@/services/property-classifier'

2. Define DragItem interface (same as PafvNavigator):
   ```typescript
   export interface DragItem {
     id: string;
     name: string;
     bucket: PropertyBucket;
     sourceColumn: string;
     sourceWell: 'available' | 'x' | 'y' | 'z';
   }
   ```

3. Define props interface:
   ```typescript
   export interface DraggablePropertyChipProps {
     property: ClassifiedProperty;
     sourceWell: 'available' | 'x' | 'y' | 'z';
   }
   ```

4. Implement component with dynamic property visual indicators:
   - Read `property.isDynamic` and `property.nodeCount` (both optional, default false/0)
   - Add Sparkles icon before property name if isDynamic
   - Use dashed border style if isDynamic: `border-dashed` class
   - Show node count badge after name if isDynamic and nodeCount > 0
   - NeXTSTEP theme: sparkle icon `text-yellow-400`, badge `text-[#999]`
   - Modern theme: sparkle icon `text-yellow-500`, badge `text-gray-400`

5. Component structure:
   ```tsx
   <div ref={drag} className={`
     flex items-center gap-1.5 h-7 px-2 rounded text-[11px]
     ${isDynamic ? 'border border-dashed' : ''}
     ${isGraph ? 'cursor-not-allowed opacity-50' : 'cursor-grab active:cursor-grabbing'}
     ...theme styles
   `}>
     {isDynamic && <Sparkles className="w-3 h-3 flex-shrink-0 ..." />}
     {!isGraph && !isDynamic && <GripVertical className="w-3 h-3 flex-shrink-0 ..." />}
     <span className="truncate flex-1">{property.name}</span>
     {isDynamic && nodeCount > 0 && (
       <span className="text-[9px] opacity-60 ml-auto">{nodeCount}</span>
     )}
   </div>
   ```

6. Export component and DragItem type for PafvNavigator to import.
  </action>
  <verify>
npm run typecheck (zero errors)
File exists: src/components/navigator/DraggablePropertyChip.tsx
  </verify>
  <done>
DraggablePropertyChip extracted with dynamic property styling (sparkle icon, dashed border, count badge)
  </done>
</task>

<task type="auto">
  <name>Task 2: Update PafvNavigator to use extracted component</name>
  <files>src/components/navigator/PafvNavigator.tsx</files>
  <action>
1. Import the extracted component:
   ```typescript
   import { DraggablePropertyChip, type DragItem } from './DraggablePropertyChip';
   ```

2. Remove the inline DraggablePropertyChip function (lines ~63-105).

3. Remove the local DragItem interface (now imported).

4. Keep the DraggablePropertyChipProps interface if needed elsewhere, or remove if only used by the component.

5. Verify all usages of DraggablePropertyChip still work:
   - In Available Properties well mapping
   - Ensure property prop includes isDynamic and nodeCount (comes from classification)

6. No changes needed to AxisChip (used for assigned axes, not available properties).

7. Ensure the component import path is correct: `./DraggablePropertyChip` (same directory).
  </action>
  <verify>
npm run typecheck (zero errors)
npm run dev -- start the dev server, verify Navigator renders
  </verify>
  <done>
PafvNavigator imports extracted DraggablePropertyChip, no duplicate code, Navigator renders correctly
  </done>
</task>

<task type="auto">
  <name>Task 3: Verify end-to-end dynamic property flow</name>
  <files>src/components/navigator/PafvNavigator.tsx</files>
  <action>
Manual verification steps (document in summary):

1. Classification flow:
   - Verify usePropertyClassification() in PafvNavigator receives dynamic properties
   - Add console.log in getAllLatchProperties() to verify dynamic properties appear
   - Check that isDynamic and nodeCount fields are passed through to DraggablePropertyChip

2. Visual verification:
   - Dynamic properties should have sparkle icon
   - Dynamic properties should have dashed border
   - Dynamic properties should show node count badge

3. Drag-and-drop verification:
   - Drag dynamic property to X-Plane
   - Verify AxisChip appears in X-Plane well
   - Verify SuperGrid attempts to render (may show empty if no data matches)

4. If dynamic properties don't appear:
   - Check node_properties table has data: db.exec('SELECT COUNT(*) FROM node_properties')
   - Check node count threshold (default 3): properties need 3+ nodes to appear
   - Verify classifyProperties() is called after ETL populates node_properties

Note: Full SuperGrid projection of dynamic properties requires SQL JOIN pattern which may be implemented in a future phase. Phase 65 gates on Navigator UI display and drag-drop to plane.
  </action>
  <verify>
npm run build (production build succeeds)
npm run check (all checks pass)
  </verify>
  <done>
Dynamic properties appear in Navigator with visual distinction, can be dragged to planes
  </done>
</task>

</tasks>

<verification>
1. Run typecheck: `npm run typecheck`
2. Run build: `npm run build`
3. Run checks: `npm run check`
4. Visual test: Start dev server, verify dynamic properties in Navigator have sparkle icon and node count
5. Drag test: Drag a dynamic property to X-Plane, verify it appears as an AxisChip
</verification>

<success_criteria>
- Dynamic properties display with sparkle icon and dashed border
- Node count badge shows for dynamic properties with nodeCount > 0
- Dynamic properties can be dragged to plane wells
- AxisChip appears when dynamic property dropped on plane
- All TypeScript types pass, build succeeds
</success_criteria>

<output>
After completion, create `.planning/phases/65-facet-discovery/65-02-SUMMARY.md`
</output>
