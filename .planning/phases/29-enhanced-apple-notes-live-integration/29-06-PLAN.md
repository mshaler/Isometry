---
phase: 29-enhanced-apple-notes-live-integration
plan: 06
type: execute
wave: 1
depends_on: []
files_modified: [native/Sources/Isometry/Import/NotesPermissionHandler.swift]
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "Swift native project builds successfully without compilation errors"
    - "NotesPermissionHandler provides permission management UI functionality"
    - "Native deployment verification completes successfully"
  artifacts:
    - path: "native/Sources/Isometry/Import/NotesPermissionHandler.swift"
      provides: "Functional Swift permission handler without syntax errors"
      min_lines: 750
  key_links:
    - from: "NotesPermissionHandler.swift syntax"
      to: "Swift compilation success"
      via: "proper struct/class boundaries and method declarations"
      pattern: "struct.*PermissionInstructionsView|static func.*presentPermissionRequest"
---

<objective>
Fix Swift syntax errors in NotesPermissionHandler.swift to enable successful compilation

Purpose: Remove compilation blocking errors preventing native deployment verification
Output: NotesPermissionHandler with correct Swift syntax enabling successful builds
</objective>

<execution_context>
@/Users/mshaler/.claude/get-shit-done/workflows/execute-plan.md
@/Users/mshaler/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@.planning/phases/29-enhanced-apple-notes-live-integration/29-01-SUMMARY.md
@.planning/phases/29-enhanced-apple-notes-live-integration/29-02-SUMMARY.md
@.planning/phases/29-enhanced-apple-notes-live-integration/29-03-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Fix struct declaration boundary errors</name>
  <files>native/Sources/Isometry/Import/NotesPermissionHandler.swift</files>
  <action>
    Fix syntax errors in PermissionInstructionsView struct (around line 403):
    - Examine struct opening and closing braces to ensure proper nesting
    - Move .task { await loadInstructions() } to proper position within struct body
    - Ensure all View protocol methods are properly declared within struct scope
    - Fix "expected declaration" error by correcting Swift syntax structure
    - Verify all SwiftUI view modifiers are properly chained

    Gap reason: Syntax errors prevent successful build and deployment verification
    Reference existing code: Other SwiftUI views in project for proper struct syntax patterns
  </action>
  <verify>swift build from native/ shows no "expected declaration" errors around line 403</verify>
  <done>PermissionInstructionsView struct has correct Swift syntax and compiles successfully</done>
</task>

<task type="auto">
  <name>Fix static method declaration errors</name>
  <files>native/Sources/Isometry/Import/NotesPermissionHandler.swift</files>
  <action>
    Fix "static methods may only be declared on a type" errors (lines 736, 759, 775):
    - Ensure presentPermissionRequest static method is within proper class/struct scope
    - Move permissionStatusIndicator static method to appropriate type declaration
    - Relocate shouldShowPermissionRequest static method to correct container
    - Verify all static methods are within class, struct, or enum boundaries
    - Add missing class/struct declaration if methods are orphaned outside type scope

    Gap reason: Static method placement errors prevent Swift compilation
    Reference existing code: NotesAccessManager for proper static method organization patterns
  </action>
  <verify>swift build shows no "static methods may only be declared on a type" errors</verify>
  <done>All static methods are properly declared within type boundaries</done>
</task>

<task type="auto">
  <name>Fix extraneous closing brace and scope issues</name>
  <files>native/Sources/Isometry/Import/NotesPermissionHandler.swift</files>
  <action>
    Fix "extraneous '}' at top level" error (line 780):
    - Trace all opening and closing braces to identify mismatched pairs
    - Remove extra closing braces that don't match opening braces
    - Ensure proper nesting of classes, structs, and method bodies
    - Verify file ends with correct number of closing braces
    - Add missing opening braces if needed to balance structure

    Gap reason: Brace mismatch prevents successful Swift compilation
    Reference existing code: Other Swift files for proper nesting and closure patterns
  </action>
  <verify>swift build from native/ directory completes without "extraneous '}'" errors</verify>
  <done>File has balanced braces and proper Swift structure enabling compilation</done>
</task>

<task type="auto">
  <name>Verify compilation and test basic functionality</name>
  <files>native/Sources/Isometry/Import/NotesPermissionHandler.swift</files>
  <action>
    Validate compilation success and basic functionality:
    - Run swift build from native/ directory to confirm no remaining syntax errors
    - Verify NotesPermissionHandler exports expected public types and methods
    - Check that PermissionInstructionsView conforms to View protocol
    - Ensure static utility methods are accessible from other modules
    - Add any missing import statements if compilation reveals dependency issues

    Gap reason: Compilation failures prevent deployment verification as required by Phase 29 success criteria
    Reference existing code: Other working Swift import files for module structure verification
  </action>
  <verify>swift build succeeds with exit code 0, no compilation errors reported</verify>
  <done>NotesPermissionHandler compiles successfully and provides functional permission management</done>
</task>

</tasks>

<verification>
swift build from native/ directory exits with code 0
grep -c "error:" in swift build output equals 0
NotesPermissionHandler.swift has proper Swift syntax throughout
All structs, classes, and methods are within correct scope boundaries
</verification>

<success_criteria>
Swift native project builds without compilation errors
NotesPermissionHandler provides permission UI functionality as designed
Native deployment verification can proceed successfully
Phase 29 performance optimization verification unblocked
</success_criteria>

<output>
After completion, create `.planning/phases/29-enhanced-apple-notes-live-integration/29-06-SUMMARY.md`
</output>