---
phase: 29-enhanced-apple-notes-live-integration
plan: 03
type: execute
wave: 3
depends_on: ["29-02"]
files_modified:
  - native/Sources/Isometry/Views/Settings/NotesIntegrationView.swift
  - src/components/settings/NotesIntegrationSettings.tsx
  - native/Sources/Isometry/Import/AppleNotesLiveImporter.swift
autonomous: false
user_setup:
  - service: apple_notes
    why: "Live Notes synchronization requires explicit user permission"
    dashboard_config:
      - task: "Enable Notes access in Privacy settings"
        location: "System Settings → Privacy & Security → Notes"

must_haves:
  truths:
    - "Users can configure live Notes sync through intuitive UI"
    - "Conflict resolution provides clear user guidance and control"
    - "Performance optimization handles large Notes libraries efficiently"
  artifacts:
    - path: "native/Sources/Isometry/Views/Settings/NotesIntegrationView.swift"
      provides: "SwiftUI configuration and conflict resolution interface"
      min_lines: 250
    - path: "src/components/settings/NotesIntegrationSettings.tsx"
      provides: "React configuration UI with live sync controls"
      min_lines: 200
  key_links:
    - from: "NotesIntegrationView.swift"
      to: "AppleNotesLiveImporter.swift"
      via: "configuration and status binding"
      pattern: "@StateObject|@ObservedObject.*LiveImporter"
    - from: "NotesIntegrationSettings.tsx"
      to: "WebView bridge"
      via: "settings API calls"
      pattern: "window\\.webkit.*postMessage|useNative.*API"
---

<objective>
Implement user-friendly configuration UI and optimize performance for production deployment of live Apple Notes integration

Purpose: Provide complete user experience with intuitive controls, clear conflict resolution, and efficient handling of large Notes libraries
Output: Production-ready Apple Notes live integration with comprehensive UI and performance optimization
</objective>

<execution_context>
@/Users/mshaler/.claude/get-shit-done/workflows/execute-plan.md
@/Users/mshaler/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/29-enhanced-apple-notes-live-integration/29-RESEARCH.md

# Previous waves foundation
@.planning/phases/29-enhanced-apple-notes-live-integration/29-01-SUMMARY.md
@.planning/phases/29-enhanced-apple-notes-live-integration/29-02-SUMMARY.md

# Existing UI patterns
@native/Sources/Isometry/Views/Settings/ImportSettingsView.swift
@src/components/settings/ImportSettings.tsx
@native/Sources/Isometry/Views/Conflict/ConflictResolutionModal.swift
</context>

<tasks>

<task type="auto">
  <name>Create Native SwiftUI Configuration Interface</name>
  <files>native/Sources/Isometry/Views/Settings/NotesIntegrationView.swift</files>
  <action>
    Create comprehensive SwiftUI interface for Notes integration configuration:

    1. **Permission and Setup Management:**
       - Create permission status display with clear explanation of requirements
       - Add "Request Notes Access" button with permission flow handling
       - Implement permission status monitoring with real-time updates
       - Include fallback information for denied permissions (alto-index export alternative)

    2. **Live Sync Configuration:**
       - Add toggle for enable/disable live sync with clear impact explanation
       - Create sync frequency slider (real-time, 1min, 5min, manual)
       - Implement sync scope selection (all notes, specific folders, recent notes only)
       - Include performance mode selection (full sync, incremental only, battery-aware)

    3. **Conflict Resolution Interface:**
       - Create conflict resolution preference settings (auto-resolve vs manual)
       - Add conflict history viewer with resolution details
       - Implement conflict resolution modal with side-by-side comparison
       - Include conflict statistics and resolution success metrics

    Follow existing ImportSettingsView patterns for consistency.
    Use @StateObject binding to AppleNotesLiveImporter for real-time status.
    Include proper error handling and user feedback throughout the UI.
  </action>
  <verify>SwiftUI interface compiles and basic configuration changes work</verify>
  <done>NotesIntegrationView provides intuitive configuration with permission management, sync controls, and conflict resolution UI</done>
</task>

<task type="auto">
  <name>Create React Web Configuration Component</name>
  <files>src/components/settings/NotesIntegrationSettings.tsx</files>
  <action>
    Create React component for Notes integration settings in web interface:

    1. **Settings Synchronization:**
       - Mirror native configuration options in web interface
       - Use WebView bridge to communicate with native NotesAccessManager
       - Implement real-time status updates from native live importer
       - Add settings persistence across web/native boundary

    2. **User Experience Optimization:**
       - Create clear permission request flow with explanatory modals
       - Add sync status indicators (idle, syncing, conflicts, error)
       - Implement progress bars for large library initial sync
       - Include estimated sync time and progress details

    3. **Conflict Management Integration:**
       - Add conflict notification system with badge counts
       - Create conflict resolution queue with priority handling
       - Implement conflict resolution interface matching native patterns
       - Include batch conflict resolution for multiple similar conflicts

    Use existing ImportSettings.tsx patterns for consistency.
    Follow established WebView bridge patterns for native communication.
    Ensure responsive design works on both desktop and mobile web views.
  </action>
  <verify>React component renders correctly and communicates with native backend</verify>
  <done>NotesIntegrationSettings provides comprehensive web-based configuration matching native functionality with intuitive user experience</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete Apple Notes live integration with UI configuration and conflict resolution</what-built>
  <how-to-verify>
    1. Open native app Settings and navigate to Notes Integration
    2. Test permission request flow and verify TCC dialog appears
    3. Enable live sync and verify file system monitoring starts
    4. Create test conflicts by editing same note in Notes app and Isometry
    5. Verify conflict resolution UI appears and allows manual resolution
    6. Check web interface settings synchronize with native configuration
    7. Test performance with existing 6,891 imported notes
  </how-to-verify>
  <resume-signal>Type "approved" or describe any issues found</resume-signal>
</task>

<task type="auto">
  <name>Performance Optimization for Large Libraries</name>
  <files>native/Sources/Isometry/Import/AppleNotesLiveImporter.swift</files>
  <action>
    Optimize AppleNotesLiveImporter for efficient handling of large Notes libraries:

    1. **Incremental Processing Optimization:**
       - Implement smart batching based on device performance and memory constraints
       - Add FTS5 optimization for faster text search during change detection
       - Create lazy loading for large note content with on-demand parsing
       - Include memory pressure monitoring with adaptive processing

    2. **Background Processing Efficiency:**
       - Optimize Actor scheduling to prevent UI blocking during large syncs
       - Implement priority queuing for user-visible vs background changes
       - Add intelligent rate limiting based on device performance and battery state
       - Include sync pause/resume for user-controlled resource management

    3. **Database Performance:**
       - Optimize database queries with proper indexing for Notes-specific access patterns
       - Implement connection pooling for efficient database resource usage
       - Add query performance monitoring with slow query logging
       - Include database cleanup and optimization scheduling

    Use existing performance monitoring patterns from PerformanceMonitor.
    Follow GRDB best practices for large dataset handling.
    Ensure optimizations maintain data integrity and transaction safety.
    Test with existing 6,891 note dataset to validate performance improvements.
  </action>
  <verify>Performance testing shows <100ms per note processing and stable memory usage</verify>
  <done>AppleNotesLiveImporter efficiently handles large Notes libraries with optimized processing and memory management</done>
</task>

</tasks>

<verification>
1. Native SwiftUI configuration interface provides complete control over Notes integration
2. React web component synchronizes settings and provides unified user experience
3. Permission management works correctly with clear user guidance
4. Conflict resolution UI handles manual resolution effectively
5. Performance optimization handles large Notes libraries efficiently
6. End-to-end live sync works from Notes app changes to Isometry database updates
</verification>

<success_criteria>
- Complete Apple Notes live integration deployed and functional
- User interface provides intuitive configuration and conflict resolution
- Performance optimized for large Notes libraries (10k+ notes capability)
- TCC permissions handled gracefully with clear user communication
- Live sync operates reliably with <1s change detection and proper conflict handling
</success_criteria>

<output>
After completion, create `.planning/phases/29-enhanced-apple-notes-live-integration/29-03-SUMMARY.md`
</output>