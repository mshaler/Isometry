# Phase 105-01: Types and Utility Functions

**Status:** COMPLETE
**Completed:** 2026-02-15

## Goal

Define TypeScript interfaces and implement core utility functions for tree metrics computation and CSS Grid placement.

## Deliverables

### 1. types.ts — Core Interfaces

**File:** `src/components/supergrid/types.ts` (380 lines)

**Key types defined:**
- `LATCHAxisType` — 'L' | 'A' | 'T' | 'C' | 'H'
- `AxisConfig` — Axis configuration with type, facet, tree
- `AxisNode` — Hierarchical tree node with children
- `DataCell` — Cell value with rowPath/colPath
- `GridPlacement` — CSS Grid coordinates (row/column start/end)
- `FlatNode` — Flattened node with computed metrics
- `TreeMetrics` — Computed depth, leafCount, flatNodes
- `HeaderCell` — Header with placement
- `CornerCellData` — Corner cell data
- `DataCellPosition` — Data cell with row/col leaf references
- `GridLayout` — Complete computed layout
- `SuperGridTheme` — Theme configuration
- `SuperGridProps` — Main component props
- `SuperGridContextValue` — Context type

### 2. utils/treeMetrics.ts — Tree Traversal

**File:** `src/components/supergrid/utils/treeMetrics.ts` (123 lines)

**Functions:**
```typescript
computeTreeMetrics(root: AxisNode): TreeMetrics
getLeafNodes(metrics: TreeMetrics): FlatNode[]
getHeaderNodes(metrics: TreeMetrics, rootId?: string): FlatNode[]
findNodeById(metrics: TreeMetrics, id: string): FlatNode | undefined
findNodeByPath(metrics: TreeMetrics, path: string[]): FlatNode | undefined
```

**Algorithm:** Depth-first traversal computing:
- `depth` — 0-indexed depth in tree
- `leafStart` — First leaf index this node spans
- `leafCount` — Number of leaves this node spans
- `path` — ID path from root

### 3. utils/gridPlacement.ts — CSS Grid Coordinates

**File:** `src/components/supergrid/utils/gridPlacement.ts` (180 lines)

**Functions:**
```typescript
computeRowHeaderPlacement(flatNode: FlatNode, colHeaderDepth: number): GridPlacement
computeColHeaderPlacement(flatNode: FlatNode, rowHeaderDepth: number): GridPlacement
computeDataCellPlacement(rowLeafIndex, colLeafIndex, colHeaderDepth, rowHeaderDepth): GridPlacement
computeCornerCellPlacement(row: number, col: number): GridPlacement
generateGridTemplate(rowMetrics, colMetrics, options?): { columns: string; rows: string }
placementToStyle(placement: GridPlacement): React.CSSProperties
```

**Key insight:** CSS Grid uses 1-based line numbers, so all indices are +1.

## Verification

- Types compile without errors
- Tree metrics correctly compute spans for reference image data
- Grid placements match expected coordinates

## REQ-IDs Addressed

| REQ-ID | Requirement | Status |
|--------|-------------|--------|
| SG-CSS-01 | Define TypeScript interfaces for CSS Grid SuperGrid | COMPLETE |
| SG-CSS-02 | Implement tree metrics computation | COMPLETE |
| SG-CSS-03 | Implement CSS Grid placement calculation | COMPLETE |
