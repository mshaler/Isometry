# Phase 59-01: Context Memoization & Render Loop Safeguards

## Goal
Prevent infinite render loops caused by unmemoized context values. Fix SQLiteProvider (done) and PAFVContext, then add a development-mode safeguard to detect future render storms.

## Background

**Root cause identified:** Context providers creating new object references on every render cause consumers to re-render infinitely when combined with effects that depend on context values.

**Pattern:**
```
Provider renders → new context value object →
consumers see "changed" value → effects fire →
state updates → provider re-renders → infinite loop
```

**Symptom:** Console flooded with dev-logger messages, Chrome at 5GB RAM, IndexedDB corruption.

## Tasks

### Task 1: Fix PAFVContext memoization (P0)
**File:** `src/state/PAFVContext.tsx`
**Issue:** Lines 191-206 create a new context value object on every render
**Fix:** Wrap context value in `useMemo` with proper dependencies

### Task 2: Add useRenderLoopGuard hook (P1)
**File:** `src/hooks/debug/useRenderLoopGuard.ts` (NEW)
**Purpose:** Development-mode safeguard that warns when a component renders >10 times per second
**Behavior:**
- Track render count with useRef
- Reset counter every second
- Log warning if threshold exceeded
- No-op in production builds

### Task 3: Apply guard to critical components (P1)
**Files:**
- `src/db/SQLiteProvider.tsx`
- `src/state/PAFVContext.tsx`
**Action:** Add useRenderLoopGuard() call to detect future issues early

## Verification

```bash
npm run typecheck   # Zero errors
npm run dev         # No console flooding
# Navigate to /?test=integrated
# Verify SuperGrid renders correctly
# Check Chrome DevTools → Performance tab for render count
```

## Dependencies
- Phase 58 complete (Navigator redesign)
- SQLiteProvider memoization already applied (this session)

## REQ-IDs
- REQ-STABILITY-01: Context memoization prevents infinite loops
- REQ-STABILITY-02: Render guard detects issues in development
