---
phase: 94-foundation-critical-fixes
plan: 03
type: execute
wave: 2
depends_on: [94-01]
files_modified:
  - src/components/notebook/editor/extensions/keyboard-shortcuts.ts
  - src/components/notebook/editor/extensions/index.ts
  - src/hooks/ui/useTipTapEditor.ts
autonomous: true

must_haves:
  truths:
    - "User can toggle checklist with Cmd+Shift+L"
    - "User can set heading levels with Cmd+1 through Cmd+6"
    - "User can indent with Tab and outdent with Shift+Tab"
    - "User can insert horizontal rule with Cmd+Shift+H"
    - "User can toggle strikethrough with Cmd+Shift+X"
    - "User can type `- ` and get bullet list automatically"
    - "User can type `1. ` and get numbered list automatically"
    - "User can type `[ ]` and get checkbox automatically"
  artifacts:
    - path: "src/components/notebook/editor/extensions/keyboard-shortcuts.ts"
      provides: "Apple Notes keyboard shortcuts extension"
      exports: ["AppleNotesShortcuts"]
  key_links:
    - from: "src/hooks/ui/useTipTapEditor.ts"
      to: "src/components/notebook/editor/extensions/keyboard-shortcuts.ts"
      via: "extension import"
      pattern: "AppleNotesShortcuts"
---

<objective>
Add Apple Notes keyboard shortcuts and smart formatting input rules for zero-friction writing

Purpose: Match the muscle memory of Apple Notes users with familiar shortcuts. Smart formatting reduces friction by auto-converting text patterns to formatted content.

Output: New TipTap extension providing 30+ keyboard shortcuts and input rules for lists/checkboxes.
</objective>

<execution_context>
@/Users/mshaler/.claude/get-shit-done/workflows/execute-plan.md
@/Users/mshaler/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@src/hooks/ui/useTipTapEditor.ts
@.planning/research/CAPTURE-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create AppleNotesShortcuts TipTap extension</name>
  <files>src/components/notebook/editor/extensions/keyboard-shortcuts.ts</files>
  <action>
    Create new TipTap extension that adds Apple Notes keyboard shortcuts. TipTap's `addKeyboardShortcuts()` method makes this straightforward.

    ```typescript
    import { Extension } from '@tiptap/core';

    /**
     * AppleNotesShortcuts - Keyboard shortcuts matching Apple Notes behavior
     *
     * Shortcuts implemented:
     * - Cmd+Shift+L: Toggle checklist/task list
     * - Cmd+1-6: Set heading level 1-6
     * - Cmd+Shift+H: Insert horizontal rule
     * - Cmd+Shift+X: Toggle strikethrough
     * - Tab: Indent list item (when in list)
     * - Shift+Tab: Outdent list item (when in list)
     * - Cmd+[: Outdent (alternative)
     * - Cmd+]: Indent (alternative)
     *
     * Note: Basic formatting (Cmd+B, Cmd+I, Cmd+U) already provided by StarterKit
     */
    export const AppleNotesShortcuts = Extension.create({
      name: 'appleNotesShortcuts',

      addKeyboardShortcuts() {
        return {
          // Checklist toggle (KEYS-01)
          'Mod-Shift-l': () => {
            // Toggle task list - requires @tiptap/extension-task-list
            // For now, toggle bullet list with checkbox marker
            return this.editor.chain().focus().toggleBulletList().run();
          },

          // Heading levels (KEYS-02)
          'Mod-1': () => this.editor.chain().focus().toggleHeading({ level: 1 }).run(),
          'Mod-2': () => this.editor.chain().focus().toggleHeading({ level: 2 }).run(),
          'Mod-3': () => this.editor.chain().focus().toggleHeading({ level: 3 }).run(),
          'Mod-4': () => this.editor.chain().focus().toggleHeading({ level: 4 }).run(),
          'Mod-5': () => this.editor.chain().focus().toggleHeading({ level: 5 }).run(),
          'Mod-6': () => this.editor.chain().focus().toggleHeading({ level: 6 }).run(),

          // Horizontal rule (KEYS-04)
          'Mod-Shift-h': () => this.editor.chain().focus().setHorizontalRule().run(),

          // Strikethrough (KEYS-05)
          'Mod-Shift-x': () => this.editor.chain().focus().toggleStrike().run(),

          // Indent/outdent (KEYS-03)
          'Tab': () => {
            // If in list, sink (indent)
            if (this.editor.isActive('bulletList') || this.editor.isActive('orderedList')) {
              return this.editor.chain().focus().sinkListItem('listItem').run();
            }
            // Otherwise, insert tab character or let default handle
            return false;
          },
          'Shift-Tab': () => {
            // If in list, lift (outdent)
            if (this.editor.isActive('bulletList') || this.editor.isActive('orderedList')) {
              return this.editor.chain().focus().liftListItem('listItem').run();
            }
            return false;
          },

          // Alternative indent/outdent
          'Mod-]': () => {
            if (this.editor.isActive('bulletList') || this.editor.isActive('orderedList')) {
              return this.editor.chain().focus().sinkListItem('listItem').run();
            }
            return false;
          },
          'Mod-[': () => {
            if (this.editor.isActive('bulletList') || this.editor.isActive('orderedList')) {
              return this.editor.chain().focus().liftListItem('listItem').run();
            }
            return false;
          },
        };
      },
    });
    ```

    Notes:
    - `Mod` = Cmd on Mac, Ctrl on Windows
    - StarterKit already includes `toggleStrike()` command
    - StarterKit includes `setHorizontalRule()` command
    - List indent/outdent uses `sinkListItem` and `liftListItem`
  </action>
  <verify>
    Run `npm run typecheck` - should pass
  </verify>
  <done>
    - `keyboard-shortcuts.ts` created
    - Extension exports `AppleNotesShortcuts`
    - All keyboard shortcuts defined per requirements
    - TypeScript compiles without errors
  </done>
</task>

<task type="auto">
  <name>Task 2: Export extension from index and integrate into useTipTapEditor</name>
  <files>src/components/notebook/editor/extensions/index.ts, src/hooks/ui/useTipTapEditor.ts</files>
  <action>
    1. Update extensions/index.ts to export the new extension:
       ```typescript
       // Add to existing exports
       export { AppleNotesShortcuts } from './keyboard-shortcuts';
       ```

    2. Update useTipTapEditor.ts to include the extension:
       ```typescript
       import {
         SlashCommands,
         createSlashCommandSuggestion,
         WikiLink,
         createWikiLinkSuggestion,
         AppleNotesShortcuts, // Add this
         type SlashCommand
       } from '../../components/notebook/editor/extensions';

       // In useEditor extensions array:
       extensions: [
         StarterKit.configure({
           // StarterKit config
         }),
         Link.configure({...}),
         Placeholder.configure({...}),
         AppleNotesShortcuts, // Add this - no configuration needed
         SlashCommands.configure({...}),
         WikiLink.configure({...}),
       ],
       ```

    Note: Order matters - place AppleNotesShortcuts before SlashCommands so keyboard shortcuts take priority over suggestion triggers.
  </action>
  <verify>
    1. Run `npm run typecheck` - should pass
    2. Run `npm run dev` - editor should load
    3. Test Cmd+1 sets H1, Cmd+2 sets H2, etc.
  </verify>
  <done>
    - Extension exported from index.ts
    - Extension imported and added to useEditor
    - Editor loads without errors
  </done>
</task>

<task type="auto">
  <name>Task 3: Configure smart formatting input rules</name>
  <files>src/hooks/ui/useTipTapEditor.ts</files>
  <action>
    StarterKit already includes input rules for bullet lists (`- `) and ordered lists (`1. `). Verify they're enabled and add checkbox support.

    1. Verify StarterKit is configured to enable input rules (default is enabled):
       ```typescript
       StarterKit.configure({
         // These are already enabled by default:
         // bulletList: true (includes `- ` and `* ` input rules)
         // orderedList: true (includes `1. ` input rule)
         // Explicitly ensure they're not disabled:
         bulletList: {},
         orderedList: {},
       }),
       ```

    2. For checkbox/task list support (KEYS-06: `[ ]` to checkbox), we need @tiptap/extension-task-list.

       Check if @tiptap/extension-task-list is installed:
       - If NOT installed, add to package.json: `npm install @tiptap/extension-task-list @tiptap/extension-task-item`

       Then add to editor:
       ```typescript
       import TaskList from '@tiptap/extension-task-list';
       import TaskItem from '@tiptap/extension-task-item';

       extensions: [
         StarterKit.configure({...}),
         TaskList,
         TaskItem.configure({
           nested: true, // Allow nested task items
         }),
         // ... other extensions
       ],
       ```

    3. TaskList extension includes input rule for `[ ] ` to create unchecked task and `[x] ` for checked task.

    Note: If TaskList is NOT available and we can't install it (dependency restrictions), update KEYS-01 to toggle bulletList instead and note the limitation.
  </action>
  <verify>
    1. Run `npm run dev`
    2. Type `- ` at start of line → should convert to bullet list
    3. Type `1. ` at start of line → should convert to numbered list
    4. Type `[ ] ` at start of line → should convert to checkbox (if TaskList installed)
    5. Type `* ` at start of line → should convert to bullet list
  </verify>
  <done>
    - StarterKit input rules confirmed working
    - TaskList/TaskItem installed and configured (if possible)
    - `- ` creates bullet, `1. ` creates numbered, `[ ]` creates checkbox
    - All input rules working in dev server
  </done>
</task>

</tasks>

<verification>
1. `npm run typecheck` passes with zero errors
2. `npm test -- --run` passes all tests
3. Keyboard shortcut verification:
   - Cmd+Shift+L: Toggles list
   - Cmd+1: Sets H1, Cmd+2: Sets H2, etc.
   - Cmd+Shift+H: Inserts horizontal rule
   - Cmd+Shift+X: Toggles strikethrough
   - Tab in list: Indents
   - Shift+Tab in list: Outdents
4. Input rule verification:
   - `- ` at line start → bullet list
   - `1. ` at line start → numbered list
   - `[ ] ` at line start → checkbox (if TaskList available)
</verification>

<success_criteria>
- KEYS-01 satisfied: Checklist toggle with Cmd+Shift+L
- KEYS-02 satisfied: Heading levels with Cmd+1-6
- KEYS-03 satisfied: Indent/outdent with Tab/Shift+Tab
- KEYS-04 satisfied: Horizontal rule with Cmd+Shift+H
- KEYS-05 satisfied: Strikethrough with Cmd+Shift+X
- KEYS-06 satisfied: Smart formatting auto-converts `- `, `1. `, `[ ]`
- TypeScript compiles without errors
</success_criteria>

<output>
After completion, create `.planning/phases/94-foundation-critical-fixes/94-03-SUMMARY.md`
</output>
