---
phase: 94-foundation-critical-fixes
plan: 04
type: execute
wave: 2
depends_on: [94-01]
files_modified:
  - src/components/notebook/editor/EditorStatusBar.tsx
  - src/components/notebook/editor/EditorToolbar.tsx
  - src/components/notebook/editor/index.ts
  - src/components/notebook/CaptureComponent.tsx
  - src/hooks/ui/useTipTapEditor.ts
autonomous: true

must_haves:
  truths:
    - "User can see word and character count in editor status bar"
    - "User can see Undo button in toolbar and it works"
    - "User can see Redo button in toolbar and it works"
  artifacts:
    - path: "src/components/notebook/editor/EditorStatusBar.tsx"
      provides: "Word and character count display"
      contains: "CharacterCount"
    - path: "src/components/notebook/editor/EditorToolbar.tsx"
      provides: "Visible Undo/Redo buttons"
      contains: "Undo"
  key_links:
    - from: "src/components/notebook/editor/EditorStatusBar.tsx"
      to: "@tiptap/extension-character-count"
      via: "character count extension"
      pattern: "characterCount"
---

<objective>
Add polish features: word/character count status bar and ensure Undo/Redo buttons are visible and working

Purpose: Professional writing experience requires visible word count and clear undo/redo affordances.

Output: New EditorStatusBar component showing word/character count; EditorToolbar with visible Undo/Redo buttons (already implemented, just verify).
</objective>

<execution_context>
@/Users/mshaler/.claude/get-shit-done/workflows/execute-plan.md
@/Users/mshaler/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@src/components/notebook/editor/EditorToolbar.tsx
@src/components/notebook/CaptureComponent.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install and configure @tiptap/extension-character-count</name>
  <files>src/hooks/ui/useTipTapEditor.ts</files>
  <action>
    1. Install the extension:
       ```bash
       npm install @tiptap/extension-character-count
       ```

    2. Import and add to useTipTapEditor.ts:
       ```typescript
       import CharacterCount from '@tiptap/extension-character-count';

       // In useEditor extensions array:
       extensions: [
         StarterKit.configure({...}),
         Link.configure({...}),
         Placeholder.configure({...}),
         CharacterCount.configure({
           // Optional: set character limit
           // limit: 10000,
         }),
         // ... other extensions
       ],
       ```

    3. The CharacterCount extension adds these properties to the editor storage:
       - `editor.storage.characterCount.characters()` - character count
       - `editor.storage.characterCount.words()` - word count

    4. Export character count from the hook for components to use:
       ```typescript
       // Add to hook return:
       return {
         editor,
         isDirty,
         isSaving,
         saveNow,
         activeCard,
         // Add these:
         characterCount: editor?.storage.characterCount?.characters() ?? 0,
         wordCount: editor?.storage.characterCount?.words() ?? 0,
       };
       ```

    Note: The count values will update automatically as the user types because TipTap's extension system tracks these.
  </action>
  <verify>
    1. Run `npm run typecheck` - should pass
    2. Run `npm run dev` - editor should load
    3. Console log `editor.storage.characterCount` - should have characters() and words() methods
  </verify>
  <done>
    - @tiptap/extension-character-count installed
    - Extension configured in useEditor
    - characterCount and wordCount exported from hook
    - TypeScript compiles without errors
  </done>
</task>

<task type="auto">
  <name>Task 2: Create EditorStatusBar component</name>
  <files>src/components/notebook/editor/EditorStatusBar.tsx, src/components/notebook/editor/index.ts</files>
  <action>
    Create new component to display word/character count:

    ```typescript
    // src/components/notebook/editor/EditorStatusBar.tsx
    interface EditorStatusBarProps {
      wordCount: number;
      characterCount: number;
      isSaving?: boolean;
      isDirty?: boolean;
      theme?: 'NeXTSTEP' | 'Modern';
    }

    /**
     * EditorStatusBar - Displays word/character count and save status
     *
     * Positioned at the bottom of the editor area.
     */
    export function EditorStatusBar({
      wordCount,
      characterCount,
      isSaving = false,
      isDirty = false,
      theme = 'Modern',
    }: EditorStatusBarProps) {
      return (
        <div className={`
          flex items-center justify-between px-3 py-1.5 text-xs border-t
          ${theme === 'NeXTSTEP'
            ? 'bg-[#d4d4d4] border-[#707070] text-gray-700'
            : 'bg-gray-50 border-gray-200 text-gray-500'
          }
        `}>
          {/* Left: Word and character count */}
          <div className="flex items-center gap-3">
            <span>{wordCount.toLocaleString()} {wordCount === 1 ? 'word' : 'words'}</span>
            <span className="text-gray-400">|</span>
            <span>{characterCount.toLocaleString()} {characterCount === 1 ? 'character' : 'characters'}</span>
          </div>

          {/* Right: Save status */}
          <div className="flex items-center gap-2">
            {isSaving && (
              <span className="text-blue-500">Saving...</span>
            )}
            {!isSaving && isDirty && (
              <span className="text-amber-500">Unsaved changes</span>
            )}
            {!isSaving && !isDirty && (
              <span className="text-green-600">Saved</span>
            )}
          </div>
        </div>
      );
    }
    ```

    Export from index.ts:
    ```typescript
    export { EditorStatusBar } from './EditorStatusBar';
    ```
  </action>
  <verify>
    Run `npm run typecheck` - should pass
  </verify>
  <done>
    - EditorStatusBar.tsx created
    - Component displays word count, character count, and save status
    - Exported from index.ts
    - TypeScript compiles without errors
  </done>
</task>

<task type="auto">
  <name>Task 3: Integrate EditorStatusBar into CaptureComponent</name>
  <files>src/components/notebook/CaptureComponent.tsx</files>
  <action>
    1. Import the new component:
       ```typescript
       import { EditorStatusBar } from './editor';
       ```

    2. The useTipTapEditor hook should already return wordCount and characterCount (from Task 1).

    3. Add EditorStatusBar below the TipTapEditor in the component layout:
       ```tsx
       const { editor, isDirty, isSaving, saveNow, wordCount, characterCount } = useTipTapEditor();

       return (
         <div className="flex flex-col h-full">
           {/* Editor toolbar at top */}
           <EditorToolbar editor={editor} theme={theme} />

           {/* Main editor area - flex-1 to fill space */}
           <div className="flex-1 overflow-auto">
             <TipTapEditor editor={editor} className="p-4" />
           </div>

           {/* Status bar at bottom */}
           <EditorStatusBar
             wordCount={wordCount}
             characterCount={characterCount}
             isSaving={isSaving}
             isDirty={isDirty}
             theme={theme}
           />
         </div>
       );
       ```

    Note: Adjust the existing layout structure as needed. The key is placing EditorStatusBar at the bottom of the editor area.
  </action>
  <verify>
    1. Run `npm run dev`
    2. Open Capture pane
    3. Status bar should be visible at bottom
    4. Type text - word/character counts should update
    5. Save status should show correctly
  </verify>
  <done>
    - EditorStatusBar imported into CaptureComponent
    - Status bar displayed at bottom of editor
    - Word/character counts update as user types
    - Save status displays correctly
  </done>
</task>

<task type="auto">
  <name>Task 4: Verify Undo/Redo buttons are visible and working</name>
  <files>src/components/notebook/editor/EditorToolbar.tsx</files>
  <action>
    EditorToolbar.tsx already has Undo/Redo buttons (lines 206-221). Verify they:
    1. Are visible in the toolbar
    2. Have correct disabled states
    3. Execute undo/redo commands

    Check the existing implementation:
    - Lines 206-221 define Undo and Redo buttons
    - They use `ed.chain().focus().undo().run()` and `ed.chain().focus().redo().run()`
    - Disabled state based on `editorState.canUndo` and `editorState.canRedo`

    If buttons are not visible or working, fix the issue. Common problems:
    - Missing import of Undo/Redo icons (already imported from lucide-react)
    - StarterKit history extension not enabled (enabled by default)
    - Button styling making them hard to see

    Most likely this task is verification only - buttons should already work.
  </action>
  <verify>
    1. Run `npm run dev`
    2. Open Capture pane
    3. Undo/Redo buttons visible in toolbar
    4. Type some text
    5. Click Undo - text should be removed
    6. Click Redo - text should reappear
    7. Cmd+Z should also work
    8. Cmd+Shift+Z should also work
  </verify>
  <done>
    - Undo button visible and functional
    - Redo button visible and functional
    - Disabled states work correctly
    - Keyboard shortcuts (Cmd+Z, Cmd+Shift+Z) work
    - POLISH-02 requirement satisfied
  </done>
</task>

</tasks>

<verification>
1. `npm run typecheck` passes with zero errors
2. `npm test -- --run` passes all tests
3. Visual verification:
   - Status bar visible at bottom of editor
   - Word count displays and updates on typing
   - Character count displays and updates on typing
   - Undo/Redo buttons visible in toolbar
   - Buttons enable/disable correctly based on history state
4. Functional verification:
   - Click Undo removes last change
   - Click Redo restores last undone change
   - Cmd+Z/Cmd+Shift+Z keyboard shortcuts work
</verification>

<success_criteria>
- POLISH-01 satisfied: Word/character count displays in editor status bar
- POLISH-02 satisfied: Undo/redo buttons visible in toolbar
- @tiptap/extension-character-count installed and configured
- EditorStatusBar component created and integrated
- Counts update in real-time as user types
- TypeScript compiles without errors
</success_criteria>

<output>
After completion, create `.planning/phases/94-foundation-critical-fixes/94-04-SUMMARY.md`
</output>
