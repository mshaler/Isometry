---
phase: 06.4-preview-platform-integration
plan: 03
type: execute
wave: 2
depends_on: ["06.4-01", "06.4-02"]
files_modified:
  - native/Sources/Isometry/Views/Notebook/NotebookContentView.swift
  - native/Sources/Isometry/Platform/iOS/MultitaskingSupport.swift
  - native/Sources/Isometry/Platform/iOS/TouchOptimizations.swift
autonomous: false

must_haves:
  truths:
    - "User can use notebook in iOS split view and slide-over modes"
    - "Touch interface provides optimized gesture recognition"
    - "App handles background refresh for data synchronization"
    - "iOS 16+ features enhance the notebook workflow"
  artifacts:
    - path: "native/Sources/Isometry/Platform/iOS/MultitaskingSupport.swift"
      provides: "iOS multitasking and scene management"
      min_lines: 200
    - path: "native/Sources/Isometry/Platform/iOS/TouchOptimizations.swift"
      provides: "Touch interface optimizations"
      min_lines: 150
    - path: "native/Sources/Isometry/Views/Notebook/NotebookContentView.swift"
      provides: "Enhanced notebook container for iOS"
      contains: "Split.*View|Slide.*Over"
  key_links:
    - from: "MultitaskingSupport.swift"
      to: "UISceneDelegate"
      via: "scene configuration and state management"
      pattern: "UIScene.*Configuration"
    - from: "TouchOptimizations.swift"
      to: "Canvas and WebView"
      via: "enhanced gesture recognizers"
      pattern: "UIGestureRecognizer"
    - from: "NotebookContentView.swift"
      to: "iOS adaptive layout"
      via: "size class responsive design"
      pattern: "@Environment.*sizeClass"
---

<objective>
Implement iOS-specific features including multitasking support, touch interface optimizations, and iOS 16+ enhancements for the notebook workflow.

Purpose: Provide native iOS experience with split view, slide-over, background processing, and touch-optimized interface that leverages platform capabilities
Output: iOS-optimized notebook interface with full multitasking support and platform-specific enhancements
</objective>

<execution_context>
@/Users/mshaler/.claude/get-shit-done/workflows/execute-plan.md
@/Users/mshaler/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prerequisites from Wave 1 - Canvas and WebView integration
# These provide the preview system that needs iOS optimization
@.planning/phases/06.4-preview-platform-integration/06.4-01-PLAN.md
@.planning/phases/06.4-preview-platform-integration/06.4-02-PLAN.md

# Current notebook infrastructure
@native/Sources/Isometry/Views/Notebook/NotebookContentView.swift

# iOS app structure to enhance
@native/IsometryiOS/IsometryiOSApp.swift
</context>

<tasks>

<task type="auto">
  <name>Task 1: Implement iOS multitasking and scene management</name>
  <files>native/Sources/Isometry/Platform/iOS/MultitaskingSupport.swift</files>
  <action>
    Create MultitaskingSupport module providing comprehensive iOS multitasking functionality for notebook workflow:

    1. **Scene Management**:
       - Implement UISceneDelegate extensions for notebook scene configuration
       - Support multiple windows with independent notebook contexts
       - Handle scene state transitions (active, background, foreground)
       - Preserve notebook state across scene lifecycle events

    2. **Split View Support**:
       - Optimize three-component layout for split view constraints
       - Adaptive component sizing for narrow split view widths
       - Component priority system (capture > preview > shell in constrained space)
       - Maintain usability with minimum width requirements

    3. **Slide-Over Integration**:
       - Configure app for slide-over compatibility
       - Compact layout mode for slide-over presentation
       - Quick capture workflow optimized for slide-over usage
       - Gesture handling for slide-over dismissal and interaction

    4. **Background Processing**:
       - Register for background app refresh capability
       - CloudKit sync operations during background execution
       - Command history persistence before app suspension
       - Memory cleanup and state preservation for backgrounding

    Use UIKit APIs with iOS-specific conditional compilation. Ensure multitasking maintains data integrity and performance.
  </action>
  <verify>App functions properly in split view, slide-over, and background modes</verify>
  <done>iOS multitasking support enables notebook usage in all iOS window modes</done>
</task>

<task type="auto">
  <name>Task 2: Create touch interface optimizations</name>
  <files>native/Sources/Isometry/Platform/iOS/TouchOptimizations.swift</files>
  <action>
    Create TouchOptimizations module enhancing touch interface for Canvas, WebView, and text editing components:

    1. **Enhanced Gesture Recognition**:
       - Custom UIGestureRecognizer subclasses for notebook-specific gestures
       - Multi-touch support for Canvas pan/zoom/rotate operations
       - Touch disambiguation between text selection and Canvas interaction
       - Gesture velocity and acceleration tuning for responsive feel

    2. **Text Editing Enhancements**:
       - Large touch targets for markdown toolbar buttons
       - Swipe gestures for quick formatting (bold, italic, headers)
       - Touch feedback (haptics) for successful command execution
       - Improved text selection with custom UITextView behaviors

    3. **Canvas Touch Integration**:
       - Direct manipulation of visualization nodes with touch
       - Touch pressure sensitivity for drawing operations (where available)
       - Multi-finger gestures for Canvas mode switching
       - Touch-optimized context menus for Canvas elements

    4. **Accessibility Touch Support**:
       - VoiceOver gesture customizations for Canvas navigation
       - Large touch targets meeting accessibility guidelines
       - Switch Control support for external input devices
       - Dynamic Type support for all touch interface elements

    Integrate with VisualizationCanvas from Plan 01 and PreviewWebView from Plan 02. Ensure all touch optimizations work seamlessly with existing SwiftUI components.
  </action>
  <verify>Touch interface provides smooth, responsive interaction across all components</verify>
  <done>Touch optimizations enhance user experience with native iOS gestures</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>iOS-specific notebook features with multitasking and touch optimizations</what-built>
  <how-to-verify>
    Test iOS-specific functionality on device or simulator:

    1. **Multitasking Verification**:
       - Open notebook in split view with another app
       - Verify layout adapts and remains functional
       - Test slide-over mode for quick note capture
       - Confirm background app refresh maintains sync

    2. **Touch Interface Testing**:
       - Test Canvas pan/zoom with finger gestures
       - Verify text editing with touch keyboard
       - Test toolbar buttons with finger-sized touch targets
       - Confirm haptic feedback works for interactions

    3. **Platform Integration**:
       - Test with iOS 16+ Live Activities if applicable
       - Verify Dynamic Type scaling works properly
       - Test with VoiceOver and accessibility features
       - Confirm app responds to iOS system settings changes

    4. **Performance Verification**:
       - Monitor performance in constrained split view
       - Verify smooth scrolling and Canvas rendering
       - Check memory usage in background mode
       - Confirm CloudKit sync works during background refresh
  </how-to-verify>
  <resume-signal>Type "approved" if iOS features work properly, or describe any issues found</resume-signal>
</task>

</tasks>

<verification>
1. App functions properly in iOS split view with adapted layout
2. Slide-over mode provides usable compact interface
3. Touch gestures work smoothly across Canvas and text components
4. Background app refresh maintains CloudKit synchronization
5. Accessibility features work properly with touch optimizations
</verification>

<success_criteria>
- Notebook functions fully in iOS split view and slide-over modes
- Touch interface provides optimized gesture recognition and haptic feedback
- Background app refresh maintains data synchronization seamlessly
- iOS 16+ platform features enhance the notebook workflow appropriately
- All functionality maintains 60fps performance in constrained layouts
</success_criteria>

<output>
After completion, create `.planning/phases/06.4-preview-platform-integration/06.4-03-SUMMARY.md`
</output>