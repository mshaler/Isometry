---
phase: 88-integration-polish
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/notebook/__tests__/ShellComponent.integration.test.tsx
  - src/hooks/__tests__/shell-tab-integration.test.ts
autonomous: true

must_haves:
  truths:
    - "Terminal tab preserves PTY session state when switching to Claude AI and back"
    - "Claude AI tab preserves conversation history when switching to Terminal and back"
    - "GSD tab preserves phase progress display when switching between tabs"
    - "All tab combinations (6 total) maintain state across switches"
  artifacts:
    - path: "src/components/notebook/__tests__/ShellComponent.integration.test.tsx"
      provides: "Tab switch integration tests"
      contains: "preserves.*state"
    - path: "src/hooks/__tests__/shell-tab-integration.test.ts"
      provides: "Hook-level integration tests"
      contains: "tab.*switch"
  key_links:
    - from: "ShellComponent.integration.test.tsx"
      to: "ShellComponent.tsx"
      via: "render and simulate tab switches"
      pattern: "getByRole.*button.*click"
---

<objective>
Create integration tests that verify state preservation across all Shell tab switches.

Purpose: Establish regression safety net for tab switching behavior already implemented in Phase 85-87. These tests document expected behavior and prevent future regressions.

Output: Two test files covering ShellComponent integration and hook-level tab switch scenarios.
</objective>

<execution_context>
@/Users/mshaler/.claude/get-shit-done/workflows/execute-plan.md
@/Users/mshaler/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/88-integration-polish/88-RESEARCH.md
@src/components/notebook/ShellComponent.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ShellComponent integration test file</name>
  <files>src/components/notebook/__tests__/ShellComponent.integration.test.tsx</files>
  <action>
Create integration tests for ShellComponent tab switching. Use React Testing Library with Vitest.

Test cases:
1. Terminal→Claude AI→Terminal preserves terminal state
2. Claude AI→GSD→Claude AI preserves conversation (check message count)
3. GSD→Terminal→GSD preserves phase progress
4. Rapid tab switching (10 consecutive switches) doesn't crash
5. Tab switch during async operation (mock WebSocket message) completes safely

Mock setup:
- Mock useTerminal hook to avoid real PTY spawn
- Mock WebSocket via vi.fn()
- Provide SQLiteProvider and TerminalProvider wrappers

Use renderWithProviders helper pattern from 88-RESEARCH.md.

Verify tests run with `npm run test -- ShellComponent.integration.test`.
  </action>
  <verify>npm run test -- ShellComponent.integration.test --run</verify>
  <done>5+ test cases pass covering tab state preservation scenarios</done>
</task>

<task type="auto">
  <name>Task 2: Create hook-level integration tests</name>
  <files>src/hooks/__tests__/shell-tab-integration.test.ts</files>
  <action>
Create tests for hook-level state management across tab switches.

Test useGSDTerminalIntegration:
1. isMonitoring changes correctly when tab switches to/from GSD
2. processTerminalOutput only called when GSD tab active
3. State callbacks fire correctly regardless of active tab

Test useTerminal + useCommandHistory:
1. Command history persists across tab switches
2. Search mode state persists across tab switches
3. Connection status remains accurate after tab switch

Mock setup:
- Mock GSD service with vi.fn()
- Use @testing-library/react-hooks renderHook

Verify with `npm run test -- shell-tab-integration.test`.
  </action>
  <verify>npm run test -- shell-tab-integration.test --run</verify>
  <done>6+ test cases pass covering hook state preservation</done>
</task>

</tasks>

<verification>
After completing both tasks:
1. Run full test suite: `npm run test --run`
2. Verify no regressions in existing tests
3. Confirm 11+ new tests pass for tab integration
</verification>

<success_criteria>
- [ ] ShellComponent.integration.test.tsx exists with 5+ passing tests
- [ ] shell-tab-integration.test.ts exists with 6+ passing tests
- [ ] All tests verify state preservation, not implementation details
- [ ] No mocking of DOM elements - test user-visible behavior
- [ ] `npm run typecheck` passes
</success_criteria>

<output>
After completion, create `.planning/phases/88-integration-polish/88-01-SUMMARY.md`
</output>
