---
phase: 30-supergrid-foundation
subphase: 30-01
title: "Core Architecture Setup"
status: ready
estimated_duration: "3-4 days"
dependencies: []
verification: true
---

# Phase 30.1: SuperGrid Core Architecture Setup

**Goal:** Establish the foundational 4-grid architecture and coordinate systems for SuperGrid implementation.

**Estimated Duration:** 3-4 days
**Status:** Ready to Start
**Dependencies:** None (builds on existing PAFV/D3 infrastructure)

## Observable Truths (Verification Criteria)

1. **Four-grid layout renders correctly with proper quadrant separation**
   - MiniNav quadrant positioned in top-left
   - Column headers quadrant spans top-right
   - Row headers quadrant spans bottom-left
   - Data cells quadrant fills bottom-right
   - All quadrants coordinate during resize operations

2. **PAFV context integration works seamlessly with axis mappings**
   - SuperGrid consumes current PAFV mappings
   - Grid responds to axis mapping changes
   - Mapping changes trigger proper re-render cycles
   - No data loss during mapping transitions

3. **Coordinate system handles multi-dimensional positioning accurately**
   - Supports both anchor and bipolar coordinate modes
   - Correctly maps LATCH facet values to grid positions
   - Handles sparse data (empty cells) gracefully
   - Coordinate calculations perform efficiently

4. **Type safety maintained with comprehensive interface coverage**
   - No TypeScript errors during build
   - All component props properly typed
   - Runtime type validation for critical data paths
   - Interface contracts clearly defined

5. **Basic performance targets met for foundation layer**
   - Initial render completes in < 2 seconds with 100 nodes
   - No memory leaks detected during component lifecycle
   - Smooth resize operations (60fps)
   - Proper cleanup on component unmount

## Required Artifacts

### Core Components
- `src/components/supergrid/SuperGridContainer.tsx` - Main container orchestrating 4 quadrants
- `src/components/supergrid/QuadrantLayout.tsx` - Grid layout manager with responsive behavior
- `src/components/supergrid/MiniNavQuadrant.tsx` - Enhanced MiniNav for axis control
- `src/components/supergrid/DataCellsQuadrant.tsx` - Data display quadrant foundation

### Coordinate System
- `src/hooks/useSupergridCoordinates.ts` - Multi-dimensional coordinate management
- `src/utils/supergrid-coordinates.ts` - Coordinate calculation utilities
- `src/types/supergrid-enhanced.ts` - Extended type definitions

### Integration Layer
- `src/hooks/useSupergridContext.ts` - SuperGrid-specific context management
- `src/components/supergrid/SuperGridProvider.tsx` - Context provider component

## Detailed Implementation Plan

### Day 1-2: Foundation Components

**SuperGridContainer.tsx**
```typescript
interface SuperGridContainerProps {
  data: Node[];
  width: number;
  height: number;
  onCellClick?: (node: Node, position: CellPosition) => void;
}

export function SuperGridContainer({ data, width, height, onCellClick }: SuperGridContainerProps) {
  // Orchestrate 4-quadrant layout
  // Handle resize events
  // Coordinate cross-quadrant interactions
}
```

**QuadrantLayout.tsx**
```typescript
interface QuadrantLayoutProps {
  miniNavWidth: number;
  headerHeight: number;
  children: {
    miniNav: ReactNode;
    columnHeaders: ReactNode;
    rowHeaders: ReactNode;
    dataCells: ReactNode;
  };
}
```

### Day 2-3: Coordinate System Enhancement

**useSupergridCoordinates.ts**
```typescript
interface SupergridCoordinates {
  // Multi-dimensional positioning
  mapFacetToPosition: (axis: LATCHAxis, facetPath: string) => number;
  mapPositionToFacet: (axis: LATCHAxis, position: number) => string;

  // Coordinate system management
  getAxisRange: (axis: LATCHAxis) => AxisRange;
  convertCoordinates: (from: OriginPattern, to: OriginPattern, position: CellPosition) => CellPosition;

  // Performance optimization
  getCachedPosition: (nodeId: number) => CellPosition | null;
  invalidateCache: () => void;
}
```

### Day 3-4: PAFV Integration & Testing

**useSupergridContext.ts**
```typescript
interface SupergridContextValue {
  // State management
  gridConfig: GridConfig;
  updateGridConfig: (config: Partial<GridConfig>) => void;

  // Axis management
  currentMappings: PAFVMapping[];
  updateMapping: (mapping: PAFVMapping) => void;

  // Performance tracking
  renderMetrics: PerformanceMetrics;

  // Event handlers
  onQuadrantResize: (quadrant: GridQuadrant, dimensions: Dimensions) => void;
}
```

## Testing Strategy

### Unit Tests
- Coordinate calculation accuracy
- PAFV mapping integration
- Component prop validation
- Performance metric collection

### Integration Tests
- 4-quadrant layout coordination
- Context provider functionality
- Resize behavior validation
- Memory leak detection

### Manual Verification
1. **Layout Verification**: Visual inspection of 4-quadrant positioning
2. **Responsiveness**: Test resize behavior across screen sizes
3. **Data Integration**: Verify proper consumption of SQLite data
4. **Performance**: Monitor render times and memory usage

## Key Risks & Mitigations

### Risk: Complex quadrant coordination
**Mitigation:** Start with simple static layout, add dynamic behavior incrementally

### Risk: PAFV integration breaking changes
**Mitigation:** Use established patterns from existing grid components, comprehensive testing

### Risk: Performance degradation with multi-dimensional data
**Mitigation:** Implement performance monitoring from day 1, optimize coordinate caching

## Links to Existing Code

### Build Upon
- `src/components/SuperGridDemo.tsx` - Existing demo for reference patterns
- `src/types/supergrid.ts` - Existing type definitions to extend
- `src/hooks/useGridCoordinates.ts` - Pattern for coordinate management

### Integrate With
- `src/state/PAFVContext.tsx` - Primary axis mapping source
- `src/state/FilterContext.tsx` - Data filtering integration
- `src/hooks/useFilteredNodes.ts` - Data source hook

### Replace/Enhance
- `src/components/MiniNav.tsx` - Enhance for SuperGrid-specific needs
- `src/utils/coordinate-system.ts` - Extend for multi-dimensional support

## Success Criteria

✅ **Architecture Foundation**
- 4-quadrant layout renders correctly
- Component hierarchy follows established patterns
- TypeScript interfaces provide clear contracts

✅ **Integration Readiness**
- PAFV context integration functional
- Data flow from SQLite to components working
- Event handling system in place

✅ **Performance Baseline**
- Initial render performance documented
- Memory usage baseline established
- No obvious performance regressions

## Next Phase Preview

Phase 30.2 will focus on the header architecture, building recursive header components and implementing the basic spanning calculation algorithm. The foundation established in 30.1 will provide the coordinate system and layout framework needed for the more complex header hierarchies.

---

_Plan created: 2026-01-31_
_Phase template: GSD with verification_