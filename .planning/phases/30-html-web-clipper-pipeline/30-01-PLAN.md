---
phase: 30
plan: 30-01
type: auto
autonomous: true
wave: 1
title: "Core HTML Web Clipping Infrastructure"
estimated_duration: "45-60 minutes"
dependencies: []
verification: true
---

# Wave 1: Core HTML Web Clipping Infrastructure

**Goal:** Establish core HTML web clipping infrastructure with clean content extraction using Readability algorithm and metadata preservation.

**Wave:** 1 of 4 (extraction → caching → UI → integration)
**Type:** autonomous
**Duration:** 45-60 minutes

## Context Files

@src/db/schema.sql - Understand existing Node and Edge schema for integration
@native/Sources/Isometry/Import/ - Follow existing import patterns (AltoIndexImporter)
@native/Sources/Isometry/Models/ - Use ImportResult and ImportError conventions

## Objective

Build the foundation for web content extraction that:
- Extracts clean, readable content from HTML using Readability algorithm
- Preserves metadata (Open Graph, Twitter Cards, JSON-LD)
- Follows existing Swift Actor import patterns
- Integrates with current Node/Edge schema

## Tasks

### Task 1: Swift Actor WebClipper Infrastructure
**Type:** auto
**Description:** Create WebClipperActor following existing import patterns with Readability algorithm implementation.

**Implementation:**
- Create `WebClipperActor.swift` in `native/Sources/Isometry/WebClipper/`
- Implement WebKit-based content extraction
- Add Readability algorithm for content cleaning
- Use URLSessionActor for HTTP requests with proper headers
- Follow existing ImportResult/ImportError patterns

**Files to create:**
- `native/Sources/Isometry/WebClipper/WebClipperActor.swift`
- `native/Sources/Isometry/WebClipper/ReadabilityEngine.swift`
- `native/Sources/Isometry/WebClipper/MetadataExtractor.swift`

**Verification:** WebClipperActor can extract content from basic HTML pages

### Task 2: Metadata Extraction System
**Type:** auto
**Description:** Implement comprehensive metadata extraction from web pages including Open Graph, Twitter Cards, and JSON-LD.

**Implementation:**
- Extract Open Graph properties (title, description, image, type, url)
- Parse Twitter Card metadata
- Extract JSON-LD structured data
- Fallback to basic HTML meta tags
- Store metadata as Node properties following schema

**Verification:** Metadata extraction works for common website types (news, blog, social media)

### Task 3: Content Cleaning and Readability
**Type:** auto
**Description:** Implement Readability algorithm for extracting clean, readable content from web pages.

**Implementation:**
- Remove ads, navigation, sidebars, comments
- Identify main content area
- Preserve semantic HTML structure
- Handle images and embedded media appropriately
- Extract text content while maintaining formatting

**Verification:** Content extraction produces clean, readable text from complex web pages

### Task 4: Database Integration
**Type:** auto
**Description:** Integrate web clipper with existing Node/Edge schema and database layer.

**Implementation:**
- Create WebClipNode model extending Node
- Store original URL, cleaned content, metadata
- Create edges for URL references and content relationships
- Follow existing database patterns from AltoIndexImporter
- Handle duplicate URL detection

**Verification:** Web-clipped content appears correctly in database with proper relationships

## Verification Criteria

1. **WebClipperActor follows Swift Actor patterns**
   - Uses `@MainActor` appropriately
   - Implements proper error handling with ImportError types
   - Returns ImportResult with success/failure status
   - Thread-safe operation with proper isolation

2. **Readability algorithm extracts clean content**
   - Removes navigation, ads, comments, sidebars
   - Preserves main article content with formatting
   - Handles various website layouts and structures
   - Performance acceptable (< 5 seconds per page)

3. **Metadata extraction is comprehensive**
   - Open Graph properties extracted correctly
   - Twitter Card metadata captured
   - JSON-LD structured data parsed
   - Fallback to HTML meta tags works

4. **Database integration follows existing patterns**
   - WebClipNode extends Node schema appropriately
   - Content stored in database with proper indexing
   - Edges created for URL and content relationships
   - No schema conflicts with existing data

## Success Criteria

- WebClipperActor successfully extracts content from test URLs
- Metadata extraction works for major website types
- Clean content extraction handles various page layouts
- Database integration stores clipped content properly
- No performance regressions in existing import systems

## Done Criteria

- [ ] WebClipperActor created and tested
- [ ] Readability engine extracts clean content
- [ ] Metadata extraction covers Open Graph, Twitter Cards, JSON-LD
- [ ] Database integration stores clipped content with relationships
- [ ] Unit tests pass for all web clipping components