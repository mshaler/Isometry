---
phase: 35-pafv-grid-core
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [
  "src/components/CardDetailModal.tsx",
  "src/d3/SuperGrid.ts",
  "src/components/SuperGridDemo.tsx"
]
autonomous: true

must_haves:
  truths:
    - "User can click a card in SuperGrid and see detail modal with card data"
    - "User can edit card fields in modal and save changes to database"
    - "Modal shows proper card status colors and priority indicators"
    - "Changes in modal trigger grid re-render with updated data"
  artifacts:
    - path: "src/components/CardDetailModal.tsx"
      provides: "Complete card detail modal component"
      min_lines: 250
    - path: "src/d3/SuperGrid.ts"
      provides: "SuperGrid with modal integration"
      contains: "onCardClick callback"
    - path: "src/components/SuperGridDemo.tsx"
      provides: "SuperGrid demo with modal state management"
      contains: "CardDetailModal component"
  key_links:
    - from: "src/d3/SuperGrid.ts"
      to: "CardDetailModal"
      via: "card click callback"
      pattern: "onCardClick.*callback"
    - from: "CardDetailModal"
      to: "sql.js database"
      via: "onSave callback"
      pattern: "UPDATE.*nodes.*SET"
---

<objective>
Integrate existing CardDetailModal with SuperGrid card clicks to enable rich card viewing and editing

Purpose: Transform basic card click console logging into full interactive card management with database persistence
Output: Working card detail modal triggered by SuperGrid card clicks with edit and save functionality
</objective>

<execution_context>
@/Users/mshaler/.claude/get-shit-done/workflows/execute-plan.md
@/Users/mshaler/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/34-foundation-stabilization/34-02-SUMMARY.md
@.planning/phases/34-foundation-stabilization/34-03-PLAN.md
@src/components/CardDetailModal.tsx
@src/d3/SuperGrid.ts
@src/components/SuperGridDemo.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Complete CardDetailModal Implementation</name>
  <files>src/components/CardDetailModal.tsx</files>
  <action>
    Complete the CardDetailModal component to handle full card lifecycle:

    1. Add missing import for proper TypeScript card interface from existing codebase
    2. Enhance form validation for required fields (name cannot be empty)
    3. Add keyboard shortcuts (Escape to close, Ctrl+S to save)
    4. Add loading states for save operations
    5. Implement proper error handling for database operations
    6. Add a delete card option with confirmation dialog
    7. Ensure modal is accessible with proper focus management
    8. Add timestamp updates for modified_at field

    Follow existing CLAUDE.md patterns - use shadcn/ui components where possible, maintain strict TypeScript compliance.
    The modal should handle the complete CRUD lifecycle for cards with proper UX patterns.
  </action>
  <verify>npm run typecheck passes with zero errors, modal component renders without console errors</verify>
  <done>CardDetailModal supports view/edit/save/delete operations with proper validation and accessibility</done>
</task>

<task type="auto">
  <name>Task 2: Integrate Modal with SuperGrid Callbacks</name>
  <files>src/d3/SuperGrid.ts</files>
  <action>
    Update SuperGrid to properly invoke the card detail modal via callbacks:

    1. Enhance SuperGridCallbacks interface to include better typing
    2. Replace console.log('Card clicked') with actual onCardClick callback invocation
    3. Add proper card data extraction for modal (ensure all fields are included)
    4. Add onCardUpdate callback to handle database updates from modal
    5. Implement proper error handling for card update operations
    6. Add success feedback mechanism (optional flash message or status indicator)
    7. Ensure card updates trigger immediate grid re-render with fresh data
    8. Follow existing CLAUDE.md D3.js patterns (.join() with key functions)

    The SuperGrid should act as the bridge between D3.js click events and React modal state management.
  </action>
  <verify>Card clicks trigger onCardClick callback with complete card data, grid re-renders after card updates</verify>
  <done>SuperGrid properly integrates with React modal system via well-defined callbacks</done>
</task>

<task type="auto">
  <name>Task 3: Wire SuperGridDemo with Modal State Management</name>
  <files>src/components/SuperGridDemo.tsx</files>
  <action>
    Integrate CardDetailModal into SuperGridDemo with proper state management:

    1. Add modal state (isOpen, selectedCard) to component state
    2. Add CardDetailModal component to render tree with proper props
    3. Implement handleCardClick to set selected card and open modal
    4. Implement handleModalSave to update database and refresh grid
    5. Implement handleModalClose to clear selection and close modal
    6. Add proper error handling and loading states for database operations
    7. Ensure modal appears above all other UI elements (z-index)
    8. Add modal keyboard shortcuts integration
    9. Wire up delete functionality with grid refresh

    Follow React patterns from existing codebase - use proper TypeScript types, handle async operations correctly.
    The demo should showcase the complete interactive card workflow.
  </action>
  <verify>Card clicks open modal with card data, edits save to database and refresh grid, modal closes properly</verify>
  <done>SuperGridDemo demonstrates complete card interaction workflow with modal integration</done>
</task>

</tasks>

<verification>
1. Click any card in SuperGrid demo - modal opens with card details
2. Edit card name, folder, status in modal - changes are reflected
3. Save changes - grid re-renders with updated data
4. Delete card - card disappears from grid
5. Modal keyboard shortcuts work (Escape, Ctrl+S)
6. TypeScript compilation succeeds with zero errors
</verification>

<success_criteria>
- SuperGrid card clicks trigger detailed modal instead of console.log
- Modal displays complete card information with proper styling
- User can edit all card fields with proper validation
- Database updates persist and trigger grid refresh
- Modal provides excellent UX with keyboard shortcuts and accessibility
- Zero TypeScript compilation errors
</success_criteria>

<output>
After completion, create `.planning/phases/35-pafv-grid-core/35-01-SUMMARY.md`
</output>