---
phase: 35-pafv-grid-core
plan: 03
type: execute
wave: 2
depends_on: ["35-01"]
files_modified: [
  "src/d3/SuperGrid.ts",
  "src/services/SelectionManager.ts",
  "src/components/SuperGridDemo.tsx"
]
autonomous: false

must_haves:
  truths:
    - "User can select multiple cards with Ctrl+click in SuperGrid"
    - "User can navigate grid with keyboard arrow keys"
    - "Selected cards show visual feedback with highlight styling"
    - "User can perform bulk operations on selected cards (delete, move folder)"
  artifacts:
    - path: "src/services/SelectionManager.ts"
      provides: "Multi-selection state management service"
      min_lines: 120
      exports: ["SelectionManager", "SelectionState"]
    - path: "src/d3/SuperGrid.ts"
      provides: "SuperGrid with keyboard navigation and multi-select"
      contains: "keydown.*arrow.*navigation"
    - path: "src/components/SuperGridDemo.tsx"
      provides: "Demo with selection UI and bulk operations"
      contains: "bulkOperations.*selected"
  key_links:
    - from: "SuperGrid keyboard events"
      to: "SelectionManager"
      via: "selection state updates"
      pattern: "setSelected.*cards"
    - from: "SelectionManager"
      to: "D3.js visual feedback"
      via: "selection styling updates"
      pattern: "selectedCards.*highlight"
---

<objective>
Implement multi-select functionality and keyboard navigation for enhanced SuperGrid interaction

Purpose: Enable power-user workflows with multi-card selection and keyboard-driven grid navigation
Output: Working multi-select with visual feedback, keyboard navigation, and bulk operations
</objective>

<execution_context>
@/Users/mshaler/.claude/get-shit-done/workflows/execute-plan.md
@/Users/mshaler/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/35-pafv-grid-core/35-01-SUMMARY.md
@src/d3/SuperGrid.ts
@src/components/SuperGridDemo.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create SelectionManager Service</name>
  <files>src/services/SelectionManager.ts</files>
  <action>
    Create a comprehensive selection management service for SuperGrid multi-select functionality:

    1. Define SelectionState interface with selectedIds, focusedId, selectionMode
    2. Create SelectionManager class with methods:
       - selectCard(id, mode: 'single' | 'add' | 'range') - handle different selection modes
       - deselectCard(id) - remove card from selection
       - selectAll() - select all visible cards
       - clearSelection() - deselect all cards
       - setFocus(id) - set keyboard focus to specific card
       - moveSelection(direction: 'up' | 'down' | 'left' | 'right') - keyboard navigation
       - getSelectedCards() - return current selection
       - isSelected(id) - check if card is selected
    3. Implement selection modes:
       - Single click: clear previous, select clicked
       - Ctrl+click: toggle selection on clicked card
       - Shift+click: select range from last focused to clicked
    4. Add keyboard navigation logic:
       - Arrow keys move focus and optionally extend selection
       - Shift+arrows extend selection in direction
       - Ctrl+A select all, Escape clear selection
    5. Add selection change callbacks for external components
    6. Handle grid layout changes (card positions for navigation)
    7. Implement selection persistence across filter changes
    8. Add selection statistics (count, types)
    9. Export proper TypeScript interfaces

    Follow CLAUDE.md patterns - strict typing, comprehensive error handling, event-driven architecture.
  </action>
  <verify>npm run typecheck passes, SelectionManager exports correct interfaces and methods</verify>
  <done>SelectionManager provides complete multi-select state management with keyboard navigation</done>
</task>

<task type="auto">
  <name>Task 2: Integrate Multi-Select and Keyboard Navigation in SuperGrid</name>
  <files>src/d3/SuperGrid.ts</files>
  <action>
    Update SuperGrid to support multi-select and keyboard navigation:

    1. Import and initialize SelectionManager in constructor
    2. Add keyboard event handlers to SVG container:
       - keydown event listener for arrow keys, Ctrl+A, Escape, Space, Enter
       - Handle focus management and prevent default browser scrolling
       - Implement arrow key navigation based on grid layout
    3. Update card click handlers:
       - Check for Ctrl/Shift modifiers on click events
       - Call appropriate SelectionManager methods based on modifiers
       - Prevent card detail modal on multi-select operations (Ctrl+click)
    4. Add selection visual feedback:
       - Apply selected styling to cards (border, background, shadow)
       - Add focus indicator for keyboard-focused card
       - Implement selection highlight animation
    5. Update renderCards method to apply selection styling using D3.js join patterns
    6. Add selection callbacks to SuperGridCallbacks interface:
       - onSelectionChange(selectedIds) - notify external components
       - onFocusChange(focusedId) - update focus state
    7. Handle selection state during grid updates (maintain selection when data refreshes)
    8. Add bulk operation hooks (onBulkDelete, onBulkMove callbacks)
    9. Implement proper accessibility with ARIA attributes
    10. Add visual indicators for multi-select mode (selection counter)

    Maintain CLAUDE.md D3.js patterns, use proper .join() with key functions, handle state immutably.
  </action>
  <verify>Ctrl+click selects multiple cards, arrow keys navigate, selected cards show visual feedback</verify>
  <done>SuperGrid supports complete multi-select interaction with keyboard navigation and visual feedback</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Multi-select SuperGrid with keyboard navigation and visual selection feedback</what-built>
  <how-to-verify>
    1. Visit SuperGrid demo at http://localhost:5174
    2. Click "Supergrid" tab to access demo
    3. Test multi-select functionality:
       - Single-click a card - should select only that card with visual highlight
       - Ctrl+click another card - should add to selection
       - Shift+click a third card - should select range
    4. Test keyboard navigation:
       - Use arrow keys to move focus (blue outline)
       - Use Shift+arrows to extend selection
       - Use Ctrl+A to select all visible cards
       - Use Escape to clear selection
    5. Verify visual feedback:
       - Selected cards have highlighted border/background
       - Focused card has distinct outline
       - Selection counter shows correct count
    6. Test interaction with filtering:
       - Apply folder filter, verify selection state maintained
       - Clear filters, verify selection still works
  </how-to-verify>
  <resume-signal>Type "approved" if multi-select and keyboard navigation work correctly, or describe any issues found</resume-signal>
</task>

<task type="auto">
  <name>Task 3: Add Selection UI and Bulk Operations to SuperGridDemo</name>
  <files>src/components/SuperGridDemo.tsx</files>
  <action>
    Enhance SuperGridDemo to support selection management and bulk operations:

    1. Add selection state management to component (selectedCards, selectionCount)
    2. Create selection status panel showing:
       - Current selection count
       - Selection mode indicator
       - Quick actions for bulk operations
    3. Implement bulk operation buttons:
       - "Delete Selected" - remove selected cards from database
       - "Move to Folder" dropdown - change folder for selected cards
       - "Update Status" dropdown - change status for selected cards
       - "Clear Selection" - deselect all cards
    4. Add confirmation dialogs for destructive bulk operations
    5. Add keyboard shortcut indicators in UI:
       - Help text showing Ctrl+click, Shift+click, arrow keys, etc.
       - Toggle help panel with keyboard shortcut reference
    6. Implement handleSelectionChange callback to sync with SuperGrid
    7. Add selection statistics to performance monitor:
       - Show selected/total ratio
       - Memory impact of selection state
    8. Add bulk operation success/error feedback:
       - Toast notifications for successful operations
       - Error handling for failed bulk operations
    9. Implement selection export functionality (copy selected card IDs)
    10. Add accessibility improvements (screen reader announcements for selection changes)

    Follow existing demo UI patterns, maintain consistency with other control panels.
  </action>
  <verify>Bulk operations work on selected cards, selection UI shows correct counts, confirmation dialogs appear</verify>
  <done>SuperGridDemo provides comprehensive selection management with bulk operations and user feedback</done>
</task>

</tasks>

<verification>
1. Click cards with Ctrl modifier - multiple cards selected with visual feedback
2. Use arrow keys - focus moves between cards correctly
3. Use Shift+arrow - selection extends in direction
4. Use Ctrl+A - all visible cards selected
5. Use Delete Selected button - confirmation dialog appears, selected cards removed
6. Use Move to Folder - selected cards update folder, grid refreshes
7. Selection counter shows correct count
8. Keyboard shortcut help displays correctly
9. TypeScript compilation succeeds with zero errors
</verification>

<success_criteria>
- Multi-select works with Ctrl+click and Shift+click patterns
- Keyboard navigation provides smooth grid traversal with arrow keys
- Visual feedback clearly distinguishes selected and focused cards
- Bulk operations work efficiently on selected card sets
- Selection state persists across filtering and grid updates
- Zero TypeScript compilation errors
</success_criteria>

<output>
After completion, create `.planning/phases/35-pafv-grid-core/35-03-SUMMARY.md`
</output>