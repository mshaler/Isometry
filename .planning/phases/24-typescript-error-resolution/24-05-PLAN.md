---
phase: 24-typescript-error-resolution
plan: 05
type: execute
wave: 2
depends_on: ["24-01", "24-02", "24-03"]
files_modified: [
  "src/utils/enhanced-sync.ts",
  "src/utils/file-system-bridge.ts",
  "src/utils/filter-presets.ts",
  "src/utils/input-sanitization.ts",
  "src/utils/performance-monitor.ts",
  "src/utils/webview-bridge.ts"
]
autonomous: true

must_haves:
  truths:
    - "Sync utilities handle undefined values safely in string operations"
    - "File system bridge defines all variables properly in scope"
    - "Filter presets maintain proper FilterState typing"
    - "Input sanitization uses consistent type patterns"
    - "Performance monitor uses correct DatabaseMode enum values"
    - "WebView bridge removes unused variable declarations"
  artifacts:
    - path: "src/utils/enhanced-sync.ts"
      provides: "Safe string operations with undefined handling"
      min_lines: 350
    - path: "src/utils/file-system-bridge.ts"
      provides: "File operations with proper variable scoping"
      contains: "content, options"
    - path: "src/utils/filter-presets.ts"
      provides: "Type-safe filter preset handling"
      contains: "FilterState"
  key_links:
    - from: "src/utils/performance-monitor.ts"
      to: "src/types/database.ts"
      via: "DatabaseMode enum import"
      pattern: "DatabaseMode"
---

<objective>
Fix TypeScript errors in remaining utility modules by addressing undefined handling, variable scoping, type consistency, and enum usage issues.

Purpose: Complete the utility module cleanup to ensure all supporting infrastructure compiles correctly with proper type safety.

Output: Clean compilation for all remaining utility modules with consistent typing patterns.
</objective>

<execution_context>
@/Users/mshaler/.claude/get-shit-done/workflows/execute-plan.md
@/Users/mshaler/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Established utility patterns from Phase 10
@.planning/phases/10-foundation-cleanup/10-23-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Fix Enhanced Sync Undefined Handling</name>
  <files>src/utils/enhanced-sync.ts</files>
  <action>
    Fix the undefined value handling in enhanced-sync.ts:

    1. Line 370: Fix "string | undefined is not assignable to string" error
       - Add null coalescing: `value ?? ''` or `value || ''`
       - Or add proper undefined check: `if (value !== undefined) { ... }`
       - Ensure string operations are safe with undefined values

    2. Review the sync operation context to determine:
       - Whether undefined should be treated as empty string
       - Whether undefined should be filtered out
       - Whether operation should be skipped for undefined values

    3. Apply consistent undefined handling pattern throughout sync operations

    Use the established pattern from Phase 10 for safe property access and undefined handling.
  </action>
  <verify>enhanced-sync.ts compiles without undefined assignment errors</verify>
  <done>Sync utilities handle undefined values safely in all string operations</done>
</task>

<task type="auto">
  <name>Fix File System Bridge Variable Scope</name>
  <files>src/utils/file-system-bridge.ts</files>
  <action>
    Fix the undefined variable errors in file-system-bridge.ts:

    1. Line 382: Fix "Cannot find name 'content'" error
       - Ensure 'content' variable is properly declared in scope
       - Add proper parameter declaration or variable initialization

    2. Line 385: Fix "Cannot find name 'options'" error
       - Ensure 'options' variable is properly declared in scope
       - Add proper parameter declaration or variable initialization

    3. Review the file operation function signatures to ensure:
       - All parameters are properly declared
       - Variable scope is consistent throughout functions
       - No references to undeclared variables

    Apply the variable scoping patterns established in Phase 10 for utility functions.
  </action>
  <verify>file-system-bridge.ts compiles without undefined variable errors</verify>
  <done>File system bridge defines all variables properly within function scope</done>
</task>

<task type="auto">
  <name>Fix Filter Presets and Input Sanitization Types</name>
  <files>src/utils/filter-presets.ts, src/utils/input-sanitization.ts</files>
  <action>
    Fix type assignment issues in filter and input utilities:

    1. filter-presets.ts line 42: Fix FilterPreset type assignment
       - Ensure 'filters' property matches FilterState interface
       - Add type assertion: `filters: unknown as FilterState` or proper validation
       - Import FilterState interface if missing

    2. input-sanitization.ts line 227: Fix null assignment to string|number|boolean|undefined
       - Change null to undefined: `return undefined;` instead of `return null;`
       - Or update return type to include null if that's intended

    3. input-sanitization.ts line 284: Fix object assignment to primitive type
       - Ensure return value matches expected type
       - Fix object literal assignment to primitive type union

    Apply the type consistency patterns established in Phase 10 for data validation utilities.
  </action>
  <verify>filter-presets.ts and input-sanitization.ts compile without type assignment errors</verify>
  <done>Filter presets and input sanitization use consistent type patterns</done>
</task>

<task type="auto">
  <name>Fix Performance Monitor and WebView Bridge Issues</name>
  <files>src/utils/performance-monitor.ts, src/utils/webview-bridge.ts</files>
  <action>
    Fix the remaining issues in performance and bridge utilities:

    1. performance-monitor.ts unused variable cleanup:
       - Line 108: Remove unused 'metricsBuffer' or prefix with underscore
       - Line 117: Remove unused 'intersectionObserver' or prefix with underscore

    2. performance-monitor.ts DatabaseMode enum issues:
       - Lines 318, 562: Fix "webview" is not assignable to DatabaseMode
       - Check DatabaseMode enum definition and use correct enum value
       - Ensure proper import of DatabaseMode type

    3. webview-bridge.ts line 321: Remove unused 'legacyCleanup' variable
       - Delete the variable declaration if truly unused
       - Or prefix with underscore if it's a placeholder

    Apply the enum usage and variable cleanup patterns from Phase 10.
  </action>
  <verify>performance-monitor.ts and webview-bridge.ts compile without enum or variable errors</verify>
  <done>Performance monitor and WebView bridge have clean variable usage and proper enum handling</done>
</task>

</tasks>

<verification>
- Run `npx tsc --noEmit` on all remaining utility files
- Test sync operations work correctly with undefined value handling
- Verify file system operations have proper variable scope
- Check filter presets and input sanitization maintain type safety
- Confirm performance monitoring and WebView bridge function correctly
</verification>

<success_criteria>
1. Enhanced sync handles undefined values safely without type errors
2. File system bridge has proper variable declarations in all function scopes
3. Filter presets maintain FilterState typing consistency
4. Input sanitization uses proper type patterns for all return values
5. Performance monitor uses correct DatabaseMode enum values
6. All utility modules compile without TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/24-typescript-error-resolution/24-05-SUMMARY.md`
</output>