---
phase: 24-typescript-error-resolution
plan: 04
type: execute
wave: 2
depends_on: ["24-01", "24-02", "24-03"]
files_modified: [
  "src/utils/bridge-performance.ts",
  "src/utils/commandHistory.ts",
  "src/utils/d3Parsers.ts",
  "src/utils/d3Performance.ts",
  "src/utils/d3Testing.ts"
]
autonomous: true

must_haves:
  truths:
    - "Bridge performance utilities properly filter typed result arrays"
    - "Command history handles spread operations on proper object types"
    - "D3 parsers safely handle unknown data with proper type guards"
    - "Performance utilities use declared variables without unused warnings"
  artifacts:
    - path: "src/utils/bridge-performance.ts"
      provides: "Type-safe bridge performance monitoring"
      contains: "BridgeTestResult"
    - path: "src/utils/commandHistory.ts"
      provides: "Command history with proper object spreading"
      min_lines: 40
    - path: "src/utils/d3Parsers.ts"
      provides: "D3 data parsers with safe unknown handling"
      exports: ["parseD3Data"]
  key_links:
    - from: "src/utils/bridge-performance.ts"
      to: "src/types/bridge.ts"
      via: "BridgeTestResult interface usage"
      pattern: "BridgeTestResult"
---

<objective>
Fix TypeScript errors in utility modules by resolving array filter typing, spread operation issues, unknown data handling, and unused variable cleanup.

Purpose: Ensure all utility modules supporting the visualization and bridge systems compile correctly with proper type safety.

Output: Clean compilation for all utility modules with proper type guards and variable usage patterns.
</objective>

<execution_context>
@/Users/mshaler/.claude/get-shit-done/workflows/execute-plan.md
@/Users/mshaler/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Type guard patterns from Phase 10
@.planning/phases/10-foundation-cleanup/10-23-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Fix Bridge Performance Array Filtering</name>
  <files>src/utils/bridge-performance.ts</files>
  <action>
    Fix the array filter typing issues with BridgeTestResult in bridge-performance.ts:

    1. Lines 564, 567-568: Fix filter predicate typing where unknown arrays need proper typing
       - Add type assertion for the array: `(results as BridgeTestResult[]).filter(...)`
       - Or add proper type guard function for runtime safety
       - Ensure BridgeTestResult interface is properly imported

    2. Create type guard if needed:
       ```typescript
       function isBridgeTestResult(item: unknown): item is BridgeTestResult {
         return typeof item === 'object' && item !== null &&
                'success' in item && 'duration' in item;
       }
       ```

    3. Apply the type guard pattern throughout the file for consistent unknown handling

    Follow the established pattern from Phase 10 where unknown data is safely filtered through proper type guards.
  </action>
  <verify>bridge-performance.ts compiles without array filter typing errors</verify>
  <done>Bridge performance utilities properly filter typed result arrays</done>
</task>

<task type="auto">
  <name>Fix Command History Spread Operations</name>
  <files>src/utils/commandHistory.ts</files>
  <action>
    Fix the spread operation and unknown type issues in commandHistory.ts:

    1. Line 49: Fix "Spread types may only be created from object types" error
       - Ensure the value being spread is properly typed as an object
       - Add type guard or assertion: `...(item as CommandEntry)` or proper validation

    2. Line 50: Fix 'entry' is of type 'unknown'
       - Add type assertion or type guard for command history entries
       - Ensure CommandEntry interface is properly defined and imported

    3. Review the command history data structure to ensure:
       - Proper CommandEntry interface definition
       - Safe handling of stored/retrieved command data
       - Consistent typing throughout history operations

    Apply the object spreading safety pattern established in Phase 10.
  </action>
  <verify>commandHistory.ts compiles without spread operation or unknown type errors</verify>
  <done>Command history handles spread operations on properly typed objects</done>
</task>

<task type="auto">
  <name>Fix D3 Parsers Unknown Data Handling</name>
  <files>src/utils/d3Parsers.ts</files>
  <action>
    Fix the unknown data type handling throughout d3Parsers.ts:

    1. Line 168: Fix 'd' is of type 'unknown' in D3 data processing
       - Add proper type assertion: `const data = d as ParsedData` or type guard
       - Ensure consistent data typing for D3 operations

    2. Lines 347, 384: Fix 'row' is of type 'unknown' in data parsing
       - Add type guards for CSV/data row parsing
       - Use proper data validation for parsed content

    3. Lines 408, 497: Fix Object.keys() calls on unknown objects
       - Add type guards: `if (typeof row === 'object' && row !== null)`
       - Safe object key extraction with proper validation

    4. Line 412: Fix 'row' property access on unknown type
       - Use safe property access with type guards

    5. Lines 543, 547: Fix 'config' is of type 'unknown'
       - Add configuration object type guards and validation

    Apply the comprehensive unknown data handling patterns from Phase 10.
  </action>
  <verify>d3Parsers.ts compiles without unknown type access errors</verify>
  <done>D3 parsers safely handle all unknown data with proper type guards</done>
</task>

<task type="auto">
  <name>Clean Up Performance Utility Variables</name>
  <files>src/utils/d3Performance.ts, src/utils/d3Testing.ts</files>
  <action>
    Clean up unused variables in performance utility modules:

    1. d3Performance.ts lines 535-536: Remove unused 'fromState' and 'toState' variables
       - Delete the variable declarations if truly unused
       - Or use underscore prefix if they're placeholders: `_fromState`, `_toState`

    2. d3Testing.ts line 26: Remove unused 'priorities' variable
       - Check if variable is needed for test data generation
       - Remove if unused, or implement the intended functionality

    3. Review both files for any other unused variable declarations
       - Apply consistent cleanup pattern established in Phase 10

    Follow the unused variable cleanup pattern from Phase 10 where variables are either removed or prefixed with underscore.
  </action>
  <verify>d3Performance.ts and d3Testing.ts compile without unused variable warnings</verify>
  <done>Performance utilities use only declared variables without unused warnings</done>
</task>

</tasks>

<verification>
- Run `npx tsc --noEmit` on all utility files and confirm error reduction
- Test bridge performance monitoring functions work correctly
- Verify command history save/load operations function properly
- Check D3 parsing operations handle data without runtime errors
</verification>

<success_criteria>
1. Bridge performance utilities filter arrays with proper typing
2. Command history handles object spreading safely
3. D3 parsers use proper type guards for unknown data
4. All performance utilities compile without unused variable warnings
5. Utility module compilation errors significantly reduced
</success_criteria>

<output>
After completion, create `.planning/phases/24-typescript-error-resolution/24-04-SUMMARY.md`
</output>