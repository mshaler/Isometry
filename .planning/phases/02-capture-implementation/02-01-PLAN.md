---
phase: 02-capture-implementation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [
  "src/components/notebook/CaptureComponent.tsx",
  "src/hooks/useSlashCommands.ts"
]
autonomous: true

must_haves:
  truths:
    - "User can trigger slash command menu by typing '/'"
    - "User can insert Isometry DSL patterns via slash commands"
    - "User can see contextual slash command suggestions"
  artifacts:
    - path: "src/components/notebook/CaptureComponent.tsx"
      provides: "Enhanced markdown editor with slash command integration"
      min_lines: 200
      exports: ["CaptureComponent"]
    - path: "src/hooks/useSlashCommands.ts"
      provides: "Slash command system hook"
      exports: ["useSlashCommands", "SlashCommand"]
  key_links:
    - from: "src/hooks/useSlashCommands.ts"
      to: "src/hooks/useMarkdownEditor.ts"
      via: "insertText callback"
      pattern: "insertText.*cursor"
    - from: "src/components/notebook/CaptureComponent.tsx"
      to: "slash command menu"
      via: "keystroke detection"
      pattern: "onKeyDown.*slash.*menu"
---

<objective>
Implement a Notion-style slash command system that allows users to insert Isometry DSL patterns and common templates directly into the markdown editor.

Purpose: Enable rapid content creation by providing contextual shortcuts for Isometry-specific patterns (PAFV projections, LATCH filters, etc.) and common notebook structures.
Output: Working slash command system integrated with the existing markdown editor.
</objective>

<execution_context>
@/Users/mshaler/.claude/get-shit-done/workflows/execute-plan.md
@/Users/mshaler/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/REQUIREMENTS.md
@src/components/notebook/CaptureComponent.tsx
@src/hooks/useMarkdownEditor.ts
@src/contexts/NotebookContext.tsx
</context>

<tasks>

<task type="auto">
  <name>Create slash command system hook</name>
  <files>src/hooks/useSlashCommands.ts</files>
  <action>
    Create a custom hook that manages slash command detection and menu rendering:

    ```typescript
    interface SlashCommand {
      id: string;
      label: string;
      description: string;
      category: 'isometry' | 'template' | 'format';
      content: string;
      cursorOffset?: number; // Where to place cursor after insert
    }

    const ISOMETRY_COMMANDS: SlashCommand[] = [
      {
        id: 'pafv-query',
        label: 'PAFV Query',
        description: 'Insert PAFV projection pattern',
        category: 'isometry',
        content: '```sql\n-- PAFV Query\nSELECT * FROM nodes\nWHERE plane = "?" AND axis = "?" \nORDER BY facet;\n```',
        cursorOffset: 45
      },
      {
        id: 'latch-filter',
        label: 'LATCH Filter',
        description: 'Insert LATCH filter template',
        category: 'isometry',
        content: '## Filter Criteria\n- **Location:** ?\n- **Alphabet:** ?\n- **Time:** ?\n- **Category:** ?\n- **Hierarchy:** ?',
        cursorOffset: 35
      }
    ];
    ```

    Implement command detection on '/' keypress, fuzzy matching, and text insertion with cursor positioning.
  </action>
  <verify>Hook exports useSlashCommands with trigger detection and command execution</verify>
  <done>Slash command hook provides command menu data and insertion functionality</done>
</task>

<task type="auto">
  <name>Integrate slash commands into CaptureComponent</name>
  <files>src/components/notebook/CaptureComponent.tsx</files>
  <action>
    Enhance the existing CaptureComponent to integrate slash command functionality:

    1. Add slash command detection to the MDEditor component
    2. Create a floating command menu that appears on '/' trigger
    3. Position menu relative to cursor position
    4. Handle command selection and text insertion
    5. Style menu to match existing theme system

    Key integration points:
    - Use onKeyDown prop of MDEditor to detect '/' key
    - Calculate cursor position for menu placement
    - Call useSlashCommands hook for command data
    - Integrate with existing useMarkdownEditor for text insertion
    - Apply consistent styling with theme context

    The menu should appear as a floating panel with keyboard navigation support.
  </action>
  <verify>Typing '/' in markdown editor shows command menu with Isometry DSL options</verify>
  <done>Slash commands work seamlessly with existing markdown editor and auto-save</done>
</task>

</tasks>

<verification>
- Type '/' in the markdown editor
- Verify command menu appears with PAFV and LATCH options
- Select a command and verify it inserts the correct template
- Confirm cursor positioning works correctly after insertion
- Test that commands integrate with auto-save functionality
</verification>

<success_criteria>
- User can trigger slash command menu by typing '/'
- Menu shows relevant Isometry DSL patterns and templates
- Command insertion works with proper cursor placement
- Integration preserves existing editor functionality
- Visual styling matches existing theme system
</success_criteria>

<output>
After completion, create `.planning/phases/02-capture-implementation/02-01-SUMMARY.md`
</output>