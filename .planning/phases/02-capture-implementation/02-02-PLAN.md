---
phase: 02-capture-implementation
plan: 02
type: execute
wave: 1
depends_on: []
files_modified: [
  "src/components/notebook/CaptureComponent.tsx",
  "src/components/notebook/PropertyEditor.tsx",
  "src/types/notebook.ts"
]
autonomous: true

must_haves:
  truths:
    - "User can edit card properties through collapsible panel"
    - "User can add text, date, tag, and reference property types"
    - "User can save property changes that persist in database"
  artifacts:
    - path: "src/components/notebook/PropertyEditor.tsx"
      provides: "Editable property panel component"
      min_lines: 150
      exports: ["PropertyEditor", "PropertyField"]
    - path: "src/components/notebook/CaptureComponent.tsx"
      provides: "Enhanced CaptureComponent with editable properties"
      min_lines: 250
      exports: ["CaptureComponent"]
    - path: "src/types/notebook.ts"
      provides: "Enhanced property type definitions"
      contains: "PropertyType"
  key_links:
    - from: "src/components/notebook/PropertyEditor.tsx"
      to: "useNotebook"
      via: "updateCard calls"
      pattern: "updateCard.*properties"
    - from: "src/components/notebook/CaptureComponent.tsx"
      to: "PropertyEditor"
      via: "component integration"
      pattern: "PropertyEditor.*activeCard"
---

<objective>
Transform the read-only properties panel into a fully editable property management system that supports multiple property types and integrates with the Isometry data model.

Purpose: Enable users to add rich metadata to their notebook cards that can be queried and filtered alongside the existing Isometry node system.
Output: Editable properties panel with support for text, date, tag, and reference property types.
</objective>

<execution_context>
@/Users/mshaler/.claude/get-shit-done/workflows/execute-plan.md
@/Users/mshaler/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/REQUIREMENTS.md
@src/components/notebook/CaptureComponent.tsx
@src/contexts/NotebookContext.tsx
@src/types/notebook.ts
</context>

<tasks>

<task type="auto">
  <name>Enhance notebook property type definitions</name>
  <files>src/types/notebook.ts</files>
  <action>
    Extend the existing notebook types to support comprehensive property management:

    ```typescript
    export type PropertyType = 'text' | 'date' | 'tag' | 'reference' | 'number' | 'boolean';

    export interface PropertyDefinition {
      id: string;
      name: string;
      type: PropertyType;
      required?: boolean;
      defaultValue?: unknown;
      options?: string[]; // For tag/select properties
    }

    export interface PropertyValue {
      definitionId: string;
      value: unknown;
      type: PropertyType;
    }

    export interface PropertyField {
      id: string;
      name: string;
      value: unknown;
      type: PropertyType;
      required: boolean;
    }
    ```

    Also add utility functions for property validation and serialization that work with the existing NotebookCard.properties JSON field.
  </action>
  <verify>Types compile and export PropertyType, PropertyDefinition, PropertyValue interfaces</verify>
  <done>Enhanced property types support multiple field types with validation</done>
</task>

<task type="auto">
  <name>Create PropertyEditor component</name>
  <files>src/components/notebook/PropertyEditor.tsx</files>
  <action>
    Create a comprehensive property editor component that replaces the read-only properties section:

    Key features:
    1. **Field Types**: Text input, date picker, tag selector, reference autocomplete
    2. **Dynamic Fields**: Add/remove custom properties
    3. **Validation**: Required field validation and type checking
    4. **Auto-save**: Debounced saving on value changes
    5. **Theme Integration**: Consistent styling with existing NeXTSTEP/Modern themes

    Component structure:
    ```typescript
    interface PropertyEditorProps {
      card: NotebookCard;
      onUpdate: (properties: Record<string, unknown>) => void;
      theme: 'NeXTSTEP' | 'Modern';
    }
    ```

    Include built-in property definitions for common Isometry patterns:
    - **Tags**: Multi-select tags for categorization
    - **Priority**: Select field (High/Medium/Low)
    - **Status**: Select field (Draft/Review/Complete)
    - **Related Nodes**: Reference picker from existing nodes
    - **Due Date**: Date picker for task management

    Render different input components based on PropertyType.
  </action>
  <verify>Component renders with different property field types and accepts user input</verify>
  <done>PropertyEditor provides full CRUD operations for card metadata</done>
</task>

<task type="auto">
  <name>Integrate PropertyEditor into CaptureComponent</name>
  <files>src/components/notebook/CaptureComponent.tsx</files>
  <action>
    Replace the existing read-only properties panel with the new PropertyEditor component:

    1. **Component Integration**:
       - Remove existing read-only property display code
       - Import and render PropertyEditor in the collapsible properties section
       - Pass activeCard and update handlers correctly

    2. **State Management**:
       - Connect PropertyEditor onUpdate to NotebookContext updateCard
       - Handle property changes with debouncing to avoid excessive saves
       - Show saving indicators during property updates

    3. **UI/UX Enhancements**:
       - Maintain existing collapsible behavior
       - Add "Add Property" button for custom fields
       - Show property count in the panel header
       - Preserve theme styling consistency

    4. **Error Handling**:
       - Display validation errors inline
       - Handle save failures gracefully
       - Show success feedback for updates

    The integration should feel seamless with the existing editor workflow.
  </action>
  <verify>Properties panel shows editable fields and saves changes to database</verify>
  <done>CaptureComponent has fully functional editable properties integrated</done>
</task>

</tasks>

<verification>
- Open a notebook card in the CaptureComponent
- Expand the properties panel
- Add/edit different property types (text, date, tag)
- Verify changes save to database and persist
- Test required field validation
- Confirm theme styling matches existing components
</verification>

<success_criteria>
- Properties panel transforms from read-only to fully editable
- Users can add, edit, and delete custom properties
- Multiple property types (text, date, tag, reference) work correctly
- Changes auto-save and persist across sessions
- Property validation prevents invalid data
- UI maintains consistent theme styling
</success_criteria>

<output>
After completion, create `.planning/phases/02-capture-implementation/02-02-SUMMARY.md`
</output>