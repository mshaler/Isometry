---
phase: 02-capture-implementation
plan: 03
type: execute
wave: 2
depends_on: ["02-01", "02-02"]
files_modified: [
  "src/components/notebook/TemplateManager.tsx",
  "src/contexts/NotebookContext.tsx",
  "src/types/notebook.ts"
]
autonomous: true

must_haves:
  truths:
    - "User can create new cards from predefined templates"
    - "User can save custom templates and reuse them"
    - "User can access template gallery from new card creation"
  artifacts:
    - path: "src/components/notebook/TemplateManager.tsx"
      provides: "Template gallery and management component"
      min_lines: 120
      exports: ["TemplateManager", "TemplateCard"]
    - path: "src/contexts/NotebookContext.tsx"
      provides: "Enhanced NotebookContext with template management"
      contains: "createTemplate"
    - path: "src/types/notebook.ts"
      provides: "Enhanced template type definitions"
      contains: "NotebookTemplate"
  key_links:
    - from: "src/components/notebook/TemplateManager.tsx"
      to: "NotebookContext"
      via: "createCard with template"
      pattern: "createCard.*template"
    - from: "src/contexts/NotebookContext.tsx"
      to: "template storage"
      via: "localStorage templates"
      pattern: "localStorage.*templates"
---

<objective>
Implement a comprehensive template system that allows users to create cards from predefined templates and save their own custom templates for reuse, completing the capture implementation.

Purpose: Accelerate content creation by providing reusable templates for common card types (meeting notes, code snippets, project plans) and enabling users to create their own patterns.
Output: Template gallery, template management, and template-based card creation integrated with the notebook system.
</objective>

<execution_context>
@/Users/mshaler/.claude/get-shit-done/workflows/execute-plan.md
@/Users/mshaler/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/REQUIREMENTS.md
@src/contexts/NotebookContext.tsx
@src/types/notebook.ts
@src/components/notebook/CaptureComponent.tsx
</context>

<tasks>

<task type="auto">
  <name>Enhance NotebookTemplate type definitions</name>
  <files>src/types/notebook.ts</files>
  <action>
    Extend the existing NotebookTemplate interface to support comprehensive template management:

    ```typescript
    export interface NotebookTemplate {
      id: string;
      name: string;
      description: string;
      category: 'built-in' | 'custom';
      cardType: NotebookCardType;
      markdownContent: string;
      properties: Record<string, unknown>;
      previewImage?: string; // Base64 or URL
      tags: string[];
      createdAt: string;
      modifiedAt: string;
      usageCount?: number;
    }

    export const BUILT_IN_TEMPLATES: NotebookTemplate[] = [
      {
        id: 'meeting-notes',
        name: 'Meeting Notes',
        description: 'Structured template for meeting documentation',
        category: 'built-in',
        cardType: 'meeting',
        markdownContent: `# Meeting: [Title]

**Date:** ${new Date().toLocaleDateString()}
**Attendees:**
**Duration:**

## Agenda
- [ ]
- [ ]
- [ ]

## Discussion Notes


## Action Items
- [ ] **[Name]** -
- [ ] **[Name]** -

## Next Steps

`,
        properties: {
          status: 'draft',
          priority: 'medium',
          type: 'meeting'
        },
        tags: ['meeting', 'structured'],
        createdAt: new Date().toISOString(),
        modifiedAt: new Date().toISOString()
      }
    ];
    ```

    Include built-in templates for common use cases like meeting notes, code snippets, project plans, daily standup, and retrospectives.
  </action>
  <verify>Enhanced NotebookTemplate interface and BUILT_IN_TEMPLATES array exist</verify>
  <done>Template types support comprehensive metadata and built-in template library</done>
</task>

<task type="auto">
  <name>Add template management to NotebookContext</name>
  <files>src/contexts/NotebookContext.tsx</files>
  <action>
    Enhance the NotebookContext to support template creation, storage, and management:

    1. **Template State Management**:
       - Add templates state and loading logic
       - Merge built-in templates with custom templates from localStorage
       - Handle template CRUD operations

    2. **Template Methods**:
       ```typescript
       createTemplate: (name: string, description: string, fromCard: NotebookCard) => Promise<NotebookTemplate>;
       deleteTemplate: (templateId: string) => Promise<void>;
       updateTemplate: (templateId: string, updates: Partial<NotebookTemplate>) => Promise<void>;
       duplicateTemplate: (templateId: string, newName: string) => Promise<NotebookTemplate>;
       ```

    3. **Enhanced Card Creation**:
       - Update createCard to accept template parameter
       - Apply template content and properties when creating from template
       - Increment template usage count

    4. **Template Persistence**:
       - Store custom templates in localStorage with key "isometry-notebook-templates"
       - Handle template import/export for backup
       - Validate template structure on load

    The templates should initialize automatically and be available immediately in the context.
  </action>
  <verify>NotebookContext exports template management methods and loads built-in templates</verify>
  <done>Template management is fully integrated into NotebookContext with persistence</done>
</task>

<task type="auto">
  <name>Create TemplateManager component</name>
  <files>src/components/notebook/TemplateManager.tsx</files>
  <action>
    Create a comprehensive template management component that provides template gallery and creation interface:

    Component features:
    1. **Template Gallery**:
       - Grid layout showing template previews
       - Category filtering (built-in, custom, by tags)
       - Search functionality for template names and descriptions
       - Usage statistics display

    2. **Template Creation**:
       - "Create Template from Current Card" button
       - Template name and description input fields
       - Tag management for custom categorization
       - Preview generation from current content

    3. **Template Actions**:
       - "Use Template" creates new card from template
       - Edit template (for custom templates only)
       - Delete template (for custom templates only)
       - Duplicate template functionality

    4. **Integration Points**:
       - Modal/drawer UI that can be triggered from main interface
       - Integration with NotebookContext template methods
       - Consistent theme styling (NeXTSTEP/Modern)
       - Responsive design for different screen sizes

    Component structure:
    ```typescript
    interface TemplateManagerProps {
      isOpen: boolean;
      onClose: () => void;
      onCreateFromTemplate: (templateId: string) => void;
      currentCard?: NotebookCard | null;
    }
    ```

    Include keyboard shortcuts for quick template access and creation.
  </action>
  <verify>TemplateManager renders with template gallery and creation interface</verify>
  <done>Template management UI provides full template lifecycle management</done>
</task>

</tasks>

<verification>
- Open the TemplateManager component
- Browse built-in templates in the gallery
- Create a new card from a template
- Save current card as a custom template
- Verify templates persist across browser sessions
- Test template search and filtering
- Confirm template usage updates statistics
</verification>

<success_criteria>
- Template gallery shows built-in and custom templates
- Users can create new cards from any template
- Users can save current cards as reusable templates
- Template management includes full CRUD operations
- Templates persist in localStorage between sessions
- Template system integrates seamlessly with card creation workflow
</success_criteria>

<output>
After completion, create `.planning/phases/02-capture-implementation/02-03-SUMMARY.md`
</output>