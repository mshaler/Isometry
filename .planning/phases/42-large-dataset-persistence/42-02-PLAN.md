---
phase: 42-large-dataset-persistence
plan: 02
type: execute
wave: 2
depends_on: [42-01]
files_modified:
  - src/components/UnifiedApp.tsx
  - src/components/Canvas.tsx
  - src/components/Navigator.tsx
autonomous: true

must_haves:
  truths:
    - "UnifiedApp renders SuperGrid with alto-index data via ViewEngine"
    - "PAFV axis switching works with real calendar/contacts/notes data"
    - "User can switch between Grid, List, Kanban views with alto-index data"
  artifacts:
    - path: "src/components/Canvas.tsx"
      provides: "ViewEngine rendering with alto-index node types"
      contains: "IsometryViewEngine"
    - path: "src/components/UnifiedApp.tsx"
      provides: "Main app container with data loading indicator"
      contains: "Canvas"
  key_links:
    - from: "src/components/Canvas.tsx"
      to: "src/engine/IsometryViewEngine.ts"
      via: "ViewEngine render call"
      pattern: "engineRef.current.render"
    - from: "src/components/Canvas.tsx"
      to: "src/hooks/database/useLiveQuery.ts"
      via: "Live query for node data"
      pattern: "useLiveQuery.*nodes"
---

<objective>
Verify and enhance UnifiedApp SuperGrid integration with alto-index data, ensuring PAFV axis switching works with real calendar/contacts/notes data types.

Purpose: Alto-index data contains 17K+ nodes of different types (calendar events, contacts, notes, bookmarks). This plan ensures ViewEngine handles this diversity and PAFV axis switching reflects real data characteristics.

Output: UnifiedApp displays alto-index data correctly with working view transitions and axis switching.
</objective>

<execution_context>
@/Users/mshaler/.claude/get-shit-done/workflows/execute-plan.md
@/Users/mshaler/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/41-pafv-architectural-unification/41-04-SUMMARY.md
@src/components/Canvas.tsx
@src/components/UnifiedApp.tsx
@src/engine/IsometryViewEngine.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Enhance Canvas to display alto-index node type distribution</name>
  <files>
    - src/components/Canvas.tsx
  </files>
  <action>
    1. Add node type counting to Canvas for alto-index data visibility:
       - After useLiveQuery, add memo for node type statistics:
         ```typescript
         const nodeStats = useMemo(() => {
           if (!nodes || nodes.length === 0) return null;

           const byType: Record<string, number> = {};
           nodes.forEach(node => {
             const nodeType = node.node_type || 'unknown';
             byType[nodeType] = (byType[nodeType] || 0) + 1;
           });

           return {
             total: nodes.length,
             byType,
             types: Object.keys(byType).length
           };
         }, [nodes]);
         ```

    2. Add data loading indicator in Canvas:
       - Before ViewEngine render, check for data:
         ```typescript
         if (!nodes || nodes.length === 0) {
           return (
             <div className="flex-1 flex flex-col items-center justify-center bg-gray-50">
               <div className="text-gray-500 text-center">
                 <div className="text-lg font-medium mb-2">No data loaded</div>
                 <div className="text-sm">Import alto-index or add nodes to get started</div>
               </div>
             </div>
           );
         }
         ```

    3. Update development overlay to show alto-index stats:
       - In the development info section, display node type breakdown:
         ```typescript
         {process.env.NODE_ENV === 'development' && nodeStats && (
           <div className="absolute top-2 right-2 bg-black/75 text-white text-xs p-2 rounded">
             <div>Nodes: {nodeStats.total.toLocaleString()}</div>
             <div>Types: {Object.entries(nodeStats.byType).map(
               ([type, count]) => `${type}: ${count}`
             ).join(', ')}</div>
           </div>
         )}
         ```

    Why: Alto-index contains mixed node types (calendar, contact, note, bookmark). Visibility of type distribution confirms data is loaded correctly.
  </action>
  <verify>
    - `npm run typecheck` passes
    - Canvas shows node count and type distribution in dev mode
    - Empty state displays when no data loaded
  </verify>
  <done>
    Canvas displays alto-index node statistics and handles empty state gracefully.
  </done>
</task>

<task type="auto">
  <name>Task 2: Verify ViewEngine rendering with alto-index data types</name>
  <files>
    - src/engine/IsometryViewEngine.ts (read-only verification)
    - src/components/Canvas.tsx
  </files>
  <action>
    1. Verify ViewEngine handles node_type correctly:
       - Read IsometryViewEngine.ts to confirm node rendering uses node_type
       - Check GridRenderer, ListRenderer, KanbanRenderer for node_type awareness

    2. Enhance ViewConfig to utilize alto-index metadata:
       - In createViewConfig, add node type color mapping:
         ```typescript
         styling: {
           ...DEFAULT_VIEW_CONFIG.styling,
           colorScheme: theme === 'NeXTSTEP' ? 'light' : 'light',
           // Color map for alto-index node types
           nodeColors: {
             calendar: '#f59e0b', // amber for events
             contact: '#10b981',  // emerald for contacts
             note: '#3b82f6',     // blue for notes
             bookmark: '#8b5cf6', // violet for bookmarks
             default: '#6b7280'   // gray for unknown
           }
         }
         ```

    3. Log render timing for performance baseline:
       - Already implemented in Canvas useEffect
       - Confirm logs show render time for alto-index scale:
         ```typescript
         devLogger.debug('Canvas ViewEngine render complete', {
           viewType,
           nodeCount: nodes.length,
           renderTime: `${renderTime.toFixed(2)}ms`,
           nodeTypes: Object.keys(nodeStats?.byType || {})
         });
         ```

    4. Test view transitions with alto-index data:
       - Verify Grid -> List -> Kanban transitions work
       - Check that FLIP animations complete without freezing
       - Confirm selection state preserves across transitions

    Why: Alto-index data has diverse node types that require proper rendering. View transitions must remain smooth at 15K+ scale.
  </action>
  <verify>
    - ViewEngine renders all alto-index node types
    - View transitions (Grid/List/Kanban) work with alto-index data
    - Console shows render times under 50ms per success criteria
    - No visual artifacts or freezing during transitions
  </verify>
  <done>
    ViewEngine successfully renders alto-index data with proper node type handling and smooth view transitions.
  </done>
</task>

<task type="auto">
  <name>Task 3: Verify PAFV axis switching with real data</name>
  <files>
    - src/components/Navigator.tsx (read-only verification)
    - src/state/PAFVContext.tsx (read-only verification)
  </files>
  <action>
    1. Verify Navigator LATCH axis controls work:
       - Open UnifiedApp with alto-index data loaded
       - Check Navigator displays LATCH dimension controls
       - Verify axis assignment UI is visible and functional

    2. Test LATCH filtering on alto-index data:
       - **Location**: Filter by location_name if present in alto data
       - **Alphabet**: Sort by name (A-Z grouping)
       - **Time**: Filter by created_at, modified_at, or event dates
       - **Category**: Filter by folder, tags, or status
       - **Hierarchy**: Filter by priority or parent relationships

    3. Test axis-to-plane mappings:
       - Assign Time to X-axis, Category to Y-axis
       - Verify grid reorganizes with real date/category groupings
       - Check that alto-index calendar events group by date
       - Check that contacts/notes group by folder or tags

    4. Document any missing LATCH dimensions in alto-index:
       - Some fields may be null in imported data
       - Log which LATCH dimensions have data coverage:
         ```typescript
         // In Canvas or diagnostic component
         const latchCoverage = useMemo(() => ({
           location: nodes.filter(n => n.location_name).length,
           time: nodes.filter(n => n.created_at || n.event_start).length,
           category: nodes.filter(n => n.folder || n.tags).length,
           hierarchy: nodes.filter(n => n.priority !== null).length
         }), [nodes]);
         ```

    Why: PAFV axis switching is core to SuperGrid. Real data validates the axis mapping actually produces useful groupings.
  </action>
  <verify>
    - Navigator LATCH controls are visible and interactive
    - Axis switching produces visible grid reorganization
    - Alto-index data groups correctly by Time (events), Category (folders), Hierarchy (priority)
    - Console logs show LATCH dimension coverage for alto-index
  </verify>
  <done>
    PAFV axis switching works with alto-index data, producing meaningful groupings based on real calendar/contacts/notes metadata.
  </done>
</task>

</tasks>

<verification>
Run these commands to verify plan completion:

```bash
# TypeScript compilation
npm run typecheck

# Lint check
npm run lint -- src/components/Canvas.tsx src/components/UnifiedApp.tsx
```

Manual verification:
1. Start dev server: `npm run dev`
2. Verify alto-index data loads (15K+ nodes displayed)
3. Switch between Grid/List/Kanban views
4. Test PAFV axis switching (Time, Category, Hierarchy)
5. Check render times in console (<50ms target)
</verification>

<success_criteria>
1. Canvas displays alto-index node type distribution in dev mode
2. ViewEngine renders all node types (calendar, contact, note, bookmark)
3. View transitions (Grid/List/Kanban) work smoothly with 15K+ nodes
4. PAFV axis switching produces meaningful data groupings
5. Render times stay under 50ms for view operations
6. No freezing or visual artifacts during transitions
</success_criteria>

<output>
After completion, create `.planning/phases/42-large-dataset-persistence/42-02-SUMMARY.md`
</output>
