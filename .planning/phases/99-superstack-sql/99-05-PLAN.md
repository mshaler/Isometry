---
phase: 99-superstack-sql
plan: 05
type: execute
wave: 3
depends_on: ["99-04"]
files_modified:
  - src/superstack/demos/SuperStackDemo.tsx
  - src/superstack/index.ts
autonomous: false

must_haves:
  truths:
    - "SuperStackDemo renders live data using useSuperStackData hook"
    - "Collapse/expand interactions functional with tree recalculation"
    - "Click-to-filter logs path and count to console"
  artifacts:
    - path: "src/superstack/demos/SuperStackDemo.tsx"
      provides: "Demo component showing SuperStack with live SQL data"
      contains: "useSuperStackData"
  key_links:
    - from: "src/superstack/demos/SuperStackDemo.tsx"
      to: "useSuperStackData"
      via: "import from ../hooks/useSuperStackData"
      pattern: "useSuperStackData"
    - from: "src/superstack/demos/SuperStackDemo.tsx"
      to: "SuperStackRenderer"
      via: "import from ../renderers/superstack-renderer"
      pattern: "SuperStackRenderer"
---

<objective>
Create demo component showing SuperStack with live SQL data.

Purpose: Demonstrate the complete SuperStack SQL integration by rendering live data from the cards table with folder+tags rows and year+month columns. Shows collapse/expand interactions and click-to-filter logging.

Output: `src/superstack/demos/SuperStackDemo.tsx` with working demo component.
</objective>

<execution_context>
@/Users/mshaler/.claude/get-shit-done/workflows/execute-plan.md
@/Users/mshaler/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/99-superstack-sql/99-RESEARCH.md

# Hook (created in 99-04)
@src/superstack/hooks/useSuperStackData.ts

# Existing renderer and config
@src/superstack/renderers/superstack-renderer.ts
@src/superstack/config/superstack-defaults.ts
@src/superstack/builders/header-tree-builder.ts

# Reference specification
@superstack-phase2-sql-integration.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create SuperStackDemo component</name>
  <files>src/superstack/demos/SuperStackDemo.tsx</files>
  <action>
Create src/superstack/demos/SuperStackDemo.tsx with:

1. **Imports:**
   - React, useRef, useEffect, useState from 'react'
   - useSuperStackData from '../hooks/useSuperStackData'
   - SuperStackRenderer from '../renderers/superstack-renderer'
   - COMMON_FACETS, DEFAULT_DIMENSIONS from '../config/superstack-defaults'
   - recalculateTree from '../builders/header-tree-builder'
   - HeaderNode type from '../types/superstack'
   - '../styles/superstack.css' for styling

2. **Component Structure:**
   - containerRef for D3 rendering container
   - rendererRef to hold SuperStackRenderer instance
   - selectedId state for selection tracking

3. **useSuperStackData call:**
   - rowFacets: [COMMON_FACETS.folder, COMMON_FACETS.tags]
   - colFacets: [COMMON_FACETS.year, COMMON_FACETS.month]
   - filters: [{ facetId: 'status', operator: 'neq', value: 'archived' }]

4. **Renderer setup useEffect:**
   - Initialize SuperStackRenderer on mount
   - Set callbacks: onHeaderClick, onHeaderCollapse
   - Cleanup on unmount

5. **Render useEffect:**
   - Re-render when rowTree or colTree changes

6. **Interaction handlers:**
   - handleHeaderClick: log value, path, count to console, update selection
   - handleHeaderCollapse: toggle node.collapsed, call recalculateTree, re-render

7. **JSX:**
   - Header with "SuperStack Demo" title
   - Stats bar: loading state, error display, query time, row/col counts, refresh button
   - Container div with ref for D3 rendering (min-height 400px)
   - Selection display showing selected header ID
  </action>
  <verify>
```bash
cd /Users/mshaler/Developer/Projects/Isometry && npm run typecheck 2>&1 | head -20
```
TypeScript compiles without errors.
  </verify>
  <done>
- SuperStackDemo component uses useSuperStackData hook
- Renders stats bar with query time and counts
- Has container for SuperStackRenderer
- Includes refresh button
  </done>
</task>

<task type="auto">
  <name>Task 2: Update index.ts exports</name>
  <files>src/superstack/index.ts</files>
  <action>
Update src/superstack/index.ts to export the demo component.

Add after the hooks exports:

```typescript
// Demo Components (NEW in Phase 99)
export { SuperStackDemo } from './demos/SuperStackDemo';
```

Also ensure styles import is present for side effects:
```typescript
// Styles (import for side effects)
import './styles/superstack.css';
```
  </action>
  <verify>
```bash
cd /Users/mshaler/Developer/Projects/Isometry && npm run typecheck 2>&1 | head -20
```
TypeScript compiles and SuperStackDemo is exported.
  </verify>
  <done>
- Index exports SuperStackDemo component
- Styles imported for side effects
- No TypeScript errors
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
SuperStack SQL Integration complete:
- SQL query builders for header discovery
- Query utilities for facet chain creation
- Integration tests against real sql.js
- React hook for data fetching
- Demo component with live data rendering
  </what-built>
  <how-to-verify>
1. Start dev server: `npm run dev`
2. Navigate to a page that imports SuperStackDemo (or temporarily add it to a visible route)
3. Verify:
   - Headers render with folder/tags rows and year/month columns
   - Loading state shows briefly, then data appears
   - Query time is displayed (should be <100ms)
   - Click a header - check console for path and count log
   - Click collapse arrow - verify children hide and header collapses
   - Click Refresh button - data should reload
4. Check browser console for any errors
  </how-to-verify>
  <resume-signal>Type "approved" if demo works correctly, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
1. `npm run typecheck` passes
2. Demo component exists at src/superstack/demos/SuperStackDemo.tsx
3. Demo renders live data from sql.js
4. Collapse/expand interactions work
5. Click-to-filter logs to console
</verification>

<success_criteria>
- DEMO-01: SuperStackDemo renders live data using useSuperStackData hook
- DEMO-02: Collapse/expand interactions functional with tree recalculation
- DEMO-03: Click-to-filter logs path and count to console
</success_criteria>

<output>
After completion, create `.planning/phases/99-superstack-sql/99-05-SUMMARY.md`
</output>
