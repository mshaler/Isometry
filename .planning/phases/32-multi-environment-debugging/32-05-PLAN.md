---
phase: 32-multi-environment-debugging
plan: 05
type: execute
wave: 1
depends_on: []
files_modified: [
  "src/components/d3/Canvas.tsx",
  "src/components/chrome/HeaderBar.tsx",
  "src/components/performance/RenderingMetricsPanel.tsx",
  "src/components/settings/NotesIntegrationSettings.tsx",
  "native/Sources/Isometry/Analytics/ProductionAnalytics.swift"
]
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "TypeScript compilation completes without errors"
    - "Swift compilation completes without blocking errors"
    - "React development server starts successfully"
    - "D3 Canvas component renders without type errors"
  artifacts:
    - path: "src/components/d3/Canvas.tsx"
      provides: "Working D3 Canvas with proper TypeScript types"
      min_lines: 200
    - path: "src/components/chrome/HeaderBar.tsx"
      provides: "Functional header bar with theme integration"
      min_lines: 50
    - path: "native/Sources/Isometry/Analytics/ProductionAnalytics.swift"
      provides: "Actor-safe analytics conformance"
      min_lines: 100
  key_links:
    - from: "Canvas.tsx"
      to: "LiveQueryResult"
      via: "proper type usage"
      pattern: "LiveQueryResult.*Node"
    - from: "HeaderBar.tsx"
      to: "ThemeContext"
      via: "theme toggle integration"
      pattern: "toggleTheme.*function"
---

<objective>
Close remaining compilation gaps in TypeScript and Swift environments to achieve stable multi-environment debugging capability

Purpose: Eliminate blocking errors that prevent parallel development across Swift and React environments
Output: Clean compilation in both TypeScript and Swift, functional development environment
</objective>

<execution_context>
@/Users/mshaler/.claude/get-shit-done/workflows/execute-plan.md
@/Users/mshaler/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/32-multi-environment-debugging/32-01-SUMMARY.md
@.planning/phases/32-multi-environment-debugging/32-02-SUMMARY.md
@.planning/phases/32-multi-environment-debugging/32-03-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix critical TypeScript type errors in D3 Canvas</name>
  <files>src/components/d3/Canvas.tsx</files>
  <action>
    Fix the critical type errors in D3 Canvas component:
    1. Remove unused 'renderMode' variable declaration
    2. Fix LiveQueryResult<Node> type usage - remove non-existent 'isLoading' property, use 'loading' if available
    3. Fix LiveQueryOptions - remove 'queryParams' property, use correct option properties
    4. Add null check for nodes array before passing to D3 - use nodes || [] pattern
    5. Add 'color' property to Node type or handle missing property gracefully
    6. Remove unused 'event' and 'd' parameters from D3 event handlers or prefix with underscore
    7. Fix error handling - check if error is Error type before accessing 'message' property
    8. Add null safety for nodes array access throughout component

    Preserve all D3 functionality while ensuring TypeScript compliance. Use defensive coding patterns for optional properties.
  </action>
  <verify>npx tsc --noEmit src/components/d3/Canvas.tsx && echo "Canvas TypeScript errors resolved"</verify>
  <done>D3 Canvas component compiles without TypeScript errors while maintaining functionality</done>
</task>

<task type="auto">
  <name>Task 2: Fix HeaderBar and performance component TypeScript errors</name>
  <files>src/components/chrome/HeaderBar.tsx, src/components/performance/RenderingMetricsPanel.tsx</files>
  <action>
    Fix HeaderBar.tsx:
    1. Remove unused 'Home' import
    2. Fix ThemeContextType - add 'toggleTheme' property or use correct theme context API
    3. Verify theme integration matches existing ThemeContext implementation

    Fix RenderingMetricsPanel.tsx:
    1. Remove unused 'memoryUsageTracker' variable
    2. Fix import of 'OptimizationPlan' - either add to module exports or remove usage
    3. Use existing optimization types from rendering-performance module

    Use existing patterns from working theme and performance components.
  </action>
  <verify>npx tsc --noEmit src/components/chrome/HeaderBar.tsx src/components/performance/RenderingMetricsPanel.tsx && echo "HeaderBar and performance components clean"</verify>
  <done>HeaderBar and RenderingMetricsPanel compile without TypeScript errors</done>
</task>

<task type="auto">
  <name>Task 3: Fix Swift actor isolation warnings</name>
  <files>native/Sources/Isometry/Analytics/ProductionAnalytics.swift</files>
  <action>
    Fix ProductionAnalytics actor isolation warning:
    1. Add @MainActor annotation to the ProductionAnalytics extension that conforms to PrivacyCompliantAnalytics protocol
    2. Alternatively, mark the conformance methods as 'nonisolated' if they don't need main actor isolation
    3. Ensure the conformance follows Swift 6 concurrency safety patterns

    Choose the approach that maintains existing functionality while eliminating the data race warning. Use the simpler 'nonisolated' approach if the methods are already thread-safe.
  </action>
  <verify>cd native && swift build 2>&1 | grep -v "ProductionAnalytics.*PrivacyCompliantAnalytics" && echo "Actor isolation warning resolved"</verify>
  <done>Swift compilation completes without actor isolation warnings in ProductionAnalytics</done>
</task>

</tasks>

<verification>
Multi-environment compilation verification:
1. TypeScript: npx tsc --noEmit (should complete without errors)
2. Swift: cd native && swift build (should build without critical errors)
3. React: npm run dev (should start development server successfully)
4. Components: Key UI components render without type errors
</verification>

<success_criteria>
- TypeScript compilation completes cleanly across all components
- Swift compilation resolves actor isolation warnings
- React development server starts without blocking errors
- D3 Canvas and chrome components function properly
- Development environment supports parallel work across both environments
</success_criteria>

<output>
After completion, create `.planning/phases/32-multi-environment-debugging/32-05-SUMMARY.md`
</output>