---
phase: 32-multi-environment-debugging
plan: 10
type: execute
wave: 2
depends_on: ["32-09"]
files_modified:
  - native/Sources/Isometry/Sync/CloudKitSyncManager.swift
  - native/Sources/Isometry/Views/Sync/ConflictResolutionView.swift
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "Swift compilation completes without ConflictResolution type errors"
    - "ConflictResolutionView uses correct type path for CloudKitSyncManager.ConflictResolution"
    - "Native iOS/macOS project builds successfully"
  artifacts:
    - path: "native/Sources/Isometry/Sync/CloudKitSyncManager.swift"
      provides: "ConflictResolution type definition"
      contains: "public struct ConflictResolution"
    - path: "native/Sources/Isometry/Views/Sync/ConflictResolutionView.swift"
      provides: "Working conflict resolution UI"
      contains: "typealias SyncConflictResolution = CloudKitSyncManager.ConflictResolution"
  key_links:
    - from: "native/Sources/Isometry/Views/Sync/ConflictResolutionView.swift"
      to: "native/Sources/Isometry/Sync/CloudKitSyncManager.swift"
      via: "CloudKitSyncManager.ConflictResolution type reference"
      pattern: "CloudKitSyncManager\\.ConflictResolution"
---

<objective>
Fix Swift compilation regression by adding missing ConflictResolution type to CloudKitSyncManager actor.

Purpose: Resolve the compilation error where ConflictResolutionView.swift references CloudKitSyncManager.ConflictResolution which doesn't exist.
Output: Working Swift compilation with properly defined conflict resolution types.
</objective>

<execution_context>
@/Users/mshaler/.claude/get-shit-done/workflows/execute-plan.md
@/Users/mshaler/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Gap closure context from verification
@.planning/phases/32-multi-environment-debugging/32-VERIFICATION.md

# Referenced files showing the issue
@native/Sources/Isometry/Views/Sync/ConflictResolutionView.swift
</context>

<tasks>

<task type="auto">
  <name>Add ConflictResolution type to CloudKitSyncManager</name>
  <files>native/Sources/Isometry/Sync/CloudKitSyncManager.swift</files>
  <action>
    Add the missing ConflictResolution struct to CloudKitSyncManager actor:

    ```swift
    public struct ConflictResolution {
        public let nodeId: String
        public let resolvedNode: Node
        public let strategy: ConflictResolutionStrategy
        public let resolvedAt: Date

        public init(nodeId: String, resolvedNode: Node, strategy: ConflictResolutionStrategy, resolvedAt: Date) {
            self.nodeId = nodeId
            self.resolvedNode = resolvedNode
            self.strategy = strategy
            self.resolvedAt = resolvedAt
        }
    }
    ```

    Gap reason: ConflictResolutionView.swift line 250 creates ConflictResolution instances but the type is missing from CloudKitSyncManager.

    Place this inside the CloudKitSyncManager actor after the SyncState struct definition.
  </action>
  <verify>grep -n "struct ConflictResolution" native/Sources/Isometry/Sync/CloudKitSyncManager.swift</verify>
  <done>CloudKitSyncManager actor includes public ConflictResolution struct definition</done>
</task>

<task type="auto">
  <name>Verify ConflictResolutionView type usage</name>
  <files>native/Sources/Isometry/Views/Sync/ConflictResolutionView.swift</files>
  <action>
    Verify that ConflictResolutionView.swift correctly uses the CloudKitSyncManager.ConflictResolution type:

    1. Confirm line 7 typealias is correct: `typealias SyncConflictResolution = CloudKitSyncManager.ConflictResolution`
    2. Ensure line 250 usage matches: `let resolution = ConflictResolution(...)`
    3. If there's a mismatch, update line 250 to use the typealias: `SyncConflictResolution`

    Gap reason: The verification report shows a type error where ConflictResolution is not a member type of CloudKitSyncManager.

    Make minimal changes to ensure type consistency.
  </action>
  <verify>swift build -c debug --target Isometry</verify>
  <done>ConflictResolutionView compiles successfully with correct CloudKitSyncManager.ConflictResolution type usage</done>
</task>

</tasks>

<verification>
- [ ] Swift compilation completes without ConflictResolution type errors
- [ ] CloudKitSyncManager.ConflictResolution type exists and is accessible
- [ ] ConflictResolutionView uses the correct type path
- [ ] Native project builds successfully
</verification>

<success_criteria>
- Swift compilation regression for ConflictResolution type is resolved
- ConflictResolutionView properly references CloudKitSyncManager.ConflictResolution
- Native iOS/macOS project builds without blocking type errors
</success_criteria>

<output>
After completion, create `.planning/phases/32-multi-environment-debugging/32-10-SUMMARY.md`
</output>