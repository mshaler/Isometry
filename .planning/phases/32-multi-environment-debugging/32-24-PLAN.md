---
phase: 32-multi-environment-debugging
plan: 24
type: execute
wave: 1
depends_on: []
files_modified: [
  "native/Sources/Isometry/Import/Testing/PropertyBasedTestFramework.swift",
  "native/Sources/Isometry/Models/CommandHistory.swift",
  "native/Package.swift",
  "native/Sources/Isometry/Models/SharedTypes.swift"
]
autonomous: false

must_haves:
  truths:
    - "Swift syntax errors are eliminated (proper @escaping placement)"
    - "Type ambiguity between DateRange and ShellDateRange is resolved"
    - "PropertyTest type is properly defined or imported"
    - "Swift compilation error count is reduced below 1000 (from 13,298)"
  artifacts:
    - path: "native/Sources/Isometry/Import/Testing/PropertyBasedTestFramework.swift"
      provides: "Syntactically correct Swift closures with proper @escaping"
      requires: "@escaping parameter position fix"
    - path: "native/Sources/Isometry/Models/CommandHistory.swift"
      provides: "Type-consistent CommandHistory model"
      requires: "DateRange type disambiguation"
    - path: "native/Sources/Isometry/Models/SharedTypes.swift"
      provides: "Centralized type definitions"
      requires: "PropertyTest type definition"
  key_links:
    - from: "PropertyBasedTestFramework.swift"
      to: "PropertyTest protocol"
      via: "type definition or import"
      pattern: "protocol PropertyTest|import.*PropertyTest"
    - from: "CommandHistory.swift"
      to: "DateRange type resolution"
      via: "consistent type usage"
      pattern: "(Shell)?DateRange\\?"

user_setup:
  - service: swift-xcode
    why: "Massive compilation failure requires Xcode toolchain analysis"
    manual_steps:
      - task: "Open native/Package.swift in Xcode"
        reason: "Review first 20-50 compilation errors for pattern identification"
      - task: "Analyze error clustering by module/file"
        reason: "Determine if errors are localized or systemic dependency issues"
      - task: "Check Swift version compatibility"
        reason: "13,298 errors suggest possible toolchain version mismatch"
---

<objective>
Triage and address the critical Swift compilation crisis with 13,298 errors by fixing fundamental syntax issues and type conflicts.

Purpose: Restore basic Swift compilation capability to enable parallel development with TypeScript environment. This is emergency triage, not comprehensive fixes.
Output: Swift compilation errors reduced to manageable levels (<1000) with basic syntax issues resolved.
</objective>

<execution_context>
@/Users/mshaler/.claude/get-shit-done/workflows/execute-plan.md
@/Users/mshaler/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Gap closure context from verification
@.planning/phases/32-multi-environment-debugging/32-VERIFICATION.md

# Recent Swift fixes for pattern reference
@.planning/phases/32-multi-environment-debugging/32-22-SUMMARY.md

# Isometry project context
@/Users/mshaler/Developer/Projects/Isometry/CLAUDE.md
</context>

<tasks>

<task type="auto">
  <name>Fix critical Swift syntax errors in PropertyBasedTestFramework</name>
  <files>native/Sources/Isometry/Import/Testing/PropertyBasedTestFramework.swift</files>
  <action>
    Fix fundamental Swift syntax issues identified in verification:

    1. Fix @escaping parameter position error at line 593:
       - Move @escaping to correct position before parameter type
       - Pattern: `parameter: @escaping (Type) -> Void` not `@escaping parameter: (Type) -> Void`

    2. Define missing PropertyTest type or add proper import:
       - Check if PropertyTest should be a protocol, struct, or typealias
       - If not defined, create basic protocol definition
       - If it exists in another module, add proper import

    Reference 32-22 pattern for Swift 6 compliance and proper closure capture syntax.

    Per verification: "@escaping in wrong position and missing PropertyTest type definition"
  </action>
  <verify>swift build --package-path native 2>&1 | grep -i propertybasedtestframework | wc -l should be < 10</verify>
  <done>PropertyBasedTestFramework.swift compiles without syntax errors</done>
</task>

<task type="auto">
  <name>Resolve DateRange type ambiguity in CommandHistory</name>
  <files>native/Sources/Isometry/Models/CommandHistory.swift</files>
  <files>native/Sources/Isometry/Models/SharedTypes.swift</files>
  <action>
    Fix type ambiguity between DateRange and ShellDateRange:

    1. In CommandHistory.swift at line 570:
       - Change DateRange? to ShellDateRange? consistently
       - Or create type alias: `typealias CommandDateRange = ShellDateRange`

    2. In SharedTypes.swift:
       - Define clear type disambiguation
       - Add module-specific type aliases if needed
       - Ensure consistent usage across CommandHistory module

    Reference 32-22 decision to "Use ShellDateRange instead of DateRange" for type ambiguity resolution.

    Per verification: "DateRange vs ShellDateRange type mismatch - cannot assign DateRange? to ShellDateRange?"
  </action>
  <verify>swift build --package-path native 2>&1 | grep -i "daterange.*shellDateRange\|cannot assign.*DateRange" | wc -l should be 0</verify>
  <done>DateRange type conflicts are resolved with consistent type usage</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Basic Swift syntax fixes for @escaping placement and DateRange type conflicts</what-built>
  <how-to-verify>
    1. Open Terminal and navigate to /Users/mshaler/Developer/Projects/Isometry/
    2. Run: `swift build --package-path native`
    3. Check error count: `swift build --package-path native 2>&1 | grep error | wc -l`
    4. Review first 20 errors for pattern changes:
       - Should see reduction from 13,298 total errors
       - Syntax errors (PropertyBasedTestFramework) should be resolved
       - Type conflicts (DateRange/ShellDateRange) should be reduced
    5. If still massive errors (>5000), provide sample of first 10 error messages
  </how-to-verify>
  <resume-signal>Report error count and pattern changes: "Errors reduced to X (from 13,298). Main remaining patterns: [list]" or "Still massive failure: [sample errors]"</resume-signal>
</task>

</tasks>

<verification>
1. Swift syntax: PropertyBasedTestFramework.swift compiles without @escaping position errors
2. Type consistency: CommandHistory uses consistent DateRange/ShellDateRange typing
3. Compilation improvement: Swift error count reduced significantly from 13,298
4. Basic build capability: `swift build --package-path native` shows progress
5. Human triage feedback: Error patterns identified for next iteration
</verification>

<success_criteria>
- Swift compilation error count reduced below 1000 (emergency triage goal)
- Critical syntax errors (@escaping placement) eliminated
- Type conflicts (DateRange ambiguity) resolved
- Basic Swift development environment restored (not 13,298 error crisis)
- Clear error pattern identification for follow-up work
</success_criteria>

<output>
After completion, create `.planning/phases/32-multi-environment-debugging/32-24-SUMMARY.md`
</output>