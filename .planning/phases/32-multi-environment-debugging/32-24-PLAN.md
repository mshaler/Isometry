---
phase: 32-multi-environment-debugging
plan: 24
type: execute
wave: 1
depends_on: []
files_modified: [
  "native/Sources/Isometry/Import/Testing/PropertyBasedTestFramework.swift",
  "native/Sources/Isometry/Models/CommandHistory.swift",
  "native/Package.swift",
  "native/Sources/Isometry/Models/SharedTypes.swift"
]
autonomous: false

must_haves:
  truths:
    - "Swift syntax errors are eliminated (proper @escaping placement)"
    - "Type ambiguity between DateRange and ShellDateRange is resolved"
    - "PropertyTest type is properly defined or imported"
    - "Swift compilation shows measurable error reduction and specific file fixes"
  artifacts:
    - path: "native/Sources/Isometry/Import/Testing/PropertyBasedTestFramework.swift"
      provides: "Syntactically correct Swift closures with proper @escaping"
      requires: "@escaping parameter position fix"
    - path: "native/Sources/Isometry/Models/CommandHistory.swift"
      provides: "Type-consistent CommandHistory model"
      requires: "DateRange type disambiguation"
    - path: "native/Sources/Isometry/Models/SharedTypes.swift"
      provides: "Centralized type definitions"
      requires: "PropertyTest type definition"
  key_links:
    - from: "PropertyBasedTestFramework.swift"
      to: "PropertyTest protocol"
      via: "type definition or import"
      pattern: "protocol PropertyTest|import.*PropertyTest"
    - from: "CommandHistory.swift"
      to: "DateRange type resolution"
      via: "consistent type usage"
      pattern: "(Shell)?DateRange\\?"

user_setup:
  - service: swift-xcode
    why: "Massive compilation failure requires Xcode toolchain analysis"
    manual_steps:
      - task: "Open native/Package.swift in Xcode"
        reason: "Review first 20-50 compilation errors for pattern identification"
      - task: "Analyze error clustering by module/file"
        reason: "Determine if errors are localized or systemic dependency issues"
      - task: "Check Swift version compatibility"
        reason: "13,298 errors suggest possible toolchain version mismatch"
---

<objective>
Triage and address critical Swift compilation issues by fixing fundamental syntax errors and type conflicts in key files.

Purpose: Achieve measurable Swift compilation improvement through targeted fixes of syntax and type issues. Focus on specific file-level improvements to enable systematic error pattern identification.
Output: Specific files compile cleanly and compilation error patterns are clarified for next iteration.
</objective>

<execution_context>
@/Users/mshaler/.claude/get-shit-done/workflows/execute-plan.md
@/Users/mshaler/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Gap closure context from verification
@.planning/phases/32-multi-environment-debugging/32-VERIFICATION.md

# Recent Swift fixes for pattern reference
@.planning/phases/32-multi-environment-debugging/32-22-SUMMARY.md

# Isometry project context
@/Users/mshaler/Developer/Projects/Isometry/CLAUDE.md
</context>

<tasks>

<task type="auto">
  <name>Fix critical Swift syntax errors in PropertyBasedTestFramework</name>
  <files>native/Sources/Isometry/Import/Testing/PropertyBasedTestFramework.swift</files>
  <action>
    Fix fundamental Swift syntax issues identified in verification:

    1. Fix @escaping parameter position error at line 593:
       - Move @escaping to correct position before parameter type
       - Pattern: `parameter: @escaping (Type) -> Void` not `@escaping parameter: (Type) -> Void`

    2. Define missing PropertyTest type or add proper import:
       - Check if PropertyTest should be a protocol, struct, or typealias
       - If not defined, create basic protocol definition
       - If it exists in another module, add proper import

    Reference 32-22 pattern for Swift 6 compliance and proper closure capture syntax.

    Per verification: "@escaping in wrong position and missing PropertyTest type definition"
  </action>
  <verify>swift build --package-path native 2>&1 | grep -E "PropertyBasedTestFramework.*error" | wc -l; echo "Result should be 0"</verify>
  <done>PropertyBasedTestFramework.swift compiles without syntax errors</done>
</task>

<task type="auto">
  <name>Resolve DateRange type ambiguity in CommandHistory</name>
  <files>native/Sources/Isometry/Models/CommandHistory.swift</files>
  <files>native/Sources/Isometry/Models/SharedTypes.swift</files>
  <action>
    Fix type ambiguity between DateRange and ShellDateRange:

    1. In CommandHistory.swift at line 570:
       - Change DateRange? to ShellDateRange? consistently
       - Or create type alias: `typealias CommandDateRange = ShellDateRange`

    2. In SharedTypes.swift:
       - Define clear type disambiguation
       - Add module-specific type aliases if needed
       - Ensure consistent usage across CommandHistory module

    Reference 32-22 decision to "Use ShellDateRange instead of DateRange" for type ambiguity resolution.

    Per verification: "DateRange vs ShellDateRange type mismatch - cannot assign DateRange? to ShellDateRange?"
  </action>
  <verify>swift build --package-path native 2>&1 | grep -i "daterange.*shellDateRange\|cannot assign.*DateRange" | wc -l should be 0</verify>
  <done>DateRange type conflicts are resolved with consistent type usage</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Targeted Swift syntax fixes for @escaping placement and DateRange type conflicts</what-built>
  <how-to-verify>
    1. Open Terminal and navigate to /Users/mshaler/Developer/Projects/Isometry/
    2. Run: `swift build --package-path native`
    3. Check total error count: `swift build --package-path native 2>&1 | grep error | wc -l`
    4. Verify specific fixes:
       - PropertyBasedTestFramework: `swift build --package-path native 2>&1 | grep PropertyBasedTestFramework`
       - DateRange conflicts: `swift build --package-path native 2>&1 | grep -i daterange`
    5. Note error pattern changes - are remaining errors clustered in specific files/modules?
    6. If errors reduced but still high (>1000), identify top error patterns for systematic addressing
  </how-to-verify>
  <resume-signal>Report: "Specific files fixed: [list]. Total errors: X. Top remaining error patterns: [patterns]" or describe systematic patterns needing broader approach</resume-signal>
</task>

</tasks>

<verification>
1. Swift syntax: PropertyBasedTestFramework.swift compiles without @escaping position errors
2. Type consistency: CommandHistory uses consistent DateRange/ShellDateRange typing
3. Specific file improvements: Targeted fixes show measurable progress on specific files
4. Error pattern clarity: Compilation patterns identified for systematic follow-up
5. Human triage feedback: Clear assessment of remaining error clustering
</verification>

<success_criteria>
- Critical syntax errors (@escaping placement) eliminated in PropertyBasedTestFramework.swift
- Type conflicts (DateRange ambiguity) resolved in CommandHistory module
- Specific targeted files show compilation improvement
- Error patterns clarified for systematic follow-up addressing
- Foundation established for broader Swift compilation recovery
</success_criteria>

<output>
After completion, create `.planning/phases/32-multi-environment-debugging/32-24-SUMMARY.md`
</output>