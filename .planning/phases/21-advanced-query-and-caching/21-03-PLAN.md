---
phase: 21-advanced-query-and-caching
plan: 03
type: execute
wave: 1
depends_on: []
files_modified: ["src/main.tsx", "src/App.tsx"]
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "TanStack Query is operational with QueryClientProvider setup"
    - "Intelligent caching works for live queries"
    - "Cache invalidation functions correctly after mutations"
  artifacts:
    - path: "src/main.tsx"
      provides: "QueryClientProvider wrapper"
      contains: "QueryClientProvider"
    - path: "src/App.tsx"
      provides: "Query client integration"
      imports: "QueryClientProvider"
  key_links:
    - from: "src/main.tsx"
      to: "src/services/queryClient.ts"
      via: "QueryClient import"
      pattern: "import.*queryClient"
    - from: "src/hooks/useLiveQuery.ts"
      to: "QueryClient"
      via: "useQuery hook"
      pattern: "useQuery.*queryClient"
---

<objective>
Set up TanStack Query provider infrastructure to make intelligent caching operational.

Purpose: Enable the existing QueryClient configuration and caching utilities to function by providing the QueryClient to the React app through proper context setup.
Output: Functional TanStack Query caching integrated with the app initialization
</objective>

<execution_context>
@/Users/mshaler/.claude/get-shit-done/workflows/execute-plan.md
@/Users/mshaler/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@.planning/phases/21-advanced-query-and-caching/21-01-SUMMARY.md
@.planning/phases/21-advanced-query-and-caching/21-02-SUMMARY.md
@src/services/queryClient.ts
@src/hooks/useLiveQuery.ts
@src/utils/cacheInvalidation.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Set up QueryClientProvider in app initialization</name>
  <files>src/main.tsx</files>
  <action>
    Add QueryClientProvider wrapper to the React app in main.tsx:

    1. Import QueryClientProvider from @tanstack/react-query
    2. Import the configured queryClient from src/services/queryClient.ts
    3. Wrap the App component with QueryClientProvider, passing the queryClient
    4. Maintain existing React.StrictMode wrapper

    The setup should follow this pattern:
    ```tsx
    import { QueryClientProvider } from '@tanstack/react-query';
    import { queryClient } from './services/queryClient';

    // Wrap App with QueryClientProvider
    <QueryClientProvider client={queryClient}>
      <App />
    </QueryClientProvider>
    ```

    Gap reason: QueryClient is configured but not provided to React app, making all TanStack Query functionality non-operational.
  </action>
  <verify>npm run dev starts successfully and browser console shows no QueryClient errors</verify>
  <done>QueryClientProvider is set up and queryClient is available to all components</done>
</task>

<task type="auto">
  <name>Task 2: Verify TanStack Query integration is operational</name>
  <files>src/components/debug/QueryClientDiagnostic.tsx</files>
  <action>
    Create a diagnostic component to verify QueryClient is working:

    1. Create QueryClientDiagnostic.tsx in src/components/debug/
    2. Use useQueryClient() hook to verify client is accessible
    3. Show cache status, default options, and mutation cache state
    4. Add basic query test with simple static data
    5. Display connection status and cache statistics

    Component should be a simple diagnostic panel that can be temporarily imported in App.tsx to verify the QueryClient setup is functional.

    Gap reason: Need verification that QueryClient setup allows the existing caching infrastructure to function properly.
  </action>
  <verify>Diagnostic component shows QueryClient is accessible and basic queries work</verify>
  <done>TanStack Query infrastructure is verified as operational</done>
</task>

</tasks>

<verification>
- [ ] npm run dev starts without QueryClient errors
- [ ] useQueryClient() hook works in components
- [ ] Basic queries execute successfully
- [ ] Cache invalidation utilities can access QueryClient
- [ ] No TypeScript compilation errors
</verification>

<success_criteria>
- QueryClientProvider successfully provides queryClient to React app
- Existing caching infrastructure becomes operational
- useLiveQuery hooks can utilize TanStack Query features
- Cache invalidation utilities function correctly
- Foundation ready for virtual scrolling and performance utilities integration
</success_criteria>

<output>
After completion, create `.planning/phases/21-advanced-query-and-caching/21-03-SUMMARY.md`
</output>