---
phase: 05-xcode-migration
plan: 02
type: execute
wave: 2
depends_on: [05-01]
files_modified: [
  native/IsometryiOS.xcodeproj/project.pbxproj,
  native/IsometrymacOS.xcodeproj/project.pbxproj
]
autonomous: true

must_haves:
  truths:
    - "GRDB.swift dependency is properly integrated via Swift Package Manager in both projects"
    - "Build settings are configured for iOS 17+ and macOS 14+ deployment"
    - "Projects compile successfully with all dependencies resolved"
  artifacts:
    - path: "native/IsometryiOS.xcodeproj/project.pbxproj"
      provides: "iOS project with Swift Package Manager integration"
      contains: "GRDB"
    - path: "native/IsometrymacOS.xcodeproj/project.pbxproj"
      provides: "macOS project with Swift Package Manager integration"
      contains: "GRDB"
  key_links:
    - from: "IsometryiOS target"
      to: "GRDB package"
      via: "Swift Package Manager"
      pattern: "packageProductDependencies"
    - from: "IsometrymacOS target"
      to: "GRDB package"
      via: "Swift Package Manager"
      pattern: "packageProductDependencies"
---

<objective>
Configure Swift Package Manager dependencies and build settings in both Xcode projects

Purpose: Enable the projects to use GRDB.swift and compile successfully with proper deployment targets
Output: Xcode projects with properly configured dependencies and build settings
</objective>

<execution_context>
@/Users/mshaler/.claude/get-shit-done/workflows/execute-plan.md
@/Users/mshaler/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@/Users/mshaler/Developer/Projects/Isometry/.planning/phases/05-xcode-migration/05-01-SUMMARY.md
@/Users/mshaler/Developer/Projects/Isometry/native/Package.swift
@/Users/mshaler/Developer/Projects/Isometry/native/Package.resolved
</context>

<tasks>

<task type="auto">
  <name>Add Swift Package Manager dependencies to iOS project</name>
  <files>native/IsometryiOS.xcodeproj/project.pbxproj</files>
  <action>
    Configure GRDB.swift dependency in iOS Xcode project:
    1. Open the iOS project and add Swift Package Manager dependency
    2. Add package: https://github.com/groue/GRDB.swift.git
    3. Use "Up to Next Major Version" from 6.24.0 (current working version from Package.resolved)
    4. Add GRDB product to IsometryiOS target
    5. Configure build settings:
       - IPHONEOS_DEPLOYMENT_TARGET = 17.0
       - SWIFT_VERSION = 5.9
       - TARGETED_DEVICE_FAMILY = 1,2 (iPhone and iPad)
    6. Verify the dependency resolves correctly

    Use command-line tools where possible to modify project.pbxproj directly.
  </action>
  <verify>`xcodebuild -project native/IsometryiOS.xcodeproj -scheme IsometryiOS -sdk iphoneos -configuration Debug build` succeeds</verify>
  <done>iOS project compiles successfully with GRDB dependency integrated</done>
</task>

<task type="auto">
  <name>Add Swift Package Manager dependencies to macOS project</name>
  <files>native/IsometrymacOS.xcodeproj/project.pbxproj</files>
  <action>
    Configure GRDB.swift dependency in macOS Xcode project:
    1. Open the macOS project and add Swift Package Manager dependency
    2. Add package: https://github.com/groue/GRDB.swift.git
    3. Use "Up to Next Major Version" from 6.24.0 (current working version from Package.resolved)
    4. Add GRDB product to IsometrymacOS target
    5. Configure build settings:
       - MACOSX_DEPLOYMENT_TARGET = 14.0
       - SWIFT_VERSION = 5.9
       - SDKROOT = macosx
    6. Verify the dependency resolves correctly

    Use command-line tools where possible to modify project.pbxproj directly.
  </action>
  <verify>`xcodebuild -project native/IsometrymacOS.xcodeproj -scheme IsometrymacOS -sdk macosx -configuration Debug build` succeeds</verify>
  <done>macOS project compiles successfully with GRDB dependency integrated</done>
</task>

<task type="auto">
  <name>Verify cross-platform compilation and fix platform-specific code</name>
  <files>Sources/Isometry/**/*.swift</files>
  <action>
    Test compilation on both platforms and resolve any platform-specific issues:
    1. Build iOS project and capture any compilation errors
    2. Build macOS project and capture any compilation errors
    3. Review Swift source files for proper platform conditionals (#if os(iOS) vs #if os(macOS))
    4. Ensure CloudKit imports and usage work on both platforms
    5. Verify SwiftUI code compiles for both iOS and macOS targets
    6. Check that database code (GRDB) works correctly on both platforms
    7. Fix any platform-specific compilation issues found

    Pay special attention to:
    - UIKit vs AppKit differences
    - iOS-specific vs macOS-specific SwiftUI modifiers
    - File system access differences
    - CloudKit behavior differences
  </action>
  <verify>Both `xcodebuild` commands complete without compilation errors</verify>
  <done>Both projects compile successfully with all Swift source files, no platform-specific errors</done>
</task>

</tasks>

<verification>
- GRDB.swift is properly added to both projects via Swift Package Manager
- Both projects build successfully with all dependencies
- Deployment targets are correctly set (iOS 17+, macOS 14+)
- All Swift source files compile without errors on both platforms
</verification>

<success_criteria>
- iOS project builds successfully: `xcodebuild -project native/IsometryiOS.xcodeproj -scheme IsometryiOS -sdk iphoneos -configuration Debug build`
- macOS project builds successfully: `xcodebuild -project native/IsometrymacOS.xcodeproj -scheme IsometrymacOS -sdk macosx -configuration Debug build`
- Package dependencies resolve correctly in both projects
- No platform-specific compilation errors
</success_criteria>

<output>
After completion, create `.planning/phases/05-xcode-migration/05-02-SUMMARY.md`
</output>