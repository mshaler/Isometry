---
phase: 05-xcode-migration
plan: 03
type: execute
wave: 3
depends_on: [05-02]
files_modified: [
  native/IsometryiOS/IsometryiOS/IsometryiOS.entitlements,
  native/IsometrymacOS/IsometrymacOS/IsometrymacOS.entitlements,
  native/IsometryiOS.xcodeproj/project.pbxproj,
  native/IsometrymacOS.xcodeproj/project.pbxproj
]
autonomous: false

must_haves:
  truths:
    - "Code signing is properly configured for both iOS and macOS projects"
    - "CloudKit entitlements are correctly set up for both platforms"
    - "App Sandbox and network entitlements are properly configured"
    - "Signing & Capabilities tabs are accessible in Xcode for both projects"
  artifacts:
    - path: "native/IsometryiOS/IsometryiOS/IsometryiOS.entitlements"
      provides: "iOS entitlements with CloudKit capabilities"
      contains: "com.apple.developer.icloud-container-identifiers"
    - path: "native/IsometrymacOS/IsometrymacOS/IsometrymacOS.entitlements"
      provides: "macOS entitlements with CloudKit and sandbox capabilities"
      contains: "com.apple.security.app-sandbox"
  key_links:
    - from: "IsometryiOS.xcodeproj"
      to: "IsometryiOS.entitlements"
      via: "CODE_SIGN_ENTITLEMENTS build setting"
      pattern: "CODE_SIGN_ENTITLEMENTS"
    - from: "IsometrymacOS.xcodeproj"
      to: "IsometrymacOS.entitlements"
      via: "CODE_SIGN_ENTITLEMENTS build setting"
      pattern: "CODE_SIGN_ENTITLEMENTS"
---

<objective>
Configure code signing, capabilities, and entitlements for both iOS and macOS projects

Purpose: Enable proper code signing for device deployment and App Store submission
Output: Projects with properly configured signing, CloudKit capabilities, and platform-specific entitlements
</objective>

<execution_context>
@/Users/mshaler/.claude/get-shit-done/workflows/execute-plan.md
@/Users/mshaler/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@/Users/mshaler/Developer/Projects/Isometry/.planning/phases/05-xcode-migration/05-02-SUMMARY.md
@/Users/mshaler/Developer/Projects/Isometry/native/IsometryApp/IsometryApp.entitlements
@/Users/mshaler/Developer/Projects/Isometry/native/IsometryApp/Info.plist
</context>

<tasks>

<task type="auto">
  <name>Configure iOS project entitlements and capabilities</name>
  <files>native/IsometryiOS/IsometryiOS/IsometryiOS.entitlements, native/IsometryiOS.xcodeproj/project.pbxproj</files>
  <action>
    Set up iOS-specific entitlements and code signing configuration:
    1. Copy and adapt IsometryApp.entitlements to IsometryiOS.entitlements
    2. Remove macOS-specific entitlements (app-sandbox, file access)
    3. Keep iOS-compatible entitlements:
       - CloudKit container: iCloud.com.mshaler.isometry
       - CloudKit services
       - Background modes: background-app-refresh, background-processing
    4. Configure project build settings:
       - CODE_SIGN_ENTITLEMENTS = IsometryiOS/IsometryiOS.entitlements
       - CODE_SIGN_IDENTITY = "iPhone Developer" (for development)
       - DEVELOPMENT_TEAM = (will be set when connected to Apple Developer account)
    5. Set bundle identifier: com.mshaler.isometry
    6. Configure automatic code signing for development

    Focus on iOS-specific capability requirements, removing macOS sandbox restrictions.
  </action>
  <verify>iOS entitlements file exists with proper CloudKit and background mode capabilities</verify>
  <done>iOS project configured with proper entitlements and code signing settings</done>
</task>

<task type="auto">
  <name>Configure macOS project entitlements and capabilities</name>
  <files>native/IsometrymacOS/IsometrymacOS/IsometrymacOS.entitlements, native/IsometrymacOS.xcodeproj/project.pbxproj</files>
  <action>
    Set up macOS-specific entitlements and code signing configuration:
    1. Copy and adapt IsometryApp.entitlements to IsometrymacOS.entitlements
    2. Keep macOS-specific entitlements:
       - App Sandbox: com.apple.security.app-sandbox = true
       - Network client access: com.apple.security.network.client = true
       - User selected file access: com.apple.security.files.user-selected.read-write = true
       - CloudKit container: iCloud.com.mshaler.isometry
       - CloudKit services
       - Background modes: background-app-refresh, background-processing
    3. Configure project build settings:
       - CODE_SIGN_ENTITLEMENTS = IsometrymacOS/IsometrymacOS.entitlements
       - CODE_SIGN_IDENTITY = "Mac Developer" (for development)
       - DEVELOPMENT_TEAM = (will be set when connected to Apple Developer account)
    4. Set bundle identifier: com.mshaler.isometry
    5. Configure automatic code signing for development

    Preserve macOS app sandbox requirements while enabling necessary CloudKit and file access.
  </action>
  <verify>macOS entitlements file exists with proper sandbox, CloudKit, and file access capabilities</verify>
  <done>macOS project configured with proper entitlements and code signing settings</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>iOS and macOS Xcode projects with code signing and entitlements configured</what-built>
  <how-to-verify>
    1. Open native/IsometryiOS.xcodeproj in Xcode
    2. Select IsometryiOS target → Signing & Capabilities tab
    3. Verify these capabilities are present:
       - iCloud (CloudKit)
       - Background Modes (Background App Refresh, Background processing)
    4. Check that entitlements file path is set correctly

    5. Open native/IsometrymacOS.xcodeproj in Xcode
    6. Select IsometrymacOS target → Signing & Capabilities tab
    7. Verify these capabilities are present:
       - App Sandbox (with Network: Outgoing Connections, File Access: User Selected Files)
       - iCloud (CloudKit)
       - Background Modes (Background App Refresh, Background processing)
    8. Check that entitlements file path is set correctly

    9. Verify both projects show "Signing & Capabilities" tab (this was missing in Swift Package Manager)
    10. Confirm bundle identifiers are both set to: com.mshaler.isometry
  </how-to-verify>
  <resume-signal>Type "approved" if capabilities are correctly configured, or describe any issues found</resume-signal>
</task>

</tasks>

<verification>
- Both projects have proper entitlements files configured
- Code signing settings are properly set up
- Signing & Capabilities tabs are accessible in Xcode
- CloudKit containers and background modes are configured
- Platform-specific sandbox settings are correct
</verification>

<success_criteria>
- iOS project shows Signing & Capabilities tab with CloudKit and Background Modes
- macOS project shows Signing & Capabilities tab with App Sandbox, CloudKit, and Background Modes
- Entitlements files are properly referenced in build settings
- Bundle identifiers match: com.mshaler.isometry
- Projects are ready for device deployment and App Store submission
</success_criteria>

<output>
After completion, create `.planning/phases/05-xcode-migration/05-03-SUMMARY.md`
</output>