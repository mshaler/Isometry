---
phase: 27-application-integration-gap-closure
plan: 02
type: execute
wave: 2
depends_on: ["27-01"]
files_modified: ["src/components/Canvas.tsx"]
autonomous: true

must_haves:
  truths:
    - "Canvas component uses SQL query API instead of mock data"
    - "ListView components receive live database data"
    - "Real-time database updates appear in Canvas UI components"
  artifacts:
    - path: "src/components/Canvas.tsx"
      provides: "Canvas using SQL query API instead of useMockData"
      contains: "sql="
  key_links:
    - from: "src/components/Canvas.tsx"
      to: "SQL query API"
      via: "ListView sql prop"
      pattern: "sql=.*SELECT"
    - from: "ListView"
      to: "VirtualizedList"
      via: "SQL query props"
      pattern: "sql={.*}"
---

<objective>
Migrate Canvas component from mock data pattern to SQL query API to enable live database functionality.

Purpose: Complete the integration by connecting the Canvas component to the live database infrastructure. Canvas currently uses useMockData() and passes static data props to ListView, but ListView already supports SQL query API for live data. This migration enables real-time database updates to appear in the main Canvas interface.
Output: Canvas component fully integrated with live database using SQL query API instead of mock data.
</objective>

<execution_context>
@/Users/mshaler/.claude/get-shit-done/workflows/execute-plan.md
@/Users/mshaler/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Phase 27 research findings and API patterns
@.planning/phases/27-application-integration-gap-closure/27-RESEARCH.md

# Current Canvas implementation using mock data
@src/components/Canvas.tsx

# ListView implementation showing SQL API support
@src/components/views/ListView.tsx

# VirtualizedList showing dual API support (items/sql props)
@src/components/VirtualizedList/index.tsx
</context>

<tasks>

<task type="auto">
  <name>Migrate Canvas from mock data to SQL query API</name>
  <files>src/components/Canvas.tsx</files>
  <action>
    Replace useMockData pattern with SQL query API in Canvas.tsx to enable live database functionality.

    1. Remove mock data dependency:
       - Remove import: `import { useMockData } from '../hooks/useMockData';`
       - Remove usage: `const { data: nodes, loading, error } = useMockData();` (line 35)

    2. Replace with SQL query approach:
       - Add base SQL query for nodes: `const baseNodeSql = "SELECT * FROM nodes WHERE deleted_at IS NULL";`
       - Update ListView calls to use sql prop instead of data prop

    3. Update all ListView component calls to use SQL API:

       **CSS Mode ListView calls (lines 156-157):**
       ```jsx
       // Replace:
       return <ListView data={nodes} onNodeClick={handleNodeClick} />;

       // With:
       return <ListView sql={baseNodeSql} onNodeClick={handleNodeClick} />;
       ```

       **D3 Mode ListView calls (lines 124-125):**
       ```jsx
       // Replace:
       return <D3ListView data={nodes} onNodeClick={handleNodeClick} />;

       // With:
       return <D3ListView sql={baseNodeSql} onNodeClick={handleNodeClick} />;
       ```

    4. Update all other view component calls:
       - GridView calls (lines 161, 130): Replace `data={nodes}` with `sql={baseNodeSql}`
       - KanbanView, TimelineView, CalendarView, ChartsView, NetworkView, TreeView calls: Replace `data={nodes}` with `sql={baseNodeSql}`

    5. Update loading/error state handling:
       - Remove references to mock data loading/error states
       - Let individual view components handle their own loading states through SQL queries

    6. Update empty state check:
       - Remove `!nodes || nodes.length === 0` condition
       - Let view components handle empty state through SQL query results

    Do NOT modify view components themselves - they already support both data and sql props. Only change Canvas.tsx to use the sql prop pattern.
  </action>
  <verify>
    ```bash
    # Verify useMockData import was removed
    grep -n "useMockData" src/components/Canvas.tsx || echo "useMockData removed ✓"

    # Verify SQL query is defined
    grep -n "baseNodeSql" src/components/Canvas.tsx

    # Verify ListView calls use sql prop
    grep -n "sql={baseNodeSql}" src/components/Canvas.tsx

    # Verify no data prop usage remains
    grep -n "data={nodes}" src/components/Canvas.tsx || echo "data props removed ✓"

    # Check TypeScript compilation
    npm run build 2>&1 | head -20
    ```
  </verify>
  <done>Canvas component no longer uses useMockData, defines baseNodeSql query, and all view component calls use sql prop instead of data prop to enable live database functionality</done>
</task>

</tasks>

<verification>
1. useMockData import and usage removed from Canvas.tsx
2. baseNodeSql query defined for database access
3. All view component calls (ListView, GridView, etc.) use sql prop instead of data prop
4. TypeScript compilation succeeds without prop mismatch errors
5. Canvas component properly integrated with live database infrastructure
</verification>

<success_criteria>
- Canvas component uses SQL query API instead of mock data
- All view components receive live database data through sql props
- TypeScript compilation passes without prop type errors
- Live database changes can propagate to Canvas UI components
</success_criteria>

<output>
After completion, create `.planning/phases/27-application-integration-gap-closure/27-02-SUMMARY.md`
</output>