---
phase: 27-application-integration-gap-closure
plan: 02
type: execute
wave: 2
depends_on: ["27-01"]
files_modified: ["src/components/Canvas.tsx"]
autonomous: true

must_haves:
  truths:
    - "Canvas component uses SQL query API instead of mock data where supported"
    - "ListView components receive live database data through sql props"
    - "D3ListView components receive data through existing data props (maintains current API)"
  artifacts:
    - path: "src/components/Canvas.tsx"
      provides: "Canvas using mixed API patterns - SQL query for ListView, data props for D3ListView"
      contains: "baseNodeSql"
  key_links:
    - from: "src/components/Canvas.tsx"
      to: "SQL query API"
      via: "ListView sql prop"
      pattern: "sql=.*SELECT"
    - from: "src/components/Canvas.tsx"
      to: "useMockData for D3ListView"
      via: "data prop pattern"
      pattern: "data={nodes}"
---

<objective>
Migrate Canvas component to use optimal API patterns for each view component type to enable live database functionality where supported.

Purpose: Complete the integration by connecting compatible components to the live database infrastructure while maintaining existing API contracts. ListView supports SQL query API for live data, while D3ListView uses data props. This migration enables real-time database updates for supported components while preserving functionality for D3 components.
Output: Canvas component using appropriate API patterns - SQL query API for ListView, data props for D3ListView.
</objective>

<execution_context>
@/Users/mshaler/.claude/get-shit-done/workflows/execute-plan.md
@/Users/mshaler/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Phase 27 research findings and API patterns
@.planning/phases/27-application-integration-gap-closure/27-RESEARCH.md

# Current Canvas implementation using mock data
@src/components/Canvas.tsx

# ListView implementation showing SQL API support
@src/components/views/ListView.tsx

# D3ListView implementation showing data prop requirement
@src/components/views/D3ListView.tsx

# VirtualizedList showing dual API support (items/sql props)
@src/components/VirtualizedList/index.tsx
</context>

<tasks>

<task type="auto">
  <name>Migrate Canvas to use optimal API patterns for each component type</name>
  <files>src/components/Canvas.tsx</files>
  <action>
    Update Canvas.tsx to use appropriate API patterns based on component capabilities while maintaining useMockData for D3 components.

    1. Keep useMockData import and usage for D3 components:
       - Maintain: `import { useMockData } from '../hooks/useMockData';`
       - Maintain: `const { data: nodes, loading, error } = useMockData();` (line 35)

    2. Add SQL query for SQL-API-compatible components:
       - Add: `const baseNodeSql = "SELECT * FROM nodes WHERE deleted_at IS NULL ORDER BY modifiedAt DESC";`

    3. Update ListView calls to use SQL API (ListView supports sql prop):

       **CSS Mode ListView calls (lines 156-157):**
       ```jsx
       // Replace:
       return <ListView data={nodes} onNodeClick={handleNodeClick} />;

       // With:
       return <ListView sql={baseNodeSql} onNodeClick={handleNodeClick} />;
       ```

    4. Keep D3ListView calls using data props (D3ListView requires data prop):

       **D3 Mode ListView calls (lines 124-125):**
       ```jsx
       // Keep unchanged:
       return <D3ListView data={nodes} onNodeClick={handleNodeClick} />;
       ```

    5. Update other view components based on their API support:
       - GridView: Check if supports sql prop, if not keep data prop
       - KanbanView, TimelineView, CalendarView, ChartsView, NetworkView, TreeView: Keep data props unless research shows sql support

    6. Maintain loading/error state handling:
       - Keep references to mock data loading/error states for D3 components
       - Let ListView handle its own loading states through SQL queries

    7. Keep empty state check:
       - Maintain `!nodes || nodes.length === 0` condition for D3 components
       - Let ListView components handle empty state through SQL query results

    This creates a hybrid approach: SQL API where supported (ListView), data props where required (D3ListView).
  </action>
  <verify>
    ```bash
    # Verify useMockData import is maintained for D3 components
    grep -n "useMockData" src/components/Canvas.tsx

    # Verify SQL query is defined for SQL-API components
    grep -n "baseNodeSql" src/components/Canvas.tsx

    # Verify ListView calls use sql prop
    grep -n "sql={baseNodeSql}" src/components/Canvas.tsx

    # Verify D3ListView calls still use data prop
    grep -n "data={nodes}" src/components/Canvas.tsx

    # Check TypeScript compilation for prop compatibility
    npm run build 2>&1 | head -20
    ```
  </verify>
  <done>Canvas component uses hybrid API approach: ListView components use SQL query API for live data, D3ListView components use data props with mock data, maintaining type compatibility for both patterns</done>
</task>

</tasks>

<verification>
1. useMockData import and usage maintained for D3 components
2. baseNodeSql query defined for SQL-compatible components
3. ListView calls use sql prop for live database access
4. D3ListView calls maintain data prop pattern
5. TypeScript compilation succeeds without prop type mismatches
6. Canvas component supports both API patterns appropriately
</verification>

<success_criteria>
- Canvas component uses SQL query API for ListView (where supported)
- Canvas component maintains data prop API for D3ListView (where required)
- No TypeScript compilation errors due to prop type mismatches
- Live database changes propagate to SQL-compatible components
- D3 components continue functioning with mock data
</success_criteria>

<output>
After completion, create `.planning/phases/27-application-integration-gap-closure/27-02-SUMMARY.md`
</output>