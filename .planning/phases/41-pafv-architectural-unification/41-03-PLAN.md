---
phase: 41-pafv-architectural-unification
plan: 03
type: execute
wave: 3
depends_on: ["41-02"]
files_modified: [
  "src/components/views/GridView.tsx",
  "src/components/views/ListView.tsx",
  "src/components/views/KanbanView.tsx",
  "src/components/views/index.ts",
  "src/d3/ViewContinuum.ts"
]
autonomous: true

must_haves:
  truths:
    - "Legacy CSS view components removed from codebase"
    - "All view imports redirect to unified ViewEngine usage"
    - "No visual regression from architectural transition"
    - "ViewContinuum uses IsometryViewEngine for transitions"
    - "Event propagation works from D3 back to React state"
  artifacts:
    - path: "src/components/views/index.ts"
      provides: "Clean exports without legacy CSS views"
      max_lines: 20
    - path: "src/d3/ViewContinuum.ts"
      provides: "Updated view orchestration for unified engine"
      contains: "IsometryViewEngine"
  key_links:
    - from: "D3 click events"
      to: "React state updates"
      via: "event handler callbacks"
      pattern: "onClick.*setState\\("
    - from: "src/d3/ViewContinuum.ts"
      to: "src/engine/IsometryViewEngine.ts"
      via: "view transition orchestration"
      pattern: "transition\\("
---

<objective>
Complete architectural unification by removing legacy CSS components and ensuring event propagation works correctly.

Purpose: Eliminate all remaining dual rendering artifacts and verify the unified ViewEngine architecture maintains existing functionality without visual regression.
Output: Clean codebase with legacy CSS components removed and verified event flow from D3 to React.
</objective>

<execution_context>
@/Users/mshaler/.claude/get-shit-done/workflows/execute-plan.md
@/Users/mshaler/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/41-pafv-architectural-unification/41-RESEARCH.md
@src/components/views/GridView.tsx
@src/components/views/ListView.tsx
@src/components/views/KanbanView.tsx
@src/components/views/index.ts
@src/d3/ViewContinuum.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Remove legacy CSS view components</name>
  <files>
    src/components/views/GridView.tsx
    src/components/views/ListView.tsx
    src/components/views/KanbanView.tsx
    src/components/views/index.ts
  </files>
  <action>
    Delete legacy CSS-based view components that have been replaced by D3 renderers:

    1. Delete src/components/views/GridView.tsx completely (replaced by GridRenderer)
    2. Delete src/components/views/ListView.tsx completely (replaced by ListRenderer)
    3. Delete src/components/views/KanbanView.tsx completely (replaced by KanbanRenderer)
    4. Update src/components/views/index.ts to remove deleted exports
    5. Keep only view components that haven't been migrated yet: TimelineView, CalendarView, ChartsView, NetworkView, TreeView

    Verify no imports reference the deleted files before removal. Use grep to search for remaining references across codebase. Update imports to use ViewEngine pattern where applicable.
  </action>
  <verify>
    Deleted files no longer exist in filesystem.
    index.ts compiles without export errors.
    No remaining imports reference deleted GridView/ListView/KanbanView components.
    TypeScript compilation succeeds across entire codebase.
  </verify>
  <done>
    Legacy CSS view components removed with updated exports file containing only non-migrated view components.
  </done>
</task>

<task type="auto">
  <name>Task 2: Update ViewContinuum for unified engine integration</name>
  <files>src/d3/ViewContinuum.ts</files>
  <action>
    Update ViewContinuum to work with IsometryViewEngine instead of separate view components:

    1. Import IsometryViewEngine and ViewConfig interfaces
    2. Replace view component instantiation with engine.transition() calls
    3. Update morphView() method to create ViewConfig for target view type
    4. Implement proper FLIP animations using engine.transition() duration parameter
    5. Remove references to CSS-based view components and D3/CSS mode switching
    6. Ensure selection state and LATCH filters preserve across transitions
    7. Update view type mapping from string names to ViewConfig.viewType enum

    Reference existing FLIP animation patterns from Phase 37 implementation. Use ViewConfig interface for view specification. Maintain compatibility with existing SuperGrid header and filter integration.
  </action>
  <verify>
    ViewContinuum compiles with IsometryViewEngine integration.
    morphView() method creates proper ViewConfig objects.
    FLIP animations work with engine.transition() calls.
    Selection state preserves across view transitions.
    No references to deleted CSS view components remain.
  </verify>
  <done>
    ViewContinuum updated to orchestrate view transitions through unified IsometryViewEngine with proper FLIP animations and state preservation.
  </done>
</task>

<task type="auto">
  <name>Task 3: Verify event propagation from D3 to React</name>
  <files>
    src/engine/renderers/GridRenderer.ts
    src/engine/renderers/ListRenderer.ts
    src/engine/renderers/KanbanRenderer.ts
  </files>
  <action>
    Ensure D3 click events properly propagate to React state through callback patterns:

    1. Add onNodeClick callback parameter to all renderer interfaces
    2. In GridRenderer: Add D3 click handlers that call onNodeClick with node data
    3. In ListRenderer: Add click handlers for list items that trigger React callbacks
    4. In KanbanRenderer: Add card click handlers that propagate to React state
    5. Test event flow: D3 click → renderer callback → IsometryViewEngine → Canvas → React state
    6. Verify selected node state updates correctly in Canvas component
    7. Add hover state handling that doesn't interfere with click events

    Use D3 .on('click', callback) pattern. Pass node data through event handlers. Ensure React state updates trigger re-renders appropriately. Test with actual click interactions in development mode.
  </action>
  <verify>
    Click events on rendered elements trigger without errors.
    onNodeClick callbacks receive proper Node data objects.
    Canvas component selectedNode state updates when clicking D3 elements.
    Hover effects work without preventing click events.
    No console errors during click event handling.
  </verify>
  <done>
    Event propagation verified working from D3 renderers back to React state with proper click handlers and callback patterns.
  </done>
</task>

</tasks>

<verification>
Verify no legacy CSS view components remain in codebase.
Test all three view types (grid, list, kanban) render correctly through unified engine.
Confirm click events on D3 elements update React state appropriately.
Check that view transitions work smoothly without visual artifacts.
Verify no console errors or TypeScript compilation issues.
</verification>

<success_criteria>
- Legacy CSS view components completely removed from codebase
- ViewContinuum orchestrates transitions through IsometryViewEngine
- D3 click events propagate correctly to React state
- No visual regression during architectural transition
- Clean separation between "D3 renders, React controls" achieved
</success_criteria>

<output>
After completion, create `.planning/phases/41-pafv-architectural-unification/41-03-SUMMARY.md`
</output>