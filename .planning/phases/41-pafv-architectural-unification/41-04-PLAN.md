---
phase: 41-pafv-architectural-unification
plan: 04
type: execute
wave: 1
depends_on: []
files_modified: [
  "src/d3/ViewContinuum.ts",
  "src/engine/renderers/ListRenderer.ts",
  "src/engine/renderers/KanbanRenderer.ts",
  "src/hooks/useComponentTheme.ts",
  "src/types/views.ts",
  "src/engine/contracts/ViewConfig.ts"
]
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "TypeScript compilation succeeds with zero errors for all modified files"
    - "ViewContinuum uses consistent ViewType enum values across the codebase"
    - "ListRenderer and KanbanRenderer have proper container property declarations"
    - "No duplicate function declarations exist in useComponentTheme"
  artifacts:
    - path: "src/d3/ViewContinuum.ts"
      provides: "Clean TypeScript with unified ViewType usage"
      contains: "IsometryViewEngine integration without compilation errors"
    - path: "src/engine/renderers/ListRenderer.ts"
      provides: "Proper container property declaration"
      contains: "private container: HTMLElement | null = null"
    - path: "src/engine/renderers/KanbanRenderer.ts"
      provides: "Proper container property declaration"
      contains: "private container: HTMLElement | null = null"
    - path: "src/hooks/useComponentTheme.ts"
      provides: "Single useCanvasTheme function without duplicates"
      exports: ["useCanvasTheme", "useComponentTheme"]
  key_links:
    - from: "src/d3/ViewContinuum.ts"
      to: "src/engine/contracts/ViewConfig.ts"
      via: "ViewType enum import"
      pattern: "import.*ViewType.*from.*ViewConfig"
    - from: "src/engine/renderers/ListRenderer.ts"
      to: "this.container property access"
      via: "class property declaration"
      pattern: "private container.*HTMLElement.*null"
---

<objective>
Fix TypeScript compilation errors identified in Phase 41 verification to complete PAFV architectural unification.

Purpose: Ensure clean compilation and type safety for the unified ViewEngine architecture without runtime errors.
Output: Zero TypeScript compilation errors, consistent ViewType usage, proper container property declarations.
</objective>

<execution_context>
@/Users/mshaler/.claude/get-shit-done/workflows/execute-plan.md
@/Users/mshaler/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/41-pafv-architectural-unification/41-VERIFICATION.md
@.planning/phases/41-pafv-architectural-unification/41-03-SUMMARY.md

# The specific TypeScript errors to fix:
# 1. ViewContinuum.ts: ViewType enum inconsistencies, unused variables, missing methods
# 2. ListRenderer.ts/KanbanRenderer.ts: Missing container property declarations
# 3. useComponentTheme.ts: Duplicate function declarations
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix ViewType enum inconsistencies and ViewContinuum cleanup</name>
  <files>src/d3/ViewContinuum.ts, src/types/views.ts, src/engine/contracts/ViewConfig.ts</files>
  <action>
    Fix TypeScript compilation errors in ViewContinuum.ts by:

    1. Unify ViewType definitions - use the ViewConfig.ts definition as canonical source:
       - Update src/types/views.ts to import ViewType from src/engine/contracts/ViewConfig.ts
       - Remove duplicate ViewType definition from views.ts
       - Ensure all string literals match the canonical enum values

    2. Fix ViewContinuum.ts specific errors:
       - Remove unused variable 'performFlipAnimation' at line 267
       - Remove unused function 'initializeActiveView' at line 724
       - Fix ViewType string comparisons to use proper enum values:
         - Change '"grid"' to use ViewType.GRID or proper enum reference
         - Change '"timeline"' to use ViewType.TIMELINE or proper enum reference
         - Change '"network"' to use ViewType.NETWORK or proper enum reference
         - Change '"calendar"' to use ViewType.CALENDAR or proper enum reference
       - Fix the missing 'cleanup' method call on IsometryViewEngine by using 'destroy' method instead

    3. Ensure consistent imports across all files using ViewType from the canonical source

    Reference existing ViewEngine integration from 41-03 plan completion.
    Gap reason: Type system inconsistencies from dual ViewType definitions causing compilation failures
  </action>
  <verify>npm run typecheck 2>&1 | grep -E "(ViewContinuum|ViewType)" || echo "ViewContinuum ViewType errors resolved"</verify>
  <done>ViewContinuum.ts compiles without ViewType-related errors, unused variables removed, proper enum usage throughout</done>
</task>

<task type="auto">
  <name>Task 2: Add missing container properties to renderers</name>
  <files>src/engine/renderers/ListRenderer.ts, src/engine/renderers/KanbanRenderer.ts</files>
  <action>
    Fix missing container property errors in both renderers by:

    1. ListRenderer.ts:
       - Add "private container: HTMLElement | null = null;" to class property declarations
       - Position it logically with other private properties (after svg, before layout)
       - Ensure it's properly typed as HTMLElement | null for cleanup safety

    2. KanbanRenderer.ts:
       - Add "private container: HTMLElement | null = null;" to class property declarations
       - Position it logically with other private properties (after svg, before layout)
       - Ensure it's properly typed as HTMLElement | null for cleanup safety

    3. Verify that both renderers already have proper container usage in:
       - render() method parameter: container: HTMLElement
       - destroy() method cleanup: this.container = null
       - setupD3Structure() method usage

    Reference existing renderer patterns from 41-02 and 41-03 plan completion.
    Gap reason: Property access errors causing runtime failures in renderer cleanup methods
  </action>
  <verify>npm run typecheck 2>&1 | grep -E "(container.*does not exist)" || echo "Container property errors resolved"</verify>
  <done>ListRenderer and KanbanRenderer both compile without container property errors, cleanup methods work correctly</done>
</task>

<task type="auto">
  <name>Task 3: Remove duplicate function declarations in useComponentTheme</name>
  <files>src/hooks/useComponentTheme.ts</files>
  <action>
    Fix duplicate useCanvasTheme function declarations by:

    1. Examine current structure:
       - Line 93: export function useCanvasTheme(): ComponentTheme { ... }
       - Line 106: export const useCanvasTheme = useComponentTheme;

    2. Choose the appropriate pattern:
       - If line 93 is a full implementation, remove line 106 (const assignment)
       - If line 106 is the intended alias, remove line 93 (function declaration)
       - Based on naming, line 106 (alias to useComponentTheme) seems more appropriate

    3. Keep the canonical useComponentTheme function and remove the duplicate
    4. Ensure all exports are still properly available for consumers
    5. Verify no breaking changes to existing imports

    Reference existing hook patterns in the codebase.
    Gap reason: Duplicate identifier causing TypeScript compilation failure
  </action>
  <verify>npm run typecheck 2>&1 | grep "Duplicate identifier 'useCanvasTheme'" || echo "Duplicate function error resolved"</verify>
  <done>useComponentTheme.ts compiles without duplicate identifier errors, proper function export maintained</done>
</task>

</tasks>

<verification>
Run full TypeScript compilation check:
- npm run typecheck should succeed with zero errors for all modified files
- Verify ViewType usage consistency across ViewContinuum and related files
- Confirm container property access works in renderer destroy methods
- Check useCanvasTheme function is properly exported without duplicates
</verification>

<success_criteria>
**Observable completion criteria:**

1. **Clean TypeScript compilation** - `npm run typecheck` succeeds with zero errors for:
   - src/d3/ViewContinuum.ts (ViewType consistency, unused variable cleanup)
   - src/engine/renderers/ListRenderer.ts (container property access)
   - src/engine/renderers/KanbanRenderer.ts (container property access)
   - src/hooks/useComponentTheme.ts (no duplicate functions)

2. **Unified ViewType usage** - All ViewType references use consistent enum values from canonical source

3. **Proper renderer properties** - Both ListRenderer and KanbanRenderer have container properties for safe cleanup

4. **No breaking changes** - Existing functionality preserved, no new runtime errors introduced

5. **Gap closure verification** - All issues from 41-VERIFICATION.md resolved, ready for human testing of view switching and event propagation
</success_criteria>

<output>
After completion, create `.planning/phases/41-pafv-architectural-unification/41-04-SUMMARY.md` with:
- TypeScript error resolution details
- ViewType unification approach taken
- Container property implementation
- Any patterns established for future renderer development
- Readiness for human verification testing
</output>