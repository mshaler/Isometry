---
phase: 80-notebook-integration
plan: 02
type: execute
wave: 2
depends_on: ["80-01"]
files_modified:
  - src/components/IntegratedLayout.tsx
autonomous: false
user_setup: []

must_haves:
  truths:
    - "Expanded panel shows all three Notebook panes (Capture, Shell, Preview)"
    - "Notebook state persists across expand/collapse cycles"
    - "Expanded state respects theme (NeXTSTEP/Modern)"
    - "Smooth expand/collapse animation maintained with content"
  artifacts:
    - path: "src/components/IntegratedLayout.tsx"
      provides: "Full NotebookLayout embedded in collapsible panel"
      contains: "NotebookLayout"
  key_links:
    - from: "src/components/IntegratedLayout.tsx"
      to: "NotebookLayout"
      via: "React component embedding"
      pattern: "<NotebookLayout"
    - from: "NotebookLayout"
      to: "NotebookContext"
      via: "useNotebook hook"
      pattern: "useNotebook\\(\\)"
    - from: "src/App.tsx (Plan 80-01)"
      to: "NotebookProvider"
      via: "context wrapping verified in Plan 80-01"
      pattern: "NotebookProvider wrapping IntegratedLayout"
---

<objective>
Embed the full NotebookLayout component (Capture, Shell, Preview panes) into the collapsible panel skeleton created in Plan 01.

Purpose: Complete the Notebook integration by replacing the placeholder with the actual three-pane NotebookLayout, ensuring state persistence and theme consistency.

Output:
- NotebookLayout embedded in collapsible panel content
- All three panes (Capture, Shell, Preview) visible when expanded
- Notebook state persists when collapsing and re-expanding
- Theme-aware styling throughout the expanded panel
</objective>

<execution_context>
@/Users/mshaler/.claude/get-shit-done/workflows/execute-plan.md
@/Users/mshaler/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/80-notebook-integration/80-01-SUMMARY.md
@src/components/IntegratedLayout.tsx
@src/components/notebook/NotebookLayout.tsx
</context>

<prerequisite_verification>
**IMPORTANT:** Before starting Task 1, verify Plan 80-01 completed successfully:

1. Check that NotebookProvider wraps IntegratedLayout in App.tsx:
   ```bash
   grep -A5 "NotebookProvider" src/App.tsx | grep -A2 "IntegratedLayout"
   ```
   Should show NotebookProvider wrapping DeepLinkHandler > IntegratedLayout

2. If NotebookContext is NOT available in IntegratedLayout, Task 1 will fail with:
   ```
   Error: useNotebook must be used within a NotebookProvider
   ```
   If this happens, go back to Plan 80-01 and ensure NotebookProvider is correctly wired.
</prerequisite_verification>

<tasks>

<task type="auto">
  <name>Task 1: Replace placeholder with NotebookLayout</name>
  <files>src/components/IntegratedLayout.tsx</files>
  <action>
1. Add NotebookLayout import at the top of the file:
```tsx
import { NotebookLayout } from './notebook/NotebookLayout';
```

2. Replace the placeholder content inside the expandable panel (the div with "NotebookLayout will be embedded here") with the actual NotebookLayout:

Find this placeholder code:
```tsx
<div className={`h-96 ${isNeXTSTEP ? 'bg-[#1A1A1A]' : 'bg-gray-50'} flex items-center justify-center`}>
  <p className={`text-sm ${mutedColor}`}>
    NotebookLayout will be embedded here (Plan 80-02)
  </p>
</div>
```

Replace with:
```tsx
<div className={`h-96 ${isNeXTSTEP ? 'bg-[#1A1A1A]' : 'bg-gray-50'}`}>
  <NotebookLayout />
</div>
```

Note: NotebookLayout already wraps its content in TerminalProvider and FocusProvider internally (see NotebookLayout.tsx lines 270-278), and NotebookProvider was wired in App.tsx in Plan 80-01. No additional context providers needed here.

**If NotebookContext error occurs:** This means Plan 80-01 was not completed or NotebookProvider is missing. Verify App.tsx has NotebookProvider wrapping IntegratedLayout.
  </action>
  <verify>
1. Run `npm run typecheck` - no import errors for NotebookLayout.
2. Run `npm run dev` and expand the Notebook panel - should see three panes.
3. **Critical check:** No "useNotebook must be used within NotebookProvider" error in console.
   If this error appears, Plan 80-01 context wiring is incomplete.
  </verify>
  <done>
NotebookLayout component renders inside the collapsible panel content area with NotebookContext available from parent provider.
  </done>
</task>

<task type="auto">
  <name>Task 2: Adjust panel height for optimal three-pane display</name>
  <files>src/components/IntegratedLayout.tsx</files>
  <action>
Increase the panel height from h-96 (384px) to a more suitable height for three-pane layout.

Update the expandable content area to use inline styles (consistent with Plan 80-01 pattern):

```tsx
{/* Expandable Content Area */}
<div
  id="notebook-panel"
  style={{
    maxHeight: isNotebookExpanded ? '28rem' : '0',
    transition: 'max-height 300ms ease-in-out',
  }}
  className="overflow-hidden"
>
  <div className={`h-[28rem] ${isNeXTSTEP ? 'bg-[#1A1A1A]' : 'bg-gray-50'}`}>
    <NotebookLayout />
  </div>
</div>
```

The height of 28rem (448px) provides:
- Enough vertical space for the three-pane layout
- Room for TipTap editor toolbar in Capture
- Terminal content visibility in Shell
- Preview visualization space

Also update the collapsed header hint text to reflect actual pane status:
```tsx
<span className={`text-[10px] ${mutedColor}`}>
  {isNotebookExpanded ? 'Expanded' : 'Capture / Shell / Preview'}
</span>
```

**Note:** Using inline style for maxHeight (not Tailwind arbitrary values) because Tailwind JIT cannot detect classes in template literals with dynamic values.
  </action>
  <verify>
Expand the Notebook panel - all three panes should have reasonable height.
TipTap editor toolbar should be visible in Capture pane.
Terminal area should be visible in Shell pane.
  </verify>
  <done>
Panel height optimized at 28rem (448px) for three-pane display with adequate space for each pane, using inline styles for animation.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete Notebook integration with collapsible panel containing all three panes (Capture, Shell, Preview).
  </what-built>
  <how-to-verify>
1. Open http://localhost:5173 in browser
2. Look for "Notebook" header below the Command Bar (collapsed by default)
3. Click the header to expand - verify you see:
   - Three panes side-by-side (Capture / Shell / Preview)
   - TipTap editor area in Capture pane
   - Terminal-like area in Shell pane
   - Preview area on the right
4. Click to collapse - verify smooth animation
5. Type something in the Capture editor
6. Collapse the panel
7. Expand the panel again - verify your typed content persists
8. Check both themes if theme toggle is available:
   - NeXTSTEP: Dark backgrounds (#1A1A1A, #1E1E1E)
   - Modern: Light backgrounds (gray-50, white)
9. Refresh the page - verify panel state (expanded/collapsed) persists
10. **Critical:** No console errors about "useNotebook must be used within NotebookProvider"
  </how-to-verify>
  <resume-signal>Type "approved" if all checks pass, or describe any issues found</resume-signal>
</task>

</tasks>

<verification>
1. `npm run typecheck` passes with zero errors
2. Notebook panel expands to show all three panes
3. Collapse/expand animation remains smooth with content
4. Content typed in Capture persists across collapse/expand cycles
5. Theme colors applied correctly (NeXTSTEP dark / Modern light)
6. Panel height (28rem) provides adequate space for all panes
7. No NotebookContext errors (provider wired in Plan 80-01)
</verification>

<success_criteria>
- NotebookLayout embedded and rendering inside collapsible panel
- All three panes visible when expanded: Capture, Shell, Preview
- Notebook state (active card, typed content) persists across collapse/expand
- Smooth 300ms animation works with full content (using inline styles)
- Theme-aware styling in expanded state matches NeXTSTEP/Modern
- Panel height provides usable space for three-pane workflow
- NotebookContext accessible (useNotebook() works without errors)
</success_criteria>

<output>
After completion, create `.planning/phases/80-notebook-integration/80-02-SUMMARY.md`
</output>
