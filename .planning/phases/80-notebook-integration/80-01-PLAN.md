---
phase: 80-notebook-integration
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/App.tsx
  - src/components/IntegratedLayout.tsx
  - src/components/ui/collapsible.tsx
autonomous: true
user_setup: []

must_haves:
  truths:
    - "User sees collapsed Notebook panel below Command Bar (default state)"
    - "User can click toggle to expand/collapse the panel"
    - "NotebookContext is available in the component tree"
    - "Collapsed state shows minimal header with expand indicator"
  artifacts:
    - path: "src/App.tsx"
      provides: "NotebookProvider wrapping IntegratedLayout"
      contains: "NotebookProvider"
    - path: "src/components/IntegratedLayout.tsx"
      provides: "Collapsible Notebook panel skeleton"
      contains: "isNotebookExpanded"
    - path: "src/components/ui/collapsible.tsx"
      provides: "Enhanced Collapsible with animation support"
      contains: "transition-all"
  key_links:
    - from: "src/App.tsx"
      to: "NotebookProvider"
      via: "context wrapping"
      pattern: "<NotebookProvider>"
    - from: "src/components/IntegratedLayout.tsx"
      to: "localStorage"
      via: "state persistence"
      pattern: "localStorage\\.getItem.*notebook_expanded"
---

<objective>
Add NotebookProvider context wiring to App.tsx and implement collapsible panel skeleton in IntegratedLayout.

Purpose: Enable Notebook state management across the app and create the collapsible UI container that will hold the full NotebookLayout in Plan 02.

Output:
- NotebookProvider wrapping IntegratedLayout in default app route
- Collapsible panel skeleton below Command Bar with expand/collapse toggle
- Panel state persisted to localStorage (collapsed by default)
- Theme-aware collapsed header styling
</objective>

<execution_context>
@/Users/mshaler/.claude/get-shit-done/workflows/execute-plan.md
@/Users/mshaler/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@src/App.tsx
@src/components/IntegratedLayout.tsx
@src/contexts/NotebookContext.tsx
@src/components/ui/collapsible.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Wire NotebookProvider in App.tsx</name>
  <files>src/App.tsx</files>
  <action>
Add NotebookProvider to the default IntegratedLayout route (around line 149-165).

Insert NotebookProvider inside SelectionProvider, wrapping DeepLinkHandler:

```tsx
<SelectionProvider>
  <AppStateProvider>
    <NotebookProvider>
      <DeepLinkHandler>
        <IntegratedLayout />
      </DeepLinkHandler>
    </NotebookProvider>
  </AppStateProvider>
</SelectionProvider>
```

Also add to the `?test=integrated` route (around line 127-144) with the same pattern.

Add import at top:
```tsx
import { NotebookProvider } from './contexts/NotebookContext';
```

Note: NotebookProvider is already imported (line 8), so just ensure the wrapping is added.
  </action>
  <verify>
Run `npm run typecheck` - no errors related to NotebookProvider.
Run app at localhost:5173 - no console errors about "useNotebook must be used within NotebookProvider".
  </verify>
  <done>
NotebookProvider wraps IntegratedLayout in both default and ?test=integrated routes.
  </done>
</task>

<task type="auto">
  <name>Task 2: Enhance Collapsible component with smooth animation</name>
  <files>src/components/ui/collapsible.tsx</files>
  <action>
Update CollapsibleContent to support smooth max-height animation instead of block/hidden toggle.

Replace the current CollapsibleContent implementation:

```tsx
export function CollapsibleContent({
  children,
  open,
  className,
  maxHeight = '24rem', // Default ~384px, suitable for Notebook panel
  ...props
}: CollapsibleContentProps & { maxHeight?: string }) {
  return (
    <div
      className={`
        overflow-hidden
        transition-all duration-300 ease-in-out
        ${open ? `max-h-[${maxHeight}]` : 'max-h-0'}
        ${className || ''}
      `}
      {...props}
    >
      {children}
    </div>
  );
}
```

Also update the CollapsibleContentProps interface to include maxHeight:

```tsx
export interface CollapsibleContentProps extends React.HTMLAttributes<HTMLDivElement> {
  children: React.ReactNode;
  open?: boolean;
  maxHeight?: string;
}
```

Note: Using Tailwind arbitrary values with max-h-[value] pattern for smooth animation.
The duration-300 (300ms) matches existing view transition timing in the codebase.
  </action>
  <verify>
Inspect the Collapsible component in browser devtools - verify transition-all and duration-300 classes applied.
Test expand/collapse - should animate smoothly over 300ms.
  </verify>
  <done>
CollapsibleContent supports smooth max-height animation with configurable maxHeight prop.
  </done>
</task>

<task type="auto">
  <name>Task 3: Add collapsible Notebook panel skeleton to IntegratedLayout</name>
  <files>src/components/IntegratedLayout.tsx</files>
  <action>
Add a collapsible panel section between the Command Bar and Dataset Switcher.

1. Add imports at top:
```tsx
import { ChevronDown, ChevronUp, BookOpen } from 'lucide-react';
```

2. Add state for panel expansion with localStorage persistence (after other useState calls, around line 106):
```tsx
// Notebook panel expand/collapse state with localStorage persistence
const [isNotebookExpanded, setIsNotebookExpanded] = useState(() => {
  try {
    return localStorage.getItem('notebook_expanded') === 'true';
  } catch {
    return false; // Collapsed by default
  }
});

// Persist notebook panel state to localStorage
useEffect(() => {
  try {
    localStorage.setItem('notebook_expanded', isNotebookExpanded.toString());
  } catch (err) {
    console.warn('Failed to persist notebook expanded state', err);
  }
}, [isNotebookExpanded]);
```

3. Add the collapsible panel UI between Command Bar and Dataset Switcher (after the Command Bar div, around line 485):
```tsx
{/* Collapsible Notebook Panel */}
<div className={`${panelBg} border-b ${borderColor}`}>
  {/* Collapsed Header - always visible */}
  <button
    type="button"
    onClick={() => setIsNotebookExpanded(prev => !prev)}
    className={`
      w-full h-8 px-4 flex items-center justify-between
      hover:bg-opacity-80 transition-colors
      ${isNeXTSTEP ? 'hover:bg-[#2D2D2D]' : 'hover:bg-gray-100'}
    `}
    aria-expanded={isNotebookExpanded}
    aria-controls="notebook-panel"
  >
    <div className="flex items-center gap-2">
      <BookOpen className={`w-4 h-4 ${mutedColor}`} />
      <span className={`text-xs font-medium ${textColor}`}>Notebook</span>
      <span className={`text-[10px] ${mutedColor}`}>
        {isNotebookExpanded ? '3 panes' : 'Capture / Shell / Preview'}
      </span>
    </div>
    {isNotebookExpanded ? (
      <ChevronUp className={`w-4 h-4 ${mutedColor}`} />
    ) : (
      <ChevronDown className={`w-4 h-4 ${mutedColor}`} />
    )}
  </button>

  {/* Expandable Content Area - placeholder for Plan 02 */}
  <div
    id="notebook-panel"
    className={`
      overflow-hidden transition-all duration-300 ease-in-out
      ${isNotebookExpanded ? 'max-h-96' : 'max-h-0'}
    `}
  >
    <div className={`h-96 ${isNeXTSTEP ? 'bg-[#1A1A1A]' : 'bg-gray-50'} flex items-center justify-center`}>
      <p className={`text-sm ${mutedColor}`}>
        NotebookLayout will be embedded here (Plan 80-02)
      </p>
    </div>
  </div>
</div>
```

This creates:
- A collapsed header bar (h-8, 32px) that's always visible
- BookOpen icon + "Notebook" label + pane indicator
- Chevron toggle button (up when expanded, down when collapsed)
- Expandable content area with smooth 300ms animation
- Placeholder content for Plan 02 to replace with actual NotebookLayout
  </action>
  <verify>
Run `npm run dev` and open localhost:5173.
1. Verify collapsed Notebook header appears below Command Bar
2. Click the header - panel should expand with smooth animation
3. Click again - panel should collapse with smooth animation
4. Refresh page - panel state should persist (collapsed by default on first visit)
5. Verify theme colors work (add ?theme=NeXTSTEP or toggle in UI if available)
  </verify>
  <done>
Collapsible Notebook panel skeleton renders below Command Bar with:
- Collapsed header showing BookOpen icon, "Notebook" label, and pane count
- Expand/collapse toggle with chevron indicator
- Smooth 300ms animation on expand/collapse
- State persisted to localStorage (collapsed by default)
- Theme-aware styling for both NeXTSTEP and Modern themes
  </done>
</task>

</tasks>

<verification>
1. `npm run typecheck` passes with zero errors
2. `npm run dev` starts without console errors
3. Notebook panel header visible below Command Bar
4. Click toggle expands/collapses with smooth animation
5. Refresh preserves expand/collapse state
6. No "useNotebook must be used within NotebookProvider" errors
</verification>

<success_criteria>
- NotebookProvider wraps IntegratedLayout in App.tsx
- Collapsible panel skeleton renders below Command Bar
- Panel defaults to collapsed state
- Expand/collapse animation is smooth (300ms)
- Panel state persists across page refresh via localStorage
- Collapsed header shows BookOpen icon, "Notebook" label, and chevron
- Theme-aware colors applied (NeXTSTEP dark / Modern light)
</success_criteria>

<output>
After completion, create `.planning/phases/80-notebook-integration/80-01-SUMMARY.md`
</output>
