---
phase: 51-navigator-integration
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/navigator/DraggableFacet.tsx
  - src/components/navigator/PlaneDropZone.tsx
  - src/components/navigator/types.ts
autonomous: true

must_haves:
  truths:
    - "Facet chips can be dragged with full ClassifiedProperty metadata"
    - "Plane wells accept dropped facets and call setMapping()"
    - "LATCHBucket ('L') correctly maps to LATCHAxis ('location')"
  artifacts:
    - path: "src/components/navigator/DraggableFacet.tsx"
      provides: "Draggable facet chip component"
      exports: ["DraggableFacet", "FACET_ITEM_TYPE"]
    - path: "src/components/navigator/PlaneDropZone.tsx"
      provides: "Drop zone for plane wells"
      exports: ["PlaneDropZone"]
    - path: "src/components/navigator/types.ts"
      provides: "Type mapping and drag item interface"
      exports: ["BUCKET_TO_AXIS", "DraggedFacetItem"]
  key_links:
    - from: "src/components/navigator/DraggableFacet.tsx"
      to: "react-dnd useDrag"
      via: "useDrag hook with ClassifiedProperty item"
      pattern: "useDrag.*type.*FACET_ITEM_TYPE"
    - from: "src/components/navigator/PlaneDropZone.tsx"
      to: "src/state/PAFVContext.tsx"
      via: "setMapping call in drop handler"
      pattern: "setMapping.*plane.*axis.*facet"
---

<objective>
Create drag-and-drop foundation components for Navigator facet-to-plane mapping.

Purpose: Enable facets from usePropertyClassification to be dragged to plane wells, with full metadata preserved through the drag operation and correct LATCH bucket to axis type conversion.

Output: DraggableFacet component, PlaneDropZone component, type mappings
</objective>

<execution_context>
@/Users/mshaler/.claude/get-shit-done/workflows/execute-plan.md
@/Users/mshaler/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Phase 50 foundation (property classification)
@src/services/property-classifier.ts
@src/hooks/data/usePropertyClassification.ts

# Existing DnD patterns
@src/components/PAFVNavigator.tsx

# PAFV types and context
@src/types/pafv.ts
@src/state/PAFVContext.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create type mappings and DraggableFacet component</name>
  <files>
    src/components/navigator/types.ts
    src/components/navigator/DraggableFacet.tsx
  </files>
  <action>
Create `src/components/navigator/types.ts`:

1. Import LATCHBucket from property-classifier and LATCHAxis from pafv types
2. Create BUCKET_TO_AXIS constant mapping single-letter buckets to full axis names:
   ```typescript
   export const BUCKET_TO_AXIS: Record<LATCHBucket, LATCHAxis> = {
     L: 'location',
     A: 'alphabet',
     T: 'time',
     C: 'category',
     H: 'hierarchy',
   };
   ```
3. Define DraggedFacetItem interface with fields needed by PlaneDropZone:
   - id: string
   - name: string
   - bucket: PropertyBucket
   - sourceColumn: string
   - facetType: string
4. Export FACET_ITEM_TYPE constant = 'FACET'

Create `src/components/navigator/DraggableFacet.tsx`:

1. Import useDrag from react-dnd, ClassifiedProperty from property-classifier
2. Import useTheme for theme-aware styling
3. Create DraggableFacet component that:
   - Takes { property: ClassifiedProperty, disabled?: boolean } props
   - Uses useDrag hook with:
     - type: FACET_ITEM_TYPE
     - item: DraggedFacetItem with all property fields
     - collect: isDragging state
   - Renders theme-aware chip with:
     - NeXTSTEP: bg-[#d4d4d4] with beveled borders
     - Modern: bg-white hover:bg-gray-50 rounded-md border
   - Shows opacity-50 when isDragging
   - Shows cursor-not-allowed when disabled (for GRAPH properties in MVP)

IMPORTANT: The disabled prop is for GRAPH bucket facets which are visible but not draggable in MVP (per research recommendation).
  </action>
  <verify>
    - npm run typecheck passes
    - types.ts exports BUCKET_TO_AXIS, DraggedFacetItem, FACET_ITEM_TYPE
    - DraggableFacet.tsx exports DraggableFacet component
  </verify>
  <done>
    - DraggableFacet renders with theme-aware styling
    - useDrag provides item with full ClassifiedProperty metadata
    - isDragging visual feedback works
    - disabled prop prevents dragging for GRAPH facets
  </done>
</task>

<task type="auto">
  <name>Task 2: Create PlaneDropZone component with PAFV integration</name>
  <files>
    src/components/navigator/PlaneDropZone.tsx
  </files>
  <action>
Create `src/components/navigator/PlaneDropZone.tsx`:

1. Import useDrop from react-dnd
2. Import usePAFV from PAFVContext
3. Import useTheme for theme-aware styling
4. Import BUCKET_TO_AXIS, FACET_ITEM_TYPE, DraggedFacetItem from ./types
5. Import Plane, AxisMapping from pafv types

Create PlaneDropZone component with props:
- plane: Plane ('x' | 'y' | 'color')
- currentMapping: AxisMapping | null

Implementation:
1. Get setMapping, removeMapping from usePAFV()
2. Use useDrop hook with:
   - accept: FACET_ITEM_TYPE
   - drop handler that:
     a. Checks if item.bucket is 'GRAPH' - if so, ignore drop (GRAPH not supported yet)
     b. Maps item.bucket to LATCHAxis using BUCKET_TO_AXIS
     c. Calls setMapping({ plane, axis, facet: item.sourceColumn })
   - collect: isOver, canDrop states

3. Render drop zone with:
   - Theme-aware container (min-h-[80px])
   - Visual highlight when isOver && canDrop
   - If currentMapping exists:
     - Display mapped axis name (capitalize first letter)
     - Add remove button (x) that calls removeMapping(plane)
   - If no mapping:
     - Show "Drop facet here" placeholder

Theme styling:
- NeXTSTEP: bg-[#a0a0a0] border inset style, highlight with bg-[#90a090]
- Modern: bg-gray-50 border-gray-300 rounded-lg, highlight with bg-blue-50 border-blue-300

IMPORTANT: The drop handler must NOT call setMapping for GRAPH bucket items. Show console.log("GRAPH facets not yet supported for axis mapping") for debugging.
  </action>
  <verify>
    - npm run typecheck passes
    - PlaneDropZone.tsx exports PlaneDropZone component
    - Component accepts plane and currentMapping props
  </verify>
  <done>
    - PlaneDropZone renders with theme-aware styling
    - useDrop accepts FACET_ITEM_TYPE drops
    - Drop handler maps LATCHBucket to LATCHAxis correctly
    - Drop handler calls setMapping with correct AxisMapping
    - GRAPH bucket drops are ignored with console message
    - Visual feedback shows on hover
    - Remove button clears mapping
  </done>
</task>

</tasks>

<verification>
1. Run `npm run typecheck` - no errors
2. Files exist in src/components/navigator/:
   - types.ts with BUCKET_TO_AXIS, DraggedFacetItem, FACET_ITEM_TYPE
   - DraggableFacet.tsx with DraggableFacet export
   - PlaneDropZone.tsx with PlaneDropZone export
3. Manual inspection confirms useDrag/useDrop patterns match PAFVNavigator.tsx
</verification>

<success_criteria>
- BUCKET_TO_AXIS maps all 5 LATCH buckets to LATCHAxis types
- DraggableFacet preserves full ClassifiedProperty metadata in drag item
- PlaneDropZone converts bucket to axis and calls setMapping correctly
- GRAPH bucket facets are disabled/ignored (MVP limitation)
- Both components use theme-aware styling matching existing Navigator
</success_criteria>

<output>
After completion, create `.planning/phases/51-navigator-integration/51-01-SUMMARY.md`
</output>
