---
phase: 51-navigator-integration
plan: 02
type: execute
wave: 2
depends_on: ["51-01"]
files_modified:
  - src/components/Navigator.tsx
autonomous: false

must_haves:
  truths:
    - "Navigator displays LATCH buckets from usePropertyClassification() instead of hardcoded axes"
    - "User can expand each LATCH bucket to see individual facets"
    - "GRAPH bucket appears in Navigator with 4 edge types and 2 metrics"
    - "Dragging a facet to a well updates SuperGrid axis mapping"
    - "Facet changes in database reflect in Navigator after refresh() call"
  artifacts:
    - path: "src/components/Navigator.tsx"
      provides: "Refactored SimplePAFVNavigator with classification buckets"
      contains: "usePropertyClassification"
  key_links:
    - from: "src/components/Navigator.tsx"
      to: "src/hooks/data/usePropertyClassification.ts"
      via: "hook call in SimplePAFVNavigator"
      pattern: "usePropertyClassification\\(\\)"
    - from: "src/components/Navigator.tsx"
      to: "src/components/ui/AccordionSection.tsx"
      via: "AccordionSection import and render"
      pattern: "AccordionSection.*title.*bucket"
    - from: "src/components/Navigator.tsx"
      to: "src/components/navigator/DraggableFacet.tsx"
      via: "DraggableFacet render per property"
      pattern: "DraggableFacet.*property"
    - from: "src/components/Navigator.tsx"
      to: "src/components/navigator/PlaneDropZone.tsx"
      via: "PlaneDropZone render per plane"
      pattern: "PlaneDropZone.*plane"
---

<objective>
Refactor SimplePAFVNavigator to consume usePropertyClassification and render LATCH+GRAPH buckets with expandable accordion sections and drag-and-drop facet mapping.

Purpose: Replace hardcoded availableAxes array with dynamic property classification from database, enabling faceted navigation that reflects actual database schema.

Output: Refactored Navigator.tsx with classification-driven PAFV controls
</objective>

<execution_context>
@/Users/mshaler/.claude/get-shit-done/workflows/execute-plan.md
@/Users/mshaler/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior plan outputs
@.planning/phases/51-navigator-integration/51-01-SUMMARY.md

# Phase 50 foundation
@src/hooks/data/usePropertyClassification.ts
@src/services/property-classifier.ts

# Components to refactor and use
@src/components/Navigator.tsx
@src/components/ui/AccordionSection.tsx

# Components from Plan 01
@src/components/navigator/DraggableFacet.tsx
@src/components/navigator/PlaneDropZone.tsx
@src/components/navigator/types.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Refactor SimplePAFVNavigator with classification buckets</name>
  <files>
    src/components/Navigator.tsx
  </files>
  <action>
Refactor the SimplePAFVNavigator component inside Navigator.tsx:

1. Add new imports at top of file:
   ```typescript
   import { DndProvider } from 'react-dnd';
   import { HTML5Backend } from 'react-dnd-html5-backend';
   import { MapPin, SortAsc, Clock, Tag, GitBranch, Network } from 'lucide-react';
   import { AccordionSection } from '@/components/ui/AccordionSection';
   import { usePropertyClassification } from '@/hooks/data/usePropertyClassification';
   import { DraggableFacet } from '@/components/navigator/DraggableFacet';
   import { PlaneDropZone } from '@/components/navigator/PlaneDropZone';
   import type { PropertyBucket } from '@/services/property-classifier';
   ```

2. Create BUCKET_CONFIG constant inside file (or import from types):
   ```typescript
   const BUCKET_CONFIG: Array<{
     key: PropertyBucket;
     label: string;
     icon: React.ReactNode;
   }> = [
     { key: 'L', label: 'Location', icon: <MapPin className="w-4 h-4" /> },
     { key: 'A', label: 'Alphabet', icon: <SortAsc className="w-4 h-4" /> },
     { key: 'T', label: 'Time', icon: <Clock className="w-4 h-4" /> },
     { key: 'C', label: 'Category', icon: <Tag className="w-4 h-4" /> },
     { key: 'H', label: 'Hierarchy', icon: <GitBranch className="w-4 h-4" /> },
     { key: 'GRAPH', label: 'Graph', icon: <Network className="w-4 h-4" /> },
   ];
   ```

3. Refactor SimplePAFVNavigator function:
   a. Keep existing: usePAFV(), useTheme(), availablePlanes
   b. Add: const { classification, isLoading, error, refresh } = usePropertyClassification();
   c. Remove: const availableAxes = [...] (the hardcoded array)
   d. Remove: handleAxisToPlane function (replaced by PlaneDropZone)
   e. Keep: handleRemoveMapping, getCurrentMapping functions

4. Add loading and error states at start of return:
   ```tsx
   if (isLoading) {
     return (
       <div className={containerStyles}>
         <div className="p-3 text-xs text-gray-500">Loading properties...</div>
       </div>
     );
   }
   if (error) {
     return (
       <div className={containerStyles}>
         <div className="p-3 text-xs text-red-500">Error: {error}</div>
       </div>
     );
   }
   if (!classification) return null;
   ```

5. Wrap entire component content in DndProvider:
   ```tsx
   return (
     <DndProvider backend={HTML5Backend}>
       <div className={containerStyles}>
         {/* View Mode Controls - keep existing */}

         {/* Two-column layout: Buckets left, Planes right */}
         <div className="flex gap-4 p-3">
           {/* Left: LATCH+GRAPH Buckets */}
           <div className="flex-1 space-y-1">
             {BUCKET_CONFIG.map(bucket => {
               const properties = classification[bucket.key];
               const isEmpty = properties.length === 0;
               const isGraph = bucket.key === 'GRAPH';

               return (
                 <AccordionSection
                   key={bucket.key}
                   title={bucket.label}
                   icon={bucket.icon}
                   badge={<span className="text-xs text-gray-500">{properties.length}</span>}
                   defaultExpanded={bucket.key === 'T' || bucket.key === 'C'}
                 >
                   {isEmpty ? (
                     <div className="text-xs text-gray-400 italic">No enabled facets</div>
                   ) : (
                     <div className="space-y-1">
                       {properties.map(property => (
                         <DraggableFacet
                           key={property.id}
                           property={property}
                           disabled={isGraph}
                         />
                       ))}
                     </div>
                   )}
                   {isGraph && (
                     <div className="mt-2 text-xs text-gray-400 italic">
                       Graph axis mapping coming soon
                     </div>
                   )}
                 </AccordionSection>
               );
             })}
           </div>

           {/* Right: Plane Drop Zones */}
           <div className="w-48 space-y-3">
             {availablePlanes.map(plane => (
               <div key={plane}>
                 <div className="text-xs font-medium capitalize mb-1">{plane}-Axis</div>
                 <PlaneDropZone
                   plane={plane}
                   currentMapping={getCurrentMapping(plane)}
                 />
               </div>
             ))}
           </div>
         </div>

         {/* Current State Display - keep existing */}
       </div>
     </DndProvider>
   );
   ```

6. Keep the View Mode Controls section (Grid/List buttons) at the top of the content
7. Keep the Current State Display section at the bottom
8. Remove the old grid-cols-3 layout with button-per-axis

CRITICAL: The PlaneDropZone receives currentMapping from getCurrentMapping(plane) which already exists. It handles the setMapping call internally via drop handler.
  </action>
  <verify>
    - npm run typecheck passes
    - Navigator.tsx imports usePropertyClassification
    - Navigator.tsx imports and renders AccordionSection for each bucket
    - Navigator.tsx imports and renders DraggableFacet for each property
    - Navigator.tsx imports and renders PlaneDropZone for each plane
    - No hardcoded availableAxes array remains
  </verify>
  <done>
    - SimplePAFVNavigator uses usePropertyClassification() instead of hardcoded axes
    - LATCH buckets render as AccordionSection with expand/collapse
    - GRAPH bucket visible with 6 items (4 edge types + 2 metrics)
    - DraggableFacet renders per property with drag capability
    - PlaneDropZone renders per plane with drop capability
    - Loading and error states handled gracefully
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete Navigator UI Integration with dynamic LATCH+GRAPH buckets, drag-and-drop facet assignment, and refresh capability.
  </what-built>
  <how-to-verify>
1. Start dev server: `npm run dev`
2. Open browser to http://localhost:5173 (or appropriate port)
3. Click the expand button on the Navigator row to show PAFV controls

**NAV-01 Verification (Dynamic LATCH buckets):**
- Confirm you see 6 accordion sections: Location, Alphabet, Time, Category, Hierarchy, Graph
- Each section should show a count badge (e.g., "Time (3)")
- Verify NO hardcoded axis buttons (Location, Alphabet, Time, Category, Hierarchy) remain

**NAV-02 Verification (Expandable buckets):**
- Click Time accordion header - it should expand/collapse
- When expanded, should show individual facets like "Created", "Modified", "Due"
- Click Category - should show facets like "Folder", "Tags", "Status"

**NAV-03 Verification (GRAPH bucket):**
- Expand the Graph section
- Should show 4 edge types: LINK, NEST, SEQUENCE, AFFINITY
- Should show 2 metrics: Degree, Weight
- Should show "Graph axis mapping coming soon" message

**NAV-04 Verification (Drag-and-drop):**
- Drag a Time facet (e.g., "Created") to the X-Axis drop zone
- Confirm the drop zone shows "Time" or the facet name
- Check "Current mappings" at bottom shows the new mapping
- Try removing the mapping with the X button
- Try dragging a GRAPH facet - it should NOT be draggable (cursor-not-allowed)

**NAV-05 Verification (Refresh):**
- This requires database facet changes which may not be testable in dev
- Confirm the hook's refresh() function is available (check React DevTools if possible)
- If you can modify facets table, verify Navigator updates after page refresh
  </how-to-verify>
  <resume-signal>
Type "approved" if all 5 NAV requirements work correctly.
Type issues if any requirement fails (e.g., "NAV-03: GRAPH bucket shows only 4 items, missing metrics").
  </resume-signal>
</task>

</tasks>

<verification>
1. All 5 NAV requirements verified via checkpoint
2. npm run typecheck passes
3. Navigator no longer has hardcoded availableAxes
4. SimplePAFVNavigator uses usePropertyClassification()
</verification>

<success_criteria>
- NAV-01: Navigator displays LATCH buckets from usePropertyClassification() instead of hardcoded axes
- NAV-02: User can expand each LATCH bucket to see individual facets (e.g., Time -> created, modified, due)
- NAV-03: GRAPH bucket appears in Navigator with 4 edge types and 2 metrics
- NAV-04: Dragging a facet to a well updates SuperGrid axis mapping
- NAV-05: Facet changes in database reflect in Navigator after refresh() call
</success_criteria>

<output>
After completion, create `.planning/phases/51-navigator-integration/51-02-SUMMARY.md`
</output>
