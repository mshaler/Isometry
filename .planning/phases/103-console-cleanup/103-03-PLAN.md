---
phase: 103-console-cleanup
plan: 03
type: execute
wave: 2
depends_on: [103-02]
files_modified:
  - src/d3/grid-rendering/GridRenderingEngine.ts
  - src/d3/grid-rendering/NestedHeaderRenderer.ts
  - src/components/supergrid/SuperStack.tsx
  - src/etl/parsers/frontmatter.ts
autonomous: true

must_haves:
  truths:
    - "Axis facet fallback warning uses debug level (not warn)"
    - "SuperStack header count warning only shows in debug mode"
    - "NestedHeaderRenderer truncation warning only shows in debug mode"
    - "YAML parse fallback warning only shows when actually recovering"
  artifacts:
    - path: "src/d3/grid-rendering/GridRenderingEngine.ts"
      provides: "Grid rendering with gated fallback logging"
      contains: "superGridLogger.debug"
    - path: "src/components/supergrid/SuperStack.tsx"
      provides: "SuperStack with gated verbose logging"
      contains: "superGridLogger"
    - path: "src/etl/parsers/frontmatter.ts"
      provides: "Frontmatter parsing with DevLogger"
      contains: "devLogger"
  key_links:
    - from: "src/d3/grid-rendering/GridRenderingEngine.ts"
      to: "src/utils/dev-logger.ts"
      via: "import"
      pattern: "import.*superGridLogger"
    - from: "src/etl/parsers/frontmatter.ts"
      to: "src/utils/dev-logger.ts"
      via: "import"
      pattern: "import.*devLogger"
---

<objective>
Gate remaining warnings that flood the console during normal operation.

Purpose: Only show warnings that indicate actual problems, not routine operational messages.
Output: Console shows meaningful warnings/errors only.
</objective>

<execution_context>
@/Users/mshaler/.claude/get-shit-done/workflows/execute-plan.md
@/Users/mshaler/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/103-console-cleanup/103-RESEARCH.md
@.planning/phases/103-console-cleanup/103-02-SUMMARY.md

# Key source files
@src/d3/grid-rendering/GridRenderingEngine.ts
@src/d3/grid-rendering/NestedHeaderRenderer.ts
@src/components/supergrid/SuperStack.tsx
@src/etl/parsers/frontmatter.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Gate GridRenderingEngine Axis Fallback Warning</name>
  <files>src/d3/grid-rendering/GridRenderingEngine.ts</files>
  <action>
The axis facet fallback warning (line ~201) fires when the selected facet has low population and the system automatically falls back to a better facet. This is expected behavior, not an error - it should be debug, not warn.

Also gate other console.log/warn calls in this file.

1. Line 201 (resolveAxisFallback method):
   Change from: `superGridLogger.warn('[GridRenderingEngine] Axis facet fallback applied', {...})`
   To: `superGridLogger.debug('Axis facet fallback applied', {...})`

2. Line 906 (render method):
   Change from: `console.log('[GridRenderingEngine.render]', {...})`
   To: `superGridLogger.debug('render', {...})`

3. Line 956 (within render):
   Keep as warn (this IS an actual warning condition - all cards filtered out):
   `superGridLogger.warn('All cards filtered out in dense mode', {...})`
   (Already uses superGridLogger.warn, just verify it's correct)

4. Line 1116 (updateGridLayout method):
   Change from: `console.log('[GridRenderingEngine.updateGridLayout]', {...})`
   To: `superGridLogger.debug('updateGridLayout', {...})`

5. Line 1165 (updateProjectedGridLayout):
   Keep as warn (missing data is an actual warning):
   `superGridLogger.warn('Missing data or headers', {...})`
   (Verify it uses superGridLogger.warn already)

6. Line 1405 (renderStackedProjectionHeaders):
   Change from: `console.warn('[renderStackedProjectionHeaders] No currentHeaders available')`
   To: `superGridLogger.debug('renderStackedProjectionHeaders: No currentHeaders available')`

Remove the [GridRenderingEngine] prefix from messages since superGridLogger already includes [SuperGrid] prefix.
  </action>
  <verify>
Run `npm run typecheck` - no errors.
Run `npm run dev`, interact with SuperGrid, change axis selections.
Verify: No fallback warnings appear in console during normal operation.
  </verify>
  <done>
Axis facet fallback uses debug level (routine operation).
Render and layout logs use debug level.
Only true warnings (all cards filtered, missing data) remain as warn.
  </done>
</task>

<task type="auto">
  <name>Task 2: Gate SuperStack and NestedHeaderRenderer Logs</name>
  <files>src/components/supergrid/SuperStack.tsx, src/d3/grid-rendering/NestedHeaderRenderer.ts</files>
  <action>
Gate verbose logging in SuperStack and NestedHeaderRenderer.

**SuperStack.tsx:**

1. Add import if not already present:
   ```typescript
   import { superGridLogger } from '../../utils/dev-logger';
   ```

2. Line 86 (`console.log(\`[SuperStack ${orientation}] headerTree:\`, {...})`):
   TO: `superGridLogger.debug(\`headerTree (${orientation})\`, {...});`

3. Line 204 (`console.log(\`[SuperStack ${orientation}] SQL-driven rendering:\`, {...})`):
   TO: `superGridLogger.debug(\`SQL-driven rendering (${orientation})\`, {...});`

4. Line 214 (`console.warn(\`[SuperStack ${orientation}] Rendering ${headerCount} headers...\`)`):
   Change to debug (high header count is informational, not an error):
   TO: `superGridLogger.debug(\`High header count (${orientation})\`, { headerCount, threshold: 1000 });`

**NestedHeaderRenderer.ts:**

1. Add import if not already present:
   ```typescript
   import { superGridLogger } from '../../../utils/dev-logger';
   ```

2. Line 172 (truncation warning):
   ```typescript
   console.warn(
     `NestedHeaderRenderer: headers truncated from ${allHeaders.length} to ${this.maxHeaders}`
   );
   ```
   Change to debug (truncation is expected behavior for large datasets):
   ```typescript
   superGridLogger.debug('Headers truncated', {
     original: allHeaders.length,
     truncated: this.maxHeaders
   });
   ```
  </action>
  <verify>
Run `npm run typecheck` - no errors.
Run `npm run dev`, load SuperGrid with data.
Verify: No SuperStack or NestedHeaderRenderer logs in console.
  </verify>
  <done>
SuperStack uses superGridLogger.debug for all verbose output.
NestedHeaderRenderer truncation uses debug level.
No console.log/warn calls remain in these files.
  </done>
</task>

<task type="auto">
  <name>Task 3: Gate YAML Parse Fallback Warning</name>
  <files>src/etl/parsers/frontmatter.ts</files>
  <action>
The YAML parse fallback warning fires when malformed frontmatter requires lenient parsing. This is expected during ETL of messy data.

1. Add import at top of file:
   ```typescript
   import { devLogger } from '../../utils/dev-logger';
   ```

2. Lines 159-161 (lenient fallback warning):
   Change from:
   ```typescript
   console.warn(
     'YAML parse fallback enabled for malformed frontmatter records'
   );
   ```
   To:
   ```typescript
   devLogger.debug('YAML parse fallback enabled for malformed frontmatter records');
   ```

3. Lines 179-180 (YAML parsing error):
   Keep the first-time warning behavior but use devLogger.warn:
   ```typescript
   devLogger.warn('YAML parsing error (further errors suppressed)', { error });
   devLogger.debug('YAML content preview', { preview });
   ```

The `didWarnLenientFallback` and `didWarnParseError` flags should remain to prevent log flooding even when debug is enabled.
  </action>
  <verify>
Run `npm run typecheck` - no errors.
Run ETL import or load app with sample data.
Verify: No YAML parse fallback warnings in console under normal operation.
Verify: Actual parse errors still show (as warn) on first occurrence.
  </verify>
  <done>
YAML parse fallback uses devLogger.debug.
YAML parse errors use devLogger.warn (once per session).
No console.warn calls remain for routine parsing.
  </done>
</task>

</tasks>

<verification>
1. Run `npm run typecheck` - zero errors
2. Run `npm run dev`
3. Open browser DevTools Console
4. Interact with SuperGrid:
   - Change row/column axes
   - Filter data to trigger sparse datasets
   - View large datasets
5. Verify: No axis fallback warnings
6. Verify: No SuperStack verbose logs
7. Verify: No truncation warnings
8. Verify: No YAML fallback warnings
9. Verify: Console only shows actual errors/warnings
</verification>

<success_criteria>
- [ ] Axis facet fallback warning uses debug level
- [ ] GridRenderingEngine render/layout logs use debug level
- [ ] SuperStack logs use debug level
- [ ] NestedHeaderRenderer truncation uses debug level
- [ ] YAML parse fallback uses debug level
- [ ] YAML parse errors still show as warn (once per session)
- [ ] TypeScript compiles without errors
- [ ] Console clean during normal SuperGrid operation
</success_criteria>

<output>
After completion, create `.planning/phases/103-console-cleanup/103-03-SUMMARY.md`
</output>
