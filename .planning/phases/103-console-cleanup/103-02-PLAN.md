---
phase: 103-console-cleanup
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/utils/dev-logger.ts
  - src/services/supergrid/HeaderDiscoveryService.ts
  - src/services/property-classifier.ts
  - src/db/SQLiteProvider.tsx
autonomous: true

must_haves:
  truths:
    - "DevLogger.debug() uses console.log (not console.warn)"
    - "DevLogger.info() uses console.info (not console.warn)"
    - "SQLiteProvider lifecycle logs only show in debug mode"
    - "HeaderDiscoveryService logs only show in debug mode"
    - "PropertyClassifier logs only show in debug mode"
  artifacts:
    - path: "src/utils/dev-logger.ts"
      provides: "Configurable logging with proper console method mapping"
      exports: ["devLogger", "superGridLogger", "sqliteLogger"]
    - path: "src/services/supergrid/HeaderDiscoveryService.ts"
      provides: "Header discovery with gated debug logs"
      contains: "devLogger"
    - path: "src/services/property-classifier.ts"
      provides: "Property classification with gated debug logs"
      contains: "devLogger"
  key_links:
    - from: "src/services/supergrid/HeaderDiscoveryService.ts"
      to: "src/utils/dev-logger.ts"
      via: "import"
      pattern: "import.*dev-logger"
    - from: "src/db/SQLiteProvider.tsx"
      to: "src/utils/dev-logger.ts"
      via: "import"
      pattern: "import.*dev-logger"
---

<objective>
Enhance DevLogger with proper log level controls and migrate verbose services to use gated logging.

Purpose: Console output only shows meaningful warnings/errors by default, with debug logs available when needed.
Output: Clean console on normal operation, with `enabledLevels: ['debug', ...]` available for debugging.
</objective>

<execution_context>
@/Users/mshaler/.claude/get-shit-done/workflows/execute-plan.md
@/Users/mshaler/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/103-console-cleanup/103-RESEARCH.md

# Key source files
@src/utils/dev-logger.ts
@src/services/supergrid/HeaderDiscoveryService.ts
@src/services/property-classifier.ts
@src/db/SQLiteProvider.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix DevLogger Console Method Mapping</name>
  <files>src/utils/dev-logger.ts</files>
  <action>
Fix the console method mapping in DevLogger. Currently all methods use console.warn, which inflates the warning count in DevTools.

Update the debug() and info() methods to use the correct console methods:

1. Change debug() method (around line 68-71):
   FROM: `console.warn(this.formatMessage(message), data);`
   TO:   `console.log(this.formatMessage(message), data);`

2. Change info() method (around line 74-77):
   FROM: `console.warn(this.formatMessage(message), data);`
   TO:   `console.info(this.formatMessage(message), data);`

3. Also update the semantic methods that use 'debug' level (inspect, state, render, metrics, data, setup around lines 31-65):
   FROM: `console.warn(this.formatMessage(...), data);`
   TO:   `console.log(this.formatMessage(...), data);`

4. Add a new sqliteLogger export for SQLiteProvider:
   ```typescript
   export const sqliteLogger = new DevLogger({ prefix: '[SQLite]', enabledLevels: quietLevels });
   ```

The warn() and error() methods already use the correct console.warn and console.error - leave those unchanged.
  </action>
  <verify>
Run `npm run typecheck` to verify no TypeScript errors.
Manually verify by temporarily enabling debug level and checking DevTools shows logs properly categorized.
  </verify>
  <done>
DevLogger.debug() uses console.log instead of console.warn.
DevLogger.info() uses console.info instead of console.warn.
Semantic methods (inspect, state, render, etc.) use console.log.
New sqliteLogger export available for SQLiteProvider.
  </done>
</task>

<task type="auto">
  <name>Task 2: Gate HeaderDiscoveryService Logs</name>
  <files>src/services/supergrid/HeaderDiscoveryService.ts</files>
  <action>
Replace all console.log calls with DevLogger. This service has 9 console.log calls that flood the console during normal operation.

1. Add import at top of file:
   ```typescript
   import { superGridLogger } from '../../utils/dev-logger';
   ```

2. Replace each console.log with superGridLogger.debug:

   Line 62: `console.log(\`[HeaderDiscoveryService] discoverHeaders(${axis}): no db or empty facets\`);`
   TO: `superGridLogger.debug(\`discoverHeaders(${axis}): no db or empty facets\`);`

   Line 66-67: `console.log(\`[HeaderDiscoveryService] discoverHeaders(${axis}):\`, {...});`
   TO: `superGridLogger.debug(\`discoverHeaders(${axis}):\`, {...});`

   Line 79: `console.log(\`[HeaderDiscoveryService] SQL query:\`, sql);`
   TO: `superGridLogger.debug('SQL query:', sql);`

   Line 92-93: `console.log(\`[HeaderDiscoveryService] SQL returned ${rows.length} rows...\`);`
   TO: `superGridLogger.debug(\`SQL returned ${rows.length} rows\`, { firstRow: ... });`

   Line 101: `console.log(\`[HeaderDiscoveryService] Post-processing path expansion...\`);`
   TO: `superGridLogger.debug(\`Post-processing path expansion for "${pathFacet.id}"\`);`

   Line 105-107: Multiple console.log calls about expansion
   TO: Single `superGridLogger.debug('Path expansion complete', { rowCount, facetCount, facetIds, sampleRow });`

   Line 194: `console.log(\`[HeaderDiscoveryService] expandPathsInRows...\`);`
   TO: `superGridLogger.debug('expandPathsInRows', {...});`

Remove the [HeaderDiscoveryService] prefix from messages since superGridLogger already includes [SuperGrid] prefix.
  </action>
  <verify>
Run `npm run typecheck` - no errors.
Run `npm run dev`, interact with SuperGrid.
Verify: No HeaderDiscoveryService logs appear in console (quietLevels = ['warn', 'error']).
  </verify>
  <done>
HeaderDiscoveryService uses superGridLogger.debug for all verbose output.
No console.log calls remain in the file.
Logs only visible when debug level enabled.
  </done>
</task>

<task type="auto">
  <name>Task 3: Gate PropertyClassifier and SQLiteProvider Logs</name>
  <files>src/services/property-classifier.ts, src/db/SQLiteProvider.tsx</files>
  <action>
Replace console.log calls in PropertyClassifier (8 calls) and SQLiteProvider (13 calls).

**PropertyClassifier (src/services/property-classifier.ts):**

1. Add import:
   ```typescript
   import { devLogger } from '../utils/dev-logger';
   ```

2. Replace console.log calls:
   - Line 127, 142: `console.log(\`[PropertyClassifier] columnHasData...\`)` -> `devLogger.debug('columnHasData', { sourceColumn, hasData, distinctCount });`
   - Line 147: `console.log(\`[PropertyClassifier] columnHasData...: false (error)\`)` -> `devLogger.debug('columnHasData error', { sourceColumn, error });`
   - Line 277: `console.log('[PropertyClassifier] classifyProperties called')` -> `devLogger.debug('classifyProperties called');`
   - Line 311: `console.log(\`[PropertyClassifier] Processing ${result[0].values.length} facet rows\`)` -> `devLogger.debug('Processing facet rows', { count: result[0].values.length });`
   - Line 322: `console.log(\`[PropertyClassifier] SKIPPING facet...\`)` -> `devLogger.debug('Skipping facet (no data)', { name, sourceColumn });`
   - Line 326: `console.log(\`[PropertyClassifier] INCLUDING facet...\`)` -> `devLogger.debug('Including facet', { name, sourceColumn, axis });`
   - Line 417: `console.log('[PropertyClassifier] Final classification:', {...})` -> `devLogger.debug('Final classification', {...});`

**SQLiteProvider (src/db/SQLiteProvider.tsx):**

1. Add import:
   ```typescript
   import { sqliteLogger } from '../utils/dev-logger';
   ```

2. Replace console.log/warn calls (keep true errors as sqliteLogger.error):

   Lifecycle logs (convert to debug):
   - Line 138: `console.log('[SQLiteProvider] Skipping duplicate initialization...')` -> `sqliteLogger.debug('Skipping duplicate initialization (StrictMode guard)');`
   - Line 201: `console.log(\`[SQLiteProvider] Schema version ${storedVersion} is current\`)` -> `sqliteLogger.debug('Schema version current', { storedVersion });`
   - Line 222: `console.log('[SQLiteProvider] Clearing stale IndexedDB data...')` -> `sqliteLogger.debug('Clearing stale IndexedDB data');`
   - Line 278: `console.log('[SQLiteProvider] Creating fresh database with schema...')` -> `sqliteLogger.debug('Creating fresh database with schema');`
   - Line 290: `console.log(\`[SQLiteProvider] Schema v${SCHEMA_VERSION} loaded...\`)` -> `sqliteLogger.debug('Schema loaded', { version: SCHEMA_VERSION });`
   - Line 298: `console.log('[SQLiteProvider] Database ready, setting state...')` -> `sqliteLogger.debug('Database ready, setting state');`
   - Line 308: `console.log('[SQLiteProvider] Facets table empty, seeding...')` -> `sqliteLogger.debug('Facets table empty, seeding');`
   - Line 311: `console.log('[SQLiteProvider] Facets seeded')` -> `sqliteLogger.debug('Facets seeded');`
   - Line 319: `console.log('[SQLiteProvider] Facets table created and seeded')` -> `sqliteLogger.debug('Facets table created and seeded');`
   - Line 361: `console.log('[SQLiteProvider] Initialization complete')` -> `sqliteLogger.debug('Initialization complete');`
   - Line 385: `console.log('[SQLiteProvider] Cleanup called...')` -> `sqliteLogger.debug('Cleanup called');`
   - Line 392: `console.log('[SQLiteProvider] Page unloading, closing database...')` -> `sqliteLogger.debug('Page unloading, closing database');`

   Warning logs (keep as warn but use sqliteLogger):
   - Line 167: `console.warn('[SQLiteProvider] IndexedDB init failed...')` -> `sqliteLogger.warn('IndexedDB init failed, using memory-only mode', { error: persistenceInitError });`
   - Line 177: `console.warn('[SQLiteProvider] Failed to load from IndexedDB...')` -> `sqliteLogger.warn('Failed to load from IndexedDB', { error: loadError });`
   - Line 203: `console.warn(\`[SQLiteProvider] Schema outdated...\`)` -> `sqliteLogger.warn('Schema outdated, will recreate', { storedVersion, required: SCHEMA_VERSION });`
   - Line 207: `console.warn('[SQLiteProvider] No schema_version found...')` -> `sqliteLogger.warn('No schema_version found, will recreate database');`
   - Line 215: `console.warn('[SQLiteProvider] node_properties table missing...')` -> `sqliteLogger.warn('node_properties table missing, will recreate');`
   - Line 314: `console.warn('[SQLiteProvider] Facets check/seed failed:', facetError)` -> `sqliteLogger.warn('Facets check/seed failed', { error: facetError });`
  </action>
  <verify>
Run `npm run typecheck` - no errors.
Run `npm run dev`, verify SQLiteProvider initializes without flooding console.
Verify: Only warnings shown for actual issues (IndexedDB failures, schema mismatches).
  </verify>
  <done>
PropertyClassifier uses devLogger.debug for all verbose output.
SQLiteProvider uses sqliteLogger with debug for lifecycle, warn for actual warnings.
No console.log calls remain in either file.
  </done>
</task>

</tasks>

<verification>
1. Run `npm run typecheck` - zero errors
2. Run `npm run dev`
3. Open browser DevTools Console
4. Refresh page and interact with SuperGrid
5. Verify: No [HeaderDiscoveryService] logs
6. Verify: No [PropertyClassifier] logs
7. Verify: No [SQLiteProvider] lifecycle logs (only warnings for real issues)
8. Verify: Warning count in DevTools not inflated with debug messages
</verification>

<success_criteria>
- [ ] DevLogger.debug() uses console.log
- [ ] DevLogger.info() uses console.info
- [ ] Semantic methods (inspect, state, render) use console.log
- [ ] HeaderDiscoveryService logs gated at debug level
- [ ] PropertyClassifier logs gated at debug level
- [ ] SQLiteProvider lifecycle logs gated at debug level
- [ ] SQLiteProvider true warnings still visible
- [ ] TypeScript compiles without errors
</success_criteria>

<output>
After completion, create `.planning/phases/103-console-cleanup/103-02-SUMMARY.md`
</output>
