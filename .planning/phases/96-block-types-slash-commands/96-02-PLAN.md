---
phase: 96-block-types-slash-commands
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/notebook/editor/extensions/CalloutExtension.ts
  - src/components/notebook/editor/nodes/CalloutNode.tsx
  - src/components/notebook/editor/extensions/index.ts
  - src/hooks/ui/useTipTapEditor.ts
  - src/components/notebook/editor/extensions/slash-commands.ts
  - src/index.css
autonomous: true

must_haves:
  truths:
    - "User can type /callout and see styled callout block inserted"
    - "User can change callout type via dropdown (info/warning/tip/error)"
    - "User can type content inside the callout block"
    - "Callout styling respects current theme (NeXTSTEP vs Modern)"
  artifacts:
    - path: "src/components/notebook/editor/extensions/CalloutExtension.ts"
      provides: "TipTap Node extension for callout blocks"
      exports: ["CalloutExtension"]
    - path: "src/components/notebook/editor/nodes/CalloutNode.tsx"
      provides: "React component for rendering callout blocks"
      exports: ["CalloutNode"]
  key_links:
    - from: "useTipTapEditor.ts"
      to: "CalloutExtension"
      via: "extensions array import"
      pattern: "import.*CalloutExtension"
    - from: "CalloutExtension.ts"
      to: "CalloutNode.tsx"
      via: "ReactNodeViewRenderer"
      pattern: "ReactNodeViewRenderer\\(CalloutNode\\)"
---

<objective>
Create custom Callout block type with TipTap Node extension and React view component

Purpose: Enable rich callout blocks (info/warning/tip/error) with visual styling and type switching
Output: CalloutExtension + CalloutNode component + /callout slash command
</objective>

<execution_context>
@/Users/mshaler/.claude/get-shit-done/workflows/execute-plan.md
@/Users/mshaler/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md
@.planning/phases/96-block-types-slash-commands/96-RESEARCH.md
@src/components/notebook/editor/extensions/slash-commands.ts
@src/hooks/ui/useTipTapEditor.ts
@src/index.css

Key patterns from research:
- Custom TipTap nodes use Node.create() with ReactNodeViewRenderer
- React component MUST wrap content in NodeViewWrapper
- Editable content uses NodeViewContent
- Styling via CSS custom properties (hsl(var(--border)), etc.)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create CalloutExtension TipTap node</name>
  <files>src/components/notebook/editor/extensions/CalloutExtension.ts</files>
  <action>
Create a new file CalloutExtension.ts that defines a TipTap Node extension:

```typescript
import { Node, mergeAttributes } from '@tiptap/core';
import { ReactNodeViewRenderer } from '@tiptap/react';
import { CalloutNode } from '../nodes/CalloutNode';

export type CalloutType = 'info' | 'warning' | 'tip' | 'error';

export interface CalloutAttributes {
  type: CalloutType;
}

declare module '@tiptap/core' {
  interface Commands<ReturnType> {
    callout: {
      setCallout: (attributes?: Partial<CalloutAttributes>) => ReturnType;
    };
  }
}

export const CalloutExtension = Node.create({
  name: 'callout',
  group: 'block',
  content: 'block+',

  addAttributes() {
    return {
      type: {
        default: 'info' as CalloutType,
        parseHTML: (element) => element.getAttribute('data-type') as CalloutType || 'info',
        renderHTML: (attributes) => ({ 'data-type': attributes.type }),
      },
    };
  },

  parseHTML() {
    return [{ tag: 'div[data-callout]' }];
  },

  renderHTML({ HTMLAttributes }) {
    return ['div', mergeAttributes(HTMLAttributes, { 'data-callout': '' }), 0];
  },

  addNodeView() {
    return ReactNodeViewRenderer(CalloutNode);
  },

  addCommands() {
    return {
      setCallout: (attributes = {}) => ({ commands }) => {
        return commands.insertContent({
          type: this.name,
          attrs: { type: 'info', ...attributes },
          content: [{ type: 'paragraph' }],
        });
      },
    };
  },
});
```

Key implementation notes:
- Use `content: 'block+'` to allow nested content (paragraphs, lists, etc.)
- Export CalloutType for use in CalloutNode
- Declare module augmentation for TypeScript command types
  </action>
  <verify>
Run `npm run check:types` - may show error until CalloutNode exists (expected)
  </verify>
  <done>
CalloutExtension.ts created with Node definition, attributes, commands, and React renderer binding
  </done>
</task>

<task type="auto">
  <name>Task 2: Create CalloutNode React component</name>
  <files>src/components/notebook/editor/nodes/CalloutNode.tsx</files>
  <action>
Create directory `src/components/notebook/editor/nodes/` if it doesn't exist.

Create CalloutNode.tsx:

```tsx
import { NodeViewWrapper, NodeViewContent, NodeViewProps } from '@tiptap/react';
import type { CalloutType } from '../extensions/CalloutExtension';

const CALLOUT_CONFIG: Record<CalloutType, { icon: string; label: string }> = {
  info: { icon: '\u{1F4A1}', label: 'Info' },      // Light bulb emoji
  warning: { icon: '\u{26A0}\u{FE0F}', label: 'Warning' },  // Warning emoji
  tip: { icon: '\u{2728}', label: 'Tip' },         // Sparkles emoji
  error: { icon: '\u{274C}', label: 'Error' },     // Cross mark emoji
};

export function CalloutNode({ node, updateAttributes }: NodeViewProps) {
  const type = (node.attrs.type as CalloutType) || 'info';
  const config = CALLOUT_CONFIG[type] || CALLOUT_CONFIG.info;

  return (
    <NodeViewWrapper className={`callout callout--${type}`}>
      <div className="callout__header">
        <span className="callout__icon">{config.icon}</span>
        <select
          className="callout__type-selector"
          value={type}
          onChange={(e) => updateAttributes({ type: e.target.value as CalloutType })}
          contentEditable={false}
        >
          {Object.entries(CALLOUT_CONFIG).map(([key, { label }]) => (
            <option key={key} value={key}>{label}</option>
          ))}
        </select>
      </div>
      <NodeViewContent className="callout__content" />
    </NodeViewWrapper>
  );
}
```

Key implementation notes:
- NodeViewWrapper is REQUIRED for TipTap integration
- NodeViewContent makes the block content editable
- contentEditable={false} on select prevents editor capturing input
- Use Unicode escapes for emojis to avoid encoding issues
  </action>
  <verify>
Run `npm run check:types` - may show import errors until extension exports are wired
  </verify>
  <done>
CalloutNode.tsx created with type selector dropdown and editable content area
  </done>
</task>

<task type="auto">
  <name>Task 3: Wire CalloutExtension into editor and add slash command</name>
  <files>
src/components/notebook/editor/extensions/index.ts
src/hooks/ui/useTipTapEditor.ts
src/components/notebook/editor/extensions/slash-commands.ts
  </files>
  <action>
1. Update src/components/notebook/editor/extensions/index.ts:
   - Add export: `export { CalloutExtension, type CalloutType, type CalloutAttributes } from './CalloutExtension';`

2. Update src/hooks/ui/useTipTapEditor.ts:
   - Add import: `import { CalloutExtension } from '../../components/notebook/editor/extensions';`
   - Add CalloutExtension to the extensions array (after AppleNotesShortcuts, before SlashCommands)

3. Update src/components/notebook/editor/extensions/slash-commands.ts:
   - Add callout command to SLASH_COMMANDS array:
   ```typescript
   {
     id: 'callout',
     label: 'Callout',
     description: 'Highlight important information',
     category: 'format',
     shortcut: 'callout',
     action: ({ editor, range }) => {
       editor.chain().focus().deleteRange(range).setCallout({ type: 'info' }).run();
     },
   },
   ```
   - Add this after the quote command (format category commands should be grouped)
  </action>
  <verify>
Run `npm run check:types` - should pass with zero errors
Grep for 'CalloutExtension' in useTipTapEditor.ts - should find import and usage
Grep for 'setCallout' in slash-commands.ts - should find 1 occurrence
  </verify>
  <done>
CalloutExtension registered in editor, /callout slash command functional
  </done>
</task>

<task type="auto">
  <name>Task 4: Add callout CSS styling with theme support</name>
  <files>src/index.css</files>
  <action>
Add callout styling to src/index.css. Place this AFTER the existing editor styles (look for .ProseMirror styles or similar).

```css
/* Callout block styles */
.callout {
  border: 1px solid hsl(var(--border));
  background: hsl(var(--card));
  border-radius: 0.5rem;
  padding: 1rem;
  margin: 1rem 0;
  box-shadow: var(--shadow-raised, none);
}

.callout__header {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  margin-bottom: 0.5rem;
}

.callout__icon {
  font-size: 1.25rem;
  line-height: 1;
}

.callout__type-selector {
  font-size: 0.75rem;
  padding: 0.125rem 0.25rem;
  border: 1px solid hsl(var(--border));
  border-radius: 0.25rem;
  background: hsl(var(--background));
  color: hsl(var(--foreground));
  cursor: pointer;
}

.callout__content {
  min-height: 1.5rem;
}

.callout__content > *:first-child {
  margin-top: 0;
}

.callout__content > *:last-child {
  margin-bottom: 0;
}

/* Callout type variants */
.callout--info {
  border-left: 4px solid hsl(var(--primary));
}

.callout--warning {
  border-left: 4px solid hsl(40 96% 53%); /* Amber/orange */
}

.callout--tip {
  border-left: 4px solid hsl(142 76% 36%); /* Green */
}

.callout--error {
  border-left: 4px solid hsl(var(--destructive));
}
```

These styles:
- Use CSS custom properties for theme compatibility
- Support both NeXTSTEP (raised shadow) and Modern themes
- Have distinct left borders for each type
- Handle nested content spacing
  </action>
  <verify>
Grep for '.callout' in src/index.css - should find the new styles
Run `npm run check:types` - should still pass
  </verify>
  <done>
Callout CSS added with theme-aware styling and type variants
  </done>
</task>

</tasks>

<verification>
1. Run `npm run check:types` - passes with zero errors
2. Run `npm run check:lint` - no new lint errors
3. Grep for 'CalloutExtension' in useTipTapEditor.ts - confirms extension registered
4. Grep for 'setCallout' in slash-commands.ts - confirms slash command added
5. Grep for '.callout--info' in src/index.css - confirms styling added
</verification>

<success_criteria>
- CalloutExtension.ts defines TipTap Node with type attribute
- CalloutNode.tsx renders with icon, type selector, and editable content
- /callout slash command inserts callout block
- CSS styling applied with theme-aware custom properties
- All 4 callout types (info/warning/tip/error) visually distinct
</success_criteria>

<output>
After completion, create `.planning/phases/96-block-types-slash-commands/96-02-SUMMARY.md`
</output>
